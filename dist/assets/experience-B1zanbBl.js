var Mt=Object.defineProperty;var Tt=(n,e,t)=>e in n?Mt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Ie=(n,e,t)=>Tt(n,typeof e!="symbol"?e+"":e,t);import"./modulepreload-polyfill-B5Qt9EMX.js";import{aZ as Ray,a_ as Plane,ag as MathUtils$1,k as Vector3$1,a$ as Controls,b0 as MOUSE,b1 as TOUCH,al as Quaternion$1,b2 as Spherical,V as Vector2$1,q as TrianglesDrawMode,r as TriangleFanDrawMode,t as TriangleStripDrawMode,w as Loader,x as LoaderUtils,F as FileLoader,y as Color,aL as LinearSRGBColorSpace,z as SpotLight,E as PointLight,G as DirectionalLight,H as MeshBasicMaterial,aS as SRGBColorSpace,J as MeshPhysicalMaterial,K as Matrix4$1,Q as InstancedMesh,X as InstancedBufferAttribute,Y as Object3D,Z as TextureLoader,_ as ImageBitmapLoader,$ as BufferAttribute,a0 as InterleavedBuffer,a1 as LinearFilter,a2 as LinearMipmapLinearFilter,a3 as RepeatWrapping,am as NearestFilter,a4 as PointsMaterial,a5 as Material,a6 as LineBasicMaterial,a7 as MeshStandardMaterial,D as DoubleSide,a8 as PropertyBinding,a9 as BufferGeometry,aa as SkinnedMesh,M as Mesh,ab as LineSegments,ac as Line,ad as LineLoop,ae as Points,af as Group,P as PerspectiveCamera,O as OrthographicCamera,ah as Skeleton,ai as AnimationClip,aj as Bone,ak as InterpolateLinear,b3 as ColorManagement,an as NearestMipmapNearestFilter,ao as LinearMipmapNearestFilter,ap as NearestMipmapLinearFilter,aq as ClampToEdgeWrapping,ar as MirroredRepeatWrapping,as as InterpolateDiscrete,at as FrontSide,au as InterleavedBufferAttribute,av as Texture,aw as VectorKeyframeTrack,ax as NumberKeyframeTrack,ay as QuaternionKeyframeTrack,az as Box3,aA as Sphere,aB as Interpolant,b4 as Line3,b5 as Triangle,p as REVISION,b6 as BackSide,b7 as Matrix3$1,b8 as Vector4$1,b9 as CapsuleGeometry,n as Clock,aH as PlaneGeometry,v as ShaderMaterial,aQ as LoadingManager,ba as ShaderChunk$1,bb as DynamicDrawUsage,bc as InstancedBufferGeometry,bd as Uniform,be as AdditiveBlending,bf as ObjectLoader,bg as Sprite,bh as LOD,bi as BatchedMesh,bj as LightProbe,bk as HemisphereLight,bl as RectAreaLight,bm as AmbientLight,S as Scene,bn as Fog,bo as FogExp2,L as Layers,aC as DataTextureLoader,aD as HalfFloatType,aE as FloatType,aF as DataUtils,i as Raycaster,bp as Float32BufferAttribute,bq as InstancedInterleavedBuffer,br as WireframeGeometry,bs as UniformsLib,bt as ShaderLib,bu as UniformsUtils,bv as ShapePath,bw as SphereGeometry,bx as AudioLoader,aW as CubeTextureLoader,by as AudioListener,bz as VideoTexture,bA as AnimationMixer,bB as PositionalAudio,bC as Audio$1,aV as EquirectangularReflectionMapping,aU as CubeReflectionMapping,bD as CylinderGeometry,g as getDefaultExportFromCjs,bE as CircleGeometry,bF as CustomBlending,bG as AddEquation,bH as SrcAlphaFactor,bI as OneFactor,bJ as LoopRepeat,bK as LoopOnce,bL as Euler$1,bM as BoxGeometry,bN as OctahedronGeometry,bO as RGBFormat,bP as RingGeometry,bQ as DodecahedronGeometry,bR as CanvasTexture,bS as LoopPingPong,R as RGBAFormat,bT as CatmullRomCurve3,bU as TubeGeometry,bV as MeshPhongMaterial,T as THREE,j as PCFSoftShadowMap,A as ACESFilmicToneMapping,c as auth,u as updateDoc,d as doc,a as db,bW as CineonToneMapping,bX as PMREMGenerator,bY as TorusGeometry,W as WebGLRenderer}from"./three.module-D-hBrfRD.js";const scriptRel="modulepreload",assetsURL=function(n){return"/"+n},seen={},__vitePreload=function(e,t,o){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const r=document.querySelector("meta[property=csp-nonce]"),a=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));i=Promise.allSettled(t.map(l=>{if(l=assetsURL(l),l in seen)return;seen[l]=!0;const c=l.endsWith(".css"),d=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":scriptRel,c||(u.as="script"),u.crossOrigin="",u.href=l,a&&u.setAttribute("nonce",a),document.head.appendChild(u),c)return new Promise((f,h)=>{u.addEventListener("load",f),u.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${l}`)))})}))}function s(r){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r}return i.then(r=>{for(const a of r||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})},gameData={userInfo:{selectedCharacter:"emily_v14 3.glb",modeSelected:"non-vr"},scene1:{startPosition:{position:{x:-58,y:10.5,z:5},rotation:{y:-2.2},cameraPosition:{x:0,y:5,z:-3}},checkpoints:{garden:{position:{x:0,y:0,z:0},rotation:{y:0},cameraPosition:{x:0,y:0,z:2}}},savedPosition:{position:null,rotation:null,cameraPosition:null}},scene2:{startPosition:{position:{x:-.16,y:4.3,z:-256},rotation:{y:Math.PI},cameraPosition:{x:0,y:0,z:3}},checkpoints:{university:{position:{x:0,y:38,z:2490},rotation:{y:0},cameraPosition:{x:0,y:43,z:2500}}},savedPosition:{position:null,rotation:null,cameraPosition:null}},scene3:{startPosition:{position:{x:5,y:8,z:90},rotation:{y:0},cameraPosition:{x:0,y:1,z:0}},checkpoints:{university:{position:{x:0,y:38,z:2490},rotation:{y:0},cameraPosition:{x:0,y:43,z:2500}}},savedPosition:{position:null,rotation:null,cameraPosition:null}},scene4:{startPosition:{position:{x:-15,y:0,z:0},rotation:{y:Math.PI/2},cameraPosition:{x:0,y:1,z:0}},checkpoints:{university:{position:{x:0,y:38,z:2490},rotation:{y:0},cameraPosition:{x:0,y:43,z:2500}}},savedPosition:{position:null,rotation:null,cameraPosition:null}},scene5:{startPosition:{position:{x:-31,y:5,z:-.5},rotation:{y:Math.PI/2},cameraPosition:{x:0,y:1,z:0}},checkpoints:{university:{position:{x:0,y:8,z:-2},rotation:{y:0},cameraPosition:{x:0,y:3,z:-5}}},savedPosition:{position:null,rotation:null,cameraPosition:null}},scene6:{startPosition:{position:{x:0,y:2,z:-2},rotation:{y:0},cameraPosition:{x:0,y:2,z:0}},checkpoints:{university:{position:{x:0,y:0,z:-2},rotation:{y:0},cameraPosition:{x:0,y:3,z:-5}}},savedPosition:{position:null,rotation:null,cameraPosition:null}},scene7:{startPosition:{position:{x:0,y:2,z:-2},rotation:{y:0},cameraPosition:{x:.4,y:2,z:0}}},savedPosition:{position:null,rotation:null,cameraPosition:null},gameState:{startScene:"scene1"}};function updateUserInfo(n,e){n!==null&&(gameData.userInfo.selectedCharacter=n),e!==null&&(gameData.userInfo.modeSelected=e),console.log("Updated user info:",gameData.userInfo)}function getUserInfo(){return gameData.userInfo}function isUserInfoComplete(){return gameData.userInfo.selectedCharacter!==""&&gameData.userInfo.modeSelected!==""}function setStartScene(n){console.log(`setStartScene: Setting start scene to ${n}`),gameData.gameState.startScene=n,typeof window<"u"&&(localStorage.setItem("loadScene",n),console.log(`setStartScene: Stored ${n} in localStorage`))}function getStartScene(){if(typeof window<"u"){const n=localStorage.getItem("loadScene");if(n)return console.log(`getStartScene: Using saved scene from localStorage: ${n}`),n}return console.log(`getStartScene: Using default scene: ${gameData.gameState.startScene}`),gameData.gameState.startScene}function setCurrentScene(n){gameData.gameState.currentScene=n,typeof window<"u"&&localStorage.setItem("currentScene",n)}function getCurrentScene(){if(typeof window<"u"){const n=localStorage.getItem("currentScene");n&&(gameData.gameState.currentScene=n)}return{currentScene:gameData.gameState.currentScene,currentSceneData:gameData[gameData.gameState.currentScene]}}function markSceneCompleted$5(n){if(gameData.gameState.currentScene===n){if(gameData.gameState.completedScenes||(gameData.gameState.completedScenes={}),gameData.gameState.completedScenes[n]=!0,typeof window<"u"){const e=JSON.parse(localStorage.getItem("completedScenes")||"{}");e[n]=!0,localStorage.setItem("completedScenes",JSON.stringify(e))}console.log(`Scene ${n} marked as completed`)}}sessionStorage.getItem("sceneSelected")||window.location.replace("./scene-select.html");const selectedScene=localStorage.getItem("loadScene");selectedScene&&setStartScene(selectedScene);const _changeEvent={type:"change"},_startEvent={type:"start"},_endEvent={type:"end"},_ray$1=new Ray,_plane$1=new Plane,_TILT_LIMIT=Math.cos(70*MathUtils$1.DEG2RAD),_v=new Vector3$1,_twoPI=2*Math.PI,_STATE={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},_EPS=1e-6;class OrbitControls extends Controls{constructor(e,t=null){super(e,t),this.state=_STATE.NONE,this.enabled=!0,this.target=new Vector3$1,this.cursor=new Vector3$1,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:MOUSE.ROTATE,MIDDLE:MOUSE.DOLLY,RIGHT:MOUSE.PAN},this.touches={ONE:TOUCH.ROTATE,TWO:TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new Vector3$1,this._lastQuaternion=new Quaternion$1,this._lastTargetPosition=new Vector3$1,this._quat=new Quaternion$1().setFromUnitVectors(e.up,new Vector3$1(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Spherical,this._sphericalDelta=new Spherical,this._scale=1,this._panOffset=new Vector3$1,this._rotateStart=new Vector2$1,this._rotateEnd=new Vector2$1,this._rotateDelta=new Vector2$1,this._panStart=new Vector2$1,this._panEnd=new Vector2$1,this._panDelta=new Vector2$1,this._dollyStart=new Vector2$1,this._dollyEnd=new Vector2$1,this._dollyDelta=new Vector2$1,this._dollyDirection=new Vector3$1,this._mouse=new Vector2$1,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=onPointerMove$1.bind(this),this._onPointerDown=onPointerDown$1.bind(this),this._onPointerUp=onPointerUp.bind(this),this._onContextMenu=onContextMenu$1.bind(this),this._onMouseWheel=onMouseWheel.bind(this),this._onKeyDown=onKeyDown$1.bind(this),this._onTouchStart=onTouchStart.bind(this),this._onTouchMove=onTouchMove.bind(this),this._onMouseDown=onMouseDown.bind(this),this._onMouseMove=onMouseMove.bind(this),this._interceptControlDown=interceptControlDown.bind(this),this._interceptControlUp=interceptControlUp.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(_changeEvent),this.update(),this.state=_STATE.NONE}update(e=null){const t=this.object.position;_v.copy(t).sub(this.target),_v.applyQuaternion(this._quat),this._spherical.setFromVector3(_v),this.autoRotate&&this.state===_STATE.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let o=this.minAzimuthAngle,i=this.maxAzimuthAngle;isFinite(o)&&isFinite(i)&&(o<-Math.PI?o+=_twoPI:o>Math.PI&&(o-=_twoPI),i<-Math.PI?i+=_twoPI:i>Math.PI&&(i-=_twoPI),o<=i?this._spherical.theta=Math.max(o,Math.min(i,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(o+i)/2?Math.max(o,this._spherical.theta):Math.min(i,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let s=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const r=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),s=r!=this._spherical.radius}if(_v.setFromSpherical(this._spherical),_v.applyQuaternion(this._quatInverse),t.copy(this.target).add(_v),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let r=null;if(this.object.isPerspectiveCamera){const a=_v.length();r=this._clampDistance(a*this._scale);const l=a-r;this.object.position.addScaledVector(this._dollyDirection,l),this.object.updateMatrixWorld(),s=!!l}else if(this.object.isOrthographicCamera){const a=new Vector3$1(this._mouse.x,this._mouse.y,0);a.unproject(this.object);const l=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),s=l!==this.object.zoom;const c=new Vector3$1(this._mouse.x,this._mouse.y,0);c.unproject(this.object),this.object.position.sub(c).add(a),this.object.updateMatrixWorld(),r=_v.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;r!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(r).add(this.object.position):(_ray$1.origin.copy(this.object.position),_ray$1.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(_ray$1.direction))<_TILT_LIMIT?this.object.lookAt(this.target):(_plane$1.setFromNormalAndCoplanarPoint(this.object.up,this.target),_ray$1.intersectPlane(_plane$1,this.target))))}else if(this.object.isOrthographicCamera){const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),r!==this.object.zoom&&(this.object.updateProjectionMatrix(),s=!0)}return this._scale=1,this._performCursorZoom=!1,s||this._lastPosition.distanceToSquared(this.object.position)>_EPS||8*(1-this._lastQuaternion.dot(this.object.quaternion))>_EPS||this._lastTargetPosition.distanceToSquared(this.target)>_EPS?(this.dispatchEvent(_changeEvent),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?_twoPI/60*this.autoRotateSpeed*e:_twoPI/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){_v.setFromMatrixColumn(t,0),_v.multiplyScalar(-e),this._panOffset.add(_v)}_panUp(e,t){this.screenSpacePanning===!0?_v.setFromMatrixColumn(t,1):(_v.setFromMatrixColumn(t,0),_v.crossVectors(this.object.up,_v)),_v.multiplyScalar(e),this._panOffset.add(_v)}_pan(e,t){const o=this.domElement;if(this.object.isPerspectiveCamera){const i=this.object.position;_v.copy(i).sub(this.target);let s=_v.length();s*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*s/o.clientHeight,this.object.matrix),this._panUp(2*t*s/o.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/o.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/o.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const o=this.domElement.getBoundingClientRect(),i=e-o.left,s=t-o.top,r=o.width,a=o.height;this._mouse.x=i/r*2-1,this._mouse.y=-(s/a)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(_twoPI*this._rotateDelta.x/t.clientHeight),this._rotateUp(_twoPI*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(_twoPI*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-_twoPI*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(_twoPI*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-_twoPI*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),o=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._rotateStart.set(o,i)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),o=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panStart.set(o,i)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),o=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(o*o+i*i);this._dollyStart.set(0,s)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const o=this._getSecondPointerPosition(e),i=.5*(e.pageX+o.x),s=.5*(e.pageY+o.y);this._rotateEnd.set(i,s)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(_twoPI*this._rotateDelta.x/t.clientHeight),this._rotateUp(_twoPI*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),o=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);this._panEnd.set(o,i)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),o=e.pageX-t.x,i=e.pageY-t.y,s=Math.sqrt(o*o+i*i);this._dollyEnd.set(0,s),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const r=(e.pageX+t.x)*.5,a=(e.pageY+t.y)*.5;this._updateZoomParameters(r,a)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new Vector2$1,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,o={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:o.deltaY*=16;break;case 2:o.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(o.deltaY*=10),o}}function onPointerDown$1(n){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(n.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(n)&&(this._addPointer(n),n.pointerType==="touch"?this._onTouchStart(n):this._onMouseDown(n)))}function onPointerMove$1(n){this.enabled!==!1&&(n.pointerType==="touch"?this._onTouchMove(n):this._onMouseMove(n))}function onPointerUp(n){switch(this._removePointer(n),this._pointers.length){case 0:this.domElement.releasePointerCapture(n.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(_endEvent),this.state=_STATE.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function onMouseDown(n){let e;switch(n.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case MOUSE.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(n),this.state=_STATE.DOLLY;break;case MOUSE.ROTATE:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=_STATE.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=_STATE.ROTATE}break;case MOUSE.PAN:if(n.ctrlKey||n.metaKey||n.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(n),this.state=_STATE.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(n),this.state=_STATE.PAN}break;default:this.state=_STATE.NONE}this.state!==_STATE.NONE&&this.dispatchEvent(_startEvent)}function onMouseMove(n){switch(this.state){case _STATE.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(n);break;case _STATE.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(n);break;case _STATE.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(n);break}}function onMouseWheel(n){this.enabled===!1||this.enableZoom===!1||this.state!==_STATE.NONE||(n.preventDefault(),this.dispatchEvent(_startEvent),this._handleMouseWheel(this._customWheelEvent(n)),this.dispatchEvent(_endEvent))}function onKeyDown$1(n){this.enabled!==!1&&this._handleKeyDown(n)}function onTouchStart(n){switch(this._trackPointer(n),this._pointers.length){case 1:switch(this.touches.ONE){case TOUCH.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(n),this.state=_STATE.TOUCH_ROTATE;break;case TOUCH.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(n),this.state=_STATE.TOUCH_PAN;break;default:this.state=_STATE.NONE}break;case 2:switch(this.touches.TWO){case TOUCH.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(n),this.state=_STATE.TOUCH_DOLLY_PAN;break;case TOUCH.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(n),this.state=_STATE.TOUCH_DOLLY_ROTATE;break;default:this.state=_STATE.NONE}break;default:this.state=_STATE.NONE}this.state!==_STATE.NONE&&this.dispatchEvent(_startEvent)}function onTouchMove(n){switch(this._trackPointer(n),this.state){case _STATE.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(n),this.update();break;case _STATE.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(n),this.update();break;case _STATE.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(n),this.update();break;case _STATE.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(n),this.update();break;default:this.state=_STATE.NONE}}function onContextMenu$1(n){this.enabled!==!1&&n.preventDefault()}function interceptControlDown(n){n.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function interceptControlUp(n){n.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function toTrianglesDrawMode(n,e){if(e===TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),n;if(e===TriangleFanDrawMode||e===TriangleStripDrawMode){let t=n.getIndex();if(t===null){const r=[],a=n.getAttribute("position");if(a!==void 0){for(let l=0;l<a.count;l++)r.push(l);n.setIndex(r),t=n.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),n}const o=t.count-2,i=[];if(e===TriangleFanDrawMode)for(let r=1;r<=o;r++)i.push(t.getX(0)),i.push(t.getX(r)),i.push(t.getX(r+1));else for(let r=0;r<o;r++)r%2===0?(i.push(t.getX(r)),i.push(t.getX(r+1)),i.push(t.getX(r+2))):(i.push(t.getX(r+2)),i.push(t.getX(r+1)),i.push(t.getX(r)));i.length/3!==o&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=n.clone();return s.setIndex(i),s.clearGroups(),s}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),n}class GLTFLoader extends Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new GLTFMaterialsClearcoatExtension(t)}),this.register(function(t){return new GLTFMaterialsDispersionExtension(t)}),this.register(function(t){return new GLTFTextureBasisUExtension(t)}),this.register(function(t){return new GLTFTextureWebPExtension(t)}),this.register(function(t){return new GLTFTextureAVIFExtension(t)}),this.register(function(t){return new GLTFMaterialsSheenExtension(t)}),this.register(function(t){return new GLTFMaterialsTransmissionExtension(t)}),this.register(function(t){return new GLTFMaterialsVolumeExtension(t)}),this.register(function(t){return new GLTFMaterialsIorExtension(t)}),this.register(function(t){return new GLTFMaterialsEmissiveStrengthExtension(t)}),this.register(function(t){return new GLTFMaterialsSpecularExtension(t)}),this.register(function(t){return new GLTFMaterialsIridescenceExtension(t)}),this.register(function(t){return new GLTFMaterialsAnisotropyExtension(t)}),this.register(function(t){return new GLTFMaterialsBumpExtension(t)}),this.register(function(t){return new GLTFLightsExtension(t)}),this.register(function(t){return new GLTFMeshoptCompression(t)}),this.register(function(t){return new GLTFMeshGpuInstancing(t)})}load(e,t,o,i){const s=this;let r;if(this.resourcePath!=="")r=this.resourcePath;else if(this.path!==""){const c=LoaderUtils.extractUrlBase(e);r=LoaderUtils.resolveURL(c,this.path)}else r=LoaderUtils.extractUrlBase(e);this.manager.itemStart(e);const a=function(c){i?i(c):console.error(c),s.manager.itemError(e),s.manager.itemEnd(e)},l=new FileLoader(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){try{s.parse(c,r,function(d){t(d),s.manager.itemEnd(e)},a)}catch(d){a(d)}},o,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,o,i){let s;const r={},a={},l=new TextDecoder;if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)if(l.decode(new Uint8Array(e,0,4))===BINARY_EXTENSION_HEADER_MAGIC){try{r[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(e)}catch(u){i&&i(u);return}s=JSON.parse(r[EXTENSIONS.KHR_BINARY_GLTF].content)}else s=JSON.parse(l.decode(e));else s=e;if(s.asset===void 0||s.asset.version[0]<2){i&&i(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new GLTFParser(s,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let d=0;d<this.pluginCallbacks.length;d++){const u=this.pluginCallbacks[d](c);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),a[u.name]=u,r[u.name]=!0}if(s.extensionsUsed)for(let d=0;d<s.extensionsUsed.length;++d){const u=s.extensionsUsed[d],f=s.extensionsRequired||[];switch(u){case EXTENSIONS.KHR_MATERIALS_UNLIT:r[u]=new GLTFMaterialsUnlitExtension;break;case EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:r[u]=new GLTFDracoMeshCompressionExtension(s,this.dracoLoader);break;case EXTENSIONS.KHR_TEXTURE_TRANSFORM:r[u]=new GLTFTextureTransformExtension;break;case EXTENSIONS.KHR_MESH_QUANTIZATION:r[u]=new GLTFMeshQuantizationExtension;break;default:f.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}c.setExtensions(r),c.setPlugins(a),c.parse(o,i)}parseAsync(e,t){const o=this;return new Promise(function(i,s){o.parse(e,t,i,s)})}}function GLTFRegistry(){let n={};return{get:function(e){return n[e]},add:function(e,t){n[e]=t},remove:function(e){delete n[e]},removeAll:function(){n={}}}}const EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class GLTFLightsExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let o=0,i=t.length;o<i;o++){const s=t[o];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const t=this.parser,o="light:"+e;let i=t.cache.get(o);if(i)return i;const s=t.json,l=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let c;const d=new Color(16777215);l.color!==void 0&&d.setRGB(l.color[0],l.color[1],l.color[2],LinearSRGBColorSpace);const u=l.range!==void 0?l.range:0;switch(l.type){case"directional":c=new DirectionalLight(d),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new PointLight(d),c.distance=u;break;case"spot":c=new SpotLight(d),c.distance=u,l.spot=l.spot||{},l.spot.innerConeAngle=l.spot.innerConeAngle!==void 0?l.spot.innerConeAngle:0,l.spot.outerConeAngle=l.spot.outerConeAngle!==void 0?l.spot.outerConeAngle:Math.PI/4,c.angle=l.spot.outerConeAngle,c.penumbra=1-l.spot.innerConeAngle/l.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+l.type)}return c.position.set(0,0,0),c.decay=2,assignExtrasToUserData(c,l),l.intensity!==void 0&&(c.intensity=l.intensity),c.name=t.createUniqueName(l.name||"light_"+e),i=Promise.resolve(c),t.cache.add(o,i),i}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,o=this.parser,s=o.json.nodes[e],a=(s.extensions&&s.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(l){return o._getNodeRef(t.cache,a,l)})}}class GLTFMaterialsUnlitExtension{constructor(){this.name=EXTENSIONS.KHR_MATERIALS_UNLIT}getMaterialType(){return MeshBasicMaterial}extendParams(e,t,o){const i=[];e.color=new Color(1,1,1),e.opacity=1;const s=t.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const r=s.baseColorFactor;e.color.setRGB(r[0],r[1],r[2],LinearSRGBColorSpace),e.opacity=r[3]}s.baseColorTexture!==void 0&&i.push(o.assignTexture(e,"map",s.baseColorTexture,SRGBColorSpace))}return Promise.all(i)}}class GLTFMaterialsEmissiveStrengthExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name].emissiveStrength;return s!==void 0&&(t.emissiveIntensity=s),Promise.resolve()}}class GLTFMaterialsClearcoatExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const o=this.parser,i=o.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&s.push(o.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&s.push(o.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(s.push(o.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new Vector2$1(a,a)}return Promise.all(s)}}class GLTFMaterialsDispersionExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_DISPERSION}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.dispersion=s.dispersion!==void 0?s.dispersion:0,Promise.resolve()}}class GLTFMaterialsIridescenceExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const o=this.parser,i=o.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&s.push(o.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&s.push(o.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(s)}}class GLTFMaterialsSheenExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_SHEEN}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const o=this.parser,i=o.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[];t.sheenColor=new Color(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=i.extensions[this.name];if(r.sheenColorFactor!==void 0){const a=r.sheenColorFactor;t.sheenColor.setRGB(a[0],a[1],a[2],LinearSRGBColorSpace)}return r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&s.push(o.assignTexture(t,"sheenColorMap",r.sheenColorTexture,SRGBColorSpace)),r.sheenRoughnessTexture!==void 0&&s.push(o.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(s)}}class GLTFMaterialsTransmissionExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const o=this.parser,i=o.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&s.push(o.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(s)}}class GLTFMaterialsVolumeExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_VOLUME}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const o=this.parser,i=o.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&s.push(o.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const a=r.attenuationColor||[1,1,1];return t.attenuationColor=new Color().setRGB(a[0],a[1],a[2],LinearSRGBColorSpace),Promise.all(s)}}class GLTFMaterialsIorExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_IOR}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const i=this.parser.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=i.extensions[this.name];return t.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class GLTFMaterialsSpecularExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_SPECULAR}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const o=this.parser,i=o.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&s.push(o.assignTexture(t,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return t.specularColor=new Color().setRGB(a[0],a[1],a[2],LinearSRGBColorSpace),r.specularColorTexture!==void 0&&s.push(o.assignTexture(t,"specularColorMap",r.specularColorTexture,SRGBColorSpace)),Promise.all(s)}}class GLTFMaterialsBumpExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.EXT_MATERIALS_BUMP}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const o=this.parser,i=o.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];return t.bumpScale=r.bumpFactor!==void 0?r.bumpFactor:1,r.bumpTexture!==void 0&&s.push(o.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(s)}}class GLTFMaterialsAnisotropyExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const o=this.parser.json.materials[e];return!o.extensions||!o.extensions[this.name]?null:MeshPhysicalMaterial}extendMaterialParams(e,t){const o=this.parser,i=o.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const s=[],r=i.extensions[this.name];return r.anisotropyStrength!==void 0&&(t.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(t.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&s.push(o.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(s)}}class GLTFTextureBasisUExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,o=t.json,i=o.textures[e];if(!i.extensions||!i.extensions[this.name])return null;const s=i.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(o.extensionsRequired&&o.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,s.source,r)}}class GLTFTextureWebPExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,o=this.parser,i=o.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const r=s.extensions[t],a=i.images[r.source];let l=o.textureLoader;if(a.uri){const c=o.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return o.loadTextureImage(e,r.source,l);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return o.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class GLTFTextureAVIFExtension{constructor(e){this.parser=e,this.name=EXTENSIONS.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){const t=this.name,o=this.parser,i=o.json,s=i.textures[e];if(!s.extensions||!s.extensions[t])return null;const r=s.extensions[t],a=i.images[r.source];let l=o.textureLoader;if(a.uri){const c=o.options.manager.getHandler(a.uri);c!==null&&(l=c)}return this.detectSupport().then(function(c){if(c)return o.loadTextureImage(e,r.source,l);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return o.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class GLTFMeshoptCompression{constructor(e){this.name=EXTENSIONS.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,o=t.bufferViews[e];if(o.extensions&&o.extensions[this.name]){const i=o.extensions[this.name],s=this.parser.getDependency("buffer",i.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return s.then(function(a){const l=i.byteOffset||0,c=i.byteLength||0,d=i.count,u=i.byteStride,f=new Uint8Array(a,l,c);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(d,u,f,i.mode,i.filter).then(function(h){return h.buffer}):r.ready.then(function(){const h=new ArrayBuffer(d*u);return r.decodeGltfBuffer(new Uint8Array(h),d,u,f,i.mode,i.filter),h})})}else return null}}class GLTFMeshGpuInstancing{constructor(e){this.name=EXTENSIONS.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,o=t.nodes[e];if(!o.extensions||!o.extensions[this.name]||o.mesh===void 0)return null;const i=t.meshes[o.mesh];for(const c of i.primitives)if(c.mode!==WEBGL_CONSTANTS.TRIANGLES&&c.mode!==WEBGL_CONSTANTS.TRIANGLE_STRIP&&c.mode!==WEBGL_CONSTANTS.TRIANGLE_FAN&&c.mode!==void 0)return null;const r=o.extensions[this.name].attributes,a=[],l={};for(const c in r)a.push(this.parser.getDependency("accessor",r[c]).then(d=>(l[c]=d,l[c])));return a.length<1?null:(a.push(this.parser.createNodeMesh(e)),Promise.all(a).then(c=>{const d=c.pop(),u=d.isGroup?d.children:[d],f=c[0].count,h=[];for(const m of u){const p=new Matrix4$1,v=new Vector3$1,g=new Quaternion$1,y=new Vector3$1(1,1,1),w=new InstancedMesh(m.geometry,m.material,f);for(let _=0;_<f;_++)l.TRANSLATION&&v.fromBufferAttribute(l.TRANSLATION,_),l.ROTATION&&g.fromBufferAttribute(l.ROTATION,_),l.SCALE&&y.fromBufferAttribute(l.SCALE,_),w.setMatrixAt(_,p.compose(v,g,y));for(const _ in l)if(_==="_COLOR_0"){const S=l[_];w.instanceColor=new InstancedBufferAttribute(S.array,S.itemSize,S.normalized)}else _!=="TRANSLATION"&&_!=="ROTATION"&&_!=="SCALE"&&m.geometry.setAttribute(_,l[_]);Object3D.prototype.copy.call(w,m),this.parser.assignFinalMaterial(w),h.push(w)}return d.isGroup?(d.clear(),d.add(...h),d):h[0]}))}}const BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};class GLTFBinaryExtension{constructor(e){this.name=EXTENSIONS.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,BINARY_EXTENSION_HEADER_LENGTH),o=new TextDecoder;if(this.header={magic:o.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-BINARY_EXTENSION_HEADER_LENGTH,s=new DataView(e,BINARY_EXTENSION_HEADER_LENGTH);let r=0;for(;r<i;){const a=s.getUint32(r,!0);r+=4;const l=s.getUint32(r,!0);if(r+=4,l===BINARY_EXTENSION_CHUNK_TYPES.JSON){const c=new Uint8Array(e,BINARY_EXTENSION_HEADER_LENGTH+r,a);this.content=o.decode(c)}else if(l===BINARY_EXTENSION_CHUNK_TYPES.BIN){const c=BINARY_EXTENSION_HEADER_LENGTH+r;this.body=e.slice(c,c+a)}r+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class GLTFDracoMeshCompressionExtension{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=EXTENSIONS.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const o=this.json,i=this.dracoLoader,s=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,a={},l={},c={};for(const d in r){const u=ATTRIBUTES[d]||d.toLowerCase();a[u]=r[d]}for(const d in e.attributes){const u=ATTRIBUTES[d]||d.toLowerCase();if(r[d]!==void 0){const f=o.accessors[e.attributes[d]],h=WEBGL_COMPONENT_TYPES[f.componentType];c[u]=h.name,l[u]=f.normalized===!0}}return t.getDependency("bufferView",s).then(function(d){return new Promise(function(u,f){i.decodeDracoFile(d,function(h){for(const m in h.attributes){const p=h.attributes[m],v=l[m];v!==void 0&&(p.normalized=v)}u(h)},a,c,LinearSRGBColorSpace,f)})})}}class GLTFTextureTransformExtension{constructor(){this.name=EXTENSIONS.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class GLTFMeshQuantizationExtension{constructor(){this.name=EXTENSIONS.KHR_MESH_QUANTIZATION}}class GLTFCubicSplineInterpolant extends Interpolant{constructor(e,t,o,i){super(e,t,o,i)}copySampleValue_(e){const t=this.resultBuffer,o=this.sampleValues,i=this.valueSize,s=e*i*3+i;for(let r=0;r!==i;r++)t[r]=o[s+r];return t}interpolate_(e,t,o,i){const s=this.resultBuffer,r=this.sampleValues,a=this.valueSize,l=a*2,c=a*3,d=i-t,u=(o-t)/d,f=u*u,h=f*u,m=e*c,p=m-c,v=-2*h+3*f,g=h-f,y=1-v,w=g-f+u;for(let _=0;_!==a;_++){const S=r[p+_+a],C=r[p+_+l]*d,A=r[m+_+a],E=r[m+_]*d;s[_]=y*S+w*C+v*A+g*E}return s}}const _q=new Quaternion$1;class GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant{interpolate_(e,t,o,i){const s=super.interpolate_(e,t,o,i);return _q.fromArray(s).normalize().toArray(s),s}}const WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:NearestFilter,9729:LinearFilter,9984:NearestMipmapNearestFilter,9985:LinearMipmapNearestFilter,9986:NearestMipmapLinearFilter,9987:LinearMipmapLinearFilter},WEBGL_WRAPPINGS={33071:ClampToEdgeWrapping,33648:MirroredRepeatWrapping,10497:RepeatWrapping},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ATTRIBUTES={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:void 0,LINEAR:InterpolateLinear,STEP:InterpolateDiscrete},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function createDefaultMaterial(n){return n.DefaultMaterial===void 0&&(n.DefaultMaterial=new MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:FrontSide})),n.DefaultMaterial}function addUnknownExtensionsToUserData(n,e,t){for(const o in t.extensions)n[o]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[o]=t.extensions[o])}function assignExtrasToUserData(n,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(n.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function addMorphTargets(n,e,t){let o=!1,i=!1,s=!1;for(let c=0,d=e.length;c<d;c++){const u=e[c];if(u.POSITION!==void 0&&(o=!0),u.NORMAL!==void 0&&(i=!0),u.COLOR_0!==void 0&&(s=!0),o&&i&&s)break}if(!o&&!i&&!s)return Promise.resolve(n);const r=[],a=[],l=[];for(let c=0,d=e.length;c<d;c++){const u=e[c];if(o){const f=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):n.attributes.position;r.push(f)}if(i){const f=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):n.attributes.normal;a.push(f)}if(s){const f=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):n.attributes.color;l.push(f)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(l)]).then(function(c){const d=c[0],u=c[1],f=c[2];return o&&(n.morphAttributes.position=d),i&&(n.morphAttributes.normal=u),s&&(n.morphAttributes.color=f),n.morphTargetsRelative=!0,n})}function updateMorphTargets(n,e){if(n.updateMorphTargets(),e.weights!==void 0)for(let t=0,o=e.weights.length;t<o;t++)n.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(n.morphTargetInfluences.length===t.length){n.morphTargetDictionary={};for(let o=0,i=t.length;o<i;o++)n.morphTargetDictionary[t[o]]=o}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function createPrimitiveKey(n){let e;const t=n.extensions&&n.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+createAttributesKey(t.attributes):e=n.indices+":"+createAttributesKey(n.attributes)+":"+n.mode,n.targets!==void 0)for(let o=0,i=n.targets.length;o<i;o++)e+=":"+createAttributesKey(n.targets[o]);return e}function createAttributesKey(n){let e="";const t=Object.keys(n).sort();for(let o=0,i=t.length;o<i;o++)e+=t[o]+":"+n[t[o]]+";";return e}function getNormalizedComponentScale(n){switch(n){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function getImageURIMimeType(n){return n.search(/\.jpe?g($|\?)/i)>0||n.search(/^data\:image\/jpeg/)===0?"image/jpeg":n.search(/\.webp($|\?)/i)>0||n.search(/^data\:image\/webp/)===0?"image/webp":n.search(/\.ktx2($|\?)/i)>0||n.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const _identityMatrix=new Matrix4$1;class GLTFParser{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new GLTFRegistry,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let o=!1,i=-1,s=!1,r=-1;if(typeof navigator<"u"){const a=navigator.userAgent;o=/^((?!chrome|android).)*safari/i.test(a)===!0;const l=a.match(/Version\/(\d+)/);i=o&&l?parseInt(l[1],10):-1,s=a.indexOf("Firefox")>-1,r=s?a.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||o&&i<17||s&&r<98?this.textureLoader=new TextureLoader(this.options.manager):this.textureLoader=new ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const o=this,i=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([o.getDependencies("scene"),o.getDependencies("animation"),o.getDependencies("camera")])}).then(function(r){const a={scene:r[0][i.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:i.asset,parser:o,userData:{}};return addUnknownExtensionsToUserData(s,a,i),assignExtrasToUserData(a,i),Promise.all(o._invokeAll(function(l){return l.afterRoot&&l.afterRoot(a)})).then(function(){for(const l of a.scenes)l.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],o=this.json.meshes||[];for(let i=0,s=t.length;i<s;i++){const r=t[i].joints;for(let a=0,l=r.length;a<l;a++)e[r[a]].isBone=!0}for(let i=0,s=e.length;i<s;i++){const r=e[i];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(o[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,o){if(e.refs[t]<=1)return o;const i=o.clone(),s=(r,a)=>{const l=this.associations.get(r);l!=null&&this.associations.set(a,l);for(const[c,d]of r.children.entries())s(d,a.children[c])};return s(o,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let o=0;o<t.length;o++){const i=e(t[o]);if(i)return i}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const o=[];for(let i=0;i<t.length;i++){const s=e(t[i]);s&&o.push(s)}return o}getDependency(e,t){const o=e+":"+t;let i=this.cache.get(o);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(s){return s.loadNode&&s.loadNode(t)});break;case"mesh":i=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(s){return s.loadAnimation&&s.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(i=this._invokeOne(function(s){return s!=this&&s.getDependency&&s.getDependency(e,t)}),!i)throw new Error("Unknown type: "+e);break}this.cache.add(o,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){const o=this,i=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(i.map(function(s,r){return o.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],o=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);const i=this.options;return new Promise(function(s,r){o.load(LoaderUtils.resolveURL(t.uri,i.path),s,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(o){const i=t.byteLength||0,s=t.byteOffset||0;return o.slice(s,s+i)})}loadAccessor(e){const t=this,o=this.json,i=this.json.accessors[e];if(i.bufferView===void 0&&i.sparse===void 0){const r=WEBGL_TYPE_SIZES[i.type],a=WEBGL_COMPONENT_TYPES[i.componentType],l=i.normalized===!0,c=new a(i.count*r);return Promise.resolve(new BufferAttribute(c,r,l))}const s=[];return i.bufferView!==void 0?s.push(this.getDependency("bufferView",i.bufferView)):s.push(null),i.sparse!==void 0&&(s.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(s).then(function(r){const a=r[0],l=WEBGL_TYPE_SIZES[i.type],c=WEBGL_COMPONENT_TYPES[i.componentType],d=c.BYTES_PER_ELEMENT,u=d*l,f=i.byteOffset||0,h=i.bufferView!==void 0?o.bufferViews[i.bufferView].byteStride:void 0,m=i.normalized===!0;let p,v;if(h&&h!==u){const g=Math.floor(f/h),y="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+g+":"+i.count;let w=t.cache.get(y);w||(p=new c(a,g*h,i.count*h/d),w=new InterleavedBuffer(p,h/d),t.cache.add(y,w)),v=new InterleavedBufferAttribute(w,l,f%h/d,m)}else a===null?p=new c(i.count*l):p=new c(a,f,i.count*l),v=new BufferAttribute(p,l,m);if(i.sparse!==void 0){const g=WEBGL_TYPE_SIZES.SCALAR,y=WEBGL_COMPONENT_TYPES[i.sparse.indices.componentType],w=i.sparse.indices.byteOffset||0,_=i.sparse.values.byteOffset||0,S=new y(r[1],w,i.sparse.count*g),C=new c(r[2],_,i.sparse.count*l);a!==null&&(v=new BufferAttribute(v.array.slice(),v.itemSize,v.normalized)),v.normalized=!1;for(let A=0,E=S.length;A<E;A++){const k=S[A];if(v.setX(k,C[A*l]),l>=2&&v.setY(k,C[A*l+1]),l>=3&&v.setZ(k,C[A*l+2]),l>=4&&v.setW(k,C[A*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}v.normalized=m}return v})}loadTexture(e){const t=this.json,o=this.options,s=t.textures[e].source,r=t.images[s];let a=this.textureLoader;if(r.uri){const l=o.manager.getHandler(r.uri);l!==null&&(a=l)}return this.loadTextureImage(e,s,a)}loadTextureImage(e,t,o){const i=this,s=this.json,r=s.textures[e],a=s.images[t],l=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[l])return this.textureCache[l];const c=this.loadImageSource(t,o).then(function(d){d.flipY=!1,d.name=r.name||a.name||"",d.name===""&&typeof a.uri=="string"&&a.uri.startsWith("data:image/")===!1&&(d.name=a.uri);const f=(s.samplers||{})[r.sampler]||{};return d.magFilter=WEBGL_FILTERS[f.magFilter]||LinearFilter,d.minFilter=WEBGL_FILTERS[f.minFilter]||LinearMipmapLinearFilter,d.wrapS=WEBGL_WRAPPINGS[f.wrapS]||RepeatWrapping,d.wrapT=WEBGL_WRAPPINGS[f.wrapT]||RepeatWrapping,d.generateMipmaps=!d.isCompressedTexture&&d.minFilter!==NearestFilter&&d.minFilter!==LinearFilter,i.associations.set(d,{textures:e}),d}).catch(function(){return null});return this.textureCache[l]=c,c}loadImageSource(e,t){const o=this,i=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const r=i.images[e],a=self.URL||self.webkitURL;let l=r.uri||"",c=!1;if(r.bufferView!==void 0)l=o.getDependency("bufferView",r.bufferView).then(function(u){c=!0;const f=new Blob([u],{type:r.mimeType});return l=a.createObjectURL(f),l});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const d=Promise.resolve(l).then(function(u){return new Promise(function(f,h){let m=f;t.isImageBitmapLoader===!0&&(m=function(p){const v=new Texture(p);v.needsUpdate=!0,f(v)}),t.load(LoaderUtils.resolveURL(u,s.path),m,void 0,h)})}).then(function(u){return c===!0&&a.revokeObjectURL(l),assignExtrasToUserData(u,r),u.userData.mimeType=r.mimeType||getImageURIMimeType(r.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",l),u});return this.sourceCache[e]=d,d}assignTexture(e,t,o,i){const s=this;return this.getDependency("texture",o.index).then(function(r){if(!r)return null;if(o.texCoord!==void 0&&o.texCoord>0&&(r=r.clone(),r.channel=o.texCoord),s.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]){const a=o.extensions!==void 0?o.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const l=s.associations.get(r);r=s.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),s.associations.set(r,l)}}return i!==void 0&&(r.colorSpace=i),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let o=e.material;const i=t.attributes.tangent===void 0,s=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+o.uuid;let l=this.cache.get(a);l||(l=new PointsMaterial,Material.prototype.copy.call(l,o),l.color.copy(o.color),l.map=o.map,l.sizeAttenuation=!1,this.cache.add(a,l)),o=l}else if(e.isLine){const a="LineBasicMaterial:"+o.uuid;let l=this.cache.get(a);l||(l=new LineBasicMaterial,Material.prototype.copy.call(l,o),l.color.copy(o.color),l.map=o.map,this.cache.add(a,l)),o=l}if(i||s||r){let a="ClonedMaterial:"+o.uuid+":";i&&(a+="derivative-tangents:"),s&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let l=this.cache.get(a);l||(l=o.clone(),s&&(l.vertexColors=!0),r&&(l.flatShading=!0),i&&(l.normalScale&&(l.normalScale.y*=-1),l.clearcoatNormalScale&&(l.clearcoatNormalScale.y*=-1)),this.cache.add(a,l),this.associations.set(l,this.associations.get(o))),o=l}e.material=o}getMaterialType(){return MeshStandardMaterial}loadMaterial(e){const t=this,o=this.json,i=this.extensions,s=o.materials[e];let r;const a={},l=s.extensions||{},c=[];if(l[EXTENSIONS.KHR_MATERIALS_UNLIT]){const u=i[EXTENSIONS.KHR_MATERIALS_UNLIT];r=u.getMaterialType(),c.push(u.extendParams(a,s,t))}else{const u=s.pbrMetallicRoughness||{};if(a.color=new Color(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const f=u.baseColorFactor;a.color.setRGB(f[0],f[1],f[2],LinearSRGBColorSpace),a.opacity=f[3]}u.baseColorTexture!==void 0&&c.push(t.assignTexture(a,"map",u.baseColorTexture,SRGBColorSpace)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),c.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),r=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}s.doubleSided===!0&&(a.side=DoubleSide);const d=s.alphaMode||ALPHA_MODES.OPAQUE;if(d===ALPHA_MODES.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,d===ALPHA_MODES.MASK&&(a.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&r!==MeshBasicMaterial&&(c.push(t.assignTexture(a,"normalMap",s.normalTexture)),a.normalScale=new Vector2$1(1,1),s.normalTexture.scale!==void 0)){const u=s.normalTexture.scale;a.normalScale.set(u,u)}if(s.occlusionTexture!==void 0&&r!==MeshBasicMaterial&&(c.push(t.assignTexture(a,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&r!==MeshBasicMaterial){const u=s.emissiveFactor;a.emissive=new Color().setRGB(u[0],u[1],u[2],LinearSRGBColorSpace)}return s.emissiveTexture!==void 0&&r!==MeshBasicMaterial&&c.push(t.assignTexture(a,"emissiveMap",s.emissiveTexture,SRGBColorSpace)),Promise.all(c).then(function(){const u=new r(a);return s.name&&(u.name=s.name),assignExtrasToUserData(u,s),t.associations.set(u,{materials:e}),s.extensions&&addUnknownExtensionsToUserData(i,u,s),u})}createUniqueName(e){const t=PropertyBinding.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,o=this.extensions,i=this.primitiveCache;function s(a){return o[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(l){return addPrimitiveAttributes(l,a,t)})}const r=[];for(let a=0,l=e.length;a<l;a++){const c=e[a],d=createPrimitiveKey(c),u=i[d];if(u)r.push(u.promise);else{let f;c.extensions&&c.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]?f=s(c):f=addPrimitiveAttributes(new BufferGeometry,c,t),i[d]={primitive:c,promise:f},r.push(f)}}return Promise.all(r)}loadMesh(e){const t=this,o=this.json,i=this.extensions,s=o.meshes[e],r=s.primitives,a=[];for(let l=0,c=r.length;l<c;l++){const d=r[l].material===void 0?createDefaultMaterial(this.cache):this.getDependency("material",r[l].material);a.push(d)}return a.push(t.loadGeometries(r)),Promise.all(a).then(function(l){const c=l.slice(0,l.length-1),d=l[l.length-1],u=[];for(let h=0,m=d.length;h<m;h++){const p=d[h],v=r[h];let g;const y=c[h];if(v.mode===WEBGL_CONSTANTS.TRIANGLES||v.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||v.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||v.mode===void 0)g=s.isSkinnedMesh===!0?new SkinnedMesh(p,y):new Mesh(p,y),g.isSkinnedMesh===!0&&g.normalizeSkinWeights(),v.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP?g.geometry=toTrianglesDrawMode(g.geometry,TriangleStripDrawMode):v.mode===WEBGL_CONSTANTS.TRIANGLE_FAN&&(g.geometry=toTrianglesDrawMode(g.geometry,TriangleFanDrawMode));else if(v.mode===WEBGL_CONSTANTS.LINES)g=new LineSegments(p,y);else if(v.mode===WEBGL_CONSTANTS.LINE_STRIP)g=new Line(p,y);else if(v.mode===WEBGL_CONSTANTS.LINE_LOOP)g=new LineLoop(p,y);else if(v.mode===WEBGL_CONSTANTS.POINTS)g=new Points(p,y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+v.mode);Object.keys(g.geometry.morphAttributes).length>0&&updateMorphTargets(g,s),g.name=t.createUniqueName(s.name||"mesh_"+e),assignExtrasToUserData(g,s),v.extensions&&addUnknownExtensionsToUserData(i,g,v),t.assignFinalMaterial(g),u.push(g)}for(let h=0,m=u.length;h<m;h++)t.associations.set(u[h],{meshes:e,primitives:h});if(u.length===1)return s.extensions&&addUnknownExtensionsToUserData(i,u[0],s),u[0];const f=new Group;s.extensions&&addUnknownExtensionsToUserData(i,f,s),t.associations.set(f,{meshes:e});for(let h=0,m=u.length;h<m;h++)f.add(u[h]);return f})}loadCamera(e){let t;const o=this.json.cameras[e],i=o[o.type];if(!i){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return o.type==="perspective"?t=new PerspectiveCamera(MathUtils$1.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):o.type==="orthographic"&&(t=new OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),o.name&&(t.name=this.createUniqueName(o.name)),assignExtrasToUserData(t,o),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],o=[];for(let i=0,s=t.joints.length;i<s;i++)o.push(this._loadNodeShallow(t.joints[i]));return t.inverseBindMatrices!==void 0?o.push(this.getDependency("accessor",t.inverseBindMatrices)):o.push(null),Promise.all(o).then(function(i){const s=i.pop(),r=i,a=[],l=[];for(let c=0,d=r.length;c<d;c++){const u=r[c];if(u){a.push(u);const f=new Matrix4$1;s!==null&&f.fromArray(s.array,c*16),l.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[c])}return new Skeleton(a,l)})}loadAnimation(e){const t=this.json,o=this,i=t.animations[e],s=i.name?i.name:"animation_"+e,r=[],a=[],l=[],c=[],d=[];for(let u=0,f=i.channels.length;u<f;u++){const h=i.channels[u],m=i.samplers[h.sampler],p=h.target,v=p.node,g=i.parameters!==void 0?i.parameters[m.input]:m.input,y=i.parameters!==void 0?i.parameters[m.output]:m.output;p.node!==void 0&&(r.push(this.getDependency("node",v)),a.push(this.getDependency("accessor",g)),l.push(this.getDependency("accessor",y)),c.push(m),d.push(p))}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(l),Promise.all(c),Promise.all(d)]).then(function(u){const f=u[0],h=u[1],m=u[2],p=u[3],v=u[4],g=[];for(let y=0,w=f.length;y<w;y++){const _=f[y],S=h[y],C=m[y],A=p[y],E=v[y];if(_===void 0)continue;_.updateMatrix&&_.updateMatrix();const k=o._createAnimationTracks(_,S,C,A,E);if(k)for(let I=0;I<k.length;I++)g.push(k[I])}return new AnimationClip(s,void 0,g)})}createNodeMesh(e){const t=this.json,o=this,i=t.nodes[e];return i.mesh===void 0?null:o.getDependency("mesh",i.mesh).then(function(s){const r=o._getNodeRef(o.meshCache,i.mesh,s);return i.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let l=0,c=i.weights.length;l<c;l++)a.morphTargetInfluences[l]=i.weights[l]}),r})}loadNode(e){const t=this.json,o=this,i=t.nodes[e],s=o._loadNodeShallow(e),r=[],a=i.children||[];for(let c=0,d=a.length;c<d;c++)r.push(o.getDependency("node",a[c]));const l=i.skin===void 0?Promise.resolve(null):o.getDependency("skin",i.skin);return Promise.all([s,Promise.all(r),l]).then(function(c){const d=c[0],u=c[1],f=c[2];f!==null&&d.traverse(function(h){h.isSkinnedMesh&&h.bind(f,_identityMatrix)});for(let h=0,m=u.length;h<m;h++)d.add(u[h]);return d})}_loadNodeShallow(e){const t=this.json,o=this.extensions,i=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const s=t.nodes[e],r=s.name?i.createUniqueName(s.name):"",a=[],l=i._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return l&&a.push(l),s.camera!==void 0&&a.push(i.getDependency("camera",s.camera).then(function(c){return i._getNodeRef(i.cameraCache,s.camera,c)})),i._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){a.push(c)}),this.nodeCache[e]=Promise.all(a).then(function(c){let d;if(s.isBone===!0?d=new Bone:c.length>1?d=new Group:c.length===1?d=c[0]:d=new Object3D,d!==c[0])for(let u=0,f=c.length;u<f;u++)d.add(c[u]);if(s.name&&(d.userData.name=s.name,d.name=r),assignExtrasToUserData(d,s),s.extensions&&addUnknownExtensionsToUserData(o,d,s),s.matrix!==void 0){const u=new Matrix4$1;u.fromArray(s.matrix),d.applyMatrix4(u)}else s.translation!==void 0&&d.position.fromArray(s.translation),s.rotation!==void 0&&d.quaternion.fromArray(s.rotation),s.scale!==void 0&&d.scale.fromArray(s.scale);return i.associations.has(d)||i.associations.set(d,{}),i.associations.get(d).nodes=e,d}),this.nodeCache[e]}loadScene(e){const t=this.extensions,o=this.json.scenes[e],i=this,s=new Group;o.name&&(s.name=i.createUniqueName(o.name)),assignExtrasToUserData(s,o),o.extensions&&addUnknownExtensionsToUserData(t,s,o);const r=o.nodes||[],a=[];for(let l=0,c=r.length;l<c;l++)a.push(i.getDependency("node",r[l]));return Promise.all(a).then(function(l){for(let d=0,u=l.length;d<u;d++)s.add(l[d]);const c=d=>{const u=new Map;for(const[f,h]of i.associations)(f instanceof Material||f instanceof Texture)&&u.set(f,h);return d.traverse(f=>{const h=i.associations.get(f);h!=null&&u.set(f,h)}),u};return i.associations=c(s),s})}_createAnimationTracks(e,t,o,i,s){const r=[],a=e.name?e.name:e.uuid,l=[];PATH_PROPERTIES[s.path]===PATH_PROPERTIES.weights?e.traverse(function(f){f.morphTargetInfluences&&l.push(f.name?f.name:f.uuid)}):l.push(a);let c;switch(PATH_PROPERTIES[s.path]){case PATH_PROPERTIES.weights:c=NumberKeyframeTrack;break;case PATH_PROPERTIES.rotation:c=QuaternionKeyframeTrack;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:c=VectorKeyframeTrack;break;default:switch(o.itemSize){case 1:c=NumberKeyframeTrack;break;case 2:case 3:default:c=VectorKeyframeTrack;break}break}const d=i.interpolation!==void 0?INTERPOLATION[i.interpolation]:InterpolateLinear,u=this._getArrayFromAccessor(o);for(let f=0,h=l.length;f<h;f++){const m=new c(l[f]+"."+PATH_PROPERTIES[s.path],t.array,u,d);i.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),r.push(m)}return r}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const o=getNormalizedComponentScale(t.constructor),i=new Float32Array(t.length);for(let s=0,r=t.length;s<r;s++)i[s]=t[s]*o;t=i}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(o){const i=this instanceof QuaternionKeyframeTrack?GLTFCubicSplineQuaternionInterpolant:GLTFCubicSplineInterpolant;return new i(this.times,this.values,this.getValueSize()/3,o)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function computeBounds(n,e,t){const o=e.attributes,i=new Box3;if(o.POSITION!==void 0){const a=t.json.accessors[o.POSITION],l=a.min,c=a.max;if(l!==void 0&&c!==void 0){if(i.set(new Vector3$1(l[0],l[1],l[2]),new Vector3$1(c[0],c[1],c[2])),a.normalized){const d=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[a.componentType]);i.min.multiplyScalar(d),i.max.multiplyScalar(d)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const a=new Vector3$1,l=new Vector3$1;for(let c=0,d=s.length;c<d;c++){const u=s[c];if(u.POSITION!==void 0){const f=t.json.accessors[u.POSITION],h=f.min,m=f.max;if(h!==void 0&&m!==void 0){if(l.setX(Math.max(Math.abs(h[0]),Math.abs(m[0]))),l.setY(Math.max(Math.abs(h[1]),Math.abs(m[1]))),l.setZ(Math.max(Math.abs(h[2]),Math.abs(m[2]))),f.normalized){const p=getNormalizedComponentScale(WEBGL_COMPONENT_TYPES[f.componentType]);l.multiplyScalar(p)}a.max(l)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}i.expandByVector(a)}n.boundingBox=i;const r=new Sphere;i.getCenter(r.center),r.radius=i.min.distanceTo(i.max)/2,n.boundingSphere=r}function addPrimitiveAttributes(n,e,t){const o=e.attributes,i=[];function s(r,a){return t.getDependency("accessor",r).then(function(l){n.setAttribute(a,l)})}for(const r in o){const a=ATTRIBUTES[r]||r.toLowerCase();a in n.attributes||i.push(s(o[r],a))}if(e.indices!==void 0&&!n.index){const r=t.getDependency("accessor",e.indices).then(function(a){n.setIndex(a)});i.push(r)}return ColorManagement.workingColorSpace!==LinearSRGBColorSpace&&"COLOR_0"in o&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${ColorManagement.workingColorSpace}" not supported.`),assignExtrasToUserData(n,e),computeBounds(n,e,t),Promise.all(i).then(function(){return e.targets!==void 0?addMorphTargets(n,e.targets,t):n})}class VRButton{static createButton(e,t={}){const o=document.createElement("button");function i(){let c=null;async function d(h){h.addEventListener("end",u),await e.xr.setSession(h),o.textContent="EXIT VR",c=h}function u(){c.removeEventListener("end",u),o.textContent="ENTER VR",c=null}o.style.display="",o.style.cursor="pointer",o.style.left="calc(50% - 50px)",o.style.width="100px",o.textContent="ENTER VR";const f={...t,optionalFeatures:["local-floor","bounded-floor","layers",...t.optionalFeatures||[]]};o.onmouseenter=function(){o.style.opacity="1.0"},o.onmouseleave=function(){o.style.opacity="0.5"},o.onclick=function(){c===null?navigator.xr.requestSession("immersive-vr",f).then(d):(c.end(),navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",f).then(d).catch(h=>{console.warn(h)}))},navigator.xr.offerSession!==void 0&&navigator.xr.offerSession("immersive-vr",f).then(d).catch(h=>{console.warn(h)})}function s(){o.style.display="",o.style.cursor="auto",o.style.left="calc(50% - 75px)",o.style.width="150px",o.onmouseenter=null,o.onmouseleave=null,o.onclick=null}function r(){s(),o.textContent="VR NOT SUPPORTED"}function a(c){s(),console.warn("Exception when trying to call xr.isSessionSupported",c),o.textContent="VR NOT ALLOWED"}function l(c){c.style.position="absolute",c.style.bottom="20px",c.style.padding="12px 6px",c.style.border="1px solid #fff",c.style.borderRadius="4px",c.style.background="rgba(0,0,0,0.1)",c.style.color="#fff",c.style.font="normal 13px sans-serif",c.style.textAlign="center",c.style.opacity="0.5",c.style.outline="none",c.style.zIndex="999"}if("xr"in navigator)return o.id="VRButton",o.style.display="none",l(o),navigator.xr.isSessionSupported("immersive-vr").then(function(c){c?i():r(),c&&VRButton.xrSessionIsGranted&&o.click()}).catch(a),o;{const c=document.createElement("a");return window.isSecureContext===!1?(c.href=document.location.href.replace(/^http:/,"https:"),c.innerHTML="WEBXR NEEDS HTTPS"):(c.href="https://immersiveweb.dev/",c.innerHTML="WEBXR NOT AVAILABLE"),c.style.left="calc(50% - 90px)",c.style.width="180px",c.style.textDecoration="none",l(c),c}}static registerSessionGrantedListener(){if(typeof navigator<"u"&&"xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",()=>{VRButton.xrSessionIsGranted=!0})}}}VRButton.xrSessionIsGranted=!1;VRButton.registerSessionGrantedListener();function _assertThisInitialized(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function _inheritsLoose(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.__proto__=e}/*!
 * GSAP 3.13.0
 * https://gsap.com
 *
 * @license Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var _config={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},_defaults={duration:.5,overwrite:!1,delay:0},_suppressOverwrites,_reverting$1,_context,_bigNum$1=1e8,_tinyNum=1/_bigNum$1,_2PI=Math.PI*2,_HALF_PI=_2PI/4,_gsID=0,_sqrt=Math.sqrt,_cos=Math.cos,_sin=Math.sin,_isString=function(e){return typeof e=="string"},_isFunction=function(e){return typeof e=="function"},_isNumber=function(e){return typeof e=="number"},_isUndefined=function(e){return typeof e>"u"},_isObject=function(e){return typeof e=="object"},_isNotFalse=function(e){return e!==!1},_windowExists$1=function(){return typeof window<"u"},_isFuncOrString=function(e){return _isFunction(e)||_isString(e)},_isTypedArray=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},_isArray=Array.isArray,_strictNumExp=/(?:-?\.?\d|\.)+/gi,_numExp=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,_numWithUnitExp=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,_complexStringNumExp=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,_relExp=/[+-]=-?[.\d]+/,_delimitedValueExp=/[^,'"\[\]\s]+/gi,_unitExp=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,_globalTimeline,_win$1,_coreInitted,_doc$1,_globals={},_installScope={},_coreReady,_install=function(e){return(_installScope=_merge(e,_globals))&&gsap},_missingPlugin=function(e,t){return console.warn("Invalid property",e,"set to",t,"Missing plugin? gsap.registerPlugin()")},_warn=function(e,t){return!t&&console.warn(e)},_addGlobal=function(e,t){return e&&(_globals[e]=t)&&_installScope&&(_installScope[e]=t)||_globals},_emptyFunc=function(){return 0},_startAtRevertConfig={suppressEvents:!0,isStart:!0,kill:!1},_revertConfigNoKill={suppressEvents:!0,kill:!1},_revertConfig={suppressEvents:!0},_reservedProps={},_lazyTweens=[],_lazyLookup={},_lastRenderedFrame,_plugins={},_effects={},_nextGCFrame=30,_harnessPlugins=[],_callbackNames="",_harness=function(e){var t=e[0],o,i;if(_isObject(t)||_isFunction(t)||(e=[e]),!(o=(t._gsap||{}).harness)){for(i=_harnessPlugins.length;i--&&!_harnessPlugins[i].targetTest(t););o=_harnessPlugins[i]}for(i=e.length;i--;)e[i]&&(e[i]._gsap||(e[i]._gsap=new GSCache(e[i],o)))||e.splice(i,1);return e},_getCache=function(e){return e._gsap||_harness(toArray(e))[0]._gsap},_getProperty=function(e,t,o){return(o=e[t])&&_isFunction(o)?e[t]():_isUndefined(o)&&e.getAttribute&&e.getAttribute(t)||o},_forEachName=function(e,t){return(e=e.split(",")).forEach(t)||e},_round=function(e){return Math.round(e*1e5)/1e5||0},_roundPrecise=function(e){return Math.round(e*1e7)/1e7||0},_parseRelative=function(e,t){var o=t.charAt(0),i=parseFloat(t.substr(2));return e=parseFloat(e),o==="+"?e+i:o==="-"?e-i:o==="*"?e*i:e/i},_arrayContainsAny=function(e,t){for(var o=t.length,i=0;e.indexOf(t[i])<0&&++i<o;);return i<o},_lazyRender=function(){var e=_lazyTweens.length,t=_lazyTweens.slice(0),o,i;for(_lazyLookup={},_lazyTweens.length=0,o=0;o<e;o++)i=t[o],i&&i._lazy&&(i.render(i._lazy[0],i._lazy[1],!0)._lazy=0)},_isRevertWorthy=function(e){return!!(e._initted||e._startAt||e.add)},_lazySafeRender=function(e,t,o,i){_lazyTweens.length&&!_reverting$1&&_lazyRender(),e.render(t,o,!!(_reverting$1&&t<0&&_isRevertWorthy(e))),_lazyTweens.length&&!_reverting$1&&_lazyRender()},_numericIfPossible=function(e){var t=parseFloat(e);return(t||t===0)&&(e+"").match(_delimitedValueExp).length<2?t:_isString(e)?e.trim():e},_passThrough=function(e){return e},_setDefaults=function(e,t){for(var o in t)o in e||(e[o]=t[o]);return e},_setKeyframeDefaults=function(e){return function(t,o){for(var i in o)i in t||i==="duration"&&e||i==="ease"||(t[i]=o[i])}},_merge=function(e,t){for(var o in t)e[o]=t[o];return e},_mergeDeep=function n(e,t){for(var o in t)o!=="__proto__"&&o!=="constructor"&&o!=="prototype"&&(e[o]=_isObject(t[o])?n(e[o]||(e[o]={}),t[o]):t[o]);return e},_copyExcluding=function(e,t){var o={},i;for(i in e)i in t||(o[i]=e[i]);return o},_inheritDefaults=function(e){var t=e.parent||_globalTimeline,o=e.keyframes?_setKeyframeDefaults(_isArray(e.keyframes)):_setDefaults;if(_isNotFalse(e.inherit))for(;t;)o(e,t.vars.defaults),t=t.parent||t._dp;return e},_arraysMatch=function(e,t){for(var o=e.length,i=o===t.length;i&&o--&&e[o]===t[o];);return o<0},_addLinkedListItem=function(e,t,o,i,s){var r=e[i],a;if(s)for(a=t[s];r&&r[s]>a;)r=r._prev;return r?(t._next=r._next,r._next=t):(t._next=e[o],e[o]=t),t._next?t._next._prev=t:e[i]=t,t._prev=r,t.parent=t._dp=e,t},_removeLinkedListItem=function(e,t,o,i){o===void 0&&(o="_first"),i===void 0&&(i="_last");var s=t._prev,r=t._next;s?s._next=r:e[o]===t&&(e[o]=r),r?r._prev=s:e[i]===t&&(e[i]=s),t._next=t._prev=t.parent=null},_removeFromParent=function(e,t){e.parent&&(!t||e.parent.autoRemoveChildren)&&e.parent.remove&&e.parent.remove(e),e._act=0},_uncache=function(e,t){if(e&&(!t||t._end>e._dur||t._start<0))for(var o=e;o;)o._dirty=1,o=o.parent;return e},_recacheAncestors=function(e){for(var t=e.parent;t&&t.parent;)t._dirty=1,t.totalDuration(),t=t.parent;return e},_rewindStartAt=function(e,t,o,i){return e._startAt&&(_reverting$1?e._startAt.revert(_revertConfigNoKill):e.vars.immediateRender&&!e.vars.autoRevert||e._startAt.render(t,!0,i))},_hasNoPausedAncestors=function n(e){return!e||e._ts&&n(e.parent)},_elapsedCycleDuration=function(e){return e._repeat?_animationCycle(e._tTime,e=e.duration()+e._rDelay)*e:0},_animationCycle=function(e,t){var o=Math.floor(e=_roundPrecise(e/t));return e&&o===e?o-1:o},_parentToChildTotalTime=function(e,t){return(e-t._start)*t._ts+(t._ts>=0?0:t._dirty?t.totalDuration():t._tDur)},_setEnd=function(e){return e._end=_roundPrecise(e._start+(e._tDur/Math.abs(e._ts||e._rts||_tinyNum)||0))},_alignPlayhead=function(e,t){var o=e._dp;return o&&o.smoothChildTiming&&e._ts&&(e._start=_roundPrecise(o._time-(e._ts>0?t/e._ts:((e._dirty?e.totalDuration():e._tDur)-t)/-e._ts)),_setEnd(e),o._dirty||_uncache(o,e)),e},_postAddChecks=function(e,t){var o;if((t._time||!t._dur&&t._initted||t._start<e._time&&(t._dur||!t.add))&&(o=_parentToChildTotalTime(e.rawTime(),t),(!t._dur||_clamp(0,t.totalDuration(),o)-t._tTime>_tinyNum)&&t.render(o,!0)),_uncache(e,t)._dp&&e._initted&&e._time>=e._dur&&e._ts){if(e._dur<e.duration())for(o=e;o._dp;)o.rawTime()>=0&&o.totalTime(o._tTime),o=o._dp;e._zTime=-_tinyNum}},_addToTimeline=function(e,t,o,i){return t.parent&&_removeFromParent(t),t._start=_roundPrecise((_isNumber(o)?o:o||e!==_globalTimeline?_parsePosition(e,o,t):e._time)+t._delay),t._end=_roundPrecise(t._start+(t.totalDuration()/Math.abs(t.timeScale())||0)),_addLinkedListItem(e,t,"_first","_last",e._sort?"_start":0),_isFromOrFromStart(t)||(e._recent=t),i||_postAddChecks(e,t),e._ts<0&&_alignPlayhead(e,e._tTime),e},_scrollTrigger=function(e,t){return(_globals.ScrollTrigger||_missingPlugin("scrollTrigger",t))&&_globals.ScrollTrigger.create(t,e)},_attemptInitTween=function(e,t,o,i,s){if(_initTween(e,t,s),!e._initted)return 1;if(!o&&e._pt&&!_reverting$1&&(e._dur&&e.vars.lazy!==!1||!e._dur&&e.vars.lazy)&&_lastRenderedFrame!==_ticker.frame)return _lazyTweens.push(e),e._lazy=[s,i],1},_parentPlayheadIsBeforeStart=function n(e){var t=e.parent;return t&&t._ts&&t._initted&&!t._lock&&(t.rawTime()<0||n(t))},_isFromOrFromStart=function(e){var t=e.data;return t==="isFromStart"||t==="isStart"},_renderZeroDurationTween=function(e,t,o,i){var s=e.ratio,r=t<0||!t&&(!e._start&&_parentPlayheadIsBeforeStart(e)&&!(!e._initted&&_isFromOrFromStart(e))||(e._ts<0||e._dp._ts<0)&&!_isFromOrFromStart(e))?0:1,a=e._rDelay,l=0,c,d,u;if(a&&e._repeat&&(l=_clamp(0,e._tDur,t),d=_animationCycle(l,a),e._yoyo&&d&1&&(r=1-r),d!==_animationCycle(e._tTime,a)&&(s=1-r,e.vars.repeatRefresh&&e._initted&&e.invalidate())),r!==s||_reverting$1||i||e._zTime===_tinyNum||!t&&e._zTime){if(!e._initted&&_attemptInitTween(e,t,i,o,l))return;for(u=e._zTime,e._zTime=t||(o?_tinyNum:0),o||(o=t&&!u),e.ratio=r,e._from&&(r=1-r),e._time=0,e._tTime=l,c=e._pt;c;)c.r(r,c.d),c=c._next;t<0&&_rewindStartAt(e,t,o,!0),e._onUpdate&&!o&&_callback(e,"onUpdate"),l&&e._repeat&&!o&&e.parent&&_callback(e,"onRepeat"),(t>=e._tDur||t<0)&&e.ratio===r&&(r&&_removeFromParent(e,1),!o&&!_reverting$1&&(_callback(e,r?"onComplete":"onReverseComplete",!0),e._prom&&e._prom()))}else e._zTime||(e._zTime=t)},_findNextPauseTween=function(e,t,o){var i;if(o>t)for(i=e._first;i&&i._start<=o;){if(i.data==="isPause"&&i._start>t)return i;i=i._next}else for(i=e._last;i&&i._start>=o;){if(i.data==="isPause"&&i._start<t)return i;i=i._prev}},_setDuration=function(e,t,o,i){var s=e._repeat,r=_roundPrecise(t)||0,a=e._tTime/e._tDur;return a&&!i&&(e._time*=r/e._dur),e._dur=r,e._tDur=s?s<0?1e10:_roundPrecise(r*(s+1)+e._rDelay*s):r,a>0&&!i&&_alignPlayhead(e,e._tTime=e._tDur*a),e.parent&&_setEnd(e),o||_uncache(e.parent,e),e},_onUpdateTotalDuration=function(e){return e instanceof Timeline?_uncache(e):_setDuration(e,e._dur)},_zeroPosition={_start:0,endTime:_emptyFunc,totalDuration:_emptyFunc},_parsePosition=function n(e,t,o){var i=e.labels,s=e._recent||_zeroPosition,r=e.duration()>=_bigNum$1?s.endTime(!1):e._dur,a,l,c;return _isString(t)&&(isNaN(t)||t in i)?(l=t.charAt(0),c=t.substr(-1)==="%",a=t.indexOf("="),l==="<"||l===">"?(a>=0&&(t=t.replace(/=/,"")),(l==="<"?s._start:s.endTime(s._repeat>=0))+(parseFloat(t.substr(1))||0)*(c?(a<0?s:o).totalDuration()/100:1)):a<0?(t in i||(i[t]=r),i[t]):(l=parseFloat(t.charAt(a-1)+t.substr(a+1)),c&&o&&(l=l/100*(_isArray(o)?o[0]:o).totalDuration()),a>1?n(e,t.substr(0,a-1),o)+l:r+l)):t==null?r:+t},_createTweenType=function(e,t,o){var i=_isNumber(t[1]),s=(i?2:1)+(e<2?0:1),r=t[s],a,l;if(i&&(r.duration=t[1]),r.parent=o,e){for(a=r,l=o;l&&!("immediateRender"in a);)a=l.vars.defaults||{},l=_isNotFalse(l.vars.inherit)&&l.parent;r.immediateRender=_isNotFalse(a.immediateRender),e<2?r.runBackwards=1:r.startAt=t[s-1]}return new Tween(t[0],r,t[s+1])},_conditionalReturn=function(e,t){return e||e===0?t(e):t},_clamp=function(e,t,o){return o<e?e:o>t?t:o},getUnit=function(e,t){return!_isString(e)||!(t=_unitExp.exec(e))?"":t[1]},clamp$1=function(e,t,o){return _conditionalReturn(o,function(i){return _clamp(e,t,i)})},_slice=[].slice,_isArrayLike=function(e,t){return e&&_isObject(e)&&"length"in e&&(!t&&!e.length||e.length-1 in e&&_isObject(e[0]))&&!e.nodeType&&e!==_win$1},_flatten=function(e,t,o){return o===void 0&&(o=[]),e.forEach(function(i){var s;return _isString(i)&&!t||_isArrayLike(i,1)?(s=o).push.apply(s,toArray(i)):o.push(i)})||o},toArray=function(e,t,o){return _context&&!t&&_context.selector?_context.selector(e):_isString(e)&&!o&&(_coreInitted||!_wake())?_slice.call((t||_doc$1).querySelectorAll(e),0):_isArray(e)?_flatten(e,o):_isArrayLike(e)?_slice.call(e,0):e?[e]:[]},selector=function(e){return e=toArray(e)[0]||_warn("Invalid scope")||{},function(t){var o=e.current||e.nativeElement||e;return toArray(t,o.querySelectorAll?o:o===e?_warn("Invalid scope")||_doc$1.createElement("div"):e)}},shuffle=function(e){return e.sort(function(){return .5-Math.random()})},distribute=function(e){if(_isFunction(e))return e;var t=_isObject(e)?e:{each:e},o=_parseEase(t.ease),i=t.from||0,s=parseFloat(t.base)||0,r={},a=i>0&&i<1,l=isNaN(i)||a,c=t.axis,d=i,u=i;return _isString(i)?d=u={center:.5,edges:.5,end:1}[i]||0:!a&&l&&(d=i[0],u=i[1]),function(f,h,m){var p=(m||t).length,v=r[p],g,y,w,_,S,C,A,E,k;if(!v){if(k=t.grid==="auto"?0:(t.grid||[1,_bigNum$1])[1],!k){for(A=-_bigNum$1;A<(A=m[k++].getBoundingClientRect().left)&&k<p;);k<p&&k--}for(v=r[p]=[],g=l?Math.min(k,p)*d-.5:i%k,y=k===_bigNum$1?0:l?p*u/k-.5:i/k|0,A=0,E=_bigNum$1,C=0;C<p;C++)w=C%k-g,_=y-(C/k|0),v[C]=S=c?Math.abs(c==="y"?_:w):_sqrt(w*w+_*_),S>A&&(A=S),S<E&&(E=S);i==="random"&&shuffle(v),v.max=A-E,v.min=E,v.v=p=(parseFloat(t.amount)||parseFloat(t.each)*(k>p?p-1:c?c==="y"?p/k:k:Math.max(k,p/k))||0)*(i==="edges"?-1:1),v.b=p<0?s-p:s,v.u=getUnit(t.amount||t.each)||0,o=o&&p<0?_invertEase(o):o}return p=(v[f]-v.min)/v.max||0,_roundPrecise(v.b+(o?o(p):p)*v.v)+v.u}},_roundModifier=function(e){var t=Math.pow(10,((e+"").split(".")[1]||"").length);return function(o){var i=_roundPrecise(Math.round(parseFloat(o)/e)*e*t);return(i-i%1)/t+(_isNumber(o)?0:getUnit(o))}},snap=function(e,t){var o=_isArray(e),i,s;return!o&&_isObject(e)&&(i=o=e.radius||_bigNum$1,e.values?(e=toArray(e.values),(s=!_isNumber(e[0]))&&(i*=i)):e=_roundModifier(e.increment)),_conditionalReturn(t,o?_isFunction(e)?function(r){return s=e(r),Math.abs(s-r)<=i?s:r}:function(r){for(var a=parseFloat(s?r.x:r),l=parseFloat(s?r.y:0),c=_bigNum$1,d=0,u=e.length,f,h;u--;)s?(f=e[u].x-a,h=e[u].y-l,f=f*f+h*h):f=Math.abs(e[u]-a),f<c&&(c=f,d=u);return d=!i||c<=i?e[d]:r,s||d===r||_isNumber(r)?d:d+getUnit(r)}:_roundModifier(e))},random=function(e,t,o,i){return _conditionalReturn(_isArray(e)?!t:o===!0?!!(o=0):!i,function(){return _isArray(e)?e[~~(Math.random()*e.length)]:(o=o||1e-5)&&(i=o<1?Math.pow(10,(o+"").length-2):1)&&Math.floor(Math.round((e-o/2+Math.random()*(t-e+o*.99))/o)*o*i)/i})},pipe=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return function(i){return t.reduce(function(s,r){return r(s)},i)}},unitize=function(e,t){return function(o){return e(parseFloat(o))+(t||getUnit(o))}},normalize$1=function(e,t,o){return mapRange(e,t,0,1,o)},_wrapArray=function(e,t,o){return _conditionalReturn(o,function(i){return e[~~t(i)]})},wrap=function n(e,t,o){var i=t-e;return _isArray(e)?_wrapArray(e,n(0,e.length),t):_conditionalReturn(o,function(s){return(i+(s-e)%i)%i+e})},wrapYoyo=function n(e,t,o){var i=t-e,s=i*2;return _isArray(e)?_wrapArray(e,n(0,e.length-1),t):_conditionalReturn(o,function(r){return r=(s+(r-e)%s)%s||0,e+(r>i?s-r:r)})},_replaceRandom=function(e){for(var t=0,o="",i,s,r,a;~(i=e.indexOf("random(",t));)r=e.indexOf(")",i),a=e.charAt(i+7)==="[",s=e.substr(i+7,r-i-7).match(a?_delimitedValueExp:_strictNumExp),o+=e.substr(t,i-t)+random(a?s:+s[0],a?0:+s[1],+s[2]||1e-5),t=r+1;return o+e.substr(t,e.length-t)},mapRange=function(e,t,o,i,s){var r=t-e,a=i-o;return _conditionalReturn(s,function(l){return o+((l-e)/r*a||0)})},interpolate=function n(e,t,o,i){var s=isNaN(e+t)?0:function(h){return(1-h)*e+h*t};if(!s){var r=_isString(e),a={},l,c,d,u,f;if(o===!0&&(i=1)&&(o=null),r)e={p:e},t={p:t};else if(_isArray(e)&&!_isArray(t)){for(d=[],u=e.length,f=u-2,c=1;c<u;c++)d.push(n(e[c-1],e[c]));u--,s=function(m){m*=u;var p=Math.min(f,~~m);return d[p](m-p)},o=t}else i||(e=_merge(_isArray(e)?[]:{},e));if(!d){for(l in t)_addPropTween.call(a,e,l,"get",t[l]);s=function(m){return _renderPropTweens(m,a)||(r?e.p:e)}}}return _conditionalReturn(o,s)},_getLabelInDirection=function(e,t,o){var i=e.labels,s=_bigNum$1,r,a,l;for(r in i)a=i[r]-t,a<0==!!o&&a&&s>(a=Math.abs(a))&&(l=r,s=a);return l},_callback=function(e,t,o){var i=e.vars,s=i[t],r=_context,a=e._ctx,l,c,d;if(s)return l=i[t+"Params"],c=i.callbackScope||e,o&&_lazyTweens.length&&_lazyRender(),a&&(_context=a),d=l?s.apply(c,l):s.call(c),_context=r,d},_interrupt=function(e){return _removeFromParent(e),e.scrollTrigger&&e.scrollTrigger.kill(!!_reverting$1),e.progress()<1&&_callback(e,"onInterrupt"),e},_quickTween,_registerPluginQueue=[],_createPlugin=function(e){if(e)if(e=!e.name&&e.default||e,_windowExists$1()||e.headless){var t=e.name,o=_isFunction(e),i=t&&!o&&e.init?function(){this._props=[]}:e,s={init:_emptyFunc,render:_renderPropTweens,add:_addPropTween,kill:_killPropTweensOf,modifier:_addPluginModifier,rawVars:0},r={targetTest:0,get:0,getSetter:_getSetter,aliases:{},register:0};if(_wake(),e!==i){if(_plugins[t])return;_setDefaults(i,_setDefaults(_copyExcluding(e,s),r)),_merge(i.prototype,_merge(s,_copyExcluding(e,r))),_plugins[i.prop=t]=i,e.targetTest&&(_harnessPlugins.push(i),_reservedProps[t]=1),t=(t==="css"?"CSS":t.charAt(0).toUpperCase()+t.substr(1))+"Plugin"}_addGlobal(t,i),e.register&&e.register(gsap,i,PropTween)}else _registerPluginQueue.push(e)},_255=255,_colorLookup={aqua:[0,_255,_255],lime:[0,_255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,_255],navy:[0,0,128],white:[_255,_255,_255],olive:[128,128,0],yellow:[_255,_255,0],orange:[_255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[_255,0,0],pink:[_255,192,203],cyan:[0,_255,_255],transparent:[_255,_255,_255,0]},_hue=function(e,t,o){return e+=e<0?1:e>1?-1:0,(e*6<1?t+(o-t)*e*6:e<.5?o:e*3<2?t+(o-t)*(2/3-e)*6:t)*_255+.5|0},splitColor=function(e,t,o){var i=e?_isNumber(e)?[e>>16,e>>8&_255,e&_255]:0:_colorLookup.black,s,r,a,l,c,d,u,f,h,m;if(!i){if(e.substr(-1)===","&&(e=e.substr(0,e.length-1)),_colorLookup[e])i=_colorLookup[e];else if(e.charAt(0)==="#"){if(e.length<6&&(s=e.charAt(1),r=e.charAt(2),a=e.charAt(3),e="#"+s+s+r+r+a+a+(e.length===5?e.charAt(4)+e.charAt(4):"")),e.length===9)return i=parseInt(e.substr(1,6),16),[i>>16,i>>8&_255,i&_255,parseInt(e.substr(7),16)/255];e=parseInt(e.substr(1),16),i=[e>>16,e>>8&_255,e&_255]}else if(e.substr(0,3)==="hsl"){if(i=m=e.match(_strictNumExp),!t)l=+i[0]%360/360,c=+i[1]/100,d=+i[2]/100,r=d<=.5?d*(c+1):d+c-d*c,s=d*2-r,i.length>3&&(i[3]*=1),i[0]=_hue(l+1/3,s,r),i[1]=_hue(l,s,r),i[2]=_hue(l-1/3,s,r);else if(~e.indexOf("="))return i=e.match(_numExp),o&&i.length<4&&(i[3]=1),i}else i=e.match(_strictNumExp)||_colorLookup.transparent;i=i.map(Number)}return t&&!m&&(s=i[0]/_255,r=i[1]/_255,a=i[2]/_255,u=Math.max(s,r,a),f=Math.min(s,r,a),d=(u+f)/2,u===f?l=c=0:(h=u-f,c=d>.5?h/(2-u-f):h/(u+f),l=u===s?(r-a)/h+(r<a?6:0):u===r?(a-s)/h+2:(s-r)/h+4,l*=60),i[0]=~~(l+.5),i[1]=~~(c*100+.5),i[2]=~~(d*100+.5)),o&&i.length<4&&(i[3]=1),i},_colorOrderData=function(e){var t=[],o=[],i=-1;return e.split(_colorExp).forEach(function(s){var r=s.match(_numWithUnitExp)||[];t.push.apply(t,r),o.push(i+=r.length+1)}),t.c=o,t},_formatColors=function(e,t,o){var i="",s=(e+i).match(_colorExp),r=t?"hsla(":"rgba(",a=0,l,c,d,u;if(!s)return e;if(s=s.map(function(f){return(f=splitColor(f,t,1))&&r+(t?f[0]+","+f[1]+"%,"+f[2]+"%,"+f[3]:f.join(","))+")"}),o&&(d=_colorOrderData(e),l=o.c,l.join(i)!==d.c.join(i)))for(c=e.replace(_colorExp,"1").split(_numWithUnitExp),u=c.length-1;a<u;a++)i+=c[a]+(~l.indexOf(a)?s.shift()||r+"0,0,0,0)":(d.length?d:s.length?s:o).shift());if(!c)for(c=e.split(_colorExp),u=c.length-1;a<u;a++)i+=c[a]+s[a];return i+c[u]},_colorExp=function(){var n="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",e;for(e in _colorLookup)n+="|"+e+"\\b";return new RegExp(n+")","gi")}(),_hslExp=/hsl[a]?\(/,_colorStringFilter=function(e){var t=e.join(" "),o;if(_colorExp.lastIndex=0,_colorExp.test(t))return o=_hslExp.test(t),e[1]=_formatColors(e[1],o),e[0]=_formatColors(e[0],o,_colorOrderData(e[1])),!0},_tickerActive,_ticker=function(){var n=Date.now,e=500,t=33,o=n(),i=o,s=1e3/240,r=s,a=[],l,c,d,u,f,h,m=function p(v){var g=n()-i,y=v===!0,w,_,S,C;if((g>e||g<0)&&(o+=g-t),i+=g,S=i-o,w=S-r,(w>0||y)&&(C=++u.frame,f=S-u.time*1e3,u.time=S=S/1e3,r+=w+(w>=s?4:s-w),_=1),y||(l=c(p)),_)for(h=0;h<a.length;h++)a[h](S,f,C,v)};return u={time:0,frame:0,tick:function(){m(!0)},deltaRatio:function(v){return f/(1e3/(v||60))},wake:function(){_coreReady&&(!_coreInitted&&_windowExists$1()&&(_win$1=_coreInitted=window,_doc$1=_win$1.document||{},_globals.gsap=gsap,(_win$1.gsapVersions||(_win$1.gsapVersions=[])).push(gsap.version),_install(_installScope||_win$1.GreenSockGlobals||!_win$1.gsap&&_win$1||{}),_registerPluginQueue.forEach(_createPlugin)),d=typeof requestAnimationFrame<"u"&&requestAnimationFrame,l&&u.sleep(),c=d||function(v){return setTimeout(v,r-u.time*1e3+1|0)},_tickerActive=1,m(2))},sleep:function(){(d?cancelAnimationFrame:clearTimeout)(l),_tickerActive=0,c=_emptyFunc},lagSmoothing:function(v,g){e=v||1/0,t=Math.min(g||33,e)},fps:function(v){s=1e3/(v||240),r=u.time*1e3+s},add:function(v,g,y){var w=g?function(_,S,C,A){v(_,S,C,A),u.remove(w)}:v;return u.remove(v),a[y?"unshift":"push"](w),_wake(),w},remove:function(v,g){~(g=a.indexOf(v))&&a.splice(g,1)&&h>=g&&h--},_listeners:a},u}(),_wake=function(){return!_tickerActive&&_ticker.wake()},_easeMap={},_customEaseExp=/^[\d.\-M][\d.\-,\s]/,_quotesExp=/["']/g,_parseObjectInString=function(e){for(var t={},o=e.substr(1,e.length-3).split(":"),i=o[0],s=1,r=o.length,a,l,c;s<r;s++)l=o[s],a=s!==r-1?l.lastIndexOf(","):l.length,c=l.substr(0,a),t[i]=isNaN(c)?c.replace(_quotesExp,"").trim():+c,i=l.substr(a+1).trim();return t},_valueInParentheses=function(e){var t=e.indexOf("(")+1,o=e.indexOf(")"),i=e.indexOf("(",t);return e.substring(t,~i&&i<o?e.indexOf(")",o+1):o)},_configEaseFromString=function(e){var t=(e+"").split("("),o=_easeMap[t[0]];return o&&t.length>1&&o.config?o.config.apply(null,~e.indexOf("{")?[_parseObjectInString(t[1])]:_valueInParentheses(e).split(",").map(_numericIfPossible)):_easeMap._CE&&_customEaseExp.test(e)?_easeMap._CE("",e):o},_invertEase=function(e){return function(t){return 1-e(1-t)}},_propagateYoyoEase=function n(e,t){for(var o=e._first,i;o;)o instanceof Timeline?n(o,t):o.vars.yoyoEase&&(!o._yoyo||!o._repeat)&&o._yoyo!==t&&(o.timeline?n(o.timeline,t):(i=o._ease,o._ease=o._yEase,o._yEase=i,o._yoyo=t)),o=o._next},_parseEase=function(e,t){return e&&(_isFunction(e)?e:_easeMap[e]||_configEaseFromString(e))||t},_insertEase=function(e,t,o,i){o===void 0&&(o=function(l){return 1-t(1-l)}),i===void 0&&(i=function(l){return l<.5?t(l*2)/2:1-t((1-l)*2)/2});var s={easeIn:t,easeOut:o,easeInOut:i},r;return _forEachName(e,function(a){_easeMap[a]=_globals[a]=s,_easeMap[r=a.toLowerCase()]=o;for(var l in s)_easeMap[r+(l==="easeIn"?".in":l==="easeOut"?".out":".inOut")]=_easeMap[a+"."+l]=s[l]}),s},_easeInOutFromOut=function(e){return function(t){return t<.5?(1-e(1-t*2))/2:.5+e((t-.5)*2)/2}},_configElastic=function n(e,t,o){var i=t>=1?t:1,s=(o||(e?.3:.45))/(t<1?t:1),r=s/_2PI*(Math.asin(1/i)||0),a=function(d){return d===1?1:i*Math.pow(2,-10*d)*_sin((d-r)*s)+1},l=e==="out"?a:e==="in"?function(c){return 1-a(1-c)}:_easeInOutFromOut(a);return s=_2PI/s,l.config=function(c,d){return n(e,c,d)},l},_configBack=function n(e,t){t===void 0&&(t=1.70158);var o=function(r){return r?--r*r*((t+1)*r+t)+1:0},i=e==="out"?o:e==="in"?function(s){return 1-o(1-s)}:_easeInOutFromOut(o);return i.config=function(s){return n(e,s)},i};_forEachName("Linear,Quad,Cubic,Quart,Quint,Strong",function(n,e){var t=e<5?e+1:e;_insertEase(n+",Power"+(t-1),e?function(o){return Math.pow(o,t)}:function(o){return o},function(o){return 1-Math.pow(1-o,t)},function(o){return o<.5?Math.pow(o*2,t)/2:1-Math.pow((1-o)*2,t)/2})});_easeMap.Linear.easeNone=_easeMap.none=_easeMap.Linear.easeIn;_insertEase("Elastic",_configElastic("in"),_configElastic("out"),_configElastic());(function(n,e){var t=1/e,o=2*t,i=2.5*t,s=function(a){return a<t?n*a*a:a<o?n*Math.pow(a-1.5/e,2)+.75:a<i?n*(a-=2.25/e)*a+.9375:n*Math.pow(a-2.625/e,2)+.984375};_insertEase("Bounce",function(r){return 1-s(1-r)},s)})(7.5625,2.75);_insertEase("Expo",function(n){return Math.pow(2,10*(n-1))*n+n*n*n*n*n*n*(1-n)});_insertEase("Circ",function(n){return-(_sqrt(1-n*n)-1)});_insertEase("Sine",function(n){return n===1?1:-_cos(n*_HALF_PI)+1});_insertEase("Back",_configBack("in"),_configBack("out"),_configBack());_easeMap.SteppedEase=_easeMap.steps=_globals.SteppedEase={config:function(e,t){e===void 0&&(e=1);var o=1/e,i=e+(t?0:1),s=t?1:0,r=1-_tinyNum;return function(a){return((i*_clamp(0,r,a)|0)+s)*o}}};_defaults.ease=_easeMap["quad.out"];_forEachName("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(n){return _callbackNames+=n+","+n+"Params,"});var GSCache=function(e,t){this.id=_gsID++,e._gsap=this,this.target=e,this.harness=t,this.get=t?t.get:_getProperty,this.set=t?t.getSetter:_getSetter},Animation=function(){function n(t){this.vars=t,this._delay=+t.delay||0,(this._repeat=t.repeat===1/0?-2:t.repeat||0)&&(this._rDelay=t.repeatDelay||0,this._yoyo=!!t.yoyo||!!t.yoyoEase),this._ts=1,_setDuration(this,+t.duration,1,1),this.data=t.data,_context&&(this._ctx=_context,_context.data.push(this)),_tickerActive||_ticker.wake()}var e=n.prototype;return e.delay=function(o){return o||o===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+o-this._delay),this._delay=o,this):this._delay},e.duration=function(o){return arguments.length?this.totalDuration(this._repeat>0?o+(o+this._rDelay)*this._repeat:o):this.totalDuration()&&this._dur},e.totalDuration=function(o){return arguments.length?(this._dirty=0,_setDuration(this,this._repeat<0?o:(o-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},e.totalTime=function(o,i){if(_wake(),!arguments.length)return this._tTime;var s=this._dp;if(s&&s.smoothChildTiming&&this._ts){for(_alignPlayhead(this,o),!s._dp||s.parent||_postAddChecks(s,this);s&&s.parent;)s.parent._time!==s._start+(s._ts>=0?s._tTime/s._ts:(s.totalDuration()-s._tTime)/-s._ts)&&s.totalTime(s._tTime,!0),s=s.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&o<this._tDur||this._ts<0&&o>0||!this._tDur&&!o)&&_addToTimeline(this._dp,this,this._start-this._delay)}return(this._tTime!==o||!this._dur&&!i||this._initted&&Math.abs(this._zTime)===_tinyNum||!o&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=o),_lazySafeRender(this,o,i)),this},e.time=function(o,i){return arguments.length?this.totalTime(Math.min(this.totalDuration(),o+_elapsedCycleDuration(this))%(this._dur+this._rDelay)||(o?this._dur:0),i):this._time},e.totalProgress=function(o,i){return arguments.length?this.totalTime(this.totalDuration()*o,i):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.rawTime()>=0&&this._initted?1:0},e.progress=function(o,i){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-o:o)+_elapsedCycleDuration(this),i):this.duration()?Math.min(1,this._time/this._dur):this.rawTime()>0?1:0},e.iteration=function(o,i){var s=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(o-1)*s,i):this._repeat?_animationCycle(this._tTime,s)+1:1},e.timeScale=function(o,i){if(!arguments.length)return this._rts===-_tinyNum?0:this._rts;if(this._rts===o)return this;var s=this.parent&&this._ts?_parentToChildTotalTime(this.parent._time,this):this._tTime;return this._rts=+o||0,this._ts=this._ps||o===-_tinyNum?0:this._rts,this.totalTime(_clamp(-Math.abs(this._delay),this.totalDuration(),s),i!==!1),_setEnd(this),_recacheAncestors(this)},e.paused=function(o){return arguments.length?(this._ps!==o&&(this._ps=o,o?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(_wake(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==_tinyNum&&(this._tTime-=_tinyNum)))),this):this._ps},e.startTime=function(o){if(arguments.length){this._start=o;var i=this.parent||this._dp;return i&&(i._sort||!this.parent)&&_addToTimeline(i,this,o-this._delay),this}return this._start},e.endTime=function(o){return this._start+(_isNotFalse(o)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},e.rawTime=function(o){var i=this.parent||this._dp;return i?o&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?_parentToChildTotalTime(i.rawTime(o),this):this._tTime:this._tTime},e.revert=function(o){o===void 0&&(o=_revertConfig);var i=_reverting$1;return _reverting$1=o,_isRevertWorthy(this)&&(this.timeline&&this.timeline.revert(o),this.totalTime(-.01,o.suppressEvents)),this.data!=="nested"&&o.kill!==!1&&this.kill(),_reverting$1=i,this},e.globalTime=function(o){for(var i=this,s=arguments.length?o:i.rawTime();i;)s=i._start+s/(Math.abs(i._ts)||1),i=i._dp;return!this.parent&&this._sat?this._sat.globalTime(o):s},e.repeat=function(o){return arguments.length?(this._repeat=o===1/0?-2:o,_onUpdateTotalDuration(this)):this._repeat===-2?1/0:this._repeat},e.repeatDelay=function(o){if(arguments.length){var i=this._time;return this._rDelay=o,_onUpdateTotalDuration(this),i?this.time(i):this}return this._rDelay},e.yoyo=function(o){return arguments.length?(this._yoyo=o,this):this._yoyo},e.seek=function(o,i){return this.totalTime(_parsePosition(this,o),_isNotFalse(i))},e.restart=function(o,i){return this.play().totalTime(o?-this._delay:0,_isNotFalse(i)),this._dur||(this._zTime=-_tinyNum),this},e.play=function(o,i){return o!=null&&this.seek(o,i),this.reversed(!1).paused(!1)},e.reverse=function(o,i){return o!=null&&this.seek(o||this.totalDuration(),i),this.reversed(!0).paused(!1)},e.pause=function(o,i){return o!=null&&this.seek(o,i),this.paused(!0)},e.resume=function(){return this.paused(!1)},e.reversed=function(o){return arguments.length?(!!o!==this.reversed()&&this.timeScale(-this._rts||(o?-_tinyNum:0)),this):this._rts<0},e.invalidate=function(){return this._initted=this._act=0,this._zTime=-_tinyNum,this},e.isActive=function(){var o=this.parent||this._dp,i=this._start,s;return!!(!o||this._ts&&this._initted&&o.isActive()&&(s=o.rawTime(!0))>=i&&s<this.endTime(!0)-_tinyNum)},e.eventCallback=function(o,i,s){var r=this.vars;return arguments.length>1?(i?(r[o]=i,s&&(r[o+"Params"]=s),o==="onUpdate"&&(this._onUpdate=i)):delete r[o],this):r[o]},e.then=function(o){var i=this;return new Promise(function(s){var r=_isFunction(o)?o:_passThrough,a=function(){var c=i.then;i.then=null,_isFunction(r)&&(r=r(i))&&(r.then||r===i)&&(i.then=c),s(r),i.then=c};i._initted&&i.totalProgress()===1&&i._ts>=0||!i._tTime&&i._ts<0?a():i._prom=a})},e.kill=function(){_interrupt(this)},n}();_setDefaults(Animation.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-_tinyNum,_prom:0,_ps:!1,_rts:1});var Timeline=function(n){_inheritsLoose(e,n);function e(o,i){var s;return o===void 0&&(o={}),s=n.call(this,o)||this,s.labels={},s.smoothChildTiming=!!o.smoothChildTiming,s.autoRemoveChildren=!!o.autoRemoveChildren,s._sort=_isNotFalse(o.sortChildren),_globalTimeline&&_addToTimeline(o.parent||_globalTimeline,_assertThisInitialized(s),i),o.reversed&&s.reverse(),o.paused&&s.paused(!0),o.scrollTrigger&&_scrollTrigger(_assertThisInitialized(s),o.scrollTrigger),s}var t=e.prototype;return t.to=function(i,s,r){return _createTweenType(0,arguments,this),this},t.from=function(i,s,r){return _createTweenType(1,arguments,this),this},t.fromTo=function(i,s,r,a){return _createTweenType(2,arguments,this),this},t.set=function(i,s,r){return s.duration=0,s.parent=this,_inheritDefaults(s).repeatDelay||(s.repeat=0),s.immediateRender=!!s.immediateRender,new Tween(i,s,_parsePosition(this,r),1),this},t.call=function(i,s,r){return _addToTimeline(this,Tween.delayedCall(0,i,s),r)},t.staggerTo=function(i,s,r,a,l,c,d){return r.duration=s,r.stagger=r.stagger||a,r.onComplete=c,r.onCompleteParams=d,r.parent=this,new Tween(i,r,_parsePosition(this,l)),this},t.staggerFrom=function(i,s,r,a,l,c,d){return r.runBackwards=1,_inheritDefaults(r).immediateRender=_isNotFalse(r.immediateRender),this.staggerTo(i,s,r,a,l,c,d)},t.staggerFromTo=function(i,s,r,a,l,c,d,u){return a.startAt=r,_inheritDefaults(a).immediateRender=_isNotFalse(a.immediateRender),this.staggerTo(i,s,a,l,c,d,u)},t.render=function(i,s,r){var a=this._time,l=this._dirty?this.totalDuration():this._tDur,c=this._dur,d=i<=0?0:_roundPrecise(i),u=this._zTime<0!=i<0&&(this._initted||!c),f,h,m,p,v,g,y,w,_,S,C,A;if(this!==_globalTimeline&&d>l&&i>=0&&(d=l),d!==this._tTime||r||u){if(a!==this._time&&c&&(d+=this._time-a,i+=this._time-a),f=d,_=this._start,w=this._ts,g=!w,u&&(c||(a=this._zTime),(i||!s)&&(this._zTime=i)),this._repeat){if(C=this._yoyo,v=c+this._rDelay,this._repeat<-1&&i<0)return this.totalTime(v*100+i,s,r);if(f=_roundPrecise(d%v),d===l?(p=this._repeat,f=c):(S=_roundPrecise(d/v),p=~~S,p&&p===S&&(f=c,p--),f>c&&(f=c)),S=_animationCycle(this._tTime,v),!a&&this._tTime&&S!==p&&this._tTime-S*v-this._dur<=0&&(S=p),C&&p&1&&(f=c-f,A=1),p!==S&&!this._lock){var E=C&&S&1,k=E===(C&&p&1);if(p<S&&(E=!E),a=E?0:d%c?c:d,this._lock=1,this.render(a||(A?0:_roundPrecise(p*v)),s,!c)._lock=0,this._tTime=d,!s&&this.parent&&_callback(this,"onRepeat"),this.vars.repeatRefresh&&!A&&(this.invalidate()._lock=1),a&&a!==this._time||g!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(c=this._dur,l=this._tDur,k&&(this._lock=2,a=E?c:-1e-4,this.render(a,!0),this.vars.repeatRefresh&&!A&&this.invalidate()),this._lock=0,!this._ts&&!g)return this;_propagateYoyoEase(this,A)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(y=_findNextPauseTween(this,_roundPrecise(a),_roundPrecise(f)),y&&(d-=f-(f=y._start))),this._tTime=d,this._time=f,this._act=!w,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=i,a=0),!a&&d&&!s&&!S&&(_callback(this,"onStart"),this._tTime!==d))return this;if(f>=a&&i>=0)for(h=this._first;h;){if(m=h._next,(h._act||f>=h._start)&&h._ts&&y!==h){if(h.parent!==this)return this.render(i,s,r);if(h.render(h._ts>0?(f-h._start)*h._ts:(h._dirty?h.totalDuration():h._tDur)+(f-h._start)*h._ts,s,r),f!==this._time||!this._ts&&!g){y=0,m&&(d+=this._zTime=-_tinyNum);break}}h=m}else{h=this._last;for(var I=i<0?i:f;h;){if(m=h._prev,(h._act||I<=h._end)&&h._ts&&y!==h){if(h.parent!==this)return this.render(i,s,r);if(h.render(h._ts>0?(I-h._start)*h._ts:(h._dirty?h.totalDuration():h._tDur)+(I-h._start)*h._ts,s,r||_reverting$1&&_isRevertWorthy(h)),f!==this._time||!this._ts&&!g){y=0,m&&(d+=this._zTime=I?-_tinyNum:_tinyNum);break}}h=m}}if(y&&!s&&(this.pause(),y.render(f>=a?0:-_tinyNum)._zTime=f>=a?1:-1,this._ts))return this._start=_,_setEnd(this),this.render(i,s,r);this._onUpdate&&!s&&_callback(this,"onUpdate",!0),(d===l&&this._tTime>=this.totalDuration()||!d&&a)&&(_===this._start||Math.abs(w)!==Math.abs(this._ts))&&(this._lock||((i||!c)&&(d===l&&this._ts>0||!d&&this._ts<0)&&_removeFromParent(this,1),!s&&!(i<0&&!a)&&(d||a||!l)&&(_callback(this,d===l&&i>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(d<l&&this.timeScale()>0)&&this._prom())))}return this},t.add=function(i,s){var r=this;if(_isNumber(s)||(s=_parsePosition(this,s,i)),!(i instanceof Animation)){if(_isArray(i))return i.forEach(function(a){return r.add(a,s)}),this;if(_isString(i))return this.addLabel(i,s);if(_isFunction(i))i=Tween.delayedCall(0,i);else return this}return this!==i?_addToTimeline(this,i,s):this},t.getChildren=function(i,s,r,a){i===void 0&&(i=!0),s===void 0&&(s=!0),r===void 0&&(r=!0),a===void 0&&(a=-_bigNum$1);for(var l=[],c=this._first;c;)c._start>=a&&(c instanceof Tween?s&&l.push(c):(r&&l.push(c),i&&l.push.apply(l,c.getChildren(!0,s,r)))),c=c._next;return l},t.getById=function(i){for(var s=this.getChildren(1,1,1),r=s.length;r--;)if(s[r].vars.id===i)return s[r]},t.remove=function(i){return _isString(i)?this.removeLabel(i):_isFunction(i)?this.killTweensOf(i):(i.parent===this&&_removeLinkedListItem(this,i),i===this._recent&&(this._recent=this._last),_uncache(this))},t.totalTime=function(i,s){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=_roundPrecise(_ticker.time-(this._ts>0?i/this._ts:(this.totalDuration()-i)/-this._ts))),n.prototype.totalTime.call(this,i,s),this._forcing=0,this):this._tTime},t.addLabel=function(i,s){return this.labels[i]=_parsePosition(this,s),this},t.removeLabel=function(i){return delete this.labels[i],this},t.addPause=function(i,s,r){var a=Tween.delayedCall(0,s||_emptyFunc,r);return a.data="isPause",this._hasPause=1,_addToTimeline(this,a,_parsePosition(this,i))},t.removePause=function(i){var s=this._first;for(i=_parsePosition(this,i);s;)s._start===i&&s.data==="isPause"&&_removeFromParent(s),s=s._next},t.killTweensOf=function(i,s,r){for(var a=this.getTweensOf(i,r),l=a.length;l--;)_overwritingTween!==a[l]&&a[l].kill(i,s);return this},t.getTweensOf=function(i,s){for(var r=[],a=toArray(i),l=this._first,c=_isNumber(s),d;l;)l instanceof Tween?_arrayContainsAny(l._targets,a)&&(c?(!_overwritingTween||l._initted&&l._ts)&&l.globalTime(0)<=s&&l.globalTime(l.totalDuration())>s:!s||l.isActive())&&r.push(l):(d=l.getTweensOf(a,s)).length&&r.push.apply(r,d),l=l._next;return r},t.tweenTo=function(i,s){s=s||{};var r=this,a=_parsePosition(r,i),l=s,c=l.startAt,d=l.onStart,u=l.onStartParams,f=l.immediateRender,h,m=Tween.to(r,_setDefaults({ease:s.ease||"none",lazy:!1,immediateRender:!1,time:a,overwrite:"auto",duration:s.duration||Math.abs((a-(c&&"time"in c?c.time:r._time))/r.timeScale())||_tinyNum,onStart:function(){if(r.pause(),!h){var v=s.duration||Math.abs((a-(c&&"time"in c?c.time:r._time))/r.timeScale());m._dur!==v&&_setDuration(m,v,0,1).render(m._time,!0,!0),h=1}d&&d.apply(m,u||[])}},s));return f?m.render(0):m},t.tweenFromTo=function(i,s,r){return this.tweenTo(s,_setDefaults({startAt:{time:_parsePosition(this,i)}},r))},t.recent=function(){return this._recent},t.nextLabel=function(i){return i===void 0&&(i=this._time),_getLabelInDirection(this,_parsePosition(this,i))},t.previousLabel=function(i){return i===void 0&&(i=this._time),_getLabelInDirection(this,_parsePosition(this,i),1)},t.currentLabel=function(i){return arguments.length?this.seek(i,!0):this.previousLabel(this._time+_tinyNum)},t.shiftChildren=function(i,s,r){r===void 0&&(r=0);for(var a=this._first,l=this.labels,c;a;)a._start>=r&&(a._start+=i,a._end+=i),a=a._next;if(s)for(c in l)l[c]>=r&&(l[c]+=i);return _uncache(this)},t.invalidate=function(i){var s=this._first;for(this._lock=0;s;)s.invalidate(i),s=s._next;return n.prototype.invalidate.call(this,i)},t.clear=function(i){i===void 0&&(i=!0);for(var s=this._first,r;s;)r=s._next,this.remove(s),s=r;return this._dp&&(this._time=this._tTime=this._pTime=0),i&&(this.labels={}),_uncache(this)},t.totalDuration=function(i){var s=0,r=this,a=r._last,l=_bigNum$1,c,d,u;if(arguments.length)return r.timeScale((r._repeat<0?r.duration():r.totalDuration())/(r.reversed()?-i:i));if(r._dirty){for(u=r.parent;a;)c=a._prev,a._dirty&&a.totalDuration(),d=a._start,d>l&&r._sort&&a._ts&&!r._lock?(r._lock=1,_addToTimeline(r,a,d-a._delay,1)._lock=0):l=d,d<0&&a._ts&&(s-=d,(!u&&!r._dp||u&&u.smoothChildTiming)&&(r._start+=d/r._ts,r._time-=d,r._tTime-=d),r.shiftChildren(-d,!1,-1/0),l=0),a._end>s&&a._ts&&(s=a._end),a=c;_setDuration(r,r===_globalTimeline&&r._time>s?r._time:s,1,1),r._dirty=0}return r._tDur},e.updateRoot=function(i){if(_globalTimeline._ts&&(_lazySafeRender(_globalTimeline,_parentToChildTotalTime(i,_globalTimeline)),_lastRenderedFrame=_ticker.frame),_ticker.frame>=_nextGCFrame){_nextGCFrame+=_config.autoSleep||120;var s=_globalTimeline._first;if((!s||!s._ts)&&_config.autoSleep&&_ticker._listeners.length<2){for(;s&&!s._ts;)s=s._next;s||_ticker.sleep()}}},e}(Animation);_setDefaults(Timeline.prototype,{_lock:0,_hasPause:0,_forcing:0});var _addComplexStringPropTween=function(e,t,o,i,s,r,a){var l=new PropTween(this._pt,e,t,0,1,_renderComplexString,null,s),c=0,d=0,u,f,h,m,p,v,g,y;for(l.b=o,l.e=i,o+="",i+="",(g=~i.indexOf("random("))&&(i=_replaceRandom(i)),r&&(y=[o,i],r(y,e,t),o=y[0],i=y[1]),f=o.match(_complexStringNumExp)||[];u=_complexStringNumExp.exec(i);)m=u[0],p=i.substring(c,u.index),h?h=(h+1)%5:p.substr(-5)==="rgba("&&(h=1),m!==f[d++]&&(v=parseFloat(f[d-1])||0,l._pt={_next:l._pt,p:p||d===1?p:",",s:v,c:m.charAt(1)==="="?_parseRelative(v,m)-v:parseFloat(m)-v,m:h&&h<4?Math.round:0},c=_complexStringNumExp.lastIndex);return l.c=c<i.length?i.substring(c,i.length):"",l.fp=a,(_relExp.test(i)||g)&&(l.e=0),this._pt=l,l},_addPropTween=function(e,t,o,i,s,r,a,l,c,d){_isFunction(i)&&(i=i(s||0,e,r));var u=e[t],f=o!=="get"?o:_isFunction(u)?c?e[t.indexOf("set")||!_isFunction(e["get"+t.substr(3)])?t:"get"+t.substr(3)](c):e[t]():u,h=_isFunction(u)?c?_setterFuncWithParam:_setterFunc:_setterPlain,m;if(_isString(i)&&(~i.indexOf("random(")&&(i=_replaceRandom(i)),i.charAt(1)==="="&&(m=_parseRelative(f,i)+(getUnit(f)||0),(m||m===0)&&(i=m))),!d||f!==i||_forceAllPropTweens)return!isNaN(f*i)&&i!==""?(m=new PropTween(this._pt,e,t,+f||0,i-(f||0),typeof u=="boolean"?_renderBoolean:_renderPlain,0,h),c&&(m.fp=c),a&&m.modifier(a,this,e),this._pt=m):(!u&&!(t in e)&&_missingPlugin(t,i),_addComplexStringPropTween.call(this,e,t,f,i,h,l||_config.stringFilter,c))},_processVars=function(e,t,o,i,s){if(_isFunction(e)&&(e=_parseFuncOrString(e,s,t,o,i)),!_isObject(e)||e.style&&e.nodeType||_isArray(e)||_isTypedArray(e))return _isString(e)?_parseFuncOrString(e,s,t,o,i):e;var r={},a;for(a in e)r[a]=_parseFuncOrString(e[a],s,t,o,i);return r},_checkPlugin=function(e,t,o,i,s,r){var a,l,c,d;if(_plugins[e]&&(a=new _plugins[e]).init(s,a.rawVars?t[e]:_processVars(t[e],i,s,r,o),o,i,r)!==!1&&(o._pt=l=new PropTween(o._pt,s,e,0,1,a.render,a,0,a.priority),o!==_quickTween))for(c=o._ptLookup[o._targets.indexOf(s)],d=a._props.length;d--;)c[a._props[d]]=l;return a},_overwritingTween,_forceAllPropTweens,_initTween=function n(e,t,o){var i=e.vars,s=i.ease,r=i.startAt,a=i.immediateRender,l=i.lazy,c=i.onUpdate,d=i.runBackwards,u=i.yoyoEase,f=i.keyframes,h=i.autoRevert,m=e._dur,p=e._startAt,v=e._targets,g=e.parent,y=g&&g.data==="nested"?g.vars.targets:v,w=e._overwrite==="auto"&&!_suppressOverwrites,_=e.timeline,S,C,A,E,k,I,F,M,R,O,$,T,D;if(_&&(!f||!s)&&(s="none"),e._ease=_parseEase(s,_defaults.ease),e._yEase=u?_invertEase(_parseEase(u===!0?s:u,_defaults.ease)):0,u&&e._yoyo&&!e._repeat&&(u=e._yEase,e._yEase=e._ease,e._ease=u),e._from=!_&&!!i.runBackwards,!_||f&&!i.stagger){if(M=v[0]?_getCache(v[0]).harness:0,T=M&&i[M.prop],S=_copyExcluding(i,_reservedProps),p&&(p._zTime<0&&p.progress(1),t<0&&d&&a&&!h?p.render(-1,!0):p.revert(d&&m?_revertConfigNoKill:_startAtRevertConfig),p._lazy=0),r){if(_removeFromParent(e._startAt=Tween.set(v,_setDefaults({data:"isStart",overwrite:!1,parent:g,immediateRender:!0,lazy:!p&&_isNotFalse(l),startAt:null,delay:0,onUpdate:c&&function(){return _callback(e,"onUpdate")},stagger:0},r))),e._startAt._dp=0,e._startAt._sat=e,t<0&&(_reverting$1||!a&&!h)&&e._startAt.revert(_revertConfigNoKill),a&&m&&t<=0&&o<=0){t&&(e._zTime=t);return}}else if(d&&m&&!p){if(t&&(a=!1),A=_setDefaults({overwrite:!1,data:"isFromStart",lazy:a&&!p&&_isNotFalse(l),immediateRender:a,stagger:0,parent:g},S),T&&(A[M.prop]=T),_removeFromParent(e._startAt=Tween.set(v,A)),e._startAt._dp=0,e._startAt._sat=e,t<0&&(_reverting$1?e._startAt.revert(_revertConfigNoKill):e._startAt.render(-1,!0)),e._zTime=t,!a)n(e._startAt,_tinyNum,_tinyNum);else if(!t)return}for(e._pt=e._ptCache=0,l=m&&_isNotFalse(l)||l&&!m,C=0;C<v.length;C++){if(k=v[C],F=k._gsap||_harness(v)[C]._gsap,e._ptLookup[C]=O={},_lazyLookup[F.id]&&_lazyTweens.length&&_lazyRender(),$=y===v?C:y.indexOf(k),M&&(R=new M).init(k,T||S,e,$,y)!==!1&&(e._pt=E=new PropTween(e._pt,k,R.name,0,1,R.render,R,0,R.priority),R._props.forEach(function(P){O[P]=E}),R.priority&&(I=1)),!M||T)for(A in S)_plugins[A]&&(R=_checkPlugin(A,S,e,$,k,y))?R.priority&&(I=1):O[A]=E=_addPropTween.call(e,k,A,"get",S[A],$,y,0,i.stringFilter);e._op&&e._op[C]&&e.kill(k,e._op[C]),w&&e._pt&&(_overwritingTween=e,_globalTimeline.killTweensOf(k,O,e.globalTime(t)),D=!e.parent,_overwritingTween=0),e._pt&&l&&(_lazyLookup[F.id]=1)}I&&_sortPropTweensByPriority(e),e._onInit&&e._onInit(e)}e._onUpdate=c,e._initted=(!e._op||e._pt)&&!D,f&&t<=0&&_.render(_bigNum$1,!0,!0)},_updatePropTweens=function(e,t,o,i,s,r,a,l){var c=(e._pt&&e._ptCache||(e._ptCache={}))[t],d,u,f,h;if(!c)for(c=e._ptCache[t]=[],f=e._ptLookup,h=e._targets.length;h--;){if(d=f[h][t],d&&d.d&&d.d._pt)for(d=d.d._pt;d&&d.p!==t&&d.fp!==t;)d=d._next;if(!d)return _forceAllPropTweens=1,e.vars[t]="+=0",_initTween(e,a),_forceAllPropTweens=0,l?_warn(t+" not eligible for reset"):1;c.push(d)}for(h=c.length;h--;)u=c[h],d=u._pt||u,d.s=(i||i===0)&&!s?i:d.s+(i||0)+r*d.c,d.c=o-d.s,u.e&&(u.e=_round(o)+getUnit(u.e)),u.b&&(u.b=d.s+getUnit(u.b))},_addAliasesToVars=function(e,t){var o=e[0]?_getCache(e[0]).harness:0,i=o&&o.aliases,s,r,a,l;if(!i)return t;s=_merge({},t);for(r in i)if(r in s)for(l=i[r].split(","),a=l.length;a--;)s[l[a]]=s[r];return s},_parseKeyframe=function(e,t,o,i){var s=t.ease||i||"power1.inOut",r,a;if(_isArray(t))a=o[e]||(o[e]=[]),t.forEach(function(l,c){return a.push({t:c/(t.length-1)*100,v:l,e:s})});else for(r in t)a=o[r]||(o[r]=[]),r==="ease"||a.push({t:parseFloat(e),v:t[r],e:s})},_parseFuncOrString=function(e,t,o,i,s){return _isFunction(e)?e.call(t,o,i,s):_isString(e)&&~e.indexOf("random(")?_replaceRandom(e):e},_staggerTweenProps=_callbackNames+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",_staggerPropsToSkip={};_forEachName(_staggerTweenProps+",id,stagger,delay,duration,paused,scrollTrigger",function(n){return _staggerPropsToSkip[n]=1});var Tween=function(n){_inheritsLoose(e,n);function e(o,i,s,r){var a;typeof i=="number"&&(s.duration=i,i=s,s=null),a=n.call(this,r?i:_inheritDefaults(i))||this;var l=a.vars,c=l.duration,d=l.delay,u=l.immediateRender,f=l.stagger,h=l.overwrite,m=l.keyframes,p=l.defaults,v=l.scrollTrigger,g=l.yoyoEase,y=i.parent||_globalTimeline,w=(_isArray(o)||_isTypedArray(o)?_isNumber(o[0]):"length"in i)?[o]:toArray(o),_,S,C,A,E,k,I,F;if(a._targets=w.length?_harness(w):_warn("GSAP target "+o+" not found. https://gsap.com",!_config.nullTargetWarn)||[],a._ptLookup=[],a._overwrite=h,m||f||_isFuncOrString(c)||_isFuncOrString(d)){if(i=a.vars,_=a.timeline=new Timeline({data:"nested",defaults:p||{},targets:y&&y.data==="nested"?y.vars.targets:w}),_.kill(),_.parent=_._dp=_assertThisInitialized(a),_._start=0,f||_isFuncOrString(c)||_isFuncOrString(d)){if(A=w.length,I=f&&distribute(f),_isObject(f))for(E in f)~_staggerTweenProps.indexOf(E)&&(F||(F={}),F[E]=f[E]);for(S=0;S<A;S++)C=_copyExcluding(i,_staggerPropsToSkip),C.stagger=0,g&&(C.yoyoEase=g),F&&_merge(C,F),k=w[S],C.duration=+_parseFuncOrString(c,_assertThisInitialized(a),S,k,w),C.delay=(+_parseFuncOrString(d,_assertThisInitialized(a),S,k,w)||0)-a._delay,!f&&A===1&&C.delay&&(a._delay=d=C.delay,a._start+=d,C.delay=0),_.to(k,C,I?I(S,k,w):0),_._ease=_easeMap.none;_.duration()?c=d=0:a.timeline=0}else if(m){_inheritDefaults(_setDefaults(_.vars.defaults,{ease:"none"})),_._ease=_parseEase(m.ease||i.ease||"none");var M=0,R,O,$;if(_isArray(m))m.forEach(function(T){return _.to(w,T,">")}),_.duration();else{C={};for(E in m)E==="ease"||E==="easeEach"||_parseKeyframe(E,m[E],C,m.easeEach);for(E in C)for(R=C[E].sort(function(T,D){return T.t-D.t}),M=0,S=0;S<R.length;S++)O=R[S],$={ease:O.e,duration:(O.t-(S?R[S-1].t:0))/100*c},$[E]=O.v,_.to(w,$,M),M+=$.duration;_.duration()<c&&_.to({},{duration:c-_.duration()})}}c||a.duration(c=_.duration())}else a.timeline=0;return h===!0&&!_suppressOverwrites&&(_overwritingTween=_assertThisInitialized(a),_globalTimeline.killTweensOf(w),_overwritingTween=0),_addToTimeline(y,_assertThisInitialized(a),s),i.reversed&&a.reverse(),i.paused&&a.paused(!0),(u||!c&&!m&&a._start===_roundPrecise(y._time)&&_isNotFalse(u)&&_hasNoPausedAncestors(_assertThisInitialized(a))&&y.data!=="nested")&&(a._tTime=-_tinyNum,a.render(Math.max(0,-d)||0)),v&&_scrollTrigger(_assertThisInitialized(a),v),a}var t=e.prototype;return t.render=function(i,s,r){var a=this._time,l=this._tDur,c=this._dur,d=i<0,u=i>l-_tinyNum&&!d?l:i<_tinyNum?0:i,f,h,m,p,v,g,y,w,_;if(!c)_renderZeroDurationTween(this,i,s,r);else if(u!==this._tTime||!i||r||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==d||this._lazy){if(f=u,w=this.timeline,this._repeat){if(p=c+this._rDelay,this._repeat<-1&&d)return this.totalTime(p*100+i,s,r);if(f=_roundPrecise(u%p),u===l?(m=this._repeat,f=c):(v=_roundPrecise(u/p),m=~~v,m&&m===v?(f=c,m--):f>c&&(f=c)),g=this._yoyo&&m&1,g&&(_=this._yEase,f=c-f),v=_animationCycle(this._tTime,p),f===a&&!r&&this._initted&&m===v)return this._tTime=u,this;m!==v&&(w&&this._yEase&&_propagateYoyoEase(w,g),this.vars.repeatRefresh&&!g&&!this._lock&&f!==p&&this._initted&&(this._lock=r=1,this.render(_roundPrecise(p*m),!0).invalidate()._lock=0))}if(!this._initted){if(_attemptInitTween(this,d?i:f,r,s,u))return this._tTime=0,this;if(a!==this._time&&!(r&&this.vars.repeatRefresh&&m!==v))return this;if(c!==this._dur)return this.render(i,s,r)}if(this._tTime=u,this._time=f,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=y=(_||this._ease)(f/c),this._from&&(this.ratio=y=1-y),!a&&u&&!s&&!v&&(_callback(this,"onStart"),this._tTime!==u))return this;for(h=this._pt;h;)h.r(y,h.d),h=h._next;w&&w.render(i<0?i:w._dur*w._ease(f/this._dur),s,r)||this._startAt&&(this._zTime=i),this._onUpdate&&!s&&(d&&_rewindStartAt(this,i,s,r),_callback(this,"onUpdate")),this._repeat&&m!==v&&this.vars.onRepeat&&!s&&this.parent&&_callback(this,"onRepeat"),(u===this._tDur||!u)&&this._tTime===u&&(d&&!this._onUpdate&&_rewindStartAt(this,i,!0,!0),(i||!c)&&(u===this._tDur&&this._ts>0||!u&&this._ts<0)&&_removeFromParent(this,1),!s&&!(d&&!a)&&(u||a||g)&&(_callback(this,u===l?"onComplete":"onReverseComplete",!0),this._prom&&!(u<l&&this.timeScale()>0)&&this._prom()))}return this},t.targets=function(){return this._targets},t.invalidate=function(i){return(!i||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(i),n.prototype.invalidate.call(this,i)},t.resetTo=function(i,s,r,a,l){_tickerActive||_ticker.wake(),this._ts||this.play();var c=Math.min(this._dur,(this._dp._time-this._start)*this._ts),d;return this._initted||_initTween(this,c),d=this._ease(c/this._dur),_updatePropTweens(this,i,s,r,a,d,c,l)?this.resetTo(i,s,r,a,1):(_alignPlayhead(this,0),this.parent||_addLinkedListItem(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},t.kill=function(i,s){if(s===void 0&&(s="all"),!i&&(!s||s==="all"))return this._lazy=this._pt=0,this.parent?_interrupt(this):this.scrollTrigger&&this.scrollTrigger.kill(!!_reverting$1),this;if(this.timeline){var r=this.timeline.totalDuration();return this.timeline.killTweensOf(i,s,_overwritingTween&&_overwritingTween.vars.overwrite!==!0)._first||_interrupt(this),this.parent&&r!==this.timeline.totalDuration()&&_setDuration(this,this._dur*this.timeline._tDur/r,0,1),this}var a=this._targets,l=i?toArray(i):a,c=this._ptLookup,d=this._pt,u,f,h,m,p,v,g;if((!s||s==="all")&&_arraysMatch(a,l))return s==="all"&&(this._pt=0),_interrupt(this);for(u=this._op=this._op||[],s!=="all"&&(_isString(s)&&(p={},_forEachName(s,function(y){return p[y]=1}),s=p),s=_addAliasesToVars(a,s)),g=a.length;g--;)if(~l.indexOf(a[g])){f=c[g],s==="all"?(u[g]=s,m=f,h={}):(h=u[g]=u[g]||{},m=s);for(p in m)v=f&&f[p],v&&((!("kill"in v.d)||v.d.kill(p)===!0)&&_removeLinkedListItem(this,v,"_pt"),delete f[p]),h!=="all"&&(h[p]=1)}return this._initted&&!this._pt&&d&&_interrupt(this),this},e.to=function(i,s){return new e(i,s,arguments[2])},e.from=function(i,s){return _createTweenType(1,arguments)},e.delayedCall=function(i,s,r,a){return new e(s,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:i,onComplete:s,onReverseComplete:s,onCompleteParams:r,onReverseCompleteParams:r,callbackScope:a})},e.fromTo=function(i,s,r){return _createTweenType(2,arguments)},e.set=function(i,s){return s.duration=0,s.repeatDelay||(s.repeat=0),new e(i,s)},e.killTweensOf=function(i,s,r){return _globalTimeline.killTweensOf(i,s,r)},e}(Animation);_setDefaults(Tween.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});_forEachName("staggerTo,staggerFrom,staggerFromTo",function(n){Tween[n]=function(){var e=new Timeline,t=_slice.call(arguments,0);return t.splice(n==="staggerFromTo"?5:4,0,0),e[n].apply(e,t)}});var _setterPlain=function(e,t,o){return e[t]=o},_setterFunc=function(e,t,o){return e[t](o)},_setterFuncWithParam=function(e,t,o,i){return e[t](i.fp,o)},_setterAttribute=function(e,t,o){return e.setAttribute(t,o)},_getSetter=function(e,t){return _isFunction(e[t])?_setterFunc:_isUndefined(e[t])&&e.setAttribute?_setterAttribute:_setterPlain},_renderPlain=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e6)/1e6,t)},_renderBoolean=function(e,t){return t.set(t.t,t.p,!!(t.s+t.c*e),t)},_renderComplexString=function(e,t){var o=t._pt,i="";if(!e&&t.b)i=t.b;else if(e===1&&t.e)i=t.e;else{for(;o;)i=o.p+(o.m?o.m(o.s+o.c*e):Math.round((o.s+o.c*e)*1e4)/1e4)+i,o=o._next;i+=t.c}t.set(t.t,t.p,i,t)},_renderPropTweens=function(e,t){for(var o=t._pt;o;)o.r(e,o.d),o=o._next},_addPluginModifier=function(e,t,o,i){for(var s=this._pt,r;s;)r=s._next,s.p===i&&s.modifier(e,t,o),s=r},_killPropTweensOf=function(e){for(var t=this._pt,o,i;t;)i=t._next,t.p===e&&!t.op||t.op===e?_removeLinkedListItem(this,t,"_pt"):t.dep||(o=1),t=i;return!o},_setterWithModifier=function(e,t,o,i){i.mSet(e,t,i.m.call(i.tween,o,i.mt),i)},_sortPropTweensByPriority=function(e){for(var t=e._pt,o,i,s,r;t;){for(o=t._next,i=s;i&&i.pr>t.pr;)i=i._next;(t._prev=i?i._prev:r)?t._prev._next=t:s=t,(t._next=i)?i._prev=t:r=t,t=o}e._pt=s},PropTween=function(){function n(t,o,i,s,r,a,l,c,d){this.t=o,this.s=s,this.c=r,this.p=i,this.r=a||_renderPlain,this.d=l||this,this.set=c||_setterPlain,this.pr=d||0,this._next=t,t&&(t._prev=this)}var e=n.prototype;return e.modifier=function(o,i,s){this.mSet=this.mSet||this.set,this.set=_setterWithModifier,this.m=o,this.mt=s,this.tween=i},n}();_forEachName(_callbackNames+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(n){return _reservedProps[n]=1});_globals.TweenMax=_globals.TweenLite=Tween;_globals.TimelineLite=_globals.TimelineMax=Timeline;_globalTimeline=new Timeline({sortChildren:!1,defaults:_defaults,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});_config.stringFilter=_colorStringFilter;var _media=[],_listeners={},_emptyArray=[],_lastMediaTime=0,_contextID=0,_dispatch=function(e){return(_listeners[e]||_emptyArray).map(function(t){return t()})},_onMediaChange=function(){var e=Date.now(),t=[];e-_lastMediaTime>2&&(_dispatch("matchMediaInit"),_media.forEach(function(o){var i=o.queries,s=o.conditions,r,a,l,c;for(a in i)r=_win$1.matchMedia(i[a]).matches,r&&(l=1),r!==s[a]&&(s[a]=r,c=1);c&&(o.revert(),l&&t.push(o))}),_dispatch("matchMediaRevert"),t.forEach(function(o){return o.onMatch(o,function(i){return o.add(null,i)})}),_lastMediaTime=e,_dispatch("matchMedia"))},Context=function(){function n(t,o){this.selector=o&&selector(o),this.data=[],this._r=[],this.isReverted=!1,this.id=_contextID++,t&&this.add(t)}var e=n.prototype;return e.add=function(o,i,s){_isFunction(o)&&(s=i,i=o,o=_isFunction);var r=this,a=function(){var c=_context,d=r.selector,u;return c&&c!==r&&c.data.push(r),s&&(r.selector=selector(s)),_context=r,u=i.apply(r,arguments),_isFunction(u)&&r._r.push(u),_context=c,r.selector=d,r.isReverted=!1,u};return r.last=a,o===_isFunction?a(r,function(l){return r.add(null,l)}):o?r[o]=a:a},e.ignore=function(o){var i=_context;_context=null,o(this),_context=i},e.getTweens=function(){var o=[];return this.data.forEach(function(i){return i instanceof n?o.push.apply(o,i.getTweens()):i instanceof Tween&&!(i.parent&&i.parent.data==="nested")&&o.push(i)}),o},e.clear=function(){this._r.length=this.data.length=0},e.kill=function(o,i){var s=this;if(o?function(){for(var a=s.getTweens(),l=s.data.length,c;l--;)c=s.data[l],c.data==="isFlip"&&(c.revert(),c.getChildren(!0,!0,!1).forEach(function(d){return a.splice(a.indexOf(d),1)}));for(a.map(function(d){return{g:d._dur||d._delay||d._sat&&!d._sat.vars.immediateRender?d.globalTime(0):-1/0,t:d}}).sort(function(d,u){return u.g-d.g||-1/0}).forEach(function(d){return d.t.revert(o)}),l=s.data.length;l--;)c=s.data[l],c instanceof Timeline?c.data!=="nested"&&(c.scrollTrigger&&c.scrollTrigger.revert(),c.kill()):!(c instanceof Tween)&&c.revert&&c.revert(o);s._r.forEach(function(d){return d(o,s)}),s.isReverted=!0}():this.data.forEach(function(a){return a.kill&&a.kill()}),this.clear(),i)for(var r=_media.length;r--;)_media[r].id===this.id&&_media.splice(r,1)},e.revert=function(o){this.kill(o||{})},n}(),MatchMedia=function(){function n(t){this.contexts=[],this.scope=t,_context&&_context.data.push(this)}var e=n.prototype;return e.add=function(o,i,s){_isObject(o)||(o={matches:o});var r=new Context(0,s||this.scope),a=r.conditions={},l,c,d;_context&&!r.selector&&(r.selector=_context.selector),this.contexts.push(r),i=r.add("onMatch",i),r.queries=o;for(c in o)c==="all"?d=1:(l=_win$1.matchMedia(o[c]),l&&(_media.indexOf(r)<0&&_media.push(r),(a[c]=l.matches)&&(d=1),l.addListener?l.addListener(_onMediaChange):l.addEventListener("change",_onMediaChange)));return d&&i(r,function(u){return r.add(null,u)}),this},e.revert=function(o){this.kill(o||{})},e.kill=function(o){this.contexts.forEach(function(i){return i.kill(o,!0)})},n}(),_gsap={registerPlugin:function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];t.forEach(function(i){return _createPlugin(i)})},timeline:function(e){return new Timeline(e)},getTweensOf:function(e,t){return _globalTimeline.getTweensOf(e,t)},getProperty:function(e,t,o,i){_isString(e)&&(e=toArray(e)[0]);var s=_getCache(e||{}).get,r=o?_passThrough:_numericIfPossible;return o==="native"&&(o=""),e&&(t?r((_plugins[t]&&_plugins[t].get||s)(e,t,o,i)):function(a,l,c){return r((_plugins[a]&&_plugins[a].get||s)(e,a,l,c))})},quickSetter:function(e,t,o){if(e=toArray(e),e.length>1){var i=e.map(function(d){return gsap.quickSetter(d,t,o)}),s=i.length;return function(d){for(var u=s;u--;)i[u](d)}}e=e[0]||{};var r=_plugins[t],a=_getCache(e),l=a.harness&&(a.harness.aliases||{})[t]||t,c=r?function(d){var u=new r;_quickTween._pt=0,u.init(e,o?d+o:d,_quickTween,0,[e]),u.render(1,u),_quickTween._pt&&_renderPropTweens(1,_quickTween)}:a.set(e,l);return r?c:function(d){return c(e,l,o?d+o:d,a,1)}},quickTo:function(e,t,o){var i,s=gsap.to(e,_setDefaults((i={},i[t]="+=0.1",i.paused=!0,i.stagger=0,i),o||{})),r=function(l,c,d){return s.resetTo(t,l,c,d)};return r.tween=s,r},isTweening:function(e){return _globalTimeline.getTweensOf(e,!0).length>0},defaults:function(e){return e&&e.ease&&(e.ease=_parseEase(e.ease,_defaults.ease)),_mergeDeep(_defaults,e||{})},config:function(e){return _mergeDeep(_config,e||{})},registerEffect:function(e){var t=e.name,o=e.effect,i=e.plugins,s=e.defaults,r=e.extendTimeline;(i||"").split(",").forEach(function(a){return a&&!_plugins[a]&&!_globals[a]&&_warn(t+" effect requires "+a+" plugin.")}),_effects[t]=function(a,l,c){return o(toArray(a),_setDefaults(l||{},s),c)},r&&(Timeline.prototype[t]=function(a,l,c){return this.add(_effects[t](a,_isObject(l)?l:(c=l)&&{},this),c)})},registerEase:function(e,t){_easeMap[e]=_parseEase(t)},parseEase:function(e,t){return arguments.length?_parseEase(e,t):_easeMap},getById:function(e){return _globalTimeline.getById(e)},exportRoot:function(e,t){e===void 0&&(e={});var o=new Timeline(e),i,s;for(o.smoothChildTiming=_isNotFalse(e.smoothChildTiming),_globalTimeline.remove(o),o._dp=0,o._time=o._tTime=_globalTimeline._time,i=_globalTimeline._first;i;)s=i._next,(t||!(!i._dur&&i instanceof Tween&&i.vars.onComplete===i._targets[0]))&&_addToTimeline(o,i,i._start-i._delay),i=s;return _addToTimeline(_globalTimeline,o,0),o},context:function(e,t){return e?new Context(e,t):_context},matchMedia:function(e){return new MatchMedia(e)},matchMediaRefresh:function(){return _media.forEach(function(e){var t=e.conditions,o,i;for(i in t)t[i]&&(t[i]=!1,o=1);o&&e.revert()})||_onMediaChange()},addEventListener:function(e,t){var o=_listeners[e]||(_listeners[e]=[]);~o.indexOf(t)||o.push(t)},removeEventListener:function(e,t){var o=_listeners[e],i=o&&o.indexOf(t);i>=0&&o.splice(i,1)},utils:{wrap,wrapYoyo,distribute,random,snap,normalize:normalize$1,getUnit,clamp:clamp$1,splitColor,toArray,selector,mapRange,pipe,unitize,interpolate,shuffle},install:_install,effects:_effects,ticker:_ticker,updateRoot:Timeline.updateRoot,plugins:_plugins,globalTimeline:_globalTimeline,core:{PropTween,globals:_addGlobal,Tween,Timeline,Animation,getCache:_getCache,_removeLinkedListItem,reverting:function(){return _reverting$1},context:function(e){return e&&_context&&(_context.data.push(e),e._ctx=_context),_context},suppressOverwrites:function(e){return _suppressOverwrites=e}}};_forEachName("to,from,fromTo,delayedCall,set,killTweensOf",function(n){return _gsap[n]=Tween[n]});_ticker.add(Timeline.updateRoot);_quickTween=_gsap.to({},{duration:0});var _getPluginPropTween=function(e,t){for(var o=e._pt;o&&o.p!==t&&o.op!==t&&o.fp!==t;)o=o._next;return o},_addModifiers=function(e,t){var o=e._targets,i,s,r;for(i in t)for(s=o.length;s--;)r=e._ptLookup[s][i],r&&(r=r.d)&&(r._pt&&(r=_getPluginPropTween(r,i)),r&&r.modifier&&r.modifier(t[i],e,o[s],i))},_buildModifierPlugin=function(e,t){return{name:e,headless:1,rawVars:1,init:function(i,s,r){r._onInit=function(a){var l,c;if(_isString(s)&&(l={},_forEachName(s,function(d){return l[d]=1}),s=l),t){l={};for(c in s)l[c]=t(s[c]);s=l}_addModifiers(a,s)}}}},gsap=_gsap.registerPlugin({name:"attr",init:function(e,t,o,i,s){var r,a,l;this.tween=o;for(r in t)l=e.getAttribute(r)||"",a=this.add(e,"setAttribute",(l||0)+"",t[r],i,s,0,0,r),a.op=r,a.b=l,this._props.push(r)},render:function(e,t){for(var o=t._pt;o;)_reverting$1?o.set(o.t,o.p,o.b,o):o.r(e,o.d),o=o._next}},{name:"endArray",headless:1,init:function(e,t){for(var o=t.length;o--;)this.add(e,o,e[o]||0,t[o],0,0,0,0,0,1)}},_buildModifierPlugin("roundProps",_roundModifier),_buildModifierPlugin("modifiers"),_buildModifierPlugin("snap",snap))||_gsap;Tween.version=Timeline.version=gsap.version="3.13.0";_coreReady=1;_windowExists$1()&&_wake();_easeMap.Power0;_easeMap.Power1;_easeMap.Power2;_easeMap.Power3;_easeMap.Power4;_easeMap.Linear;_easeMap.Quad;_easeMap.Cubic;_easeMap.Quart;_easeMap.Quint;_easeMap.Strong;_easeMap.Elastic;_easeMap.Back;_easeMap.SteppedEase;_easeMap.Bounce;_easeMap.Sine;_easeMap.Expo;_easeMap.Circ;/*!
 * CSSPlugin 3.13.0
 * https://gsap.com
 *
 * Copyright 2008-2025, GreenSock. All rights reserved.
 * Subject to the terms at https://gsap.com/standard-license
 * @author: Jack Doyle, jack@greensock.com
*/var _win,_doc,_docElement,_pluginInitted,_tempDiv,_recentSetterPlugin,_reverting,_windowExists=function(){return typeof window<"u"},_transformProps={},_RAD2DEG=180/Math.PI,_DEG2RAD=Math.PI/180,_atan2=Math.atan2,_bigNum=1e8,_capsExp=/([A-Z])/g,_horizontalExp=/(left|right|width|margin|padding|x)/i,_complexExp=/[\s,\(]\S/,_propertyAliases={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},_renderCSSProp=function(e,t){return t.set(t.t,t.p,Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},_renderPropWithEnd=function(e,t){return t.set(t.t,t.p,e===1?t.e:Math.round((t.s+t.c*e)*1e4)/1e4+t.u,t)},_renderCSSPropWithBeginning=function(e,t){return t.set(t.t,t.p,e?Math.round((t.s+t.c*e)*1e4)/1e4+t.u:t.b,t)},_renderRoundedCSSProp=function(e,t){var o=t.s+t.c*e;t.set(t.t,t.p,~~(o+(o<0?-.5:.5))+t.u,t)},_renderNonTweeningValue=function(e,t){return t.set(t.t,t.p,e?t.e:t.b,t)},_renderNonTweeningValueOnlyAtEnd=function(e,t){return t.set(t.t,t.p,e!==1?t.b:t.e,t)},_setterCSSStyle=function(e,t,o){return e.style[t]=o},_setterCSSProp=function(e,t,o){return e.style.setProperty(t,o)},_setterTransform=function(e,t,o){return e._gsap[t]=o},_setterScale=function(e,t,o){return e._gsap.scaleX=e._gsap.scaleY=o},_setterScaleWithRender=function(e,t,o,i,s){var r=e._gsap;r.scaleX=r.scaleY=o,r.renderTransform(s,r)},_setterTransformWithRender=function(e,t,o,i,s){var r=e._gsap;r[t]=o,r.renderTransform(s,r)},_transformProp="transform",_transformOriginProp=_transformProp+"Origin",_saveStyle=function n(e,t){var o=this,i=this.target,s=i.style,r=i._gsap;if(e in _transformProps&&s){if(this.tfm=this.tfm||{},e!=="transform")e=_propertyAliases[e]||e,~e.indexOf(",")?e.split(",").forEach(function(a){return o.tfm[a]=_get(i,a)}):this.tfm[e]=r.x?r[e]:_get(i,e),e===_transformOriginProp&&(this.tfm.zOrigin=r.zOrigin);else return _propertyAliases.transform.split(",").forEach(function(a){return n.call(o,a,t)});if(this.props.indexOf(_transformProp)>=0)return;r.svg&&(this.svgo=i.getAttribute("data-svg-origin"),this.props.push(_transformOriginProp,t,"")),e=_transformProp}(s||t)&&this.props.push(e,t,s[e])},_removeIndependentTransforms=function(e){e.translate&&(e.removeProperty("translate"),e.removeProperty("scale"),e.removeProperty("rotate"))},_revertStyle=function(){var e=this.props,t=this.target,o=t.style,i=t._gsap,s,r;for(s=0;s<e.length;s+=3)e[s+1]?e[s+1]===2?t[e[s]](e[s+2]):t[e[s]]=e[s+2]:e[s+2]?o[e[s]]=e[s+2]:o.removeProperty(e[s].substr(0,2)==="--"?e[s]:e[s].replace(_capsExp,"-$1").toLowerCase());if(this.tfm){for(r in this.tfm)i[r]=this.tfm[r];i.svg&&(i.renderTransform(),t.setAttribute("data-svg-origin",this.svgo||"")),s=_reverting(),(!s||!s.isStart)&&!o[_transformProp]&&(_removeIndependentTransforms(o),i.zOrigin&&o[_transformOriginProp]&&(o[_transformOriginProp]+=" "+i.zOrigin+"px",i.zOrigin=0,i.renderTransform()),i.uncache=1)}},_getStyleSaver=function(e,t){var o={target:e,props:[],revert:_revertStyle,save:_saveStyle};return e._gsap||gsap.core.getCache(e),t&&e.style&&e.nodeType&&t.split(",").forEach(function(i){return o.save(i)}),o},_supports3D,_createElement=function(e,t){var o=_doc.createElementNS?_doc.createElementNS((t||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),e):_doc.createElement(e);return o&&o.style?o:_doc.createElement(e)},_getComputedProperty=function n(e,t,o){var i=getComputedStyle(e);return i[t]||i.getPropertyValue(t.replace(_capsExp,"-$1").toLowerCase())||i.getPropertyValue(t)||!o&&n(e,_checkPropPrefix(t)||t,1)||""},_prefixes="O,Moz,ms,Ms,Webkit".split(","),_checkPropPrefix=function(e,t,o){var i=t||_tempDiv,s=i.style,r=5;if(e in s&&!o)return e;for(e=e.charAt(0).toUpperCase()+e.substr(1);r--&&!(_prefixes[r]+e in s););return r<0?null:(r===3?"ms":r>=0?_prefixes[r]:"")+e},_initCore=function(){_windowExists()&&window.document&&(_win=window,_doc=_win.document,_docElement=_doc.documentElement,_tempDiv=_createElement("div")||{style:{}},_createElement("div"),_transformProp=_checkPropPrefix(_transformProp),_transformOriginProp=_transformProp+"Origin",_tempDiv.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",_supports3D=!!_checkPropPrefix("perspective"),_reverting=gsap.core.reverting,_pluginInitted=1)},_getReparentedCloneBBox=function(e){var t=e.ownerSVGElement,o=_createElement("svg",t&&t.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),i=e.cloneNode(!0),s;i.style.display="block",o.appendChild(i),_docElement.appendChild(o);try{s=i.getBBox()}catch{}return o.removeChild(i),_docElement.removeChild(o),s},_getAttributeFallbacks=function(e,t){for(var o=t.length;o--;)if(e.hasAttribute(t[o]))return e.getAttribute(t[o])},_getBBox=function(e){var t,o;try{t=e.getBBox()}catch{t=_getReparentedCloneBBox(e),o=1}return t&&(t.width||t.height)||o||(t=_getReparentedCloneBBox(e)),t&&!t.width&&!t.x&&!t.y?{x:+_getAttributeFallbacks(e,["x","cx","x1"])||0,y:+_getAttributeFallbacks(e,["y","cy","y1"])||0,width:0,height:0}:t},_isSVG=function(e){return!!(e.getCTM&&(!e.parentNode||e.ownerSVGElement)&&_getBBox(e))},_removeProperty=function(e,t){if(t){var o=e.style,i;t in _transformProps&&t!==_transformOriginProp&&(t=_transformProp),o.removeProperty?(i=t.substr(0,2),(i==="ms"||t.substr(0,6)==="webkit")&&(t="-"+t),o.removeProperty(i==="--"?t:t.replace(_capsExp,"-$1").toLowerCase())):o.removeAttribute(t)}},_addNonTweeningPT=function(e,t,o,i,s,r){var a=new PropTween(e._pt,t,o,0,1,r?_renderNonTweeningValueOnlyAtEnd:_renderNonTweeningValue);return e._pt=a,a.b=i,a.e=s,e._props.push(o),a},_nonConvertibleUnits={deg:1,rad:1,turn:1},_nonStandardLayouts={grid:1,flex:1},_convertToUnit=function n(e,t,o,i){var s=parseFloat(o)||0,r=(o+"").trim().substr((s+"").length)||"px",a=_tempDiv.style,l=_horizontalExp.test(t),c=e.tagName.toLowerCase()==="svg",d=(c?"client":"offset")+(l?"Width":"Height"),u=100,f=i==="px",h=i==="%",m,p,v,g;if(i===r||!s||_nonConvertibleUnits[i]||_nonConvertibleUnits[r])return s;if(r!=="px"&&!f&&(s=n(e,t,o,"px")),g=e.getCTM&&_isSVG(e),(h||r==="%")&&(_transformProps[t]||~t.indexOf("adius")))return m=g?e.getBBox()[l?"width":"height"]:e[d],_round(h?s/m*u:s/100*m);if(a[l?"width":"height"]=u+(f?r:i),p=i!=="rem"&&~t.indexOf("adius")||i==="em"&&e.appendChild&&!c?e:e.parentNode,g&&(p=(e.ownerSVGElement||{}).parentNode),(!p||p===_doc||!p.appendChild)&&(p=_doc.body),v=p._gsap,v&&h&&v.width&&l&&v.time===_ticker.time&&!v.uncache)return _round(s/v.width*u);if(h&&(t==="height"||t==="width")){var y=e.style[t];e.style[t]=u+i,m=e[d],y?e.style[t]=y:_removeProperty(e,t)}else(h||r==="%")&&!_nonStandardLayouts[_getComputedProperty(p,"display")]&&(a.position=_getComputedProperty(e,"position")),p===e&&(a.position="static"),p.appendChild(_tempDiv),m=_tempDiv[d],p.removeChild(_tempDiv),a.position="absolute";return l&&h&&(v=_getCache(p),v.time=_ticker.time,v.width=p[d]),_round(f?m*s/u:m&&s?u/m*s:0)},_get=function(e,t,o,i){var s;return _pluginInitted||_initCore(),t in _propertyAliases&&t!=="transform"&&(t=_propertyAliases[t],~t.indexOf(",")&&(t=t.split(",")[0])),_transformProps[t]&&t!=="transform"?(s=_parseTransform(e,i),s=t!=="transformOrigin"?s[t]:s.svg?s.origin:_firstTwoOnly(_getComputedProperty(e,_transformOriginProp))+" "+s.zOrigin+"px"):(s=e.style[t],(!s||s==="auto"||i||~(s+"").indexOf("calc("))&&(s=_specialProps[t]&&_specialProps[t](e,t,o)||_getComputedProperty(e,t)||_getProperty(e,t)||(t==="opacity"?1:0))),o&&!~(s+"").trim().indexOf(" ")?_convertToUnit(e,t,s,o)+o:s},_tweenComplexCSSString=function(e,t,o,i){if(!o||o==="none"){var s=_checkPropPrefix(t,e,1),r=s&&_getComputedProperty(e,s,1);r&&r!==o?(t=s,o=r):t==="borderColor"&&(o=_getComputedProperty(e,"borderTopColor"))}var a=new PropTween(this._pt,e.style,t,0,1,_renderComplexString),l=0,c=0,d,u,f,h,m,p,v,g,y,w,_,S;if(a.b=o,a.e=i,o+="",i+="",i.substring(0,6)==="var(--"&&(i=_getComputedProperty(e,i.substring(4,i.indexOf(")")))),i==="auto"&&(p=e.style[t],e.style[t]=i,i=_getComputedProperty(e,t)||i,p?e.style[t]=p:_removeProperty(e,t)),d=[o,i],_colorStringFilter(d),o=d[0],i=d[1],f=o.match(_numWithUnitExp)||[],S=i.match(_numWithUnitExp)||[],S.length){for(;u=_numWithUnitExp.exec(i);)v=u[0],y=i.substring(l,u.index),m?m=(m+1)%5:(y.substr(-5)==="rgba("||y.substr(-5)==="hsla(")&&(m=1),v!==(p=f[c++]||"")&&(h=parseFloat(p)||0,_=p.substr((h+"").length),v.charAt(1)==="="&&(v=_parseRelative(h,v)+_),g=parseFloat(v),w=v.substr((g+"").length),l=_numWithUnitExp.lastIndex-w.length,w||(w=w||_config.units[t]||_,l===i.length&&(i+=w,a.e+=w)),_!==w&&(h=_convertToUnit(e,t,p,w)||0),a._pt={_next:a._pt,p:y||c===1?y:",",s:h,c:g-h,m:m&&m<4||t==="zIndex"?Math.round:0});a.c=l<i.length?i.substring(l,i.length):""}else a.r=t==="display"&&i==="none"?_renderNonTweeningValueOnlyAtEnd:_renderNonTweeningValue;return _relExp.test(i)&&(a.e=0),this._pt=a,a},_keywordToPercent={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},_convertKeywordsToPercentages=function(e){var t=e.split(" "),o=t[0],i=t[1]||"50%";return(o==="top"||o==="bottom"||i==="left"||i==="right")&&(e=o,o=i,i=e),t[0]=_keywordToPercent[o]||o,t[1]=_keywordToPercent[i]||i,t.join(" ")},_renderClearProps=function(e,t){if(t.tween&&t.tween._time===t.tween._dur){var o=t.t,i=o.style,s=t.u,r=o._gsap,a,l,c;if(s==="all"||s===!0)i.cssText="",l=1;else for(s=s.split(","),c=s.length;--c>-1;)a=s[c],_transformProps[a]&&(l=1,a=a==="transformOrigin"?_transformOriginProp:_transformProp),_removeProperty(o,a);l&&(_removeProperty(o,_transformProp),r&&(r.svg&&o.removeAttribute("transform"),i.scale=i.rotate=i.translate="none",_parseTransform(o,1),r.uncache=1,_removeIndependentTransforms(i)))}},_specialProps={clearProps:function(e,t,o,i,s){if(s.data!=="isFromStart"){var r=e._pt=new PropTween(e._pt,t,o,0,0,_renderClearProps);return r.u=i,r.pr=-10,r.tween=s,e._props.push(o),1}}},_identity2DMatrix=[1,0,0,1,0,0],_rotationalProperties={},_isNullTransform=function(e){return e==="matrix(1, 0, 0, 1, 0, 0)"||e==="none"||!e},_getComputedTransformMatrixAsArray=function(e){var t=_getComputedProperty(e,_transformProp);return _isNullTransform(t)?_identity2DMatrix:t.substr(7).match(_numExp).map(_round)},_getMatrix=function(e,t){var o=e._gsap||_getCache(e),i=e.style,s=_getComputedTransformMatrixAsArray(e),r,a,l,c;return o.svg&&e.getAttribute("transform")?(l=e.transform.baseVal.consolidate().matrix,s=[l.a,l.b,l.c,l.d,l.e,l.f],s.join(",")==="1,0,0,1,0,0"?_identity2DMatrix:s):(s===_identity2DMatrix&&!e.offsetParent&&e!==_docElement&&!o.svg&&(l=i.display,i.display="block",r=e.parentNode,(!r||!e.offsetParent&&!e.getBoundingClientRect().width)&&(c=1,a=e.nextElementSibling,_docElement.appendChild(e)),s=_getComputedTransformMatrixAsArray(e),l?i.display=l:_removeProperty(e,"display"),c&&(a?r.insertBefore(e,a):r?r.appendChild(e):_docElement.removeChild(e))),t&&s.length>6?[s[0],s[1],s[4],s[5],s[12],s[13]]:s)},_applySVGOrigin=function(e,t,o,i,s,r){var a=e._gsap,l=s||_getMatrix(e,!0),c=a.xOrigin||0,d=a.yOrigin||0,u=a.xOffset||0,f=a.yOffset||0,h=l[0],m=l[1],p=l[2],v=l[3],g=l[4],y=l[5],w=t.split(" "),_=parseFloat(w[0])||0,S=parseFloat(w[1])||0,C,A,E,k;o?l!==_identity2DMatrix&&(A=h*v-m*p)&&(E=_*(v/A)+S*(-p/A)+(p*y-v*g)/A,k=_*(-m/A)+S*(h/A)-(h*y-m*g)/A,_=E,S=k):(C=_getBBox(e),_=C.x+(~w[0].indexOf("%")?_/100*C.width:_),S=C.y+(~(w[1]||w[0]).indexOf("%")?S/100*C.height:S)),i||i!==!1&&a.smooth?(g=_-c,y=S-d,a.xOffset=u+(g*h+y*p)-g,a.yOffset=f+(g*m+y*v)-y):a.xOffset=a.yOffset=0,a.xOrigin=_,a.yOrigin=S,a.smooth=!!i,a.origin=t,a.originIsAbsolute=!!o,e.style[_transformOriginProp]="0px 0px",r&&(_addNonTweeningPT(r,a,"xOrigin",c,_),_addNonTweeningPT(r,a,"yOrigin",d,S),_addNonTweeningPT(r,a,"xOffset",u,a.xOffset),_addNonTweeningPT(r,a,"yOffset",f,a.yOffset)),e.setAttribute("data-svg-origin",_+" "+S)},_parseTransform=function(e,t){var o=e._gsap||new GSCache(e);if("x"in o&&!t&&!o.uncache)return o;var i=e.style,s=o.scaleX<0,r="px",a="deg",l=getComputedStyle(e),c=_getComputedProperty(e,_transformOriginProp)||"0",d,u,f,h,m,p,v,g,y,w,_,S,C,A,E,k,I,F,M,R,O,$,T,D,P,L,B,b,z,N,G,K;return d=u=f=p=v=g=y=w=_=0,h=m=1,o.svg=!!(e.getCTM&&_isSVG(e)),l.translate&&((l.translate!=="none"||l.scale!=="none"||l.rotate!=="none")&&(i[_transformProp]=(l.translate!=="none"?"translate3d("+(l.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(l.rotate!=="none"?"rotate("+l.rotate+") ":"")+(l.scale!=="none"?"scale("+l.scale.split(" ").join(",")+") ":"")+(l[_transformProp]!=="none"?l[_transformProp]:"")),i.scale=i.rotate=i.translate="none"),A=_getMatrix(e,o.svg),o.svg&&(o.uncache?(P=e.getBBox(),c=o.xOrigin-P.x+"px "+(o.yOrigin-P.y)+"px",D=""):D=!t&&e.getAttribute("data-svg-origin"),_applySVGOrigin(e,D||c,!!D||o.originIsAbsolute,o.smooth!==!1,A)),S=o.xOrigin||0,C=o.yOrigin||0,A!==_identity2DMatrix&&(F=A[0],M=A[1],R=A[2],O=A[3],d=$=A[4],u=T=A[5],A.length===6?(h=Math.sqrt(F*F+M*M),m=Math.sqrt(O*O+R*R),p=F||M?_atan2(M,F)*_RAD2DEG:0,y=R||O?_atan2(R,O)*_RAD2DEG+p:0,y&&(m*=Math.abs(Math.cos(y*_DEG2RAD))),o.svg&&(d-=S-(S*F+C*R),u-=C-(S*M+C*O))):(K=A[6],N=A[7],B=A[8],b=A[9],z=A[10],G=A[11],d=A[12],u=A[13],f=A[14],E=_atan2(K,z),v=E*_RAD2DEG,E&&(k=Math.cos(-E),I=Math.sin(-E),D=$*k+B*I,P=T*k+b*I,L=K*k+z*I,B=$*-I+B*k,b=T*-I+b*k,z=K*-I+z*k,G=N*-I+G*k,$=D,T=P,K=L),E=_atan2(-R,z),g=E*_RAD2DEG,E&&(k=Math.cos(-E),I=Math.sin(-E),D=F*k-B*I,P=M*k-b*I,L=R*k-z*I,G=O*I+G*k,F=D,M=P,R=L),E=_atan2(M,F),p=E*_RAD2DEG,E&&(k=Math.cos(E),I=Math.sin(E),D=F*k+M*I,P=$*k+T*I,M=M*k-F*I,T=T*k-$*I,F=D,$=P),v&&Math.abs(v)+Math.abs(p)>359.9&&(v=p=0,g=180-g),h=_round(Math.sqrt(F*F+M*M+R*R)),m=_round(Math.sqrt(T*T+K*K)),E=_atan2($,T),y=Math.abs(E)>2e-4?E*_RAD2DEG:0,_=G?1/(G<0?-G:G):0),o.svg&&(D=e.getAttribute("transform"),o.forceCSS=e.setAttribute("transform","")||!_isNullTransform(_getComputedProperty(e,_transformProp)),D&&e.setAttribute("transform",D))),Math.abs(y)>90&&Math.abs(y)<270&&(s?(h*=-1,y+=p<=0?180:-180,p+=p<=0?180:-180):(m*=-1,y+=y<=0?180:-180)),t=t||o.uncache,o.x=d-((o.xPercent=d&&(!t&&o.xPercent||(Math.round(e.offsetWidth/2)===Math.round(-d)?-50:0)))?e.offsetWidth*o.xPercent/100:0)+r,o.y=u-((o.yPercent=u&&(!t&&o.yPercent||(Math.round(e.offsetHeight/2)===Math.round(-u)?-50:0)))?e.offsetHeight*o.yPercent/100:0)+r,o.z=f+r,o.scaleX=_round(h),o.scaleY=_round(m),o.rotation=_round(p)+a,o.rotationX=_round(v)+a,o.rotationY=_round(g)+a,o.skewX=y+a,o.skewY=w+a,o.transformPerspective=_+r,(o.zOrigin=parseFloat(c.split(" ")[2])||!t&&o.zOrigin||0)&&(i[_transformOriginProp]=_firstTwoOnly(c)),o.xOffset=o.yOffset=0,o.force3D=_config.force3D,o.renderTransform=o.svg?_renderSVGTransforms:_supports3D?_renderCSSTransforms:_renderNon3DTransforms,o.uncache=0,o},_firstTwoOnly=function(e){return(e=e.split(" "))[0]+" "+e[1]},_addPxTranslate=function(e,t,o){var i=getUnit(t);return _round(parseFloat(t)+parseFloat(_convertToUnit(e,"x",o+"px",i)))+i},_renderNon3DTransforms=function(e,t){t.z="0px",t.rotationY=t.rotationX="0deg",t.force3D=0,_renderCSSTransforms(e,t)},_zeroDeg="0deg",_zeroPx="0px",_endParenthesis=") ",_renderCSSTransforms=function(e,t){var o=t||this,i=o.xPercent,s=o.yPercent,r=o.x,a=o.y,l=o.z,c=o.rotation,d=o.rotationY,u=o.rotationX,f=o.skewX,h=o.skewY,m=o.scaleX,p=o.scaleY,v=o.transformPerspective,g=o.force3D,y=o.target,w=o.zOrigin,_="",S=g==="auto"&&e&&e!==1||g===!0;if(w&&(u!==_zeroDeg||d!==_zeroDeg)){var C=parseFloat(d)*_DEG2RAD,A=Math.sin(C),E=Math.cos(C),k;C=parseFloat(u)*_DEG2RAD,k=Math.cos(C),r=_addPxTranslate(y,r,A*k*-w),a=_addPxTranslate(y,a,-Math.sin(C)*-w),l=_addPxTranslate(y,l,E*k*-w+w)}v!==_zeroPx&&(_+="perspective("+v+_endParenthesis),(i||s)&&(_+="translate("+i+"%, "+s+"%) "),(S||r!==_zeroPx||a!==_zeroPx||l!==_zeroPx)&&(_+=l!==_zeroPx||S?"translate3d("+r+", "+a+", "+l+") ":"translate("+r+", "+a+_endParenthesis),c!==_zeroDeg&&(_+="rotate("+c+_endParenthesis),d!==_zeroDeg&&(_+="rotateY("+d+_endParenthesis),u!==_zeroDeg&&(_+="rotateX("+u+_endParenthesis),(f!==_zeroDeg||h!==_zeroDeg)&&(_+="skew("+f+", "+h+_endParenthesis),(m!==1||p!==1)&&(_+="scale("+m+", "+p+_endParenthesis),y.style[_transformProp]=_||"translate(0, 0)"},_renderSVGTransforms=function(e,t){var o=t||this,i=o.xPercent,s=o.yPercent,r=o.x,a=o.y,l=o.rotation,c=o.skewX,d=o.skewY,u=o.scaleX,f=o.scaleY,h=o.target,m=o.xOrigin,p=o.yOrigin,v=o.xOffset,g=o.yOffset,y=o.forceCSS,w=parseFloat(r),_=parseFloat(a),S,C,A,E,k;l=parseFloat(l),c=parseFloat(c),d=parseFloat(d),d&&(d=parseFloat(d),c+=d,l+=d),l||c?(l*=_DEG2RAD,c*=_DEG2RAD,S=Math.cos(l)*u,C=Math.sin(l)*u,A=Math.sin(l-c)*-f,E=Math.cos(l-c)*f,c&&(d*=_DEG2RAD,k=Math.tan(c-d),k=Math.sqrt(1+k*k),A*=k,E*=k,d&&(k=Math.tan(d),k=Math.sqrt(1+k*k),S*=k,C*=k)),S=_round(S),C=_round(C),A=_round(A),E=_round(E)):(S=u,E=f,C=A=0),(w&&!~(r+"").indexOf("px")||_&&!~(a+"").indexOf("px"))&&(w=_convertToUnit(h,"x",r,"px"),_=_convertToUnit(h,"y",a,"px")),(m||p||v||g)&&(w=_round(w+m-(m*S+p*A)+v),_=_round(_+p-(m*C+p*E)+g)),(i||s)&&(k=h.getBBox(),w=_round(w+i/100*k.width),_=_round(_+s/100*k.height)),k="matrix("+S+","+C+","+A+","+E+","+w+","+_+")",h.setAttribute("transform",k),y&&(h.style[_transformProp]=k)},_addRotationalPropTween=function(e,t,o,i,s){var r=360,a=_isString(s),l=parseFloat(s)*(a&&~s.indexOf("rad")?_RAD2DEG:1),c=l-i,d=i+c+"deg",u,f;return a&&(u=s.split("_")[1],u==="short"&&(c%=r,c!==c%(r/2)&&(c+=c<0?r:-r)),u==="cw"&&c<0?c=(c+r*_bigNum)%r-~~(c/r)*r:u==="ccw"&&c>0&&(c=(c-r*_bigNum)%r-~~(c/r)*r)),e._pt=f=new PropTween(e._pt,t,o,i,c,_renderPropWithEnd),f.e=d,f.u="deg",e._props.push(o),f},_assign=function(e,t){for(var o in t)e[o]=t[o];return e},_addRawTransformPTs=function(e,t,o){var i=_assign({},o._gsap),s="perspective,force3D,transformOrigin,svgOrigin",r=o.style,a,l,c,d,u,f,h,m;i.svg?(c=o.getAttribute("transform"),o.setAttribute("transform",""),r[_transformProp]=t,a=_parseTransform(o,1),_removeProperty(o,_transformProp),o.setAttribute("transform",c)):(c=getComputedStyle(o)[_transformProp],r[_transformProp]=t,a=_parseTransform(o,1),r[_transformProp]=c);for(l in _transformProps)c=i[l],d=a[l],c!==d&&s.indexOf(l)<0&&(h=getUnit(c),m=getUnit(d),u=h!==m?_convertToUnit(o,l,c,m):parseFloat(c),f=parseFloat(d),e._pt=new PropTween(e._pt,a,l,u,f-u,_renderCSSProp),e._pt.u=m||0,e._props.push(l));_assign(a,i)};_forEachName("padding,margin,Width,Radius",function(n,e){var t="Top",o="Right",i="Bottom",s="Left",r=(e<3?[t,o,i,s]:[t+s,t+o,i+o,i+s]).map(function(a){return e<2?n+a:"border"+a+n});_specialProps[e>1?"border"+n:n]=function(a,l,c,d,u){var f,h;if(arguments.length<4)return f=r.map(function(m){return _get(a,m,c)}),h=f.join(" "),h.split(f[0]).length===5?f[0]:h;f=(d+"").split(" "),h={},r.forEach(function(m,p){return h[m]=f[p]=f[p]||f[(p-1)/2|0]}),a.init(l,h,u)}});var CSSPlugin={name:"css",register:_initCore,targetTest:function(e){return e.style&&e.nodeType},init:function(e,t,o,i,s){var r=this._props,a=e.style,l=o.vars.startAt,c,d,u,f,h,m,p,v,g,y,w,_,S,C,A,E;_pluginInitted||_initCore(),this.styles=this.styles||_getStyleSaver(e),E=this.styles.props,this.tween=o;for(p in t)if(p!=="autoRound"&&(d=t[p],!(_plugins[p]&&_checkPlugin(p,t,o,i,e,s)))){if(h=typeof d,m=_specialProps[p],h==="function"&&(d=d.call(o,i,e,s),h=typeof d),h==="string"&&~d.indexOf("random(")&&(d=_replaceRandom(d)),m)m(this,e,p,d,o)&&(A=1);else if(p.substr(0,2)==="--")c=(getComputedStyle(e).getPropertyValue(p)+"").trim(),d+="",_colorExp.lastIndex=0,_colorExp.test(c)||(v=getUnit(c),g=getUnit(d)),g?v!==g&&(c=_convertToUnit(e,p,c,g)+g):v&&(d+=v),this.add(a,"setProperty",c,d,i,s,0,0,p),r.push(p),E.push(p,0,a[p]);else if(h!=="undefined"){if(l&&p in l?(c=typeof l[p]=="function"?l[p].call(o,i,e,s):l[p],_isString(c)&&~c.indexOf("random(")&&(c=_replaceRandom(c)),getUnit(c+"")||c==="auto"||(c+=_config.units[p]||getUnit(_get(e,p))||""),(c+"").charAt(1)==="="&&(c=_get(e,p))):c=_get(e,p),f=parseFloat(c),y=h==="string"&&d.charAt(1)==="="&&d.substr(0,2),y&&(d=d.substr(2)),u=parseFloat(d),p in _propertyAliases&&(p==="autoAlpha"&&(f===1&&_get(e,"visibility")==="hidden"&&u&&(f=0),E.push("visibility",0,a.visibility),_addNonTweeningPT(this,a,"visibility",f?"inherit":"hidden",u?"inherit":"hidden",!u)),p!=="scale"&&p!=="transform"&&(p=_propertyAliases[p],~p.indexOf(",")&&(p=p.split(",")[0]))),w=p in _transformProps,w){if(this.styles.save(p),h==="string"&&d.substring(0,6)==="var(--"&&(d=_getComputedProperty(e,d.substring(4,d.indexOf(")"))),u=parseFloat(d)),_||(S=e._gsap,S.renderTransform&&!t.parseTransform||_parseTransform(e,t.parseTransform),C=t.smoothOrigin!==!1&&S.smooth,_=this._pt=new PropTween(this._pt,a,_transformProp,0,1,S.renderTransform,S,0,-1),_.dep=1),p==="scale")this._pt=new PropTween(this._pt,S,"scaleY",S.scaleY,(y?_parseRelative(S.scaleY,y+u):u)-S.scaleY||0,_renderCSSProp),this._pt.u=0,r.push("scaleY",p),p+="X";else if(p==="transformOrigin"){E.push(_transformOriginProp,0,a[_transformOriginProp]),d=_convertKeywordsToPercentages(d),S.svg?_applySVGOrigin(e,d,0,C,0,this):(g=parseFloat(d.split(" ")[2])||0,g!==S.zOrigin&&_addNonTweeningPT(this,S,"zOrigin",S.zOrigin,g),_addNonTweeningPT(this,a,p,_firstTwoOnly(c),_firstTwoOnly(d)));continue}else if(p==="svgOrigin"){_applySVGOrigin(e,d,1,C,0,this);continue}else if(p in _rotationalProperties){_addRotationalPropTween(this,S,p,f,y?_parseRelative(f,y+d):d);continue}else if(p==="smoothOrigin"){_addNonTweeningPT(this,S,"smooth",S.smooth,d);continue}else if(p==="force3D"){S[p]=d;continue}else if(p==="transform"){_addRawTransformPTs(this,d,e);continue}}else p in a||(p=_checkPropPrefix(p)||p);if(w||(u||u===0)&&(f||f===0)&&!_complexExp.test(d)&&p in a)v=(c+"").substr((f+"").length),u||(u=0),g=getUnit(d)||(p in _config.units?_config.units[p]:v),v!==g&&(f=_convertToUnit(e,p,c,g)),this._pt=new PropTween(this._pt,w?S:a,p,f,(y?_parseRelative(f,y+u):u)-f,!w&&(g==="px"||p==="zIndex")&&t.autoRound!==!1?_renderRoundedCSSProp:_renderCSSProp),this._pt.u=g||0,v!==g&&g!=="%"&&(this._pt.b=c,this._pt.r=_renderCSSPropWithBeginning);else if(p in a)_tweenComplexCSSString.call(this,e,p,c,y?y+d:d);else if(p in e)this.add(e,p,c||e[p],y?y+d:d,i,s);else if(p!=="parseTransform"){_missingPlugin(p,d);continue}w||(p in a?E.push(p,0,a[p]):typeof e[p]=="function"?E.push(p,2,e[p]()):E.push(p,1,c||e[p])),r.push(p)}}A&&_sortPropTweensByPriority(this)},render:function(e,t){if(t.tween._time||!_reverting())for(var o=t._pt;o;)o.r(e,o.d),o=o._next;else t.styles.revert()},get:_get,aliases:_propertyAliases,getSetter:function(e,t,o){var i=_propertyAliases[t];return i&&i.indexOf(",")<0&&(t=i),t in _transformProps&&t!==_transformOriginProp&&(e._gsap.x||_get(e,"x"))?o&&_recentSetterPlugin===o?t==="scale"?_setterScale:_setterTransform:(_recentSetterPlugin=o||{})&&(t==="scale"?_setterScaleWithRender:_setterTransformWithRender):e.style&&!_isUndefined(e.style[t])?_setterCSSStyle:~t.indexOf("-")?_setterCSSProp:_getSetter(e,t)},core:{_removeProperty,_getMatrix}};gsap.utils.checkPrefix=_checkPropPrefix;gsap.core.getStyleSaver=_getStyleSaver;(function(n,e,t,o){var i=_forEachName(n+","+e+","+t,function(s){_transformProps[s]=1});_forEachName(e,function(s){_config.units[s]="deg",_rotationalProperties[s]=1}),_propertyAliases[i[13]]=n+","+e,_forEachName(o,function(s){var r=s.split(":");_propertyAliases[r[1]]=i[r[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");_forEachName("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(n){_config.units[n]="px"});gsap.registerPlugin(CSSPlugin);var gsapWithCSS=gsap.registerPlugin(CSSPlugin)||gsap;gsapWithCSS.core.Tween;function rotateCameraOnce(n,e=new Vector3$1(0,0,0),t=200,o=.08,i=30){return new Promise(s=>{let r=0;function a(){r+=o;const l=e.x+t*Math.cos(r),c=e.z+t*Math.sin(r);n.position.set(l,i,c),n.lookAt(e),r<Math.PI*2?requestAnimationFrame(a):(n.position.set(e.x+t*Math.cos(Math.PI*2),i,e.z+t*Math.sin(Math.PI*2)),n.lookAt(e),s())}a()})}const CENTER$1=0,AVERAGE=1,SAH=2,CONTAINED=2,TRIANGLE_INTERSECT_COST=1.25,TRAVERSAL_COST=1,BYTES_PER_NODE=6*4+4+4,IS_LEAFNODE_FLAG=65535,FLOAT32_EPSILON=Math.pow(2,-24),SKIP_GENERATION=Symbol("SKIP_GENERATION");function getVertexCount(n){return n.index?n.index.count:n.attributes.position.count}function getTriCount(n){return getVertexCount(n)/3}function getIndexArray(n,e=ArrayBuffer){return n>65535?new Uint32Array(new e(4*n)):new Uint16Array(new e(2*n))}function ensureIndex(n,e){if(!n.index){const t=n.attributes.position.count,o=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=getIndexArray(t,o);n.setIndex(new BufferAttribute(i,1));for(let s=0;s<t;s++)i[s]=s}}function getFullGeometryRange(n,e){const t=getTriCount(n),o=e||n.drawRange,i=o.start/3,s=(o.start+o.count)/3,r=Math.max(0,i),a=Math.min(t,s)-r;return[{offset:Math.floor(r),count:Math.floor(a)}]}function getRootIndexRanges(n,e){if(!n.groups||!n.groups.length)return getFullGeometryRange(n,e);const t=[],o=new Set,i=e||n.drawRange,s=i.start/3,r=(i.start+i.count)/3;for(const l of n.groups){const c=l.start/3,d=(l.start+l.count)/3;o.add(Math.max(s,c)),o.add(Math.min(r,d))}const a=Array.from(o.values()).sort((l,c)=>l-c);for(let l=0;l<a.length-1;l++){const c=a[l],d=a[l+1];t.push({offset:Math.floor(c),count:Math.floor(d-c)})}return t}function hasGroupGaps(n,e){const t=getTriCount(n),o=getRootIndexRanges(n,e).sort((r,a)=>r.offset-a.offset),i=o[o.length-1];i.count=Math.min(t-i.offset,i.count);let s=0;return o.forEach(({count:r})=>s+=r),t!==s}function getBounds(n,e,t,o,i){let s=1/0,r=1/0,a=1/0,l=-1/0,c=-1/0,d=-1/0,u=1/0,f=1/0,h=1/0,m=-1/0,p=-1/0,v=-1/0;for(let g=e*6,y=(e+t)*6;g<y;g+=6){const w=n[g+0],_=n[g+1],S=w-_,C=w+_;S<s&&(s=S),C>l&&(l=C),w<u&&(u=w),w>m&&(m=w);const A=n[g+2],E=n[g+3],k=A-E,I=A+E;k<r&&(r=k),I>c&&(c=I),A<f&&(f=A),A>p&&(p=A);const F=n[g+4],M=n[g+5],R=F-M,O=F+M;R<a&&(a=R),O>d&&(d=O),F<h&&(h=F),F>v&&(v=F)}o[0]=s,o[1]=r,o[2]=a,o[3]=l,o[4]=c,o[5]=d,i[0]=u,i[1]=f,i[2]=h,i[3]=m,i[4]=p,i[5]=v}function computeTriangleBounds(n,e=null,t=null,o=null){const i=n.attributes.position,s=n.index?n.index.array:null,r=getTriCount(n),a=i.normalized;let l;e===null?(l=new Float32Array(r*6),t=0,o=r):(l=e,t=t||0,o=o||r);const c=i.array,d=i.offset||0;let u=3;i.isInterleavedBufferAttribute&&(u=i.data.stride);const f=["getX","getY","getZ"];for(let h=t;h<t+o;h++){const m=h*3,p=h*6;let v=m+0,g=m+1,y=m+2;s&&(v=s[v],g=s[g],y=s[y]),a||(v=v*u+d,g=g*u+d,y=y*u+d);for(let w=0;w<3;w++){let _,S,C;a?(_=i[f[w]](v),S=i[f[w]](g),C=i[f[w]](y)):(_=c[v+w],S=c[g+w],C=c[y+w]);let A=_;S<A&&(A=S),C<A&&(A=C);let E=_;S>E&&(E=S),C>E&&(E=C);const k=(E-A)/2,I=w*2;l[p+I+0]=A+k,l[p+I+1]=k+(Math.abs(A)+k)*FLOAT32_EPSILON}}return l}function arrayToBox(n,e,t){return t.min.x=e[n],t.min.y=e[n+1],t.min.z=e[n+2],t.max.x=e[n+3],t.max.y=e[n+4],t.max.z=e[n+5],t}function getLongestEdgeIndex(n){let e=-1,t=-1/0;for(let o=0;o<3;o++){const i=n[o+3]-n[o];i>t&&(t=i,e=o)}return e}function copyBounds(n,e){e.set(n)}function unionBounds(n,e,t){let o,i;for(let s=0;s<3;s++){const r=s+3;o=n[s],i=e[s],t[s]=o<i?o:i,o=n[r],i=e[r],t[r]=o>i?o:i}}function expandByTriangleBounds(n,e,t){for(let o=0;o<3;o++){const i=e[n+2*o],s=e[n+2*o+1],r=i-s,a=i+s;r<t[o]&&(t[o]=r),a>t[o+3]&&(t[o+3]=a)}}function computeSurfaceArea(n){const e=n[3]-n[0],t=n[4]-n[1],o=n[5]-n[2];return 2*(e*t+t*o+o*e)}const BIN_COUNT=32,binsSort=(n,e)=>n.candidate-e.candidate,sahBins=new Array(BIN_COUNT).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),leftBounds=new Float32Array(6);function getOptimalSplit(n,e,t,o,i,s){let r=-1,a=0;if(s===CENTER$1)r=getLongestEdgeIndex(e),r!==-1&&(a=(e[r]+e[r+3])/2);else if(s===AVERAGE)r=getLongestEdgeIndex(n),r!==-1&&(a=getAverage(t,o,i,r));else if(s===SAH){const l=computeSurfaceArea(n);let c=TRIANGLE_INTERSECT_COST*i;const d=o*6,u=(o+i)*6;for(let f=0;f<3;f++){const h=e[f],v=(e[f+3]-h)/BIN_COUNT;if(i<BIN_COUNT/4){const g=[...sahBins];g.length=i;let y=0;for(let _=d;_<u;_+=6,y++){const S=g[y];S.candidate=t[_+2*f],S.count=0;const{bounds:C,leftCacheBounds:A,rightCacheBounds:E}=S;for(let k=0;k<3;k++)E[k]=1/0,E[k+3]=-1/0,A[k]=1/0,A[k+3]=-1/0,C[k]=1/0,C[k+3]=-1/0;expandByTriangleBounds(_,t,C)}g.sort(binsSort);let w=i;for(let _=0;_<w;_++){const S=g[_];for(;_+1<w&&g[_+1].candidate===S.candidate;)g.splice(_+1,1),w--}for(let _=d;_<u;_+=6){const S=t[_+2*f];for(let C=0;C<w;C++){const A=g[C];S>=A.candidate?expandByTriangleBounds(_,t,A.rightCacheBounds):(expandByTriangleBounds(_,t,A.leftCacheBounds),A.count++)}}for(let _=0;_<w;_++){const S=g[_],C=S.count,A=i-S.count,E=S.leftCacheBounds,k=S.rightCacheBounds;let I=0;C!==0&&(I=computeSurfaceArea(E)/l);let F=0;A!==0&&(F=computeSurfaceArea(k)/l);const M=TRAVERSAL_COST+TRIANGLE_INTERSECT_COST*(I*C+F*A);M<c&&(r=f,c=M,a=S.candidate)}}else{for(let w=0;w<BIN_COUNT;w++){const _=sahBins[w];_.count=0,_.candidate=h+v+w*v;const S=_.bounds;for(let C=0;C<3;C++)S[C]=1/0,S[C+3]=-1/0}for(let w=d;w<u;w+=6){let C=~~((t[w+2*f]-h)/v);C>=BIN_COUNT&&(C=BIN_COUNT-1);const A=sahBins[C];A.count++,expandByTriangleBounds(w,t,A.bounds)}const g=sahBins[BIN_COUNT-1];copyBounds(g.bounds,g.rightCacheBounds);for(let w=BIN_COUNT-2;w>=0;w--){const _=sahBins[w],S=sahBins[w+1];unionBounds(_.bounds,S.rightCacheBounds,_.rightCacheBounds)}let y=0;for(let w=0;w<BIN_COUNT-1;w++){const _=sahBins[w],S=_.count,C=_.bounds,E=sahBins[w+1].rightCacheBounds;S!==0&&(y===0?copyBounds(C,leftBounds):unionBounds(C,leftBounds,leftBounds)),y+=S;let k=0,I=0;y!==0&&(k=computeSurfaceArea(leftBounds)/l);const F=i-y;F!==0&&(I=computeSurfaceArea(E)/l);const M=TRAVERSAL_COST+TRIANGLE_INTERSECT_COST*(k*y+I*F);M<c&&(r=f,c=M,a=_.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${s} used.`);return{axis:r,pos:a}}function getAverage(n,e,t,o){let i=0;for(let s=e,r=e+t;s<r;s++)i+=n[s*6+o*2];return i/t}class MeshBVHNode{constructor(){this.boundingData=new Float32Array(6)}}function partition(n,e,t,o,i,s){let r=o,a=o+i-1;const l=s.pos,c=s.axis*2;for(;;){for(;r<=a&&t[r*6+c]<l;)r++;for(;r<=a&&t[a*6+c]>=l;)a--;if(r<a){for(let d=0;d<3;d++){let u=e[r*3+d];e[r*3+d]=e[a*3+d],e[a*3+d]=u}for(let d=0;d<6;d++){let u=t[r*6+d];t[r*6+d]=t[a*6+d],t[a*6+d]=u}r++,a--}else return r}}function partition_indirect(n,e,t,o,i,s){let r=o,a=o+i-1;const l=s.pos,c=s.axis*2;for(;;){for(;r<=a&&t[r*6+c]<l;)r++;for(;r<=a&&t[a*6+c]>=l;)a--;if(r<a){let d=n[r];n[r]=n[a],n[a]=d;for(let u=0;u<6;u++){let f=t[r*6+u];t[r*6+u]=t[a*6+u],t[a*6+u]=f}r++,a--}else return r}}function IS_LEAF(n,e){return e[n+15]===65535}function OFFSET(n,e){return e[n+6]}function COUNT(n,e){return e[n+14]}function LEFT_NODE(n){return n+8}function RIGHT_NODE(n,e){return e[n+6]}function SPLIT_AXIS(n,e){return e[n+7]}function BOUNDING_DATA_INDEX(n){return n}let float32Array,uint32Array,uint16Array,uint8Array;const MAX_POINTER=Math.pow(2,32);function countNodes(n){return"count"in n?1:1+countNodes(n.left)+countNodes(n.right)}function populateBuffer(n,e,t){return float32Array=new Float32Array(t),uint32Array=new Uint32Array(t),uint16Array=new Uint16Array(t),uint8Array=new Uint8Array(t),_populateBuffer(n,e)}function _populateBuffer(n,e){const t=n/4,o=n/2,i="count"in e,s=e.boundingData;for(let r=0;r<6;r++)float32Array[t+r]=s[r];if(i)if(e.buffer){const r=e.buffer;uint8Array.set(new Uint8Array(r),n);for(let a=n,l=n+r.byteLength;a<l;a+=BYTES_PER_NODE){const c=a/2;IS_LEAF(c,uint16Array)||(uint32Array[a/4+6]+=t)}return n+r.byteLength}else{const r=e.offset,a=e.count;return uint32Array[t+6]=r,uint16Array[o+14]=a,uint16Array[o+15]=IS_LEAFNODE_FLAG,n+BYTES_PER_NODE}else{const r=e.left,a=e.right,l=e.splitAxis;let c;if(c=_populateBuffer(n+BYTES_PER_NODE,r),c/4>MAX_POINTER)throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return uint32Array[t+6]=c/4,c=_populateBuffer(c,a),uint32Array[t+7]=l,c}}function generateIndirectBuffer(n,e){const t=(n.index?n.index.count:n.attributes.position.count)/3,o=t>2**16,i=o?4:2,s=e?new SharedArrayBuffer(t*i):new ArrayBuffer(t*i),r=o?new Uint32Array(s):new Uint16Array(s);for(let a=0,l=r.length;a<l;a++)r[a]=a;return r}function buildTree(n,e,t,o,i){const{maxDepth:s,verbose:r,maxLeafTris:a,strategy:l,onProgress:c,indirect:d}=i,u=n._indirectBuffer,f=n.geometry,h=f.index?f.index.array:null,m=d?partition_indirect:partition,p=getTriCount(f),v=new Float32Array(6);let g=!1;const y=new MeshBVHNode;return getBounds(e,t,o,y.boundingData,v),_(y,t,o,v),y;function w(S){c&&c(S/p)}function _(S,C,A,E=null,k=0){if(!g&&k>=s&&(g=!0,r&&(console.warn(`MeshBVH: Max depth of ${s} reached when generating BVH. Consider increasing maxDepth.`),console.warn(f))),A<=a||k>=s)return w(C+A),S.offset=C,S.count=A,S;const I=getOptimalSplit(S.boundingData,E,e,C,A,l);if(I.axis===-1)return w(C+A),S.offset=C,S.count=A,S;const F=m(u,h,e,C,A,I);if(F===C||F===C+A)w(C+A),S.offset=C,S.count=A;else{S.splitAxis=I.axis;const M=new MeshBVHNode,R=C,O=F-C;S.left=M,getBounds(e,R,O,M.boundingData,v),_(M,R,O,v,k+1);const $=new MeshBVHNode,T=F,D=A-O;S.right=$,getBounds(e,T,D,$.boundingData,v),_($,T,D,v,k+1)}return S}}function buildPackedTree(n,e){const t=n.geometry;e.indirect&&(n._indirectBuffer=generateIndirectBuffer(t,e.useSharedArrayBuffer),hasGroupGaps(t,e.range)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),n._indirectBuffer||ensureIndex(t,e);const o=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,i=computeTriangleBounds(t),s=e.indirect?getFullGeometryRange(t,e.range):getRootIndexRanges(t,e.range);n._roots=s.map(r=>{const a=buildTree(n,i,r.offset,r.count,e),l=countNodes(a),c=new o(BYTES_PER_NODE*l);return populateBuffer(0,a,c),c})}class SeparatingAxisBounds{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let o=1/0,i=-1/0;for(let s=0,r=e.length;s<r;s++){const l=e[s][t];o=l<o?l:o,i=l>i?l:i}this.min=o,this.max=i}setFromPoints(e,t){let o=1/0,i=-1/0;for(let s=0,r=t.length;s<r;s++){const a=t[s],l=e.dot(a);o=l<o?l:o,i=l>i?l:i}this.min=o,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}SeparatingAxisBounds.prototype.setFromBox=function(){const n=new Vector3$1;return function(t,o){const i=o.min,s=o.max;let r=1/0,a=-1/0;for(let l=0;l<=1;l++)for(let c=0;c<=1;c++)for(let d=0;d<=1;d++){n.x=i.x*l+s.x*(1-l),n.y=i.y*c+s.y*(1-c),n.z=i.z*d+s.z*(1-d);const u=t.dot(n);r=Math.min(u,r),a=Math.max(u,a)}this.min=r,this.max=a}}();const closestPointLineToLine=function(){const n=new Vector3$1,e=new Vector3$1,t=new Vector3$1;return function(i,s,r){const a=i.start,l=n,c=s.start,d=e;t.subVectors(a,c),n.subVectors(i.end,i.start),e.subVectors(s.end,s.start);const u=t.dot(d),f=d.dot(l),h=d.dot(d),m=t.dot(l),v=l.dot(l)*h-f*f;let g,y;v!==0?g=(u*f-m*h)/v:g=0,y=(u+g*f)/h,r.x=g,r.y=y}}(),closestPointsSegmentToSegment=function(){const n=new Vector2$1,e=new Vector3$1,t=new Vector3$1;return function(i,s,r,a){closestPointLineToLine(i,s,n);let l=n.x,c=n.y;if(l>=0&&l<=1&&c>=0&&c<=1){i.at(l,r),s.at(c,a);return}else if(l>=0&&l<=1){c<0?s.at(0,a):s.at(1,a),i.closestPointToPoint(a,!0,r);return}else if(c>=0&&c<=1){l<0?i.at(0,r):i.at(1,r),s.closestPointToPoint(r,!0,a);return}else{let d;l<0?d=i.start:d=i.end;let u;c<0?u=s.start:u=s.end;const f=e,h=t;if(i.closestPointToPoint(u,!0,e),s.closestPointToPoint(d,!0,t),f.distanceToSquared(u)<=h.distanceToSquared(d)){r.copy(f),a.copy(u);return}else{r.copy(d),a.copy(h);return}}}}(),sphereIntersectTriangle=function(){const n=new Vector3$1,e=new Vector3$1,t=new Plane,o=new Line3;return function(s,r){const{radius:a,center:l}=s,{a:c,b:d,c:u}=r;if(o.start=c,o.end=d,o.closestPointToPoint(l,!0,n).distanceTo(l)<=a||(o.start=c,o.end=u,o.closestPointToPoint(l,!0,n).distanceTo(l)<=a)||(o.start=d,o.end=u,o.closestPointToPoint(l,!0,n).distanceTo(l)<=a))return!0;const p=r.getPlane(t);if(Math.abs(p.distanceToPoint(l))<=a){const g=p.projectPoint(l,e);if(r.containsPoint(g))return!0}return!1}}(),ZERO_EPSILON=1e-15;function isNearZero(n){return Math.abs(n)<ZERO_EPSILON}class ExtendedTriangle extends Triangle{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new Vector3$1),this.satBounds=new Array(4).fill().map(()=>new SeparatingAxisBounds),this.points=[this.a,this.b,this.c],this.sphere=new Sphere,this.plane=new Plane,this.needsUpdate=!0}intersectsSphere(e){return sphereIntersectTriangle(e,this)}update(){const e=this.a,t=this.b,o=this.c,i=this.points,s=this.satAxes,r=this.satBounds,a=s[0],l=r[0];this.getNormal(a),l.setFromPoints(a,i);const c=s[1],d=r[1];c.subVectors(e,t),d.setFromPoints(c,i);const u=s[2],f=r[2];u.subVectors(t,o),f.setFromPoints(u,i);const h=s[3],m=r[3];h.subVectors(o,e),m.setFromPoints(h,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}}ExtendedTriangle.prototype.closestPointToSegment=function(){const n=new Vector3$1,e=new Vector3$1,t=new Line3;return function(i,s=null,r=null){const{start:a,end:l}=i,c=this.points;let d,u=1/0;for(let f=0;f<3;f++){const h=(f+1)%3;t.start.copy(c[f]),t.end.copy(c[h]),closestPointsSegmentToSegment(t,i,n,e),d=n.distanceToSquared(e),d<u&&(u=d,s&&s.copy(n),r&&r.copy(e))}return this.closestPointToPoint(a,n),d=a.distanceToSquared(n),d<u&&(u=d,s&&s.copy(n),r&&r.copy(a)),this.closestPointToPoint(l,n),d=l.distanceToSquared(n),d<u&&(u=d,s&&s.copy(n),r&&r.copy(l)),Math.sqrt(u)}}();ExtendedTriangle.prototype.intersectsTriangle=function(){const n=new ExtendedTriangle,e=new Array(3),t=new Array(3),o=new SeparatingAxisBounds,i=new SeparatingAxisBounds,s=new Vector3$1,r=new Vector3$1,a=new Vector3$1,l=new Vector3$1,c=new Vector3$1,d=new Line3,u=new Line3,f=new Line3,h=new Vector3$1;function m(p,v,g){const y=p.points;let w=0,_=-1;for(let S=0;S<3;S++){const{start:C,end:A}=d;C.copy(y[S]),A.copy(y[(S+1)%3]),d.delta(r);const E=isNearZero(v.distanceToPoint(C));if(isNearZero(v.normal.dot(r))&&E){g.copy(d),w=2;break}const k=v.intersectLine(d,h);if(!k&&E&&h.copy(C),(k||E)&&!isNearZero(h.distanceTo(A))){if(w<=1)(w===1?g.start:g.end).copy(h),E&&(_=w);else if(w>=2){(_===1?g.start:g.end).copy(h),w=2;break}if(w++,w===2&&_===-1)break}}return w}return function(v,g=null,y=!1){this.needsUpdate&&this.update(),v.isExtendedTriangle?v.needsUpdate&&v.update():(n.copy(v),n.update(),v=n);const w=this.plane,_=v.plane;if(Math.abs(w.normal.dot(_.normal))>1-1e-10){const S=this.satBounds,C=this.satAxes;t[0]=v.a,t[1]=v.b,t[2]=v.c;for(let k=0;k<4;k++){const I=S[k],F=C[k];if(o.setFromPoints(F,t),I.isSeparated(o))return!1}const A=v.satBounds,E=v.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let k=0;k<4;k++){const I=A[k],F=E[k];if(o.setFromPoints(F,e),I.isSeparated(o))return!1}for(let k=0;k<4;k++){const I=C[k];for(let F=0;F<4;F++){const M=E[F];if(s.crossVectors(I,M),o.setFromPoints(s,e),i.setFromPoints(s,t),o.isSeparated(i))return!1}}return g&&(y||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),g.start.set(0,0,0),g.end.set(0,0,0)),!0}else{const S=m(this,_,u);if(S===1&&v.containsPoint(u.end))return g&&(g.start.copy(u.end),g.end.copy(u.end)),!0;if(S!==2)return!1;const C=m(v,w,f);if(C===1&&this.containsPoint(f.end))return g&&(g.start.copy(f.end),g.end.copy(f.end)),!0;if(C!==2)return!1;if(u.delta(a),f.delta(l),a.dot(l)<0){let R=f.start;f.start=f.end,f.end=R}const A=u.start.dot(a),E=u.end.dot(a),k=f.start.dot(a),I=f.end.dot(a),F=E<k,M=A<I;return A!==I&&k!==E&&F===M?!1:(g&&(c.subVectors(u.start,f.start),c.dot(a)>0?g.start.copy(u.start):g.start.copy(f.start),c.subVectors(u.end,f.end),c.dot(a)<0?g.end.copy(u.end):g.end.copy(f.end)),!0)}}}();ExtendedTriangle.prototype.distanceToPoint=function(){const n=new Vector3$1;return function(t){return this.closestPointToPoint(t,n),t.distanceTo(n)}}();ExtendedTriangle.prototype.distanceToTriangle=function(){const n=new Vector3$1,e=new Vector3$1,t=["a","b","c"],o=new Line3,i=new Line3;return function(r,a=null,l=null){const c=a||l?o:null;if(this.intersectsTriangle(r,c))return(a||l)&&(a&&c.getCenter(a),l&&c.getCenter(l)),0;let d=1/0;for(let u=0;u<3;u++){let f;const h=t[u],m=r[h];this.closestPointToPoint(m,n),f=m.distanceToSquared(n),f<d&&(d=f,a&&a.copy(n),l&&l.copy(m));const p=this[h];r.closestPointToPoint(p,n),f=p.distanceToSquared(n),f<d&&(d=f,a&&a.copy(p),l&&l.copy(n))}for(let u=0;u<3;u++){const f=t[u],h=t[(u+1)%3];o.set(this[f],this[h]);for(let m=0;m<3;m++){const p=t[m],v=t[(m+1)%3];i.set(r[p],r[v]),closestPointsSegmentToSegment(o,i,n,e);const g=n.distanceToSquared(e);g<d&&(d=g,a&&a.copy(n),l&&l.copy(e))}}return Math.sqrt(d)}}();class OrientedBox{constructor(e,t,o){this.isOrientedBox=!0,this.min=new Vector3$1,this.max=new Vector3$1,this.matrix=new Matrix4$1,this.invMatrix=new Matrix4$1,this.points=new Array(8).fill().map(()=>new Vector3$1),this.satAxes=new Array(3).fill().map(()=>new Vector3$1),this.satBounds=new Array(3).fill().map(()=>new SeparatingAxisBounds),this.alignedSatBounds=new Array(3).fill().map(()=>new SeparatingAxisBounds),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),o&&this.matrix.copy(o)}set(e,t,o){this.min.copy(e),this.max.copy(t),this.matrix.copy(o),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}OrientedBox.prototype.update=function(){return function(){const e=this.matrix,t=this.min,o=this.max,i=this.points;for(let c=0;c<=1;c++)for(let d=0;d<=1;d++)for(let u=0;u<=1;u++){const f=1*c|2*d|4*u,h=i[f];h.x=c?o.x:t.x,h.y=d?o.y:t.y,h.z=u?o.z:t.z,h.applyMatrix4(e)}const s=this.satBounds,r=this.satAxes,a=i[0];for(let c=0;c<3;c++){const d=r[c],u=s[c],f=1<<c,h=i[f];d.subVectors(a,h),u.setFromPoints(d,i)}const l=this.alignedSatBounds;l[0].setFromPointsField(i,"x"),l[1].setFromPointsField(i,"y"),l[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();OrientedBox.prototype.intersectsBox=function(){const n=new SeparatingAxisBounds;return function(t){this.needsUpdate&&this.update();const o=t.min,i=t.max,s=this.satBounds,r=this.satAxes,a=this.alignedSatBounds;if(n.min=o.x,n.max=i.x,a[0].isSeparated(n)||(n.min=o.y,n.max=i.y,a[1].isSeparated(n))||(n.min=o.z,n.max=i.z,a[2].isSeparated(n)))return!1;for(let l=0;l<3;l++){const c=r[l],d=s[l];if(n.setFromBox(c,t),d.isSeparated(n))return!1}return!0}}();OrientedBox.prototype.intersectsTriangle=function(){const n=new ExtendedTriangle,e=new Array(3),t=new SeparatingAxisBounds,o=new SeparatingAxisBounds,i=new Vector3$1;return function(r){this.needsUpdate&&this.update(),r.isExtendedTriangle?r.needsUpdate&&r.update():(n.copy(r),n.update(),r=n);const a=this.satBounds,l=this.satAxes;e[0]=r.a,e[1]=r.b,e[2]=r.c;for(let f=0;f<3;f++){const h=a[f],m=l[f];if(t.setFromPoints(m,e),h.isSeparated(t))return!1}const c=r.satBounds,d=r.satAxes,u=this.points;for(let f=0;f<3;f++){const h=c[f],m=d[f];if(t.setFromPoints(m,u),h.isSeparated(t))return!1}for(let f=0;f<3;f++){const h=l[f];for(let m=0;m<4;m++){const p=d[m];if(i.crossVectors(h,p),t.setFromPoints(i,e),o.setFromPoints(i,u),t.isSeparated(o))return!1}}return!0}}();OrientedBox.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();OrientedBox.prototype.distanceToPoint=function(){const n=new Vector3$1;return function(t){return this.closestPointToPoint(t,n),t.distanceTo(n)}}();OrientedBox.prototype.distanceToBox=function(){const n=["x","y","z"],e=new Array(12).fill().map(()=>new Line3),t=new Array(12).fill().map(()=>new Line3),o=new Vector3$1,i=new Vector3$1;return function(r,a=0,l=null,c=null){if(this.needsUpdate&&this.update(),this.intersectsBox(r))return(l||c)&&(r.getCenter(i),this.closestPointToPoint(i,o),r.closestPointToPoint(o,i),l&&l.copy(o),c&&c.copy(i)),0;const d=a*a,u=r.min,f=r.max,h=this.points;let m=1/0;for(let v=0;v<8;v++){const g=h[v];i.copy(g).clamp(u,f);const y=g.distanceToSquared(i);if(y<m&&(m=y,l&&l.copy(g),c&&c.copy(i),y<d))return Math.sqrt(y)}let p=0;for(let v=0;v<3;v++)for(let g=0;g<=1;g++)for(let y=0;y<=1;y++){const w=(v+1)%3,_=(v+2)%3,S=g<<w|y<<_,C=1<<v|g<<w|y<<_,A=h[S],E=h[C];e[p].set(A,E);const I=n[v],F=n[w],M=n[_],R=t[p],O=R.start,$=R.end;O[I]=u[I],O[F]=g?u[F]:f[F],O[M]=y?u[M]:f[F],$[I]=f[I],$[F]=g?u[F]:f[F],$[M]=y?u[M]:f[F],p++}for(let v=0;v<=1;v++)for(let g=0;g<=1;g++)for(let y=0;y<=1;y++){i.x=v?f.x:u.x,i.y=g?f.y:u.y,i.z=y?f.z:u.z,this.closestPointToPoint(i,o);const w=i.distanceToSquared(o);if(w<m&&(m=w,l&&l.copy(o),c&&c.copy(i),w<d))return Math.sqrt(w)}for(let v=0;v<12;v++){const g=e[v];for(let y=0;y<12;y++){const w=t[y];closestPointsSegmentToSegment(g,w,o,i);const _=o.distanceToSquared(i);if(_<m&&(m=_,l&&l.copy(o),c&&c.copy(i),_<d))return Math.sqrt(_)}}return Math.sqrt(m)}}();class PrimitivePool{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}class ExtendedTrianglePoolBase extends PrimitivePool{constructor(){super(()=>new ExtendedTriangle)}}const ExtendedTrianglePool=new ExtendedTrianglePoolBase;class _BufferStack{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=o=>{t&&e.push(t),t=o,this.float32Array=new Float32Array(o),this.uint16Array=new Uint16Array(o),this.uint32Array=new Uint32Array(o)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,e.length!==0&&this.setBuffer(e.pop())}}}const BufferStack=new _BufferStack;let _box1,_box2;const boxStack=[],boxPool=new PrimitivePool(()=>new Box3);function shapecast(n,e,t,o,i,s){_box1=boxPool.getPrimitive(),_box2=boxPool.getPrimitive(),boxStack.push(_box1,_box2),BufferStack.setBuffer(n._roots[e]);const r=shapecastTraverse(0,n.geometry,t,o,i,s);BufferStack.clearBuffer(),boxPool.releasePrimitive(_box1),boxPool.releasePrimitive(_box2),boxStack.pop(),boxStack.pop();const a=boxStack.length;return a>0&&(_box2=boxStack[a-1],_box1=boxStack[a-2]),r}function shapecastTraverse(n,e,t,o,i=null,s=0,r=0){const{float32Array:a,uint16Array:l,uint32Array:c}=BufferStack;let d=n*2;if(IS_LEAF(d,l)){const f=OFFSET(n,c),h=COUNT(d,l);return arrayToBox(n,a,_box1),o(f,h,!1,r,s+n,_box1)}else{let I=function(M){const{uint16Array:R,uint32Array:O}=BufferStack;let $=M*2;for(;!IS_LEAF($,R);)M=LEFT_NODE(M),$=M*2;return OFFSET(M,O)},F=function(M){const{uint16Array:R,uint32Array:O}=BufferStack;let $=M*2;for(;!IS_LEAF($,R);)M=RIGHT_NODE(M,O),$=M*2;return OFFSET(M,O)+COUNT($,R)};const f=LEFT_NODE(n),h=RIGHT_NODE(n,c);let m=f,p=h,v,g,y,w;if(i&&(y=_box1,w=_box2,arrayToBox(m,a,y),arrayToBox(p,a,w),v=i(y),g=i(w),g<v)){m=h,p=f;const M=v;v=g,g=M,y=w}y||(y=_box1,arrayToBox(m,a,y));const _=IS_LEAF(m*2,l),S=t(y,_,v,r+1,s+m);let C;if(S===CONTAINED){const M=I(m),O=F(m)-M;C=o(M,O,!0,r+1,s+m,y)}else C=S&&shapecastTraverse(m,e,t,o,i,s,r+1);if(C)return!0;w=_box2,arrayToBox(p,a,w);const A=IS_LEAF(p*2,l),E=t(w,A,g,r+1,s+p);let k;if(E===CONTAINED){const M=I(p),O=F(p)-M;k=o(M,O,!0,r+1,s+p,w)}else k=E&&shapecastTraverse(p,e,t,o,i,s,r+1);return!!k}}const temp=new Vector3$1,temp1$2=new Vector3$1;function closestPointToPoint(n,e,t={},o=0,i=1/0){const s=o*o,r=i*i;let a=1/0,l=null;if(n.shapecast({boundsTraverseOrder:d=>(temp.copy(e).clamp(d.min,d.max),temp.distanceToSquared(e)),intersectsBounds:(d,u,f)=>f<a&&f<r,intersectsTriangle:(d,u)=>{d.closestPointToPoint(e,temp);const f=e.distanceToSquared(temp);return f<a&&(temp1$2.copy(temp),a=f,l=u),f<s}}),a===1/0)return null;const c=Math.sqrt(a);return t.point?t.point.copy(temp1$2):t.point=temp1$2.clone(),t.distance=c,t.faceIndex=l,t}const IS_GT_REVISION_169=parseInt(REVISION)>=169,_vA=new Vector3$1,_vB=new Vector3$1,_vC=new Vector3$1,_uvA=new Vector2$1,_uvB=new Vector2$1,_uvC=new Vector2$1,_normalA=new Vector3$1,_normalB=new Vector3$1,_normalC=new Vector3$1,_intersectionPoint=new Vector3$1;function checkIntersection(n,e,t,o,i,s,r,a){let l;if(s===BackSide?l=n.intersectTriangle(o,t,e,!0,i):l=n.intersectTriangle(e,t,o,s!==DoubleSide,i),l===null)return null;const c=n.origin.distanceTo(i);return c<r||c>a?null:{distance:c,point:i.clone()}}function checkBufferGeometryIntersection(n,e,t,o,i,s,r,a,l,c,d){_vA.fromBufferAttribute(e,s),_vB.fromBufferAttribute(e,r),_vC.fromBufferAttribute(e,a);const u=checkIntersection(n,_vA,_vB,_vC,_intersectionPoint,l,c,d);if(u){const f=new Vector3$1;Triangle.getBarycoord(_intersectionPoint,_vA,_vB,_vC,f),o&&(_uvA.fromBufferAttribute(o,s),_uvB.fromBufferAttribute(o,r),_uvC.fromBufferAttribute(o,a),u.uv=Triangle.getInterpolation(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2$1)),i&&(_uvA.fromBufferAttribute(i,s),_uvB.fromBufferAttribute(i,r),_uvC.fromBufferAttribute(i,a),u.uv1=Triangle.getInterpolation(_intersectionPoint,_vA,_vB,_vC,_uvA,_uvB,_uvC,new Vector2$1)),t&&(_normalA.fromBufferAttribute(t,s),_normalB.fromBufferAttribute(t,r),_normalC.fromBufferAttribute(t,a),u.normal=Triangle.getInterpolation(_intersectionPoint,_vA,_vB,_vC,_normalA,_normalB,_normalC,new Vector3$1),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const h={a:s,b:r,c:a,normal:new Vector3$1,materialIndex:0};Triangle.getNormal(_vA,_vB,_vC,h.normal),u.face=h,u.faceIndex=s,IS_GT_REVISION_169&&(u.barycoord=f)}return u}function intersectTri(n,e,t,o,i,s,r){const a=o*3;let l=a+0,c=a+1,d=a+2;const u=n.index;n.index&&(l=u.getX(l),c=u.getX(c),d=u.getX(d));const{position:f,normal:h,uv:m,uv1:p}=n.attributes,v=checkBufferGeometryIntersection(t,f,h,m,p,l,c,d,e,s,r);return v?(v.faceIndex=o,i&&i.push(v),v):null}function setTriangle(n,e,t,o){const i=n.a,s=n.b,r=n.c;let a=e,l=e+1,c=e+2;t&&(a=t.getX(a),l=t.getX(l),c=t.getX(c)),i.x=o.getX(a),i.y=o.getY(a),i.z=o.getZ(a),s.x=o.getX(l),s.y=o.getY(l),s.z=o.getZ(l),r.x=o.getX(c),r.y=o.getY(c),r.z=o.getZ(c)}function intersectTris(n,e,t,o,i,s,r,a){const{geometry:l,_indirectBuffer:c}=n;for(let d=o,u=o+i;d<u;d++)intersectTri(l,e,t,d,s,r,a)}function intersectClosestTri(n,e,t,o,i,s,r){const{geometry:a,_indirectBuffer:l}=n;let c=1/0,d=null;for(let u=o,f=o+i;u<f;u++){let h;h=intersectTri(a,e,t,u,null,s,r),h&&h.distance<c&&(d=h,c=h.distance)}return d}function iterateOverTriangles(n,e,t,o,i,s,r){const{geometry:a}=t,{index:l}=a,c=a.attributes.position;for(let d=n,u=e+n;d<u;d++){let f;if(f=d,setTriangle(r,f*3,l,c),r.needsUpdate=!0,o(r,f,i,s))return!0}return!1}function refit(n,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=n.geometry,o=t.index?t.index.array:null,i=t.attributes.position;let s,r,a,l,c=0;const d=n._roots;for(let f=0,h=d.length;f<h;f++)s=d[f],r=new Uint32Array(s),a=new Uint16Array(s),l=new Float32Array(s),u(0,c),c+=s.byteLength;function u(f,h,m=!1){const p=f*2;if(a[p+15]===IS_LEAFNODE_FLAG){const g=r[f+6],y=a[p+14];let w=1/0,_=1/0,S=1/0,C=-1/0,A=-1/0,E=-1/0;for(let k=3*g,I=3*(g+y);k<I;k++){let F=o[k];const M=i.getX(F),R=i.getY(F),O=i.getZ(F);M<w&&(w=M),M>C&&(C=M),R<_&&(_=R),R>A&&(A=R),O<S&&(S=O),O>E&&(E=O)}return l[f+0]!==w||l[f+1]!==_||l[f+2]!==S||l[f+3]!==C||l[f+4]!==A||l[f+5]!==E?(l[f+0]=w,l[f+1]=_,l[f+2]=S,l[f+3]=C,l[f+4]=A,l[f+5]=E,!0):!1}else{const g=f+8,y=r[f+6],w=g+h,_=y+h;let S=m,C=!1,A=!1;e?S||(C=e.has(w),A=e.has(_),S=!C&&!A):(C=!0,A=!0);const E=S||C,k=S||A;let I=!1;E&&(I=u(g,h,S));let F=!1;k&&(F=u(y,h,S));const M=I||F;if(M)for(let R=0;R<3;R++){const O=g+R,$=y+R,T=l[O],D=l[O+3],P=l[$],L=l[$+3];l[f+R]=T<P?T:P,l[f+R+3]=D>L?D:L}return M}}}function intersectRay(n,e,t,o,i){let s,r,a,l,c,d;const u=1/t.direction.x,f=1/t.direction.y,h=1/t.direction.z,m=t.origin.x,p=t.origin.y,v=t.origin.z;let g=e[n],y=e[n+3],w=e[n+1],_=e[n+3+1],S=e[n+2],C=e[n+3+2];return u>=0?(s=(g-m)*u,r=(y-m)*u):(s=(y-m)*u,r=(g-m)*u),f>=0?(a=(w-p)*f,l=(_-p)*f):(a=(_-p)*f,l=(w-p)*f),s>l||a>r||((a>s||isNaN(s))&&(s=a),(l<r||isNaN(r))&&(r=l),h>=0?(c=(S-v)*h,d=(C-v)*h):(c=(C-v)*h,d=(S-v)*h),s>d||c>r)?!1:((c>s||s!==s)&&(s=c),(d<r||r!==r)&&(r=d),s<=i&&r>=o)}function intersectTris_indirect(n,e,t,o,i,s,r,a){const{geometry:l,_indirectBuffer:c}=n;for(let d=o,u=o+i;d<u;d++){let f=c?c[d]:d;intersectTri(l,e,t,f,s,r,a)}}function intersectClosestTri_indirect(n,e,t,o,i,s,r){const{geometry:a,_indirectBuffer:l}=n;let c=1/0,d=null;for(let u=o,f=o+i;u<f;u++){let h;h=intersectTri(a,e,t,l?l[u]:u,null,s,r),h&&h.distance<c&&(d=h,c=h.distance)}return d}function iterateOverTriangles_indirect(n,e,t,o,i,s,r){const{geometry:a}=t,{index:l}=a,c=a.attributes.position;for(let d=n,u=e+n;d<u;d++){let f;if(f=t.resolveTriangleIndex(d),setTriangle(r,f*3,l,c),r.needsUpdate=!0,o(r,f,i,s))return!0}return!1}function raycast(n,e,t,o,i,s,r){BufferStack.setBuffer(n._roots[e]),_raycast$1(0,n,t,o,i,s,r),BufferStack.clearBuffer()}function _raycast$1(n,e,t,o,i,s,r){const{float32Array:a,uint16Array:l,uint32Array:c}=BufferStack,d=n*2;if(IS_LEAF(d,l)){const f=OFFSET(n,c),h=COUNT(d,l);intersectTris(e,t,o,f,h,i,s,r)}else{const f=LEFT_NODE(n);intersectRay(f,a,o,s,r)&&_raycast$1(f,e,t,o,i,s,r);const h=RIGHT_NODE(n,c);intersectRay(h,a,o,s,r)&&_raycast$1(h,e,t,o,i,s,r)}}const _xyzFields$1=["x","y","z"];function raycastFirst(n,e,t,o,i,s){BufferStack.setBuffer(n._roots[e]);const r=_raycastFirst$1(0,n,t,o,i,s);return BufferStack.clearBuffer(),r}function _raycastFirst$1(n,e,t,o,i,s){const{float32Array:r,uint16Array:a,uint32Array:l}=BufferStack;let c=n*2;if(IS_LEAF(c,a)){const u=OFFSET(n,l),f=COUNT(c,a);return intersectClosestTri(e,t,o,u,f,i,s)}else{const u=SPLIT_AXIS(n,l),f=_xyzFields$1[u],m=o.direction[f]>=0;let p,v;m?(p=LEFT_NODE(n),v=RIGHT_NODE(n,l)):(p=RIGHT_NODE(n,l),v=LEFT_NODE(n));const y=intersectRay(p,r,o,i,s)?_raycastFirst$1(p,e,t,o,i,s):null;if(y){const S=y.point[f];if(m?S<=r[v+u]:S>=r[v+u+3])return y}const _=intersectRay(v,r,o,i,s)?_raycastFirst$1(v,e,t,o,i,s):null;return y&&_?y.distance<=_.distance?y:_:y||_||null}}const boundingBox$1=new Box3,triangle$1=new ExtendedTriangle,triangle2$1=new ExtendedTriangle,invertedMat$1=new Matrix4$1,obb$4=new OrientedBox,obb2$3=new OrientedBox;function intersectsGeometry(n,e,t,o){BufferStack.setBuffer(n._roots[e]);const i=_intersectsGeometry$1(0,n,t,o);return BufferStack.clearBuffer(),i}function _intersectsGeometry$1(n,e,t,o,i=null){const{float32Array:s,uint16Array:r,uint32Array:a}=BufferStack;let l=n*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),obb$4.set(t.boundingBox.min,t.boundingBox.max,o),i=obb$4),IS_LEAF(l,r)){const d=e.geometry,u=d.index,f=d.attributes.position,h=t.index,m=t.attributes.position,p=OFFSET(n,a),v=COUNT(l,r);if(invertedMat$1.copy(o).invert(),t.boundsTree)return arrayToBox(n,s,obb2$3),obb2$3.matrix.copy(invertedMat$1),obb2$3.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:y=>obb2$3.intersectsBox(y),intersectsTriangle:y=>{y.a.applyMatrix4(o),y.b.applyMatrix4(o),y.c.applyMatrix4(o),y.needsUpdate=!0;for(let w=p*3,_=(v+p)*3;w<_;w+=3)if(setTriangle(triangle2$1,w,u,f),triangle2$1.needsUpdate=!0,y.intersectsTriangle(triangle2$1))return!0;return!1}});for(let g=p*3,y=(v+p)*3;g<y;g+=3){setTriangle(triangle$1,g,u,f),triangle$1.a.applyMatrix4(invertedMat$1),triangle$1.b.applyMatrix4(invertedMat$1),triangle$1.c.applyMatrix4(invertedMat$1),triangle$1.needsUpdate=!0;for(let w=0,_=h.count;w<_;w+=3)if(setTriangle(triangle2$1,w,h,m),triangle2$1.needsUpdate=!0,triangle$1.intersectsTriangle(triangle2$1))return!0}}else{const d=n+8,u=a[n+6];return arrayToBox(d,s,boundingBox$1),!!(i.intersectsBox(boundingBox$1)&&_intersectsGeometry$1(d,e,t,o,i)||(arrayToBox(u,s,boundingBox$1),i.intersectsBox(boundingBox$1)&&_intersectsGeometry$1(u,e,t,o,i)))}}const tempMatrix$2=new Matrix4$1,obb$3=new OrientedBox,obb2$2=new OrientedBox,temp1$1=new Vector3$1,temp2$1=new Vector3$1,temp3$1=new Vector3$1,temp4$1=new Vector3$1;function closestPointToGeometry(n,e,t,o={},i={},s=0,r=1/0){e.boundingBox||e.computeBoundingBox(),obb$3.set(e.boundingBox.min,e.boundingBox.max,t),obb$3.needsUpdate=!0;const a=n.geometry,l=a.attributes.position,c=a.index,d=e.attributes.position,u=e.index,f=ExtendedTrianglePool.getPrimitive(),h=ExtendedTrianglePool.getPrimitive();let m=temp1$1,p=temp2$1,v=null,g=null;i&&(v=temp3$1,g=temp4$1);let y=1/0,w=null,_=null;return tempMatrix$2.copy(t).invert(),obb2$2.matrix.copy(tempMatrix$2),n.shapecast({boundsTraverseOrder:S=>obb$3.distanceToBox(S),intersectsBounds:(S,C,A)=>A<y&&A<r?(C&&(obb2$2.min.copy(S.min),obb2$2.max.copy(S.max),obb2$2.needsUpdate=!0),!0):!1,intersectsRange:(S,C)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:E=>obb2$2.distanceToBox(E),intersectsBounds:(E,k,I)=>I<y&&I<r,intersectsRange:(E,k)=>{for(let I=E,F=E+k;I<F;I++){setTriangle(h,3*I,u,d),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let M=S,R=S+C;M<R;M++){setTriangle(f,3*M,c,l),f.needsUpdate=!0;const O=f.distanceToTriangle(h,m,v);if(O<y&&(p.copy(m),g&&g.copy(v),y=O,w=M,_=I),O<s)return!0}}}});{const A=getTriCount(e);for(let E=0,k=A;E<k;E++){setTriangle(h,3*E,u,d),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let I=S,F=S+C;I<F;I++){setTriangle(f,3*I,c,l),f.needsUpdate=!0;const M=f.distanceToTriangle(h,m,v);if(M<y&&(p.copy(m),g&&g.copy(v),y=M,w=I,_=E),M<s)return!0}}}}}),ExtendedTrianglePool.releasePrimitive(f),ExtendedTrianglePool.releasePrimitive(h),y===1/0?null:(o.point?o.point.copy(p):o.point=p.clone(),o.distance=y,o.faceIndex=w,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4(tempMatrix$2),p.applyMatrix4(tempMatrix$2),i.distance=p.sub(i.point).length(),i.faceIndex=_),o)}function refit_indirect(n,e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=n.geometry,o=t.index?t.index.array:null,i=t.attributes.position;let s,r,a,l,c=0;const d=n._roots;for(let f=0,h=d.length;f<h;f++)s=d[f],r=new Uint32Array(s),a=new Uint16Array(s),l=new Float32Array(s),u(0,c),c+=s.byteLength;function u(f,h,m=!1){const p=f*2;if(a[p+15]===IS_LEAFNODE_FLAG){const g=r[f+6],y=a[p+14];let w=1/0,_=1/0,S=1/0,C=-1/0,A=-1/0,E=-1/0;for(let k=g,I=g+y;k<I;k++){const F=3*n.resolveTriangleIndex(k);for(let M=0;M<3;M++){let R=F+M;R=o?o[R]:R;const O=i.getX(R),$=i.getY(R),T=i.getZ(R);O<w&&(w=O),O>C&&(C=O),$<_&&(_=$),$>A&&(A=$),T<S&&(S=T),T>E&&(E=T)}}return l[f+0]!==w||l[f+1]!==_||l[f+2]!==S||l[f+3]!==C||l[f+4]!==A||l[f+5]!==E?(l[f+0]=w,l[f+1]=_,l[f+2]=S,l[f+3]=C,l[f+4]=A,l[f+5]=E,!0):!1}else{const g=f+8,y=r[f+6],w=g+h,_=y+h;let S=m,C=!1,A=!1;e?S||(C=e.has(w),A=e.has(_),S=!C&&!A):(C=!0,A=!0);const E=S||C,k=S||A;let I=!1;E&&(I=u(g,h,S));let F=!1;k&&(F=u(y,h,S));const M=I||F;if(M)for(let R=0;R<3;R++){const O=g+R,$=y+R,T=l[O],D=l[O+3],P=l[$],L=l[$+3];l[f+R]=T<P?T:P,l[f+R+3]=D>L?D:L}return M}}}function raycast_indirect(n,e,t,o,i,s,r){BufferStack.setBuffer(n._roots[e]),_raycast(0,n,t,o,i,s,r),BufferStack.clearBuffer()}function _raycast(n,e,t,o,i,s,r){const{float32Array:a,uint16Array:l,uint32Array:c}=BufferStack,d=n*2;if(IS_LEAF(d,l)){const f=OFFSET(n,c),h=COUNT(d,l);intersectTris_indirect(e,t,o,f,h,i,s,r)}else{const f=LEFT_NODE(n);intersectRay(f,a,o,s,r)&&_raycast(f,e,t,o,i,s,r);const h=RIGHT_NODE(n,c);intersectRay(h,a,o,s,r)&&_raycast(h,e,t,o,i,s,r)}}const _xyzFields=["x","y","z"];function raycastFirst_indirect(n,e,t,o,i,s){BufferStack.setBuffer(n._roots[e]);const r=_raycastFirst(0,n,t,o,i,s);return BufferStack.clearBuffer(),r}function _raycastFirst(n,e,t,o,i,s){const{float32Array:r,uint16Array:a,uint32Array:l}=BufferStack;let c=n*2;if(IS_LEAF(c,a)){const u=OFFSET(n,l),f=COUNT(c,a);return intersectClosestTri_indirect(e,t,o,u,f,i,s)}else{const u=SPLIT_AXIS(n,l),f=_xyzFields[u],m=o.direction[f]>=0;let p,v;m?(p=LEFT_NODE(n),v=RIGHT_NODE(n,l)):(p=RIGHT_NODE(n,l),v=LEFT_NODE(n));const y=intersectRay(p,r,o,i,s)?_raycastFirst(p,e,t,o,i,s):null;if(y){const S=y.point[f];if(m?S<=r[v+u]:S>=r[v+u+3])return y}const _=intersectRay(v,r,o,i,s)?_raycastFirst(v,e,t,o,i,s):null;return y&&_?y.distance<=_.distance?y:_:y||_||null}}const boundingBox=new Box3,triangle=new ExtendedTriangle,triangle2=new ExtendedTriangle,invertedMat=new Matrix4$1,obb$2=new OrientedBox,obb2$1=new OrientedBox;function intersectsGeometry_indirect(n,e,t,o){BufferStack.setBuffer(n._roots[e]);const i=_intersectsGeometry(0,n,t,o);return BufferStack.clearBuffer(),i}function _intersectsGeometry(n,e,t,o,i=null){const{float32Array:s,uint16Array:r,uint32Array:a}=BufferStack;let l=n*2;if(i===null&&(t.boundingBox||t.computeBoundingBox(),obb$2.set(t.boundingBox.min,t.boundingBox.max,o),i=obb$2),IS_LEAF(l,r)){const d=e.geometry,u=d.index,f=d.attributes.position,h=t.index,m=t.attributes.position,p=OFFSET(n,a),v=COUNT(l,r);if(invertedMat.copy(o).invert(),t.boundsTree)return arrayToBox(n,s,obb2$1),obb2$1.matrix.copy(invertedMat),obb2$1.needsUpdate=!0,t.boundsTree.shapecast({intersectsBounds:y=>obb2$1.intersectsBox(y),intersectsTriangle:y=>{y.a.applyMatrix4(o),y.b.applyMatrix4(o),y.c.applyMatrix4(o),y.needsUpdate=!0;for(let w=p,_=v+p;w<_;w++)if(setTriangle(triangle2,3*e.resolveTriangleIndex(w),u,f),triangle2.needsUpdate=!0,y.intersectsTriangle(triangle2))return!0;return!1}});for(let g=p,y=v+p;g<y;g++){const w=e.resolveTriangleIndex(g);setTriangle(triangle,3*w,u,f),triangle.a.applyMatrix4(invertedMat),triangle.b.applyMatrix4(invertedMat),triangle.c.applyMatrix4(invertedMat),triangle.needsUpdate=!0;for(let _=0,S=h.count;_<S;_+=3)if(setTriangle(triangle2,_,h,m),triangle2.needsUpdate=!0,triangle.intersectsTriangle(triangle2))return!0}}else{const d=n+8,u=a[n+6];return arrayToBox(d,s,boundingBox),!!(i.intersectsBox(boundingBox)&&_intersectsGeometry(d,e,t,o,i)||(arrayToBox(u,s,boundingBox),i.intersectsBox(boundingBox)&&_intersectsGeometry(u,e,t,o,i)))}}const tempMatrix$1=new Matrix4$1,obb$1=new OrientedBox,obb2=new OrientedBox,temp1=new Vector3$1,temp2=new Vector3$1,temp3=new Vector3$1,temp4=new Vector3$1;function closestPointToGeometry_indirect(n,e,t,o={},i={},s=0,r=1/0){e.boundingBox||e.computeBoundingBox(),obb$1.set(e.boundingBox.min,e.boundingBox.max,t),obb$1.needsUpdate=!0;const a=n.geometry,l=a.attributes.position,c=a.index,d=e.attributes.position,u=e.index,f=ExtendedTrianglePool.getPrimitive(),h=ExtendedTrianglePool.getPrimitive();let m=temp1,p=temp2,v=null,g=null;i&&(v=temp3,g=temp4);let y=1/0,w=null,_=null;return tempMatrix$1.copy(t).invert(),obb2.matrix.copy(tempMatrix$1),n.shapecast({boundsTraverseOrder:S=>obb$1.distanceToBox(S),intersectsBounds:(S,C,A)=>A<y&&A<r?(C&&(obb2.min.copy(S.min),obb2.max.copy(S.max),obb2.needsUpdate=!0),!0):!1,intersectsRange:(S,C)=>{if(e.boundsTree){const A=e.boundsTree;return A.shapecast({boundsTraverseOrder:E=>obb2.distanceToBox(E),intersectsBounds:(E,k,I)=>I<y&&I<r,intersectsRange:(E,k)=>{for(let I=E,F=E+k;I<F;I++){const M=A.resolveTriangleIndex(I);setTriangle(h,3*M,u,d),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let R=S,O=S+C;R<O;R++){const $=n.resolveTriangleIndex(R);setTriangle(f,3*$,c,l),f.needsUpdate=!0;const T=f.distanceToTriangle(h,m,v);if(T<y&&(p.copy(m),g&&g.copy(v),y=T,w=R,_=I),T<s)return!0}}}})}else{const A=getTriCount(e);for(let E=0,k=A;E<k;E++){setTriangle(h,3*E,u,d),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let I=S,F=S+C;I<F;I++){const M=n.resolveTriangleIndex(I);setTriangle(f,3*M,c,l),f.needsUpdate=!0;const R=f.distanceToTriangle(h,m,v);if(R<y&&(p.copy(m),g&&g.copy(v),y=R,w=I,_=E),R<s)return!0}}}}}),ExtendedTrianglePool.releasePrimitive(f),ExtendedTrianglePool.releasePrimitive(h),y===1/0?null:(o.point?o.point.copy(p):o.point=p.clone(),o.distance=y,o.faceIndex=w,i&&(i.point?i.point.copy(g):i.point=g.clone(),i.point.applyMatrix4(tempMatrix$1),p.applyMatrix4(tempMatrix$1),i.distance=p.sub(i.point).length(),i.faceIndex=_),o)}function isSharedArrayBufferSupported(){return typeof SharedArrayBuffer<"u"}const _bufferStack1=new BufferStack.constructor,_bufferStack2=new BufferStack.constructor,_boxPool=new PrimitivePool(()=>new Box3),_leftBox1=new Box3,_rightBox1=new Box3,_leftBox2=new Box3,_rightBox2=new Box3;let _active=!1;function bvhcast(n,e,t,o){if(_active)throw new Error("MeshBVH: Recursive calls to bvhcast not supported.");_active=!0;const i=n._roots,s=e._roots;let r,a=0,l=0;const c=new Matrix4$1().copy(t).invert();for(let d=0,u=i.length;d<u;d++){_bufferStack1.setBuffer(i[d]),l=0;const f=_boxPool.getPrimitive();arrayToBox(0,_bufferStack1.float32Array,f),f.applyMatrix4(c);for(let h=0,m=s.length;h<m&&(_bufferStack2.setBuffer(s[h]),r=_traverse(0,0,t,c,o,a,l,0,0,f),_bufferStack2.clearBuffer(),l+=s[h].length,!r);h++);if(_boxPool.releasePrimitive(f),_bufferStack1.clearBuffer(),a+=i[d].length,r)break}return _active=!1,r}function _traverse(n,e,t,o,i,s=0,r=0,a=0,l=0,c=null,d=!1){let u,f;d?(u=_bufferStack2,f=_bufferStack1):(u=_bufferStack1,f=_bufferStack2);const h=u.float32Array,m=u.uint32Array,p=u.uint16Array,v=f.float32Array,g=f.uint32Array,y=f.uint16Array,w=n*2,_=e*2,S=IS_LEAF(w,p),C=IS_LEAF(_,y);let A=!1;if(C&&S)d?A=i(OFFSET(e,g),COUNT(e*2,y),OFFSET(n,m),COUNT(n*2,p),l,r+e,a,s+n):A=i(OFFSET(n,m),COUNT(n*2,p),OFFSET(e,g),COUNT(e*2,y),a,s+n,l,r+e);else if(C){const E=_boxPool.getPrimitive();arrayToBox(e,v,E),E.applyMatrix4(t);const k=LEFT_NODE(n),I=RIGHT_NODE(n,m);arrayToBox(k,h,_leftBox1),arrayToBox(I,h,_rightBox1);const F=E.intersectsBox(_leftBox1),M=E.intersectsBox(_rightBox1);A=F&&_traverse(e,k,o,t,i,r,s,l,a+1,E,!d)||M&&_traverse(e,I,o,t,i,r,s,l,a+1,E,!d),_boxPool.releasePrimitive(E)}else{const E=LEFT_NODE(e),k=RIGHT_NODE(e,g);arrayToBox(E,v,_leftBox2),arrayToBox(k,v,_rightBox2);const I=c.intersectsBox(_leftBox2),F=c.intersectsBox(_rightBox2);if(I&&F)A=_traverse(n,E,t,o,i,s,r,a,l+1,c,d)||_traverse(n,k,t,o,i,s,r,a,l+1,c,d);else if(I)if(S)A=_traverse(n,E,t,o,i,s,r,a,l+1,c,d);else{const M=_boxPool.getPrimitive();M.copy(_leftBox2).applyMatrix4(t);const R=LEFT_NODE(n),O=RIGHT_NODE(n,m);arrayToBox(R,h,_leftBox1),arrayToBox(O,h,_rightBox1);const $=M.intersectsBox(_leftBox1),T=M.intersectsBox(_rightBox1);A=$&&_traverse(E,R,o,t,i,r,s,l,a+1,M,!d)||T&&_traverse(E,O,o,t,i,r,s,l,a+1,M,!d),_boxPool.releasePrimitive(M)}else if(F)if(S)A=_traverse(n,k,t,o,i,s,r,a,l+1,c,d);else{const M=_boxPool.getPrimitive();M.copy(_rightBox2).applyMatrix4(t);const R=LEFT_NODE(n),O=RIGHT_NODE(n,m);arrayToBox(R,h,_leftBox1),arrayToBox(O,h,_rightBox1);const $=M.intersectsBox(_leftBox1),T=M.intersectsBox(_rightBox1);A=$&&_traverse(k,R,o,t,i,r,s,l,a+1,M,!d)||T&&_traverse(k,O,o,t,i,r,s,l,a+1,M,!d),_boxPool.releasePrimitive(M)}}return A}const obb=new OrientedBox,tempBox$1=new Box3,DEFAULT_OPTIONS={strategy:CENTER$1,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class MeshBVH{static serialize(e,t={}){t={cloneBuffers:!0,...t};const o=e.geometry,i=e._roots,s=e._indirectBuffer,r=o.getIndex();let a;return t.cloneBuffers?a={roots:i.map(l=>l.slice()),index:r?r.array.slice():null,indirectBuffer:s?s.slice():null}:a={roots:i,index:r?r.array:null,indirectBuffer:s},a}static deserialize(e,t,o={}){o={setIndex:!0,indirect:!!e.indirectBuffer,...o};const{index:i,roots:s,indirectBuffer:r}=e,a=new MeshBVH(t,{...o,[SKIP_GENERATION]:!0});if(a._roots=s,a._indirectBuffer=r||null,o.setIndex){const l=t.getIndex();if(l===null){const c=new BufferAttribute(e.index,1,!1);t.setIndex(c)}else l.array!==i&&(l.array.set(i),l.needsUpdate=!0)}return a}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({...DEFAULT_OPTIONS,[SKIP_GENERATION]:!1},t),t.useSharedArrayBuffer&&!isSharedArrayBufferSupported())throw new Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[SKIP_GENERATION]||(buildPackedTree(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Box3))),this.resolveTriangleIndex=t.indirect?o=>this._indirectBuffer[o]:o=>o}refit(e=null){return(this.indirect?refit_indirect:refit)(this,e)}traverse(e,t=0){const o=this._roots[t],i=new Uint32Array(o),s=new Uint16Array(o);r(0);function r(a,l=0){const c=a*2,d=s[c+15]===IS_LEAFNODE_FLAG;if(d){const u=i[a+6],f=s[c+14];e(l,d,new Float32Array(o,a*4,6),u,f)}else{const u=a+BYTES_PER_NODE/4,f=i[a+6],h=i[a+7];e(l,d,new Float32Array(o,a*4,6),h)||(r(u,l+1),r(f,l+1))}}}raycast(e,t=FrontSide,o=0,i=1/0){const s=this._roots,r=this.geometry,a=[],l=t.isMaterial,c=Array.isArray(t),d=r.groups,u=l?t.side:t,f=this.indirect?raycast_indirect:raycast;for(let h=0,m=s.length;h<m;h++){const p=c?t[d[h].materialIndex].side:u,v=a.length;if(f(this,h,p,e,a,o,i),c){const g=d[h].materialIndex;for(let y=v,w=a.length;y<w;y++)a[y].face.materialIndex=g}}return a}raycastFirst(e,t=FrontSide,o=0,i=1/0){const s=this._roots,r=this.geometry,a=t.isMaterial,l=Array.isArray(t);let c=null;const d=r.groups,u=a?t.side:t,f=this.indirect?raycastFirst_indirect:raycastFirst;for(let h=0,m=s.length;h<m;h++){const p=l?t[d[h].materialIndex].side:u,v=f(this,h,p,e,o,i);v!=null&&(c==null||v.distance<c.distance)&&(c=v,l&&(v.face.materialIndex=d[h].materialIndex))}return c}intersectsGeometry(e,t){let o=!1;const i=this._roots,s=this.indirect?intersectsGeometry_indirect:intersectsGeometry;for(let r=0,a=i.length;r<a&&(o=s(this,r,e,t),!o);r++);return o}shapecast(e){const t=ExtendedTrianglePool.getPrimitive(),o=this.indirect?iterateOverTriangles_indirect:iterateOverTriangles;let{boundsTraverseOrder:i,intersectsBounds:s,intersectsRange:r,intersectsTriangle:a}=e;if(r&&a){const u=r;r=(f,h,m,p,v)=>u(f,h,m,p,v)?!0:o(f,h,this,a,m,p,t)}else r||(a?r=(u,f,h,m)=>o(u,f,this,a,h,m,t):r=(u,f,h)=>h);let l=!1,c=0;const d=this._roots;for(let u=0,f=d.length;u<f;u++){const h=d[u];if(l=shapecast(this,u,s,r,i,c),l)break;c+=h.byteLength}return ExtendedTrianglePool.releasePrimitive(t),l}bvhcast(e,t,o){let{intersectsRanges:i,intersectsTriangles:s}=o;const r=ExtendedTrianglePool.getPrimitive(),a=this.geometry.index,l=this.geometry.attributes.position,c=this.indirect?m=>{const p=this.resolveTriangleIndex(m);setTriangle(r,p*3,a,l)}:m=>{setTriangle(r,m*3,a,l)},d=ExtendedTrianglePool.getPrimitive(),u=e.geometry.index,f=e.geometry.attributes.position,h=e.indirect?m=>{const p=e.resolveTriangleIndex(m);setTriangle(d,p*3,u,f)}:m=>{setTriangle(d,m*3,u,f)};if(s){const m=(p,v,g,y,w,_,S,C)=>{for(let A=g,E=g+y;A<E;A++){h(A),d.a.applyMatrix4(t),d.b.applyMatrix4(t),d.c.applyMatrix4(t),d.needsUpdate=!0;for(let k=p,I=p+v;k<I;k++)if(c(k),r.needsUpdate=!0,s(r,d,k,A,w,_,S,C))return!0}return!1};if(i){const p=i;i=function(v,g,y,w,_,S,C,A){return p(v,g,y,w,_,S,C,A)?!0:m(v,g,y,w,_,S,C,A)}}else i=m}return bvhcast(this,e,t,i)}intersectsBox(e,t){return obb.set(e.min,e.max,t),obb.needsUpdate=!0,this.shapecast({intersectsBounds:o=>obb.intersectsBox(o),intersectsTriangle:o=>obb.intersectsTriangle(o)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,o={},i={},s=0,r=1/0){return(this.indirect?closestPointToGeometry_indirect:closestPointToGeometry)(this,e,t,o,i,s,r)}closestPointToPoint(e,t={},o=0,i=1/0){return closestPointToPoint(this,e,t,o,i)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(o=>{arrayToBox(0,new Float32Array(o),tempBox$1),e.union(tempBox$1)}),e}}const _positionVector=new Vector3$1,_normalVector=new Vector3$1,_tangentVector=new Vector3$1,_tangentVector4=new Vector4$1,_morphVector=new Vector3$1,_temp=new Vector3$1,_skinIndex=new Vector4$1,_skinWeight=new Vector4$1,_matrix$1=new Matrix4$1,_boneMatrix=new Matrix4$1;function validateAttributes(n,e){if(!n&&!e)return;const t=n.count===e.count,o=n.normalized===e.normalized,i=n.array.constructor===e.array.constructor,s=n.itemSize===e.itemSize;if(!t||!o||!i||!s)throw new Error}function createAttributeClone(n,e=null){const t=n.array.constructor,o=n.normalized,i=n.itemSize,s=e===null?n.count:e;return new BufferAttribute(new t(i*s),i,o)}function copyAttributeContents(n,e,t=0){if(n.isInterleavedBufferAttribute){const o=n.itemSize;for(let i=0,s=n.count;i<s;i++){const r=i+t;e.setX(r,n.getX(i)),o>=2&&e.setY(r,n.getY(i)),o>=3&&e.setZ(r,n.getZ(i)),o>=4&&e.setW(r,n.getW(i))}}else{const o=e.array,i=o.constructor,s=o.BYTES_PER_ELEMENT*n.itemSize*t;new i(o.buffer,s,n.array.length).set(n.array)}}function addScaledMatrix(n,e,t){const o=n.elements,i=e.elements;for(let s=0,r=i.length;s<r;s++)o[s]+=i[s]*t}function boneNormalTransform(n,e,t){const o=n.skeleton,i=n.geometry,s=o.bones,r=o.boneInverses;_skinIndex.fromBufferAttribute(i.attributes.skinIndex,e),_skinWeight.fromBufferAttribute(i.attributes.skinWeight,e),_matrix$1.elements.fill(0);for(let a=0;a<4;a++){const l=_skinWeight.getComponent(a);if(l!==0){const c=_skinIndex.getComponent(a);_boneMatrix.multiplyMatrices(s[c].matrixWorld,r[c]),addScaledMatrix(_matrix$1,_boneMatrix,l)}}return _matrix$1.multiply(n.bindMatrix).premultiply(n.bindMatrixInverse),t.transformDirection(_matrix$1),t}function applyMorphTarget(n,e,t,o,i){_morphVector.set(0,0,0);for(let s=0,r=n.length;s<r;s++){const a=e[s],l=n[s];a!==0&&(_temp.fromBufferAttribute(l,o),t?_morphVector.addScaledVector(_temp,a):_morphVector.addScaledVector(_temp.sub(i),a))}i.add(_morphVector)}function mergeBufferGeometries$1(n,e={useGroups:!1,updateIndex:!1,skipAttributes:[]},t=new BufferGeometry){const o=n[0].index!==null,{useGroups:i=!1,updateIndex:s=!1,skipAttributes:r=[]}=e,a=new Set(Object.keys(n[0].attributes)),l={};let c=0;t.clearGroups();for(let d=0;d<n.length;++d){const u=n[d];let f=0;if(o!==(u.index!==null))throw new Error("StaticGeometryGenerator: All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.");for(const h in u.attributes){if(!a.has(h))throw new Error('StaticGeometryGenerator: All geometries must have compatible attributes; make sure "'+h+'" attribute exists among all geometries, or in none of them.');l[h]===void 0&&(l[h]=[]),l[h].push(u.attributes[h]),f++}if(f!==a.size)throw new Error("StaticGeometryGenerator: Make sure all geometries have the same number of attributes.");if(i){let h;if(o)h=u.index.count;else if(u.attributes.position!==void 0)h=u.attributes.position.count;else throw new Error("StaticGeometryGenerator: The geometry must have either an index or a position attribute");t.addGroup(c,h,d),c+=h}}if(o){let d=!1;if(!t.index){let u=0;for(let f=0;f<n.length;++f)u+=n[f].index.count;t.setIndex(new BufferAttribute(new Uint32Array(u),1,!1)),d=!0}if(s||d){const u=t.index;let f=0,h=0;for(let m=0;m<n.length;++m){const p=n[m],v=p.index;if(r[m]!==!0)for(let g=0;g<v.count;++g)u.setX(f,v.getX(g)+h),f++;h+=p.attributes.position.count}}}for(const d in l){const u=l[d];if(!(d in t.attributes)){let m=0;for(const p in u)m+=u[p].count;t.setAttribute(d,createAttributeClone(l[d][0],m))}const f=t.attributes[d];let h=0;for(let m=0,p=u.length;m<p;m++){const v=u[m];r[m]!==!0&&copyAttributeContents(v,f,h),h+=v.count}}return t}function checkTypedArrayEquality(n,e){if(n===null||e===null)return n===e;if(n.length!==e.length)return!1;for(let t=0,o=n.length;t<o;t++)if(n[t]!==e[t])return!1;return!0}function invertGeometry(n){const{index:e,attributes:t}=n;if(e)for(let o=0,i=e.count;o<i;o+=3){const s=e.getX(o),r=e.getX(o+2);e.setX(o,r),e.setX(o+2,s)}else for(const o in t){const i=t[o],s=i.itemSize;for(let r=0,a=i.count;r<a;r+=3)for(let l=0;l<s;l++){const c=i.getComponent(r,l),d=i.getComponent(r+2,l);i.setComponent(r,l,d),i.setComponent(r+2,l,c)}}return n}class GeometryDiff{constructor(e){this.matrixWorld=new Matrix4$1,this.geometryHash=null,this.boneMatrices=null,this.primitiveCount=-1,this.mesh=e,this.update()}update(){const e=this.mesh,t=e.geometry,o=e.skeleton,i=(t.index?t.index.count:t.attributes.position.count)/3;if(this.matrixWorld.copy(e.matrixWorld),this.geometryHash=t.attributes.position.version,this.primitiveCount=i,o){o.boneTexture||o.computeBoneTexture(),o.update();const s=o.boneMatrices;!this.boneMatrices||this.boneMatrices.length!==s.length?this.boneMatrices=s.slice():this.boneMatrices.set(s)}else this.boneMatrices=null}didChange(){const e=this.mesh,t=e.geometry,o=(t.index?t.index.count:t.attributes.position.count)/3;return!(this.matrixWorld.equals(e.matrixWorld)&&this.geometryHash===t.attributes.position.version&&checkTypedArrayEquality(e.skeleton&&e.skeleton.boneMatrices||null,this.boneMatrices)&&this.primitiveCount===o)}}class StaticGeometryGenerator{constructor(e){Array.isArray(e)||(e=[e]);const t=[];e.forEach(o=>{o.traverseVisible(i=>{i.isMesh&&t.push(i)})}),this.meshes=t,this.useGroups=!0,this.applyWorldTransforms=!0,this.attributes=["position","normal","color","tangent","uv","uv2"],this._intermediateGeometry=new Array(t.length).fill().map(()=>new BufferGeometry),this._diffMap=new WeakMap}getMaterials(){const e=[];return this.meshes.forEach(t=>{Array.isArray(t.material)?e.push(...t.material):e.push(t.material)}),e}generate(e=new BufferGeometry){let t=[];const{meshes:o,useGroups:i,_intermediateGeometry:s,_diffMap:r}=this;for(let a=0,l=o.length;a<l;a++){const c=o[a],d=s[a],u=r.get(c);!u||u.didChange(c)?(this._convertToStaticGeometry(c,d),t.push(!1),u?u.update():r.set(c,new GeometryDiff(c))):t.push(!0)}if(s.length===0){e.setIndex(null);const a=e.attributes;for(const l in a)e.deleteAttribute(l);for(const l in this.attributes)e.setAttribute(this.attributes[l],new BufferAttribute(new Float32Array(0),4,!1))}else mergeBufferGeometries$1(s,{useGroups:i,skipAttributes:t},e);for(const a in e.attributes)e.attributes[a].needsUpdate=!0;return e}_convertToStaticGeometry(e,t=new BufferGeometry){const o=e.geometry,i=this.applyWorldTransforms,s=this.attributes.includes("normal"),r=this.attributes.includes("tangent"),a=o.attributes,l=t.attributes;!t.index&&o.index&&(t.index=o.index.clone()),l.position||t.setAttribute("position",createAttributeClone(a.position)),s&&!l.normal&&a.normal&&t.setAttribute("normal",createAttributeClone(a.normal)),r&&!l.tangent&&a.tangent&&t.setAttribute("tangent",createAttributeClone(a.tangent)),validateAttributes(o.index,t.index),validateAttributes(a.position,l.position),s&&validateAttributes(a.normal,l.normal),r&&validateAttributes(a.tangent,l.tangent);const c=a.position,d=s?a.normal:null,u=r?a.tangent:null,f=o.morphAttributes.position,h=o.morphAttributes.normal,m=o.morphAttributes.tangent,p=o.morphTargetsRelative,v=e.morphTargetInfluences,g=new Matrix3$1;g.getNormalMatrix(e.matrixWorld),o.index&&t.index.array.set(o.index.array);for(let y=0,w=a.position.count;y<w;y++)_positionVector.fromBufferAttribute(c,y),d&&_normalVector.fromBufferAttribute(d,y),u&&(_tangentVector4.fromBufferAttribute(u,y),_tangentVector.fromBufferAttribute(u,y)),v&&(f&&applyMorphTarget(f,v,p,y,_positionVector),h&&applyMorphTarget(h,v,p,y,_normalVector),m&&applyMorphTarget(m,v,p,y,_tangentVector)),e.isSkinnedMesh&&(e.applyBoneTransform(y,_positionVector),d&&boneNormalTransform(e,y,_normalVector),u&&boneNormalTransform(e,y,_tangentVector)),i&&_positionVector.applyMatrix4(e.matrixWorld),l.position.setXYZ(y,_positionVector.x,_positionVector.y,_positionVector.z),d&&(i&&_normalVector.applyNormalMatrix(g),l.normal.setXYZ(y,_normalVector.x,_normalVector.y,_normalVector.z)),u&&(i&&_tangentVector.transformDirection(e.matrixWorld),l.tangent.setXYZW(y,_tangentVector.x,_tangentVector.y,_tangentVector.z,_tangentVector4.w));for(const y in this.attributes){const w=this.attributes[y];w==="position"||w==="tangent"||w==="normal"||!(w in a)||(l[w]||t.setAttribute(w,createAttributeClone(a[w])),validateAttributes(a[w],l[w]),copyAttributeContents(a[w],l[w]))}return e.matrixWorld.determinant()<0&&invertGeometry(t),t}}let walkSound$1=null,runSound$1=null,selectedPlayerMixer,actionIdle,actionWalk,actionRun,actionJump,actionSitting,hoveraction=null,actionFalling=null,hoverspeed=null,player$3=null,currentAction,model=null,isVRMode$2=!1,movementEnabled=!0,cameraFollowsPlayer=!0,currentSceneData=null;const userInfo$2=getUserInfo(),playerState={velocity:new Vector3$1,onGround:!1,fwdPressed:!1,bkdPressed:!1,lftPressed:!1,rgtPressed:!1,shiftPressed:!1,isSitting:!1,vrInput:null,lastPosition:null,lastVelocity:null,lastOnGround:!1,lastRotation:0},tempVector=new Vector3$1,tempVector2=new Vector3$1,tempBox=new Box3,tempMat=new Matrix4$1,tempSegment=new Line3;let ANIMATION_SPEED_FACTOR=1,playerControlsEnabled=!0;const gravity=-9.8;let playerSpeed=4;const ROTATION_SPEED=Math.PI/2;let targetRotation=0,currentRotation=0;const ROTATION_SMOOTHING=8;let cameraControlsEnabled=!0,additionalColliders=new Map;function initializePlayer(n,e,t,o){currentSceneData=getCurrentScene();let i=!0;if(playerControlsEnabled=!0,document.addEventListener("visibilitychange",()=>{document.hidden?(player$3&&(playerState.lastPosition=player$3.position.clone(),playerState.lastVelocity=playerState.velocity.clone(),playerState.lastOnGround=playerState.onGround,playerState.lastRotation=player$3.rotation.y),window.isElectroSequencePlaying||(togglePlayerPhysics(!1),togglePlayerControls(!1))):player$3&&playerState.lastPosition&&(playerState.velocity.set(0,0,0),player$3.position.copy(playerState.lastPosition),player$3.rotation.y=playerState.lastRotation,setTimeout(()=>{if(playerState.onGround=playerState.lastOnGround,window.isElectroSequencePlaying){togglePlayerPhysics(!0);return}window.isPlayerOnHoverboard||(togglePlayerPhysics(!0),togglePlayerControls(!0))},100))}),!currentSceneData||!currentSceneData.currentSceneData){console.error("Invalid scene data");return}let s=null;if(Object.keys(allAssets$4.selectedPlayer.model).forEach(f=>{userInfo$2.selectedCharacter.includes(f)&&(s=allAssets$4.selectedPlayer.model[f],console.log("Selected character:",f),selectedPlayerMixer=allAssets$4.characters.animations[f].mixer,actionIdle=allAssets$4.characters.animations[f].actions.Idle_Armature,actionWalk=allAssets$4.characters.animations[f].actions.Walk_Armature,actionRun=allAssets$4.characters.animations[f].actions.Run_Armature,actionJump=allAssets$4.characters.animations[f].actions.Jump_Armature,actionSitting=allAssets$4.characters.animations[f].actions.Sit_Armature,hoveraction=allAssets$4.characters.animations[f].actions.hoverboard_idle,hoverspeed=allAssets$4.characters.animations[f].actions.hoverboard_speed,actionFalling=allAssets$4.characters.animations[f].actions.zcliff_fall)}),!s){console.error("No character model found");return}if(player$3=new Mesh(new CapsuleGeometry(.3),new MeshStandardMaterial({opacity:0,transparent:!0,depthWrite:!1,depthTest:!1})),player$3.geometry.translate(0,-.5,0),player$3.capsuleInfo={radius:.3,segment:new Line3(new Vector3$1,new Vector3$1(0,-1,0))},player$3.name="playerCapsule",currentSceneData.currentSceneData.startPosition){const f=currentSceneData.currentSceneData.startPosition;player$3.position.set(f.position.x,f.position.y,f.position.z);const h=f.rotation.y||0;player$3.rotation.y=h,targetRotation=h,currentRotation=h}else player$3.position.set(0,0,0),player$3.rotation.y=0,targetRotation=0,currentRotation=0;n.add(player$3),console.log("Player added to scene at position:",player$3.position),model=s,model.position.set(0,-1.27,0),model.rotation.y=Math.PI,model.traverse(f=>{f.isMesh&&(f.castShadow=!0,f.receiveShadow=!0,f.material.fog=!1,userInfo$2.modeSelected!=="non-vr"&&(f.visible=!1))}),player$3.add(model),actionIdle&&(actionIdle.timeScale=ANIMATION_SPEED_FACTOR*.4),actionWalk&&(actionWalk.timeScale=ANIMATION_SPEED_FACTOR),actionRun&&(actionRun.timeScale=ANIMATION_SPEED_FACTOR),actionJump&&(actionJump.timeScale=ANIMATION_SPEED_FACTOR),actionSitting&&(actionSitting.timeScale=ANIMATION_SPEED_FACTOR),hoveraction&&(hoveraction.timeScale=ANIMATION_SPEED_FACTOR),actionFalling&&(actionFalling.timeScale=ANIMATION_SPEED_FACTOR),currentAction=actionIdle||(s.animations.length>0?selectedPlayerMixer.clipAction(s.animations[0]):null),currentAction&&currentAction.play(),Object.keys(allAssets$4.selectedPlayer.audios).length!==0&&(walkSound$1=allAssets$4.selectedPlayer.audios.walking,runSound$1=allAssets$4.selectedPlayer.audios.walking);const r=currentSceneData.currentSceneData.startPosition.cameraPosition,a=new Vector3$1(r.x,r.y,r.z);e.position.copy(player$3.position.clone().add(a)),e.lookAt(player$3.position),window.addEventListener("keydown",onKeyDown),window.addEventListener("keyup",onKeyUp);const l=new Clock;i=!0;let c=null;function d(){if(!i)return;const f=l.getDelta();updatePlayer(f,e,t,o),c=requestAnimationFrame(d)}d();function u(){cancelAnimationFrame(c),player$3&&(i=!1,n.remove(player$3),model.traverse(f=>{f.isMesh&&(f.geometry.dispose(),f.material&&f.material.dispose())}),walkSound$1&&(walkSound$1.stop(),walkSound$1.source=null,walkSound$1=null),runSound$1&&(runSound$1.stop(),runSound$1.source=null,runSound$1=null),window.removeEventListener("keydown",onKeyDown),window.removeEventListener("keyup",onKeyUp),playerState.fwdPressed=!1,playerState.bkdPressed=!1,playerState.lftPressed=!1,playerState.rgtPressed=!1,playerState.shiftPressed=!1,playerState.isSitting=!1,selectedPlayerMixer&&(selectedPlayerMixer.stopAllAction(),selectedPlayerMixer.uncacheRoot(selectedPlayerMixer),selectedPlayerMixer=null),actionIdle=null,actionWalk=null,actionRun=null,actionJump=null,actionSitting=null,hoveraction=null,actionFalling=null,player$3=null,model=null,currentSceneData=null)}return{cleanUpPlayer:u,player:player$3,model,selectedPlayerMixer}}let playerPhysicsEnabled=!0;document.addEventListener("visibilitychange",()=>{document.hidden?(player$3&&(playerState.lastPosition=player$3.position.clone(),playerState.lastVelocity=playerState.velocity.clone(),playerState.lastOnGround=playerState.onGround,playerState.lastRotation=player$3.rotation.y),window.isElectroSequencePlaying||(togglePlayerPhysics(!1),togglePlayerControls(!1))):player$3&&playerState.lastPosition&&(playerState.velocity.set(0,0,0),player$3.position.copy(playerState.lastPosition),player$3.rotation.y=playerState.lastRotation,setTimeout(()=>{if(playerState.onGround=playerState.lastOnGround,window.isElectroSequencePlaying){togglePlayerPhysics(!0);return}window.isPlayerOnHoverboard||(togglePlayerPhysics(!0),togglePlayerControls(!0))},100))});function togglePlayerPhysics(n){playerPhysicsEnabled=n,n||playerState.velocity.set(0,0,0)}function togglePlayerControls(n){playerControlsEnabled=n}function handleCollisions(n,e,t,o){if(!e||!e.geometry||!e.geometry.boundsTree)return;const i=n.capsuleInfo;let s=!1,r=new Vector3$1,a=new Vector3$1;additionalColliders.forEach(u=>{var f;if(u.enabled&&u.collisionMesh){const h=u.collisionMesh;if(!((f=h.geometry)!=null&&f.boundsTree))return;const m=new Box3,p=new Matrix4$1,v=new Line3,g=new Vector3$1,y=new Vector3$1;m.makeEmpty(),p.copy(h.matrixWorld).invert(),v.copy(i.segment),v.start.applyMatrix4(n.matrixWorld).applyMatrix4(p),v.end.applyMatrix4(n.matrixWorld).applyMatrix4(p),m.expandByPoint(v.start),m.expandByPoint(v.end),m.min.addScalar(-i.radius),m.max.addScalar(i.radius);let w=new Vector3$1,_=new Vector3$1,S=!1;if(h.geometry.boundsTree.shapecast({intersectsBounds:C=>C.intersectsBox(m),intersectsTriangle:C=>{const A=g,E=y,k=C.closestPointToSegment(v,A,E);if(k<i.radius){const I=i.radius-k,F=E.sub(A).normalize();w.copy(F),_.copy(E),S=!0,v.start.addScaledVector(F,I),v.end.addScaledVector(F,I)}}}),S){s=!0;const C=g;C.copy(v.start).applyMatrix4(h.matrixWorld);const A=y;A.subVectors(C,n.position),A.y<0&&(A.y=0),r.add(A),a.add(w);const E=w.clone().multiplyScalar(t.dot(w)),k=t.clone().sub(E);k.multiplyScalar(.999),t.copy(E).add(k),t.multiplyScalar(.999),t.length()<.01&&t.set(0,0,0),t.y<0&&(t.y=0)}}}),tempBox.makeEmpty(),tempMat.copy(e.matrixWorld).invert(),tempSegment.copy(i.segment),tempSegment.start.applyMatrix4(n.matrixWorld).applyMatrix4(tempMat),tempSegment.end.applyMatrix4(n.matrixWorld).applyMatrix4(tempMat),tempBox.expandByPoint(tempSegment.start),tempBox.expandByPoint(tempSegment.end),tempBox.min.addScalar(-i.radius),tempBox.max.addScalar(i.radius);let l=new Vector3$1,c=new Vector3$1,d=!1;if(e.geometry.boundsTree.shapecast({intersectsBounds:u=>u.intersectsBox(tempBox),intersectsTriangle:u=>{const f=tempVector,h=tempVector2,m=u.closestPointToSegment(tempSegment,f,h);if(m<i.radius){const p=i.radius-m,v=h.sub(f).normalize();l.copy(v),c.copy(h),d=!0,tempSegment.start.addScaledVector(v,p),tempSegment.end.addScaledVector(v,p)}}}),d){s=!0;const u=tempVector;u.copy(tempSegment.start).applyMatrix4(e.matrixWorld);const f=tempVector2;f.subVectors(u,n.position),r.add(f),a.add(l),playerState.onGround=f.y>Math.abs(o*t.y*.25);const h=l.clone().multiplyScalar(t.dot(l)),m=t.clone().sub(h);m.multiplyScalar(.999),t.copy(h).add(m),t.multiplyScalar(.999),t.length()<.01&&t.set(0,0,0)}else playerState.onGround=!1;if(s){a.length()>0&&a.normalize();const u=Math.max(0,r.length()-1e-5);u>0&&(r.normalize().multiplyScalar(u),n.position.add(r))}playerState.onGround?t.y=0:t.y+=gravity*o}function resetPlayer(){if(!player$3){console.error("Cannot reset player: player is null");return}playerState.velocity.set(0,0,0);const n=getCurrentScene();n.currentSceneData&&n.currentSceneData.startPosition?(player$3.position.set(n.currentSceneData.startPosition.position.x,n.currentSceneData.startPosition.position.y,n.currentSceneData.startPosition.position.z),player$3.rotation.y=n.currentSceneData.startPosition.rotation.y,console.log("Player reset to start position:",player$3.position)):(player$3.position.set(0,8,0),player$3.rotation.y=Math.PI,console.log("Player reset to default position:",player$3.position)),actionIdle&&switchAction(actionIdle)}function movePlayer(n,e,t,o,i){tempVector.set(n,e,t).applyQuaternion(player$3.quaternion),player$3.position.addScaledVector(tempVector,o*i)}function updatePlayerAnimation(n,e){if(!selectedPlayerMixer||!currentAction||playerState.isSitting&&actionSitting||currentAction===actionJump&&actionJump)return;const t=n?e&&actionRun?actionRun:actionWalk:actionIdle;if(t&&currentAction!==t&&switchAction(t),walkSound$1&&runSound$1)if(n){const o=e?runSound$1:walkSound$1,i=e?walkSound$1:runSound$1;o.isPlaying||(i.stop(),o.play())}else walkSound$1.stop(),runSound$1.stop()}function updateCameraPosition(n,e){if(!player$3||!n||window.isElectroSequencePlaying)return;if(isFirstPerson){const i=player$3.position.clone().add(new Vector3$1(0,.56,0));n.position.copy(i);const s=new Vector3$1(0,0,-1).applyQuaternion(player$3.quaternion);n.lookAt(i.clone().add(s)),e&&cameraControlsEnabled&&(e.target.copy(i.clone().add(s)),e.update());return}const t=new Vector3$1(0,.25,2);t.applyAxisAngle(new Vector3$1(0,1,0),player$3.rotation.y),n.position.copy(player$3.position).add(t);const o=player$3.position.clone().add(new Vector3$1(0,.25,0));n.lookAt(o),e&&cameraControlsEnabled&&(e.target.copy(o),e.update())}function smoothRotatePlayer(n,e){targetRotation+=n*ROTATION_SPEED*e}function switchAction(n){n&&currentAction&&n&&currentAction!==n&&(currentAction.fadeOut(.2),n.reset(),n.fadeIn(.2),n.play(),currentAction=n)}function onKeyDown(n){if(!playerControlsEnabled){console.log("Player controls disabled");return}switch(n.code){case"ArrowUp":case"KeyW":playerState.fwdPressed=!0;break;case"ArrowDown":case"KeyS":playerState.bkdPressed=!0;break;case"ArrowLeft":case"KeyA":playerState.lftPressed||(playerState.lftPressed=!0);break;case"ArrowRight":case"KeyD":playerState.rgtPressed||(playerState.rgtPressed=!0);break;case"ShiftLeft":playerState.shiftPressed=!0;break;case"KeyR":console.log("Resetting player position"),resetPlayer();break;case"KeyP":logPlayerPosition();break;case"Space":playerState.onGround&&movementEnabled&&(console.log("Jump initiated"),playerState.velocity.y=10,actionJump&&(switchAction(actionJump),setTimeout(()=>{currentAction===actionJump&&switchAction(actionIdle)},2e3)));break}}function onKeyUp(n){if(!(!playerControlsEnabled||isVRMode$2))switch(n.code){case"ArrowUp":case"KeyW":playerState.fwdPressed=!1;break;case"ArrowDown":case"KeyS":playerState.bkdPressed=!1;break;case"ArrowLeft":case"KeyA":playerState.lftPressed=!1;break;case"ArrowRight":case"KeyD":playerState.rgtPressed=!1;break;case"ShiftLeft":playerState.shiftPressed=!1;break}}function hidePlayerModel(){model&&(model.visible=!1)}function showPlayerModel(){model&&(model.visible=!0)}function setCameraFollowsPlayer(n){cameraFollowsPlayer=n}function setCameraFocusOnPlayer(n){n||window.camera&&window.camera.userData.controls&&(window.camera.userData.controls.target.copy(new Vector3$1(0,0,0)),window.camera.userData.controls.update())}function updatePlayerMovement(n,e){const{fwdPressed:t,bkdPressed:o,lftPressed:i,rgtPressed:s}=playerState,r=e*.8;i?(smoothRotatePlayer(1,n),movePlayer(0,0,-1,r,n)):s?(smoothRotatePlayer(-1,n),movePlayer(0,0,-1,r,n)):t?movePlayer(0,0,-1,r,n):o&&movePlayer(0,0,1,r,n);const a=ROTATION_SMOOTHING*n;currentRotation+=(targetRotation-currentRotation)*a,player$3.rotation.y=currentRotation}function updatePlayer(n,e,t,o){if(!player$3){console.warn("Player object is null, skipping update");return}if(!playerPhysicsEnabled)return;if(n>1){selectedPlayerMixer&&selectedPlayerMixer.update(n);return}const s=1/240;let r=n;const{velocity:a,onGround:l,fwdPressed:c,bkdPressed:d,lftPressed:u,rgtPressed:f,shiftPressed:h}=playerState,m=p=>{if(selectedPlayerMixer&&selectedPlayerMixer.update(p),!playerControlsEnabled)return;!c&&!d&&!u&&!f&&(a.x=0,a.z=0),l?a.y=p*gravity:a.y+=p*gravity,a.y=Math.max(a.y,-20),player$3.position.addScaledVector(a,p);let v=playerSpeed*(h?2:1),g=c||d||u||f;updatePlayerMovement(p,v),updatePlayerAnimation(g,h),player$3.updateMatrixWorld(),playerPhysicsEnabled&&o&&o.geometry&&o.geometry.boundsTree&&handleCollisions(player$3,o,a,p)};for(;r>1e-6;){const p=Math.min(s,r);m(p),r-=p}e&&t&&cameraFollowsPlayer&&updateCameraPosition(e,t),player$3.position.y<-25&&resetPlayer()}function disablePlayerControls(){playerControlsEnabled=!1,playerState.fwdPressed=!1,playerState.bkdPressed=!1,playerState.lftPressed=!1,playerState.rgtPressed=!1,playerState.shiftPressed=!1,selectedPlayerMixer&&(selectedPlayerMixer.stopAllAction(),walkSound$1.stop(),runSound$1.stop(),actionIdle&&(actionIdle.reset().play(),currentAction=actionIdle))}function disableCameraControls(){cameraControlsEnabled=!1}function enablePlayerControls(){playerControlsEnabled=!0}function enableCameraControls(){cameraControlsEnabled=!0}function addCollider(n,e){if(!e||!e.geometry){console.error("Invalid collider object");return}const t=new Mesh(e.geometry,new MeshBasicMaterial({color:65280,wireframe:!0,opacity:.6,transparent:!0,visible:!1})),o=t.geometry.clone();return o.boundsTree=new MeshBVH(o),t.geometry=o,additionalColliders.set(n,{object:e,collisionMesh:t,enabled:!0}),t}function removeCollider(n){const e=additionalColliders.get(n);e&&(e.collisionMesh&&(e.collisionMesh.geometry.dispose(),e.collisionMesh.material.dispose()),additionalColliders.delete(n))}function updateColliderPosition(n,e,t){const o=additionalColliders.get(n);o&&o.collisionMesh&&(o.collisionMesh.position.copy(e),t&&o.collisionMesh.rotation.copy(t),o.collisionMesh.updateMatrixWorld(!0))}function debugColliderPositions(){console.log("=== Collider Debug Info ==="),additionalColliders.forEach((n,e)=>{n.collisionMesh&&console.log(`${e}:`,{position:n.collisionMesh.position.toArray(),rotation:n.collisionMesh.rotation.toArray(),enabled:n.collisionMesh.enabled,visible:n.collisionMesh.visible})}),console.log("==========================")}function logPlayerPosition(){player$3?console.log("Player position:",player$3.position.toArray().map(n=>n.toFixed(3))):console.log("Player not initialized")}function toggleColliderDebugVisibility(n){additionalColliders.forEach(e=>{e.collisionMesh&&(e.collisionMesh.visible=n)})}let isFirstPerson=!1;function switchToFirstPerson(n,e){if(!player$3||!n)return;isFirstPerson=!0,model&&(model.visible=!1);const t=player$3.position.clone().add(new Vector3$1(0,1.6,0));n.position.copy(t);const o=new Vector3$1(0,0,-1).applyQuaternion(player$3.quaternion);n.lookAt(t.clone().add(o)),e&&(e.target.copy(t.clone().add(o)),e.update())}function createLoadingScreenShader(){const n=new PlaneGeometry(2,2),e=new ShaderMaterial({uniforms:{time:{value:0},resolution:{value:new Vector2$1(window.innerWidth,window.innerHeight)},aspectRatio:{value:window.innerWidth/window.innerHeight},color:{value:new Color("0x4a6cf7")},brightness:{value:0},contrast:{value:0},power:{value:1},dissolve:{value:0},speed:{value:2},fadeAway:{value:.5},uniformity:{value:10},warpColor:{value:new Color(4877559)},starSpeed:{value:.1},twinkleSpeed:{value:.5},starScale:{value:1},tunnelFov:{value:2},tunnelSpeed:{value:1.2},tunnelMaskSize:{value:.5},tunnelSize:{value:.5}},vertexShader:`
            varying vec2 vUv;
            varying vec3 vPosition;
            varying vec3 vNormal;

            void main() {
                vUv = uv;
                vPosition = position;
                vNormal = normal;
                
                gl_Position = vec4(position, 1.0); // Use position directly for screen-filling quad
            }
        `,fragmentShader:`
            uniform float time;
            uniform vec2 resolution;
            uniform float aspectRatio;
            uniform vec3 color;
            uniform float brightness;
            uniform float contrast;
            uniform float power;
            uniform float dissolve;

            // Warp Speed uniforms
            uniform float speed;
            uniform float fadeAway;
            uniform float uniformity;
            uniform vec3 warpColor;

            // Starfield uniforms
            uniform float starSpeed;
            uniform float twinkleSpeed;
            uniform float starScale;

            // Tunnel uniforms
            uniform float tunnelFov;
            uniform float tunnelSpeed;
            uniform float tunnelMaskSize;
            uniform float tunnelSize;

            varying vec2 vUv;
            varying vec3 vPosition;
            varying vec3 vNormal;

            // Noise functions
            highp float rand(vec2 co) {
                highp float a = 1552.9898;
                highp float b = 78.233;
                highp float c = 43758.5453;
                highp float dt = dot(co.xy, vec2(a,b));
                highp float sn = mod(dt, 3.14);
                return fract(sin(sn) * c);
            }

            float noise(vec2 UV, float Seed, vec2 Frequency) {
                vec2 PerlinR = UV * Frequency;
                highp vec2 Perlin1Pos = floor(PerlinR);
                
                float RandX0 = (Perlin1Pos.x + (Perlin1Pos.y) * Seed);
                float RandX1 = ((Perlin1Pos.x + 1.0) + (Perlin1Pos.y) * Seed);
                float RandX2 = (Perlin1Pos.x + (Perlin1Pos.y + 1.0) * Seed);
                float RandX3 = ((Perlin1Pos.x + 1.0) + (Perlin1Pos.y + 1.0) * Seed);
                
                float Perlin0Val = rand(vec2(RandX0, RandX0 * 0.1224));
                float Perlin1Val = rand(vec2(RandX1, RandX1 * 0.1224));
                float Perlin2Val = rand(vec2(RandX2, RandX2 * 0.1224));
                float Perlin3Val = rand(vec2(RandX3, RandX3 * 0.1224));
                
                vec2 Perc = (sin(((PerlinR - Perlin1Pos) * 3.1415926) - 1.570796) * 0.5) + 0.5;
                
                float Val0to2 = mix(Perlin0Val, Perlin2Val, Perc.y); 
                float Val1to3 = mix(Perlin1Val, Perlin3Val, Perc.y); 
                
                return mix(Val0to2, Val1to3, Perc.x);
            }

            float perlinNoise1(vec2 UV, float Seed) {
                float RetVal = 0.0;
                RetVal += noise(UV, Seed * 1.2, vec2(2.0)) * 0.5;
                RetVal += noise(UV, Seed * 1.4, vec2(5.0)) * 0.25;
                RetVal += noise(UV, Seed * 1.1, vec2(10.0)) * 0.125;
                RetVal += noise(UV, Seed * 1.5, vec2(24.0)) * 0.0625;
                RetVal += noise(UV, Seed * 1.2, vec2(54.0)) * 0.03125;
                RetVal += noise(UV, Seed * 1.3, vec2(128.0)) * 0.025625;
                return RetVal;
            }

            float perlinNoise2(vec2 UV, float Seed) {
                float RetVal = 0.0;
                RetVal += noise(UV, Seed * 1.2, vec2(6.0)) * 0.5;
                RetVal += noise(UV, Seed * 1.4, vec2(12.0)) * 0.25;
                RetVal += noise(UV, Seed * 1.1, vec2(24.0)) * 0.125;
                RetVal += noise(UV, Seed * 1.5, vec2(40.0)) * 0.0625;
                RetVal += noise(UV, Seed * 1.2, vec2(80.0)) * 0.03125;
                RetVal += noise(UV, Seed * 1.3, vec2(158.0)) * 0.025625;
                return RetVal;
            }

            vec4 twinklingStarfield(vec2 uv) {
                vec2 UV = uv * starScale + time * starSpeed;
                
                vec2 TimeOffset = vec2(
                    sin(time * 0.00962379),
                    cos(time * 0.00962379)) * (sin(time * 0.0041839) + 0.3);
                
                float tempC = pow(1.0 - perlinNoise1(UV + TimeOffset, 21.32143), 3.5);
                vec3 tempA = vec3(tempC) * vec3(0.25, 0.67, 0.5);
                tempC = pow(((1.0 - perlinNoise2(UV + (TimeOffset * 1.15), 12.523)) * tempC), 1.1);
                tempA += vec3(tempC) * vec3(1.0, 0.0, 0.0);
                
                vec4 RetVal = vec4(0.0);    
                float randX = rand(UV);
                float randY = rand(UV.yx);
                float powIn = ((sin(((time + 10.0) * randX * twinkleSpeed)) * 0.5) + 0.5); 
                RetVal.xyz = max(vec3(randX * pow(randY, 10.0) * pow(powIn, 2.0)), vec3(0.0)); 
                RetVal.xyz += tempA;

                return RetVal;
            }

            vec4 warpSpeed() {
                float t = time * speed;
                vec2 position = (vUv.xy - 0.5) * vec2(aspectRatio, 1.0);
                float angle = atan(position.y, position.x) / (2.0 * 3.14159265359);
                angle -= floor(angle);
                float rad = length(position);
                float angleFract = fract(angle * 256.0);
                float angleRnd = floor(angle * 256.0) + 1.0;
                float angleRnd1 = fract(angleRnd * fract(angleRnd * 0.7235) * 45.1);
                float angleRnd2 = fract(angleRnd * fract(angleRnd * 0.82657) * 13.724);
                float t2 = t + angleRnd1 * uniformity;
                float radDist = sqrt(angleRnd2);
                float adist = radDist / rad * 0.1;
                float dist = (t2 * 0.1 + adist);
                dist = abs(fract(dist) - fadeAway);
                
                float outputColor = (1.0 / (dist)) * cos(0.7 * sin(t)) * adist / radDist / 30.0;
                return vec4(outputColor * warpColor, 1.0);
            }

            vec4 uvTunnel() {
                vec2 uv = (vUv - 0.5) * vec2(tunnelFov * aspectRatio, tunnelFov);
                float t = time * tunnelSpeed;

                vec2 b = vec2(
                    1.0 / length(uv) + t,
                    atan(uv.y, abs(uv.x)) / 1.14
                );

                float tunnelMask = min(1.0, tunnelMaskSize - b.x + t);
                return vec4(
                    twinklingStarfield(b.xy).rgb * tunnelMask,
                    1.0
                );
            }

            vec4 gradientMultiply() {
                float amount = 1.0 - length(vUv - 0.5);
                return vec4(0.2 + vec3(pow(amount, 2.0)), 1.0);
            }

            vec4 glowingCenter() {
                float amount = 1.0 - length(vUv - 0.5);
                return vec4(vec3(pow(amount, power * 20.0)), 1.0);
            }

            float dissolveEffect(vec2 uv, float dissolve) {
                float noise = perlinNoise1(uv * 3.0, 1.0);
                float smoothNoise = smoothstep(0.0, 1.0, noise);
                float smoothDissolve = smoothstep(0.0, 1.0, dissolve);
                float finalNoise = mix(smoothNoise, noise, 0.3);
                return step(smoothDissolve, finalNoise);
            }

            void main() {
                vec4 warp = warpSpeed();
                vec4 tunnel = uvTunnel();
                vec4 gradient = gradientMultiply();
                vec4 glow = glowingCenter();
                
                vec4 finalColor = warp + tunnel + (gradient * vec4(color * brightness, 1.0) * contrast) + glow;
                
                float dissolveMask = dissolveEffect(vUv, dissolve);
                finalColor.a = mix(0.0, 1.0, dissolveMask);
                
                gl_FragColor = finalColor;
            }
        `}),t=new Mesh(n,e);t.renderOrder=999,t.frustumCulled=!1;let o=0;return{plane:t,material:e,update:i=>{o+=i,e.uniforms.time.value=o},handleResize:(i,s)=>{e.uniforms.resolution.value.set(i,s),e.uniforms.aspectRatio.value=i/s}}}const loadingManager=new LoadingManager;let isLoading=!1,currentCamera$6=null,currentRenderer$1=null,shaderLoadingScreen=null,scene$a=null,clock$2=new Clock,resizeHandler$6=null,animationFrameId$7=null,currentLoadingProgress=0;function initializeLoadingManager(n,e,t){currentCamera$6=n,currentRenderer$1=e,scene$a=t;let o=document.getElementById("new-loading-bar"),i=document.getElementById("new-loading-screen");function s(){if(!isLoading){isLoading=!0;const{currentScene:l}=getCurrentScene(),c=document.getElementById("new-loading-image");if(c&&l){const d=l.replace("scene","");c.src=`/loadingimages/scene${d}.png`}i&&(i.style.display="flex",gsapWithCSS.to("#new-loading-screen",{duration:.5,opacity:1}))}}function r(){i&&gsapWithCSS.to("#new-loading-screen",{duration:.5,opacity:0,onComplete:()=>{i.style.display="none"}}),shaderLoadingScreen=createLoadingScreenShader(),shaderLoadingScreen.material.uniforms.dissolve.value=0,shaderLoadingScreen.material.uniforms.brightness.value=currentLoadingProgress/100,shaderLoadingScreen.material.transparent=!0,shaderLoadingScreen.material.depthWrite=!1,scene$a.add(shaderLoadingScreen.plane);function l(){if(!shaderLoadingScreen)return;animationFrameId$7=requestAnimationFrame(l);const c=clock$2.getDelta();shaderLoadingScreen.update(c),currentRenderer$1.render(scene$a,currentCamera$6)}clock$2.start(),l(),resizeHandler$6=()=>{shaderLoadingScreen&&currentRenderer$1&&shaderLoadingScreen.handleResize(window.innerWidth,window.innerHeight)},window.addEventListener("resize",resizeHandler$6)}function a(){const{currentScene:l}=getCurrentScene();if(l==="scene2"){if(shaderLoadingScreen){let u=function(){const f=(performance.now()-d)/1e3,h=Math.min(f/1,1);shaderLoadingScreen.material.uniforms.dissolve.value=h,currentRenderer$1&&scene$a&&currentCamera$6&&currentRenderer$1.render(scene$a,currentCamera$6),h<1?requestAnimationFrame(u):(resizeHandler$6&&(window.removeEventListener("resize",resizeHandler$6),resizeHandler$6=null),animationFrameId$7&&(cancelAnimationFrame(animationFrameId$7),animationFrameId$7=null),clock$2.stop(),scene$a.remove(shaderLoadingScreen.plane),shaderLoadingScreen.material.dispose(),shaderLoadingScreen=null,isLoading=!1,window.dispatchEvent(new CustomEvent(`loadingScreenHidden-${l}`)))};const d=performance.now();u()}}else i&&gsapWithCSS.to("#new-loading-screen",{duration:.5,opacity:0,onComplete:()=>{i.style.display="none",isLoading=!1,window.dispatchEvent(new CustomEvent(`loadingScreenHidden-${l}`))}})}return loadingManager.onStart=function(){s()},loadingManager.onProgress=function(l,c,d){const u=c/d*100;currentLoadingProgress=u;const{currentScene:f}=getCurrentScene();if(f==="scene2"){shaderLoadingScreen&&(shaderLoadingScreen.material.uniforms.brightness.value=u/100),o&&(o.style.width=u+"%");const h=document.querySelector(".new-loading-progress");h&&(h.textContent=Math.round(u)+"%")}else{o&&(o.style.width=u+"%");const h=document.querySelector(".new-loading-progress");h&&(h.textContent=Math.round(u)+"%")}},loadingManager.onLoad=async function(){const l=getUserInfo(),{currentScene:c}=getCurrentScene();if(c==="scene7"){const d=()=>{window.removeEventListener("cameraReady-scene7",d),requestAnimationFrame(()=>{a()})};window.addEventListener("cameraReady-scene7",d,{once:!0});return}l.modeSelected==="non-vr"?(togglePlayerControls(!1),togglePlayerPhysics(!1),c==="scene2"&&r(),await rotateCameraOnce(currentCamera$6),setTimeout(()=>{togglePlayerControls(!0),togglePlayerPhysics(!0),c==="scene2"&&shaderLoadingScreen?(currentRenderer$1.render(scene$a,currentCamera$6),setTimeout(()=>{a()},2e3)):c==="scene3"?setTimeout(()=>{a()},2e3):a()},100)):(togglePlayerControls(!1),togglePlayerPhysics(!1),c==="scene2"&&r(),await rotateCameraOnce(currentCamera$6),setTimeout(()=>{togglePlayerControls(!0),togglePlayerPhysics(!0),c==="scene2"&&shaderLoadingScreen?(currentRenderer$1.render(scene$a,currentCamera$6),setTimeout(()=>{a()},100)):a()},100))},loadingManager}const _lut=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let _seed=1234567;const DEG2RAD=Math.PI/180,RAD2DEG=180/Math.PI;function generateUUID(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,o=Math.random()*4294967295|0;return(_lut[n&255]+_lut[n>>8&255]+_lut[n>>16&255]+_lut[n>>24&255]+"-"+_lut[e&255]+_lut[e>>8&255]+"-"+_lut[e>>16&15|64]+_lut[e>>24&255]+"-"+_lut[t&63|128]+_lut[t>>8&255]+"-"+_lut[t>>16&255]+_lut[t>>24&255]+_lut[o&255]+_lut[o>>8&255]+_lut[o>>16&255]+_lut[o>>24&255]).toLowerCase()}function clamp(n,e,t){return Math.max(e,Math.min(t,n))}function euclideanModulo(n,e){return(n%e+e)%e}function mapLinear(n,e,t,o,i){return o+(n-e)*(i-o)/(t-e)}function inverseLerp(n,e,t){return n!==e?(t-n)/(e-n):0}function lerp(n,e,t){return(1-t)*n+t*e}function damp(n,e,t,o){return lerp(n,e,1-Math.exp(-t*o))}function pingpong(n,e=1){return e-Math.abs(euclideanModulo(n,e*2)-e)}function smoothstep(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function smootherstep(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function randInt(n,e){return n+Math.floor(Math.random()*(e-n+1))}function randFloat(n,e){return n+Math.random()*(e-n)}function randFloatSpread(n){return n*(.5-Math.random())}function seededRandom(n){n!==void 0&&(_seed=n);let e=_seed+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function degToRad(n){return n*DEG2RAD}function radToDeg(n){return n*RAD2DEG}function isPowerOfTwo(n){return(n&n-1)===0&&n!==0}function ceilPowerOfTwo(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function floorPowerOfTwo(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function setQuaternionFromProperEuler(n,e,t,o,i){const s=Math.cos,r=Math.sin,a=s(t/2),l=r(t/2),c=s((e+o)/2),d=r((e+o)/2),u=s((e-o)/2),f=r((e-o)/2),h=s((o-e)/2),m=r((o-e)/2);switch(i){case"XYX":n.set(a*d,l*u,l*f,a*c);break;case"YZY":n.set(l*f,a*d,l*u,a*c);break;case"ZXZ":n.set(l*u,l*f,a*d,a*c);break;case"XZX":n.set(a*d,l*m,l*h,a*c);break;case"YXY":n.set(l*h,a*d,l*m,a*c);break;case"ZYZ":n.set(l*m,l*h,a*d,a*c);break;default:console.warn("../math.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function denormalize(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function normalize(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const MathUtils={DEG2RAD,RAD2DEG,generateUUID,clamp,euclideanModulo,mapLinear,inverseLerp,lerp,damp,pingpong,smoothstep,smootherstep,randInt,randFloat,randFloatSpread,seededRandom,degToRad,radToDeg,isPowerOfTwo,ceilPowerOfTwo,floorPowerOfTwo,setQuaternionFromProperEuler,normalize,denormalize};class Quaternion{constructor(e=0,t=0,o=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=o,this._w=i}static slerpFlat(e,t,o,i,s,r,a){let l=o[i+0],c=o[i+1],d=o[i+2],u=o[i+3];const f=s[r+0],h=s[r+1],m=s[r+2],p=s[r+3];if(a===0){e[t+0]=l,e[t+1]=c,e[t+2]=d,e[t+3]=u;return}if(a===1){e[t+0]=f,e[t+1]=h,e[t+2]=m,e[t+3]=p;return}if(u!==p||l!==f||c!==h||d!==m){let v=1-a;const g=l*f+c*h+d*m+u*p,y=g>=0?1:-1,w=1-g*g;if(w>Number.EPSILON){const S=Math.sqrt(w),C=Math.atan2(S,g*y);v=Math.sin(v*C)/S,a=Math.sin(a*C)/S}const _=a*y;if(l=l*v+f*_,c=c*v+h*_,d=d*v+m*_,u=u*v+p*_,v===1-a){const S=1/Math.sqrt(l*l+c*c+d*d+u*u);l*=S,c*=S,d*=S,u*=S}}e[t]=l,e[t+1]=c,e[t+2]=d,e[t+3]=u}static multiplyQuaternionsFlat(e,t,o,i,s,r){const a=o[i],l=o[i+1],c=o[i+2],d=o[i+3],u=s[r],f=s[r+1],h=s[r+2],m=s[r+3];return e[t]=a*m+d*u+l*h-c*f,e[t+1]=l*m+d*f+c*u-a*h,e[t+2]=c*m+d*h+a*f-l*u,e[t+3]=d*m-a*u-l*f-c*h,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,o,i){return this._x=e,this._y=t,this._z=o,this._w=i,this._onChangeCallback(),this}clone(){return new Quaternion(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const o=e._x,i=e._y,s=e._z,r=e._order,a=Math.cos,l=Math.sin,c=a(o/2),d=a(i/2),u=a(s/2),f=l(o/2),h=l(i/2),m=l(s/2);switch(r){case"XYZ":this._x=f*d*u+c*h*m,this._y=c*h*u-f*d*m,this._z=c*d*m+f*h*u,this._w=c*d*u-f*h*m;break;case"YXZ":this._x=f*d*u+c*h*m,this._y=c*h*u-f*d*m,this._z=c*d*m-f*h*u,this._w=c*d*u+f*h*m;break;case"ZXY":this._x=f*d*u-c*h*m,this._y=c*h*u+f*d*m,this._z=c*d*m+f*h*u,this._w=c*d*u-f*h*m;break;case"ZYX":this._x=f*d*u-c*h*m,this._y=c*h*u+f*d*m,this._z=c*d*m-f*h*u,this._w=c*d*u+f*h*m;break;case"YZX":this._x=f*d*u+c*h*m,this._y=c*h*u+f*d*m,this._z=c*d*m-f*h*u,this._w=c*d*u-f*h*m;break;case"XZY":this._x=f*d*u-c*h*m,this._y=c*h*u-f*d*m,this._z=c*d*m+f*h*u,this._w=c*d*u+f*h*m;break;default:console.warn("../math.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const o=t/2,i=Math.sin(o);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(o),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,o=t[0],i=t[4],s=t[8],r=t[1],a=t[5],l=t[9],c=t[2],d=t[6],u=t[10],f=o+a+u;if(f>0){const h=.5/Math.sqrt(f+1);this._w=.25/h,this._x=(d-l)*h,this._y=(s-c)*h,this._z=(r-i)*h}else if(o>a&&o>u){const h=2*Math.sqrt(1+o-a-u);this._w=(d-l)/h,this._x=.25*h,this._y=(i+r)/h,this._z=(s+c)/h}else if(a>u){const h=2*Math.sqrt(1+a-o-u);this._w=(s-c)/h,this._x=(i+r)/h,this._y=.25*h,this._z=(l+d)/h}else{const h=2*Math.sqrt(1+u-o-a);this._w=(r-i)/h,this._x=(s+c)/h,this._y=(l+d)/h,this._z=.25*h}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let o=e.dot(t)+1;return o<Number.EPSILON?(o=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=o):(this._x=0,this._y=-e.z,this._z=e.y,this._w=o)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=o),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(clamp(this.dot(e),-1,1)))}rotateTowards(e,t){const o=this.angleTo(e);if(o===0)return this;const i=Math.min(1,t/o);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const o=e._x,i=e._y,s=e._z,r=e._w,a=t._x,l=t._y,c=t._z,d=t._w;return this._x=o*d+r*a+i*c-s*l,this._y=i*d+r*l+s*a-o*c,this._z=s*d+r*c+o*l-i*a,this._w=r*d-o*a-i*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const o=this._x,i=this._y,s=this._z,r=this._w;let a=r*e._w+o*e._x+i*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=r,this._x=o,this._y=i,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const h=1-t;return this._w=h*r+t*this._w,this._x=h*o+t*this._x,this._y=h*i+t*this._y,this._z=h*s+t*this._z,this.normalize(),this}const c=Math.sqrt(l),d=Math.atan2(c,a),u=Math.sin((1-t)*d)/c,f=Math.sin(t*d)/c;return this._w=r*u+this._w*f,this._x=o*u+this._x*f,this._y=i*u+this._y*f,this._z=s*u+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,o){return this.copy(e).slerp(t,o)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),o=Math.random(),i=Math.sqrt(1-o),s=Math.sqrt(o);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Vector3{constructor(e=0,t=0,o=0){this.isVector3=!0,Vector3.prototype.isVector3=!0,this.x=e,this.y=t,this.z=o}set(e,t,o){return o===void 0&&(o=this.z),this.x=e,this.y=t,this.z=o,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new Vector3(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(_quaternion$1.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(_quaternion$1.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,o=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*o+s[6]*i,this.y=s[1]*t+s[4]*o+s[7]*i,this.z=s[2]*t+s[5]*o+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,o=this.y,i=this.z,s=e.elements,r=1/(s[3]*t+s[7]*o+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*o+s[8]*i+s[12])*r,this.y=(s[1]*t+s[5]*o+s[9]*i+s[13])*r,this.z=(s[2]*t+s[6]*o+s[10]*i+s[14])*r,this}applyQuaternion(e){const t=this.x,o=this.y,i=this.z,s=e.x,r=e.y,a=e.z,l=e.w,c=2*(r*i-a*o),d=2*(a*t-s*i),u=2*(s*o-r*t);return this.x=t+l*c+r*u-a*d,this.y=o+l*d+a*c-s*u,this.z=i+l*u+s*d-r*c,this}transformDirection(e){const t=this.x,o=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*o+s[8]*i,this.y=s[1]*t+s[5]*o+s[9]*i,this.z=s[2]*t+s[6]*o+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(e,Math.min(t,o)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,o){return this.x=e.x+(t.x-e.x)*o,this.y=e.y+(t.y-e.y)*o,this.z=e.z+(t.z-e.z)*o,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const o=e.x,i=e.y,s=e.z,r=t.x,a=t.y,l=t.z;return this.x=i*l-s*a,this.y=s*r-o*l,this.z=o*a-i*r,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const o=e.dot(this)/t;return this.copy(e).multiplyScalar(o)}projectOnPlane(e){return _vector$1.copy(this).projectOnVector(e),this.sub(_vector$1)}reflect(e){return this.sub(_vector$1.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const o=this.dot(e)/t;return Math.acos(clamp(o,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,o=this.y-e.y,i=this.z-e.z;return t*t+o*o+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSphericalCoords(e,t,o){const i=Math.sin(t)*e;return this.x=i*Math.sin(o),this.y=Math.cos(t)*e,this.z=i*Math.cos(o),this}setFromCylindricalCoords(e,t,o){return this.x=e*Math.sin(t),this.y=o,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),o=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=o,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,o=Math.sqrt(1-t*t);return this.x=o*Math.cos(e),this.y=t,this.z=o*Math.sin(e),this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this.z=Math.abs(this.z),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _vector$1=new Vector3,_quaternion$1=new Quaternion,WebGLCoordinateSystem=2e3,WebGPUCoordinateSystem=2001;class Matrix4{constructor(e,t,o,i,s,r,a,l,c,d,u,f,h,m,p,v){this.isMatrix4=!0,Matrix4.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,o,i,s,r,a,l,c,d,u,f,h,m,p,v)}extractPosition(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)}multiplyToArray(e,t,o){return console.error("THREE.Matrix4: .multiplyToArray() has been removed."),this}setRotationFromQuaternion(e){return this.makeRotationFromQuaternion(e)}set(e,t,o,i,s,r,a,l,c,d,u,f,h,m,p,v){const g=this.elements;return g[0]=e,g[4]=t,g[8]=o,g[12]=i,g[1]=s,g[5]=r,g[9]=a,g[13]=l,g[2]=c,g[6]=d,g[10]=u,g[14]=f,g[3]=h,g[7]=m,g[11]=p,g[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Matrix4().fromArray(this.elements)}copy(e){const t=this.elements,o=e.elements;return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t[8]=o[8],t[9]=o[9],t[10]=o[10],t[11]=o[11],t[12]=o[12],t[13]=o[13],t[14]=o[14],t[15]=o[15],this}copyPosition(e){const t=this.elements,o=e.elements;return t[12]=o[12],t[13]=o[13],t[14]=o[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,o){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),o.setFromMatrixColumn(this,2),this}makeBasis(e,t,o){return this.set(e.x,t.x,o.x,0,e.y,t.y,o.y,0,e.z,t.z,o.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,o=e.elements,i=1/_v1.setFromMatrixColumn(e,0).length(),s=1/_v1.setFromMatrixColumn(e,1).length(),r=1/_v1.setFromMatrixColumn(e,2).length();return t[0]=o[0]*i,t[1]=o[1]*i,t[2]=o[2]*i,t[3]=0,t[4]=o[4]*s,t[5]=o[5]*s,t[6]=o[6]*s,t[7]=0,t[8]=o[8]*r,t[9]=o[9]*r,t[10]=o[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,o=e.x,i=e.y,s=e.z,r=Math.cos(o),a=Math.sin(o),l=Math.cos(i),c=Math.sin(i),d=Math.cos(s),u=Math.sin(s);if(e.order==="XYZ"){const f=r*d,h=r*u,m=a*d,p=a*u;t[0]=l*d,t[4]=-l*u,t[8]=c,t[1]=h+m*c,t[5]=f-p*c,t[9]=-a*l,t[2]=p-f*c,t[6]=m+h*c,t[10]=r*l}else if(e.order==="YXZ"){const f=l*d,h=l*u,m=c*d,p=c*u;t[0]=f+p*a,t[4]=m*a-h,t[8]=r*c,t[1]=r*u,t[5]=r*d,t[9]=-a,t[2]=h*a-m,t[6]=p+f*a,t[10]=r*l}else if(e.order==="ZXY"){const f=l*d,h=l*u,m=c*d,p=c*u;t[0]=f-p*a,t[4]=-r*u,t[8]=m+h*a,t[1]=h+m*a,t[5]=r*d,t[9]=p-f*a,t[2]=-r*c,t[6]=a,t[10]=r*l}else if(e.order==="ZYX"){const f=r*d,h=r*u,m=a*d,p=a*u;t[0]=l*d,t[4]=m*c-h,t[8]=f*c+p,t[1]=l*u,t[5]=p*c+f,t[9]=h*c-m,t[2]=-c,t[6]=a*l,t[10]=r*l}else if(e.order==="YZX"){const f=r*l,h=r*c,m=a*l,p=a*c;t[0]=l*d,t[4]=p-f*u,t[8]=m*u+h,t[1]=u,t[5]=r*d,t[9]=-a*d,t[2]=-c*d,t[6]=h*u+m,t[10]=f-p*u}else if(e.order==="XZY"){const f=r*l,h=r*c,m=a*l,p=a*c;t[0]=l*d,t[4]=-u,t[8]=c*d,t[1]=f*u+p,t[5]=r*d,t[9]=h*u-m,t[2]=m*u-h,t[6]=a*d,t[10]=p*u+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(_zero,e,_one)}lookAt(e,t,o){const i=this.elements;return _z.subVectors(e,t),_z.lengthSq()===0&&(_z.z=1),_z.normalize(),_x.crossVectors(o,_z),_x.lengthSq()===0&&(Math.abs(o.z)===1?_z.x+=1e-4:_z.z+=1e-4,_z.normalize(),_x.crossVectors(o,_z)),_x.normalize(),_y.crossVectors(_z,_x),i[0]=_x.x,i[4]=_y.x,i[8]=_z.x,i[1]=_x.y,i[5]=_y.y,i[9]=_z.y,i[2]=_x.z,i[6]=_y.z,i[10]=_z.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const o=e.elements,i=t.elements,s=this.elements,r=o[0],a=o[4],l=o[8],c=o[12],d=o[1],u=o[5],f=o[9],h=o[13],m=o[2],p=o[6],v=o[10],g=o[14],y=o[3],w=o[7],_=o[11],S=o[15],C=i[0],A=i[4],E=i[8],k=i[12],I=i[1],F=i[5],M=i[9],R=i[13],O=i[2],$=i[6],T=i[10],D=i[14],P=i[3],L=i[7],B=i[11],b=i[15];return s[0]=r*C+a*I+l*O+c*P,s[4]=r*A+a*F+l*$+c*L,s[8]=r*E+a*M+l*T+c*B,s[12]=r*k+a*R+l*D+c*b,s[1]=d*C+u*I+f*O+h*P,s[5]=d*A+u*F+f*$+h*L,s[9]=d*E+u*M+f*T+h*B,s[13]=d*k+u*R+f*D+h*b,s[2]=m*C+p*I+v*O+g*P,s[6]=m*A+p*F+v*$+g*L,s[10]=m*E+p*M+v*T+g*B,s[14]=m*k+p*R+v*D+g*b,s[3]=y*C+w*I+_*O+S*P,s[7]=y*A+w*F+_*$+S*L,s[11]=y*E+w*M+_*T+S*B,s[15]=y*k+w*R+_*D+S*b,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],o=e[4],i=e[8],s=e[12],r=e[1],a=e[5],l=e[9],c=e[13],d=e[2],u=e[6],f=e[10],h=e[14],m=e[3],p=e[7],v=e[11],g=e[15];return m*(+s*l*u-i*c*u-s*a*f+o*c*f+i*a*h-o*l*h)+p*(+t*l*h-t*c*f+s*r*f-i*r*h+i*c*d-s*l*d)+v*(+t*c*u-t*a*h-s*r*u+o*r*h+s*a*d-o*c*d)+g*(-i*a*d-t*l*u+t*a*f+i*r*u-o*r*f+o*l*d)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,o){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=o),this}invert(){const e=this.elements,t=e[0],o=e[1],i=e[2],s=e[3],r=e[4],a=e[5],l=e[6],c=e[7],d=e[8],u=e[9],f=e[10],h=e[11],m=e[12],p=e[13],v=e[14],g=e[15],y=u*v*c-p*f*c+p*l*h-a*v*h-u*l*g+a*f*g,w=m*f*c-d*v*c-m*l*h+r*v*h+d*l*g-r*f*g,_=d*p*c-m*u*c+m*a*h-r*p*h-d*a*g+r*u*g,S=m*u*l-d*p*l-m*a*f+r*p*f+d*a*v-r*u*v,C=t*y+o*w+i*_+s*S;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/C;return e[0]=y*A,e[1]=(p*f*s-u*v*s-p*i*h+o*v*h+u*i*g-o*f*g)*A,e[2]=(a*v*s-p*l*s+p*i*c-o*v*c-a*i*g+o*l*g)*A,e[3]=(u*l*s-a*f*s-u*i*c+o*f*c+a*i*h-o*l*h)*A,e[4]=w*A,e[5]=(d*v*s-m*f*s+m*i*h-t*v*h-d*i*g+t*f*g)*A,e[6]=(m*l*s-r*v*s-m*i*c+t*v*c+r*i*g-t*l*g)*A,e[7]=(r*f*s-d*l*s+d*i*c-t*f*c-r*i*h+t*l*h)*A,e[8]=_*A,e[9]=(m*u*s-d*p*s-m*o*h+t*p*h+d*o*g-t*u*g)*A,e[10]=(r*p*s-m*a*s+m*o*c-t*p*c-r*o*g+t*a*g)*A,e[11]=(d*a*s-r*u*s-d*o*c+t*u*c+r*o*h-t*a*h)*A,e[12]=S*A,e[13]=(d*p*i-m*u*i+m*o*f-t*p*f-d*o*v+t*u*v)*A,e[14]=(m*a*i-r*p*i-m*o*l+t*p*l+r*o*v-t*a*v)*A,e[15]=(r*u*i-d*a*i+d*o*l-t*u*l-r*o*f+t*a*f)*A,this}scale(e){const t=this.elements,o=e.x,i=e.y,s=e.z;return t[0]*=o,t[4]*=i,t[8]*=s,t[1]*=o,t[5]*=i,t[9]*=s,t[2]*=o,t[6]*=i,t[10]*=s,t[3]*=o,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],o=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,o,i))}makeTranslation(e,t,o){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,o,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),o=Math.sin(e);return this.set(1,0,0,0,0,t,-o,0,0,o,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),o=Math.sin(e);return this.set(t,0,o,0,0,1,0,0,-o,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),o=Math.sin(e);return this.set(t,-o,0,0,o,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const o=Math.cos(t),i=Math.sin(t),s=1-o,r=e.x,a=e.y,l=e.z,c=s*r,d=s*a;return this.set(c*r+o,c*a-i*l,c*l+i*a,0,c*a+i*l,d*a+o,d*l-i*r,0,c*l-i*a,d*l+i*r,s*l*l+o,0,0,0,0,1),this}makeScale(e,t,o){return this.set(e,0,0,0,0,t,0,0,0,0,o,0,0,0,0,1),this}makeShear(e,t,o,i,s,r){return this.set(1,o,s,0,e,1,r,0,t,i,1,0,0,0,0,1),this}compose(e,t,o){const i=this.elements,s=t._x,r=t._y,a=t._z,l=t._w,c=s+s,d=r+r,u=a+a,f=s*c,h=s*d,m=s*u,p=r*d,v=r*u,g=a*u,y=l*c,w=l*d,_=l*u,S=o.x,C=o.y,A=o.z;return i[0]=(1-(p+g))*S,i[1]=(h+_)*S,i[2]=(m-w)*S,i[3]=0,i[4]=(h-_)*C,i[5]=(1-(f+g))*C,i[6]=(v+y)*C,i[7]=0,i[8]=(m+w)*A,i[9]=(v-y)*A,i[10]=(1-(f+p))*A,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,o){const i=this.elements;let s=_v1.set(i[0],i[1],i[2]).length();const r=_v1.set(i[4],i[5],i[6]).length(),a=_v1.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],_m1.copy(this);const c=1/s,d=1/r,u=1/a;return _m1.elements[0]*=c,_m1.elements[1]*=c,_m1.elements[2]*=c,_m1.elements[4]*=d,_m1.elements[5]*=d,_m1.elements[6]*=d,_m1.elements[8]*=u,_m1.elements[9]*=u,_m1.elements[10]*=u,t.setFromRotationMatrix(_m1),o.x=s,o.y=r,o.z=a,this}makePerspective(e,t,o,i,s,r,a=WebGLCoordinateSystem){const l=this.elements,c=2*s/(t-e),d=2*s/(o-i),u=(t+e)/(t-e),f=(o+i)/(o-i);let h,m;if(a===WebGLCoordinateSystem)h=-(r+s)/(r-s),m=-2*r*s/(r-s);else if(a===WebGPUCoordinateSystem)h=-r/(r-s),m=-r*s/(r-s);else throw new Error("Matrix4.makePerspective(): Invalid coordinate system: "+a);return l[0]=c,l[4]=0,l[8]=u,l[12]=0,l[1]=0,l[5]=d,l[9]=f,l[13]=0,l[2]=0,l[6]=0,l[10]=h,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,o,i,s,r,a=WebGLCoordinateSystem){const l=this.elements,c=1/(t-e),d=1/(o-i),u=1/(r-s),f=(t+e)*c,h=(o+i)*d;let m,p;if(a===WebGLCoordinateSystem)m=(r+s)*u,p=-2*u;else if(a===WebGPUCoordinateSystem)m=s*u,p=-1*u;else throw new Error("../math.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return l[0]=2*c,l[4]=0,l[8]=0,l[12]=-f,l[1]=0,l[5]=2*d,l[9]=0,l[13]=-h,l[2]=0,l[6]=0,l[10]=p,l[14]=-m,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,o=e.elements;for(let i=0;i<16;i++)if(t[i]!==o[i])return!1;return!0}fromArray(e,t=0){for(let o=0;o<16;o++)this.elements[o]=e[o+t];return this}toArray(e=[],t=0){const o=this.elements;return e[t]=o[0],e[t+1]=o[1],e[t+2]=o[2],e[t+3]=o[3],e[t+4]=o[4],e[t+5]=o[5],e[t+6]=o[6],e[t+7]=o[7],e[t+8]=o[8],e[t+9]=o[9],e[t+10]=o[10],e[t+11]=o[11],e[t+12]=o[12],e[t+13]=o[13],e[t+14]=o[14],e[t+15]=o[15],e}}const _v1=new Vector3,_m1=new Matrix4,_zero=new Vector3(0,0,0),_one=new Vector3(1,1,1),_x=new Vector3,_y=new Vector3,_z=new Vector3,_matrix=new Matrix4,_quaternion=new Quaternion;class Euler{constructor(e=0,t=0,o=0,i=Euler.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=o,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,o,i=this._order){return this._x=e,this._y=t,this._z=o,this._order=i,this._onChangeCallback(),this}clone(){return new Euler(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,o=!0){const i=e.elements,s=i[0],r=i[4],a=i[8],l=i[1],c=i[5],d=i[9],u=i[2],f=i[6],h=i[10];switch(t){case"XYZ":this._y=Math.asin(clamp(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-d,h),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(f,c),this._z=0);break;case"YXZ":this._x=Math.asin(-clamp(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(a,h),this._z=Math.atan2(l,c)):(this._y=Math.atan2(-u,s),this._z=0);break;case"ZXY":this._x=Math.asin(clamp(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-u,h),this._z=Math.atan2(-r,c)):(this._y=0,this._z=Math.atan2(l,s));break;case"ZYX":this._y=Math.asin(-clamp(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(f,h),this._z=Math.atan2(l,s)):(this._x=0,this._z=Math.atan2(-r,c));break;case"YZX":this._z=Math.asin(clamp(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,c),this._y=Math.atan2(-u,s)):(this._x=0,this._y=Math.atan2(a,h));break;case"XZY":this._z=Math.asin(-clamp(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(f,c),this._y=Math.atan2(a,s)):(this._x=Math.atan2(-d,h),this._y=0);break;default:console.warn("../math.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,o===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,o){return _matrix.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_matrix,t,o)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return _quaternion.setFromEuler(this),this.setFromQuaternion(_quaternion,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(e){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Euler.DEFAULT_ORDER="XYZ";class Vector2{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new Vector2(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,o=this.y,i=e.elements;return this.x=i[0]*t+i[3]*o+i[6],this.y=i[1]*t+i[4]*o+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(e,Math.min(t,o)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const o=this.dot(e)/t;return Math.acos(clamp(o,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,o=this.y-e.y;return t*t+o*o}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,o){return this.x=e.x+(t.x-e.x)*o,this.y=e.y+(t.y-e.y)*o,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}rotateAround(e,t){const o=Math.cos(t),i=Math.sin(t),s=this.x-e.x,r=this.y-e.y;return this.x=s*o-r*i+e.x,this.y=s*i+r*o+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Vector2.isVector2=!0;class Vector4{constructor(e=0,t=0,o=0,i=1){Vector4.prototype.isVector4=!0,this.x=e,this.y=t,this.z=o,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,o,i){return this.x=e,this.y=t,this.z=o,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new Vector4(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,o=this.y,i=this.z,s=this.w,r=e.elements;return this.x=r[0]*t+r[4]*o+r[8]*i+r[12]*s,this.y=r[1]*t+r[5]*o+r[9]*i+r[13]*s,this.z=r[2]*t+r[6]*o+r[10]*i+r[14]*s,this.w=r[3]*t+r[7]*o+r[11]*i+r[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,o,i,s;const l=e.elements,c=l[0],d=l[4],u=l[8],f=l[1],h=l[5],m=l[9],p=l[2],v=l[6],g=l[10];if(Math.abs(d-f)<.01&&Math.abs(u-p)<.01&&Math.abs(m-v)<.01){if(Math.abs(d+f)<.1&&Math.abs(u+p)<.1&&Math.abs(m+v)<.1&&Math.abs(c+h+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const w=(c+1)/2,_=(h+1)/2,S=(g+1)/2,C=(d+f)/4,A=(u+p)/4,E=(m+v)/4;return w>_&&w>S?w<.01?(o=0,i=.707106781,s=.707106781):(o=Math.sqrt(w),i=C/o,s=A/o):_>S?_<.01?(o=.707106781,i=0,s=.707106781):(i=Math.sqrt(_),o=C/i,s=E/i):S<.01?(o=.707106781,i=.707106781,s=0):(s=Math.sqrt(S),o=A/s,i=E/s),this.set(o,i,s,t),this}let y=Math.sqrt((v-m)*(v-m)+(u-p)*(u-p)+(f-d)*(f-d));return Math.abs(y)<.001&&(y=1),this.x=(v-m)/y,this.y=(u-p)/y,this.z=(f-d)/y,this.w=Math.acos((c+h+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const o=this.length();return this.divideScalar(o||1).multiplyScalar(Math.max(e,Math.min(t,o)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,o){return this.x=e.x+(t.x-e.x)*o,this.y=e.y+(t.y-e.y)*o,this.z=e.z+(t.z-e.z)*o,this.w=e.w+(t.w-e.w)*o,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Matrix3{constructor(e,t,o,i,s,r,a,l,c){Matrix3.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,o,i,s,r,a,l,c)}set(e,t,o,i,s,r,a,l,c){const d=this.elements;return d[0]=e,d[1]=i,d[2]=a,d[3]=t,d[4]=s,d[5]=l,d[6]=o,d[7]=r,d[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,o=e.elements;return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=o[3],t[4]=o[4],t[5]=o[5],t[6]=o[6],t[7]=o[7],t[8]=o[8],this}extractBasis(e,t,o){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),o.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const o=e.elements,i=t.elements,s=this.elements,r=o[0],a=o[3],l=o[6],c=o[1],d=o[4],u=o[7],f=o[2],h=o[5],m=o[8],p=i[0],v=i[3],g=i[6],y=i[1],w=i[4],_=i[7],S=i[2],C=i[5],A=i[8];return s[0]=r*p+a*y+l*S,s[3]=r*v+a*w+l*C,s[6]=r*g+a*_+l*A,s[1]=c*p+d*y+u*S,s[4]=c*v+d*w+u*C,s[7]=c*g+d*_+u*A,s[2]=f*p+h*y+m*S,s[5]=f*v+h*w+m*C,s[8]=f*g+h*_+m*A,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],o=e[1],i=e[2],s=e[3],r=e[4],a=e[5],l=e[6],c=e[7],d=e[8];return t*r*d-t*a*c-o*s*d+o*a*l+i*s*c-i*r*l}invert(){const e=this.elements,t=e[0],o=e[1],i=e[2],s=e[3],r=e[4],a=e[5],l=e[6],c=e[7],d=e[8],u=d*r-a*c,f=a*l-d*s,h=c*s-r*l,m=t*u+o*f+i*h;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return e[0]=u*p,e[1]=(i*c-d*o)*p,e[2]=(a*o-i*r)*p,e[3]=f*p,e[4]=(d*t-i*l)*p,e[5]=(i*s-a*t)*p,e[6]=h*p,e[7]=(o*l-c*t)*p,e[8]=(r*t-o*s)*p,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,o,i,s,r,a){const l=Math.cos(s),c=Math.sin(s);return this.set(o*l,o*c,-o*(l*r+c*a)+r+e,-i*c,i*l,-i*(-c*r+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(_m3.makeScale(e,t)),this}rotate(e){return this.premultiply(_m3.makeRotation(-e)),this}translate(e,t){return this.premultiply(_m3.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),o=Math.sin(e);return this.set(t,-o,0,o,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,o=e.elements;for(let i=0;i<9;i++)if(t[i]!==o[i])return!1;return!0}fromArray(e,t=0){for(let o=0;o<9;o++)this.elements[o]=e[o+t];return this}toArray(e=[],t=0){const o=this.elements;return e[t]=o[0],e[t+1]=o[1],e[t+2]=o[2],e[t+3]=o[3],e[t+4]=o[4],e[t+5]=o[5],e[t+6]=o[6],e[t+7]=o[7],e[t+8]=o[8],e}clone(){return new Matrix3().fromArray(this.elements)}}const _m3=new Matrix3;var EmitterMode;(function(n){n[n.Random=0]="Random",n[n.Loop=1]="Loop",n[n.PingPong=2]="PingPong",n[n.Burst=3]="Burst"})(EmitterMode||(EmitterMode={}));function getValueFromEmitterMode(n,e,t,o){let i;switch(EmitterMode.Random===n?e=Math.random():EmitterMode.Burst===n&&o.isBursting&&(e=o.burstParticleIndex/o.burstParticleCount),t>0?i=Math.floor(e/t)*t:i=e,n){case EmitterMode.Loop:i=i%1;break;case EmitterMode.PingPong:i=Math.abs(i%2-1);break}return i}class Bezier{constructor(e,t,o,i){this.p=[e,t,o,i]}genValue(e){const t=e*e,o=e*e*e,i=1-e,s=i*i,r=s*i;return this.p[0]*r+this.p[1]*s*e*3+this.p[2]*i*t*3+this.p[3]*o}derivativeCoefficients(e){const t=[];for(let o=e,i=o.length-1;i>0;i--){const s=[];for(let r=0;r<i;r++){const a=i*(o[r+1]-o[r]);s.push(a)}t.push(s),o=s}return t}getSlope(e){const t=this.derivativeCoefficients(this.p)[0],o=1-e,i=o*o,s=o*e*2,r=e*e;return i*t[0]+s*t[1]+r*t[2]}controlCurve(e,t){this.p[1]=e/3+this.p[0],this.p[2]=this.p[3]-t/3}hull(e){let t=this.p,o=[],i,s=0,r=0,a=0;const l=[];for(l[s++]=t[0],l[s++]=t[1],l[s++]=t[2],l[s++]=t[3];t.length>1;){for(o=[],r=0,a=t.length-1;r<a;r++)i=e*t[r]+(1-e)*t[r+1],l[s++]=i,o.push(i);t=o}return l}split(e){const t=this.hull(e);return{left:new Bezier(t[0],t[4],t[7],t[9]),right:new Bezier(t[9],t[8],t[6],t[3]),span:t}}clone(){return new Bezier(this.p[0],this.p[1],this.p[2],this.p[3])}toJSON(){return{p0:this.p[0],p1:this.p[1],p2:this.p[2],p3:this.p[3]}}static fromJSON(e){return new Bezier(e.p0,e.p1,e.p2,e.p3)}}const ColorToJSON=n=>({r:n.x,g:n.y,b:n.z,a:n.w}),JSONToColor=n=>new Vector4(n.r,n.g,n.b,n.a),JSONToValue=(n,e)=>{switch(e){case"Vector3":return new Vector3(n.x,n.y,n.z);case"Vector4":return new Vector4(n.x,n.y,n.z,n.w);case"Color":return new Vector3(n.r,n.g,n.b);case"Number":return n;default:return n}},ValueToJSON=(n,e)=>{switch(e){case"Vector3":return{x:n.x,y:n.y,z:n.z};case"Vector4":return{x:n.x,y:n.y,z:n.z,w:n.w};case"Color":return{r:n.x,g:n.y,b:n.z};case"Number":return n;default:return n}};class RandomColor{constructor(e,t){this.a=e,this.b=t,this.type="value"}startGen(e){}genColor(e,t){const o=Math.random();return t.copy(this.a).lerp(this.b,o)}toJSON(){return{type:"RandomColor",a:ColorToJSON(this.a),b:ColorToJSON(this.b)}}static fromJSON(e){return new RandomColor(JSONToColor(e.a),JSONToColor(e.b))}clone(){return new RandomColor(this.a.clone(),this.b.clone())}}class ColorRange{constructor(e,t){this.a=e,this.b=t,this.indexCount=-1,this.type="value"}startGen(e){this.indexCount=e.length,e.push(Math.random())}genColor(e,t){return this.indexCount===-1&&this.startGen(e),t.copy(this.a).lerp(this.b,e[this.indexCount])}toJSON(){return{type:"ColorRange",a:ColorToJSON(this.a),b:ColorToJSON(this.b)}}static fromJSON(e){return new ColorRange(JSONToColor(e.a),JSONToColor(e.b))}clone(){return new ColorRange(this.a.clone(),this.b.clone())}}class ContinuousLinearFunction{constructor(e,t){this.subType=t,this.type="function",this.keys=e}findKey(e){let t=0,o=0,i=this.keys.length-1;for(;o+1<i;)if(t=Math.floor((o+i)/2),e<this.getStartX(t))i=t-1;else if(e>this.getEndX(t))o=t+1;else return t;for(let s=o;s<=i;s++)if(e>=this.getStartX(s)&&e<=this.getEndX(s))return s;return-1}getStartX(e){return this.keys[e][1]}getEndX(e){return e+1<this.keys.length?this.keys[e+1][1]:1}genValue(e,t){const o=this.findKey(t);return this.subType==="Number"?o===-1?this.keys[0][0]:o+1>=this.keys.length?this.keys[this.keys.length-1][0]:(this.keys[o+1][0]-this.keys[o][0])*((t-this.getStartX(o))/(this.getEndX(o)-this.getStartX(o)))+this.keys[o][0]:o===-1?e.copy(this.keys[0][0]):o+1>=this.keys.length?e.copy(this.keys[this.keys.length-1][0]):e.copy(this.keys[o][0]).lerp(this.keys[o+1][0],(t-this.getStartX(o))/(this.getEndX(o)-this.getStartX(o)))}toJSON(){return this.keys[0][0].constructor.name,{type:"CLinearFunction",subType:this.subType,keys:this.keys.map(([e,t])=>({value:ValueToJSON(e,this.subType),pos:t}))}}static fromJSON(e){return new ContinuousLinearFunction(e.keys.map(t=>[JSONToValue(t.value,e.subType),t.pos]),e.subType)}clone(){return this.subType==="Number"?new ContinuousLinearFunction(this.keys.map(([e,t])=>[e,t]),this.subType):new ContinuousLinearFunction(this.keys.map(([e,t])=>[e.clone(),t]),this.subType)}}const tempVec3=new Vector3;class Gradient{constructor(e=[[new Vector3(0,0,0),0],[new Vector3(1,1,1),0]],t=[[1,0],[1,1]]){this.type="function",this.color=new ContinuousLinearFunction(e,"Color"),this.alpha=new ContinuousLinearFunction(t,"Number")}genColor(e,t,o){return this.color.genValue(tempVec3,o),t.set(tempVec3.x,tempVec3.y,tempVec3.z,this.alpha.genValue(1,o))}toJSON(){return{type:"Gradient",color:this.color.toJSON(),alpha:this.alpha.toJSON()}}static fromJSON(e){if(e.functions){const t=e.functions.map(o=>[ColorRange.fromJSON(o.function).a,o.start]);return e.functions.length>0&&t.push([ColorRange.fromJSON(e.functions[e.functions.length-1].function).b,1]),new Gradient(t.map(o=>[new Vector3(o[0].x,o[0].y,o[0].z),o[1]]),t.map(o=>[o[0].w,o[1]]))}else{const t=new Gradient;return t.alpha=ContinuousLinearFunction.fromJSON(e.alpha),t.color=ContinuousLinearFunction.fromJSON(e.color),t}}clone(){const e=new Gradient;return e.alpha=this.alpha.clone(),e.color=this.color.clone(),e}startGen(e){}}const tempColor=new Vector4;class RandomColorBetweenGradient{constructor(e,t){this.indexCount=0,this.type="function",this.gradient1=e,this.gradient2=t}startGen(e){this.indexCount=e.length,e.push(Math.random())}genColor(e,t,o){return this.gradient1.genColor(e,t,o),this.gradient2.genColor(e,tempColor,o),e&&e[this.indexCount]!==void 0?t.lerp(tempColor,e[this.indexCount]):t.lerp(tempColor,Math.random()),t}toJSON(){return{type:"RandomColorBetweenGradient",gradient1:this.gradient1.toJSON(),gradient2:this.gradient2.toJSON()}}static fromJSON(e){return new RandomColorBetweenGradient(Gradient.fromJSON(e.gradient1),Gradient.fromJSON(e.gradient2))}clone(){return new RandomColorBetweenGradient(this.gradient1.clone(),this.gradient2.clone())}}class ConstantColor{constructor(e){this.color=e,this.type="value"}startGen(e){}genColor(e,t){return t.copy(this.color)}toJSON(){return{type:"ConstantColor",color:ColorToJSON(this.color)}}static fromJSON(e){return new ConstantColor(JSONToColor(e.color))}clone(){return new ConstantColor(this.color.clone())}}function ColorGeneratorFromJSON(n){switch(n.type){case"ConstantColor":return ConstantColor.fromJSON(n);case"ColorRange":return ColorRange.fromJSON(n);case"RandomColor":return RandomColor.fromJSON(n);case"Gradient":return Gradient.fromJSON(n);case"RandomColorBetweenGradient":return RandomColorBetweenGradient.fromJSON(n);default:return new ConstantColor(new Vector4(1,1,1,1))}}class ConstantValue{constructor(e){this.value=e,this.type="value"}startGen(e){}genValue(e){return this.value}toJSON(){return{type:"ConstantValue",value:this.value}}static fromJSON(e){return new ConstantValue(e.value)}clone(){return new ConstantValue(this.value)}}class IntervalValue{constructor(e,t){this.a=e,this.b=t,this.indexCount=-1,this.type="value"}startGen(e){this.indexCount=e.length,e.push(Math.random())}genValue(e){return this.indexCount===-1&&this.startGen(e),MathUtils.lerp(this.a,this.b,e[this.indexCount])}toJSON(){return{type:"IntervalValue",a:this.a,b:this.b}}static fromJSON(e){return new IntervalValue(e.a,e.b)}clone(){return new IntervalValue(this.a,this.b)}}class PiecewiseFunction{constructor(){this.functions=new Array}findFunction(e){let t=0,o=0,i=this.functions.length-1;for(;o+1<i;)if(t=Math.floor((o+i)/2),e<this.getStartX(t))i=t-1;else if(e>this.getEndX(t))o=t+1;else return t;for(let s=o;s<=i;s++)if(e>=this.functions[s][1]&&e<=this.getEndX(s))return s;return-1}getStartX(e){return this.functions[e][1]}setStartX(e,t){e>0&&(this.functions[e][1]=t)}getEndX(e){return e+1<this.functions.length?this.functions[e+1][1]:1}setEndX(e,t){e+1<this.functions.length&&(this.functions[e+1][1]=t)}insertFunction(e,t){const o=this.findFunction(e);this.functions.splice(o+1,0,[t,e])}removeFunction(e){return this.functions.splice(e,1)[0][0]}getFunction(e){return this.functions[e][0]}setFunction(e,t){this.functions[e][0]=t}get numOfFunctions(){return this.functions.length}}class PiecewiseBezier extends PiecewiseFunction{constructor(e=[[new Bezier(0,1/3,1/3*2,1),0]]){super(),this.type="function",this.functions=e}genValue(e,t=0){const o=this.findFunction(t);return o===-1?0:this.functions[o][0].genValue((t-this.getStartX(o))/(this.getEndX(o)-this.getStartX(o)))}toSVG(e,t){if(t<1)return"";let o=["M",0,this.functions[0][0].p[0]].join(" ");for(let i=1/t;i<=1;i+=1/t)o=[o,"L",i*e,this.genValue(void 0,i)].join(" ");return o}toJSON(){return{type:"PiecewiseBezier",functions:this.functions.map(([e,t])=>({function:e.toJSON(),start:t}))}}static fromJSON(e){return new PiecewiseBezier(e.functions.map(t=>[Bezier.fromJSON(t.function),t.start]))}clone(){return new PiecewiseBezier(this.functions.map(([e,t])=>[e.clone(),t]))}startGen(e){}}function ValueGeneratorFromJSON(n){switch(n.type){case"ConstantValue":return ConstantValue.fromJSON(n);case"IntervalValue":return IntervalValue.fromJSON(n);case"PiecewiseBezier":return PiecewiseBezier.fromJSON(n);default:return new ConstantValue(0)}}class RandomQuatGenerator{constructor(){this.indexCount=0,this.type="rotation"}startGen(e){this.indexCount=e.length,e.push(new Quaternion);let t,o,i,s,r,a;do t=Math.random()*2-1,o=Math.random()*2-1,i=t*t+o*o;while(i>1);do s=Math.random()*2-1,r=Math.random()*2-1,a=s*s+r*r;while(a>1);const l=Math.sqrt((1-i)/a);e[this.indexCount].set(t,o,l*s,l*r)}genValue(e,t,o,i){return this.indexCount===-1&&this.startGen(e),t.copy(e[this.indexCount]),t}toJSON(){return{type:"RandomQuat"}}static fromJSON(e){return new RandomQuatGenerator}clone(){return new RandomQuatGenerator}}class AxisAngleGenerator{constructor(e,t){this.axis=e,this.angle=t,this.type="rotation"}startGen(e){this.angle.startGen(e)}genValue(e,t,o,i){return t.setFromAxisAngle(this.axis,this.angle.genValue(e,i)*o)}toJSON(){return{type:"AxisAngle",axis:{x:this.axis.x,y:this.axis.y,z:this.axis.z},angle:this.angle.toJSON()}}static fromJSON(e){return new AxisAngleGenerator(new Vector3(e.axis.x,e.axis.y,e.axis.z),ValueGeneratorFromJSON(e.angle))}clone(){return new AxisAngleGenerator(this.axis.clone(),this.angle.clone())}}class EulerGenerator{constructor(e,t,o,i){this.angleX=e,this.angleY=t,this.angleZ=o,this.type="rotation",this.eular=new Euler(0,0,0,i)}startGen(e){this.angleX.startGen(e),this.angleY.startGen(e),this.angleZ.startGen(e)}genValue(e,t,o,i){return this.eular.set(this.angleX.genValue(e,i)*o,this.angleY.genValue(e,i)*o,this.angleZ.genValue(e,i)*o),t.setFromEuler(this.eular)}toJSON(){return{type:"Euler",angleX:this.angleX.toJSON(),angleY:this.angleY.toJSON(),angleZ:this.angleZ.toJSON(),eulerOrder:this.eular.order}}static fromJSON(e){return new EulerGenerator(ValueGeneratorFromJSON(e.angleX),ValueGeneratorFromJSON(e.angleY),ValueGeneratorFromJSON(e.angleZ),e.eulerOrder)}clone(){return new EulerGenerator(this.angleX,this.angleY,this.angleZ,this.eular.order)}}function RotationGeneratorFromJSON(n){switch(n.type){case"AxisAngle":return AxisAngleGenerator.fromJSON(n);case"Euler":return EulerGenerator.fromJSON(n);case"RandomQuat":return RandomQuatGenerator.fromJSON(n);default:return new RandomQuatGenerator}}class Vector3Function{constructor(e,t,o){this.x=e,this.y=t,this.z=o,this.type="vec3function"}startGen(e){this.x.startGen(e),this.y.startGen(e),this.z.startGen(e)}genValue(e,t,o){return t.set(this.x.genValue(e,o),this.y.genValue(e,o),this.z.genValue(e,o))}toJSON(){return{type:"Vector3Function",x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}static fromJSON(e){return new Vector3Function(ValueGeneratorFromJSON(e.x),ValueGeneratorFromJSON(e.y),ValueGeneratorFromJSON(e.z))}clone(){return new Vector3Function(this.x,this.y,this.z)}}function Vector3GeneratorFromJSON(n){switch(n.type){case"Vector3Function":return Vector3Function.fromJSON(n);default:return new Vector3Function(new ConstantValue(0),new ConstantValue(0),new ConstantValue(0))}}function GeneratorFromJSON(n){switch(n.type){case"ConstantValue":case"IntervalValue":case"PiecewiseBezier":return ValueGeneratorFromJSON(n);case"AxisAngle":case"RandomQuat":case"Euler":return RotationGeneratorFromJSON(n);case"Vector3Function":return Vector3GeneratorFromJSON(n);default:return new ConstantValue(0)}}class ConeEmitter{constructor(e={}){var t,o,i,s,r,a,l;this.type="cone",this.currentValue=0,this.radius=(t=e.radius)!==null&&t!==void 0?t:10,this.arc=(o=e.arc)!==null&&o!==void 0?o:2*Math.PI,this.thickness=(i=e.thickness)!==null&&i!==void 0?i:1,this.angle=(s=e.angle)!==null&&s!==void 0?s:Math.PI/6,this.mode=(r=e.mode)!==null&&r!==void 0?r:EmitterMode.Random,this.spread=(a=e.spread)!==null&&a!==void 0?a:0,this.speed=(l=e.speed)!==null&&l!==void 0?l:new ConstantValue(1),this.memory=[]}update(e,t){EmitterMode.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*t)}initialize(e,t){const o=getValueFromEmitterMode(this.mode,this.currentValue,this.spread,t),i=MathUtils.lerp(1-this.thickness,1,Math.random()),s=o*this.arc,r=Math.sqrt(i),a=Math.sin(s),l=Math.cos(s);e.position.x=r*l,e.position.y=r*a,e.position.z=0;const c=this.angle*r;e.velocity.set(0,0,Math.cos(c)).addScaledVector(e.position,Math.sin(c)).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius)}toJSON(){return{type:"cone",radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new ConeEmitter({radius:e.radius,arc:e.arc,thickness:e.thickness,angle:e.angle,mode:e.mode,speed:e.speed?ValueGeneratorFromJSON(e.speed):void 0,spread:e.spread})}clone(){return new ConeEmitter({radius:this.radius,arc:this.arc,thickness:this.thickness,angle:this.angle,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class CircleEmitter{constructor(e={}){var t,o,i,s,r,a;this.type="circle",this.currentValue=0,this.radius=(t=e.radius)!==null&&t!==void 0?t:10,this.arc=(o=e.arc)!==null&&o!==void 0?o:2*Math.PI,this.thickness=(i=e.thickness)!==null&&i!==void 0?i:1,this.mode=(s=e.mode)!==null&&s!==void 0?s:EmitterMode.Random,this.spread=(r=e.spread)!==null&&r!==void 0?r:0,this.speed=(a=e.speed)!==null&&a!==void 0?a:new ConstantValue(1),this.memory=[]}update(e,t){this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*t}initialize(e,t){const o=getValueFromEmitterMode(this.mode,this.currentValue,this.spread,t),i=MathUtils.lerp(1-this.thickness,1,Math.random()),s=o*this.arc;e.position.x=Math.cos(s),e.position.y=Math.sin(s),e.position.z=0,e.velocity.copy(e.position).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius*i)}toJSON(){return{type:"circle",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new CircleEmitter({radius:e.radius,arc:e.arc,thickness:e.thickness,mode:e.mode,speed:e.speed?ValueGeneratorFromJSON(e.speed):void 0,spread:e.spread})}clone(){return new CircleEmitter({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}function randomInt(n,e){return Math.floor(Math.random()*(e-n))+n}const UP_VEC3=new Vector3(0,1,0),ZERO_VEC3=new Vector3(0,0,0),ONE_VEC3=new Vector3(1,1,1),Z_VEC3=new Vector3(0,0,1);class DonutEmitter{constructor(e={}){var t,o,i,s,r,a,l;this.type="donut",this.currentValue=0,this.radius=(t=e.radius)!==null&&t!==void 0?t:10,this.arc=(o=e.arc)!==null&&o!==void 0?o:2*Math.PI,this.thickness=(i=e.thickness)!==null&&i!==void 0?i:1,this.donutRadius=(s=e.donutRadius)!==null&&s!==void 0?s:this.radius*.2,this.mode=(r=e.mode)!==null&&r!==void 0?r:EmitterMode.Random,this.spread=(a=e.spread)!==null&&a!==void 0?a:0,this.speed=(l=e.speed)!==null&&l!==void 0?l:new ConstantValue(1),this.memory=[],this._m1=new Matrix4}update(e,t){EmitterMode.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*t)}initialize(e,t){const o=getValueFromEmitterMode(this.mode,this.currentValue,this.spread,t),i=Math.random(),s=MathUtils.lerp(1-this.thickness,1,Math.random()),r=o*this.arc,a=i*Math.PI*2,l=Math.sin(r),c=Math.cos(r);e.position.x=this.radius*c,e.position.y=this.radius*l,e.position.z=0,e.velocity.z=this.donutRadius*s*Math.sin(a),e.velocity.x=this.donutRadius*s*Math.cos(a)*c,e.velocity.y=this.donutRadius*s*Math.cos(a)*l,e.position.add(e.velocity),e.velocity.normalize().multiplyScalar(e.startSpeed),e.rotation instanceof Quaternion&&(this._m1.lookAt(ZERO_VEC3,e.velocity,UP_VEC3),e.rotation.setFromRotationMatrix(this._m1))}toJSON(){return{type:"donut",radius:this.radius,arc:this.arc,thickness:this.thickness,donutRadius:this.donutRadius,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new DonutEmitter({radius:e.radius,arc:e.arc,thickness:e.thickness,donutRadius:e.donutRadius,mode:e.mode,speed:e.speed?ValueGeneratorFromJSON(e.speed):void 0,spread:e.spread})}clone(){return new DonutEmitter({radius:this.radius,arc:this.arc,thickness:this.thickness,donutRadius:this.donutRadius,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class PointEmitter{constructor(){this.type="point",this._m1=new Matrix4}update(e,t){}initialize(e){const t=Math.random(),o=Math.random(),i=t*Math.PI*2,s=Math.acos(2*o-1),r=Math.cbrt(Math.random()),a=Math.sin(i),l=Math.cos(i),c=Math.sin(s),d=Math.cos(s);e.velocity.x=r*c*l,e.velocity.y=r*c*a,e.velocity.z=r*d,e.velocity.multiplyScalar(e.startSpeed),e.position.setScalar(0),e.rotation instanceof Quaternion&&(this._m1.lookAt(ZERO_VEC3,e.position,UP_VEC3),e.rotation.setFromRotationMatrix(this._m1))}toJSON(){return{type:"point"}}static fromJSON(e){return new PointEmitter}clone(){return new PointEmitter}}class SphereEmitter{constructor(e={}){var t,o,i,s,r,a;this.type="sphere",this.currentValue=0,this.radius=(t=e.radius)!==null&&t!==void 0?t:10,this.arc=(o=e.arc)!==null&&o!==void 0?o:2*Math.PI,this.thickness=(i=e.thickness)!==null&&i!==void 0?i:1,this.mode=(s=e.mode)!==null&&s!==void 0?s:EmitterMode.Random,this.spread=(r=e.spread)!==null&&r!==void 0?r:0,this.speed=(a=e.speed)!==null&&a!==void 0?a:new ConstantValue(1),this.memory=[],this._m1=new Matrix4}update(e,t){EmitterMode.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*t)}initialize(e,t){const o=getValueFromEmitterMode(this.mode,this.currentValue,this.spread,t),i=Math.random(),s=MathUtils.lerp(1-this.thickness,1,Math.random()),r=o*this.arc,a=Math.acos(2*i-1),l=Math.sin(r),c=Math.cos(r),d=Math.sin(a),u=Math.cos(a);e.position.x=d*c,e.position.y=d*l,e.position.z=u,e.velocity.copy(e.position).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius*s),e.rotation instanceof Quaternion&&(this._m1.lookAt(ZERO_VEC3,e.position,UP_VEC3),e.rotation.setFromRotationMatrix(this._m1))}toJSON(){return{type:"sphere",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new SphereEmitter({radius:e.radius,arc:e.arc,thickness:e.thickness,mode:e.mode,speed:e.speed?ValueGeneratorFromJSON(e.speed):void 0,spread:e.spread})}clone(){return new SphereEmitter({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class HemisphereEmitter{constructor(e={}){var t,o,i,s,r,a;this.type="sphere",this.currentValue=0,this.radius=(t=e.radius)!==null&&t!==void 0?t:10,this.arc=(o=e.arc)!==null&&o!==void 0?o:2*Math.PI,this.thickness=(i=e.thickness)!==null&&i!==void 0?i:1,this.mode=(s=e.mode)!==null&&s!==void 0?s:EmitterMode.Random,this.spread=(r=e.spread)!==null&&r!==void 0?r:0,this.speed=(a=e.speed)!==null&&a!==void 0?a:new ConstantValue(1),this.memory=[],this._m1=new Matrix4}update(e,t){EmitterMode.Random!=this.mode&&(this.currentValue+=this.speed.genValue(this.memory,e.emissionState.time/e.duration)*t)}initialize(e,t){const o=getValueFromEmitterMode(this.mode,this.currentValue,this.spread,t),i=Math.random(),s=MathUtils.lerp(1-this.thickness,1,Math.random()),r=o*this.arc,a=Math.acos(i),l=Math.sin(r),c=Math.cos(r),d=Math.sin(a),u=Math.cos(a);e.position.x=d*c,e.position.y=d*l,e.position.z=u,e.velocity.copy(e.position).multiplyScalar(e.startSpeed),e.position.multiplyScalar(this.radius*s),e.rotation instanceof Quaternion&&(this._m1.lookAt(ZERO_VEC3,e.position,UP_VEC3),e.rotation.setFromRotationMatrix(this._m1))}toJSON(){return{type:"hemisphere",radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,spread:this.spread,speed:this.speed.toJSON()}}static fromJSON(e){return new HemisphereEmitter({radius:e.radius,arc:e.arc,thickness:e.thickness,mode:e.mode,speed:e.speed?ValueGeneratorFromJSON(e.speed):void 0,spread:e.spread})}clone(){return new HemisphereEmitter({radius:this.radius,arc:this.arc,thickness:this.thickness,mode:this.mode,speed:this.speed.clone(),spread:this.spread})}}class GridEmitter{constructor(e={}){var t,o,i,s;this.type="grid",this.width=(t=e.width)!==null&&t!==void 0?t:1,this.height=(o=e.height)!==null&&o!==void 0?o:1,this.column=(i=e.column)!==null&&i!==void 0?i:10,this.row=(s=e.row)!==null&&s!==void 0?s:10}initialize(e){const t=Math.floor(Math.random()*this.row),o=Math.floor(Math.random()*this.column);e.position.x=o*this.width/this.column-this.width/2,e.position.y=t*this.height/this.row-this.height/2,e.position.z=0,e.velocity.set(0,0,e.startSpeed)}toJSON(){return{type:"grid",width:this.width,height:this.height,column:this.column,row:this.row}}static fromJSON(e){return new GridEmitter(e)}clone(){return new GridEmitter({width:this.width,height:this.height,column:this.column,row:this.row})}update(e,t){}}const EmitterShapes={circle:{type:"circle",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:CircleEmitter,loadJSON:CircleEmitter.fromJSON},cone:{type:"cone",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["angle",["radian"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:ConeEmitter,loadJSON:ConeEmitter.fromJSON},donut:{type:"donut",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["donutRadius",["number"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:DonutEmitter,loadJSON:DonutEmitter.fromJSON},point:{type:"point",params:[],constructor:PointEmitter,loadJSON:PointEmitter.fromJSON},sphere:{type:"sphere",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["angle",["radian"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:SphereEmitter,loadJSON:SphereEmitter.fromJSON},hemisphere:{type:"hemisphere",params:[["radius",["number"]],["arc",["radian"]],["thickness",["number"]],["angle",["radian"]],["mode",["emitterMode"]],["spread",["number"]],["speed",["valueFunc"]]],constructor:HemisphereEmitter,loadJSON:HemisphereEmitter.fromJSON},grid:{type:"grid",params:[["width",["number"]],["height",["number"]],["rows",["number"]],["column",["number"]]],constructor:GridEmitter,loadJSON:GridEmitter.fromJSON}};function EmitterFromJSON(n,e){return EmitterShapes[n.type].loadJSON(n,e)}class ColorOverLife{constructor(e){this.color=e,this.type="ColorOverLife"}initialize(e){this.color.startGen(e.memory)}update(e,t){this.color.genColor(e.memory,e.color,e.age/e.life),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}frameUpdate(e){}toJSON(){return{type:this.type,color:this.color.toJSON()}}static fromJSON(e){return new ColorOverLife(ColorGeneratorFromJSON(e.color))}clone(){return new ColorOverLife(this.color.clone())}reset(){}}class RotationOverLife{constructor(e){this.angularVelocity=e,this.type="RotationOverLife"}initialize(e){typeof e.rotation=="number"&&this.angularVelocity.startGen(e.memory)}update(e,t){typeof e.rotation=="number"&&(e.rotation+=t*this.angularVelocity.genValue(e.memory,e.age/e.life))}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON()}}static fromJSON(e){return new RotationOverLife(ValueGeneratorFromJSON(e.angularVelocity))}frameUpdate(e){}clone(){return new RotationOverLife(this.angularVelocity.clone())}reset(){}}class Rotation3DOverLife{constructor(e){this.angularVelocity=e,this.type="Rotation3DOverLife",this.tempQuat=new Quaternion,this.tempQuat2=new Quaternion}initialize(e){e.rotation instanceof Quaternion&&(e.angularVelocity=new Quaternion,this.angularVelocity.startGen(e.memory))}update(e,t){e.rotation instanceof Quaternion&&(this.angularVelocity.genValue(e.memory,this.tempQuat,t,e.age/e.life),e.rotation.multiply(this.tempQuat))}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON()}}static fromJSON(e){return new Rotation3DOverLife(RotationGeneratorFromJSON(e.angularVelocity))}frameUpdate(e){}clone(){return new Rotation3DOverLife(this.angularVelocity.clone())}reset(){}}class ForceOverLife{initialize(e,t){this.ps=t,this.x.startGen(e.memory),this.y.startGen(e.memory),this.z.startGen(e.memory)}constructor(e,t,o){this.x=e,this.y=t,this.z=o,this.type="ForceOverLife",this._temp=new Vector3,this._tempScale=new Vector3,this._tempQ=new Quaternion}update(e,t){this._temp.set(this.x.genValue(e.memory,e.age/e.life),this.y.genValue(e.memory,e.age/e.life),this.z.genValue(e.memory,e.age/e.life)),this.ps.worldSpace?e.velocity.addScaledVector(this._temp,t):(this._temp.multiply(this._tempScale).applyQuaternion(this._tempQ),e.velocity.addScaledVector(this._temp,t))}toJSON(){return{type:this.type,x:this.x.toJSON(),y:this.y.toJSON(),z:this.z.toJSON()}}static fromJSON(e){return new ForceOverLife(ValueGeneratorFromJSON(e.x),ValueGeneratorFromJSON(e.y),ValueGeneratorFromJSON(e.z))}frameUpdate(e){if(this.ps&&!this.ps.worldSpace){const t=this._temp,o=this._tempQ,i=this._tempScale;this.ps.emitter.matrixWorld.decompose(t,o,i),o.invert(),i.set(1/i.x,1/i.y,1/i.z)}}clone(){return new ForceOverLife(this.x.clone(),this.y.clone(),this.z.clone())}reset(){}}class SizeOverLife{initialize(e){this.size.startGen(e.memory)}constructor(e){this.size=e,this.type="SizeOverLife"}update(e){this.size instanceof Vector3Function?this.size.genValue(e.memory,e.size,e.age/e.life).multiply(e.startSize):e.size.copy(e.startSize).multiplyScalar(this.size.genValue(e.memory,e.age/e.life))}toJSON(){return{type:this.type,size:this.size.toJSON()}}static fromJSON(e){return new SizeOverLife(GeneratorFromJSON(e.size))}frameUpdate(e){}clone(){return new SizeOverLife(this.size.clone())}reset(){}}class SpeedOverLife{initialize(e){this.speed.startGen(e.memory)}constructor(e){this.speed=e,this.type="SpeedOverLife"}update(e){e.speedModifier=this.speed.genValue(e.memory,e.age/e.life)}toJSON(){return{type:this.type,speed:this.speed.toJSON()}}static fromJSON(e){return new SpeedOverLife(ValueGeneratorFromJSON(e.speed))}frameUpdate(e){}clone(){return new SpeedOverLife(this.speed.clone())}reset(){}}class FrameOverLife{constructor(e){this.frame=e,this.type="FrameOverLife"}initialize(e){this.frame.startGen(e.memory)}update(e,t){this.frame instanceof PiecewiseBezier&&(e.uvTile=this.frame.genValue(e.memory,e.age/e.life))}frameUpdate(e){}toJSON(){return{type:this.type,frame:this.frame.toJSON()}}static fromJSON(e){return new FrameOverLife(ValueGeneratorFromJSON(e.frame))}clone(){return new FrameOverLife(this.frame.clone())}reset(){}}class OrbitOverLife{constructor(e,t=new Vector3(0,1,0)){this.orbitSpeed=e,this.axis=t,this.type="OrbitOverLife",this.temp=new Vector3,this.rotation=new Quaternion}initialize(e){this.orbitSpeed.startGen(e.memory)}update(e,t){this.temp.copy(e.position).projectOnVector(this.axis),this.rotation.setFromAxisAngle(this.axis,this.orbitSpeed.genValue(e.memory,e.age/e.life)*t),e.position.sub(this.temp),e.position.applyQuaternion(this.rotation),e.position.add(this.temp)}frameUpdate(e){}toJSON(){return{type:this.type,orbitSpeed:this.orbitSpeed.toJSON(),axis:[this.axis.x,this.axis.y,this.axis.z]}}static fromJSON(e){return new OrbitOverLife(ValueGeneratorFromJSON(e.orbitSpeed),e.axis?new Vector3(e.axis[0],e.axis[1],e.axis[2]):void 0)}clone(){return new OrbitOverLife(this.orbitSpeed.clone())}reset(){}}class LinkedListNode{constructor(e){this.data=e,this.next=null,this.prev=null}hasPrev(){return this.prev!==null}hasNext(){return this.next!==null}}class LinkedList{constructor(){this.length=0,this.head=this.tail=null}isEmpty(){return this.head===null}clear(){this.length=0,this.head=this.tail=null}front(){return this.head===null?null:this.head.data}back(){return this.tail===null?null:this.tail.data}dequeue(){if(this.head){const e=this.head.data;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}}pop(){if(this.tail){const e=this.tail.data;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}}queue(e){const t=new LinkedListNode(e);this.tail||(this.tail=t),this.head&&(this.head.prev=t,t.next=this.head),this.head=t,this.length++}push(e){const t=new LinkedListNode(e);this.head||(this.head=t),this.tail&&(this.tail.next=t,t.prev=this.tail),this.tail=t,this.length++}insertBefore(e,t){const o=new LinkedListNode(t);o.next=e,o.prev=e.prev,o.prev!==null&&(o.prev.next=o),o.next.prev=o,e==this.head&&(this.head=o),this.length++}remove(e){if(this.head===null||this.tail===null)return;let t=this.head;for(e===this.head.data&&(this.head=this.head.next),e===this.tail.data&&(this.tail=this.tail.prev);t.next!==null&&t.data!==e;)t=t.next;t.data===e&&(t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.length--)}*values(){let e=this.head;for(;e!==null;)yield e.data,e=e.next}}class SpriteParticle{constructor(){this.startSpeed=0,this.startColor=new Vector4,this.startSize=new Vector3(1,1,1),this.position=new Vector3,this.velocity=new Vector3,this.age=0,this.life=1,this.size=new Vector3(1,1,1),this.speedModifier=1,this.rotation=0,this.color=new Vector4,this.uvTile=0,this.memory=[]}get died(){return this.age>=this.life}reset(){this.memory.length=0}}class RecordState{constructor(e,t,o){this.position=e,this.size=t,this.color=o}}class TrailParticle{constructor(){this.startSpeed=0,this.startColor=new Vector4,this.startSize=new Vector3(1,1,1),this.position=new Vector3,this.velocity=new Vector3,this.age=0,this.life=1,this.size=new Vector3(1,1,1),this.length=100,this.speedModifier=1,this.color=new Vector4,this.previous=new LinkedList,this.uvTile=0,this.memory=[]}update(){for(this.age<=this.life?this.previous.push(new RecordState(this.position.clone(),this.size.x,this.color.clone())):this.previous.length>0&&this.previous.dequeue();this.previous.length>this.length;)this.previous.dequeue()}get died(){return this.age>=this.life}reset(){this.memory.length=0,this.previous.clear()}}class WidthOverLength{initialize(e){this.width.startGen(e.memory)}constructor(e){this.width=e,this.type="WidthOverLength"}update(e){if(e instanceof TrailParticle){const t=e.previous.values();for(let o=0;o<e.previous.length;o++){const i=t.next();i.value.size=this.width.genValue(e.memory,(e.previous.length-o)/e.length)}}}frameUpdate(e){}toJSON(){return{type:this.type,width:this.width.toJSON()}}static fromJSON(e){return new WidthOverLength(ValueGeneratorFromJSON(e.width))}clone(){return new WidthOverLength(this.width.clone())}reset(){}}class ApplyForce{constructor(e,t){this.direction=e,this.magnitude=t,this.type="ApplyForce",this.memory={data:[],dataCount:0},this.magnitudeValue=this.magnitude.genValue(this.memory)}initialize(e){}update(e,t){e.velocity.addScaledVector(this.direction,this.magnitudeValue*t)}frameUpdate(e){this.magnitudeValue=this.magnitude.genValue(this.memory)}toJSON(){return{type:this.type,direction:[this.direction.x,this.direction.y,this.direction.z],magnitude:this.magnitude.toJSON()}}static fromJSON(e){var t;return new ApplyForce(new Vector3(e.direction[0],e.direction[1],e.direction[2]),ValueGeneratorFromJSON((t=e.magnitude)!==null&&t!==void 0?t:e.force))}clone(){return new ApplyForce(this.direction.clone(),this.magnitude.clone())}reset(){}}class GravityForce{constructor(e,t){this.center=e,this.magnitude=t,this.type="GravityForce",this.temp=new Vector3}initialize(e){}update(e,t){this.temp.copy(this.center).sub(e.position).normalize(),e.velocity.addScaledVector(this.temp,this.magnitude/e.position.distanceToSquared(this.center)*t)}frameUpdate(e){}toJSON(){return{type:this.type,center:[this.center.x,this.center.y,this.center.z],magnitude:this.magnitude}}static fromJSON(e){return new GravityForce(new Vector3(e.center[0],e.center[1],e.center[2]),e.magnitude)}clone(){return new GravityForce(this.center.clone(),this.magnitude)}reset(){}}class ChangeEmitDirection{constructor(e){this.angle=e,this.type="ChangeEmitDirection",this._temp=new Vector3,this._q=new Quaternion,this.memory={data:[],dataCount:0}}initialize(e){const t=e.velocity.length();t!=0&&(e.velocity.normalize(),e.velocity.x===0&&e.velocity.y===0?this._temp.set(0,e.velocity.z,0):this._temp.set(-e.velocity.y,e.velocity.x,0),this.angle.startGen(this.memory),this._q.setFromAxisAngle(this._temp.normalize(),this.angle.genValue(this.memory)),this._temp.copy(e.velocity),e.velocity.applyQuaternion(this._q),this._q.setFromAxisAngle(this._temp,Math.random()*Math.PI*2),e.velocity.applyQuaternion(this._q),e.velocity.setLength(t))}update(e,t){}frameUpdate(e){}toJSON(){return{type:this.type,angle:this.angle.toJSON()}}static fromJSON(e){return new ChangeEmitDirection(ValueGeneratorFromJSON(e.angle))}clone(){return new ChangeEmitDirection(this.angle)}reset(){}}var SubParticleEmitMode;(function(n){n[n.Death=0]="Death",n[n.Birth=1]="Birth",n[n.Frame=2]="Frame"})(SubParticleEmitMode||(SubParticleEmitMode={}));class EmitSubParticleSystem{constructor(e,t,o,i=SubParticleEmitMode.Frame,s=1){this.particleSystem=e,this.useVelocityAsBasis=t,this.subParticleSystem=o,this.mode=i,this.emitProbability=s,this.type="EmitSubParticleSystem",this.q_=new Quaternion,this.v_=new Vector3,this.v2_=new Vector3,this.subEmissions=new Array,this.subParticleSystem&&this.subParticleSystem.system&&(this.subParticleSystem.system.onlyUsedByOther=!0)}initialize(e){}update(e,t){this.mode===SubParticleEmitMode.Frame?this.emit(e,t):this.mode===SubParticleEmitMode.Birth&&e.age===0?this.emit(e,t):this.mode===SubParticleEmitMode.Death&&e.age+t>=e.life&&this.emit(e,t)}emit(e,t){if(!this.subParticleSystem||Math.random()>this.emitProbability)return;const o=new Matrix4;this.setMatrixFromParticle(o,e),this.subEmissions.push({burstParticleCount:0,burstParticleIndex:0,isBursting:!1,burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,matrix:o,travelDistance:0,particle:e})}frameUpdate(e){if(this.subParticleSystem)for(let t=0;t<this.subEmissions.length;t++)if(this.subEmissions[t].time>=this.subParticleSystem.system.duration)this.subEmissions[t]=this.subEmissions[this.subEmissions.length-1],this.subEmissions.length=this.subEmissions.length-1,t--;else{const o=this.subEmissions[t];o.particle&&o.particle.age<o.particle.life?this.setMatrixFromParticle(o.matrix,o.particle):o.particle=void 0,this.subParticleSystem.system.emit(e,o,o.matrix)}}toJSON(){return{type:this.type,subParticleSystem:this.subParticleSystem?this.subParticleSystem.uuid:"",useVelocityAsBasis:this.useVelocityAsBasis,mode:this.mode,emitProbability:this.emitProbability}}static fromJSON(e,t){return new EmitSubParticleSystem(t,e.useVelocityAsBasis,e.subParticleSystem,e.mode,e.emitProbability)}clone(){return new EmitSubParticleSystem(this.particleSystem,this.useVelocityAsBasis,this.subParticleSystem,this.mode,this.emitProbability)}reset(){}setMatrixFromParticle(e,t){let o;if(t.rotation===void 0||this.useVelocityAsBasis)if(t.velocity.x===0&&t.velocity.y===0&&(t.velocity.z===1||t.velocity.z===0))e.set(1,0,0,t.position.x,0,1,0,t.position.y,0,0,1,t.position.z,0,0,0,1);else{this.v_.copy(Z_VEC3).cross(t.velocity),this.v2_.copy(t.velocity).cross(this.v_);const i=this.v_.length(),s=this.v2_.length();e.set(this.v_.x/i,this.v2_.x/s,t.velocity.x,t.position.x,this.v_.y/i,this.v2_.y/s,t.velocity.y,t.position.y,this.v_.z/i,this.v2_.z/s,t.velocity.z,t.position.z,0,0,0,1)}else t.rotation instanceof Quaternion?o=t.rotation:(this.q_.setFromAxisAngle(Z_VEC3,t.rotation),o=this.q_),e.compose(t.position,o,ONE_VEC3);this.particleSystem.worldSpace||e.multiplyMatrices(this.particleSystem.emitter.matrixWorld,e)}}const F2=.5*(Math.sqrt(3)-1),G2=(3-Math.sqrt(3))/6,F3=1/3,G3=1/6,F4=(Math.sqrt(5)-1)/4,G4=(5-Math.sqrt(5))/20,grad3=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class SimplexNoise{constructor(e=Math.random){const t=typeof e=="function"?e:alea(e);this.p=buildPermutationTable(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let o=0;o<512;o++)this.perm[o]=this.p[o&255],this.permMod12[o]=this.perm[o]%12}noise2D(e,t){const o=this.permMod12,i=this.perm;let s=0,r=0,a=0;const l=(e+t)*F2,c=Math.floor(e+l),d=Math.floor(t+l),u=(c+d)*G2,f=c-u,h=d-u,m=e-f,p=t-h;let v,g;m>p?(v=1,g=0):(v=0,g=1);const y=m-v+G2,w=p-g+G2,_=m-1+2*G2,S=p-1+2*G2,C=c&255,A=d&255;let E=.5-m*m-p*p;if(E>=0){const F=o[C+i[A]]*3;E*=E,s=E*E*(grad3[F]*m+grad3[F+1]*p)}let k=.5-y*y-w*w;if(k>=0){const F=o[C+v+i[A+g]]*3;k*=k,r=k*k*(grad3[F]*y+grad3[F+1]*w)}let I=.5-_*_-S*S;if(I>=0){const F=o[C+1+i[A+1]]*3;I*=I,a=I*I*(grad3[F]*_+grad3[F+1]*S)}return 70*(s+r+a)}noise3D(e,t,o){const i=this.permMod12,s=this.perm;let r,a,l,c;const d=(e+t+o)*F3,u=Math.floor(e+d),f=Math.floor(t+d),h=Math.floor(o+d),m=(u+f+h)*G3,p=u-m,v=f-m,g=h-m,y=e-p,w=t-v,_=o-g;let S,C,A,E,k,I;y>=w?w>=_?(S=1,C=0,A=0,E=1,k=1,I=0):y>=_?(S=1,C=0,A=0,E=1,k=0,I=1):(S=0,C=0,A=1,E=1,k=0,I=1):w<_?(S=0,C=0,A=1,E=0,k=1,I=1):y<_?(S=0,C=1,A=0,E=0,k=1,I=1):(S=0,C=1,A=0,E=1,k=1,I=0);const F=y-S+G3,M=w-C+G3,R=_-A+G3,O=y-E+2*G3,$=w-k+2*G3,T=_-I+2*G3,D=y-1+3*G3,P=w-1+3*G3,L=_-1+3*G3,B=u&255,b=f&255,z=h&255;let N=.6-y*y-w*w-_*_;if(N<0)r=0;else{const J=i[B+s[b+s[z]]]*3;N*=N,r=N*N*(grad3[J]*y+grad3[J+1]*w+grad3[J+2]*_)}let G=.6-F*F-M*M-R*R;if(G<0)a=0;else{const J=i[B+S+s[b+C+s[z+A]]]*3;G*=G,a=G*G*(grad3[J]*F+grad3[J+1]*M+grad3[J+2]*R)}let K=.6-O*O-$*$-T*T;if(K<0)l=0;else{const J=i[B+E+s[b+k+s[z+I]]]*3;K*=K,l=K*K*(grad3[J]*O+grad3[J+1]*$+grad3[J+2]*T)}let ne=.6-D*D-P*P-L*L;if(ne<0)c=0;else{const J=i[B+1+s[b+1+s[z+1]]]*3;ne*=ne,c=ne*ne*(grad3[J]*D+grad3[J+1]*P+grad3[J+2]*L)}return 32*(r+a+l+c)}noise4D(e,t,o,i){const s=this.perm;let r,a,l,c,d;const u=(e+t+o+i)*F4,f=Math.floor(e+u),h=Math.floor(t+u),m=Math.floor(o+u),p=Math.floor(i+u),v=(f+h+m+p)*G4,g=f-v,y=h-v,w=m-v,_=p-v,S=e-g,C=t-y,A=o-w,E=i-_;let k=0,I=0,F=0,M=0;S>C?k++:I++,S>A?k++:F++,S>E?k++:M++,C>A?I++:F++,C>E?I++:M++,A>E?F++:M++;const R=k>=3?1:0,O=I>=3?1:0,$=F>=3?1:0,T=M>=3?1:0,D=k>=2?1:0,P=I>=2?1:0,L=F>=2?1:0,B=M>=2?1:0,b=k>=1?1:0,z=I>=1?1:0,N=F>=1?1:0,G=M>=1?1:0,K=S-R+G4,ne=C-O+G4,J=A-$+G4,se=E-T+G4,te=S-D+2*G4,Z=C-P+2*G4,Q=A-L+2*G4,le=E-B+2*G4,ae=S-b+3*G4,oe=C-z+3*G4,pe=A-N+3*G4,_e=E-G+3*G4,we=S-1+4*G4,me=C-1+4*G4,ve=A-1+4*G4,be=E-1+4*G4,ue=f&255,de=h&255,Se=m&255,ge=p&255;let Ce=.6-S*S-C*C-A*A-E*E;if(Ce<0)r=0;else{const ce=s[ue+s[de+s[Se+s[ge]]]]%32*4;Ce*=Ce,r=Ce*Ce*(grad4[ce]*S+grad4[ce+1]*C+grad4[ce+2]*A+grad4[ce+3]*E)}let ye=.6-K*K-ne*ne-J*J-se*se;if(ye<0)a=0;else{const ce=s[ue+R+s[de+O+s[Se+$+s[ge+T]]]]%32*4;ye*=ye,a=ye*ye*(grad4[ce]*K+grad4[ce+1]*ne+grad4[ce+2]*J+grad4[ce+3]*se)}let Pe=.6-te*te-Z*Z-Q*Q-le*le;if(Pe<0)l=0;else{const ce=s[ue+D+s[de+P+s[Se+L+s[ge+B]]]]%32*4;Pe*=Pe,l=Pe*Pe*(grad4[ce]*te+grad4[ce+1]*Z+grad4[ce+2]*Q+grad4[ce+3]*le)}let he=.6-ae*ae-oe*oe-pe*pe-_e*_e;if(he<0)c=0;else{const ce=s[ue+b+s[de+z+s[Se+N+s[ge+G]]]]%32*4;he*=he,c=he*he*(grad4[ce]*ae+grad4[ce+1]*oe+grad4[ce+2]*pe+grad4[ce+3]*_e)}let xe=.6-we*we-me*me-ve*ve-be*be;if(xe<0)d=0;else{const ce=s[ue+1+s[de+1+s[Se+1+s[ge+1]]]]%32*4;xe*=xe,d=xe*xe*(grad4[ce]*we+grad4[ce+1]*me+grad4[ce+2]*ve+grad4[ce+3]*be)}return 27*(r+a+l+c+d)}}function buildPermutationTable(n){const e=new Uint8Array(256);for(let t=0;t<256;t++)e[t]=t;for(let t=0;t<255;t++){const o=t+~~(n()*(256-t)),i=e[t];e[t]=e[o],e[o]=i}return e}function alea(n){let e=0,t=0,o=0,i=1;const s=masher();return e=s(" "),t=s(" "),o=s(" "),e-=s(n),e<0&&(e+=1),t-=s(n),t<0&&(t+=1),o-=s(n),o<0&&(o+=1),function(){const r=2091639*e+i*23283064365386963e-26;return e=t,t=o,o=r-(i=r|0)}}function masher(){let n=4022871197;return function(e){e=e.toString();for(let t=0;t<e.length;t++){n+=e.charCodeAt(t);let o=.02519603282416938*n;n=o>>>0,o-=n,o*=n,n=o>>>0,o-=n,n+=o*4294967296}return(n>>>0)*23283064365386963e-26}}class TurbulenceField{constructor(e,t,o,i){this.scale=e,this.octaves=t,this.velocityMultiplier=o,this.timeScale=i,this.type="TurbulenceField",this.generator=new SimplexNoise,this.timeOffset=new Vector3,this.temp=new Vector3,this.temp2=new Vector3,this.timeOffset.x=Math.random()/this.scale.x*this.timeScale.x,this.timeOffset.y=Math.random()/this.scale.y*this.timeScale.y,this.timeOffset.z=Math.random()/this.scale.z*this.timeScale.z}initialize(e){}update(e,t){const o=e.position.x/this.scale.x,i=e.position.y/this.scale.y,s=e.position.z/this.scale.z;this.temp.set(0,0,0);let r=1;for(let a=0;a<this.octaves;a++)this.temp2.set(this.generator.noise4D(o*r,i*r,s*r,this.timeOffset.x*r)/r,this.generator.noise4D(o*r,i*r,s*r,this.timeOffset.y*r)/r,this.generator.noise4D(o*r,i*r,s*r,this.timeOffset.z*r)/r),this.temp.add(this.temp2),r*=2;this.temp.multiply(this.velocityMultiplier),e.velocity.addScaledVector(this.temp,t)}toJSON(){return{type:this.type,scale:[this.scale.x,this.scale.y,this.scale.z],octaves:this.octaves,velocityMultiplier:[this.velocityMultiplier.x,this.velocityMultiplier.y,this.velocityMultiplier.z],timeScale:[this.timeScale.x,this.timeScale.y,this.timeScale.z]}}frameUpdate(e){this.timeOffset.x+=e*this.timeScale.x,this.timeOffset.y+=e*this.timeScale.y,this.timeOffset.z+=e*this.timeScale.z}static fromJSON(e){return new TurbulenceField(new Vector3(e.scale[0],e.scale[1],e.scale[2]),e.octaves,new Vector3(e.velocityMultiplier[0],e.velocityMultiplier[1],e.velocityMultiplier[2]),new Vector3(e.timeScale[0],e.timeScale[1],e.timeScale[2]))}clone(){return new TurbulenceField(this.scale.clone(),this.octaves,this.velocityMultiplier.clone(),this.timeScale.clone())}reset(){}}const generators=[],tempV$1=new Vector3,tempQ$1=new Quaternion;class Noise{constructor(e,t,o=new ConstantValue(1),i=new ConstantValue(0)){if(this.frequency=e,this.power=t,this.positionAmount=o,this.rotationAmount=i,this.type="Noise",this.duration=0,generators.length===0)for(let s=0;s<100;s++)generators.push(new SimplexNoise)}initialize(e){e.lastPosNoise=new Vector3,typeof e.rotation=="number"?e.lastRotNoise=0:e.lastRotNoise=new Quaternion,e.generatorIndex=[randomInt(0,100),randomInt(0,100),randomInt(0,100),randomInt(0,100)],this.positionAmount.startGen(e.memory),this.rotationAmount.startGen(e.memory),this.frequency.startGen(e.memory),this.power.startGen(e.memory)}update(e,t){let o=this.frequency.genValue(e.memory,e.age/e.life),i=this.power.genValue(e.memory,e.age/e.life),s=this.positionAmount.genValue(e.memory,e.age/e.life),r=this.rotationAmount.genValue(e.memory,e.age/e.life);s>0&&e.lastPosNoise!==void 0&&(e.position.sub(e.lastPosNoise),tempV$1.set(generators[e.generatorIndex[0]].noise2D(0,e.age*o)*i*s,generators[e.generatorIndex[1]].noise2D(0,e.age*o)*i*s,generators[e.generatorIndex[2]].noise2D(0,e.age*o)*i*s),e.position.add(tempV$1),e.lastPosNoise.copy(tempV$1)),r>0&&e.lastRotNoise!==void 0&&(typeof e.rotation=="number"?(e.rotation-=e.lastRotNoise,e.rotation+=generators[e.generatorIndex[3]].noise2D(0,e.age*o)*Math.PI*i*r):(e.lastRotNoise.invert(),e.rotation.multiply(e.lastRotNoise),tempQ$1.set(generators[e.generatorIndex[0]].noise2D(0,e.age*o)*i*r,generators[e.generatorIndex[1]].noise2D(0,e.age*o)*i*r,generators[e.generatorIndex[2]].noise2D(0,e.age*o)*i*r,generators[e.generatorIndex[3]].noise2D(0,e.age*o)*i*r).normalize(),e.rotation.multiply(tempQ$1),e.lastRotNoise.copy(tempQ$1)))}toJSON(){return{type:this.type,frequency:this.frequency.toJSON(),power:this.power.toJSON(),positionAmount:this.positionAmount.toJSON(),rotationAmount:this.rotationAmount.toJSON()}}frameUpdate(e){this.duration+=e}static fromJSON(e){return new Noise(ValueGeneratorFromJSON(e.frequency),ValueGeneratorFromJSON(e.power),ValueGeneratorFromJSON(e.positionAmount),ValueGeneratorFromJSON(e.rotationAmount))}clone(){return new Noise(this.frequency.clone(),this.power.clone(),this.positionAmount.clone(),this.rotationAmount.clone())}reset(){}}class ColorBySpeed{constructor(e,t){this.color=e,this.speedRange=t,this.type="ColorBySpeed"}initialize(e){this.color.startGen(e.memory)}update(e,t){const o=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.color.genColor(e.memory,e.color,o),e.color.x*=e.startColor.x,e.color.y*=e.startColor.y,e.color.z*=e.startColor.z,e.color.w*=e.startColor.w}frameUpdate(e){}toJSON(){return{type:this.type,color:this.color.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(e){return new ColorBySpeed(ColorGeneratorFromJSON(e.color),IntervalValue.fromJSON(e.speedRange))}clone(){return new ColorBySpeed(this.color.clone(),this.speedRange.clone())}reset(){}}class SizeBySpeed{initialize(e){this.size.startGen(e.memory)}constructor(e,t){this.size=e,this.speedRange=t,this.type="SizeBySpeed"}update(e){const t=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);this.size instanceof Vector3Function?this.size.genValue(e.memory,e.size,t).multiply(e.startSize):e.size.copy(e.startSize).multiplyScalar(this.size.genValue(e.memory,t))}toJSON(){return{type:this.type,size:this.size.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(e){return new SizeBySpeed(GeneratorFromJSON(e.size),IntervalValue.fromJSON(e.speedRange))}frameUpdate(e){}clone(){return new SizeBySpeed(this.size.clone(),this.speedRange.clone())}reset(){}}class RotationBySpeed{constructor(e,t){this.angularVelocity=e,this.speedRange=t,this.type="RotationBySpeed",this.tempQuat=new Quaternion}initialize(e){typeof e.rotation=="number"&&this.angularVelocity.startGen(e.memory)}update(e,t){if(typeof e.rotation=="number"){const o=(e.startSpeed-this.speedRange.a)/(this.speedRange.b-this.speedRange.a);e.rotation+=t*this.angularVelocity.genValue(e.memory,o)}}toJSON(){return{type:this.type,angularVelocity:this.angularVelocity.toJSON(),speedRange:this.speedRange.toJSON()}}static fromJSON(e){return new RotationBySpeed(ValueGeneratorFromJSON(e.angularVelocity),IntervalValue.fromJSON(e.speedRange))}frameUpdate(e){}clone(){return new RotationBySpeed(this.angularVelocity.clone(),this.speedRange.clone())}reset(){}}class LimitSpeedOverLife{initialize(e){this.speed.startGen(e.memory)}constructor(e,t){this.speed=e,this.dampen=t,this.type="LimitSpeedOverLife"}update(e,t){let o=e.velocity.length(),i=this.speed.genValue(e.memory,e.age/e.life);if(o>i){const s=(o-i)/o;e.velocity.multiplyScalar(1-s*this.dampen*t*20)}}toJSON(){return{type:this.type,speed:this.speed.toJSON(),dampen:this.dampen}}static fromJSON(e){return new LimitSpeedOverLife(ValueGeneratorFromJSON(e.speed),e.dampen)}frameUpdate(e){}clone(){return new LimitSpeedOverLife(this.speed.clone(),this.dampen)}reset(){}}const BehaviorTypes={ApplyForce:{type:"ApplyForce",constructor:ApplyForce,params:[["direction",["vec3"]],["magnitude",["value"]]],loadJSON:ApplyForce.fromJSON},Noise:{type:"Noise",constructor:Noise,params:[["frequency",["value"]],["power",["value"]],["positionAmount",["value"]],["rotationAmount",["value"]]],loadJSON:Noise.fromJSON},TurbulenceField:{type:"TurbulenceField",constructor:TurbulenceField,params:[["scale",["vec3"]],["octaves",["number"]],["velocityMultiplier",["vec3"]],["timeScale",["vec3"]]],loadJSON:TurbulenceField.fromJSON},GravityForce:{type:"GravityForce",constructor:GravityForce,params:[["center",["vec3"]],["magnitude",["number"]]],loadJSON:GravityForce.fromJSON},ColorOverLife:{type:"ColorOverLife",constructor:ColorOverLife,params:[["color",["colorFunc"]]],loadJSON:ColorOverLife.fromJSON},RotationOverLife:{type:"RotationOverLife",constructor:RotationOverLife,params:[["angularVelocity",["value","valueFunc"]]],loadJSON:RotationOverLife.fromJSON},Rotation3DOverLife:{type:"Rotation3DOverLife",constructor:Rotation3DOverLife,params:[["angularVelocity",["rotationFunc"]]],loadJSON:Rotation3DOverLife.fromJSON},SizeOverLife:{type:"SizeOverLife",constructor:SizeOverLife,params:[["size",["value","valueFunc","vec3Func"]]],loadJSON:SizeOverLife.fromJSON},ColorBySpeed:{type:"ColorBySpeed",constructor:ColorBySpeed,params:[["color",["colorFunc"]],["speedRange",["range"]]],loadJSON:ColorBySpeed.fromJSON},RotationBySpeed:{type:"RotationBySpeed",constructor:RotationBySpeed,params:[["angularVelocity",["value","valueFunc"]],["speedRange",["range"]]],loadJSON:RotationBySpeed.fromJSON},SizeBySpeed:{type:"SizeBySpeed",constructor:SizeBySpeed,params:[["size",["value","valueFunc","vec3Func"]],["speedRange",["range"]]],loadJSON:SizeBySpeed.fromJSON},SpeedOverLife:{type:"SpeedOverLife",constructor:SpeedOverLife,params:[["speed",["value","valueFunc"]]],loadJSON:SpeedOverLife.fromJSON},FrameOverLife:{type:"FrameOverLife",constructor:FrameOverLife,params:[["frame",["value","valueFunc"]]],loadJSON:FrameOverLife.fromJSON},ForceOverLife:{type:"ForceOverLife",constructor:ForceOverLife,params:[["x",["value","valueFunc"]],["y",["value","valueFunc"]],["z",["value","valueFunc"]]],loadJSON:ForceOverLife.fromJSON},OrbitOverLife:{type:"OrbitOverLife",constructor:OrbitOverLife,params:[["orbitSpeed",["value","valueFunc"]],["axis",["vec3"]]],loadJSON:OrbitOverLife.fromJSON},WidthOverLength:{type:"WidthOverLength",constructor:WidthOverLength,params:[["width",["value","valueFunc"]]],loadJSON:WidthOverLength.fromJSON},ChangeEmitDirection:{type:"ChangeEmitDirection",constructor:ChangeEmitDirection,params:[["angle",["value"]]],loadJSON:ChangeEmitDirection.fromJSON},EmitSubParticleSystem:{type:"EmitSubParticleSystem",constructor:EmitSubParticleSystem,params:[["particleSystem",["self"]],["useVelocityAsBasis",["boolean"]],["subParticleSystem",["particleSystem"]],["mode",["number"]],["emitProbability",["number"]]],loadJSON:EmitSubParticleSystem.fromJSON},LimitSpeedOverLife:{type:"LimitSpeedOverLife",constructor:LimitSpeedOverLife,params:[["speed",["value","valueFunc"]],["dampen",["number"]]],loadJSON:LimitSpeedOverLife.fromJSON}};function BehaviorFromJSON(n,e){return BehaviorTypes[n.type]?BehaviorTypes[n.type].loadJSON(n,e):null}const Plugins=[];function loadPlugin(n){if(!Plugins.find(t=>t.id===n.id)){for(const t of n.emitterShapes)EmitterShapes[t.type]||(EmitterShapes[t.type]=t);for(const t of n.behaviors)BehaviorTypes[t.type]||(BehaviorTypes[t.type]=t)}}var soft_fragment=`
#ifdef SOFT_PARTICLES

    /* #ifdef LOGDEPTH
    float distSample = linearize_depth_log(sampleDepth, near, far);
    #else
    float distSample = ortho ? linearize_depth_ortho(sampleDepth, near, far) : linearize_depth(sampleDepth, near, far);
    #endif */

    vec2 p2 = projPosition.xy / projPosition.w;
    
    p2 = 0.5 * p2 + 0.5;

    float readDepth = texture2D(depthTexture, p2.xy).r;
    float viewDepth = linearize_depth(readDepth);

    float softParticlesFade = saturate(SOFT_INV_FADE_DISTANCE * ((viewDepth - SOFT_NEAR_FADE) - linearDepth));
    
    gl_FragColor *= softParticlesFade;

    //gl_FragColor = vec4(softParticlesFade , 0, 0, 1);
#endif
`,soft_pars_fragment=`
#ifdef SOFT_PARTICLES

    uniform sampler2D depthTexture;
    uniform vec4 projParams;
    uniform vec2 softParams;

    varying vec4 projPosition;
    varying float linearDepth;

    #define SOFT_NEAR_FADE softParams.x
    #define SOFT_INV_FADE_DISTANCE softParams.y

    #define zNear projParams.x
    #define zFar projParams.y

    float linearize_depth(float d)
    {
        return (zFar * zNear) / (zFar - d * (zFar - zNear));
    }

#endif
`,soft_pars_vertex=`
#ifdef SOFT_PARTICLES
    varying vec4 projPosition;
    varying float linearDepth;
#endif
`,soft_vertex=`
#ifdef SOFT_PARTICLES
    projPosition = gl_Position;
    linearDepth = -mvPosition.z;
#endif
`,tile_fragment=`
#ifdef USE_MAP
    vec4 texelColor = texture2D( map, vUv);
    #ifdef TILE_BLEND
        texelColor = mix( texelColor, texture2D( map, vUvNext ), vUvBlend );
    #endif
    diffuseColor *= texelColor;
#endif
`,tile_pars_fragment=`
#if defined( USE_UV ) || defined( USE_ANISOTROPY )

	varying vec2 vUv;
#ifdef TILE_BLEND
    varying vec2 vUvNext;
    varying float vUvBlend;
#endif

#endif
#ifdef USE_MAP

	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#ifdef TILE_BLEND
    varying vec2 vMapUvNext;
#endif

#endif
#ifdef USE_ALPHAMAP

	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;

#endif
#ifdef USE_LIGHTMAP

	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;

#endif
#ifdef USE_AOMAP

	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;

#endif
#ifdef USE_BUMPMAP

	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;

#endif
#ifdef USE_NORMALMAP

	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;

#endif
#ifdef USE_DISPLACEMENTMAP

	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;

#endif
#ifdef USE_EMISSIVEMAP

	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;

#endif
#ifdef USE_METALNESSMAP

	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;

#endif
#ifdef USE_ROUGHNESSMAP

	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;

#endif
#ifdef USE_ANISOTROPYMAP

	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;

#endif
#ifdef USE_CLEARCOATMAP

	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;

#endif
#ifdef USE_SHEEN_COLORMAP

	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;

#endif
#ifdef USE_IRIDESCENCEMAP

	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;

#endif
#ifdef USE_SPECULARMAP

	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;

#endif
#ifdef USE_SPECULAR_COLORMAP

	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;

#endif
#ifdef USE_TRANSMISSIONMAP

	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;

#endif
#ifdef USE_THICKNESSMAP

	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;

#endif
`,tile_pars_vertex=`
#ifdef UV_TILE
    attribute float uvTile;
    uniform vec2 tileCount;
    
    mat3 makeTileTransform(float uvTile) {
        float col = mod(uvTile, tileCount.x);
        float row = (tileCount.y - floor(uvTile / tileCount.x) - 1.0);
        
        return mat3(
          1.0 / tileCount.x, 0.0, 0.0,
          0.0, 1.0 / tileCount.y, 0.0, 
          col / tileCount.x, row / tileCount.y, 1.0);
    }
#else
    mat3 makeTileTransform(float uvTile) {
        return mat3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0);
    }
#endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

	varying vec2 vUv;
#ifdef TILE_BLEND
    varying vec2 vUvNext;
    varying float vUvBlend;
#endif

#endif
#ifdef USE_MAP

	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#ifdef TILE_BLEND
    varying vec2 vMapUvNext;
#endif

#endif
#ifdef USE_ALPHAMAP

	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;

#endif
#ifdef USE_LIGHTMAP

	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;

#endif
#ifdef USE_AOMAP

	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;

#endif
#ifdef USE_BUMPMAP

	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;

#endif
#ifdef USE_NORMALMAP

	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;

#endif
#ifdef USE_DISPLACEMENTMAP

	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;

#endif
#ifdef USE_EMISSIVEMAP

	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;

#endif
#ifdef USE_METALNESSMAP

	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;

#endif
#ifdef USE_ROUGHNESSMAP

	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;

#endif
#ifdef USE_ANISOTROPYMAP

	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;

#endif
#ifdef USE_CLEARCOATMAP

	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;

#endif
#ifdef USE_SHEEN_COLORMAP

	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;

#endif
#ifdef USE_IRIDESCENCEMAP

	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;

#endif
#ifdef USE_SPECULARMAP

	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;

#endif
#ifdef USE_SPECULAR_COLORMAP

	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;

#endif
#ifdef USE_TRANSMISSIONMAP

	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;

#endif
#ifdef USE_THICKNESSMAP

	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;

#endif
`,tile_vertex=`
#ifdef UV_TILE
    mat3 tileTransform = makeTileTransform(floor(uvTile));
    #ifdef TILE_BLEND
        mat3 nextTileTransform = makeTileTransform(ceil(uvTile));
        vUvBlend = fract(uvTile);
    #endif
#else
    mat3 tileTransform = makeTileTransform(0.0);
#endif

#if defined( USE_UV ) || defined( USE_ANISOTROPY )

vUv = (tileTransform *vec3( uv, 1 )).xy;
#if defined( TILE_BLEND ) && defined( UV_TILE )
    vUvNext = (nextTileTransform *vec3( uv, 1 )).xy;
#endif

#endif
#ifdef USE_MAP

vMapUv = ( tileTransform * (mapTransform * vec3( MAP_UV, 1 ) )).xy;
#if defined( TILE_BLEND ) && defined( UV_TILE )
    vMapUvNext = (nextTileTransform * (mapTransform * vec3( MAP_UV, 1 ))).xy;
#endif

#endif
#ifdef USE_ALPHAMAP

vAlphaMapUv = ( tileTransform * (alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) )).xy;
    
#endif
#ifdef USE_LIGHTMAP

vLightMapUv = ( tileTransform * (lightMapTransform * vec3( LIGHTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_AOMAP

vAoMapUv = ( tileTransform * (aoMapTransform * vec3( AOMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_BUMPMAP

vBumpMapUv = ( tileTransform * (bumpMapTransform * vec3( BUMPMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_NORMALMAP

vNormalMapUv = ( tileTransform * (normalMapTransform * vec3( NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_DISPLACEMENTMAP

vDisplacementMapUv = ( tileTransform * (displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_EMISSIVEMAP

vEmissiveMapUv = ( tileTransform * (emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_METALNESSMAP

vMetalnessMapUv = ( tileTransform * (metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ROUGHNESSMAP

vRoughnessMapUv = ( tileTransform * (roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_ANISOTROPYMAP

vAnisotropyMapUv = ( tileTransform * (anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOATMAP

vClearcoatMapUv = ( tileTransform * (clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_NORMALMAP

vClearcoatNormalMapUv = ( tileTransform * (clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP

vClearcoatRoughnessMapUv = ( tileTransform * (clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCEMAP

vIridescenceMapUv = ( tileTransform * (iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP

vIridescenceThicknessMapUv = ( tileTransform * (iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_COLORMAP

vSheenColorMapUv = ( tileTransform * (sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SHEEN_ROUGHNESSMAP

vSheenRoughnessMapUv = ( tileTransform * (sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULARMAP

vSpecularMapUv = ( tileTransform * (specularMapTransform * vec3( SPECULARMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_COLORMAP

vSpecularColorMapUv = ( tileTransform * (specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_SPECULAR_INTENSITYMAP

vSpecularIntensityMapUv = ( tileTransform * (specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_TRANSMISSIONMAP

vTransmissionMapUv = ( tileTransform * transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) )).xy;

#endif
#ifdef USE_THICKNESSMAP

vThicknessMapUv = ( tileTransform * thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) )).xy;

#endif

`;const ShaderChunk=ShaderChunk$1;function registerShaderChunks(){ShaderChunk.tile_pars_vertex=tile_pars_vertex,ShaderChunk.tile_vertex=tile_vertex,ShaderChunk.tile_pars_fragment=tile_pars_fragment,ShaderChunk.tile_fragment=tile_fragment,ShaderChunk.soft_pars_vertex=soft_pars_vertex,ShaderChunk.soft_vertex=soft_vertex,ShaderChunk.soft_pars_fragment=soft_pars_fragment,ShaderChunk.soft_fragment=soft_fragment}class ParticleEmitter extends Object3D{constructor(e){super(),this.type="ParticleEmitter",this.system=e}clone(){const e=this.system.clone();return e.emitter.copy(this,!0),e.emitter}dispose(){}extractFromCache(e){const t=[];for(const o in e){const i=e[o];delete i.metadata,t.push(i)}return t}toJSON(e,t={}){const o=this.children;this.children=this.children.filter(s=>s.type!=="ParticleSystemPreview");const i=super.toJSON(e);return this.children=o,this.system!==null&&(i.object.ps=this.system.toJSON(e,t)),i}}var RenderMode;(function(n){n[n.BillBoard=0]="BillBoard",n[n.StretchedBillBoard=1]="StretchedBillBoard",n[n.Mesh=2]="Mesh",n[n.Trail=3]="Trail",n[n.HorizontalBillBoard=4]="HorizontalBillBoard",n[n.VerticalBillBoard=5]="VerticalBillBoard"})(RenderMode||(RenderMode={}));class VFXBatch extends Mesh{constructor(e){super(),this.type="VFXBatch",this.maxParticles=1e3,this.systems=new Set;const t=new Layers;t.mask=e.layers.mask;const o=e.material.clone();o.defines={},Object.assign(o.defines,e.material.defines),this.settings={instancingGeometry:e.instancingGeometry,renderMode:e.renderMode,renderOrder:e.renderOrder,material:o,uTileCount:e.uTileCount,vTileCount:e.vTileCount,blendTiles:e.blendTiles,softParticles:e.softParticles,softNearFade:e.softNearFade,softFarFade:e.softFarFade,layers:t},this.frustumCulled=!1,this.renderOrder=this.settings.renderOrder}addSystem(e){this.systems.add(e)}removeSystem(e){this.systems.delete(e)}applyDepthTexture(e){const t=this.material.uniforms.depthTexture;t&&t.value!==e&&(t.value=e,this.material.needsUpdate=!0)}}const UP=new Vector3(0,0,1),tempQ=new Quaternion,tempV=new Vector3,tempV2=new Vector3;new Vector3;const PREWARM_FPS=60,DEFAULT_GEOMETRY=new PlaneGeometry(1,1,1,1);class ParticleSystem{set time(e){this.emissionState.time=e}get time(){return this.emissionState.time}get layers(){return this.rendererSettings.layers}get texture(){return this.rendererSettings.material.map}set texture(e){this.rendererSettings.material.map=e,this.neededToUpdateRender=!0}get material(){return this.rendererSettings.material}set material(e){this.rendererSettings.material=e,this.neededToUpdateRender=!0}get uTileCount(){return this.rendererSettings.uTileCount}set uTileCount(e){this.rendererSettings.uTileCount=e,this.neededToUpdateRender=!0}get vTileCount(){return this.rendererSettings.vTileCount}set vTileCount(e){this.rendererSettings.vTileCount=e,this.neededToUpdateRender=!0}get blendTiles(){return this.rendererSettings.blendTiles}set blendTiles(e){this.rendererSettings.blendTiles=e,this.neededToUpdateRender=!0}get softParticles(){return this.rendererSettings.softParticles}set softParticles(e){this.rendererSettings.softParticles=e,this.neededToUpdateRender=!0}get softNearFade(){return this.rendererSettings.softNearFade}set softNearFade(e){this.rendererSettings.softNearFade=e,this.neededToUpdateRender=!0}get softFarFade(){return this.rendererSettings.softFarFade}set softFarFade(e){this.rendererSettings.softFarFade=e,this.neededToUpdateRender=!0}get instancingGeometry(){return this.rendererSettings.instancingGeometry}set instancingGeometry(e){this.restart(),this.particles.length=0,this.rendererSettings.instancingGeometry=e,this.neededToUpdateRender=!0}get renderMode(){return this.rendererSettings.renderMode}set renderMode(e){if(this.rendererSettings.renderMode!==e){let t=!1;switch(this.rendererSettings.renderMode===RenderMode.Trail&&(t=!0),this.rendererSettings.renderMode===RenderMode.Mesh&&(this.startRotation=new ConstantValue(0)),e){case RenderMode.Trail:this.rendererEmitterSettings={startLength:new ConstantValue(30),followLocalOrigin:!1},t=!0;break;case RenderMode.Mesh:this.rendererEmitterSettings={geometry:new PlaneGeometry(1,1)},this.startRotation=new AxisAngleGenerator(new Vector3(0,1,0),new ConstantValue(0));break;case RenderMode.StretchedBillBoard:this.rendererEmitterSettings={speedFactor:0,lengthFactor:2};break;case RenderMode.BillBoard:case RenderMode.VerticalBillBoard:case RenderMode.HorizontalBillBoard:this.rendererEmitterSettings={};break}this.rendererSettings.renderMode=e,t&&(this.restart(),this.particles.length=0),this.neededToUpdateRender=!0}}get renderOrder(){return this.rendererSettings.renderOrder}set renderOrder(e){this.rendererSettings.renderOrder=e,this.neededToUpdateRender=!0}get blending(){return this.rendererSettings.material.blending}set blending(e){this.rendererSettings.material.blending=e,this.neededToUpdateRender=!0}constructor(e){var t,o,i,s,r,a,l,c,d,u,f,h,m,p,v,g,y,w,_,S,C,A,E,k,I,F;if(this.temp=new Vector3,this.travelDistance=0,this.normalMatrix=new Matrix3,this.memory=[],this.listeners={},this.firstTimeUpdate=!0,this.autoDestroy=e.autoDestroy===void 0?!1:e.autoDestroy,this.duration=(t=e.duration)!==null&&t!==void 0?t:1,this.looping=e.looping===void 0?!0:e.looping,this.prewarm=e.prewarm===void 0?!1:e.prewarm,this.startLife=(o=e.startLife)!==null&&o!==void 0?o:new ConstantValue(5),this.startSpeed=(i=e.startSpeed)!==null&&i!==void 0?i:new ConstantValue(0),this.startRotation=(s=e.startRotation)!==null&&s!==void 0?s:new ConstantValue(0),this.startSize=(r=e.startSize)!==null&&r!==void 0?r:new ConstantValue(1),this.startColor=(a=e.startColor)!==null&&a!==void 0?a:new ConstantColor(new Vector4(1,1,1,1)),this.emissionOverTime=(l=e.emissionOverTime)!==null&&l!==void 0?l:new ConstantValue(10),this.emissionOverDistance=(c=e.emissionOverDistance)!==null&&c!==void 0?c:new ConstantValue(0),this.emissionBursts=(d=e.emissionBursts)!==null&&d!==void 0?d:[],this.onlyUsedByOther=(u=e.onlyUsedByOther)!==null&&u!==void 0?u:!1,this.emitterShape=(f=e.shape)!==null&&f!==void 0?f:new SphereEmitter,this.behaviors=(h=e.behaviors)!==null&&h!==void 0?h:new Array,this.worldSpace=(m=e.worldSpace)!==null&&m!==void 0?m:!1,this.rendererEmitterSettings=(p=e.rendererEmitterSettings)!==null&&p!==void 0?p:{},e.renderMode===RenderMode.StretchedBillBoard){const M=this.rendererEmitterSettings;e.speedFactor!==void 0&&(M.speedFactor=e.speedFactor),M.speedFactor=(v=M.speedFactor)!==null&&v!==void 0?v:0,M.lengthFactor=(g=M.lengthFactor)!==null&&g!==void 0?g:0}this.rendererSettings={instancingGeometry:(y=e.instancingGeometry)!==null&&y!==void 0?y:DEFAULT_GEOMETRY,renderMode:(w=e.renderMode)!==null&&w!==void 0?w:RenderMode.BillBoard,renderOrder:(_=e.renderOrder)!==null&&_!==void 0?_:0,material:e.material,uTileCount:(S=e.uTileCount)!==null&&S!==void 0?S:1,vTileCount:(C=e.vTileCount)!==null&&C!==void 0?C:1,blendTiles:(A=e.blendTiles)!==null&&A!==void 0?A:!1,softParticles:(E=e.softParticles)!==null&&E!==void 0?E:!1,softNearFade:(k=e.softNearFade)!==null&&k!==void 0?k:0,softFarFade:(I=e.softFarFade)!==null&&I!==void 0?I:0,layers:(F=e.layers)!==null&&F!==void 0?F:new Layers},this.neededToUpdateRender=!0,this.particles=new Array,this.startTileIndex=e.startTileIndex||new ConstantValue(0),this.emitter=new ParticleEmitter(this),this.paused=!1,this.particleNum=0,this.emissionState={isBursting:!1,burstParticleIndex:0,burstParticleCount:0,burstIndex:0,burstWaveIndex:0,time:0,waitEmiting:0,travelDistance:0},this.emissionBursts.forEach(M=>M.count.startGen(this.memory)),this.emissionOverDistance.startGen(this.memory),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1}pause(){this.paused=!0}play(){this.paused=!1}stop(){this.restart(),this.pause()}spawn(e,t,o){tempQ.setFromRotationMatrix(o);const i=tempV,s=tempQ,r=tempV2;o.decompose(i,s,r);for(let a=0;a<e;a++){for(t.burstParticleIndex=a,this.particleNum++;this.particles.length<this.particleNum;)this.rendererSettings.renderMode===RenderMode.Trail?this.particles.push(new TrailParticle):this.particles.push(new SpriteParticle);const l=this.particles[this.particleNum-1];if(l.reset(),l.speedModifier=1,this.startColor.startGen(l.memory),this.startColor.genColor(l.memory,l.startColor,this.emissionState.time),l.color.copy(l.startColor),this.startSpeed.startGen(l.memory),l.startSpeed=this.startSpeed.genValue(l.memory,t.time/this.duration),this.startLife.startGen(l.memory),l.life=this.startLife.genValue(l.memory,t.time/this.duration),l.age=0,this.startSize.startGen(l.memory),this.startSize.type==="vec3function")this.startSize.genValue(l.memory,l.startSize,t.time/this.duration);else{const c=this.startSize.genValue(l.memory,t.time/this.duration);l.startSize.set(c,c,c)}if(this.startTileIndex.startGen(l.memory),l.uvTile=this.startTileIndex.genValue(l.memory),l.size.copy(l.startSize),this.rendererSettings.renderMode===RenderMode.Mesh||this.rendererSettings.renderMode===RenderMode.BillBoard||this.rendererSettings.renderMode===RenderMode.VerticalBillBoard||this.rendererSettings.renderMode===RenderMode.HorizontalBillBoard||this.rendererSettings.renderMode===RenderMode.StretchedBillBoard){const c=l;this.startRotation.startGen(l.memory),this.rendererSettings.renderMode===RenderMode.Mesh?(c.rotation instanceof Quaternion||(c.rotation=new Quaternion),this.startRotation.type==="rotation"?this.startRotation.genValue(l.memory,c.rotation,1,t.time/this.duration):c.rotation.setFromAxisAngle(UP,this.startRotation.genValue(c.memory,t.time/this.duration))):this.startRotation.type==="rotation"?c.rotation=0:c.rotation=this.startRotation.genValue(c.memory,t.time/this.duration)}else if(this.rendererSettings.renderMode===RenderMode.Trail){const c=l;this.rendererEmitterSettings.startLength.startGen(c.memory),c.length=this.rendererEmitterSettings.startLength.genValue(c.memory,t.time/this.duration)}if(this.emitterShape.initialize(l,t),this.rendererSettings.renderMode===RenderMode.Trail&&this.rendererEmitterSettings.followLocalOrigin){const c=l;c.localPosition=new Vector3().copy(c.position)}this.worldSpace?(l.position.applyMatrix4(o),l.startSize.multiply(r).abs(),l.size.copy(l.startSize),l.velocity.multiply(r).applyMatrix3(this.normalMatrix),l.rotation&&l.rotation instanceof Quaternion&&l.rotation.multiplyQuaternions(tempQ,l.rotation)):this.onlyUsedByOther&&(l.parentMatrix=o);for(let c=0;c<this.behaviors.length;c++)this.behaviors[c].initialize(l,this)}}endEmit(){this.emitEnded=!0,this.autoDestroy&&(this.markForDestroy=!0),this.fire({type:"emitEnd",particleSystem:this})}dispose(){this._renderer&&this._renderer.deleteSystem(this),this.emitter.dispose(),this.emitter.parent&&this.emitter.parent.remove(this.emitter),this.fire({type:"destroy",particleSystem:this})}restart(){this.memory.length=0,this.paused=!1,this.particleNum=0,this.emissionState.isBursting=!1,this.emissionState.burstIndex=0,this.emissionState.burstWaveIndex=0,this.emissionState.time=0,this.emissionState.waitEmiting=0,this.behaviors.forEach(e=>{e.reset()}),this.emitEnded=!1,this.markForDestroy=!1,this.prewarmed=!1,this.emissionBursts.forEach(e=>e.count.startGen(this.memory)),this.emissionOverDistance.startGen(this.memory)}update(e){if(this.paused)return;let t=this.emitter;for(;t.parent;)t=t.parent;if(t.type!=="Scene"){this.dispose();return}if(this.firstTimeUpdate&&(this.firstTimeUpdate=!1,this.emitter.updateWorldMatrix(!0,!1)),this.emitEnded&&this.particleNum===0){this.markForDestroy&&this.emitter.parent&&this.dispose();return}if(this.looping&&this.prewarm&&!this.prewarmed){this.prewarmed=!0;for(let o=0;o<this.duration*PREWARM_FPS;o++)this.update(1/PREWARM_FPS)}e>.1&&(e=.1),this.neededToUpdateRender&&(this._renderer&&this._renderer.updateSystem(this),this.neededToUpdateRender=!1),this.onlyUsedByOther||this.emit(e,this.emissionState,this.emitter.matrixWorld),this.emitterShape.update(this,e);for(let o=0;o<this.behaviors.length;o++){this.behaviors[o].frameUpdate(e);for(let i=0;i<this.particleNum;i++)this.particles[i].died||this.behaviors[o].update(this.particles[i],e)}for(let o=0;o<this.particleNum;o++)this.rendererEmitterSettings.followLocalOrigin&&this.particles[o].localPosition?(this.particles[o].position.copy(this.particles[o].localPosition),this.particles[o].parentMatrix?this.particles[o].position.applyMatrix4(this.particles[o].parentMatrix):this.particles[o].position.applyMatrix4(this.emitter.matrixWorld)):this.particles[o].position.addScaledVector(this.particles[o].velocity,e*this.particles[o].speedModifier),this.particles[o].age+=e;if(this.rendererSettings.renderMode===RenderMode.Trail)for(let o=0;o<this.particleNum;o++)this.particles[o].update();for(let o=0;o<this.particleNum;o++){const i=this.particles[o];i.died&&(!(i instanceof TrailParticle)||i.previous.length===0)&&(this.particles[o]=this.particles[this.particleNum-1],this.particles[this.particleNum-1]=i,this.particleNum--,o--,this.fire({type:"particleDied",particleSystem:this,particle:i}))}}emit(e,t,o){t.time>this.duration&&(this.looping?(t.time-=this.duration,t.burstIndex=0,this.behaviors.forEach(s=>{s.reset()})):!this.emitEnded&&!this.onlyUsedByOther&&this.endEmit()),this.normalMatrix.getNormalMatrix(o);const i=Math.ceil(t.waitEmiting);for(this.spawn(i,t,o),t.waitEmiting-=i;t.burstIndex<this.emissionBursts.length&&this.emissionBursts[t.burstIndex].time<=t.time;){if(Math.random()<this.emissionBursts[t.burstIndex].probability){const s=this.emissionBursts[t.burstIndex].count.genValue(this.memory,this.time);t.isBursting=!0,t.burstParticleCount=s,this.spawn(s,t,o),t.isBursting=!1}t.burstIndex++}if(!this.emitEnded&&(t.waitEmiting+=e*this.emissionOverTime.genValue(this.memory,t.time/this.duration),t.previousWorldPos!=null)){this.temp.set(o.elements[12],o.elements[13],o.elements[14]),t.travelDistance+=t.previousWorldPos.distanceTo(this.temp);const s=this.emissionOverDistance.genValue(this.memory,t.time/this.duration);if(t.travelDistance*s>0){const r=Math.floor(t.travelDistance*s);t.travelDistance-=r/s,t.waitEmiting+=r}}t.previousWorldPos===void 0&&(t.previousWorldPos=new Vector3),t.previousWorldPos.set(o.elements[12],o.elements[13],o.elements[14]),t.time+=e}toJSON(e,t={}){var o;if((e===void 0||typeof e=="string")&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}}),e.materials[this.rendererSettings.material.uuid]=this.rendererSettings.material.toJSON(e),t.useUrlForImage&&((o=this.texture)===null||o===void 0?void 0:o.source)!==void 0){const a=this.texture.source;e.images[a.uuid]={uuid:a.uuid,url:this.texture.image.url}}let s;this.renderMode===RenderMode.Trail?s={startLength:this.rendererEmitterSettings.startLength.toJSON(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===RenderMode.Mesh?s={}:this.renderMode===RenderMode.StretchedBillBoard?s={speedFactor:this.rendererEmitterSettings.speedFactor,lengthFactor:this.rendererEmitterSettings.lengthFactor}:s={};const r=this.rendererSettings.instancingGeometry;return e.geometries&&!e.geometries[r.uuid]&&(e.geometries[r.uuid]=r.toJSON()),{version:"3.0",autoDestroy:this.autoDestroy,looping:this.looping,prewarm:this.prewarm,duration:this.duration,shape:this.emitterShape.toJSON(),startLife:this.startLife.toJSON(),startSpeed:this.startSpeed.toJSON(),startRotation:this.startRotation.toJSON(),startSize:this.startSize.toJSON(),startColor:this.startColor.toJSON(),emissionOverTime:this.emissionOverTime.toJSON(),emissionOverDistance:this.emissionOverDistance.toJSON(),emissionBursts:this.emissionBursts.map(a=>({time:a.time,count:a.count.toJSON(),probability:a.probability,interval:a.interval,cycle:a.cycle})),onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry.uuid,renderOrder:this.renderOrder,renderMode:this.renderMode,rendererEmitterSettings:s,material:this.rendererSettings.material.uuid,layers:this.layers.mask,startTileIndex:this.startTileIndex.toJSON(),uTileCount:this.uTileCount,vTileCount:this.vTileCount,blendTiles:this.blendTiles,softParticles:this.rendererSettings.softParticles,softFarFade:this.rendererSettings.softFarFade,softNearFade:this.rendererSettings.softNearFade,behaviors:this.behaviors.map(a=>a.toJSON()),worldSpace:this.worldSpace}}static fromJSON(e,t,o){var i,s;const r=EmitterFromJSON(e.shape,t);let a;if(e.renderMode===RenderMode.Trail){const d=e.rendererEmitterSettings;a={startLength:d.startLength!=null?ValueGeneratorFromJSON(d.startLength):new ConstantValue(30),followLocalOrigin:d.followLocalOrigin}}else e.renderMode===RenderMode.Mesh?a={}:e.renderMode===RenderMode.StretchedBillBoard?(a=e.rendererEmitterSettings,e.speedFactor!=null&&(a.speedFactor=e.speedFactor)):a={};const l=new Layers;e.layers&&(l.mask=e.layers);const c=new ParticleSystem({autoDestroy:e.autoDestroy,looping:e.looping,prewarm:e.prewarm,duration:e.duration,shape:r,startLife:ValueGeneratorFromJSON(e.startLife),startSpeed:ValueGeneratorFromJSON(e.startSpeed),startRotation:GeneratorFromJSON(e.startRotation),startSize:GeneratorFromJSON(e.startSize),startColor:ColorGeneratorFromJSON(e.startColor),emissionOverTime:ValueGeneratorFromJSON(e.emissionOverTime),emissionOverDistance:ValueGeneratorFromJSON(e.emissionOverDistance),emissionBursts:(i=e.emissionBursts)===null||i===void 0?void 0:i.map(d=>{var u,f,h;return{time:d.time,count:typeof d.count=="number"?new ConstantValue(d.count):ValueGeneratorFromJSON(d.count),probability:(u=d.probability)!==null&&u!==void 0?u:1,interval:(f=d.interval)!==null&&f!==void 0?f:.1,cycle:(h=d.cycle)!==null&&h!==void 0?h:1}}),onlyUsedByOther:e.onlyUsedByOther,instancingGeometry:t.geometries[e.instancingGeometry],renderMode:e.renderMode,rendererEmitterSettings:a,renderOrder:e.renderOrder,layers:l,material:e.material?t.materials[e.material]:e.texture?new MeshBasicMaterial({map:t.textures[e.texture],transparent:(s=e.transparent)!==null&&s!==void 0?s:!0,blending:e.blending,side:DoubleSide}):new MeshBasicMaterial({color:16777215,transparent:!0,blending:AdditiveBlending,side:DoubleSide}),startTileIndex:typeof e.startTileIndex=="number"?new ConstantValue(e.startTileIndex):ValueGeneratorFromJSON(e.startTileIndex),uTileCount:e.uTileCount,vTileCount:e.vTileCount,blendTiles:e.blendTiles,softParticles:e.softParticles,softFarFade:e.softFarFade,softNearFade:e.softNearFade,behaviors:[],worldSpace:e.worldSpace});return c.behaviors=e.behaviors.map(d=>{const u=BehaviorFromJSON(d,c);return u&&u.type==="EmitSubParticleSystem"&&(o[d.subParticleSystem]=u),u}).filter(d=>d!==null),c}addBehavior(e){this.behaviors.push(e)}getRendererSettings(){return this.rendererSettings}addEventListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}removeAllEventListeners(e){this.listeners[e]&&(this.listeners[e]=[])}removeEventListener(e,t){if(this.listeners[e]){const o=this.listeners[e].indexOf(t);o!==-1&&this.listeners[e].splice(o,1)}}fire(e){this.listeners[e.type]&&this.listeners[e.type].forEach(t=>t(e))}clone(){const e=[];for(const s of this.emissionBursts){const r={};Object.assign(r,s),e.push(r)}const t=[];for(const s of this.behaviors)t.push(s.clone());let o;this.renderMode===RenderMode.Trail?o={startLength:this.rendererEmitterSettings.startLength.clone(),followLocalOrigin:this.rendererEmitterSettings.followLocalOrigin}:this.renderMode===RenderMode.StretchedBillBoard?o={lengthFactor:this.rendererEmitterSettings.lengthFactor,speedFactor:this.rendererEmitterSettings.speedFactor}:o={};const i=new Layers;return i.mask=this.layers.mask,new ParticleSystem({autoDestroy:this.autoDestroy,looping:this.looping,duration:this.duration,shape:this.emitterShape.clone(),startLife:this.startLife.clone(),startSpeed:this.startSpeed.clone(),startRotation:this.startRotation.clone(),startSize:this.startSize.clone(),startColor:this.startColor.clone(),emissionOverTime:this.emissionOverTime.clone(),emissionOverDistance:this.emissionOverDistance.clone(),emissionBursts:e,onlyUsedByOther:this.onlyUsedByOther,instancingGeometry:this.rendererSettings.instancingGeometry,renderMode:this.renderMode,renderOrder:this.renderOrder,rendererEmitterSettings:o,material:this.rendererSettings.material,startTileIndex:this.startTileIndex,uTileCount:this.uTileCount,vTileCount:this.vTileCount,blendTiles:this.blendTiles,softParticles:this.softParticles,softFarFade:this.softFarFade,softNearFade:this.softNearFade,behaviors:t,worldSpace:this.worldSpace,layers:i})}}var particle_frag=`

#include <common>
#include <color_pars_fragment>
#include <map_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
#include <alphatest_pars_fragment>

#include <tile_pars_fragment>
#include <soft_pars_fragment>

void main() {

    #include <clipping_planes_fragment>
    
    vec3 outgoingLight = vec3( 0.0 );
    vec4 diffuseColor = vColor;
    
    #include <logdepthbuf_fragment>
    
    #include <tile_fragment>
    #include <alphatest_fragment>

    outgoingLight = diffuseColor.rgb;
    
    #ifdef USE_COLOR_AS_ALPHA
    gl_FragColor = vec4( outgoingLight, diffuseColor.r );
    #else
    gl_FragColor = vec4( outgoingLight, diffuseColor.a );
    #endif
    
    #include <soft_fragment>
    #include <tonemapping_fragment>
}
`,particle_physics_frag=`
#define STANDARD

#ifdef PHYSICAL
#define IOR
#define USE_SPECULAR
#endif

uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;

#ifdef IOR
uniform float ior;
#endif

#ifdef USE_SPECULAR
uniform float specularIntensity;
uniform vec3 specularColor;

#ifdef USE_SPECULAR_COLORMAP
uniform sampler2D specularColorMap;
#endif

#ifdef USE_SPECULAR_INTENSITYMAP
uniform sampler2D specularIntensityMap;
#endif
#endif

#ifdef USE_CLEARCOAT
uniform float clearcoat;
uniform float clearcoatRoughness;
#endif

#ifdef USE_DISPERSION
uniform float dispersion;
#endif

#ifdef USE_IRIDESCENCE
uniform float iridescence;
uniform float iridescenceIOR;
uniform float iridescenceThicknessMinimum;
uniform float iridescenceThicknessMaximum;
#endif

#ifdef USE_SHEEN
uniform vec3 sheenColor;
uniform float sheenRoughness;

#ifdef USE_SHEEN_COLORMAP
uniform sampler2D sheenColorMap;
#endif

#ifdef USE_SHEEN_ROUGHNESSMAP
uniform sampler2D sheenRoughnessMap;
#endif
#endif

#ifdef USE_ANISOTROPY
uniform vec2 anisotropyVector;

#ifdef USE_ANISOTROPYMAP
uniform sampler2D anisotropyMap;
#endif
#endif

varying vec3 vViewPosition;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

void main() {

vec4 diffuseColor = vec4( diffuse, opacity );
#include <clipping_planes_fragment>

ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
vec3 totalEmissiveRadiance = emissive;

#include <logdepthbuf_fragment>
#include <map_fragment>
#include <color_fragment>
#include <alphamap_fragment>
#include <alphatest_fragment>
#include <alphahash_fragment>
#include <roughnessmap_fragment>
#include <metalnessmap_fragment>
#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <clearcoat_normal_fragment_begin>
#include <clearcoat_normal_fragment_maps>
#include <emissivemap_fragment>

// accumulation
#include <lights_physical_fragment>
#include <lights_fragment_begin>
#include <lights_fragment_maps>
#include <lights_fragment_end>

// modulation
#include <aomap_fragment>

vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;

#include <transmission_fragment>

vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;

#ifdef USE_SHEEN

// Sheen energy compensation approximation calculation can be found at the end of
// https://drive.google.com/file/d/1T0D1VSyR4AllqIJTQAraEIzjlb5h4FKH/view?usp=sharing
float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );

outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;

#endif

#ifdef USE_CLEARCOAT

float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );

vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );

outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;

#endif

#include <opaque_fragment>
#include <tonemapping_fragment>
#include <colorspace_fragment>
#include <fog_fragment>
#include <premultiplied_alpha_fragment>
#include <dithering_fragment>
}`,particle_vert=`
#include <common>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

#include <tile_pars_vertex>
#include <soft_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute vec3 size;

void main() {
	
    vec2 alignedPosition = position.xy * size.xy;
    
    vec2 rotatedPosition;
    rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
    rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
#ifdef HORIZONTAL
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.x += rotatedPosition.x;
    mvPosition.z -= rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
#elif defined(VERTICAL)
    vec4 mvPosition = modelMatrix * vec4( offset, 1.0 );
    mvPosition.y += rotatedPosition.y;
    mvPosition = viewMatrix * mvPosition;
    mvPosition.x += rotatedPosition.x;
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    mvPosition.xy += rotatedPosition;
#endif

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>

	#include <clipping_planes_vertex>

	#include <tile_vertex>
	#include <soft_vertex>
}
`,local_particle_vert=`
#include <common>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <tile_pars_vertex>
#include <soft_pars_vertex>

attribute vec3 offset;
attribute vec4 rotation;
attribute vec3 size;
// attribute vec4 color;

void main() {

    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size.x, sy = size.y, sz = size.z;
    
    mat4 matrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);
    
    vec4 mvPosition = modelViewMatrix * (matrix * vec4( position, 1.0 ));

	vColor = color;

	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
    #include <tile_vertex>
    #include <soft_vertex>
}
`,local_particle_physics_vert=`
#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>

attribute vec3 offset;
attribute vec4 rotation;
attribute vec3 size;
#include <tile_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

    #include <tile_vertex>
    float x2 = rotation.x + rotation.x, y2 = rotation.y + rotation.y, z2 = rotation.z + rotation.z;
    float xx = rotation.x * x2, xy = rotation.x * y2, xz = rotation.x * z2;
    float yy = rotation.y * y2, yz = rotation.y * z2, zz = rotation.z * z2;
    float wx = rotation.w * x2, wy = rotation.w * y2, wz = rotation.w * z2;
    float sx = size.x, sy = size.y, sz = size.z;

    mat4 particleMatrix = mat4(( 1.0 - ( yy + zz ) ) * sx, ( xy + wz ) * sx, ( xz - wy ) * sx, 0.0,  // 1. column
                      ( xy - wz ) * sy, ( 1.0 - ( xx + zz ) ) * sy, ( yz + wx ) * sy, 0.0,  // 2. column
                      ( xz + wy ) * sz, ( yz - wx ) * sz, ( 1.0 - ( xx + yy ) ) * sz, 0.0,  // 3. column
                      offset.x, offset.y, offset.z, 1.0);

#include <color_vertex>
#include <morphinstance_vertex>
#include <morphcolor_vertex>
#include <batching_vertex>

#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>

	// replace defaultnormal_vertex
	vec3 transformedNormal = objectNormal;
    mat3 m = mat3( particleMatrix );
    transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
    transformedNormal = m * transformedNormal;
    transformedNormal = normalMatrix * transformedNormal;
    #ifdef FLIP_SIDED
        transformedNormal = - transformedNormal;
    #endif
    #ifdef USE_TANGENT
        vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
        #ifdef FLIP_SIDED
        transformedTangent = - transformedTangent;
        #endif
    #endif

	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>

	// replace include <project_vertex>
  vec4 mvPosition = vec4( transformed, 1.0 );
  mvPosition = modelViewMatrix * (particleMatrix * mvPosition);
	gl_Position = projectionMatrix * mvPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
	vViewPosition = - mvPosition.xyz;
	
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
    vWorldPosition = worldPosition.xyz;
#endif
}
`,stretched_bb_particle_vert=`
#include <common>
#include <color_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

#include <tile_pars_vertex>
#include <soft_pars_vertex>

attribute vec3 offset;
attribute float rotation;
attribute vec3 size;
attribute vec4 velocity;

uniform float speedFactor;

void main() {
    float lengthFactor = velocity.w;
    float avgSize = (size.x + size.y) * 0.5;
#ifdef USE_SKEW
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity.xyz;

    vec3 scaledPos = vec3(position.xy * size.xy, position.z);
    float vlength = length(viewVelocity);
    vec3 projVelocity =  dot(scaledPos, viewVelocity) * viewVelocity / vlength;
    mvPosition.xyz += scaledPos + projVelocity * (speedFactor / avgSize + lengthFactor / vlength);
#else
    vec4 mvPosition = modelViewMatrix * vec4( offset, 1.0 );
    vec3 viewVelocity = normalMatrix * velocity.xyz;
    float vlength = length(viewVelocity); 
    mvPosition.xyz += position.y * normalize(cross(mvPosition.xyz, viewVelocity)) * avgSize; // switch the cross to  match unity implementation
    mvPosition.xyz -= (position.x + 0.5) * viewVelocity * (1.0 + lengthFactor / vlength) * avgSize; // minus position.x to match unity implementation
#endif
	vColor = color;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <tile_vertex>
	#include <soft_vertex>
}
`;function getMaterialUVChannelName(n){return n===0?"uv":`uv${n}`}class ParticleMeshStandardMaterial extends MeshStandardMaterial{constructor(e){super(e)}onBeforeCompile(e,t){super.onBeforeCompile(e,t),e.vertexShader=local_particle_physics_vert,e.fragmentShader=particle_physics_frag}}class ParticleMeshPhysicsMaterial extends MeshPhysicalMaterial{constructor(e){super(e)}onBeforeCompile(e,t){super.onBeforeCompile(e,t),e.vertexShader=local_particle_physics_vert,e.fragmentShader=particle_physics_frag}}class SpriteBatch extends VFXBatch{constructor(e){super(e),this.vector_=new Vector3,this.vector2_=new Vector3,this.vector3_=new Vector3,this.quaternion_=new Quaternion,this.quaternion2_=new Quaternion,this.quaternion3_=new Quaternion,this.rotationMat_=new Matrix3,this.rotationMat2_=new Matrix3,this.maxParticles=1e3,this.setupBuffers(),this.rebuildMaterial()}buildExpandableBuffers(){this.offsetBuffer=new InstancedBufferAttribute(new Float32Array(this.maxParticles*3),3),this.offsetBuffer.setUsage(DynamicDrawUsage),this.geometry.setAttribute("offset",this.offsetBuffer),this.colorBuffer=new InstancedBufferAttribute(new Float32Array(this.maxParticles*4),4),this.colorBuffer.setUsage(DynamicDrawUsage),this.geometry.setAttribute("color",this.colorBuffer),this.settings.renderMode===RenderMode.Mesh?(this.rotationBuffer=new InstancedBufferAttribute(new Float32Array(this.maxParticles*4),4),this.rotationBuffer.setUsage(DynamicDrawUsage),this.geometry.setAttribute("rotation",this.rotationBuffer)):(this.settings.renderMode===RenderMode.BillBoard||this.settings.renderMode===RenderMode.HorizontalBillBoard||this.settings.renderMode===RenderMode.VerticalBillBoard||this.settings.renderMode===RenderMode.StretchedBillBoard)&&(this.rotationBuffer=new InstancedBufferAttribute(new Float32Array(this.maxParticles),1),this.rotationBuffer.setUsage(DynamicDrawUsage),this.geometry.setAttribute("rotation",this.rotationBuffer)),this.sizeBuffer=new InstancedBufferAttribute(new Float32Array(this.maxParticles*3),3),this.sizeBuffer.setUsage(DynamicDrawUsage),this.geometry.setAttribute("size",this.sizeBuffer),this.uvTileBuffer=new InstancedBufferAttribute(new Float32Array(this.maxParticles),1),this.uvTileBuffer.setUsage(DynamicDrawUsage),this.geometry.setAttribute("uvTile",this.uvTileBuffer),this.settings.renderMode===RenderMode.StretchedBillBoard&&(this.velocityBuffer=new InstancedBufferAttribute(new Float32Array(this.maxParticles*4),4),this.velocityBuffer.setUsage(DynamicDrawUsage),this.geometry.setAttribute("velocity",this.velocityBuffer))}setupBuffers(){this.geometry&&this.geometry.dispose(),this.geometry=new InstancedBufferGeometry,this.geometry.setIndex(this.settings.instancingGeometry.getIndex()),this.settings.instancingGeometry.hasAttribute("normal")&&this.geometry.setAttribute("normal",this.settings.instancingGeometry.getAttribute("normal")),this.geometry.setAttribute("position",this.settings.instancingGeometry.getAttribute("position")),this.geometry.setAttribute("uv",this.settings.instancingGeometry.getAttribute("uv")),this.buildExpandableBuffers()}expandBuffers(e){for(;e>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}rebuildMaterial(){this.layers.mask=this.settings.layers.mask;const e={},t={};this.settings.material.type!=="MeshStandardMaterial"&&this.settings.material.type!=="MeshPhysicalMaterial"&&(e.map=new Uniform(this.settings.material.map)),this.settings.material.alphaTest&&(t.USE_ALPHATEST="",e.alphaTest=new Uniform(this.settings.material.alphaTest)),t.USE_UV="";const o=this.settings.uTileCount,i=this.settings.vTileCount;(o>1||i>1)&&(t.UV_TILE="",e.tileCount=new Uniform(new Vector2(o,i))),this.settings.material.defines&&this.settings.material.defines.USE_COLOR_AS_ALPHA!==void 0&&(t.USE_COLOR_AS_ALPHA=""),this.settings.material.normalMap&&(t.USE_NORMALMAP="",t.NORMALMAP_UV=getMaterialUVChannelName(this.settings.material.normalMap.channel),e.normalMapTransform=new Uniform(new Matrix3().copy(this.settings.material.normalMap.matrix))),this.settings.material.map&&(t.USE_MAP="",this.settings.blendTiles&&(t.TILE_BLEND=""),t.MAP_UV=getMaterialUVChannelName(this.settings.material.map.channel),e.mapTransform=new Uniform(new Matrix3().copy(this.settings.material.map.matrix))),t.USE_COLOR_ALPHA="";let s;if(this.settings.softParticles){t.SOFT_PARTICLES="";const a=this.settings.softNearFade,l=1/(this.settings.softFarFade-this.settings.softNearFade);e.softParams=new Uniform(new Vector2(a,l)),e.depthTexture=new Uniform(null);const c=e.projParams=new Uniform(new Vector4);s=(d,u,f)=>{c.value.set(f.near,f.far,0,0)}}let r=!1;if(this.settings.renderMode===RenderMode.BillBoard||this.settings.renderMode===RenderMode.VerticalBillBoard||this.settings.renderMode===RenderMode.HorizontalBillBoard||this.settings.renderMode===RenderMode.Mesh){let a,l;this.settings.renderMode===RenderMode.Mesh?this.settings.material.type==="MeshStandardMaterial"||this.settings.material.type==="MeshPhysicalMaterial"?(t.USE_COLOR="",a=local_particle_physics_vert,l=particle_physics_frag,r=!0):(a=local_particle_vert,l=particle_frag):(a=particle_vert,l=particle_frag),this.settings.renderMode===RenderMode.VerticalBillBoard?t.VERTICAL="":this.settings.renderMode===RenderMode.HorizontalBillBoard&&(t.HORIZONTAL="");let c=!1;this.settings.renderMode===RenderMode.Mesh&&(this.settings.material.type==="MeshStandardMaterial"?(this.material=new ParticleMeshStandardMaterial({}),this.material.copy(this.settings.material),this.material.uniforms=e,this.material.defines=t,c=!0):this.settings.material.type==="MeshPhysicalMaterial"&&(this.material=new ParticleMeshPhysicsMaterial({}),this.material.copy(this.settings.material),this.material.uniforms=e,this.material.defines=t,c=!0)),c||(this.material=new ShaderMaterial({uniforms:e,defines:t,vertexShader:a,fragmentShader:l,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,blendDst:this.settings.material.blendDst,blendSrc:this.settings.material.blendSrc,blendEquation:this.settings.material.blendEquation,premultipliedAlpha:this.settings.material.premultipliedAlpha,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,depthTest:this.settings.material.depthTest,lights:r}))}else if(this.settings.renderMode===RenderMode.StretchedBillBoard)e.speedFactor=new Uniform(1),this.material=new ShaderMaterial({uniforms:e,defines:t,vertexShader:stretched_bb_particle_vert,fragmentShader:particle_frag,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,blending:this.settings.material.blending,blendDst:this.settings.material.blendDst,blendSrc:this.settings.material.blendSrc,blendEquation:this.settings.material.blendEquation,premultipliedAlpha:this.settings.material.premultipliedAlpha,side:this.settings.material.side,alphaTest:this.settings.material.alphaTest,depthTest:this.settings.material.depthTest});else throw new Error("render mode unavailable");this.material&&s&&(this.material.onBeforeRender=s)}update(){let e=0,t=0;this.systems.forEach(o=>{t+=o.particleNum}),t>this.maxParticles&&this.expandBuffers(t),this.systems.forEach(o=>{o.emitter.updateMatrixWorld&&(o.emitter.updateWorldMatrix(!0,!1),o.emitter.updateMatrixWorld(!0));const i=o.particles,s=o.particleNum,r=this.quaternion2_,a=this.vector2_,l=this.vector3_;o.emitter.matrixWorld.decompose(a,r,l),this.rotationMat_.setFromMatrix4(o.emitter.matrixWorld);for(let c=0;c<s;c++,e++){const d=i[c];if(this.settings.renderMode===RenderMode.Mesh){let f;if(o.worldSpace)f=d.rotation;else{let h;d.parentMatrix?h=this.quaternion3_.setFromRotationMatrix(d.parentMatrix):h=r,f=this.quaternion_,f.copy(h).multiply(d.rotation)}this.rotationBuffer.setXYZW(e,f.x,f.y,f.z,f.w)}else(this.settings.renderMode===RenderMode.StretchedBillBoard||this.settings.renderMode===RenderMode.VerticalBillBoard||this.settings.renderMode===RenderMode.HorizontalBillBoard||this.settings.renderMode===RenderMode.BillBoard)&&this.rotationBuffer.setX(e,d.rotation);let u;if(o.worldSpace?u=d.position:(u=this.vector_,d.parentMatrix?u.copy(d.position).applyMatrix4(d.parentMatrix):u.copy(d.position).applyMatrix4(o.emitter.matrixWorld)),this.offsetBuffer.setXYZ(e,u.x,u.y,u.z),this.colorBuffer.setXYZW(e,d.color.x,d.color.y,d.color.z,d.color.w),o.worldSpace?this.sizeBuffer.setXYZ(e,d.size.x,d.size.y,d.size.z):d.parentMatrix?this.sizeBuffer.setXYZ(e,d.size.x,d.size.y,d.size.z):this.sizeBuffer.setXYZ(e,d.size.x*Math.abs(l.x),d.size.y*Math.abs(l.y),d.size.z*Math.abs(l.z)),this.uvTileBuffer.setX(e,d.uvTile),this.settings.renderMode===RenderMode.StretchedBillBoard&&this.velocityBuffer){let f=o.rendererEmitterSettings.speedFactor;f===0&&(f=.001);const h=o.rendererEmitterSettings.lengthFactor;let m;o.worldSpace?m=d.velocity:(m=this.vector_,d.parentMatrix?(this.rotationMat2_.setFromMatrix4(d.parentMatrix),m.copy(d.velocity).applyMatrix3(this.rotationMat2_)):m.copy(d.velocity).applyMatrix3(this.rotationMat_)),this.velocityBuffer.setXYZW(e,m.x*f,m.y*f,m.z*f,h)}}}),this.geometry.instanceCount=e,e>0&&(this.offsetBuffer.clearUpdateRanges(),this.offsetBuffer.addUpdateRange(0,e*3),this.offsetBuffer.needsUpdate=!0,this.sizeBuffer.clearUpdateRanges(),this.sizeBuffer.addUpdateRange(0,e*3),this.sizeBuffer.needsUpdate=!0,this.colorBuffer.clearUpdateRanges(),this.colorBuffer.addUpdateRange(0,e*4),this.colorBuffer.needsUpdate=!0,this.uvTileBuffer.clearUpdateRanges(),this.uvTileBuffer.addUpdateRange(0,e),this.uvTileBuffer.needsUpdate=!0,this.settings.renderMode===RenderMode.StretchedBillBoard&&this.velocityBuffer&&(this.velocityBuffer.clearUpdateRanges(),this.velocityBuffer.addUpdateRange(0,e*4),this.velocityBuffer.needsUpdate=!0),this.settings.renderMode===RenderMode.Mesh?(this.rotationBuffer.clearUpdateRanges(),this.rotationBuffer.addUpdateRange(0,e*4),this.rotationBuffer.needsUpdate=!0):(this.settings.renderMode===RenderMode.StretchedBillBoard||this.settings.renderMode===RenderMode.HorizontalBillBoard||this.settings.renderMode===RenderMode.VerticalBillBoard||this.settings.renderMode===RenderMode.BillBoard)&&(this.rotationBuffer.clearUpdateRanges(),this.rotationBuffer.addUpdateRange(0,e),this.rotationBuffer.needsUpdate=!0))}dispose(){this.geometry.dispose()}}var trail_frag=`

#include <common>
#include <tile_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

uniform sampler2D alphaMap;
uniform float useAlphaMap;
uniform float visibility;
uniform float alphaTest;

varying vec4 vColor;
    
void main() {
    #include <clipping_planes_fragment>
    #include <logdepthbuf_fragment>

    vec4 diffuseColor = vColor;
    
    #ifdef USE_MAP
    #include <tile_fragment>
    #ifndef USE_COLOR_AS_ALPHA
    #endif
    #endif
    if( useAlphaMap == 1. ) diffuseColor.a *= texture2D( alphaMap, vUv).a;
    if( diffuseColor.a < alphaTest ) discard;
    gl_FragColor = diffuseColor;

    #include <fog_fragment>
    #include <tonemapping_fragment>
}`,trail_vert=`
#include <common>
#include <tile_pars_vertex>
#include <color_pars_vertex>
#include <clipping_planes_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <fog_pars_vertex>

attribute vec3 previous;
attribute vec3 next;
attribute float side;
attribute float width;

uniform vec2 resolution;
uniform float lineWidth;
uniform float sizeAttenuation;
    
vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
}
    
void main() {

    #include <tile_vertex>
    
    float aspect = resolution.x / resolution.y;

    vColor = color;

    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4( position, 1.0 );
    vec4 prevPos = m * vec4( previous, 1.0 );
    vec4 nextPos = m * vec4( next, 1.0 );

    vec2 currentP = fix( finalPosition, aspect );
    vec2 prevP = fix( prevPos, aspect );
    vec2 nextP = fix( nextPos, aspect );

    float w = lineWidth * width;

    vec2 dir;
    if( nextP == currentP ) dir = normalize( currentP - prevP );
    else if( prevP == currentP ) dir = normalize( nextP - currentP );
    else {
        vec2 dir1 = normalize( currentP - prevP );
        vec2 dir2 = normalize( nextP - currentP );
        dir = normalize( dir1 + dir2 );

        vec2 perp = vec2( -dir1.y, dir1.x );
        vec2 miter = vec2( -dir.y, dir.x );
        //w = clamp( w / dot( miter, perp ), 0., 4., * lineWidth * width );

    }

    //vec2 normal = ( cross( vec3( dir, 0. ) vec3( 0., 0., 1. ) ) ).xy;
    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );
    normal.xy *= .5 * w;
    normal *= projectionMatrix;
    if( sizeAttenuation == 0. ) {
        normal.xy *= finalPosition.w;
        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;
    }

    finalPosition.xy += normal.xy * side;

    gl_Position = finalPosition;

	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	
    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
    
	#include <fog_vertex>
}`;class TrailBatch extends VFXBatch{constructor(e){super(e),this.vector_=new Vector3,this.vector2_=new Vector3,this.vector3_=new Vector3,this.quaternion_=new Quaternion,this.maxParticles=1e4,this.setupBuffers(),this.rebuildMaterial()}setupBuffers(){this.geometry&&this.geometry.dispose(),this.geometry=new BufferGeometry,this.indexBuffer=new BufferAttribute(new Uint32Array(this.maxParticles*6),1),this.indexBuffer.setUsage(DynamicDrawUsage),this.geometry.setIndex(this.indexBuffer),this.positionBuffer=new BufferAttribute(new Float32Array(this.maxParticles*6),3),this.positionBuffer.setUsage(DynamicDrawUsage),this.geometry.setAttribute("position",this.positionBuffer),this.previousBuffer=new BufferAttribute(new Float32Array(this.maxParticles*6),3),this.previousBuffer.setUsage(DynamicDrawUsage),this.geometry.setAttribute("previous",this.previousBuffer),this.nextBuffer=new BufferAttribute(new Float32Array(this.maxParticles*6),3),this.nextBuffer.setUsage(DynamicDrawUsage),this.geometry.setAttribute("next",this.nextBuffer),this.widthBuffer=new BufferAttribute(new Float32Array(this.maxParticles*2),1),this.widthBuffer.setUsage(DynamicDrawUsage),this.geometry.setAttribute("width",this.widthBuffer),this.sideBuffer=new BufferAttribute(new Float32Array(this.maxParticles*2),1),this.sideBuffer.setUsage(DynamicDrawUsage),this.geometry.setAttribute("side",this.sideBuffer),this.uvBuffer=new BufferAttribute(new Float32Array(this.maxParticles*4),2),this.uvBuffer.setUsage(DynamicDrawUsage),this.geometry.setAttribute("uv",this.uvBuffer),this.colorBuffer=new BufferAttribute(new Float32Array(this.maxParticles*8),4),this.colorBuffer.setUsage(DynamicDrawUsage),this.geometry.setAttribute("color",this.colorBuffer)}expandBuffers(e){for(;e>=this.maxParticles;)this.maxParticles*=2;this.setupBuffers()}rebuildMaterial(){this.layers.mask=this.settings.layers.mask;const e={lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},resolution:{value:new Vector2(1,1)},sizeAttenuation:{value:1},visibility:{value:1},alphaTest:{value:0}},t={};if(t.USE_UV="",t.USE_COLOR_ALPHA="",this.settings.material.map&&(t.USE_MAP="",t.MAP_UV=getMaterialUVChannelName(this.settings.material.map.channel),e.map=new Uniform(this.settings.material.map),e.mapTransform=new Uniform(new Matrix3().copy(this.settings.material.map.matrix))),this.settings.material.defines&&this.settings.material.defines.USE_COLOR_AS_ALPHA!==void 0&&(t.USE_COLOR_AS_ALPHA=""),this.settings.renderMode===RenderMode.Trail)this.material=new ShaderMaterial({uniforms:e,defines:t,vertexShader:trail_vert,fragmentShader:trail_frag,transparent:this.settings.material.transparent,depthWrite:!this.settings.material.transparent,side:this.settings.material.side,blending:this.settings.material.blending||AdditiveBlending,blendDst:this.settings.material.blendDst,blendSrc:this.settings.material.blendSrc,blendEquation:this.settings.material.blendEquation,premultipliedAlpha:this.settings.material.premultipliedAlpha});else throw new Error("render mode unavailable")}update(){let e=0,t=0,o=0;this.systems.forEach(i=>{for(let s=0;s<i.particleNum;s++)o+=i.particles[s].previous.length*2}),o>this.maxParticles&&this.expandBuffers(o),this.systems.forEach(i=>{i.emitter.updateMatrixWorld&&(i.emitter.updateWorldMatrix(!0,!1),i.emitter.updateMatrixWorld(!0));const s=this.quaternion_,r=this.vector2_,a=this.vector3_;i.emitter.matrixWorld.decompose(r,s,a);const l=i.particles,c=i.particleNum,d=this.settings.uTileCount,u=this.settings.vTileCount,f=1/d,h=1/u;for(let m=0;m<c;m++){const p=l[m],v=p.uvTile%u,g=Math.floor(p.uvTile/u+.001),y=p.previous.values();let w=y.next(),_=w.value,S=_;w.done||(w=y.next());let C;w.value!==void 0?C=w.value:C=S;for(let A=0;A<p.previous.length;A++,e+=2){if(this.positionBuffer.setXYZ(e,S.position.x,S.position.y,S.position.z),this.positionBuffer.setXYZ(e+1,S.position.x,S.position.y,S.position.z),i.worldSpace?(this.positionBuffer.setXYZ(e,S.position.x,S.position.y,S.position.z),this.positionBuffer.setXYZ(e+1,S.position.x,S.position.y,S.position.z)):(p.parentMatrix?this.vector_.copy(S.position).applyMatrix4(p.parentMatrix):this.vector_.copy(S.position).applyMatrix4(i.emitter.matrixWorld),this.positionBuffer.setXYZ(e,this.vector_.x,this.vector_.y,this.vector_.z),this.positionBuffer.setXYZ(e+1,this.vector_.x,this.vector_.y,this.vector_.z)),i.worldSpace?(this.previousBuffer.setXYZ(e,_.position.x,_.position.y,_.position.z),this.previousBuffer.setXYZ(e+1,_.position.x,_.position.y,_.position.z)):(p.parentMatrix?this.vector_.copy(_.position).applyMatrix4(p.parentMatrix):this.vector_.copy(_.position).applyMatrix4(i.emitter.matrixWorld),this.previousBuffer.setXYZ(e,this.vector_.x,this.vector_.y,this.vector_.z),this.previousBuffer.setXYZ(e+1,this.vector_.x,this.vector_.y,this.vector_.z)),i.worldSpace?(this.nextBuffer.setXYZ(e,C.position.x,C.position.y,C.position.z),this.nextBuffer.setXYZ(e+1,C.position.x,C.position.y,C.position.z)):(p.parentMatrix?this.vector_.copy(C.position).applyMatrix4(p.parentMatrix):this.vector_.copy(C.position).applyMatrix4(i.emitter.matrixWorld),this.nextBuffer.setXYZ(e,this.vector_.x,this.vector_.y,this.vector_.z),this.nextBuffer.setXYZ(e+1,this.vector_.x,this.vector_.y,this.vector_.z)),this.sideBuffer.setX(e,1),this.sideBuffer.setX(e+1,-1),i.worldSpace)this.widthBuffer.setX(e,S.size),this.widthBuffer.setX(e+1,S.size);else if(p.parentMatrix)this.widthBuffer.setX(e,S.size),this.widthBuffer.setX(e+1,S.size);else{const E=(Math.abs(a.x)+Math.abs(a.y)+Math.abs(a.z))/3;this.widthBuffer.setX(e,S.size*E),this.widthBuffer.setX(e+1,S.size*E)}this.uvBuffer.setXY(e,(A/p.previous.length+v)*f,(u-g-1)*h),this.uvBuffer.setXY(e+1,(A/p.previous.length+v)*f,(u-g)*h),this.colorBuffer.setXYZW(e,S.color.x,S.color.y,S.color.z,S.color.w),this.colorBuffer.setXYZW(e+1,S.color.x,S.color.y,S.color.z,S.color.w),A+1<p.previous.length&&(this.indexBuffer.setX(t*3,e),this.indexBuffer.setX(t*3+1,e+1),this.indexBuffer.setX(t*3+2,e+2),t++,this.indexBuffer.setX(t*3,e+2),this.indexBuffer.setX(t*3+1,e+1),this.indexBuffer.setX(t*3+2,e+3),t++),_=S,S=C,w.done||(w=y.next(),w.value!==void 0&&(C=w.value))}}}),this.positionBuffer.clearUpdateRanges(),this.positionBuffer.addUpdateRange(0,e*3),this.positionBuffer.needsUpdate=!0,this.previousBuffer.clearUpdateRanges(),this.previousBuffer.addUpdateRange(0,e*3),this.previousBuffer.needsUpdate=!0,this.nextBuffer.clearUpdateRanges(),this.nextBuffer.addUpdateRange(0,e*3),this.nextBuffer.needsUpdate=!0,this.sideBuffer.clearUpdateRanges(),this.sideBuffer.addUpdateRange(0,e),this.sideBuffer.needsUpdate=!0,this.widthBuffer.clearUpdateRanges(),this.widthBuffer.addUpdateRange(0,e),this.widthBuffer.needsUpdate=!0,this.uvBuffer.clearUpdateRanges(),this.uvBuffer.addUpdateRange(0,e*2),this.uvBuffer.needsUpdate=!0,this.colorBuffer.clearUpdateRanges(),this.colorBuffer.addUpdateRange(0,e*4),this.colorBuffer.needsUpdate=!0,this.indexBuffer.clearUpdateRanges(),this.indexBuffer.addUpdateRange(0,t*3),this.indexBuffer.needsUpdate=!0,this.geometry.setDrawRange(0,t*3)}dispose(){this.geometry.dispose()}}class MeshSurfaceEmitter{get geometry(){return this._geometry}set geometry(e){if(this._geometry=e,e===void 0||typeof e=="string")return;const t=new Triangle;this._triangleIndexToArea.length=0;let o=0;if(!e.getIndex())return;const i=e.getIndex().array,s=i.length/3;this._triangleIndexToArea.push(0);for(let r=0;r<s;r++)t.setFromAttributeAndIndices(e.getAttribute("position"),i[r*3],i[r*3+1],i[r*3+2]),o+=t.getArea(),this._triangleIndexToArea.push(o);e.userData.triangleIndexToArea=this._triangleIndexToArea}constructor(e){this.type="mesh_surface",this._triangleIndexToArea=[],this._tempA=new Vector3$1,this._tempB=new Vector3$1,this._tempC=new Vector3$1,e&&(this.geometry=e)}initialize(e){const t=this._geometry;if(!t||t.getIndex()===null){e.position.set(0,0,0),e.velocity.set(0,0,1).multiplyScalar(e.startSpeed);return}const o=this._triangleIndexToArea.length-1;let i=0,s=o;const r=Math.random()*this._triangleIndexToArea[o];for(;i+1<s;){const h=Math.floor((i+s)/2);r<this._triangleIndexToArea[h]?s=h:i=h}let a=Math.random(),l=Math.random();a+l>1&&(a=1-a,l=1-l);const c=t.getIndex().array[i*3],d=t.getIndex().array[i*3+1],u=t.getIndex().array[i*3+2],f=t.getAttribute("position");this._tempA.fromBufferAttribute(f,c),this._tempB.fromBufferAttribute(f,d),this._tempC.fromBufferAttribute(f,u),this._tempB.sub(this._tempA),this._tempC.sub(this._tempA),this._tempA.addScaledVector(this._tempB,a).addScaledVector(this._tempC,l),e.position.copy(this._tempA),this._tempA.copy(this._tempB).cross(this._tempC).normalize(),e.velocity.copy(this._tempA).normalize().multiplyScalar(e.startSpeed)}toJSON(){return{type:"mesh_surface",mesh:this._geometry?this._geometry.uuid:""}}static fromJSON(e,t){return new MeshSurfaceEmitter(t.geometries[e.geometry])}clone(){return new MeshSurfaceEmitter(this._geometry)}update(e,t){}}loadPlugin({id:"three.quarks",initialize:()=>{},emitterShapes:[{type:"mesh_surface",params:[["geometry",["geometry"]]],constructor:MeshSurfaceEmitter,loadJSON:MeshSurfaceEmitter.fromJSON}],behaviors:[]});class BatchedRenderer extends Object3D{constructor(){super(),this.batches=[],this.systemToBatchIndex=new Map,this.type="BatchedRenderer",this.depthTexture=null}static equals(e,t){return e.material.side===t.material.side&&e.material.blending===t.material.blending&&e.material.blendSrc===t.material.blendSrc&&e.material.blendDst===t.material.blendDst&&e.material.blendEquation===t.material.blendEquation&&e.material.premultipliedAlpha===t.material.premultipliedAlpha&&e.material.transparent===t.material.transparent&&e.material.depthTest===t.material.depthTest&&e.material.type===t.material.type&&e.material.alphaTest===t.material.alphaTest&&e.material.map===t.material.map&&e.renderMode===t.renderMode&&e.blendTiles===t.blendTiles&&e.softParticles===t.softParticles&&e.softFarFade===t.softFarFade&&e.softNearFade===t.softNearFade&&e.uTileCount===t.uTileCount&&e.vTileCount===t.vTileCount&&e.instancingGeometry===t.instancingGeometry&&e.renderOrder===t.renderOrder&&e.layers.mask===t.layers.mask}addSystem(e){e._renderer=this;const t=e.getRendererSettings();for(let i=0;i<this.batches.length;i++)if(BatchedRenderer.equals(this.batches[i].settings,t)){this.batches[i].addSystem(e),this.systemToBatchIndex.set(e,i);return}let o;switch(t.renderMode){case RenderMode.Trail:o=new TrailBatch(t);break;case RenderMode.Mesh:case RenderMode.BillBoard:case RenderMode.VerticalBillBoard:case RenderMode.HorizontalBillBoard:case RenderMode.StretchedBillBoard:o=new SpriteBatch(t);break}this.depthTexture&&o.applyDepthTexture(this.depthTexture),o.addSystem(e),this.batches.push(o),this.systemToBatchIndex.set(e,this.batches.length-1),this.add(o)}deleteSystem(e){const t=this.systemToBatchIndex.get(e);t!=null&&(this.batches[t].removeSystem(e),this.systemToBatchIndex.delete(e))}setDepthTexture(e){this.depthTexture=e;for(const t of this.batches)t.applyDepthTexture(e)}updateSystem(e){this.deleteSystem(e),this.addSystem(e)}update(e){this.systemToBatchIndex.forEach((t,o)=>{o.update(e)});for(let t=0;t<this.batches.length;t++)this.batches[t].update()}}class QuarksLoader extends ObjectLoader{constructor(e){super(e)}linkReference(e){const t={};e.traverse(function(o){t[o.uuid]=o}),e.traverse(function(o){if(o.type==="ParticleEmitter"){const i=o.system;i.emitterShape;for(let s=0;s<i.behaviors.length;s++)i.behaviors[s]instanceof EmitSubParticleSystem&&(i.behaviors[s].subParticleSystem=t[i.behaviors[s].subParticleSystem])}})}parse(e,t){const o=super.parse(e,t);return this.linkReference(o),o}parseObject(e,t,o,i,s){let r;function a(m){return t[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",m),t[m]}function l(m){if(m!==void 0){if(Array.isArray(m)){const p=[];for(let v=0,g=m.length;v<g;v++){const y=m[v];o[y]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",y),p.push(o[y])}return p}return o[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",m),o[m]}}function c(m){return i[m]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",m),i[m]}let d,u;const f={textures:i,geometries:t,materials:o},h={};switch(e.type){case"ParticleEmitter":r=ParticleSystem.fromJSON(e.ps,f,h).emitter;break;case"Scene":r=new Scene,e.background!==void 0&&(Number.isInteger(e.background)?r.background=new Color(e.background):r.background=c(e.background)),e.environment!==void 0&&(r.environment=c(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?r.fog=new Fog(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(r.fog=new FogExp2(e.fog.color,e.fog.density)),e.fog.name!==""&&(r.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(r.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(r.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&r.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(r.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&r.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":r=new PerspectiveCamera(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(r.focus=e.focus),e.zoom!==void 0&&(r.zoom=e.zoom),e.filmGauge!==void 0&&(r.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(r.filmOffset=e.filmOffset),e.view!==void 0&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(r.zoom=e.zoom),e.view!==void 0&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new AmbientLight(e.color,e.intensity);break;case"DirectionalLight":r=new DirectionalLight(e.color,e.intensity);break;case"PointLight":r=new PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new HemisphereLight(e.color,e.groundColor,e.intensity);break;case"LightProbe":r=new LightProbe().fromJSON(e);break;case"SkinnedMesh":d=a(e.geometry),u=l(e.material),r=new SkinnedMesh(d,u),e.bindMode!==void 0&&(r.bindMode=e.bindMode),e.bindMatrix!==void 0&&r.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(r.skeleton=e.skeleton);break;case"Mesh":d=a(e.geometry),u=l(e.material),r=new Mesh(d,u);break;case"InstancedMesh":{d=a(e.geometry),u=l(e.material);const m=e.count,p=e.instanceMatrix,v=e.instanceColor;r=new InstancedMesh(d,u,m),r.instanceMatrix=new InstancedBufferAttribute(new Float32Array(p.array),16),v!==void 0&&(r.instanceColor=new InstancedBufferAttribute(new Float32Array(v.array),v.itemSize));break}case"BatchedMesh":d=a(e.geometry),u=l(e.material),r=new BatchedMesh(e.maxGeometryCount,e.maxVertexCount,e.maxIndexCount,u),r.geometry=d,r.perObjectFrustumCulled=e.perObjectFrustumCulled,r.sortObjects=e.sortObjects,r._drawRanges=e.drawRanges,r._reservedRanges=e.reservedRanges,r._visibility=e.visibility,r._active=e.active,r._bounds=e.bounds.map(m=>{const p=new Box3;p.min.fromArray(m.boxMin),p.max.fromArray(m.boxMax);const v=new Sphere;return v.radius=m.sphereRadius,v.center.fromArray(m.sphereCenter),{boxInitialized:m.boxInitialized,box:p,sphereInitialized:m.sphereInitialized,sphere:v}}),r._maxGeometryCount=e.maxGeometryCount,r._maxVertexCount=e.maxVertexCount,r._maxIndexCount=e.maxIndexCount,r._geometryInitialized=e.geometryInitialized,r._geometryCount=e.geometryCount,r._matricesTexture=c(e.matricesTexture.uuid);break;case"LOD":r=new LOD;break;case"Line":r=new Line(a(e.geometry),l(e.material));break;case"LineLoop":r=new LineLoop(a(e.geometry),l(e.material));break;case"LineSegments":r=new LineSegments(a(e.geometry),l(e.material));break;case"PointCloud":case"Points":r=new Points(a(e.geometry),l(e.material));break;case"Sprite":r=new Sprite(l(e.material));break;case"Group":r=new Group;break;case"Bone":r=new Bone;break;default:r=new Object3D}if(r.uuid=e.uuid,e.name!==void 0&&(r.name=e.name),e.matrix!==void 0?(r.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&(r.matrix.decompose(r.position,r.quaternion,r.scale),isNaN(r.quaternion.x)&&r.quaternion.set(0,0,0,1))):(e.position!==void 0&&r.position.fromArray(e.position),e.rotation!==void 0&&r.rotation.fromArray(e.rotation),e.quaternion!==void 0&&r.quaternion.fromArray(e.quaternion),e.scale!==void 0&&r.scale.fromArray(e.scale)),e.up!==void 0&&r.up.fromArray(e.up),e.castShadow!==void 0&&(r.castShadow=e.castShadow),e.receiveShadow!==void 0&&(r.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(r.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(r.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(r.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&r.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(r.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(r.visible=e.visible),e.frustumCulled!==void 0&&(r.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(r.renderOrder=e.renderOrder),e.userData!==void 0&&(r.userData=e.userData),e.layers!==void 0&&(r.layers.mask=e.layers),e.children!==void 0){const m=e.children;for(let p=0;p<m.length;p++)r.add(this.parseObject(m[p],t,o,i,s))}if(e.animations!==void 0){const m=e.animations;for(let p=0;p<m.length;p++){const v=m[p];r.animations.push(s[v])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(r.autoUpdate=e.autoUpdate);const m=e.levels;for(let p=0;p<m.length;p++){const v=m[p],g=r.getObjectByProperty("uuid",v.object);g!==void 0&&r.addLevel(g,v.distance)}}return r}}class QuarksUtil{static runOnAllParticleEmitters(e,t){e.traverse(o=>{o.type==="ParticleEmitter"&&t(o)}),e.type==="ParticleEmitter"&&t(e)}static addToBatchRenderer(e,t){QuarksUtil.runOnAllParticleEmitters(e,o=>{t.addSystem(o.system)})}static play(e){QuarksUtil.runOnAllParticleEmitters(e,t=>{t.system.play()})}static stop(e){QuarksUtil.runOnAllParticleEmitters(e,t=>{t.system.stop()})}static setAutoDestroy(e,t){QuarksUtil.runOnAllParticleEmitters(e,o=>{o.system.autoDestroy=t})}static endEmit(e){QuarksUtil.runOnAllParticleEmitters(e,t=>{t.system.endEmit()})}static restart(e){QuarksUtil.runOnAllParticleEmitters(e,t=>{t.system.restart()})}static pause(e){QuarksUtil.runOnAllParticleEmitters(e,t=>{t.system.pause()})}}registerShaderChunks();class RGBELoader extends DataTextureLoader{constructor(e){super(e),this.type=HalfFloatType}parse(e){const r=function(E,k){switch(E){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(k||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(k||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(k||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(k||""))}},d=`
`,u=function(E,k,I){k=k||1024;let M=E.pos,R=-1,O=0,$="",T=String.fromCharCode.apply(null,new Uint16Array(E.subarray(M,M+128)));for(;0>(R=T.indexOf(d))&&O<k&&M<E.byteLength;)$+=T,O+=T.length,M+=128,T+=String.fromCharCode.apply(null,new Uint16Array(E.subarray(M,M+128)));return-1<R?(E.pos+=O+R+1,$+T.slice(0,R)):!1},f=function(E){const k=/^#\?(\S+)/,I=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,F=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,M=/^\s*FORMAT=(\S+)\s*$/,R=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,O={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let $,T;for((E.pos>=E.byteLength||!($=u(E)))&&r(1,"no header found"),(T=$.match(k))||r(3,"bad initial token"),O.valid|=1,O.programtype=T[1],O.string+=$+`
`;$=u(E),$!==!1;){if(O.string+=$+`
`,$.charAt(0)==="#"){O.comments+=$+`
`;continue}if((T=$.match(I))&&(O.gamma=parseFloat(T[1])),(T=$.match(F))&&(O.exposure=parseFloat(T[1])),(T=$.match(M))&&(O.valid|=2,O.format=T[1]),(T=$.match(R))&&(O.valid|=4,O.height=parseInt(T[1],10),O.width=parseInt(T[2],10)),O.valid&2&&O.valid&4)break}return O.valid&2||r(3,"missing format specifier"),O.valid&4||r(3,"missing image size specifier"),O},h=function(E,k,I){const F=k;if(F<8||F>32767||E[0]!==2||E[1]!==2||E[2]&128)return new Uint8Array(E);F!==(E[2]<<8|E[3])&&r(3,"wrong scanline width");const M=new Uint8Array(4*k*I);M.length||r(4,"unable to allocate buffer space");let R=0,O=0;const $=4*F,T=new Uint8Array(4),D=new Uint8Array($);let P=I;for(;P>0&&O<E.byteLength;){O+4>E.byteLength&&r(1),T[0]=E[O++],T[1]=E[O++],T[2]=E[O++],T[3]=E[O++],(T[0]!=2||T[1]!=2||(T[2]<<8|T[3])!=F)&&r(3,"bad rgbe scanline format");let L=0,B;for(;L<$&&O<E.byteLength;){B=E[O++];const z=B>128;if(z&&(B-=128),(B===0||L+B>$)&&r(3,"bad scanline data"),z){const N=E[O++];for(let G=0;G<B;G++)D[L++]=N}else D.set(E.subarray(O,O+B),L),L+=B,O+=B}const b=F;for(let z=0;z<b;z++){let N=0;M[R]=D[z+N],N+=F,M[R+1]=D[z+N],N+=F,M[R+2]=D[z+N],N+=F,M[R+3]=D[z+N],R+=4}P--}return M},m=function(E,k,I,F){const M=E[k+3],R=Math.pow(2,M-128)/255;I[F+0]=E[k+0]*R,I[F+1]=E[k+1]*R,I[F+2]=E[k+2]*R,I[F+3]=1},p=function(E,k,I,F){const M=E[k+3],R=Math.pow(2,M-128)/255;I[F+0]=DataUtils.toHalfFloat(Math.min(E[k+0]*R,65504)),I[F+1]=DataUtils.toHalfFloat(Math.min(E[k+1]*R,65504)),I[F+2]=DataUtils.toHalfFloat(Math.min(E[k+2]*R,65504)),I[F+3]=DataUtils.toHalfFloat(1)},v=new Uint8Array(e);v.pos=0;const g=f(v),y=g.width,w=g.height,_=h(v.subarray(v.pos),y,w);let S,C,A;switch(this.type){case FloatType:A=_.length/4;const E=new Float32Array(A*4);for(let I=0;I<A;I++)m(_,I*4,E,I*4);S=E,C=FloatType;break;case HalfFloatType:A=_.length/4;const k=new Uint16Array(A*4);for(let I=0;I<A;I++)p(_,I*4,k,I*4);S=k,C=HalfFloatType;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:y,height:w,data:S,header:g.string,gamma:g.gamma,exposure:g.exposure,type:C}}setDataType(e){return this.type=e,this}load(e,t,o,i){function s(r,a){switch(r.type){case FloatType:case HalfFloatType:r.colorSpace=LinearSRGBColorSpace,r.minFilter=LinearFilter,r.magFilter=LinearFilter,r.generateMipmaps=!1,r.flipY=!0;break}t&&t(r,a)}return super.load(e,s,o,i)}}const _plane=new Plane,_pointer=new Vector2$1,_offset=new Vector3$1,_diff=new Vector2$1,_previousPointer=new Vector2$1,_intersection=new Vector3$1,_worldPosition=new Vector3$1,_inverseMatrix=new Matrix4$1,_up=new Vector3$1,_right=new Vector3$1;let _selected=null,_hovered=null;const _intersections=[],STATE={NONE:-1,PAN:0,ROTATE:1};class DragControls extends Controls{constructor(e,t,o=null){super(t,o),this.objects=e,this.recursive=!0,this.transformGroup=!1,this.rotateSpeed=1,this.raycaster=new Raycaster,this.mouseButtons={LEFT:MOUSE.PAN,MIDDLE:MOUSE.PAN,RIGHT:MOUSE.ROTATE},this.touches={ONE:TOUCH.PAN},this._onPointerMove=onPointerMove.bind(this),this._onPointerDown=onPointerDown.bind(this),this._onPointerCancel=onPointerCancel.bind(this),this._onContextMenu=onContextMenu.bind(this),o!==null&&this.connect()}connect(){this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointerup",this._onPointerCancel),this.domElement.addEventListener("pointerleave",this._onPointerCancel),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointerup",this._onPointerCancel),this.domElement.removeEventListener("pointerleave",this._onPointerCancel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.domElement.style.touchAction="auto",this.domElement.style.cursor=""}dispose(){this.disconnect()}_updatePointer(e){const t=this.domElement.getBoundingClientRect();_pointer.x=(e.clientX-t.left)/t.width*2-1,_pointer.y=-(e.clientY-t.top)/t.height*2+1}_updateState(e){let t;if(e.pointerType==="touch")t=this.touches.ONE;else switch(e.button){case 0:t=this.mouseButtons.LEFT;break;case 1:t=this.mouseButtons.MIDDLE;break;case 2:t=this.mouseButtons.RIGHT;break;default:t=null}switch(t){case MOUSE.PAN:case TOUCH.PAN:this.state=STATE.PAN;break;case MOUSE.ROTATE:case TOUCH.ROTATE:this.state=STATE.ROTATE;break;default:this.state=STATE.NONE}}getRaycaster(){return console.warn("THREE.DragControls: getRaycaster() has been deprecated. Use controls.raycaster instead."),this.raycaster}setObjects(e){console.warn("THREE.DragControls: setObjects() has been deprecated. Use controls.objects instead."),this.objects=e}getObjects(){return console.warn("THREE.DragControls: getObjects() has been deprecated. Use controls.objects instead."),this.objects}activate(){console.warn("THREE.DragControls: activate() has been renamed to connect()."),this.connect()}deactivate(){console.warn("THREE.DragControls: deactivate() has been renamed to disconnect()."),this.disconnect()}set mode(e){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}get mode(){console.warn("THREE.DragControls: The .mode property has been removed. Define the type of transformation via the .mouseButtons or .touches properties.")}}function onPointerMove(n){const e=this.object,t=this.domElement,o=this.raycaster;if(this.enabled!==!1){if(this._updatePointer(n),o.setFromCamera(_pointer,e),_selected)this.state===STATE.PAN?o.ray.intersectPlane(_plane,_intersection)&&_selected.position.copy(_intersection.sub(_offset).applyMatrix4(_inverseMatrix)):this.state===STATE.ROTATE&&(_diff.subVectors(_pointer,_previousPointer).multiplyScalar(this.rotateSpeed),_selected.rotateOnWorldAxis(_up,_diff.x),_selected.rotateOnWorldAxis(_right.normalize(),-_diff.y)),this.dispatchEvent({type:"drag",object:_selected}),_previousPointer.copy(_pointer);else if(n.pointerType==="mouse"||n.pointerType==="pen")if(_intersections.length=0,o.setFromCamera(_pointer,e),o.intersectObjects(this.objects,this.recursive,_intersections),_intersections.length>0){const i=_intersections[0].object;_plane.setFromNormalAndCoplanarPoint(e.getWorldDirection(_plane.normal),_worldPosition.setFromMatrixPosition(i.matrixWorld)),_hovered!==i&&_hovered!==null&&(this.dispatchEvent({type:"hoveroff",object:_hovered}),t.style.cursor="auto",_hovered=null),_hovered!==i&&(this.dispatchEvent({type:"hoveron",object:i}),t.style.cursor="pointer",_hovered=i)}else _hovered!==null&&(this.dispatchEvent({type:"hoveroff",object:_hovered}),t.style.cursor="auto",_hovered=null);_previousPointer.copy(_pointer)}}function onPointerDown(n){const e=this.object,t=this.domElement,o=this.raycaster;this.enabled!==!1&&(this._updatePointer(n),this._updateState(n),_intersections.length=0,o.setFromCamera(_pointer,e),o.intersectObjects(this.objects,this.recursive,_intersections),_intersections.length>0&&(this.transformGroup===!0?_selected=findGroup(_intersections[0].object):_selected=_intersections[0].object,_plane.setFromNormalAndCoplanarPoint(e.getWorldDirection(_plane.normal),_worldPosition.setFromMatrixPosition(_selected.matrixWorld)),o.ray.intersectPlane(_plane,_intersection)&&(this.state===STATE.PAN?(_inverseMatrix.copy(_selected.parent.matrixWorld).invert(),_offset.copy(_intersection).sub(_worldPosition.setFromMatrixPosition(_selected.matrixWorld))):this.state===STATE.ROTATE&&(_up.set(0,1,0).applyQuaternion(e.quaternion).normalize(),_right.set(1,0,0).applyQuaternion(e.quaternion).normalize())),t.style.cursor="move",this.dispatchEvent({type:"dragstart",object:_selected})),_previousPointer.copy(_pointer))}function onPointerCancel(){this.enabled!==!1&&(_selected&&(this.dispatchEvent({type:"dragend",object:_selected}),_selected=null),this.domElement.style.cursor=_hovered?"pointer":"auto",this.state=STATE.NONE)}function onContextMenu(n){this.enabled!==!1&&n.preventDefault()}function findGroup(n,e=null){return n.isGroup&&(e=n),n.parent===null?e:findGroup(n.parent,e)}const _box$1=new Box3,_vector=new Vector3$1;class LineSegmentsGeometry extends InstancedBufferGeometry{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],o=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(e,3)),this.setAttribute("uv",new Float32BufferAttribute(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,o=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),o.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const o=new InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new InterleavedBufferAttribute(o,3,0)),this.setAttribute("instanceEnd",new InterleavedBufferAttribute(o,3,3)),this.instanceCount=this.attributes.instanceStart.count,this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const o=new InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceColorStart",new InterleavedBufferAttribute(o,3,0)),this.setAttribute("instanceColorEnd",new InterleavedBufferAttribute(o,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new WireframeGeometry(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Box3);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),_box$1.setFromBufferAttribute(t),this.boundingBox.union(_box$1))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Sphere),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const o=this.boundingSphere.center;this.boundingBox.getCenter(o);let i=0;for(let s=0,r=e.count;s<r;s++)_vector.fromBufferAttribute(e,s),i=Math.max(i,o.distanceToSquared(_vector)),_vector.fromBufferAttribute(t,s),i=Math.max(i,o.distanceToSquared(_vector));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}UniformsLib.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new Vector2$1(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}};ShaderLib.line={uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.fog,UniformsLib.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 tmpFwd = normalize( mix( start.xyz, end.xyz, 0.5 ) );
				vec3 worldUp = normalize( cross( worldDir, tmpFwd ) );
				vec3 worldFwd = cross( worldDir, worldUp );
				worldPos = position.y < 0.5 ? start: end;

				// height offset
				float hw = linewidth * 0.5;
				worldPos.xyz += position.x < 0.0 ? hw * worldUp : - hw * worldUp;

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// cap extension
					worldPos.xyz += position.y < 0.5 ? - hw * worldDir : hw * worldDir;

					// add width to the box
					worldPos.xyz += worldFwd * hw;

					// endcaps
					if ( position.y > 1.0 || position.y < 0.0 ) {

						worldPos.xyz -= worldFwd * 2.0 * hw;

					}

				#endif

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <colorspace_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class LineMaterial extends ShaderMaterial{constructor(e){super({type:"LineMaterial",uniforms:UniformsUtils.clone(ShaderLib.line.uniforms),vertexShader:ShaderLib.line.vertexShader,fragmentShader:ShaderLib.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,this.setValues(e)}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}get worldUnits(){return"WORLD_UNITS"in this.defines}set worldUnits(e){e===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}get linewidth(){return this.uniforms.linewidth.value}set linewidth(e){this.uniforms.linewidth&&(this.uniforms.linewidth.value=e)}get dashed(){return"USE_DASH"in this.defines}set dashed(e){e===!0!==this.dashed&&(this.needsUpdate=!0),e===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get dashOffset(){return this.uniforms.dashOffset.value}set dashOffset(e){this.uniforms.dashOffset.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get opacity(){return this.uniforms.opacity.value}set opacity(e){this.uniforms&&(this.uniforms.opacity.value=e)}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value.copy(e)}get alphaToCoverage(){return"USE_ALPHA_TO_COVERAGE"in this.defines}set alphaToCoverage(e){this.defines&&(e===!0!==this.alphaToCoverage&&(this.needsUpdate=!0),e===!0?this.defines.USE_ALPHA_TO_COVERAGE="":delete this.defines.USE_ALPHA_TO_COVERAGE)}}const _viewport=new Vector4$1,_start=new Vector3$1,_end=new Vector3$1,_start4=new Vector4$1,_end4=new Vector4$1,_ssOrigin=new Vector4$1,_ssOrigin3=new Vector3$1,_mvMatrix=new Matrix4$1,_line=new Line3,_closestPoint=new Vector3$1,_box=new Box3,_sphere=new Sphere,_clipToWorldVector=new Vector4$1;let _ray,_lineWidth;function getWorldSpaceHalfWidth(n,e,t){return _clipToWorldVector.set(0,0,-e,1).applyMatrix4(n.projectionMatrix),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),_clipToWorldVector.x=_lineWidth/t.width,_clipToWorldVector.y=_lineWidth/t.height,_clipToWorldVector.applyMatrix4(n.projectionMatrixInverse),_clipToWorldVector.multiplyScalar(1/_clipToWorldVector.w),Math.abs(Math.max(_clipToWorldVector.x,_clipToWorldVector.y))}function raycastWorldUnits(n,e){const t=n.matrixWorld,o=n.geometry,i=o.attributes.instanceStart,s=o.attributes.instanceEnd,r=Math.min(o.instanceCount,i.count);for(let a=0,l=r;a<l;a++){_line.start.fromBufferAttribute(i,a),_line.end.fromBufferAttribute(s,a),_line.applyMatrix4(t);const c=new Vector3$1,d=new Vector3$1;_ray.distanceSqToSegment(_line.start,_line.end,d,c),d.distanceTo(c)<_lineWidth*.5&&e.push({point:d,pointOnLine:c,distance:_ray.origin.distanceTo(d),object:n,face:null,faceIndex:a,uv:null,uv1:null})}}function raycastScreenSpace(n,e,t){const o=e.projectionMatrix,s=n.material.resolution,r=n.matrixWorld,a=n.geometry,l=a.attributes.instanceStart,c=a.attributes.instanceEnd,d=Math.min(a.instanceCount,l.count),u=-e.near;_ray.at(1,_ssOrigin),_ssOrigin.w=1,_ssOrigin.applyMatrix4(e.matrixWorldInverse),_ssOrigin.applyMatrix4(o),_ssOrigin.multiplyScalar(1/_ssOrigin.w),_ssOrigin.x*=s.x/2,_ssOrigin.y*=s.y/2,_ssOrigin.z=0,_ssOrigin3.copy(_ssOrigin),_mvMatrix.multiplyMatrices(e.matrixWorldInverse,r);for(let f=0,h=d;f<h;f++){if(_start4.fromBufferAttribute(l,f),_end4.fromBufferAttribute(c,f),_start4.w=1,_end4.w=1,_start4.applyMatrix4(_mvMatrix),_end4.applyMatrix4(_mvMatrix),_start4.z>u&&_end4.z>u)continue;if(_start4.z>u){const w=_start4.z-_end4.z,_=(_start4.z-u)/w;_start4.lerp(_end4,_)}else if(_end4.z>u){const w=_end4.z-_start4.z,_=(_end4.z-u)/w;_end4.lerp(_start4,_)}_start4.applyMatrix4(o),_end4.applyMatrix4(o),_start4.multiplyScalar(1/_start4.w),_end4.multiplyScalar(1/_end4.w),_start4.x*=s.x/2,_start4.y*=s.y/2,_end4.x*=s.x/2,_end4.y*=s.y/2,_line.start.copy(_start4),_line.start.z=0,_line.end.copy(_end4),_line.end.z=0;const p=_line.closestPointToPointParameter(_ssOrigin3,!0);_line.at(p,_closestPoint);const v=MathUtils$1.lerp(_start4.z,_end4.z,p),g=v>=-1&&v<=1,y=_ssOrigin3.distanceTo(_closestPoint)<_lineWidth*.5;if(g&&y){_line.start.fromBufferAttribute(l,f),_line.end.fromBufferAttribute(c,f),_line.start.applyMatrix4(r),_line.end.applyMatrix4(r);const w=new Vector3$1,_=new Vector3$1;_ray.distanceSqToSegment(_line.start,_line.end,_,w),t.push({point:_,pointOnLine:w,distance:_ray.origin.distanceTo(_),object:n,face:null,faceIndex:f,uv:null,uv1:null})}}}class LineSegments2 extends Mesh{constructor(e=new LineSegmentsGeometry,t=new LineMaterial({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,o=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let r=0,a=0,l=t.count;r<l;r++,a+=2)_start.fromBufferAttribute(t,r),_end.fromBufferAttribute(o,r),i[a]=a===0?0:i[a-1],i[a+1]=i[a]+_start.distanceTo(_end);const s=new InstancedInterleavedBuffer(i,2,1);return e.setAttribute("instanceDistanceStart",new InterleavedBufferAttribute(s,1,0)),e.setAttribute("instanceDistanceEnd",new InterleavedBufferAttribute(s,1,1)),this}raycast(e,t){const o=this.material.worldUnits,i=e.camera;i===null&&!o&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;_ray=e.ray;const r=this.matrixWorld,a=this.geometry,l=this.material;_lineWidth=l.linewidth+s,a.boundingSphere===null&&a.computeBoundingSphere(),_sphere.copy(a.boundingSphere).applyMatrix4(r);let c;if(o)c=_lineWidth*.5;else{const u=Math.max(i.near,_sphere.distanceToPoint(_ray.origin));c=getWorldSpaceHalfWidth(i,u,l.resolution)}if(_sphere.radius+=c,_ray.intersectsSphere(_sphere)===!1)return;a.boundingBox===null&&a.computeBoundingBox(),_box.copy(a.boundingBox).applyMatrix4(r);let d;if(o)d=_lineWidth*.5;else{const u=Math.max(i.near,_box.distanceToPoint(_ray.origin));d=getWorldSpaceHalfWidth(i,u,l.resolution)}_box.expandByScalar(d),_ray.intersectsBox(_box)!==!1&&(o?raycastWorldUnits(this,t):raycastScreenSpace(this,i,t))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(_viewport),this.material.uniforms.resolution.value.set(_viewport.z,_viewport.w))}}class LineGeometry extends LineSegmentsGeometry{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,o=new Float32Array(2*t);for(let i=0;i<t;i+=3)o[2*i]=e[i],o[2*i+1]=e[i+1],o[2*i+2]=e[i+2],o[2*i+3]=e[i+3],o[2*i+4]=e[i+4],o[2*i+5]=e[i+5];return super.setPositions(o),this}setColors(e){const t=e.length-3,o=new Float32Array(2*t);for(let i=0;i<t;i+=3)o[2*i]=e[i],o[2*i+1]=e[i+1],o[2*i+2]=e[i+2],o[2*i+3]=e[i+3],o[2*i+4]=e[i+4],o[2*i+5]=e[i+5];return super.setColors(o),this}setFromPoints(e){const t=e.length-1,o=new Float32Array(6*t);for(let i=0;i<t;i++)o[6*i]=e[i].x,o[6*i+1]=e[i].y,o[6*i+2]=e[i].z||0,o[6*i+3]=e[i+1].x,o[6*i+4]=e[i+1].y,o[6*i+5]=e[i+1].z||0;return super.setPositions(o),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class Line2 extends LineSegments2{constructor(e=new LineGeometry,t=new LineMaterial({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}class FontLoader extends Loader{constructor(e){super(e)}load(e,t,o,i){const s=this,r=new FileLoader(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,function(a){const l=s.parse(JSON.parse(a));t&&t(l)},o,i)}parse(e){return new Font(e)}}class Font{constructor(e){this.isFont=!0,this.type="Font",this.data=e}generateShapes(e,t=100){const o=[],i=createPaths(e,t,this.data);for(let s=0,r=i.length;s<r;s++)o.push(...i[s].toShapes());return o}}function createPaths(n,e,t){const o=Array.from(n),i=e/t.resolution,s=(t.boundingBox.yMax-t.boundingBox.yMin+t.underlineThickness)*i,r=[];let a=0,l=0;for(let c=0;c<o.length;c++){const d=o[c];if(d===`
`)a=0,l-=s;else{const u=createPath(d,i,a,l,t);a+=u.offsetX,r.push(u.path)}}return r}function createPath(n,e,t,o,i){const s=i.glyphs[n]||i.glyphs["?"];if(!s){console.error('THREE.Font: character "'+n+'" does not exists in font family '+i.familyName+".");return}const r=new ShapePath;let a,l,c,d,u,f,h,m;if(s.o){const p=s._cachedOutline||(s._cachedOutline=s.o.split(" "));for(let v=0,g=p.length;v<g;)switch(p[v++]){case"m":a=p[v++]*e+t,l=p[v++]*e+o,r.moveTo(a,l);break;case"l":a=p[v++]*e+t,l=p[v++]*e+o,r.lineTo(a,l);break;case"q":c=p[v++]*e+t,d=p[v++]*e+o,u=p[v++]*e+t,f=p[v++]*e+o,r.quadraticCurveTo(u,f,c,d);break;case"b":c=p[v++]*e+t,d=p[v++]*e+o,u=p[v++]*e+t,f=p[v++]*e+o,h=p[v++]*e+t,m=p[v++]*e+o,r.bezierCurveTo(u,f,h,m,c,d);break}}return{offsetX:s.ha*e,path:r}}class GroundedSkybox extends Mesh{constructor(e,t,o,i=128){if(t<=0||o<=0||i<=0)throw new Error("GroundedSkybox height, radius, and resolution must be positive.");const s=new SphereGeometry(o,2*i,i);s.scale(1,1,-1);const r=s.getAttribute("position"),a=new Vector3$1;for(let l=0;l<r.count;++l)if(a.fromBufferAttribute(r,l),a.y<0){const c=-t*3/2,d=a.y<c?-t/a.y:1-a.y*a.y/(3*c*c);a.multiplyScalar(d),a.toArray(r.array,3*l)}r.needsUpdate=!0,super(s,new MeshBasicMaterial({map:e,depthWrite:!1}))}}const Constants={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function fetchJsonFile(n){const e=await fetch(n);if(e.ok)return e.json();throw new Error(e.statusText)}async function fetchProfilesList(n){if(!n)throw new Error("No basePath supplied");return await fetchJsonFile(`${n}/profilesList.json`)}async function fetchProfile(n,e,t=null,o=!0){if(!n)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const i=await fetchProfilesList(e);let s;if(n.profiles.some(l=>{const c=i[l];return c&&(s={profileId:l,profilePath:`${e}/${c.path}`,deprecated:!!c.deprecated}),!!s}),!s){if(!t)throw new Error("No matching profile name found");const l=i[t];if(!l)throw new Error(`No matching profile name found and default profile "${t}" missing.`);s={profileId:t,profilePath:`${e}/${l.path}`,deprecated:!!l.deprecated}}const r=await fetchJsonFile(s.profilePath);let a;if(o){let l;if(n.handedness==="any"?l=r.layouts[Object.keys(r.layouts)[0]]:l=r.layouts[n.handedness],!l)throw new Error(`No matching handedness, ${n.handedness}, in profile ${s.profileId}`);l.assetPath&&(a=s.profilePath.replace("profile.json",l.assetPath))}return{profile:r,assetPath:a}}const defaultComponentValues={xAxis:0,yAxis:0,button:0,state:Constants.ComponentState.DEFAULT};function normalizeAxes(n=0,e=0){let t=n,o=e;if(Math.sqrt(n*n+e*e)>1){const r=Math.atan2(e,n);t=Math.cos(r),o=Math.sin(r)}return{normalizedXAxis:t*.5+.5,normalizedYAxis:o*.5+.5}}class VisualResponse{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===Constants.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(defaultComponentValues)}updateFromComponent({xAxis:e,yAxis:t,button:o,state:i}){const{normalizedXAxis:s,normalizedYAxis:r}=normalizeAxes(e,t);switch(this.componentProperty){case Constants.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?s:.5;break;case Constants.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?r:.5;break;case Constants.ComponentProperty.BUTTON:this.value=this.states.includes(i)?o:0;break;case Constants.ComponentProperty.STATE:this.valueNodeProperty===Constants.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class Component{constructor(e,t){if(!e||!t||!t.visualResponses||!t.gamepadIndices||Object.keys(t.gamepadIndices).length===0)throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach(o=>{const i=new VisualResponse(t.visualResponses[o]);this.visualResponses[o]=i}),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:Constants.ComponentState.DEFAULT,button:this.gamepadIndices.button!==void 0?0:void 0,xAxis:this.gamepadIndices.xAxis!==void 0?0:void 0,yAxis:this.gamepadIndices.yAxis!==void 0?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=Constants.ComponentState.DEFAULT,this.gamepadIndices.button!==void 0&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||this.values.button===1?this.values.state=Constants.ComponentState.PRESSED:(t.touched||this.values.button>Constants.ButtonTouchThreshold)&&(this.values.state=Constants.ComponentState.TOUCHED)}this.gamepadIndices.xAxis!==void 0&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===Constants.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>Constants.AxisTouchThreshold&&(this.values.state=Constants.ComponentState.TOUCHED)),this.gamepadIndices.yAxis!==void 0&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===Constants.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>Constants.AxisTouchThreshold&&(this.values.state=Constants.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach(t=>{t.updateFromComponent(this.values)})}}class MotionController{constructor(e,t,o){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=o,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach(i=>{const s=this.layoutDescription.components[i];this.components[i]=new Component(i,s)}),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach(t=>{e.push(t.data)}),e}updateFromGamepad(){Object.values(this.components).forEach(e=>{e.updateFromGamepad(this.xrInputSource.gamepad)})}}const DEFAULT_PROFILES_PATH="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",DEFAULT_PROFILE="generic-trigger";class XRControllerModel extends Object3D{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e?this:(this.envMap=e,this.traverse(t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}),this)}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach(t=>{Object.values(t.visualResponses).forEach(o=>{const{valueNode:i,minNode:s,maxNode:r,value:a,valueNodeProperty:l}=o;i&&(l===Constants.VisualResponseProperty.VISIBILITY?i.visible=a:l===Constants.VisualResponseProperty.TRANSFORM&&(i.quaternion.slerpQuaternions(s.quaternion,r.quaternion,a),i.position.lerpVectors(s.position,r.position,a)))})}))}}function findNodes(n,e){Object.values(n.components).forEach(t=>{const{type:o,touchPointNodeName:i,visualResponses:s}=t;if(o===Constants.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(i),t.touchPointNode){const r=new SphereGeometry(.001),a=new MeshBasicMaterial({color:255}),l=new Mesh(r,a);t.touchPointNode.add(l)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(s).forEach(r=>{const{valueNodeName:a,minNodeName:l,maxNodeName:c,valueNodeProperty:d}=r;if(d===Constants.VisualResponseProperty.TRANSFORM){if(r.minNode=e.getObjectByName(l),r.maxNode=e.getObjectByName(c),!r.minNode){console.warn(`Could not find ${l} in the model`);return}if(!r.maxNode){console.warn(`Could not find ${c} in the model`);return}}r.valueNode=e.getObjectByName(a),r.valueNode||console.warn(`Could not find ${a} in the model`)})})}function addAssetSceneToControllerModel(n,e){findNodes(n.motionController,e),n.envMap&&e.traverse(t=>{t.isMesh&&(t.material.envMap=n.envMap,t.material.needsUpdate=!0)}),n.add(e)}class XRControllerModelFactory{constructor(e=null,t=null){this.gltfLoader=e,this.path=DEFAULT_PROFILES_PATH,this._assetCache={},this.onLoad=t,this.gltfLoader||(this.gltfLoader=new GLTFLoader)}setPath(e){return this.path=e,this}createControllerModel(e){const t=new XRControllerModel;let o=null;return e.addEventListener("connected",i=>{const s=i.data;s.targetRayMode!=="tracked-pointer"||!s.gamepad||s.hand||fetchProfile(s,this.path,DEFAULT_PROFILE).then(({profile:r,assetPath:a})=>{t.motionController=new MotionController(s,r,a);const l=this._assetCache[t.motionController.assetUrl];if(l)o=l.scene.clone(),addAssetSceneToControllerModel(t,o),this.onLoad&&this.onLoad(o);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,c=>{this._assetCache[t.motionController.assetUrl]=c,o=c.scene.clone(),addAssetSceneToControllerModel(t,o),this.onLoad&&this.onLoad(o)},null,()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)})}}).catch(r=>{console.warn(r)})}),e.addEventListener("disconnected",()=>{t.motionController=null,t.remove(o),o=null}),t}}const playerAssetsEntry={audios:[{name:"walking",path:"/audios/walkingGrass.wav",volume:.8}]};let modelLoader=null,textureLoader$1=null,audioLoader=null,quarksLoader=null,rgbeLoader=null,cubeTextureLoader=null,listener=null;const allAssets$4={models:{gltf:{},animations:{}},textures:{},audios:{},videotextures:{},characters:{animations:{},models:{}},selectedPlayer:{model:{},audios:{}},hdris:{},cubeMaps:{},vfxs:{},pathFiles:{},jsonFiles:{},fonts:{},svgs:{}},userInfo$1=getUserInfo();async function loadAllAsset(n,e,t,o){initializeLoadingManager(e,t,o),modelLoader=new GLTFLoader(loadingManager),textureLoader$1=new TextureLoader(loadingManager),audioLoader=new AudioLoader(loadingManager),quarksLoader=new QuarksLoader(loadingManager),rgbeLoader=new RGBELoader(loadingManager),cubeTextureLoader=new CubeTextureLoader(loadingManager),listener=new AudioListener,new VideoTexture(loadingManager);const i=loadModels(n),s=loadCharacters(n),r=loadTextures(n),a=await loadAudios(n),l=loadSelectedCharacter(userInfo$1.selectedCharacter),c=loadVFX(n),d=loadHdris(n),u=loadCubeMaps(n),f=loadPathFile(n),h=loadFontFile(n),m=loadJsonFiles(n),p=loadSvgs(n),v=loadPlayerMovementAudio(playerAssetsEntry),g=loadVideoTextures(n);await Promise.all([...i,v,...s,...r,...a,l,...g,...c,...d,...u,...f,...h,...m,...p])}function loadModels(n){var e;return((e=n.models)==null?void 0:e.map(({name:t,path:o,shadow:i,scale:s})=>allAssets$4.models.gltf[t]?(console.log(`${t} model already exists.`),Promise.resolve()):new Promise((r,a)=>{modelLoader.load(o,l=>{if(s&&l.scene.scale.set(s.x,s.y,s.z),l.scene.name=t,allAssets$4.models.gltf[t]=l.scene,l.scene.traverse(c=>{c.isMesh&&(c.castShadow=i??!1,c.receiveShadow=i??!1)}),l.animations&&l.animations.length>0){const c=new AnimationMixer(l.scene);allAssets$4.models.animations[t]={mixer:c,actions:{}},l.animations.forEach(d=>{const u=c.clipAction(d);allAssets$4.models.animations[t].actions[d.name]=u})}r()},void 0,a)})))||[]}function loadVideoTextures(n){var e;return((e=n.videoTextures)==null?void 0:e.map(({name:t,path:o})=>allAssets$4.videotextures[t]?(console.log(`${t} video texture already exists.`),Promise.resolve()):new Promise(i=>{const s=document.createElement("video");s.src=o,s.loop=!0,s.muted=!0,s.playsInline=!0,s.autoplay=!0,allAssets$4.videotextures[t]={video:s,path:o},i()})))||[]}function loadCharacters(n){var e;return((e=n.characters)==null?void 0:e.map(({name:t,path:o,shadow:i})=>allAssets$4.characters[t]?(console.log(`${t} character already exists.`),Promise.resolve()):new Promise((s,r)=>{modelLoader.load(o,a=>{a.scene.name=t,allAssets$4.characters.models[t]=a.scene,a.scene.traverse(l=>{l.castShadow=i??!1,l.receiveShadow=i??!1}),animationConfig(a,t),s()},void 0,r)})))||[]}function animationConfig(n,e){if(!n||!n.animations||n.animations.length===0)return;const t=new AnimationMixer(n.scene),o={};n.animations.forEach(i=>{o[i.name]=t.clipAction(i)}),allAssets$4.characters.animations[e]={mixer:t,actions:o}}function loadTextures(n){var e;return((e=n.textures)==null?void 0:e.map(({name:t,path:o})=>allAssets$4.textures[t]?(console.log(`${t} texture already exists.`),Promise.resolve()):new Promise(i=>{const s=textureLoader$1.load(o,()=>i(s));allAssets$4.textures[t]=s})))||[]}function loadAudios(n,e){var o;const t=((o=n.audios)==null?void 0:o.map(({name:i,path:s,volume:r=1,loop:a=!1,positional:l=!1,refDistance:c=5})=>allAssets$4.audios[i]?(console.log(`${i} audio already exists.`),Promise.resolve(allAssets$4.audios[i])):new Promise((d,u)=>{audioLoader.load(s,f=>{let h;l?(h=new PositionalAudio(listener),h.setRefDistance(c)):h=new Audio$1(listener),h.setBuffer(f),h.setVolume(r),h.setLoop(a),allAssets$4.audios[i]=h,d(h)},void 0,u)})))||[];return Promise.all(t).then(i=>i)}function loadSelectedCharacter(n){return allAssets$4.characters[n]?(console.log(`${n} character already exists.`),Promise.resolve()):new Promise((e,t)=>{modelLoader.load(userInfo$1.selectedCharacter,o=>{o.scene.name=n,allAssets$4.selectedPlayer.model[n]=o.scene,o.scene.traverse(i=>{i.castShadow=!0,i.receiveShadow=!0}),animationConfig(o,n),e()},void 0,t)})}function loadPlayerMovementAudio(n){var t;const e=((t=n.audios)==null?void 0:t.map(({name:o,path:i,volume:s})=>allAssets$4.selectedPlayer.audios[o]?(console.log(`${o} audio already exists.`),Promise.resolve()):new Promise((r,a)=>{audioLoader.load(i,l=>{let c=new Audio$1(listener);c.setBuffer(l),c.setLoop(!1),c.setVolume(s??1),allAssets$4.selectedPlayer.audios[o]=c,r()},void 0,l=>{console.error(`Error loading audio: ${o}`,l),a(l)})})))||[];return Promise.all(e)}function loadVFX(n){var e;return((e=n.vfxs)==null?void 0:e.map(({name:t,path:o})=>allAssets$4.vfxs[t]?(console.log(`${t} VFX already exists.`),Promise.resolve()):new Promise((i,s)=>{quarksLoader.load(o,r=>{r.name=t,allAssets$4.vfxs[t]=r,i()},void 0,s)})))||[]}function loadHdris(n){var e;return((e=n.hdris)==null?void 0:e.map(({name:t,path:o})=>allAssets$4.hdris[t]?(console.log(`${t} HDRI already exists.`),Promise.resolve()):new Promise((i,s)=>{rgbeLoader.load(o,r=>{r.name=t,r.mapping=EquirectangularReflectionMapping,allAssets$4.hdris[t]=r,i()},void 0,s)})))||[]}function loadCubeMaps(n){var e;return((e=n.cubeMaps)==null?void 0:e.map(({name:t,images:o})=>allAssets$4.cubeMaps[t]?(console.log(`${t} CubeMap already exists.`),Promise.resolve()):new Promise((i,s)=>{cubeTextureLoader.load(o,r=>{r.mapping=CubeReflectionMapping,allAssets$4.cubeMaps[t]=r,i()},void 0,s)})))||[]}function loadPathFile(n){return!n.pathFiles||n.pathFiles.length===0?(console.warn("No path files provided in assetesEntry."),[]):n.pathFiles.map(({name:t,path:o,offset:i,invertZ:s})=>allAssets$4.pathFiles[t]?(console.log(`Path file for ${t} is already loaded.`),Promise.resolve(allAssets$4.pathFiles[t])):fetch(o).then(r=>r.json()).then(r=>{if(!Array.isArray(r))throw new Error(`Invalid JSON structure for ${t}`);const a=processCurveData(r,i,s),l={name:t,points:a};return allAssets$4.pathFiles[t]=l,console.log(`Loaded and cached path file for ${t}.`),l}).catch(r=>(console.error(`Error loading path file for ${t}:`,r),null)))}function processCurveData(n,e={x:0,y:0,z:0},t=!1){let o=[];return n.forEach(i=>{i.vertices.forEach(s=>{s.forEach(r=>{const a=r.co[0]+e.x,l=r.co[1]+e.y,c=(t?-r.co[2]:r.co[2])+e.z;o.push(new Vector3$1(a,l,c))})})}),o}function loadFontFile(n){return!n.fonts||n.fonts.length===0?(console.warn("No font files provided in assetesEntry."),[]):n.fonts.map(({fontName:e,data:t})=>allAssets$4.fonts[e]?(console.log(`Font ${e} is already loaded.`),Promise.resolve(allAssets$4.fonts[e])):fetch(t.jsonDataPath).then(o=>o.json()).then(o=>{let i;if(t.textureDataPath)i={name:e,json:o,image:t.textureDataPath};else{const r=new FontLoader().parse(o);i={name:e,json:r,image:null}}return allAssets$4.fonts[e]=i,console.log(`Loaded and cached font: ${e}.`),i}).catch(o=>(console.error(`Error loading font ${e}:`,o),null)))}function loadJsonFiles(n){var e;return((e=n.jsonFiles)==null?void 0:e.map(({name:t,path:o})=>allAssets$4.jsonFiles[t]?(console.log(`${t} JSON file already exists.`),Promise.resolve()):fetch(o).then(i=>{if(!i.ok)throw new Error(`Failed to load JSON file: ${t}`);return i.json()}).then(i=>{allAssets$4.jsonFiles[t]=i,console.log(`Loaded JSON file: ${t}`)}).catch(i=>console.error(i))))||[]}function loadSvgs(n){var e;return((e=n.svgs)==null?void 0:e.map(({name:t,path:o})=>(console.log(t,o),allAssets$4.svgs[t]?(console.log(`${t} SVG already exists.`),Promise.resolve()):fetch(o).then(i=>{if(!i.ok)throw new Error(`Failed to load SVG file: ${t}`);return i.text()}).then(i=>{allAssets$4.svgs[t]=i,console.log(`Loaded SVG file: ${t}`)}).catch(i=>console.error(i)))))||[]}function checkExistingAssets(n){Object.keys(allAssets$4).forEach(e=>{if(e==="selectedPlayer")return;const t=new Set((n[e]||[]).map(o=>o.name));e==="models"&&(Object.keys(allAssets$4.models.gltf).forEach(o=>{if(!t.has(o)){const i=allAssets$4.models.gltf[o];i&&(i.traverse(s=>{s.isMesh&&(s.geometry.dispose(),s.material.isMaterial&&(s.material.dispose(),s.material.map&&s.material.map.dispose()))}),delete allAssets$4.models.gltf[o])}}),Object.keys(allAssets$4.models.animations).forEach(o=>{t.has(o)||delete allAssets$4.models.animations[o]})),e==="textures"&&Object.keys(allAssets$4.textures).forEach(o=>{if(!t.has(o)){const i=allAssets$4.textures[o];i&&(i.dispose(),delete allAssets$4.textures[o])}}),e==="audios"&&Object.keys(allAssets$4.audios).forEach(o=>{if(!t.has(o)){const i=allAssets$4.audios[o];i&&(i.stop(),delete allAssets$4.audios[o])}}),e==="videotextures"&&Object.keys(allAssets$4.videotextures).forEach(o=>{if(!t.has(o)){const i=allAssets$4.videotextures[o];i&&i.video&&(i.video.pause(),i.video.src="",i.video.load(),i.video=null,delete allAssets$4.videotextures[o])}}),e==="hdris"&&Object.keys(allAssets$4.hdris).forEach(o=>{if(!t.has(o)){const i=allAssets$4.hdris[o];i&&(i.dispose(),delete allAssets$4.hdris[o])}}),e==="cubeMaps"&&Object.keys(allAssets$4.cubeMaps).forEach(o=>{if(!t.has(o)){const i=allAssets$4.cubeMaps[o];i&&(i.dispose(),delete allAssets$4.cubeMaps[o])}}),e==="vfxs"&&Object.keys(allAssets$4.vfxs).forEach(o=>{if(!t.has(o)){const i=allAssets$4.vfxs[o];i&&(typeof i.destroy=="function"&&i.destroy(),delete allAssets$4.vfxs[o])}}),e==="pathFiles"&&Object.keys(allAssets$4.pathFiles).forEach(o=>{t.has(o)||delete allAssets$4.pathFiles[o]}),e==="jsonFiles"&&Object.keys(allAssets$4.jsonFiles).forEach(o=>{t.has(o)||delete allAssets$4.jsonFiles[o]}),e==="fonts"&&Object.keys(allAssets$4.fonts).forEach(o=>{t.has(o)||allAssets$4.fonts[o]&&delete allAssets$4.fonts[o]}),e==="svgs"&&Object.keys(allAssets$4.svgs).forEach(o=>{t.has(o)||delete allAssets$4.svgs[o]}),e==="characters"&&(Object.keys(allAssets$4.characters.models).forEach(o=>{if(!t.has(o)){const i=allAssets$4.characters.models[o];i&&(i.traverse(s=>{s.isMesh&&(s.geometry.dispose(),s.material.isMaterial&&(s.material.dispose(),s.material.map&&s.material.map.dispose()))}),delete allAssets$4.characters.models[o])}}),Object.keys(allAssets$4.characters.animations).forEach(o=>{t.has(o)||delete allAssets$4.characters.animations[o]}))})}const CDN_BASE$5=(()=>{if(typeof window<"u"){if(window.ASSETS_CDN_BASE)return window.ASSETS_CDN_BASE;if(window.ASSETS_R2_ACCOUNT_ID)return`https://${window.ASSETS_R2_ACCOUNT_ID}.r2.dev`}return"https://pub-4dc5824a7d6645b29006348054fb1f3f.r2.dev"})(),isDevHost$5=()=>{if(typeof window>"u")return!1;const n=window.location.hostname;return n==="localhost"||n==="127.0.0.1"||n==="::1"||/^10\./.test(n)||/^192\.168\./.test(n)||/^172\.(1[6-9]|2[0-9]|3[0-1])\./.test(n)},toCDN$5=n=>{if(!n)return n;if(n.startsWith("/r2/")){if(isDevHost$5())return n;const e=n.replace(/^\/r2\//,"/");return CDN_BASE$5?`${CDN_BASE$5}${e}`:e}return n},assetsEntry$7={characters:[{name:"electro",path:"/characters/electro_facialv7.glb"}],models:[{name:"university",path:toCDN$5("/r2/INNOVERSE_WORLDV_12.6.glb"),shadow:!0},{name:"hoverboard",path:"/scene22/hoverboardv2.glb",shadow:!0},{name:"ufo",path:"/scene22/ufo1.glb"}],textures:[{name:"objectivesalphamap",path:"/scene22/objectivesalphamap.jpg"},{name:"baseColor",path:"/scene22/garage_door_DefaultMaterial_BaseColor.png"},{name:"normalMap",path:"/scene22/garage_door_DefaultMaterial_Normal.png"},{name:"portal",path:"/scene11/portal.png"}],videoTextures:[{name:"waterfall",path:"/scene22/waterfall3.mp4"}],audios:[{name:"background",path:"/scene22/background.mp3",volume:1,loop:!0},{name:"scene2Intro",path:"/audios/background.mp3",volume:1,loop:!1},{name:"electrofirsttrigger",path:"/audios/electrofirsttrigger.mp3",volume:1,loop:!1},{name:"electrosecondtrigger",path:"/audios/electrosecondtrigger.mp3",volume:1,loop:!1},{name:"electrothirdtrigger",path:"/audios/electrothirdtrigger.mp3",volume:1,loop:!1},{name:"hoverboard",path:"/audios/hoverboardfinal.mp3",volume:1,loop:!0}],hdris:[{name:"evening",path:toCDN$5("/r2/rosendal_plains.hdr")}],cubeMaps:[],vfxs:[{name:"entryvfx",path:"/vfxFiles/entryvfx.json"}],pathFiles:[],jsonFiles:[],fonts:[],svgs:[]},CDN_BASE$4=(()=>{if(typeof window<"u"){if(window.ASSETS_CDN_BASE)return window.ASSETS_CDN_BASE;if(window.ASSETS_R2_ACCOUNT_ID)return`https://${window.ASSETS_R2_ACCOUNT_ID}.r2.dev`}return"https://pub-4dc5824a7d6645b29006348054fb1f3f.r2.dev"})(),isDevHost$4=()=>{if(typeof window>"u")return!1;const n=window.location.hostname;return n==="localhost"||n==="127.0.0.1"||n==="::1"||/^10\./.test(n)||/^192\.168\./.test(n)||/^172\.(1[6-9]|2[0-9]|3[0-1])\./.test(n)},toCDN$4=n=>{if(n.startsWith("/r2/")){if(isDevHost$4())return n;const e=n.replace(/^\/r2\//,"/");return CDN_BASE$4?`${CDN_BASE$4}${e}`:e}return n},assetsEntry$6={characters:[{name:"zoe",path:"/characters/zoe_spec_v3 5.glb"},{name:"electro",path:"/characters/electro_facialv7.glb"},{name:"fallcharacter",path:"/characters/fallcharacter.glb"}],models:[{name:"interior",path:toCDN$4("/r2/interior_22.glb"),shadow:!0},{name:"underground",path:"/scene33/underground_path1.glb",shadow:!1},{name:"flyingBot",path:"/scene33/flyingBot1.glb",shadow:!1},{name:"robotSweeper",path:"/scene33/robotSweeper.glb",shadow:!1}],textures:[],audios:[{name:"background",path:"/audios/background.mp3",volume:.2,loop:!0},{name:"zoesound",path:"/scene33/zoe.mp3"},{name:"zoesound1",path:"/scene33/zoe2.mp3"},{name:"electrosound1",path:"/scene33/electro1.mp3"},{name:"emergency",path:"/scene33/emergency.mp3"},{name:"shakesound",path:"/scene33/island volcano erupting sfx.mp3",positional:!0},{name:"fallsound",path:"/scene33/fallsound.mp3"},{name:"zoesound11",path:"/scene33/zoe11.mp3"},{name:"electrosound2",path:"/scene33/electrosound2.mp3"},{name:"electroLookat",path:"/scene33/electroLookat1.mp3"},{name:"electroAudio4",path:"/scene33/electroAudio4.mp3"}],hdris:[{name:"skyHdr",path:"/hdris/legendium_background.hdr"}],cubeMaps:[{name:"scene2Cubemap",images:["scene33/cube_left.webp","scene33/cube_right.webp","scene33/cube_up.webp","scene33/cube_down.webp","scene33/cube_front.webp","scene33/cube_back.webp"]}],vfxs:[{name:"vfx",path:"/vfxFiles/vfx.json"},{name:"entryvfx",path:"/vfxFiles/entryvfx.json"},{name:"redzone",path:"/vfxFiles/redzone.json"}],videoTextures:[{name:"hud1",path:"/scene33/hud11.mp4"},{name:"hud2",path:"/scene33/hud11.mp4"},{name:"hudvideo",path:"/scene33/9.mp4"},{name:"hudvideo1",path:"/scene33/hudvideo3.mp4"}],pathFiles:[],jsonFiles:[{name:"path1",path:"/pathFiles/path1.json"},{name:"path2",path:"/pathFiles/path2.json"},{name:"path3",path:"/pathFiles/path3.json"},{name:"path4",path:"/pathFiles/path4.json"},{name:"path5",path:"/pathFiles/path5.json"}],fonts:[],svgs:[]};function initializePhysicsAndPlayer(n,e={position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}},t=[],o,i,s,r){n.position.set(e.position.x,e.position.y,e.position.z),n.rotation.set(e.rotation.x,e.rotation.y,e.rotation.z);let a=[];n.traverse(m=>{if(m.isMesh){let p=m,v=!1;for(;p;){if(t.includes(p.name)){v=!0;break}p=p.parent}v||a.push(m)}});let l=new StaticGeometryGenerator(a);l.attributes=["position"];let c=l.generate();c.boundsTree=new MeshBVH(c);let d=new Mesh(c,new MeshBasicMaterial({color:65280,visible:!1}));d.name="collisionmesh",d.position.copy(n.position),d.rotation.copy(n.rotation),n.collisionMesh=d,o.add(n),o.add(d),document.addEventListener("visibilitychange",()=>{if(!document.hidden&&d&&d.geometry&&(d.position.copy(n.position),d.rotation.copy(n.rotation),!d.geometry.boundsTree))try{d.geometry.boundsTree=new MeshBVH(d.geometry),console.log("Collision mesh bounds tree rebuilt successfully")}catch(m){console.error("Failed to rebuild collision mesh bounds tree:",m);let p=new StaticGeometryGenerator(a);p.attributes=["position"];let v=p.generate();v.boundsTree=new MeshBVH(v),d.geometry&&d.geometry.dispose(),d.geometry=v}});const u=initializePlayer(o,i,s,n.collisionMesh);function f(m,p=null){let v=[];if(n.traverse(w=>{w.isMesh&&!m.includes(w.name)&&v.push(w)}),v.length===0){console.warn("No meshes left for physics after removal!");return}let g=new StaticGeometryGenerator(v);g.attributes=["position"];let y=g.generate();if(y.boundsTree=new MeshBVH(y),d.geometry&&(d.geometry.boundsTree=null,d.geometry.dispose()),d.geometry=y,p){p.updateMatrixWorld(!0);let w=p.matrixWorld,_=new Vector3$1,S=new Quaternion$1,C=new Vector3$1;w.decompose(_,S,C),d.position.copy(_),d.quaternion.copy(S),d.scale.copy(C),d.updateMatrixWorld(!0)}else d.position.set(0,0,0),d.quaternion.identity(),d.scale.set(1,1,1),d.updateMatrixWorld(!0);console.log("Updated collision mesh successfully!")}function h(){n&&(o.remove(n),n.traverse(m=>{m.isMesh&&(m.geometry.dispose(),Array.isArray(m.material)?m.material.forEach(p=>p.dispose()):m.material.dispose())})),d&&(o.remove(d),l=null,c=null,d.geometry&&(d.geometry.dispose(),d.geometry.boundsTree=null),d.material&&d.material.dispose(),d=null),u.cleanUpPlayer(),n.collisionMesh=null}return{playerFunction:u,updatePhysics:f,cleanUpCollider:h}}/**
 * lil-gui
 * https://lil-gui.georgealways.com
 * @version 0.20.0
 * @author George Michael Brower
 * @license MIT
 */class Controller{constructor(e,t,o,i,s="div"){this.parent=e,this.object=t,this.property=o,this._disabled=!1,this._hidden=!1,this.initialValue=this.getValue(),this.domElement=document.createElement(s),this.domElement.classList.add("controller"),this.domElement.classList.add(i),this.$name=document.createElement("div"),this.$name.classList.add("name"),Controller.nextNameID=Controller.nextNameID||0,this.$name.id=`lil-gui-name-${++Controller.nextNameID}`,this.$widget=document.createElement("div"),this.$widget.classList.add("widget"),this.$disable=this.$widget,this.domElement.appendChild(this.$name),this.domElement.appendChild(this.$widget),this.domElement.addEventListener("keydown",r=>r.stopPropagation()),this.domElement.addEventListener("keyup",r=>r.stopPropagation()),this.parent.children.push(this),this.parent.controllers.push(this),this.parent.$children.appendChild(this.domElement),this._listenCallback=this._listenCallback.bind(this),this.name(o)}name(e){return this._name=e,this.$name.textContent=e,this}onChange(e){return this._onChange=e,this}_callOnChange(){this.parent._callOnChange(this),this._onChange!==void 0&&this._onChange.call(this,this.getValue()),this._changed=!0}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(){this._changed&&(this.parent._callOnFinishChange(this),this._onFinishChange!==void 0&&this._onFinishChange.call(this,this.getValue())),this._changed=!1}reset(){return this.setValue(this.initialValue),this._callOnFinishChange(),this}enable(e=!0){return this.disable(!e)}disable(e=!0){return e===this._disabled?this:(this._disabled=e,this.domElement.classList.toggle("disabled",e),this.$disable.toggleAttribute("disabled",e),this)}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}options(e){const t=this.parent.add(this.object,this.property,e);return t.name(this._name),this.destroy(),t}min(e){return this}max(e){return this}step(e){return this}decimals(e){return this}listen(e=!0){return this._listening=e,this._listenCallbackID!==void 0&&(cancelAnimationFrame(this._listenCallbackID),this._listenCallbackID=void 0),this._listening&&this._listenCallback(),this}_listenCallback(){this._listenCallbackID=requestAnimationFrame(this._listenCallback);const e=this.save();e!==this._listenPrevValue&&this.updateDisplay(),this._listenPrevValue=e}getValue(){return this.object[this.property]}setValue(e){return this.getValue()!==e&&(this.object[this.property]=e,this._callOnChange(),this.updateDisplay()),this}updateDisplay(){return this}load(e){return this.setValue(e),this._callOnFinishChange(),this}save(){return this.getValue()}destroy(){this.listen(!1),this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.controllers.splice(this.parent.controllers.indexOf(this),1),this.parent.$children.removeChild(this.domElement)}}class BooleanController extends Controller{constructor(e,t,o){super(e,t,o,"boolean","label"),this.$input=document.createElement("input"),this.$input.setAttribute("type","checkbox"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$widget.appendChild(this.$input),this.$input.addEventListener("change",()=>{this.setValue(this.$input.checked),this._callOnFinishChange()}),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.checked=this.getValue(),this}}function normalizeColorString(n){let e,t;return(e=n.match(/(#|0x)?([a-f0-9]{6})/i))?t=e[2]:(e=n.match(/rgb\(\s*(\d*)\s*,\s*(\d*)\s*,\s*(\d*)\s*\)/))?t=parseInt(e[1]).toString(16).padStart(2,0)+parseInt(e[2]).toString(16).padStart(2,0)+parseInt(e[3]).toString(16).padStart(2,0):(e=n.match(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i))&&(t=e[1]+e[1]+e[2]+e[2]+e[3]+e[3]),t?"#"+t:!1}const STRING={isPrimitive:!0,match:n=>typeof n=="string",fromHexString:normalizeColorString,toHexString:normalizeColorString},INT={isPrimitive:!0,match:n=>typeof n=="number",fromHexString:n=>parseInt(n.substring(1),16),toHexString:n=>"#"+n.toString(16).padStart(6,0)},ARRAY={isPrimitive:!1,match:n=>Array.isArray(n),fromHexString(n,e,t=1){const o=INT.fromHexString(n);e[0]=(o>>16&255)/255*t,e[1]=(o>>8&255)/255*t,e[2]=(o&255)/255*t},toHexString([n,e,t],o=1){o=255/o;const i=n*o<<16^e*o<<8^t*o<<0;return INT.toHexString(i)}},OBJECT={isPrimitive:!1,match:n=>Object(n)===n,fromHexString(n,e,t=1){const o=INT.fromHexString(n);e.r=(o>>16&255)/255*t,e.g=(o>>8&255)/255*t,e.b=(o&255)/255*t},toHexString({r:n,g:e,b:t},o=1){o=255/o;const i=n*o<<16^e*o<<8^t*o<<0;return INT.toHexString(i)}},FORMATS=[STRING,INT,ARRAY,OBJECT];function getColorFormat(n){return FORMATS.find(e=>e.match(n))}class ColorController extends Controller{constructor(e,t,o,i){super(e,t,o,"color"),this.$input=document.createElement("input"),this.$input.setAttribute("type","color"),this.$input.setAttribute("tabindex",-1),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$text=document.createElement("input"),this.$text.setAttribute("type","text"),this.$text.setAttribute("spellcheck","false"),this.$text.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$display.appendChild(this.$input),this.$widget.appendChild(this.$display),this.$widget.appendChild(this.$text),this._format=getColorFormat(this.initialValue),this._rgbScale=i,this._initialValueHexString=this.save(),this._textFocused=!1,this.$input.addEventListener("input",()=>{this._setValueFromHexString(this.$input.value)}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$text.addEventListener("input",()=>{const s=normalizeColorString(this.$text.value);s&&this._setValueFromHexString(s)}),this.$text.addEventListener("focus",()=>{this._textFocused=!0,this.$text.select()}),this.$text.addEventListener("blur",()=>{this._textFocused=!1,this.updateDisplay(),this._callOnFinishChange()}),this.$disable=this.$text,this.updateDisplay()}reset(){return this._setValueFromHexString(this._initialValueHexString),this}_setValueFromHexString(e){if(this._format.isPrimitive){const t=this._format.fromHexString(e);this.setValue(t)}else this._format.fromHexString(e,this.getValue(),this._rgbScale),this._callOnChange(),this.updateDisplay()}save(){return this._format.toHexString(this.getValue(),this._rgbScale)}load(e){return this._setValueFromHexString(e),this._callOnFinishChange(),this}updateDisplay(){return this.$input.value=this._format.toHexString(this.getValue(),this._rgbScale),this._textFocused||(this.$text.value=this.$input.value.substring(1)),this.$display.style.backgroundColor=this.$input.value,this}}class FunctionController extends Controller{constructor(e,t,o){super(e,t,o,"function"),this.$button=document.createElement("button"),this.$button.appendChild(this.$name),this.$widget.appendChild(this.$button),this.$button.addEventListener("click",i=>{i.preventDefault(),this.getValue().call(this.object),this._callOnChange()}),this.$button.addEventListener("touchstart",()=>{},{passive:!0}),this.$disable=this.$button}}class NumberController extends Controller{constructor(e,t,o,i,s,r){super(e,t,o,"number"),this._initInput(),this.min(i),this.max(s);const a=r!==void 0;this.step(a?r:this._getImplicitStep(),a),this.updateDisplay()}decimals(e){return this._decimals=e,this.updateDisplay(),this}min(e){return this._min=e,this._onUpdateMinMax(),this}max(e){return this._max=e,this._onUpdateMinMax(),this}step(e,t=!0){return this._step=e,this._stepExplicit=t,this}updateDisplay(){const e=this.getValue();if(this._hasSlider){let t=(e-this._min)/(this._max-this._min);t=Math.max(0,Math.min(t,1)),this.$fill.style.width=t*100+"%"}return this._inputFocused||(this.$input.value=this._decimals===void 0?e:e.toFixed(this._decimals)),this}_initInput(){this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("aria-labelledby",this.$name.id),window.matchMedia("(pointer: coarse)").matches&&(this.$input.setAttribute("type","number"),this.$input.setAttribute("step","any")),this.$widget.appendChild(this.$input),this.$disable=this.$input;const t=()=>{let y=parseFloat(this.$input.value);isNaN(y)||(this._stepExplicit&&(y=this._snap(y)),this.setValue(this._clamp(y)))},o=y=>{const w=parseFloat(this.$input.value);isNaN(w)||(this._snapClampSetValue(w+y),this.$input.value=this.getValue())},i=y=>{y.key==="Enter"&&this.$input.blur(),y.code==="ArrowUp"&&(y.preventDefault(),o(this._step*this._arrowKeyMultiplier(y))),y.code==="ArrowDown"&&(y.preventDefault(),o(this._step*this._arrowKeyMultiplier(y)*-1))},s=y=>{this._inputFocused&&(y.preventDefault(),o(this._step*this._normalizeMouseWheel(y)))};let r=!1,a,l,c,d,u;const f=5,h=y=>{a=y.clientX,l=c=y.clientY,r=!0,d=this.getValue(),u=0,window.addEventListener("mousemove",m),window.addEventListener("mouseup",p)},m=y=>{if(r){const w=y.clientX-a,_=y.clientY-l;Math.abs(_)>f?(y.preventDefault(),this.$input.blur(),r=!1,this._setDraggingStyle(!0,"vertical")):Math.abs(w)>f&&p()}if(!r){const w=y.clientY-c;u-=w*this._step*this._arrowKeyMultiplier(y),d+u>this._max?u=this._max-d:d+u<this._min&&(u=this._min-d),this._snapClampSetValue(d+u)}c=y.clientY},p=()=>{this._setDraggingStyle(!1,"vertical"),this._callOnFinishChange(),window.removeEventListener("mousemove",m),window.removeEventListener("mouseup",p)},v=()=>{this._inputFocused=!0},g=()=>{this._inputFocused=!1,this.updateDisplay(),this._callOnFinishChange()};this.$input.addEventListener("input",t),this.$input.addEventListener("keydown",i),this.$input.addEventListener("wheel",s,{passive:!1}),this.$input.addEventListener("mousedown",h),this.$input.addEventListener("focus",v),this.$input.addEventListener("blur",g)}_initSlider(){this._hasSlider=!0,this.$slider=document.createElement("div"),this.$slider.classList.add("slider"),this.$fill=document.createElement("div"),this.$fill.classList.add("fill"),this.$slider.appendChild(this.$fill),this.$widget.insertBefore(this.$slider,this.$input),this.domElement.classList.add("hasSlider");const e=(g,y,w,_,S)=>(g-y)/(w-y)*(S-_)+_,t=g=>{const y=this.$slider.getBoundingClientRect();let w=e(g,y.left,y.right,this._min,this._max);this._snapClampSetValue(w)},o=g=>{this._setDraggingStyle(!0),t(g.clientX),window.addEventListener("mousemove",i),window.addEventListener("mouseup",s)},i=g=>{t(g.clientX)},s=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",s)};let r=!1,a,l;const c=g=>{g.preventDefault(),this._setDraggingStyle(!0),t(g.touches[0].clientX),r=!1},d=g=>{g.touches.length>1||(this._hasScrollBar?(a=g.touches[0].clientX,l=g.touches[0].clientY,r=!0):c(g),window.addEventListener("touchmove",u,{passive:!1}),window.addEventListener("touchend",f))},u=g=>{if(r){const y=g.touches[0].clientX-a,w=g.touches[0].clientY-l;Math.abs(y)>Math.abs(w)?c(g):(window.removeEventListener("touchmove",u),window.removeEventListener("touchend",f))}else g.preventDefault(),t(g.touches[0].clientX)},f=()=>{this._callOnFinishChange(),this._setDraggingStyle(!1),window.removeEventListener("touchmove",u),window.removeEventListener("touchend",f)},h=this._callOnFinishChange.bind(this),m=400;let p;const v=g=>{if(Math.abs(g.deltaX)<Math.abs(g.deltaY)&&this._hasScrollBar)return;g.preventDefault();const w=this._normalizeMouseWheel(g)*this._step;this._snapClampSetValue(this.getValue()+w),this.$input.value=this.getValue(),clearTimeout(p),p=setTimeout(h,m)};this.$slider.addEventListener("mousedown",o),this.$slider.addEventListener("touchstart",d,{passive:!1}),this.$slider.addEventListener("wheel",v,{passive:!1})}_setDraggingStyle(e,t="horizontal"){this.$slider&&this.$slider.classList.toggle("active",e),document.body.classList.toggle("lil-gui-dragging",e),document.body.classList.toggle(`lil-gui-${t}`,e)}_getImplicitStep(){return this._hasMin&&this._hasMax?(this._max-this._min)/1e3:.1}_onUpdateMinMax(){!this._hasSlider&&this._hasMin&&this._hasMax&&(this._stepExplicit||this.step(this._getImplicitStep(),!1),this._initSlider(),this.updateDisplay())}_normalizeMouseWheel(e){let{deltaX:t,deltaY:o}=e;return Math.floor(e.deltaY)!==e.deltaY&&e.wheelDelta&&(t=0,o=-e.wheelDelta/120,o*=this._stepExplicit?1:10),t+-o}_arrowKeyMultiplier(e){let t=this._stepExplicit?1:10;return e.shiftKey?t*=10:e.altKey&&(t/=10),t}_snap(e){let t=0;return this._hasMin?t=this._min:this._hasMax&&(t=this._max),e-=t,e=Math.round(e/this._step)*this._step,e+=t,e=parseFloat(e.toPrecision(15)),e}_clamp(e){return e<this._min&&(e=this._min),e>this._max&&(e=this._max),e}_snapClampSetValue(e){this.setValue(this._clamp(this._snap(e)))}get _hasScrollBar(){const e=this.parent.root.$children;return e.scrollHeight>e.clientHeight}get _hasMin(){return this._min!==void 0}get _hasMax(){return this._max!==void 0}}class OptionController extends Controller{constructor(e,t,o,i){super(e,t,o,"option"),this.$select=document.createElement("select"),this.$select.setAttribute("aria-labelledby",this.$name.id),this.$display=document.createElement("div"),this.$display.classList.add("display"),this.$select.addEventListener("change",()=>{this.setValue(this._values[this.$select.selectedIndex]),this._callOnFinishChange()}),this.$select.addEventListener("focus",()=>{this.$display.classList.add("focus")}),this.$select.addEventListener("blur",()=>{this.$display.classList.remove("focus")}),this.$widget.appendChild(this.$select),this.$widget.appendChild(this.$display),this.$disable=this.$select,this.options(i)}options(e){return this._values=Array.isArray(e)?e:Object.values(e),this._names=Array.isArray(e)?e:Object.keys(e),this.$select.replaceChildren(),this._names.forEach(t=>{const o=document.createElement("option");o.textContent=t,this.$select.appendChild(o)}),this.updateDisplay(),this}updateDisplay(){const e=this.getValue(),t=this._values.indexOf(e);return this.$select.selectedIndex=t,this.$display.textContent=t===-1?e:this._names[t],this}}class StringController extends Controller{constructor(e,t,o){super(e,t,o,"string"),this.$input=document.createElement("input"),this.$input.setAttribute("type","text"),this.$input.setAttribute("spellcheck","false"),this.$input.setAttribute("aria-labelledby",this.$name.id),this.$input.addEventListener("input",()=>{this.setValue(this.$input.value)}),this.$input.addEventListener("keydown",i=>{i.code==="Enter"&&this.$input.blur()}),this.$input.addEventListener("blur",()=>{this._callOnFinishChange()}),this.$widget.appendChild(this.$input),this.$disable=this.$input,this.updateDisplay()}updateDisplay(){return this.$input.value=this.getValue(),this}}var stylesheet=`.lil-gui {
  font-family: var(--font-family);
  font-size: var(--font-size);
  line-height: 1;
  font-weight: normal;
  font-style: normal;
  text-align: left;
  color: var(--text-color);
  user-select: none;
  -webkit-user-select: none;
  touch-action: manipulation;
  --background-color: #1f1f1f;
  --text-color: #ebebeb;
  --title-background-color: #111111;
  --title-text-color: #ebebeb;
  --widget-color: #424242;
  --hover-color: #4f4f4f;
  --focus-color: #595959;
  --number-color: #2cc9ff;
  --string-color: #a2db3c;
  --font-size: 11px;
  --input-font-size: 11px;
  --font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
  --font-family-mono: Menlo, Monaco, Consolas, "Droid Sans Mono", monospace;
  --padding: 4px;
  --spacing: 4px;
  --widget-height: 20px;
  --title-height: calc(var(--widget-height) + var(--spacing) * 1.25);
  --name-width: 45%;
  --slider-knob-width: 2px;
  --slider-input-width: 27%;
  --color-input-width: 27%;
  --slider-input-min-width: 45px;
  --color-input-min-width: 45px;
  --folder-indent: 7px;
  --widget-padding: 0 0 0 3px;
  --widget-border-radius: 2px;
  --checkbox-size: calc(0.75 * var(--widget-height));
  --scrollbar-width: 5px;
}
.lil-gui, .lil-gui * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}
.lil-gui.root {
  width: var(--width, 245px);
  display: flex;
  flex-direction: column;
  background: var(--background-color);
}
.lil-gui.root > .title {
  background: var(--title-background-color);
  color: var(--title-text-color);
}
.lil-gui.root > .children {
  overflow-x: hidden;
  overflow-y: auto;
}
.lil-gui.root > .children::-webkit-scrollbar {
  width: var(--scrollbar-width);
  height: var(--scrollbar-width);
  background: var(--background-color);
}
.lil-gui.root > .children::-webkit-scrollbar-thumb {
  border-radius: var(--scrollbar-width);
  background: var(--focus-color);
}
@media (pointer: coarse) {
  .lil-gui.allow-touch-styles, .lil-gui.allow-touch-styles .lil-gui {
    --widget-height: 28px;
    --padding: 6px;
    --spacing: 6px;
    --font-size: 13px;
    --input-font-size: 16px;
    --folder-indent: 10px;
    --scrollbar-width: 7px;
    --slider-input-min-width: 50px;
    --color-input-min-width: 65px;
  }
}
.lil-gui.force-touch-styles, .lil-gui.force-touch-styles .lil-gui {
  --widget-height: 28px;
  --padding: 6px;
  --spacing: 6px;
  --font-size: 13px;
  --input-font-size: 16px;
  --folder-indent: 10px;
  --scrollbar-width: 7px;
  --slider-input-min-width: 50px;
  --color-input-min-width: 65px;
}
.lil-gui.autoPlace {
  max-height: 100%;
  position: fixed;
  top: 0;
  right: 15px;
  z-index: 1001;
}

.lil-gui .controller {
  display: flex;
  align-items: center;
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
}
.lil-gui .controller.disabled {
  opacity: 0.5;
}
.lil-gui .controller.disabled, .lil-gui .controller.disabled * {
  pointer-events: none !important;
}
.lil-gui .controller > .name {
  min-width: var(--name-width);
  flex-shrink: 0;
  white-space: pre;
  padding-right: var(--spacing);
  line-height: var(--widget-height);
}
.lil-gui .controller .widget {
  position: relative;
  display: flex;
  align-items: center;
  width: 100%;
  min-height: var(--widget-height);
}
.lil-gui .controller.string input {
  color: var(--string-color);
}
.lil-gui .controller.boolean {
  cursor: pointer;
}
.lil-gui .controller.color .display {
  width: 100%;
  height: var(--widget-height);
  border-radius: var(--widget-border-radius);
  position: relative;
}
@media (hover: hover) {
  .lil-gui .controller.color .display:hover:before {
    content: " ";
    display: block;
    position: absolute;
    border-radius: var(--widget-border-radius);
    border: 1px solid #fff9;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
  }
}
.lil-gui .controller.color input[type=color] {
  opacity: 0;
  width: 100%;
  height: 100%;
  cursor: pointer;
}
.lil-gui .controller.color input[type=text] {
  margin-left: var(--spacing);
  font-family: var(--font-family-mono);
  min-width: var(--color-input-min-width);
  width: var(--color-input-width);
  flex-shrink: 0;
}
.lil-gui .controller.option select {
  opacity: 0;
  position: absolute;
  width: 100%;
  max-width: 100%;
}
.lil-gui .controller.option .display {
  position: relative;
  pointer-events: none;
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  line-height: var(--widget-height);
  max-width: 100%;
  overflow: hidden;
  word-break: break-all;
  padding-left: 0.55em;
  padding-right: 1.75em;
  background: var(--widget-color);
}
@media (hover: hover) {
  .lil-gui .controller.option .display.focus {
    background: var(--focus-color);
  }
}
.lil-gui .controller.option .display.active {
  background: var(--focus-color);
}
.lil-gui .controller.option .display:after {
  font-family: "lil-gui";
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  padding-right: 0.375em;
}
.lil-gui .controller.option .widget,
.lil-gui .controller.option select {
  cursor: pointer;
}
@media (hover: hover) {
  .lil-gui .controller.option .widget:hover .display {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number input {
  color: var(--number-color);
}
.lil-gui .controller.number.hasSlider input {
  margin-left: var(--spacing);
  width: var(--slider-input-width);
  min-width: var(--slider-input-min-width);
  flex-shrink: 0;
}
.lil-gui .controller.number .slider {
  width: 100%;
  height: var(--widget-height);
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
  padding-right: var(--slider-knob-width);
  overflow: hidden;
  cursor: ew-resize;
  touch-action: pan-y;
}
@media (hover: hover) {
  .lil-gui .controller.number .slider:hover {
    background: var(--hover-color);
  }
}
.lil-gui .controller.number .slider.active {
  background: var(--focus-color);
}
.lil-gui .controller.number .slider.active .fill {
  opacity: 0.95;
}
.lil-gui .controller.number .fill {
  height: 100%;
  border-right: var(--slider-knob-width) solid var(--number-color);
  box-sizing: content-box;
}

.lil-gui-dragging .lil-gui {
  --hover-color: var(--widget-color);
}
.lil-gui-dragging * {
  cursor: ew-resize !important;
}

.lil-gui-dragging.lil-gui-vertical * {
  cursor: ns-resize !important;
}

.lil-gui .title {
  height: var(--title-height);
  font-weight: 600;
  padding: 0 var(--padding);
  width: 100%;
  text-align: left;
  background: none;
  text-decoration-skip: objects;
}
.lil-gui .title:before {
  font-family: "lil-gui";
  content: "";
  padding-right: 2px;
  display: inline-block;
}
.lil-gui .title:active {
  background: var(--title-background-color);
  opacity: 0.75;
}
@media (hover: hover) {
  body:not(.lil-gui-dragging) .lil-gui .title:hover {
    background: var(--title-background-color);
    opacity: 0.85;
  }
  .lil-gui .title:focus {
    text-decoration: underline var(--focus-color);
  }
}
.lil-gui.root > .title:focus {
  text-decoration: none !important;
}
.lil-gui.closed > .title:before {
  content: "";
}
.lil-gui.closed > .children {
  transform: translateY(-7px);
  opacity: 0;
}
.lil-gui.closed:not(.transition) > .children {
  display: none;
}
.lil-gui.transition > .children {
  transition-duration: 300ms;
  transition-property: height, opacity, transform;
  transition-timing-function: cubic-bezier(0.2, 0.6, 0.35, 1);
  overflow: hidden;
  pointer-events: none;
}
.lil-gui .children:empty:before {
  content: "Empty";
  padding: 0 var(--padding);
  margin: var(--spacing) 0;
  display: block;
  height: var(--widget-height);
  font-style: italic;
  line-height: var(--widget-height);
  opacity: 0.5;
}
.lil-gui.root > .children > .lil-gui > .title {
  border: 0 solid var(--widget-color);
  border-width: 1px 0;
  transition: border-color 300ms;
}
.lil-gui.root > .children > .lil-gui.closed > .title {
  border-bottom-color: transparent;
}
.lil-gui + .controller {
  border-top: 1px solid var(--widget-color);
  margin-top: 0;
  padding-top: var(--spacing);
}
.lil-gui .lil-gui .lil-gui > .title {
  border: none;
}
.lil-gui .lil-gui .lil-gui > .children {
  border: none;
  margin-left: var(--folder-indent);
  border-left: 2px solid var(--widget-color);
}
.lil-gui .lil-gui .controller {
  border: none;
}

.lil-gui label, .lil-gui input, .lil-gui button {
  -webkit-tap-highlight-color: transparent;
}
.lil-gui input {
  border: 0;
  outline: none;
  font-family: var(--font-family);
  font-size: var(--input-font-size);
  border-radius: var(--widget-border-radius);
  height: var(--widget-height);
  background: var(--widget-color);
  color: var(--text-color);
  width: 100%;
}
@media (hover: hover) {
  .lil-gui input:hover {
    background: var(--hover-color);
  }
  .lil-gui input:active {
    background: var(--focus-color);
  }
}
.lil-gui input:disabled {
  opacity: 1;
}
.lil-gui input[type=text],
.lil-gui input[type=number] {
  padding: var(--widget-padding);
  -moz-appearance: textfield;
}
.lil-gui input[type=text]:focus,
.lil-gui input[type=number]:focus {
  background: var(--focus-color);
}
.lil-gui input[type=checkbox] {
  appearance: none;
  width: var(--checkbox-size);
  height: var(--checkbox-size);
  border-radius: var(--widget-border-radius);
  text-align: center;
  cursor: pointer;
}
.lil-gui input[type=checkbox]:checked:before {
  font-family: "lil-gui";
  content: "";
  font-size: var(--checkbox-size);
  line-height: var(--checkbox-size);
}
@media (hover: hover) {
  .lil-gui input[type=checkbox]:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui button {
  outline: none;
  cursor: pointer;
  font-family: var(--font-family);
  font-size: var(--font-size);
  color: var(--text-color);
  width: 100%;
  border: none;
}
.lil-gui .controller button {
  height: var(--widget-height);
  text-transform: none;
  background: var(--widget-color);
  border-radius: var(--widget-border-radius);
}
@media (hover: hover) {
  .lil-gui .controller button:hover {
    background: var(--hover-color);
  }
  .lil-gui .controller button:focus {
    box-shadow: inset 0 0 0 1px var(--focus-color);
  }
}
.lil-gui .controller button:active {
  background: var(--focus-color);
}

@font-face {
  font-family: "lil-gui";
  src: url("data:application/font-woff;charset=utf-8;base64,d09GRgABAAAAAAUsAAsAAAAACJwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABCAAAAH4AAADAImwmYE9TLzIAAAGIAAAAPwAAAGBKqH5SY21hcAAAAcgAAAD0AAACrukyyJBnbHlmAAACvAAAAF8AAACEIZpWH2hlYWQAAAMcAAAAJwAAADZfcj2zaGhlYQAAA0QAAAAYAAAAJAC5AHhobXR4AAADXAAAABAAAABMAZAAAGxvY2EAAANsAAAAFAAAACgCEgIybWF4cAAAA4AAAAAeAAAAIAEfABJuYW1lAAADoAAAASIAAAIK9SUU/XBvc3QAAATEAAAAZgAAAJCTcMc2eJxVjbEOgjAURU+hFRBK1dGRL+ALnAiToyMLEzFpnPz/eAshwSa97517c/MwwJmeB9kwPl+0cf5+uGPZXsqPu4nvZabcSZldZ6kfyWnomFY/eScKqZNWupKJO6kXN3K9uCVoL7iInPr1X5baXs3tjuMqCtzEuagm/AAlzQgPAAB4nGNgYRBlnMDAysDAYM/gBiT5oLQBAwuDJAMDEwMrMwNWEJDmmsJwgCFeXZghBcjlZMgFCzOiKOIFAB71Bb8AeJy1kjFuwkAQRZ+DwRAwBtNQRUGKQ8OdKCAWUhAgKLhIuAsVSpWz5Bbkj3dEgYiUIszqWdpZe+Z7/wB1oCYmIoboiwiLT2WjKl/jscrHfGg/pKdMkyklC5Zs2LEfHYpjcRoPzme9MWWmk3dWbK9ObkWkikOetJ554fWyoEsmdSlt+uR0pCJR34b6t/TVg1SY3sYvdf8vuiKrpyaDXDISiegp17p7579Gp3p++y7HPAiY9pmTibljrr85qSidtlg4+l25GLCaS8e6rRxNBmsnERunKbaOObRz7N72ju5vdAjYpBXHgJylOAVsMseDAPEP8LYoUHicY2BiAAEfhiAGJgZWBgZ7RnFRdnVJELCQlBSRlATJMoLV2DK4glSYs6ubq5vbKrJLSbGrgEmovDuDJVhe3VzcXFwNLCOILB/C4IuQ1xTn5FPilBTj5FPmBAB4WwoqAHicY2BkYGAA4sk1sR/j+W2+MnAzpDBgAyEMQUCSg4EJxAEAwUgFHgB4nGNgZGBgSGFggJMhDIwMqEAYAByHATJ4nGNgAIIUNEwmAABl3AGReJxjYAACIQYlBiMGJ3wQAEcQBEV4nGNgZGBgEGZgY2BiAAEQyQWEDAz/wXwGAAsPATIAAHicXdBNSsNAHAXwl35iA0UQXYnMShfS9GPZA7T7LgIu03SSpkwzYTIt1BN4Ak/gKTyAeCxfw39jZkjymzcvAwmAW/wgwHUEGDb36+jQQ3GXGot79L24jxCP4gHzF/EIr4jEIe7wxhOC3g2TMYy4Q7+Lu/SHuEd/ivt4wJd4wPxbPEKMX3GI5+DJFGaSn4qNzk8mcbKSR6xdXdhSzaOZJGtdapd4vVPbi6rP+cL7TGXOHtXKll4bY1Xl7EGnPtp7Xy2n00zyKLVHfkHBa4IcJ2oD3cgggWvt/V/FbDrUlEUJhTn/0azVWbNTNr0Ens8de1tceK9xZmfB1CPjOmPH4kitmvOubcNpmVTN3oFJyjzCvnmrwhJTzqzVj9jiSX911FjeAAB4nG3HMRKCMBBA0f0giiKi4DU8k0V2GWbIZDOh4PoWWvq6J5V8If9NVNQcaDhyouXMhY4rPTcG7jwYmXhKq8Wz+p762aNaeYXom2n3m2dLTVgsrCgFJ7OTmIkYbwIbC6vIB7WmFfAAAA==") format("woff");
}`;function _injectStyles(n){const e=document.createElement("style");e.innerHTML=n;const t=document.querySelector("head link[rel=stylesheet], head style");t?document.head.insertBefore(e,t):document.head.appendChild(e)}let stylesInjected=!1;class GUI{constructor({parent:e,autoPlace:t=e===void 0,container:o,width:i,title:s="Controls",closeFolders:r=!1,injectStyles:a=!0,touchStyles:l=!0}={}){if(this.parent=e,this.root=e?e.root:this,this.children=[],this.controllers=[],this.folders=[],this._closed=!1,this._hidden=!1,this.domElement=document.createElement("div"),this.domElement.classList.add("lil-gui"),this.$title=document.createElement("button"),this.$title.classList.add("title"),this.$title.setAttribute("aria-expanded",!0),this.$title.addEventListener("click",()=>this.openAnimated(this._closed)),this.$title.addEventListener("touchstart",()=>{},{passive:!0}),this.$children=document.createElement("div"),this.$children.classList.add("children"),this.domElement.appendChild(this.$title),this.domElement.appendChild(this.$children),this.title(s),this.parent){this.parent.children.push(this),this.parent.folders.push(this),this.parent.$children.appendChild(this.domElement);return}this.domElement.classList.add("root"),l&&this.domElement.classList.add("allow-touch-styles"),!stylesInjected&&a&&(_injectStyles(stylesheet),stylesInjected=!0),o?o.appendChild(this.domElement):t&&(this.domElement.classList.add("autoPlace"),document.body.appendChild(this.domElement)),i&&this.domElement.style.setProperty("--width",i+"px"),this._closeFolders=r}add(e,t,o,i,s){if(Object(o)===o)return new OptionController(this,e,t,o);const r=e[t];switch(typeof r){case"number":return new NumberController(this,e,t,o,i,s);case"boolean":return new BooleanController(this,e,t);case"string":return new StringController(this,e,t);case"function":return new FunctionController(this,e,t)}console.error(`gui.add failed
	property:`,t,`
	object:`,e,`
	value:`,r)}addColor(e,t,o=1){return new ColorController(this,e,t,o)}addFolder(e){const t=new GUI({parent:this,title:e});return this.root._closeFolders&&t.close(),t}load(e,t=!0){return e.controllers&&this.controllers.forEach(o=>{o instanceof FunctionController||o._name in e.controllers&&o.load(e.controllers[o._name])}),t&&e.folders&&this.folders.forEach(o=>{o._title in e.folders&&o.load(e.folders[o._title])}),this}save(e=!0){const t={controllers:{},folders:{}};return this.controllers.forEach(o=>{if(!(o instanceof FunctionController)){if(o._name in t.controllers)throw new Error(`Cannot save GUI with duplicate property "${o._name}"`);t.controllers[o._name]=o.save()}}),e&&this.folders.forEach(o=>{if(o._title in t.folders)throw new Error(`Cannot save GUI with duplicate folder "${o._title}"`);t.folders[o._title]=o.save()}),t}open(e=!0){return this._setClosed(!e),this.$title.setAttribute("aria-expanded",!this._closed),this.domElement.classList.toggle("closed",this._closed),this}close(){return this.open(!1)}_setClosed(e){this._closed!==e&&(this._closed=e,this._callOnOpenClose(this))}show(e=!0){return this._hidden=!e,this.domElement.style.display=this._hidden?"none":"",this}hide(){return this.show(!1)}openAnimated(e=!0){return this._setClosed(!e),this.$title.setAttribute("aria-expanded",!this._closed),requestAnimationFrame(()=>{const t=this.$children.clientHeight;this.$children.style.height=t+"px",this.domElement.classList.add("transition");const o=s=>{s.target===this.$children&&(this.$children.style.height="",this.domElement.classList.remove("transition"),this.$children.removeEventListener("transitionend",o))};this.$children.addEventListener("transitionend",o);const i=e?this.$children.scrollHeight:0;this.domElement.classList.toggle("closed",!e),requestAnimationFrame(()=>{this.$children.style.height=i+"px"})}),this}title(e){return this._title=e,this.$title.textContent=e,this}reset(e=!0){return(e?this.controllersRecursive():this.controllers).forEach(o=>o.reset()),this}onChange(e){return this._onChange=e,this}_callOnChange(e){this.parent&&this.parent._callOnChange(e),this._onChange!==void 0&&this._onChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onFinishChange(e){return this._onFinishChange=e,this}_callOnFinishChange(e){this.parent&&this.parent._callOnFinishChange(e),this._onFinishChange!==void 0&&this._onFinishChange.call(this,{object:e.object,property:e.property,value:e.getValue(),controller:e})}onOpenClose(e){return this._onOpenClose=e,this}_callOnOpenClose(e){this.parent&&this.parent._callOnOpenClose(e),this._onOpenClose!==void 0&&this._onOpenClose.call(this,e)}destroy(){this.parent&&(this.parent.children.splice(this.parent.children.indexOf(this),1),this.parent.folders.splice(this.parent.folders.indexOf(this),1)),this.domElement.parentElement&&this.domElement.parentElement.removeChild(this.domElement),Array.from(this.children).forEach(e=>e.destroy())}controllersRecursive(){let e=Array.from(this.controllers);return this.folders.forEach(t=>{e=e.concat(t.controllersRecursive())}),e}foldersRecursive(){let e=Array.from(this.folders);return this.folders.forEach(t=>{e=e.concat(t.foldersRecursive())}),e}}let currentGUI=null;function createGUI(){return currentGUI&&currentGUI.destroy(),currentGUI=new GUI,currentGUI}function destroyGUI(){currentGUI&&(currentGUI.destroy(),currentGUI=null)}let raycaster,tempMatrix,controller1,controller2,rayLine1,rayLine2,isInitialized=!1;function setupVRRaycaster(n,e,t,o){raycaster=new Raycaster,tempMatrix=new Matrix4$1;const i=new BufferGeometry().setFromPoints([new Vector3$1(0,0,0),new Vector3$1(0,0,-5)]),s=new LineBasicMaterial({color:16711680,linewidth:5});rayLine1=new Line(i,s),rayLine2=new Line(i,s);function r(){try{controller1=e.xr.getController(0),controller2=e.xr.getController(1),controller1&&controller2?(controller1.addEventListener("select",a),controller2.addEventListener("select",a),n.add(controller1),n.add(controller2),controller1.add(rayLine1),controller2.add(rayLine2),isInitialized=!0,console.log("VR Controllers initialized successfully")):(console.warn("VR Controllers not available yet"),requestAnimationFrame(r))}catch(l){console.error("Error initializing VR controllers:",l),requestAnimationFrame(r)}}r();function a(l){var d;const c=l.target;if(!(!c||!c.matrixWorld)){tempMatrix.identity().extractRotation(c.matrixWorld),raycaster.ray.origin.setFromMatrixPosition(c.matrixWorld),raycaster.ray.direction.set(0,0,-1).applyMatrix4(tempMatrix);try{let u=[...t];window.vrClickableObjects&&Array.isArray(window.vrClickableObjects)&&(u=[...u,...window.vrClickableObjects]),u.forEach(h=>{h.userData&&h.userData.componentKey&&h.traverse(m=>{m.isMesh&&u.push(m)})});const f=raycaster.intersectObjects(u,!0);if(f.length>0){const h=f[0].object;console.log("VR Intersection detected:",h.name);let m=h;for(;m&&!((d=m.userData)!=null&&d.onClick);)m=m.parent;m&&m.userData&&m.userData.onClick?m.userData.onClick():o&&o(h)}else console.log("No VR intersection detected")}catch(u){console.error("Error in VR onSelect:",u)}}}}function updateVRRaycaster(n){if(!isInitialized||!controller1||!controller2||!Array.isArray(n)||n.length===0)return;const e=n.filter(o=>!o||!o.layers?!1:(o.layers.mask||(o.layers.mask=1),!0));if(e.length===0)return;let t=[...e];window.vrClickableObjects&&Array.isArray(window.vrClickableObjects)&&(t=[...t,...window.vrClickableObjects]),[controller1,controller2].forEach(o=>{try{if(!o||!o.matrixWorld)return;tempMatrix.identity().extractRotation(o.matrixWorld),raycaster.ray.origin.setFromMatrixPosition(o.matrixWorld),raycaster.ray.direction.set(0,0,-1).applyMatrix4(tempMatrix),raycaster.layers.mask=1;let i=[...t];t.forEach(r=>{r.userData&&r.userData.componentKey&&r.traverse(a=>{a.isMesh&&i.push(a)})});const s=raycaster.intersectObjects(i,!0);if(s.length>0){if(o.children&&o.children.length>0){const r=o.children[0];r&&r.material&&(r.material.color.setHex(65280),r.material.opacity=.8)}console.log("VR Ray intersecting with:",s[0].object.name)}else if(o.children&&o.children.length>0){const r=o.children[0];r&&r.material&&(r.material.color.setHex(16711680),r.material.opacity=.5)}}catch(i){console.error("Error updating VR raycaster:",i)}})}function setupVR(n,e,t,o,i,s,r){new Raycaster,new Matrix4$1;const a=new Vector3$1(0,1.45,0),{actionIdle:l,actionWalk:c,actionRun:d,currentAction:u}=i||{actionIdle:null,actionWalk:null,actionRun:null,currentAction:null};let f,h,m,p,v,g=!1,y=!0;const w=new Clock;let _="idle",S;function C(){try{const $=new XRControllerModelFactory;f=n.xr.getController(0),f&&(e.add(f),m=n.xr.getControllerGrip(0),m.add($.createControllerModel(m)),e.add(m)),h=n.xr.getController(1),h&&(e.add(h),p=n.xr.getControllerGrip(1),p.add($.createControllerModel(p)),e.add(p)),setupVRRaycaster(e,n,s,r),g=!0,console.log("VR setup completed successfully")}catch($){console.error("Error setting up VR controllers:",$)}}function A($,T){const D=Math.PI/86;if($||T){const P=D*($?1:-1);n.xr.isPresenting?(v.rotation.y+=P,o.rotation.y=v.rotation.y):o.rotation.y+=P}}function E($,T,D){const B=D?4.8:2.4,b=new Vector3$1,z=Math.min(w.getDelta(),.1);if(t.getWorldDirection(b),b.y=0,b.normalize(),!$&&!T)playerState.velocity.x=0,playerState.velocity.z=0,l&&_!=="idle"&&(k(l),_="idle");else{const N=b.multiplyScalar(B*($?1:-1)*z);playerState.velocity.x=N.x,playerState.velocity.z=N.z,o.position.x+=N.x,o.position.z+=N.z,D&&d?_!=="sprint"&&(k(d),_="sprint"):c&&_!=="walk"&&(k(c),_="walk")}playerState.onGround?playerState.velocity.y=0:(playerState.velocity.y+=-9.8*z,o.position.y+=playerState.velocity.y*z)}function k($){$&&$!==i.currentAction&&(i.currentAction&&i.currentAction.fadeOut(.2),$.reset().fadeIn(.2).play(),i.currentAction=$)}function I(){if(!g||!y)return;console.log("Updating VR controls");const $=n.xr.getSession();if($)try{let T=!1,D=!1,P=!1,L=!1,B=!1,b=0,z=0;$.inputSources.forEach(N=>{if(N.gamepad){const K=N.gamepad.axes;K.length>=4&&(N.handedness==="right"?(z=K[3],z<-.5&&(T=!0),z>.5&&(D=!0)):N.handedness==="left"&&(b=K[3],K[2]<-.5&&(P=!0),K[2]>.5&&(L=!0)))}}),(T&&b<-.5&&z<-.5||D&&b>.5&&z>.5)&&(B=!0),playerState.onGround||(playerState.velocity.y+=-9.8*.01),E(T,D,B),A(P,L),updateVRRaycaster(s),S&&S.update()}catch(T){console.error("Error updating VR controls:",T)}}function F(){y=!0,f&&(f.visible=!0),h&&(h.visible=!0),m&&(m.visible=!0),p&&(p.visible=!0)}function M(){y=!1,f&&(f.visible=!1),h&&(h.visible=!1),m&&(m.visible=!1),p&&(p.visible=!1),playerState.velocity.set(0,0,0),playerState.fwdPressed=!1,playerState.bkdPressed=!1,playerState.lftPressed=!1,playerState.rgtPressed=!1,playerState.shiftPressed=!1}function R(){try{C(),v=new Group,v.position.set(0,-1.45,0),t&&v.add(t),f&&v.add(f),h&&v.add(h),m&&v.add(m),p&&v.add(p),o.add(v),t.position.copy(a),togglePlayerControls(!1),o.traverse($=>{$.isMesh&&($.visible=!1)}),o.visible=!0,o.material&&(o.material.visible=!1),f&&(f.visible=!0),h&&(h.visible=!0),m&&(m.visible=!0),p&&(p.visible=!0),w.start()}catch($){console.error("Error enabling VR:",$)}}function O(){try{v&&(o.remove(v),v.remove(t),f&&v.remove(f),h&&v.remove(h),m&&v.remove(m),p&&v.remove(p),e.add(t)),f&&e.remove(f),h&&e.remove(h),m&&e.remove(m),p&&e.remove(p),togglePlayerControls(!0),o.traverse($=>{$.isMesh&&($.visible=!0)}),o.visible=!0,o.material&&(o.material.visible=!0),t.position.set(0,0,0),v=null,S&&(S.remove(),S=null),g=!1}catch($){console.error("Error disabling VR:",$)}}return{updateVRControls:I,enableVR:R,disableVR:O,enableVRControls:F,disableVRControls:M}}let currentRenderer=null,currentScene$5=null,currentCamera$5=null,currentPlayer$1=null,currentCollisionMesh=null,currentClock=null,vrControls=null,isVRMode$1=!1;function initializeVR(n,e,t,o,i,s,r){return currentRenderer=n,currentScene$5=e,currentCamera$5=t,currentPlayer$1=o,currentClock=new Clock,currentRenderer.xr.enabled=!0,document.body.appendChild(VRButton.createButton(currentRenderer)),vrControls=setupVR(currentRenderer,currentScene$5,currentCamera$5,currentPlayer$1,i,s,r),currentRenderer.xr.addEventListener("sessionstart",()=>{isVRMode$1=!0,vrControls&&vrControls.enableVR()}),currentRenderer.xr.addEventListener("sessionend",()=>{isVRMode$1=!1,vrControls&&vrControls.disableVR()}),vrControls}function updateVR(){if(!isVRMode$1||!vrControls)return;const n=currentClock.getDelta();vrControls.updateVRControls(),currentPlayer$1&&currentCollisionMesh&&(currentPlayer$1.updateMatrixWorld(),handleCollisions(currentPlayer$1,currentCollisionMesh,playerState.velocity,n),playerState.velocity.length()>0&&(currentPlayer$1.position.x+=playerState.velocity.x*n,currentPlayer$1.position.z+=playerState.velocity.z*n,playerState.onGround||(currentPlayer$1.position.y+=playerState.velocity.y*n)))}function cleanupVR(){if(currentRenderer){const n=currentRenderer.xr.getSession();n&&n.end()}vrControls&&(vrControls.disableVR(),vrControls=null),currentRenderer=null,currentScene$5=null,currentCamera$5=null,currentPlayer$1=null,currentCollisionMesh=null,currentClock=null,isVRMode$1=!1}function getVRControls(){return vrControls}function enablePlayerMovement(n){n&&(n.userData.movementEnabled=!0)}function disablePlayerMovement(n){n&&(n.userData.movementEnabled=!1)}function setCollisionMesh(n){currentCollisionMesh=n}function TriggerPoint(n,e,t,o=null,i,s=!1,r=2e3){let a=!1,l=null;try{l=new Audio("audios/triggerpoint.mp3"),l.loop=!1,l.preload="auto",l.crossOrigin="anonymous",l.volume=1}catch{}let c=null;n&&(c=new BatchedRenderer,t.add(c));const d=o?o.x:1,u=o?o.y:1;let f=new Mesh(new CylinderGeometry(d,d,u,32),new MeshBasicMaterial({transparent:!0,opacity:0}));t.add(f),f.position.set(e.x,e.y,e.z),o&&f.scale.set(o.x,o.y,o.z);let h=null;if(n){if(h=n.clone(),h&&h.children&&h.children.length>1&&(h.children=h.children.filter(S=>S.rotation&&Math.abs(Math.abs(S.rotation.x)-Math.PI/2)<.01),h&&h.children.length>1))for(let S=h.children.length-1;S>=0;S--)(!h.children[S].rotation||Math.abs(Math.abs(h.children[S].rotation.x)-Math.PI/2)>=.01)&&h.remove(h.children[S]);h&&(QuarksUtil.addToBatchRenderer(h,c),t.add(h),o?h.scale.set(o.x,o.y,o.z):h.scale.set(1,1,1),h.position.set(e.x,e.y,e.z))}h&&h.material&&(h.material.depthWrite=!1,h.material.depthTest=!1,h.material.transparent=!0,h.material.blending=AdditiveBlending),f.material.visible=!1,f.material.transparent=!0,f.material.opacity=0,f.material.depthWrite=!1,f.material.depthTest=!1;let m=!1,p=!1,v=!1;const g=new Vector3$1;function y(S,C){if(c&&h&&c.update(S),!f||!C)return;g.setFromMatrixPosition(C.matrixWorld);const A=Math.sqrt(Math.pow(g.x-f.position.x,2)+Math.pow(g.z-f.position.z,2)),E=d*f.scale.x,I=g.y-1.6,F=g.y,M=f.position.y-u*f.scale.y/2,R=f.position.y+u*f.scale.y/2,O=I<=R&&F>=M;if(A<=E&&O){if(!v&&(v=!0,(!m||s)&&!p)){s||(m=!0),p=!0;try{if(!a&&l){a=!0;const T=l.play();T&&typeof T.catch=="function"&&T.catch(()=>{})}}catch{}i&&i(),console.log("Player entered the trigger zone!"),setTimeout(()=>{p=!1,console.log("Trigger re-armed after cooldown.")},r)}}else v=!1,s&&(m=!1)}function w(){h&&(h.emitters&&h.emitters.forEach(S=>{S.stopEmit&&S.stopEmit(),setTimeout(()=>{S.dispose&&S.dispose()},2e3)}),t&&t.remove(h),h.geometry&&h.geometry.dispose(),h.material&&h.material.dispose(),h=null),c&&(c.geometry&&c.geometry.dispose(),c.material&&c.material.dispose(),t&&t.remove(c),c=null),f&&(f.material&&f.material.dispose(),f.geometry&&f.geometry.dispose(),f=null)}function _(S){!t||!c||!h||(S?(t.children.includes(c)||t.add(c),h&&h.emitters&&h.emitters.forEach(C=>{C.startEmit&&C.startEmit()})):(t.remove(c),h&&h.emitters&&h.emitters.forEach(C=>{C.stopEmit&&C.stopEmit()})))}return{batchSystem:c,updateQuarksScene:y,removeParticleEffects:w,setVFXVisible:_}}const expressionArray=["Bored","Angry","Star","Eyelid","Low"];function setupShapeKeyAnimations(n){const e=[],t=new Clock;let o=!1,i=0,s=0,r=0,a=!1,l=0,c=1;n.traverse(v=>{if(v.isMesh&&v.morphTargetDictionary){const g=v.material;if(g&&g.name==="eyelipmaterial"){const y=g.clone();v.material=y,y.emissive=y.color.clone(),y.emissiveIntensity=.9}if(e.push(v),v.morphTargetInfluences)for(let y=0;y<v.morphTargetInfluences.length;y++)v.morphTargetInfluences[y]=0}});function d(v,g){e.forEach(y=>{if(y.morphTargetDictionary){const w=y.morphTargetDictionary[v];w!==void 0&&y.morphTargetInfluences&&(y.morphTargetInfluences[w]=g)}})}function u(){return .2+Math.random()*.4}function f(v){const g=Math.sin(v*8)*.3+.2,y=Math.sin(v*15)*.15,w=Math.sin(v*3)*.1,_=Math.max(0,Math.min(1,g+y+w));d("Key 1",_),d("LIPS",_)}function h(v){if(!a)v-s>=r&&(a=!0,l=v);else{const g=(v-l)/c,y=expressionArray[i];if(g<=1){const w=Math.sin(g*Math.PI);d(y,w)}else d(y,0),i=(i+1)%expressionArray.length,a=!1,s=v,r=u()}}function m(){o=!0,s=t.getElapsedTime(),r=u(),a=!1,i=0;const g=()=>{if(!o)return;const y=t.getElapsedTime();f(y),h(y),requestAnimationFrame(g)};g()}function p(){o=!1,a=!1,e.forEach(v=>{if(v.morphTargetInfluences)for(let g=0;g<v.morphTargetInfluences.length;g++)v.morphTargetInfluences[g]=0})}return{startAnimation:m,stopAnimation:p}}var lottie$1={exports:{}},lottie=lottie$1.exports,hasRequiredLottie;function requireLottie(){return hasRequiredLottie||(hasRequiredLottie=1,function(module,exports){typeof document<"u"&&typeof navigator<"u"&&function(n,e){module.exports=e()}(lottie,function(){var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(e){_useWebWorker=!!e},getWebWorker=function(){return _useWebWorker},setLocationHref=function(e){locationHref=e},getLocationHref=function(){return locationHref};function createTag(n){return document.createElement(n)}function extendPrototype(n,e){var t,o=n.length,i;for(t=0;t<o;t+=1){i=n[t].prototype;for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e.prototype[s]=i[s])}}function getDescriptor(n,e){return Object.getOwnPropertyDescriptor(n,e)}function createProxyFunction(n){function e(){}return e.prototype=n,e}var audioControllerFactory=function(){function n(e){this.audios=[],this.audioFactory=e,this._volume=1,this._isMuted=!1}return n.prototype={addAudio:function(t){this.audios.push(t)},pause:function(){var t,o=this.audios.length;for(t=0;t<o;t+=1)this.audios[t].pause()},resume:function(){var t,o=this.audios.length;for(t=0;t<o;t+=1)this.audios[t].resume()},setRate:function(t){var o,i=this.audios.length;for(o=0;o<i;o+=1)this.audios[o].setRate(t)},createAudio:function(t){return this.audioFactory?this.audioFactory(t):window.Howl?new window.Howl({src:[t]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(t){this.audioFactory=t},setVolume:function(t){this._volume=t,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var t,o=this.audios.length;for(t=0;t<o;t+=1)this.audios[t].volume(this._volume*(this._isMuted?0:1))}},function(){return new n}}(),createTypedArray=function(){function n(t,o){var i=0,s=[],r;switch(t){case"int16":case"uint8c":r=1;break;default:r=1.1;break}for(i=0;i<o;i+=1)s.push(r);return s}function e(t,o){return t==="float32"?new Float32Array(o):t==="int16"?new Int16Array(o):t==="uint8c"?new Uint8ClampedArray(o):n(t,o)}return typeof Uint8ClampedArray=="function"&&typeof Float32Array=="function"?e:n}();function createSizedArray(n){return Array.apply(null,{length:n})}function _typeof$6(n){"@babel/helpers - typeof";return _typeof$6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$6(n)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};(function(){var n=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],e,t=n.length;for(e=0;e<t;e+=1)BMMath[n[e]]=Math[n[e]]})(),BMMath.random=Math.random,BMMath.abs=function(n){var e=_typeof$6(n);if(e==="object"&&n.length){var t=createSizedArray(n.length),o,i=n.length;for(o=0;o<i;o+=1)t[o]=Math.abs(n[o]);return t}return Math.abs(n)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function styleDiv(n){n.style.position="absolute",n.style.top=0,n.style.left=0,n.style.display="block",n.style.transformOrigin="0 0",n.style.webkitTransformOrigin="0 0",n.style.backfaceVisibility="visible",n.style.webkitBackfaceVisibility="visible",n.style.transformStyle="preserve-3d",n.style.webkitTransformStyle="preserve-3d",n.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(n,e,t,o){this.type=n,this.currentTime=e,this.totalTime=t,this.direction=o<0?-1:1}function BMCompleteEvent(n,e){this.type=n,this.direction=e<0?-1:1}function BMCompleteLoopEvent(n,e,t,o){this.type=n,this.currentLoop=t,this.totalLoops=e,this.direction=o<0?-1:1}function BMSegmentStartEvent(n,e,t){this.type=n,this.firstFrame=e,this.totalFrames=t}function BMDestroyEvent(n,e){this.type=n,this.target=e}function BMRenderFrameErrorEvent(n,e){this.type="renderFrameError",this.nativeError=n,this.currentTime=e}function BMConfigErrorEvent(n){this.type="configError",this.nativeError=n}var createElementID=function(){var n=0;return function(){return n+=1,idPrefix$1+"__lottie_element_"+n}}();function HSVtoRGB(n,e,t){var o,i,s,r,a,l,c,d;switch(r=Math.floor(n*6),a=n*6-r,l=t*(1-e),c=t*(1-a*e),d=t*(1-(1-a)*e),r%6){case 0:o=t,i=d,s=l;break;case 1:o=c,i=t,s=l;break;case 2:o=l,i=t,s=d;break;case 3:o=l,i=c,s=t;break;case 4:o=d,i=l,s=t;break;case 5:o=t,i=l,s=c;break}return[o,i,s]}function RGBtoHSV(n,e,t){var o=Math.max(n,e,t),i=Math.min(n,e,t),s=o-i,r,a=o===0?0:s/o,l=o/255;switch(o){case i:r=0;break;case n:r=e-t+s*(e<t?6:0),r/=6*s;break;case e:r=t-n+s*2,r/=6*s;break;case t:r=n-e+s*4,r/=6*s;break}return[r,a,l]}function addSaturationToRGB(n,e){var t=RGBtoHSV(n[0]*255,n[1]*255,n[2]*255);return t[1]+=e,t[1]>1?t[1]=1:t[1]<=0&&(t[1]=0),HSVtoRGB(t[0],t[1],t[2])}function addBrightnessToRGB(n,e){var t=RGBtoHSV(n[0]*255,n[1]*255,n[2]*255);return t[2]+=e,t[2]>1?t[2]=1:t[2]<0&&(t[2]=0),HSVtoRGB(t[0],t[1],t[2])}function addHueToRGB(n,e){var t=RGBtoHSV(n[0]*255,n[1]*255,n[2]*255);return t[0]+=e/360,t[0]>1?t[0]-=1:t[0]<0&&(t[0]+=1),HSVtoRGB(t[0],t[1],t[2])}var rgbToHex=function(){var n=[],e,t;for(e=0;e<256;e+=1)t=e.toString(16),n[e]=t.length===1?"0"+t:t;return function(o,i,s){return o<0&&(o=0),i<0&&(i=0),s<0&&(s=0),"#"+n[o]+n[i]+n[s]}}(),setSubframeEnabled=function(e){subframeEnabled=!!e},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(e){expressionsPlugin=e},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(e){expressionsInterfaces=e},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(e){defaultCurveSegments=e},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(e){idPrefix$1=e};function createNS(n){return document.createElementNS(svgNS,n)}function _typeof$5(n){"@babel/helpers - typeof";return _typeof$5=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$5(n)}var dataManager=function(){var n=1,e=[],t,o,i={onmessage:function(){},postMessage:function(h){t({data:h})}},s={postMessage:function(h){i.onmessage({data:h})}};function r(f){if(window.Worker&&window.Blob&&getWebWorker()){var h=new Blob(["var _workerSelf = self; self.onmessage = ",f.toString()],{type:"text/javascript"}),m=URL.createObjectURL(h);return new Worker(m)}return t=f,i}function a(){o||(o=r(function(h){function m(){function v($,T){var D,P,L=$.length,B,b,z,N;for(P=0;P<L;P+=1)if(D=$[P],"ks"in D&&!D.completed){if(D.completed=!0,D.hasMask){var G=D.masksProperties;for(b=G.length,B=0;B<b;B+=1)if(G[B].pt.k.i)S(G[B].pt.k);else for(N=G[B].pt.k.length,z=0;z<N;z+=1)G[B].pt.k[z].s&&S(G[B].pt.k[z].s[0]),G[B].pt.k[z].e&&S(G[B].pt.k[z].e[0])}D.ty===0?(D.layers=w(D.refId,T),v(D.layers,T)):D.ty===4?_(D.shapes):D.ty===5&&R(D)}}function g($,T){if($){var D=0,P=$.length;for(D=0;D<P;D+=1)$[D].t===1&&($[D].data.layers=w($[D].data.refId,T),v($[D].data.layers,T))}}function y($,T){for(var D=0,P=T.length;D<P;){if(T[D].id===$)return T[D];D+=1}return null}function w($,T){var D=y($,T);return D?D.layers.__used?JSON.parse(JSON.stringify(D.layers)):(D.layers.__used=!0,D.layers):null}function _($){var T,D=$.length,P,L;for(T=D-1;T>=0;T-=1)if($[T].ty==="sh")if($[T].ks.k.i)S($[T].ks.k);else for(L=$[T].ks.k.length,P=0;P<L;P+=1)$[T].ks.k[P].s&&S($[T].ks.k[P].s[0]),$[T].ks.k[P].e&&S($[T].ks.k[P].e[0]);else $[T].ty==="gr"&&_($[T].it)}function S($){var T,D=$.i.length;for(T=0;T<D;T+=1)$.i[T][0]+=$.v[T][0],$.i[T][1]+=$.v[T][1],$.o[T][0]+=$.v[T][0],$.o[T][1]+=$.v[T][1]}function C($,T){var D=T?T.split("."):[100,100,100];return $[0]>D[0]?!0:D[0]>$[0]?!1:$[1]>D[1]?!0:D[1]>$[1]?!1:$[2]>D[2]?!0:D[2]>$[2]?!1:null}var A=function(){var $=[4,4,14];function T(P){var L=P.t.d;P.t.d={k:[{s:L,t:0}]}}function D(P){var L,B=P.length;for(L=0;L<B;L+=1)P[L].ty===5&&T(P[L])}return function(P){if(C($,P.v)&&(D(P.layers),P.assets)){var L,B=P.assets.length;for(L=0;L<B;L+=1)P.assets[L].layers&&D(P.assets[L].layers)}}}(),E=function(){var $=[4,7,99];return function(T){if(T.chars&&!C($,T.v)){var D,P=T.chars.length;for(D=0;D<P;D+=1){var L=T.chars[D];L.data&&L.data.shapes&&(_(L.data.shapes),L.data.ip=0,L.data.op=99999,L.data.st=0,L.data.sr=1,L.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},T.chars[D].t||(L.data.shapes.push({ty:"no"}),L.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),k=function(){var $=[5,7,15];function T(P){var L=P.t.p;typeof L.a=="number"&&(L.a={a:0,k:L.a}),typeof L.p=="number"&&(L.p={a:0,k:L.p}),typeof L.r=="number"&&(L.r={a:0,k:L.r})}function D(P){var L,B=P.length;for(L=0;L<B;L+=1)P[L].ty===5&&T(P[L])}return function(P){if(C($,P.v)&&(D(P.layers),P.assets)){var L,B=P.assets.length;for(L=0;L<B;L+=1)P.assets[L].layers&&D(P.assets[L].layers)}}}(),I=function(){var $=[4,1,9];function T(P){var L,B=P.length,b,z;for(L=0;L<B;L+=1)if(P[L].ty==="gr")T(P[L].it);else if(P[L].ty==="fl"||P[L].ty==="st")if(P[L].c.k&&P[L].c.k[0].i)for(z=P[L].c.k.length,b=0;b<z;b+=1)P[L].c.k[b].s&&(P[L].c.k[b].s[0]/=255,P[L].c.k[b].s[1]/=255,P[L].c.k[b].s[2]/=255,P[L].c.k[b].s[3]/=255),P[L].c.k[b].e&&(P[L].c.k[b].e[0]/=255,P[L].c.k[b].e[1]/=255,P[L].c.k[b].e[2]/=255,P[L].c.k[b].e[3]/=255);else P[L].c.k[0]/=255,P[L].c.k[1]/=255,P[L].c.k[2]/=255,P[L].c.k[3]/=255}function D(P){var L,B=P.length;for(L=0;L<B;L+=1)P[L].ty===4&&T(P[L].shapes)}return function(P){if(C($,P.v)&&(D(P.layers),P.assets)){var L,B=P.assets.length;for(L=0;L<B;L+=1)P.assets[L].layers&&D(P.assets[L].layers)}}}(),F=function(){var $=[4,4,18];function T(P){var L,B=P.length,b,z;for(L=B-1;L>=0;L-=1)if(P[L].ty==="sh")if(P[L].ks.k.i)P[L].ks.k.c=P[L].closed;else for(z=P[L].ks.k.length,b=0;b<z;b+=1)P[L].ks.k[b].s&&(P[L].ks.k[b].s[0].c=P[L].closed),P[L].ks.k[b].e&&(P[L].ks.k[b].e[0].c=P[L].closed);else P[L].ty==="gr"&&T(P[L].it)}function D(P){var L,B,b=P.length,z,N,G,K;for(B=0;B<b;B+=1){if(L=P[B],L.hasMask){var ne=L.masksProperties;for(N=ne.length,z=0;z<N;z+=1)if(ne[z].pt.k.i)ne[z].pt.k.c=ne[z].cl;else for(K=ne[z].pt.k.length,G=0;G<K;G+=1)ne[z].pt.k[G].s&&(ne[z].pt.k[G].s[0].c=ne[z].cl),ne[z].pt.k[G].e&&(ne[z].pt.k[G].e[0].c=ne[z].cl)}L.ty===4&&T(L.shapes)}}return function(P){if(C($,P.v)&&(D(P.layers),P.assets)){var L,B=P.assets.length;for(L=0;L<B;L+=1)P.assets[L].layers&&D(P.assets[L].layers)}}}();function M($){$.__complete||(I($),A($),E($),k($),F($),v($.layers,$.assets),g($.chars,$.assets),$.__complete=!0)}function R($){$.t.a.length===0&&"m"in $.t.p}var O={};return O.completeData=M,O.checkColors=I,O.checkChars=E,O.checkPathProperties=k,O.checkShapes=F,O.completeLayers=v,O}if(s.dataManager||(s.dataManager=m()),s.assetLoader||(s.assetLoader=function(){function v(y){var w=y.getResponseHeader("content-type");return w&&y.responseType==="json"&&w.indexOf("json")!==-1||y.response&&_typeof$5(y.response)==="object"?y.response:y.response&&typeof y.response=="string"?JSON.parse(y.response):y.responseText?JSON.parse(y.responseText):null}function g(y,w,_,S){var C,A=new XMLHttpRequest;try{A.responseType="json"}catch{}A.onreadystatechange=function(){if(A.readyState===4)if(A.status===200)C=v(A),_(C);else try{C=v(A),_(C)}catch(E){S&&S(E)}};try{A.open(["G","E","T"].join(""),y,!0)}catch{A.open(["G","E","T"].join(""),w+"/"+y,!0)}A.send()}return{load:g}}()),h.data.type==="loadAnimation")s.assetLoader.load(h.data.path,h.data.fullPath,function(v){s.dataManager.completeData(v),s.postMessage({id:h.data.id,payload:v,status:"success"})},function(){s.postMessage({id:h.data.id,status:"error"})});else if(h.data.type==="complete"){var p=h.data.animation;s.dataManager.completeData(p),s.postMessage({id:h.data.id,payload:p,status:"success"})}else h.data.type==="loadData"&&s.assetLoader.load(h.data.path,h.data.fullPath,function(v){s.postMessage({id:h.data.id,payload:v,status:"success"})},function(){s.postMessage({id:h.data.id,status:"error"})})}),o.onmessage=function(f){var h=f.data,m=h.id,p=e[m];e[m]=null,h.status==="success"?p.onComplete(h.payload):p.onError&&p.onError()})}function l(f,h){n+=1;var m="processId_"+n;return e[m]={onComplete:f,onError:h},m}function c(f,h,m){a();var p=l(h,m);o.postMessage({type:"loadAnimation",path:f,fullPath:window.location.origin+window.location.pathname,id:p})}function d(f,h,m){a();var p=l(h,m);o.postMessage({type:"loadData",path:f,fullPath:window.location.origin+window.location.pathname,id:p})}function u(f,h,m){a();var p=l(h,m);o.postMessage({type:"complete",animation:f,id:p})}return{loadAnimation:c,loadData:d,completeAnimation:u}}(),ImagePreloader=function(){var n=function(){var g=createTag("canvas");g.width=1,g.height=1;var y=g.getContext("2d");return y.fillStyle="rgba(0,0,0,0)",y.fillRect(0,0,1,1),g}();function e(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function t(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function o(g,y,w){var _="";if(g.e)_=g.p;else if(y){var S=g.p;S.indexOf("images/")!==-1&&(S=S.split("/")[1]),_=y+S}else _=w,_+=g.u?g.u:"",_+=g.p;return _}function i(g){var y=0,w=setInterval((function(){var _=g.getBBox();(_.width||y>500)&&(this._imageLoaded(),clearInterval(w)),y+=1}).bind(this),50)}function s(g){var y=o(g,this.assetsPath,this.path),w=createNS("image");isSafari?this.testImageLoaded(w):w.addEventListener("load",this._imageLoaded,!1),w.addEventListener("error",(function(){_.img=n,this._imageLoaded()}).bind(this),!1),w.setAttributeNS("http://www.w3.org/1999/xlink","href",y),this._elementHelper.append?this._elementHelper.append(w):this._elementHelper.appendChild(w);var _={img:w,assetData:g};return _}function r(g){var y=o(g,this.assetsPath,this.path),w=createTag("img");w.crossOrigin="anonymous",w.addEventListener("load",this._imageLoaded,!1),w.addEventListener("error",(function(){_.img=n,this._imageLoaded()}).bind(this),!1),w.src=y;var _={img:w,assetData:g};return _}function a(g){var y={assetData:g},w=o(g,this.assetsPath,this.path);return dataManager.loadData(w,(function(_){y.img=_,this._footageLoaded()}).bind(this),(function(){y.img={},this._footageLoaded()}).bind(this)),y}function l(g,y){this.imagesLoadedCb=y;var w,_=g.length;for(w=0;w<_;w+=1)g[w].layers||(!g[w].t||g[w].t==="seq"?(this.totalImages+=1,this.images.push(this._createImageData(g[w]))):g[w].t===3&&(this.totalFootages+=1,this.images.push(this.createFootageData(g[w]))))}function c(g){this.path=g||""}function d(g){this.assetsPath=g||""}function u(g){for(var y=0,w=this.images.length;y<w;){if(this.images[y].assetData===g)return this.images[y].img;y+=1}return null}function f(){this.imagesLoadedCb=null,this.images.length=0}function h(){return this.totalImages===this.loadedAssets}function m(){return this.totalFootages===this.loadedFootagesCount}function p(g,y){g==="svg"?(this._elementHelper=y,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}function v(){this._imageLoaded=e.bind(this),this._footageLoaded=t.bind(this),this.testImageLoaded=i.bind(this),this.createFootageData=a.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return v.prototype={loadAssets:l,setAssetsPath:d,setPath:c,loadedImages:h,loadedFootages:m,destroy:f,getAsset:u,createImgData:r,createImageData:s,imageLoaded:e,footageLoaded:t,setCacheType:p},v}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(e,t){if(this._cbs[e])for(var o=this._cbs[e],i=0;i<o.length;i+=1)o[i](t)},addEventListener:function(e,t){return this._cbs[e]||(this._cbs[e]=[]),this._cbs[e].push(t),(function(){this.removeEventListener(e,t)}).bind(this)},removeEventListener:function(e,t){if(!t)this._cbs[e]=null;else if(this._cbs[e]){for(var o=0,i=this._cbs[e].length;o<i;)this._cbs[e][o]===t&&(this._cbs[e].splice(o,1),o-=1,i-=1),o+=1;this._cbs[e].length||(this._cbs[e]=null)}}};var markerParser=function(){function n(e){for(var t=e.split(`\r
`),o={},i,s=0,r=0;r<t.length;r+=1)i=t[r].split(":"),i.length===2&&(o[i[0]]=i[1].trim(),s+=1);if(s===0)throw new Error;return o}return function(e){for(var t=[],o=0;o<e.length;o+=1){var i=e[o],s={time:i.tm,duration:i.dr};try{s.payload=JSON.parse(e[o].cm)}catch{try{s.payload=n(e[o].cm)}catch{s.payload={name:e[o].cm}}}t.push(s)}return t}}(),ProjectInterface=function(){function n(e){this.compositions.push(e)}return function(){function e(t){for(var o=0,i=this.compositions.length;o<i;){if(this.compositions[o].data&&this.compositions[o].data.nm===t)return this.compositions[o].prepareFrame&&this.compositions[o].data.xt&&this.compositions[o].prepareFrame(this.currentFrame),this.compositions[o].compInterface;o+=1}return null}return e.compositions=[],e.currentFrame=0,e.registerComposition=n,e}}(),renderers={},registerRenderer=function(e,t){renderers[e]=t};function getRenderer(n){return renderers[n]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var n in renderers)if(renderers[n])return n;return""}function _typeof$4(n){"@babel/helpers - typeof";return _typeof$4=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$4(n)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(n){(n.wrapper||n.container)&&(this.wrapper=n.wrapper||n.container);var e="svg";n.animType?e=n.animType:n.renderer&&(e=n.renderer);var t=getRenderer(e);this.renderer=new t(this,n.rendererSettings),this.imagePreloader.setCacheType(e,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=e,n.loop===""||n.loop===null||n.loop===void 0||n.loop===!0?this.loop=!0:n.loop===!1?this.loop=!1:this.loop=parseInt(n.loop,10),this.autoplay="autoplay"in n?n.autoplay:!0,this.name=n.name?n.name:"",this.autoloadSegments=Object.prototype.hasOwnProperty.call(n,"autoloadSegments")?n.autoloadSegments:!0,this.assetsPath=n.assetsPath,this.initialSegment=n.initialSegment,n.audioFactory&&this.audioController.setAudioFactory(n.audioFactory),n.animationData?this.setupAnimation(n.animationData):n.path&&(n.path.lastIndexOf("\\")!==-1?this.path=n.path.substr(0,n.path.lastIndexOf("\\")+1):this.path=n.path.substr(0,n.path.lastIndexOf("/")+1),this.fileName=n.path.substr(n.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(n.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(n){dataManager.completeAnimation(n,this.configAnimation)},AnimationItem.prototype.setData=function(n,e){e&&_typeof$4(e)!=="object"&&(e=JSON.parse(e));var t={wrapper:n,animationData:e},o=n.attributes;t.path=o.getNamedItem("data-animation-path")?o.getNamedItem("data-animation-path").value:o.getNamedItem("data-bm-path")?o.getNamedItem("data-bm-path").value:o.getNamedItem("bm-path")?o.getNamedItem("bm-path").value:"",t.animType=o.getNamedItem("data-anim-type")?o.getNamedItem("data-anim-type").value:o.getNamedItem("data-bm-type")?o.getNamedItem("data-bm-type").value:o.getNamedItem("bm-type")?o.getNamedItem("bm-type").value:o.getNamedItem("data-bm-renderer")?o.getNamedItem("data-bm-renderer").value:o.getNamedItem("bm-renderer")?o.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var i=o.getNamedItem("data-anim-loop")?o.getNamedItem("data-anim-loop").value:o.getNamedItem("data-bm-loop")?o.getNamedItem("data-bm-loop").value:o.getNamedItem("bm-loop")?o.getNamedItem("bm-loop").value:"";i==="false"?t.loop=!1:i==="true"?t.loop=!0:i!==""&&(t.loop=parseInt(i,10));var s=o.getNamedItem("data-anim-autoplay")?o.getNamedItem("data-anim-autoplay").value:o.getNamedItem("data-bm-autoplay")?o.getNamedItem("data-bm-autoplay").value:o.getNamedItem("bm-autoplay")?o.getNamedItem("bm-autoplay").value:!0;t.autoplay=s!=="false",t.name=o.getNamedItem("data-name")?o.getNamedItem("data-name").value:o.getNamedItem("data-bm-name")?o.getNamedItem("data-bm-name").value:o.getNamedItem("bm-name")?o.getNamedItem("bm-name").value:"";var r=o.getNamedItem("data-anim-prerender")?o.getNamedItem("data-anim-prerender").value:o.getNamedItem("data-bm-prerender")?o.getNamedItem("data-bm-prerender").value:o.getNamedItem("bm-prerender")?o.getNamedItem("bm-prerender").value:"";r==="false"&&(t.prerender=!1),t.path?this.setParams(t):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(n){n.op>this.animationData.op&&(this.animationData.op=n.op,this.totalFrames=Math.floor(n.op-this.animationData.ip));var e=this.animationData.layers,t,o=e.length,i=n.layers,s,r=i.length;for(s=0;s<r;s+=1)for(t=0;t<o;){if(e[t].id===i[s].id){e[t]=i[s];break}t+=1}if((n.chars||n.fonts)&&(this.renderer.globalData.fontManager.addChars(n.chars),this.renderer.globalData.fontManager.addFonts(n.fonts,this.renderer.globalData.defs)),n.assets)for(o=n.assets.length,t=0;t<o;t+=1)this.animationData.assets.push(n.assets[t]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(n){this.animationData=n;var e=getExpressionsPlugin();e&&e.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var n=this.animationData.segments;if(!n||n.length===0||!this.autoloadSegments){this.trigger("data_ready"),this.timeCompleted=this.totalFrames;return}var e=n.shift();this.timeCompleted=e.time*this.frameRate;var t=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(t,this.includeLayers.bind(this),(function(){this.trigger("data_failed")}).bind(this))},AnimationItem.prototype.loadSegments=function(){var n=this.animationData.segments;n||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(n){if(this.renderer)try{this.animationData=n,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(n),n.assets||(n.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(n.assets),this.markers=markerParser(n.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(e){this.triggerConfigError(e)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||this.renderer.rendererType!=="canvas")&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var n=getExpressionsPlugin();n&&n.initExpressions(this),this.renderer.initItems(),setTimeout((function(){this.trigger("DOMLoaded")}).bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(n,e){var t=typeof n=="number"?n:void 0,o=typeof e=="number"?e:void 0;this.renderer.updateContainerSize(t,o)},AnimationItem.prototype.setSubframe=function(n){this.isSubframeEnabled=!!n},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!(this.isLoaded===!1||!this.renderer))try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(n){this.triggerRenderFrameError(n)}},AnimationItem.prototype.play=function(n){n&&this.name!==n||this.isPaused===!0&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(n){n&&this.name!==n||this.isPaused===!1&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(n){n&&this.name!==n||(this.isPaused===!0?this.play():this.pause())},AnimationItem.prototype.stop=function(n){n&&this.name!==n||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(n){for(var e,t=0;t<this.markers.length;t+=1)if(e=this.markers[t],e.payload&&e.payload.name===n)return e;return null},AnimationItem.prototype.goToAndStop=function(n,e,t){if(!(t&&this.name!==t)){var o=Number(n);if(isNaN(o)){var i=this.getMarkerData(n);i&&this.goToAndStop(i.time,!0)}else e?this.setCurrentRawFrameValue(n):this.setCurrentRawFrameValue(n*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(n,e,t){if(!(t&&this.name!==t)){var o=Number(n);if(isNaN(o)){var i=this.getMarkerData(n);i&&(i.duration?this.playSegments([i.time,i.time+i.duration],!0):this.goToAndStop(i.time,!0))}else this.goToAndStop(o,e,t);this.play()}},AnimationItem.prototype.advanceTime=function(n){if(!(this.isPaused===!0||this.isLoaded===!1)){var e=this.currentRawFrame+n*this.frameModifier,t=!1;e>=this.totalFrames-1&&this.frameModifier>0?!this.loop||this.playCount===this.loop?this.checkSegments(e>this.totalFrames?e%this.totalFrames:0)||(t=!0,e=this.totalFrames-1):e>=this.totalFrames?(this.playCount+=1,this.checkSegments(e%this.totalFrames)||(this.setCurrentRawFrameValue(e%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(e):e<0?this.checkSegments(e%this.totalFrames)||(this.loop&&!(this.playCount--<=0&&this.loop!==!0)?(this.setCurrentRawFrameValue(this.totalFrames+e%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0):(t=!0,e=0)):this.setCurrentRawFrameValue(e),t&&(this.setCurrentRawFrameValue(e),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(n,e){this.playCount=0,n[1]<n[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=n[0]-n[1],this.timeCompleted=this.totalFrames,this.firstFrame=n[1],this.setCurrentRawFrameValue(this.totalFrames-.001-e)):n[1]>n[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=n[1]-n[0],this.timeCompleted=this.totalFrames,this.firstFrame=n[0],this.setCurrentRawFrameValue(.001+e)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(n,e){var t=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<n?t=n:this.currentRawFrame+this.firstFrame>e&&(t=e-n)),this.firstFrame=n,this.totalFrames=e-n,this.timeCompleted=this.totalFrames,t!==-1&&this.goToAndStop(t,!0)},AnimationItem.prototype.playSegments=function(n,e){if(e&&(this.segments.length=0),_typeof$4(n[0])==="object"){var t,o=n.length;for(t=0;t<o;t+=1)this.segments.push(n[t])}else this.segments.push(n);this.segments.length&&e&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(n){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),n&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(n){return this.segments.length?(this.adjustSegment(this.segments.shift(),n),!0):!1},AnimationItem.prototype.destroy=function(n){n&&this.name!==n||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(n){this.currentRawFrame=n,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(n){this.playSpeed=n,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(n){this.playDirection=n<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(n){this.loop=n},AnimationItem.prototype.setVolume=function(n,e){e&&this.name!==e||this.audioController.setVolume(n)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(n){n&&this.name!==n||this.audioController.mute()},AnimationItem.prototype.unmute=function(n){n&&this.name!==n||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(n){var e="";if(n.e)e=n.p;else if(this.assetsPath){var t=n.p;t.indexOf("images/")!==-1&&(t=t.split("/")[1]),e=this.assetsPath+t}else e=this.path,e+=n.u?n.u:"",e+=n.p;return e},AnimationItem.prototype.getAssetData=function(n){for(var e=0,t=this.assets.length;e<t;){if(n===this.assets[e].id)return this.assets[e];e+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(n){return n?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(n,e,t){try{var o=this.renderer.getElementByPath(n);o.updateDocumentData(e,t)}catch{}},AnimationItem.prototype.trigger=function(n){if(this._cbs&&this._cbs[n])switch(n){case"enterFrame":this.triggerEvent(n,new BMEnterFrameEvent(n,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(n,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(n,new BMCompleteLoopEvent(n,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(n,new BMCompleteEvent(n,this.frameMult));break;case"segmentStart":this.triggerEvent(n,new BMSegmentStartEvent(n,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(n,new BMDestroyEvent(n,this));break;default:this.triggerEvent(n)}n==="enterFrame"&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(n,this.currentFrame,this.totalFrames,this.frameMult)),n==="loopComplete"&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(n,this.loop,this.playCount,this.frameMult)),n==="complete"&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(n,this.frameMult)),n==="segmentStart"&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(n,this.firstFrame,this.totalFrames)),n==="destroy"&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(n,this))},AnimationItem.prototype.triggerRenderFrameError=function(n){var e=new BMRenderFrameErrorEvent(n,this.currentFrame);this.triggerEvent("error",e),this.onError&&this.onError.call(this,e)},AnimationItem.prototype.triggerConfigError=function(n){var e=new BMConfigErrorEvent(n,this.currentFrame);this.triggerEvent("error",e),this.onError&&this.onError.call(this,e)};var animationManager=function(){var n={},e=[],t=0,o=0,i=0,s=!0,r=!1;function a(T){for(var D=0,P=T.target;D<o;)e[D].animation===P&&(e.splice(D,1),D-=1,o-=1,P.isPaused||u()),D+=1}function l(T,D){if(!T)return null;for(var P=0;P<o;){if(e[P].elem===T&&e[P].elem!==null)return e[P].animation;P+=1}var L=new AnimationItem;return f(L,T),L.setData(T,D),L}function c(){var T,D=e.length,P=[];for(T=0;T<D;T+=1)P.push(e[T].animation);return P}function d(){i+=1,I()}function u(){i-=1}function f(T,D){T.addEventListener("destroy",a),T.addEventListener("_active",d),T.addEventListener("_idle",u),e.push({elem:D,animation:T}),o+=1}function h(T){var D=new AnimationItem;return f(D,null),D.setParams(T),D}function m(T,D){var P;for(P=0;P<o;P+=1)e[P].animation.setSpeed(T,D)}function p(T,D){var P;for(P=0;P<o;P+=1)e[P].animation.setDirection(T,D)}function v(T){var D;for(D=0;D<o;D+=1)e[D].animation.play(T)}function g(T){var D=T-t,P;for(P=0;P<o;P+=1)e[P].animation.advanceTime(D);t=T,i&&!r?window.requestAnimationFrame(g):s=!0}function y(T){t=T,window.requestAnimationFrame(g)}function w(T){var D;for(D=0;D<o;D+=1)e[D].animation.pause(T)}function _(T,D,P){var L;for(L=0;L<o;L+=1)e[L].animation.goToAndStop(T,D,P)}function S(T){var D;for(D=0;D<o;D+=1)e[D].animation.stop(T)}function C(T){var D;for(D=0;D<o;D+=1)e[D].animation.togglePause(T)}function A(T){var D;for(D=o-1;D>=0;D-=1)e[D].animation.destroy(T)}function E(T,D,P){var L=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),B,b=L.length;for(B=0;B<b;B+=1)P&&L[B].setAttribute("data-bm-type",P),l(L[B],T);if(D&&b===0){P||(P="svg");var z=document.getElementsByTagName("body")[0];z.innerText="";var N=createTag("div");N.style.width="100%",N.style.height="100%",N.setAttribute("data-bm-type",P),z.appendChild(N),l(N,T)}}function k(){var T;for(T=0;T<o;T+=1)e[T].animation.resize()}function I(){!r&&i&&s&&(window.requestAnimationFrame(y),s=!1)}function F(){r=!0}function M(){r=!1,I()}function R(T,D){var P;for(P=0;P<o;P+=1)e[P].animation.setVolume(T,D)}function O(T){var D;for(D=0;D<o;D+=1)e[D].animation.mute(T)}function $(T){var D;for(D=0;D<o;D+=1)e[D].animation.unmute(T)}return n.registerAnimation=l,n.loadAnimation=h,n.setSpeed=m,n.setDirection=p,n.play=v,n.pause=w,n.stop=S,n.togglePause=C,n.searchAnimations=E,n.resize=k,n.goToAndStop=_,n.destroy=A,n.freeze=F,n.unfreeze=M,n.setVolume=R,n.mute=O,n.unmute=$,n.getRegisteredAnimations=c,n}(),BezierFactory=function(){var n={};n.getBezierEasing=t;var e={};function t(y,w,_,S,C){var A=C||("bez_"+y+"_"+w+"_"+_+"_"+S).replace(/\./g,"p");if(e[A])return e[A];var E=new g([y,w,_,S]);return e[A]=E,E}var o=4,i=.001,s=1e-7,r=10,a=11,l=1/(a-1),c=typeof Float32Array=="function";function d(y,w){return 1-3*w+3*y}function u(y,w){return 3*w-6*y}function f(y){return 3*y}function h(y,w,_){return((d(w,_)*y+u(w,_))*y+f(w))*y}function m(y,w,_){return 3*d(w,_)*y*y+2*u(w,_)*y+f(w)}function p(y,w,_,S,C){var A,E,k=0;do E=w+(_-w)/2,A=h(E,S,C)-y,A>0?_=E:w=E;while(Math.abs(A)>s&&++k<r);return E}function v(y,w,_,S){for(var C=0;C<o;++C){var A=m(w,_,S);if(A===0)return w;var E=h(w,_,S)-y;w-=E/A}return w}function g(y){this._p=y,this._mSampleValues=c?new Float32Array(a):new Array(a),this._precomputed=!1,this.get=this.get.bind(this)}return g.prototype={get:function(w){var _=this._p[0],S=this._p[1],C=this._p[2],A=this._p[3];return this._precomputed||this._precompute(),_===S&&C===A?w:w===0?0:w===1?1:h(this._getTForX(w),S,A)},_precompute:function(){var w=this._p[0],_=this._p[1],S=this._p[2],C=this._p[3];this._precomputed=!0,(w!==_||S!==C)&&this._calcSampleValues()},_calcSampleValues:function(){for(var w=this._p[0],_=this._p[2],S=0;S<a;++S)this._mSampleValues[S]=h(S*l,w,_)},_getTForX:function(w){for(var _=this._p[0],S=this._p[2],C=this._mSampleValues,A=0,E=1,k=a-1;E!==k&&C[E]<=w;++E)A+=l;--E;var I=(w-C[E])/(C[E+1]-C[E]),F=A+I*l,M=m(F,_,S);return M>=i?v(w,F,_,S):M===0?F:p(w,A,A+l,_,S)}},n}(),pooling=function(){function n(e){return e.concat(createSizedArray(e.length))}return{double:n}}(),poolFactory=function(){return function(n,e,t){var o=0,i=n,s=createSizedArray(i),r={newElement:a,release:l};function a(){var c;return o?(o-=1,c=s[o]):c=e(),c}function l(c){o===i&&(s=pooling.double(s),i*=2),t&&t(c),s[o]=c,o+=1}return r}}(),bezierLengthPool=function(){function n(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}}return poolFactory(8,n)}(),segmentsLengthPool=function(){function n(){return{lengths:[],totalLength:0}}function e(t){var o,i=t.lengths.length;for(o=0;o<i;o+=1)bezierLengthPool.release(t.lengths[o]);t.lengths.length=0}return poolFactory(8,n,e)}();function bezFunction(){var n=Math;function e(f,h,m,p,v,g){var y=f*p+h*v+m*g-v*p-g*f-m*h;return y>-.001&&y<.001}function t(f,h,m,p,v,g,y,w,_){if(m===0&&g===0&&_===0)return e(f,h,p,v,y,w);var S=n.sqrt(n.pow(p-f,2)+n.pow(v-h,2)+n.pow(g-m,2)),C=n.sqrt(n.pow(y-f,2)+n.pow(w-h,2)+n.pow(_-m,2)),A=n.sqrt(n.pow(y-p,2)+n.pow(w-v,2)+n.pow(_-g,2)),E;return S>C?S>A?E=S-C-A:E=A-C-S:A>C?E=A-C-S:E=C-S-A,E>-1e-4&&E<1e-4}var o=function(){return function(f,h,m,p){var v=getDefaultCurveSegments(),g,y,w,_,S,C=0,A,E=[],k=[],I=bezierLengthPool.newElement();for(w=m.length,g=0;g<v;g+=1){for(S=g/(v-1),A=0,y=0;y<w;y+=1)_=bmPow(1-S,3)*f[y]+3*bmPow(1-S,2)*S*m[y]+3*(1-S)*bmPow(S,2)*p[y]+bmPow(S,3)*h[y],E[y]=_,k[y]!==null&&(A+=bmPow(E[y]-k[y],2)),k[y]=E[y];A&&(A=bmSqrt(A),C+=A),I.percents[g]=S,I.lengths[g]=C}return I.addedLength=C,I}}();function i(f){var h=segmentsLengthPool.newElement(),m=f.c,p=f.v,v=f.o,g=f.i,y,w=f._length,_=h.lengths,S=0;for(y=0;y<w-1;y+=1)_[y]=o(p[y],p[y+1],v[y],g[y+1]),S+=_[y].addedLength;return m&&w&&(_[y]=o(p[y],p[0],v[y],g[0]),S+=_[y].addedLength),h.totalLength=S,h}function s(f){this.segmentLength=0,this.points=new Array(f)}function r(f,h){this.partialLength=f,this.point=h}var a=function(){var f={};return function(h,m,p,v){var g=(h[0]+"_"+h[1]+"_"+m[0]+"_"+m[1]+"_"+p[0]+"_"+p[1]+"_"+v[0]+"_"+v[1]).replace(/\./g,"p");if(!f[g]){var y=getDefaultCurveSegments(),w,_,S,C,A,E=0,k,I,F=null;h.length===2&&(h[0]!==m[0]||h[1]!==m[1])&&e(h[0],h[1],m[0],m[1],h[0]+p[0],h[1]+p[1])&&e(h[0],h[1],m[0],m[1],m[0]+v[0],m[1]+v[1])&&(y=2);var M=new s(y);for(S=p.length,w=0;w<y;w+=1){for(I=createSizedArray(S),A=w/(y-1),k=0,_=0;_<S;_+=1)C=bmPow(1-A,3)*h[_]+3*bmPow(1-A,2)*A*(h[_]+p[_])+3*(1-A)*bmPow(A,2)*(m[_]+v[_])+bmPow(A,3)*m[_],I[_]=C,F!==null&&(k+=bmPow(I[_]-F[_],2));k=bmSqrt(k),E+=k,M.points[w]=new r(k,I),F=I}M.segmentLength=E,f[g]=M}return f[g]}}();function l(f,h){var m=h.percents,p=h.lengths,v=m.length,g=bmFloor((v-1)*f),y=f*h.addedLength,w=0;if(g===v-1||g===0||y===p[g])return m[g];for(var _=p[g]>y?-1:1,S=!0;S;)if(p[g]<=y&&p[g+1]>y?(w=(y-p[g])/(p[g+1]-p[g]),S=!1):g+=_,g<0||g>=v-1){if(g===v-1)return m[g];S=!1}return m[g]+(m[g+1]-m[g])*w}function c(f,h,m,p,v,g){var y=l(v,g),w=1-y,_=n.round((w*w*w*f[0]+(y*w*w+w*y*w+w*w*y)*m[0]+(y*y*w+w*y*y+y*w*y)*p[0]+y*y*y*h[0])*1e3)/1e3,S=n.round((w*w*w*f[1]+(y*w*w+w*y*w+w*w*y)*m[1]+(y*y*w+w*y*y+y*w*y)*p[1]+y*y*y*h[1])*1e3)/1e3;return[_,S]}var d=createTypedArray("float32",8);function u(f,h,m,p,v,g,y){v<0?v=0:v>1&&(v=1);var w=l(v,y);g=g>1?1:g;var _=l(g,y),S,C=f.length,A=1-w,E=1-_,k=A*A*A,I=w*A*A*3,F=w*w*A*3,M=w*w*w,R=A*A*E,O=w*A*E+A*w*E+A*A*_,$=w*w*E+A*w*_+w*A*_,T=w*w*_,D=A*E*E,P=w*E*E+A*_*E+A*E*_,L=w*_*E+A*_*_+w*E*_,B=w*_*_,b=E*E*E,z=_*E*E+E*_*E+E*E*_,N=_*_*E+E*_*_+_*E*_,G=_*_*_;for(S=0;S<C;S+=1)d[S*4]=n.round((k*f[S]+I*m[S]+F*p[S]+M*h[S])*1e3)/1e3,d[S*4+1]=n.round((R*f[S]+O*m[S]+$*p[S]+T*h[S])*1e3)/1e3,d[S*4+2]=n.round((D*f[S]+P*m[S]+L*p[S]+B*h[S])*1e3)/1e3,d[S*4+3]=n.round((b*f[S]+z*m[S]+N*p[S]+G*h[S])*1e3)/1e3;return d}return{getSegmentsLength:i,getNewSegment:u,getPointInSegment:c,buildBezierData:a,pointOnLine2D:e,pointOnLine3D:t}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(n,e){var t=this.offsetTime,o;this.propType==="multidimensional"&&(o=createTypedArray("float32",this.pv.length));for(var i=e.lastIndex,s=i,r=this.keyframes.length-1,a=!0,l,c,d;a;){if(l=this.keyframes[s],c=this.keyframes[s+1],s===r-1&&n>=c.t-t){l.h&&(l=c),i=0;break}if(c.t-t>n){i=s;break}s<r-1?s+=1:(i=0,a=!1)}d=this.keyframesMetadata[s]||{};var u,f,h,m,p,v,g=c.t-t,y=l.t-t,w;if(l.to){d.bezierData||(d.bezierData=bez.buildBezierData(l.s,c.s||l.e,l.to,l.ti));var _=d.bezierData;if(n>=g||n<y){var S=n>=g?_.points.length-1:0;for(f=_.points[S].point.length,u=0;u<f;u+=1)o[u]=_.points[S].point[u]}else{d.__fnct?v=d.__fnct:(v=BezierFactory.getBezierEasing(l.o.x,l.o.y,l.i.x,l.i.y,l.n).get,d.__fnct=v),h=v((n-y)/(g-y));var C=_.segmentLength*h,A,E=e.lastFrame<n&&e._lastKeyframeIndex===s?e._lastAddedLength:0;for(p=e.lastFrame<n&&e._lastKeyframeIndex===s?e._lastPoint:0,a=!0,m=_.points.length;a;){if(E+=_.points[p].partialLength,C===0||h===0||p===_.points.length-1){for(f=_.points[p].point.length,u=0;u<f;u+=1)o[u]=_.points[p].point[u];break}else if(C>=E&&C<E+_.points[p+1].partialLength){for(A=(C-E)/_.points[p+1].partialLength,f=_.points[p].point.length,u=0;u<f;u+=1)o[u]=_.points[p].point[u]+(_.points[p+1].point[u]-_.points[p].point[u])*A;break}p<m-1?p+=1:a=!1}e._lastPoint=p,e._lastAddedLength=E-_.points[p].partialLength,e._lastKeyframeIndex=s}}else{var k,I,F,M,R;if(r=l.s.length,w=c.s||l.e,this.sh&&l.h!==1)if(n>=g)o[0]=w[0],o[1]=w[1],o[2]=w[2];else if(n<=y)o[0]=l.s[0],o[1]=l.s[1],o[2]=l.s[2];else{var O=createQuaternion(l.s),$=createQuaternion(w),T=(n-y)/(g-y);quaternionToEuler(o,slerp(O,$,T))}else for(s=0;s<r;s+=1)l.h!==1&&(n>=g?h=1:n<y?h=0:(l.o.x.constructor===Array?(d.__fnct||(d.__fnct=[]),d.__fnct[s]?v=d.__fnct[s]:(k=l.o.x[s]===void 0?l.o.x[0]:l.o.x[s],I=l.o.y[s]===void 0?l.o.y[0]:l.o.y[s],F=l.i.x[s]===void 0?l.i.x[0]:l.i.x[s],M=l.i.y[s]===void 0?l.i.y[0]:l.i.y[s],v=BezierFactory.getBezierEasing(k,I,F,M).get,d.__fnct[s]=v)):d.__fnct?v=d.__fnct:(k=l.o.x,I=l.o.y,F=l.i.x,M=l.i.y,v=BezierFactory.getBezierEasing(k,I,F,M).get,l.keyframeMetadata=v),h=v((n-y)/(g-y)))),w=c.s||l.e,R=l.h===1?l.s[s]:l.s[s]+(w[s]-l.s[s])*h,this.propType==="multidimensional"?o[s]=R:o=R}return e.lastIndex=i,o}function slerp(n,e,t){var o=[],i=n[0],s=n[1],r=n[2],a=n[3],l=e[0],c=e[1],d=e[2],u=e[3],f,h,m,p,v;return h=i*l+s*c+r*d+a*u,h<0&&(h=-h,l=-l,c=-c,d=-d,u=-u),1-h>1e-6?(f=Math.acos(h),m=Math.sin(f),p=Math.sin((1-t)*f)/m,v=Math.sin(t*f)/m):(p=1-t,v=t),o[0]=p*i+v*l,o[1]=p*s+v*c,o[2]=p*r+v*d,o[3]=p*a+v*u,o}function quaternionToEuler(n,e){var t=e[0],o=e[1],i=e[2],s=e[3],r=Math.atan2(2*o*s-2*t*i,1-2*o*o-2*i*i),a=Math.asin(2*t*o+2*i*s),l=Math.atan2(2*t*s-2*o*i,1-2*t*t-2*i*i);n[0]=r/degToRads,n[1]=a/degToRads,n[2]=l/degToRads}function createQuaternion(n){var e=n[0]*degToRads,t=n[1]*degToRads,o=n[2]*degToRads,i=Math.cos(e/2),s=Math.cos(t/2),r=Math.cos(o/2),a=Math.sin(e/2),l=Math.sin(t/2),c=Math.sin(o/2),d=i*s*r-a*l*c,u=a*l*r+i*s*c,f=a*s*r+i*l*c,h=i*l*r-a*s*c;return[u,f,h,d]}function getValueAtCurrentTime(){var n=this.comp.renderedFrame-this.offsetTime,e=this.keyframes[0].t-this.offsetTime,t=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(n===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=t&&n>=t||this._caching.lastFrame<e&&n<e))){this._caching.lastFrame>=n&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var o=this.interpolateValue(n,this._caching);this.pv=o}return this._caching.lastFrame=n,this.pv}function setVValue(n){var e;if(this.propType==="unidimensional")e=n*this.mult,mathAbs(this.v-e)>1e-5&&(this.v=e,this._mdf=!0);else for(var t=0,o=this.v.length;t<o;)e=n[t]*this.mult,mathAbs(this.v[t]-e)>1e-5&&(this.v[t]=e,this._mdf=!0),t+=1}function processEffectsSequence(){if(!(this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)){if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=this._isFirstFrame;var n,e=this.effectsSequence.length,t=this.kf?this.pv:this.data.k;for(n=0;n<e;n+=1)t=this.effectsSequence[n](t);this.setVValue(t),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(n){this.effectsSequence.push(n),this.container.addDynamicProperty(this)}function ValueProperty(n,e,t,o){this.propType="unidimensional",this.mult=t||1,this.data=e,this.v=t?e.k*t:e.k,this.pv=e.k,this._mdf=!1,this.elem=n,this.container=o,this.comp=n.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(n,e,t,o){this.propType="multidimensional",this.mult=t||1,this.data=e,this._mdf=!1,this.elem=n,this.container=o,this.comp=n.comp,this.k=!1,this.kf=!1,this.frameId=-1;var i,s=e.k.length;for(this.v=createTypedArray("float32",s),this.pv=createTypedArray("float32",s),this.vel=createTypedArray("float32",s),i=0;i<s;i+=1)this.v[i]=e.k[i]*this.mult,this.pv[i]=e.k[i];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(n,e,t,o){this.propType="unidimensional",this.keyframes=e.k,this.keyframesMetadata=[],this.offsetTime=n.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=e,this.mult=t||1,this.elem=n,this.container=o,this.comp=n.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(n,e,t,o){this.propType="multidimensional";var i,s=e.k.length,r,a,l,c;for(i=0;i<s-1;i+=1)e.k[i].to&&e.k[i].s&&e.k[i+1]&&e.k[i+1].s&&(r=e.k[i].s,a=e.k[i+1].s,l=e.k[i].to,c=e.k[i].ti,(r.length===2&&!(r[0]===a[0]&&r[1]===a[1])&&bez.pointOnLine2D(r[0],r[1],a[0],a[1],r[0]+l[0],r[1]+l[1])&&bez.pointOnLine2D(r[0],r[1],a[0],a[1],a[0]+c[0],a[1]+c[1])||r.length===3&&!(r[0]===a[0]&&r[1]===a[1]&&r[2]===a[2])&&bez.pointOnLine3D(r[0],r[1],r[2],a[0],a[1],a[2],r[0]+l[0],r[1]+l[1],r[2]+l[2])&&bez.pointOnLine3D(r[0],r[1],r[2],a[0],a[1],a[2],a[0]+c[0],a[1]+c[1],a[2]+c[2]))&&(e.k[i].to=null,e.k[i].ti=null),r[0]===a[0]&&r[1]===a[1]&&l[0]===0&&l[1]===0&&c[0]===0&&c[1]===0&&(r.length===2||r[2]===a[2]&&l[2]===0&&c[2]===0)&&(e.k[i].to=null,e.k[i].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=e,this.keyframes=e.k,this.keyframesMetadata=[],this.offsetTime=n.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=t||1,this.elem=n,this.container=o,this.comp=n.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var d=e.k[0].s.length;for(this.v=createTypedArray("float32",d),this.pv=createTypedArray("float32",d),i=0;i<d;i+=1)this.v[i]=initFrame,this.pv[i]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",d)},this.addEffect=addEffect}var PropertyFactory=function(){function n(t,o,i,s,r){o.sid&&(o=t.globalData.slotManager.getProp(o));var a;if(!o.k.length)a=new ValueProperty(t,o,s,r);else if(typeof o.k[0]=="number")a=new MultiDimensionalProperty(t,o,s,r);else switch(i){case 0:a=new KeyframedValueProperty(t,o,s,r);break;case 1:a=new KeyframedMultidimensionalProperty(t,o,s,r);break}return a.effectsSequence.length&&r.addDynamicProperty(a),a}var e={getProp:n};return e}();function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(e){this.dynamicProperties.indexOf(e)===-1&&(this.dynamicProperties.push(e),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){this._mdf=!1;var e,t=this.dynamicProperties.length;for(e=0;e<t;e+=1)this.dynamicProperties[e].getValue(),this.dynamicProperties[e]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(e){this.container=e,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=function(){function n(){return createTypedArray("float32",2)}return poolFactory(8,n)}();function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(n,e){this.c=n,this.setLength(e);for(var t=0;t<e;)this.v[t]=pointPool.newElement(),this.o[t]=pointPool.newElement(),this.i[t]=pointPool.newElement(),t+=1},ShapePath.prototype.setLength=function(n){for(;this._maxLength<n;)this.doubleArrayLength();this._length=n},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(n,e,t,o,i){var s;switch(this._length=Math.max(this._length,o+1),this._length>=this._maxLength&&this.doubleArrayLength(),t){case"v":s=this.v;break;case"i":s=this.i;break;case"o":s=this.o;break;default:s=[];break}(!s[o]||s[o]&&!i)&&(s[o]=pointPool.newElement()),s[o][0]=n,s[o][1]=e},ShapePath.prototype.setTripleAt=function(n,e,t,o,i,s,r,a){this.setXYAt(n,e,"v",r,a),this.setXYAt(t,o,"o",r,a),this.setXYAt(i,s,"i",r,a)},ShapePath.prototype.reverse=function(){var n=new ShapePath;n.setPathData(this.c,this._length);var e=this.v,t=this.o,o=this.i,i=0;this.c&&(n.setTripleAt(e[0][0],e[0][1],o[0][0],o[0][1],t[0][0],t[0][1],0,!1),i=1);var s=this._length-1,r=this._length,a;for(a=i;a<r;a+=1)n.setTripleAt(e[s][0],e[s][1],o[s][0],o[s][1],t[s][0],t[s][1],a,!1),s-=1;return n},ShapePath.prototype.length=function(){return this._length};var shapePool=function(){function n(){return new ShapePath}function e(i){var s=i._length,r;for(r=0;r<s;r+=1)pointPool.release(i.v[r]),pointPool.release(i.i[r]),pointPool.release(i.o[r]),i.v[r]=null,i.i[r]=null,i.o[r]=null;i._length=0,i.c=!1}function t(i){var s=o.newElement(),r,a=i._length===void 0?i.v.length:i._length;for(s.setLength(a),s.c=i.c,r=0;r<a;r+=1)s.setTripleAt(i.v[r][0],i.v[r][1],i.o[r][0],i.o[r][1],i.i[r][0],i.i[r][1],r);return s}var o=poolFactory(4,n,e);return o.clone=t,o}();function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(n){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=n,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var n;for(n=0;n<this._length;n+=1)shapePool.release(this.shapes[n]);this._length=0};var shapeCollectionPool=function(){var n={newShapeCollection:i,release:s},e=0,t=4,o=createSizedArray(t);function i(){var r;return e?(e-=1,r=o[e]):r=new ShapeCollection,r}function s(r){var a,l=r._length;for(a=0;a<l;a+=1)shapePool.release(r.shapes[a]);r._length=0,e===t&&(o=pooling.double(o),t*=2),o[e]=r,e+=1}return n}(),ShapePropertyFactory=function(){var n=-999999;function e(g,y,w){var _=w.lastIndex,S,C,A,E,k,I,F,M,R,O=this.keyframes;if(g<O[0].t-this.offsetTime)S=O[0].s[0],A=!0,_=0;else if(g>=O[O.length-1].t-this.offsetTime)S=O[O.length-1].s?O[O.length-1].s[0]:O[O.length-2].e[0],A=!0;else{for(var $=_,T=O.length-1,D=!0,P,L,B;D&&(P=O[$],L=O[$+1],!(L.t-this.offsetTime>g));)$<T-1?$+=1:D=!1;if(B=this.keyframesMetadata[$]||{},A=P.h===1,_=$,!A){if(g>=L.t-this.offsetTime)M=1;else if(g<P.t-this.offsetTime)M=0;else{var b;B.__fnct?b=B.__fnct:(b=BezierFactory.getBezierEasing(P.o.x,P.o.y,P.i.x,P.i.y).get,B.__fnct=b),M=b((g-(P.t-this.offsetTime))/(L.t-this.offsetTime-(P.t-this.offsetTime)))}C=L.s?L.s[0]:P.e[0]}S=P.s[0]}for(I=y._length,F=S.i[0].length,w.lastIndex=_,E=0;E<I;E+=1)for(k=0;k<F;k+=1)R=A?S.i[E][k]:S.i[E][k]+(C.i[E][k]-S.i[E][k])*M,y.i[E][k]=R,R=A?S.o[E][k]:S.o[E][k]+(C.o[E][k]-S.o[E][k])*M,y.o[E][k]=R,R=A?S.v[E][k]:S.v[E][k]+(C.v[E][k]-S.v[E][k])*M,y.v[E][k]=R}function t(){var g=this.comp.renderedFrame-this.offsetTime,y=this.keyframes[0].t-this.offsetTime,w=this.keyframes[this.keyframes.length-1].t-this.offsetTime,_=this._caching.lastFrame;return _!==n&&(_<y&&g<y||_>w&&g>w)||(this._caching.lastIndex=_<g?this._caching.lastIndex:0,this.interpolateShape(g,this.pv,this._caching)),this._caching.lastFrame=g,this.pv}function o(){this.paths=this.localShapeCollection}function i(g,y){if(g._length!==y._length||g.c!==y.c)return!1;var w,_=g._length;for(w=0;w<_;w+=1)if(g.v[w][0]!==y.v[w][0]||g.v[w][1]!==y.v[w][1]||g.o[w][0]!==y.o[w][0]||g.o[w][1]!==y.o[w][1]||g.i[w][0]!==y.i[w][0]||g.i[w][1]!==y.i[w][1])return!1;return!0}function s(g){i(this.v,g)||(this.v=shapePool.clone(g),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function r(){if(this.elem.globalData.frameId!==this.frameId){if(!this.effectsSequence.length){this._mdf=!1;return}if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=!1;var g;this.kf?g=this.pv:this.data.ks?g=this.data.ks.k:g=this.data.pt.k;var y,w=this.effectsSequence.length;for(y=0;y<w;y+=1)g=this.effectsSequence[y](g);this.setVValue(g),this.lock=!1,this.frameId=this.elem.globalData.frameId}}function a(g,y,w){this.propType="shape",this.comp=g.comp,this.container=g,this.elem=g,this.data=y,this.k=!1,this.kf=!1,this._mdf=!1;var _=w===3?y.pt.k:y.ks.k;this.v=shapePool.clone(_),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=o,this.effectsSequence=[]}function l(g){this.effectsSequence.push(g),this.container.addDynamicProperty(this)}a.prototype.interpolateShape=e,a.prototype.getValue=r,a.prototype.setVValue=s,a.prototype.addEffect=l;function c(g,y,w){this.propType="shape",this.comp=g.comp,this.elem=g,this.container=g,this.offsetTime=g.data.st,this.keyframes=w===3?y.pt.k:y.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var _=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,_),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=n,this.reset=o,this._caching={lastFrame:n,lastIndex:0},this.effectsSequence=[t.bind(this)]}c.prototype.getValue=r,c.prototype.interpolateShape=e,c.prototype.setVValue=s,c.prototype.addEffect=l;var d=function(){var g=roundCorner;function y(w,_){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=_.d,this.elem=w,this.comp=w.comp,this.frameId=-1,this.initDynamicPropertyContainer(w),this.p=PropertyFactory.getProp(w,_.p,1,0,this),this.s=PropertyFactory.getProp(w,_.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return y.prototype={reset:o,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var _=this.p.v[0],S=this.p.v[1],C=this.s.v[0]/2,A=this.s.v[1]/2,E=this.d!==3,k=this.v;k.v[0][0]=_,k.v[0][1]=S-A,k.v[1][0]=E?_+C:_-C,k.v[1][1]=S,k.v[2][0]=_,k.v[2][1]=S+A,k.v[3][0]=E?_-C:_+C,k.v[3][1]=S,k.i[0][0]=E?_-C*g:_+C*g,k.i[0][1]=S-A,k.i[1][0]=E?_+C:_-C,k.i[1][1]=S-A*g,k.i[2][0]=E?_+C*g:_-C*g,k.i[2][1]=S+A,k.i[3][0]=E?_-C:_+C,k.i[3][1]=S+A*g,k.o[0][0]=E?_+C*g:_-C*g,k.o[0][1]=S-A,k.o[1][0]=E?_+C:_-C,k.o[1][1]=S+A*g,k.o[2][0]=E?_-C*g:_+C*g,k.o[2][1]=S+A,k.o[3][0]=E?_-C:_+C,k.o[3][1]=S-A*g}},extendPrototype([DynamicPropertyContainer],y),y}(),u=function(){function g(y,w){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=y,this.comp=y.comp,this.data=w,this.frameId=-1,this.d=w.d,this.initDynamicPropertyContainer(y),w.sy===1?(this.ir=PropertyFactory.getProp(y,w.ir,0,0,this),this.is=PropertyFactory.getProp(y,w.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(y,w.pt,0,0,this),this.p=PropertyFactory.getProp(y,w.p,1,0,this),this.r=PropertyFactory.getProp(y,w.r,0,degToRads,this),this.or=PropertyFactory.getProp(y,w.or,0,0,this),this.os=PropertyFactory.getProp(y,w.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return g.prototype={reset:o,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var w=Math.floor(this.pt.v)*2,_=Math.PI*2/w,S=!0,C=this.or.v,A=this.ir.v,E=this.os.v,k=this.is.v,I=2*Math.PI*C/(w*2),F=2*Math.PI*A/(w*2),M,R,O,$,T=-Math.PI/2;T+=this.r.v;var D=this.data.d===3?-1:1;for(this.v._length=0,M=0;M<w;M+=1){R=S?C:A,O=S?E:k,$=S?I:F;var P=R*Math.cos(T),L=R*Math.sin(T),B=P===0&&L===0?0:L/Math.sqrt(P*P+L*L),b=P===0&&L===0?0:-P/Math.sqrt(P*P+L*L);P+=+this.p.v[0],L+=+this.p.v[1],this.v.setTripleAt(P,L,P-B*$*O*D,L-b*$*O*D,P+B*$*O*D,L+b*$*O*D,M,!0),S=!S,T+=_*D}},convertPolygonToPath:function(){var w=Math.floor(this.pt.v),_=Math.PI*2/w,S=this.or.v,C=this.os.v,A=2*Math.PI*S/(w*4),E,k=-Math.PI*.5,I=this.data.d===3?-1:1;for(k+=this.r.v,this.v._length=0,E=0;E<w;E+=1){var F=S*Math.cos(k),M=S*Math.sin(k),R=F===0&&M===0?0:M/Math.sqrt(F*F+M*M),O=F===0&&M===0?0:-F/Math.sqrt(F*F+M*M);F+=+this.p.v[0],M+=+this.p.v[1],this.v.setTripleAt(F,M,F-R*A*C*I,M-O*A*C*I,F+R*A*C*I,M+O*A*C*I,E,!0),k+=_*I}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],g),g}(),f=function(){function g(y,w){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=y,this.comp=y.comp,this.frameId=-1,this.d=w.d,this.initDynamicPropertyContainer(y),this.p=PropertyFactory.getProp(y,w.p,1,0,this),this.s=PropertyFactory.getProp(y,w.s,1,0,this),this.r=PropertyFactory.getProp(y,w.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return g.prototype={convertRectToPath:function(){var w=this.p.v[0],_=this.p.v[1],S=this.s.v[0]/2,C=this.s.v[1]/2,A=bmMin(S,C,this.r.v),E=A*(1-roundCorner);this.v._length=0,this.d===2||this.d===1?(this.v.setTripleAt(w+S,_-C+A,w+S,_-C+A,w+S,_-C+E,0,!0),this.v.setTripleAt(w+S,_+C-A,w+S,_+C-E,w+S,_+C-A,1,!0),A!==0?(this.v.setTripleAt(w+S-A,_+C,w+S-A,_+C,w+S-E,_+C,2,!0),this.v.setTripleAt(w-S+A,_+C,w-S+E,_+C,w-S+A,_+C,3,!0),this.v.setTripleAt(w-S,_+C-A,w-S,_+C-A,w-S,_+C-E,4,!0),this.v.setTripleAt(w-S,_-C+A,w-S,_-C+E,w-S,_-C+A,5,!0),this.v.setTripleAt(w-S+A,_-C,w-S+A,_-C,w-S+E,_-C,6,!0),this.v.setTripleAt(w+S-A,_-C,w+S-E,_-C,w+S-A,_-C,7,!0)):(this.v.setTripleAt(w-S,_+C,w-S+E,_+C,w-S,_+C,2),this.v.setTripleAt(w-S,_-C,w-S,_-C+E,w-S,_-C,3))):(this.v.setTripleAt(w+S,_-C+A,w+S,_-C+E,w+S,_-C+A,0,!0),A!==0?(this.v.setTripleAt(w+S-A,_-C,w+S-A,_-C,w+S-E,_-C,1,!0),this.v.setTripleAt(w-S+A,_-C,w-S+E,_-C,w-S+A,_-C,2,!0),this.v.setTripleAt(w-S,_-C+A,w-S,_-C+A,w-S,_-C+E,3,!0),this.v.setTripleAt(w-S,_+C-A,w-S,_+C-E,w-S,_+C-A,4,!0),this.v.setTripleAt(w-S+A,_+C,w-S+A,_+C,w-S+E,_+C,5,!0),this.v.setTripleAt(w+S-A,_+C,w+S-E,_+C,w+S-A,_+C,6,!0),this.v.setTripleAt(w+S,_+C-A,w+S,_+C-A,w+S,_+C-E,7,!0)):(this.v.setTripleAt(w-S,_-C,w-S+E,_-C,w-S,_-C,1,!0),this.v.setTripleAt(w-S,_+C,w-S,_+C-E,w-S,_+C,2,!0),this.v.setTripleAt(w+S,_+C,w+S-E,_+C,w+S,_+C,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:o},extendPrototype([DynamicPropertyContainer],g),g}();function h(g,y,w){var _;if(w===3||w===4){var S=w===3?y.pt:y.ks,C=S.k;C.length?_=new c(g,y,w):_=new a(g,y,w)}else w===5?_=new f(g,y):w===6?_=new d(g,y):w===7&&(_=new u(g,y));return _.k&&g.addDynamicProperty(_),_}function m(){return a}function p(){return c}var v={};return v.getShapeProp=h,v.getConstructorFunction=m,v.getKeyframedConstructorFunction=p,v}();/*!
 Transformation Matrix v2.0
 (c) Epistemex 2014-2015
 www.epistemex.com
 By Ken Fyrstenberg
 Contributions by leeoniya.
 License: MIT, header required.
 */var Matrix=function(){var n=Math.cos,e=Math.sin,t=Math.tan,o=Math.round;function i(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function s(P){if(P===0)return this;var L=n(P),B=e(P);return this._t(L,-B,0,0,B,L,0,0,0,0,1,0,0,0,0,1)}function r(P){if(P===0)return this;var L=n(P),B=e(P);return this._t(1,0,0,0,0,L,-B,0,0,B,L,0,0,0,0,1)}function a(P){if(P===0)return this;var L=n(P),B=e(P);return this._t(L,0,B,0,0,1,0,0,-B,0,L,0,0,0,0,1)}function l(P){if(P===0)return this;var L=n(P),B=e(P);return this._t(L,-B,0,0,B,L,0,0,0,0,1,0,0,0,0,1)}function c(P,L){return this._t(1,L,P,1,0,0)}function d(P,L){return this.shear(t(P),t(L))}function u(P,L){var B=n(L),b=e(L);return this._t(B,b,0,0,-b,B,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,t(P),1,0,0,0,0,1,0,0,0,0,1)._t(B,-b,0,0,b,B,0,0,0,0,1,0,0,0,0,1)}function f(P,L,B){return!B&&B!==0&&(B=1),P===1&&L===1&&B===1?this:this._t(P,0,0,0,0,L,0,0,0,0,B,0,0,0,0,1)}function h(P,L,B,b,z,N,G,K,ne,J,se,te,Z,Q,le,ae){return this.props[0]=P,this.props[1]=L,this.props[2]=B,this.props[3]=b,this.props[4]=z,this.props[5]=N,this.props[6]=G,this.props[7]=K,this.props[8]=ne,this.props[9]=J,this.props[10]=se,this.props[11]=te,this.props[12]=Z,this.props[13]=Q,this.props[14]=le,this.props[15]=ae,this}function m(P,L,B){return B=B||0,P!==0||L!==0||B!==0?this._t(1,0,0,0,0,1,0,0,0,0,1,0,P,L,B,1):this}function p(P,L,B,b,z,N,G,K,ne,J,se,te,Z,Q,le,ae){var oe=this.props;if(P===1&&L===0&&B===0&&b===0&&z===0&&N===1&&G===0&&K===0&&ne===0&&J===0&&se===1&&te===0)return oe[12]=oe[12]*P+oe[15]*Z,oe[13]=oe[13]*N+oe[15]*Q,oe[14]=oe[14]*se+oe[15]*le,oe[15]*=ae,this._identityCalculated=!1,this;var pe=oe[0],_e=oe[1],we=oe[2],me=oe[3],ve=oe[4],be=oe[5],ue=oe[6],de=oe[7],Se=oe[8],ge=oe[9],Ce=oe[10],ye=oe[11],Pe=oe[12],he=oe[13],xe=oe[14],ce=oe[15];return oe[0]=pe*P+_e*z+we*ne+me*Z,oe[1]=pe*L+_e*N+we*J+me*Q,oe[2]=pe*B+_e*G+we*se+me*le,oe[3]=pe*b+_e*K+we*te+me*ae,oe[4]=ve*P+be*z+ue*ne+de*Z,oe[5]=ve*L+be*N+ue*J+de*Q,oe[6]=ve*B+be*G+ue*se+de*le,oe[7]=ve*b+be*K+ue*te+de*ae,oe[8]=Se*P+ge*z+Ce*ne+ye*Z,oe[9]=Se*L+ge*N+Ce*J+ye*Q,oe[10]=Se*B+ge*G+Ce*se+ye*le,oe[11]=Se*b+ge*K+Ce*te+ye*ae,oe[12]=Pe*P+he*z+xe*ne+ce*Z,oe[13]=Pe*L+he*N+xe*J+ce*Q,oe[14]=Pe*B+he*G+xe*se+ce*le,oe[15]=Pe*b+he*K+xe*te+ce*ae,this._identityCalculated=!1,this}function v(P){var L=P.props;return this.transform(L[0],L[1],L[2],L[3],L[4],L[5],L[6],L[7],L[8],L[9],L[10],L[11],L[12],L[13],L[14],L[15])}function g(){return this._identityCalculated||(this._identity=!(this.props[0]!==1||this.props[1]!==0||this.props[2]!==0||this.props[3]!==0||this.props[4]!==0||this.props[5]!==1||this.props[6]!==0||this.props[7]!==0||this.props[8]!==0||this.props[9]!==0||this.props[10]!==1||this.props[11]!==0||this.props[12]!==0||this.props[13]!==0||this.props[14]!==0||this.props[15]!==1),this._identityCalculated=!0),this._identity}function y(P){for(var L=0;L<16;){if(P.props[L]!==this.props[L])return!1;L+=1}return!0}function w(P){var L;for(L=0;L<16;L+=1)P.props[L]=this.props[L];return P}function _(P){var L;for(L=0;L<16;L+=1)this.props[L]=P[L]}function S(P,L,B){return{x:P*this.props[0]+L*this.props[4]+B*this.props[8]+this.props[12],y:P*this.props[1]+L*this.props[5]+B*this.props[9]+this.props[13],z:P*this.props[2]+L*this.props[6]+B*this.props[10]+this.props[14]}}function C(P,L,B){return P*this.props[0]+L*this.props[4]+B*this.props[8]+this.props[12]}function A(P,L,B){return P*this.props[1]+L*this.props[5]+B*this.props[9]+this.props[13]}function E(P,L,B){return P*this.props[2]+L*this.props[6]+B*this.props[10]+this.props[14]}function k(){var P=this.props[0]*this.props[5]-this.props[1]*this.props[4],L=this.props[5]/P,B=-this.props[1]/P,b=-this.props[4]/P,z=this.props[0]/P,N=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/P,G=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/P,K=new Matrix;return K.props[0]=L,K.props[1]=B,K.props[4]=b,K.props[5]=z,K.props[12]=N,K.props[13]=G,K}function I(P){var L=this.getInverseMatrix();return L.applyToPointArray(P[0],P[1],P[2]||0)}function F(P){var L,B=P.length,b=[];for(L=0;L<B;L+=1)b[L]=I(P[L]);return b}function M(P,L,B){var b=createTypedArray("float32",6);if(this.isIdentity())b[0]=P[0],b[1]=P[1],b[2]=L[0],b[3]=L[1],b[4]=B[0],b[5]=B[1];else{var z=this.props[0],N=this.props[1],G=this.props[4],K=this.props[5],ne=this.props[12],J=this.props[13];b[0]=P[0]*z+P[1]*G+ne,b[1]=P[0]*N+P[1]*K+J,b[2]=L[0]*z+L[1]*G+ne,b[3]=L[0]*N+L[1]*K+J,b[4]=B[0]*z+B[1]*G+ne,b[5]=B[0]*N+B[1]*K+J}return b}function R(P,L,B){var b;return this.isIdentity()?b=[P,L,B]:b=[P*this.props[0]+L*this.props[4]+B*this.props[8]+this.props[12],P*this.props[1]+L*this.props[5]+B*this.props[9]+this.props[13],P*this.props[2]+L*this.props[6]+B*this.props[10]+this.props[14]],b}function O(P,L){if(this.isIdentity())return P+","+L;var B=this.props;return Math.round((P*B[0]+L*B[4]+B[12])*100)/100+","+Math.round((P*B[1]+L*B[5]+B[13])*100)/100}function $(){for(var P=0,L=this.props,B="matrix3d(",b=1e4;P<16;)B+=o(L[P]*b)/b,B+=P===15?")":",",P+=1;return B}function T(P){var L=1e4;return P<1e-6&&P>0||P>-1e-6&&P<0?o(P*L)/L:P}function D(){var P=this.props,L=T(P[0]),B=T(P[1]),b=T(P[4]),z=T(P[5]),N=T(P[12]),G=T(P[13]);return"matrix("+L+","+B+","+b+","+z+","+N+","+G+")"}return function(){this.reset=i,this.rotate=s,this.rotateX=r,this.rotateY=a,this.rotateZ=l,this.skew=d,this.skewFromAxis=u,this.shear=c,this.scale=f,this.setTransform=h,this.translate=m,this.transform=p,this.multiply=v,this.applyToPoint=S,this.applyToX=C,this.applyToY=A,this.applyToZ=E,this.applyToPointArray=R,this.applyToTriplePoints=M,this.applyToPointStringified=O,this.toCSS=$,this.to2dCSS=D,this.clone=w,this.cloneFromProps=_,this.equals=y,this.inversePoints=F,this.inversePoint=I,this.getInverseMatrix=k,this._t=this.transform,this.isIdentity=g,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(n){"@babel/helpers - typeof";return _typeof$3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$3(n)}var lottie={};function setLocation(n){setLocationHref(n)}function searchAnimations(){animationManager.searchAnimations()}function setSubframeRendering(n){setSubframeEnabled(n)}function setPrefix(n){setIdPrefix(n)}function loadAnimation(n){return animationManager.loadAnimation(n)}function setQuality(n){if(typeof n=="string")switch(n){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10);break}else!isNaN(n)&&n>1&&setDefaultCurveSegments(n)}function inBrowser(){return typeof navigator<"u"}function installPlugin(n,e){n==="expressions"&&setExpressionsPlugin(e)}function getFactory(n){switch(n){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.13.0";function checkReady(){document.readyState==="complete"&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(n){for(var e=queryString.split("&"),t=0;t<e.length;t+=1){var o=e[t].split("=");if(decodeURIComponent(o[0])==n)return decodeURIComponent(o[1])}return null}var queryString="";{var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{_typeof$3(exports)!=="object"&&(window.bodymovin=lottie)}catch(n){}var ShapeModifiers=function(){var n={},e={};n.registerModifier=t,n.getModifier=o;function t(i,s){e[i]||(e[i]=s)}function o(i,s,r){return new e[i](s,r)}return n}();function ShapeModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(n){if(!this.closed){n.sh.container.addDynamicProperty(n.sh);var e={shape:n.sh,data:n,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(e),this.addShapeToModifier(e),this._isAnimated&&n.setAsAnimated()}},ShapeModifier.prototype.init=function(n,e){this.shapes=[],this.elem=n,this.initDynamicPropertyContainer(n),this.initModifierProperties(n,e),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier);function TrimModifier(){}extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(n,e){this.s=PropertyFactory.getProp(n,e.s,0,.01,this),this.e=PropertyFactory.getProp(n,e.e,0,.01,this),this.o=PropertyFactory.getProp(n,e.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=e.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(n){n.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(n,e,t,o,i){var s=[];e<=1?s.push({s:n,e}):n>=1?s.push({s:n-1,e:e-1}):(s.push({s:n,e:1}),s.push({s:0,e:e-1}));var r=[],a,l=s.length,c;for(a=0;a<l;a+=1)if(c=s[a],!(c.e*i<o||c.s*i>o+t)){var d,u;c.s*i<=o?d=0:d=(c.s*i-o)/t,c.e*i>=o+t?u=1:u=(c.e*i-o)/t,r.push([d,u])}return r.length||r.push([0,0]),r},TrimModifier.prototype.releasePathsData=function(n){var e,t=n.length;for(e=0;e<t;e+=1)segmentsLengthPool.release(n[e]);return n.length=0,n},TrimModifier.prototype.processShapes=function(n){var e,t;if(this._mdf||n){var o=this.o.v%360/360;if(o<0&&(o+=1),this.s.v>1?e=1+o:this.s.v<0?e=0+o:e=this.s.v+o,this.e.v>1?t=1+o:this.e.v<0?t=0+o:t=this.e.v+o,e>t){var i=e;e=t,t=i}e=Math.round(e*1e4)*1e-4,t=Math.round(t*1e4)*1e-4,this.sValue=e,this.eValue=t}else e=this.sValue,t=this.eValue;var s,r,a=this.shapes.length,l,c,d,u,f,h=0;if(t===e)for(r=0;r<a;r+=1)this.shapes[r].localShapeCollection.releaseShapes(),this.shapes[r].shape._mdf=!0,this.shapes[r].shape.paths=this.shapes[r].localShapeCollection,this._mdf&&(this.shapes[r].pathsData.length=0);else if(t===1&&e===0||t===0&&e===1){if(this._mdf)for(r=0;r<a;r+=1)this.shapes[r].pathsData.length=0,this.shapes[r].shape._mdf=!0}else{var m=[],p,v;for(r=0;r<a;r+=1)if(p=this.shapes[r],!p.shape._mdf&&!this._mdf&&!n&&this.m!==2)p.shape.paths=p.localShapeCollection;else{if(s=p.shape.paths,c=s._length,f=0,!p.shape._mdf&&p.pathsData.length)f=p.totalShapeLength;else{for(d=this.releasePathsData(p.pathsData),l=0;l<c;l+=1)u=bez.getSegmentsLength(s.shapes[l]),d.push(u),f+=u.totalLength;p.totalShapeLength=f,p.pathsData=d}h+=f,p.shape._mdf=!0}var g=e,y=t,w=0,_;for(r=a-1;r>=0;r-=1)if(p=this.shapes[r],p.shape._mdf){for(v=p.localShapeCollection,v.releaseShapes(),this.m===2&&a>1?(_=this.calculateShapeEdges(e,t,p.totalShapeLength,w,h),w+=p.totalShapeLength):_=[[g,y]],c=_.length,l=0;l<c;l+=1){g=_[l][0],y=_[l][1],m.length=0,y<=1?m.push({s:p.totalShapeLength*g,e:p.totalShapeLength*y}):g>=1?m.push({s:p.totalShapeLength*(g-1),e:p.totalShapeLength*(y-1)}):(m.push({s:p.totalShapeLength*g,e:p.totalShapeLength}),m.push({s:0,e:p.totalShapeLength*(y-1)}));var S=this.addShapes(p,m[0]);if(m[0].s!==m[0].e){if(m.length>1){var C=p.shape.paths.shapes[p.shape.paths._length-1];if(C.c){var A=S.pop();this.addPaths(S,v),S=this.addShapes(p,m[1],A)}else this.addPaths(S,v),S=this.addShapes(p,m[1])}this.addPaths(S,v)}}p.shape.paths=v}}},TrimModifier.prototype.addPaths=function(n,e){var t,o=n.length;for(t=0;t<o;t+=1)e.addShape(n[t])},TrimModifier.prototype.addSegment=function(n,e,t,o,i,s,r){i.setXYAt(e[0],e[1],"o",s),i.setXYAt(t[0],t[1],"i",s+1),r&&i.setXYAt(n[0],n[1],"v",s),i.setXYAt(o[0],o[1],"v",s+1)},TrimModifier.prototype.addSegmentFromArray=function(n,e,t,o){e.setXYAt(n[1],n[5],"o",t),e.setXYAt(n[2],n[6],"i",t+1),o&&e.setXYAt(n[0],n[4],"v",t),e.setXYAt(n[3],n[7],"v",t+1)},TrimModifier.prototype.addShapes=function(n,e,t){var o=n.pathsData,i=n.shape.paths.shapes,s,r=n.shape.paths._length,a,l,c=0,d,u,f,h,m=[],p,v=!0;for(t?(u=t._length,p=t._length):(t=shapePool.newElement(),u=0,p=0),m.push(t),s=0;s<r;s+=1){for(f=o[s].lengths,t.c=i[s].c,l=i[s].c?f.length:f.length+1,a=1;a<l;a+=1)if(d=f[a-1],c+d.addedLength<e.s)c+=d.addedLength,t.c=!1;else if(c>e.e){t.c=!1;break}else e.s<=c&&e.e>=c+d.addedLength?(this.addSegment(i[s].v[a-1],i[s].o[a-1],i[s].i[a],i[s].v[a],t,u,v),v=!1):(h=bez.getNewSegment(i[s].v[a-1],i[s].v[a],i[s].o[a-1],i[s].i[a],(e.s-c)/d.addedLength,(e.e-c)/d.addedLength,f[a-1]),this.addSegmentFromArray(h,t,u,v),v=!1,t.c=!1),c+=d.addedLength,u+=1;if(i[s].c&&f.length){if(d=f[a-1],c<=e.e){var g=f[a-1].addedLength;e.s<=c&&e.e>=c+g?(this.addSegment(i[s].v[a-1],i[s].o[a-1],i[s].i[0],i[s].v[0],t,u,v),v=!1):(h=bez.getNewSegment(i[s].v[a-1],i[s].v[0],i[s].o[a-1],i[s].i[0],(e.s-c)/g,(e.e-c)/g,f[a-1]),this.addSegmentFromArray(h,t,u,v),v=!1,t.c=!1)}else t.c=!1;c+=d.addedLength,u+=1}if(t._length&&(t.setXYAt(t.v[p][0],t.v[p][1],"i",p),t.setXYAt(t.v[t._length-1][0],t.v[t._length-1][1],"o",t._length-1)),c>e.e)break;s<r-1&&(t=shapePool.newElement(),v=!0,m.push(t),u=0)}return m};function PuckerAndBloatModifier(){}extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(n,e){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(n,e.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(n,e){var t=e/100,o=[0,0],i=n._length,s=0;for(s=0;s<i;s+=1)o[0]+=n.v[s][0],o[1]+=n.v[s][1];o[0]/=i,o[1]/=i;var r=shapePool.newElement();r.c=n.c;var a,l,c,d,u,f;for(s=0;s<i;s+=1)a=n.v[s][0]+(o[0]-n.v[s][0])*t,l=n.v[s][1]+(o[1]-n.v[s][1])*t,c=n.o[s][0]+(o[0]-n.o[s][0])*-t,d=n.o[s][1]+(o[1]-n.o[s][1])*-t,u=n.i[s][0]+(o[0]-n.i[s][0])*-t,f=n.i[s][1]+(o[1]-n.i[s][1])*-t,r.setTripleAt(a,l,c,d,u,f,s);return r},PuckerAndBloatModifier.prototype.processShapes=function(n){var e,t,o=this.shapes.length,i,s,r=this.amount.v;if(r!==0){var a,l;for(t=0;t<o;t+=1){if(a=this.shapes[t],l=a.localShapeCollection,!(!a.shape._mdf&&!this._mdf&&!n))for(l.releaseShapes(),a.shape._mdf=!0,e=a.shape.paths.shapes,s=a.shape.paths._length,i=0;i<s;i+=1)l.addShape(this.processPath(e[i],r));a.shape.paths=a.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var n=[0,0];function e(l){var c=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||c,this.a&&l.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&l.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&l.skewFromAxis(-this.sk.v,this.sa.v),this.r?l.rotate(-this.r.v):l.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?l.translate(this.px.v,this.py.v,-this.pz.v):l.translate(this.px.v,this.py.v,0):l.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}function t(l){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||l){var c;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var d,u;if(c=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(d=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/c,0),u=this.p.getValueAtTime(this.p.keyframes[0].t/c,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(d=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/c,0),u=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/c,0)):(d=this.p.pv,u=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/c,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){d=[],u=[];var f=this.px,h=this.py;f._caching.lastFrame+f.offsetTime<=f.keyframes[0].t?(d[0]=f.getValueAtTime((f.keyframes[0].t+.01)/c,0),d[1]=h.getValueAtTime((h.keyframes[0].t+.01)/c,0),u[0]=f.getValueAtTime(f.keyframes[0].t/c,0),u[1]=h.getValueAtTime(h.keyframes[0].t/c,0)):f._caching.lastFrame+f.offsetTime>=f.keyframes[f.keyframes.length-1].t?(d[0]=f.getValueAtTime(f.keyframes[f.keyframes.length-1].t/c,0),d[1]=h.getValueAtTime(h.keyframes[h.keyframes.length-1].t/c,0),u[0]=f.getValueAtTime((f.keyframes[f.keyframes.length-1].t-.01)/c,0),u[1]=h.getValueAtTime((h.keyframes[h.keyframes.length-1].t-.01)/c,0)):(d=[f.pv,h.pv],u[0]=f.getValueAtTime((f._caching.lastFrame+f.offsetTime-.01)/c,f.offsetTime),u[1]=h.getValueAtTime((h._caching.lastFrame+h.offsetTime-.01)/c,h.offsetTime))}else u=n,d=u;this.v.rotate(-Math.atan2(d[1]-u[1],d[0]-u[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}}function o(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length)this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1;else return;if(!this.s.effectsSequence.length)this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2;else return;if(this.sk)if(!this.sk.effectsSequence.length&&!this.sa.effectsSequence.length)this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3;else return;this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):!this.rz.effectsSequence.length&&!this.ry.effectsSequence.length&&!this.rx.effectsSequence.length&&!this.or.effectsSequence.length&&(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}function i(){}function s(l){this._addDynamicProperty(l),this.elem.addDynamicProperty(l),this._isDirty=!0}function r(l,c,d){if(this.elem=l,this.frameId=-1,this.propType="transform",this.data=c,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(d||l),c.p&&c.p.s?(this.px=PropertyFactory.getProp(l,c.p.x,0,0,this),this.py=PropertyFactory.getProp(l,c.p.y,0,0,this),c.p.z&&(this.pz=PropertyFactory.getProp(l,c.p.z,0,0,this))):this.p=PropertyFactory.getProp(l,c.p||{k:[0,0,0]},1,0,this),c.rx){if(this.rx=PropertyFactory.getProp(l,c.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(l,c.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(l,c.rz,0,degToRads,this),c.or.k[0].ti){var u,f=c.or.k.length;for(u=0;u<f;u+=1)c.or.k[u].to=null,c.or.k[u].ti=null}this.or=PropertyFactory.getProp(l,c.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(l,c.r||{k:0},0,degToRads,this);c.sk&&(this.sk=PropertyFactory.getProp(l,c.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(l,c.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(l,c.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(l,c.s||{k:[100,100,100]},1,.01,this),c.o?this.o=PropertyFactory.getProp(l,c.o,0,.01,l):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}r.prototype={applyToMatrix:e,getValue:t,precalculateMatrix:o,autoOrient:i},extendPrototype([DynamicPropertyContainer],r),r.prototype.addDynamicProperty=s,r.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty;function a(l,c,d){return new r(l,c,d)}return{getTransformProperty:a}}();function RepeaterModifier(){}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(n,e){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(n,e.c,0,null,this),this.o=PropertyFactory.getProp(n,e.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(n,e.tr,this),this.so=PropertyFactory.getProp(n,e.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(n,e.tr.eo,0,.01,this),this.data=e,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(n,e,t,o,i,s){var r=s?-1:1,a=o.s.v[0]+(1-o.s.v[0])*(1-i),l=o.s.v[1]+(1-o.s.v[1])*(1-i);n.translate(o.p.v[0]*r*i,o.p.v[1]*r*i,o.p.v[2]),e.translate(-o.a.v[0],-o.a.v[1],o.a.v[2]),e.rotate(-o.r.v*r*i),e.translate(o.a.v[0],o.a.v[1],o.a.v[2]),t.translate(-o.a.v[0],-o.a.v[1],o.a.v[2]),t.scale(s?1/a:a,s?1/l:l),t.translate(o.a.v[0],o.a.v[1],o.a.v[2])},RepeaterModifier.prototype.init=function(n,e,t,o){for(this.elem=n,this.arr=e,this.pos=t,this.elemsData=o,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(n),this.initModifierProperties(n,e[t]);t>0;)t-=1,this._elements.unshift(e[t]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(n){var e,t=n.length;for(e=0;e<t;e+=1)n[e]._processed=!1,n[e].ty==="gr"&&this.resetElements(n[e].it)},RepeaterModifier.prototype.cloneElements=function(n){var e=JSON.parse(JSON.stringify(n));return this.resetElements(e),e},RepeaterModifier.prototype.changeGroupRender=function(n,e){var t,o=n.length;for(t=0;t<o;t+=1)n[t]._render=e,n[t].ty==="gr"&&this.changeGroupRender(n[t].it,e)},RepeaterModifier.prototype.processShapes=function(n){var e,t,o,i,s,r=!1;if(this._mdf||n){var a=Math.ceil(this.c.v);if(this._groups.length<a){for(;this._groups.length<a;){var l={it:this.cloneElements(this._elements),ty:"gr"};l.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,l),this._groups.splice(0,0,l),this._currentCopies+=1}this.elem.reloadShapes(),r=!0}s=0;var c;for(o=0;o<=this._groups.length-1;o+=1){if(c=s<a,this._groups[o]._render=c,this.changeGroupRender(this._groups[o].it,c),!c){var d=this.elemsData[o].it,u=d[d.length-1];u.transform.op.v!==0?(u.transform.op._mdf=!0,u.transform.op.v=0):u.transform.op._mdf=!1}s+=1}this._currentCopies=a;var f=this.o.v,h=f%1,m=f>0?Math.floor(f):Math.ceil(f),p=this.pMatrix.props,v=this.rMatrix.props,g=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var y=0;if(f>0){for(;y<m;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),y+=1;h&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,h,!1),y+=h)}else if(f<0){for(;y>m;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),y-=1;h&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-h,!0),y-=h)}o=this.data.m===1?0:this._currentCopies-1,i=this.data.m===1?1:-1,s=this._currentCopies;for(var w,_;s;){if(e=this.elemsData[o].it,t=e[e.length-1].transform.mProps.v.props,_=t.length,e[e.length-1].transform.mProps._mdf=!0,e[e.length-1].transform.op._mdf=!0,e[e.length-1].transform.op.v=this._currentCopies===1?this.so.v:this.so.v+(this.eo.v-this.so.v)*(o/(this._currentCopies-1)),y!==0){for((o!==0&&i===1||o!==this._currentCopies-1&&i===-1)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15]),this.matrix.transform(g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8],g[9],g[10],g[11],g[12],g[13],g[14],g[15]),this.matrix.transform(p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],p[8],p[9],p[10],p[11],p[12],p[13],p[14],p[15]),w=0;w<_;w+=1)t[w]=this.matrix.props[w];this.matrix.reset()}else for(this.matrix.reset(),w=0;w<_;w+=1)t[w]=this.matrix.props[w];y+=1,s-=1,o+=i}}else for(s=this._currentCopies,o=0,i=1;s;)e=this.elemsData[o].it,t=e[e.length-1].transform.mProps.v.props,e[e.length-1].transform.mProps._mdf=!1,e[e.length-1].transform.op._mdf=!1,s-=1,o+=i;return r},RepeaterModifier.prototype.addShape=function(){};function RoundCornersModifier(){}extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(n,e){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(n,e.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(n,e){var t=shapePool.newElement();t.c=n.c;var o,i=n._length,s,r,a,l,c,d,u=0,f,h,m,p,v,g;for(o=0;o<i;o+=1)s=n.v[o],a=n.o[o],r=n.i[o],s[0]===a[0]&&s[1]===a[1]&&s[0]===r[0]&&s[1]===r[1]?(o===0||o===i-1)&&!n.c?(t.setTripleAt(s[0],s[1],a[0],a[1],r[0],r[1],u),u+=1):(o===0?l=n.v[i-1]:l=n.v[o-1],c=Math.sqrt(Math.pow(s[0]-l[0],2)+Math.pow(s[1]-l[1],2)),d=c?Math.min(c/2,e)/c:0,v=s[0]+(l[0]-s[0])*d,f=v,g=s[1]-(s[1]-l[1])*d,h=g,m=f-(f-s[0])*roundCorner,p=h-(h-s[1])*roundCorner,t.setTripleAt(f,h,m,p,v,g,u),u+=1,o===i-1?l=n.v[0]:l=n.v[o+1],c=Math.sqrt(Math.pow(s[0]-l[0],2)+Math.pow(s[1]-l[1],2)),d=c?Math.min(c/2,e)/c:0,m=s[0]+(l[0]-s[0])*d,f=m,p=s[1]+(l[1]-s[1])*d,h=p,v=f-(f-s[0])*roundCorner,g=h-(h-s[1])*roundCorner,t.setTripleAt(f,h,m,p,v,g,u),u+=1):(t.setTripleAt(n.v[o][0],n.v[o][1],n.o[o][0],n.o[o][1],n.i[o][0],n.i[o][1],u),u+=1);return t},RoundCornersModifier.prototype.processShapes=function(n){var e,t,o=this.shapes.length,i,s,r=this.rd.v;if(r!==0){var a,l;for(t=0;t<o;t+=1){if(a=this.shapes[t],l=a.localShapeCollection,!(!a.shape._mdf&&!this._mdf&&!n))for(l.releaseShapes(),a.shape._mdf=!0,e=a.shape.paths.shapes,s=a.shape.paths._length,i=0;i<s;i+=1)l.addShape(this.processPath(e[i],r));a.shape.paths=a.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function floatEqual(n,e){return Math.abs(n-e)*1e5<=Math.min(Math.abs(n),Math.abs(e))}function floatZero(n){return Math.abs(n)<=1e-5}function lerp(n,e,t){return n*(1-t)+e*t}function lerpPoint(n,e,t){return[lerp(n[0],e[0],t),lerp(n[1],e[1],t)]}function quadRoots(n,e,t){if(n===0)return[];var o=e*e-4*n*t;if(o<0)return[];var i=-e/(2*n);if(o===0)return[i];var s=Math.sqrt(o)/(2*n);return[i-s,i+s]}function polynomialCoefficients(n,e,t,o){return[-n+3*e-3*t+o,3*n-6*e+3*t,-3*n+3*e,n]}function singlePoint(n){return new PolynomialBezier(n,n,n,n,!1)}function PolynomialBezier(n,e,t,o,i){i&&pointEqual(n,e)&&(e=lerpPoint(n,o,1/3)),i&&pointEqual(t,o)&&(t=lerpPoint(n,o,2/3));var s=polynomialCoefficients(n[0],e[0],t[0],o[0]),r=polynomialCoefficients(n[1],e[1],t[1],o[1]);this.a=[s[0],r[0]],this.b=[s[1],r[1]],this.c=[s[2],r[2]],this.d=[s[3],r[3]],this.points=[n,e,t,o]}PolynomialBezier.prototype.point=function(n){return[((this.a[0]*n+this.b[0])*n+this.c[0])*n+this.d[0],((this.a[1]*n+this.b[1])*n+this.c[1])*n+this.d[1]]},PolynomialBezier.prototype.derivative=function(n){return[(3*n*this.a[0]+2*this.b[0])*n+this.c[0],(3*n*this.a[1]+2*this.b[1])*n+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(n){var e=this.derivative(n);return Math.atan2(e[1],e[0])},PolynomialBezier.prototype.normalAngle=function(n){var e=this.derivative(n);return Math.atan2(e[0],e[1])},PolynomialBezier.prototype.inflectionPoints=function(){var n=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(n))return[];var e=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/n,t=e*e-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/n;if(t<0)return[];var o=Math.sqrt(t);return floatZero(o)?o>0&&o<1?[e]:[]:[e-o,e+o].filter(function(i){return i>0&&i<1})},PolynomialBezier.prototype.split=function(n){if(n<=0)return[singlePoint(this.points[0]),this];if(n>=1)return[this,singlePoint(this.points[this.points.length-1])];var e=lerpPoint(this.points[0],this.points[1],n),t=lerpPoint(this.points[1],this.points[2],n),o=lerpPoint(this.points[2],this.points[3],n),i=lerpPoint(e,t,n),s=lerpPoint(t,o,n),r=lerpPoint(i,s,n);return[new PolynomialBezier(this.points[0],e,i,r,!0),new PolynomialBezier(r,s,o,this.points[3],!0)]};function extrema(n,e){var t=n.points[0][e],o=n.points[n.points.length-1][e];if(t>o){var i=o;o=t,t=i}for(var s=quadRoots(3*n.a[e],2*n.b[e],n.c[e]),r=0;r<s.length;r+=1)if(s[r]>0&&s[r]<1){var a=n.point(s[r])[e];a<t?t=a:a>o&&(o=a)}return{min:t,max:o}}PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var n=this.bounds();return{left:n.x.min,right:n.x.max,top:n.y.min,bottom:n.y.max,width:n.x.max-n.x.min,height:n.y.max-n.y.min,cx:(n.x.max+n.x.min)/2,cy:(n.y.max+n.y.min)/2}};function intersectData(n,e,t){var o=n.boundingBox();return{cx:o.cx,cy:o.cy,width:o.width,height:o.height,bez:n,t:(e+t)/2,t1:e,t2:t}}function splitData(n){var e=n.bez.split(.5);return[intersectData(e[0],n.t1,n.t),intersectData(e[1],n.t,n.t2)]}function boxIntersect(n,e){return Math.abs(n.cx-e.cx)*2<n.width+e.width&&Math.abs(n.cy-e.cy)*2<n.height+e.height}function intersectsImpl(n,e,t,o,i,s){if(boxIntersect(n,e)){if(t>=s||n.width<=o&&n.height<=o&&e.width<=o&&e.height<=o){i.push([n.t,e.t]);return}var r=splitData(n),a=splitData(e);intersectsImpl(r[0],a[0],t+1,o,i,s),intersectsImpl(r[0],a[1],t+1,o,i,s),intersectsImpl(r[1],a[0],t+1,o,i,s),intersectsImpl(r[1],a[1],t+1,o,i,s)}}PolynomialBezier.prototype.intersections=function(n,e,t){e===void 0&&(e=2),t===void 0&&(t=7);var o=[];return intersectsImpl(intersectData(this,0,1),intersectData(n,0,1),0,e,o,t),o},PolynomialBezier.shapeSegment=function(n,e){var t=(e+1)%n.length();return new PolynomialBezier(n.v[e],n.o[e],n.i[t],n.v[t],!0)},PolynomialBezier.shapeSegmentInverted=function(n,e){var t=(e+1)%n.length();return new PolynomialBezier(n.v[t],n.i[t],n.o[e],n.v[e],!0)};function crossProduct(n,e){return[n[1]*e[2]-n[2]*e[1],n[2]*e[0]-n[0]*e[2],n[0]*e[1]-n[1]*e[0]]}function lineIntersection(n,e,t,o){var i=[n[0],n[1],1],s=[e[0],e[1],1],r=[t[0],t[1],1],a=[o[0],o[1],1],l=crossProduct(crossProduct(i,s),crossProduct(r,a));return floatZero(l[2])?null:[l[0]/l[2],l[1]/l[2]]}function polarOffset(n,e,t){return[n[0]+Math.cos(e)*t,n[1]-Math.sin(e)*t]}function pointDistance(n,e){return Math.hypot(n[0]-e[0],n[1]-e[1])}function pointEqual(n,e){return floatEqual(n[0],e[0])&&floatEqual(n[1],e[1])}function ZigZagModifier(){}extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(n,e){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(n,e.s,0,null,this),this.frequency=PropertyFactory.getProp(n,e.r,0,null,this),this.pointsType=PropertyFactory.getProp(n,e.pt,0,null,this),this._isAnimated=this.amplitude.effectsSequence.length!==0||this.frequency.effectsSequence.length!==0||this.pointsType.effectsSequence.length!==0};function setPoint(n,e,t,o,i,s,r){var a=t-Math.PI/2,l=t+Math.PI/2,c=e[0]+Math.cos(t)*o*i,d=e[1]-Math.sin(t)*o*i;n.setTripleAt(c,d,c+Math.cos(a)*s,d-Math.sin(a)*s,c+Math.cos(l)*r,d-Math.sin(l)*r,n.length())}function getPerpendicularVector(n,e){var t=[e[0]-n[0],e[1]-n[1]],o=-Math.PI*.5,i=[Math.cos(o)*t[0]-Math.sin(o)*t[1],Math.sin(o)*t[0]+Math.cos(o)*t[1]];return i}function getProjectingAngle(n,e){var t=e===0?n.length()-1:e-1,o=(e+1)%n.length(),i=n.v[t],s=n.v[o],r=getPerpendicularVector(i,s);return Math.atan2(0,1)-Math.atan2(r[1],r[0])}function zigZagCorner(n,e,t,o,i,s,r){var a=getProjectingAngle(e,t),l=e.v[t%e._length],c=e.v[t===0?e._length-1:t-1],d=e.v[(t+1)%e._length],u=s===2?Math.sqrt(Math.pow(l[0]-c[0],2)+Math.pow(l[1]-c[1],2)):0,f=s===2?Math.sqrt(Math.pow(l[0]-d[0],2)+Math.pow(l[1]-d[1],2)):0;setPoint(n,e.v[t%e._length],a,r,o,f/((i+1)*2),u/((i+1)*2))}function zigZagSegment(n,e,t,o,i,s){for(var r=0;r<o;r+=1){var a=(r+1)/(o+1),l=i===2?Math.sqrt(Math.pow(e.points[3][0]-e.points[0][0],2)+Math.pow(e.points[3][1]-e.points[0][1],2)):0,c=e.normalAngle(a),d=e.point(a);setPoint(n,d,c,s,t,l/((o+1)*2),l/((o+1)*2)),s=-s}return s}ZigZagModifier.prototype.processPath=function(n,e,t,o){var i=n._length,s=shapePool.newElement();if(s.c=n.c,n.c||(i-=1),i===0)return s;var r=-1,a=PolynomialBezier.shapeSegment(n,0);zigZagCorner(s,n,0,e,t,o,r);for(var l=0;l<i;l+=1)r=zigZagSegment(s,a,e,t,o,-r),l===i-1&&!n.c?a=null:a=PolynomialBezier.shapeSegment(n,(l+1)%i),zigZagCorner(s,n,l+1,e,t,o,r);return s},ZigZagModifier.prototype.processShapes=function(n){var e,t,o=this.shapes.length,i,s,r=this.amplitude.v,a=Math.max(0,Math.round(this.frequency.v)),l=this.pointsType.v;if(r!==0){var c,d;for(t=0;t<o;t+=1){if(c=this.shapes[t],d=c.localShapeCollection,!(!c.shape._mdf&&!this._mdf&&!n))for(d.releaseShapes(),c.shape._mdf=!0,e=c.shape.paths.shapes,s=c.shape.paths._length,i=0;i<s;i+=1)d.addShape(this.processPath(e[i],r,a,l));c.shape.paths=c.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function linearOffset(n,e,t){var o=Math.atan2(e[0]-n[0],e[1]-n[1]);return[polarOffset(n,o,t),polarOffset(e,o,t)]}function offsetSegment(n,e){var t,o,i,s,r,a,l;l=linearOffset(n.points[0],n.points[1],e),t=l[0],o=l[1],l=linearOffset(n.points[1],n.points[2],e),i=l[0],s=l[1],l=linearOffset(n.points[2],n.points[3],e),r=l[0],a=l[1];var c=lineIntersection(t,o,i,s);c===null&&(c=o);var d=lineIntersection(r,a,i,s);return d===null&&(d=r),new PolynomialBezier(t,c,d,a)}function joinLines(n,e,t,o,i){var s=e.points[3],r=t.points[0];if(o===3||pointEqual(s,r))return s;if(o===2){var a=-e.tangentAngle(1),l=-t.tangentAngle(0)+Math.PI,c=lineIntersection(s,polarOffset(s,a+Math.PI/2,100),r,polarOffset(r,a+Math.PI/2,100)),d=c?pointDistance(c,s):pointDistance(s,r)/2,u=polarOffset(s,a,2*d*roundCorner);return n.setXYAt(u[0],u[1],"o",n.length()-1),u=polarOffset(r,l,2*d*roundCorner),n.setTripleAt(r[0],r[1],r[0],r[1],u[0],u[1],n.length()),r}var f=pointEqual(s,e.points[2])?e.points[0]:e.points[2],h=pointEqual(r,t.points[1])?t.points[3]:t.points[1],m=lineIntersection(f,s,r,h);return m&&pointDistance(m,s)<i?(n.setTripleAt(m[0],m[1],m[0],m[1],m[0],m[1],n.length()),m):s}function getIntersection(n,e){var t=n.intersections(e);return t.length&&floatEqual(t[0][0],1)&&t.shift(),t.length?t[0]:null}function pruneSegmentIntersection(n,e){var t=n.slice(),o=e.slice(),i=getIntersection(n[n.length-1],e[0]);return i&&(t[n.length-1]=n[n.length-1].split(i[0])[0],o[0]=e[0].split(i[1])[1]),n.length>1&&e.length>1&&(i=getIntersection(n[0],e[e.length-1]),i)?[[n[0].split(i[0])[0]],[e[e.length-1].split(i[1])[1]]]:[t,o]}function pruneIntersections(n){for(var e,t=1;t<n.length;t+=1)e=pruneSegmentIntersection(n[t-1],n[t]),n[t-1]=e[0],n[t]=e[1];return n.length>1&&(e=pruneSegmentIntersection(n[n.length-1],n[0]),n[n.length-1]=e[0],n[0]=e[1]),n}function offsetSegmentSplit(n,e){var t=n.inflectionPoints(),o,i,s,r;if(t.length===0)return[offsetSegment(n,e)];if(t.length===1||floatEqual(t[1],1))return s=n.split(t[0]),o=s[0],i=s[1],[offsetSegment(o,e),offsetSegment(i,e)];s=n.split(t[0]),o=s[0];var a=(t[1]-t[0])/(1-t[0]);return s=s[1].split(a),r=s[0],i=s[1],[offsetSegment(o,e),offsetSegment(r,e),offsetSegment(i,e)]}function OffsetPathModifier(){}extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(n,e){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(n,e.a,0,null,this),this.miterLimit=PropertyFactory.getProp(n,e.ml,0,null,this),this.lineJoin=e.lj,this._isAnimated=this.amount.effectsSequence.length!==0},OffsetPathModifier.prototype.processPath=function(n,e,t,o){var i=shapePool.newElement();i.c=n.c;var s=n.length();n.c||(s-=1);var r,a,l,c=[];for(r=0;r<s;r+=1)l=PolynomialBezier.shapeSegment(n,r),c.push(offsetSegmentSplit(l,e));if(!n.c)for(r=s-1;r>=0;r-=1)l=PolynomialBezier.shapeSegmentInverted(n,r),c.push(offsetSegmentSplit(l,e));c=pruneIntersections(c);var d=null,u=null;for(r=0;r<c.length;r+=1){var f=c[r];for(u&&(d=joinLines(i,u,f[0],t,o)),u=f[f.length-1],a=0;a<f.length;a+=1)l=f[a],d&&pointEqual(l.points[0],d)?i.setXYAt(l.points[1][0],l.points[1][1],"o",i.length()-1):i.setTripleAt(l.points[0][0],l.points[0][1],l.points[1][0],l.points[1][1],l.points[0][0],l.points[0][1],i.length()),i.setTripleAt(l.points[3][0],l.points[3][1],l.points[3][0],l.points[3][1],l.points[2][0],l.points[2][1],i.length()),d=l.points[3]}return c.length&&joinLines(i,u,c[0][0],t,o),i},OffsetPathModifier.prototype.processShapes=function(n){var e,t,o=this.shapes.length,i,s,r=this.amount.v,a=this.miterLimit.v,l=this.lineJoin;if(r!==0){var c,d;for(t=0;t<o;t+=1){if(c=this.shapes[t],d=c.localShapeCollection,!(!c.shape._mdf&&!this._mdf&&!n))for(d.releaseShapes(),c.shape._mdf=!0,e=c.shape.paths.shapes,s=c.shape.paths._length,i=0;i<s;i+=1)d.addShape(this.processPath(e[i],r,l,a));c.shape.paths=c.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function getFontProperties(n){for(var e=n.fStyle?n.fStyle.split(" "):[],t="normal",o="normal",i=e.length,s,r=0;r<i;r+=1)switch(s=e[r].toLowerCase(),s){case"italic":o="italic";break;case"bold":t="700";break;case"black":t="900";break;case"medium":t="500";break;case"regular":case"normal":t="400";break;case"light":case"thin":t="200";break}return{style:o,weight:n.fWeight||t}}var FontManager=function(){var n=5e3,e={w:0,size:0,shapes:[],data:{shapes:[]}},t=[];t=t.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var o=127988,i=917631,s=917601,r=917626,a=65039,l=8205,c=127462,d=127487,u=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function f(T){var D=T.split(","),P,L=D.length,B=[];for(P=0;P<L;P+=1)D[P]!=="sans-serif"&&D[P]!=="monospace"&&B.push(D[P]);return B.join(",")}function h(T,D){var P=createTag("span");P.setAttribute("aria-hidden",!0),P.style.fontFamily=D;var L=createTag("span");L.innerText="giItT1WQy@!-/#",P.style.position="absolute",P.style.left="-10000px",P.style.top="-10000px",P.style.fontSize="300px",P.style.fontVariant="normal",P.style.fontStyle="normal",P.style.fontWeight="normal",P.style.letterSpacing="0",P.appendChild(L),document.body.appendChild(P);var B=L.offsetWidth;return L.style.fontFamily=f(T)+", "+D,{node:L,w:B,parent:P}}function m(){var T,D=this.fonts.length,P,L,B=D;for(T=0;T<D;T+=1)this.fonts[T].loaded?B-=1:this.fonts[T].fOrigin==="n"||this.fonts[T].origin===0?this.fonts[T].loaded=!0:(P=this.fonts[T].monoCase.node,L=this.fonts[T].monoCase.w,P.offsetWidth!==L?(B-=1,this.fonts[T].loaded=!0):(P=this.fonts[T].sansCase.node,L=this.fonts[T].sansCase.w,P.offsetWidth!==L&&(B-=1,this.fonts[T].loaded=!0)),this.fonts[T].loaded&&(this.fonts[T].sansCase.parent.parentNode.removeChild(this.fonts[T].sansCase.parent),this.fonts[T].monoCase.parent.parentNode.removeChild(this.fonts[T].monoCase.parent)));B!==0&&Date.now()-this.initTime<n?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)}function p(T,D){var P=document.body&&D?"svg":"canvas",L,B=getFontProperties(T);if(P==="svg"){var b=createNS("text");b.style.fontSize="100px",b.setAttribute("font-family",T.fFamily),b.setAttribute("font-style",B.style),b.setAttribute("font-weight",B.weight),b.textContent="1",T.fClass?(b.style.fontFamily="inherit",b.setAttribute("class",T.fClass)):b.style.fontFamily=T.fFamily,D.appendChild(b),L=b}else{var z=new OffscreenCanvas(500,500).getContext("2d");z.font=B.style+" "+B.weight+" 100px "+T.fFamily,L=z}function N(G){return P==="svg"?(L.textContent=G,L.getComputedTextLength()):L.measureText(G).width}return{measureText:N}}function v(T,D){if(!T){this.isLoaded=!0;return}if(this.chars){this.isLoaded=!0,this.fonts=T.list;return}if(!document.body){this.isLoaded=!0,T.list.forEach(function(se){se.helper=p(se),se.cache={}}),this.fonts=T.list;return}var P=T.list,L,B=P.length,b=B;for(L=0;L<B;L+=1){var z=!0,N,G;if(P[L].loaded=!1,P[L].monoCase=h(P[L].fFamily,"monospace"),P[L].sansCase=h(P[L].fFamily,"sans-serif"),!P[L].fPath)P[L].loaded=!0,b-=1;else if(P[L].fOrigin==="p"||P[L].origin===3){if(N=document.querySelectorAll('style[f-forigin="p"][f-family="'+P[L].fFamily+'"], style[f-origin="3"][f-family="'+P[L].fFamily+'"]'),N.length>0&&(z=!1),z){var K=createTag("style");K.setAttribute("f-forigin",P[L].fOrigin),K.setAttribute("f-origin",P[L].origin),K.setAttribute("f-family",P[L].fFamily),K.type="text/css",K.innerText="@font-face {font-family: "+P[L].fFamily+"; font-style: normal; src: url('"+P[L].fPath+"');}",D.appendChild(K)}}else if(P[L].fOrigin==="g"||P[L].origin===1){for(N=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),G=0;G<N.length;G+=1)N[G].href.indexOf(P[L].fPath)!==-1&&(z=!1);if(z){var ne=createTag("link");ne.setAttribute("f-forigin",P[L].fOrigin),ne.setAttribute("f-origin",P[L].origin),ne.type="text/css",ne.rel="stylesheet",ne.href=P[L].fPath,document.body.appendChild(ne)}}else if(P[L].fOrigin==="t"||P[L].origin===2){for(N=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),G=0;G<N.length;G+=1)P[L].fPath===N[G].src&&(z=!1);if(z){var J=createTag("link");J.setAttribute("f-forigin",P[L].fOrigin),J.setAttribute("f-origin",P[L].origin),J.setAttribute("rel","stylesheet"),J.setAttribute("href",P[L].fPath),D.appendChild(J)}}P[L].helper=p(P[L],D),P[L].cache={},this.fonts.push(P[L])}b===0?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}function g(T){if(T){this.chars||(this.chars=[]);var D,P=T.length,L,B=this.chars.length,b;for(D=0;D<P;D+=1){for(L=0,b=!1;L<B;)this.chars[L].style===T[D].style&&this.chars[L].fFamily===T[D].fFamily&&this.chars[L].ch===T[D].ch&&(b=!0),L+=1;b||(this.chars.push(T[D]),B+=1)}}}function y(T,D,P){for(var L=0,B=this.chars.length;L<B;){if(this.chars[L].ch===T&&this.chars[L].style===D&&this.chars[L].fFamily===P)return this.chars[L];L+=1}return(typeof T=="string"&&T.charCodeAt(0)!==13||!T)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",T,D,P)),e}function w(T,D,P){var L=this.getFontByName(D),B=T;if(!L.cache[B]){var b=L.helper;if(T===" "){var z=b.measureText("|"+T+"|"),N=b.measureText("||");L.cache[B]=(z-N)/100}else L.cache[B]=b.measureText(T)/100}return L.cache[B]*P}function _(T){for(var D=0,P=this.fonts.length;D<P;){if(this.fonts[D].fName===T)return this.fonts[D];D+=1}return this.fonts[0]}function S(T){var D=0,P=T.charCodeAt(0);if(P>=55296&&P<=56319){var L=T.charCodeAt(1);L>=56320&&L<=57343&&(D=(P-55296)*1024+L-56320+65536)}return D}function C(T,D){var P=T.toString(16)+D.toString(16);return u.indexOf(P)!==-1}function A(T){return T===l}function E(T){return T===a}function k(T){var D=S(T);return D>=c&&D<=d}function I(T){return k(T.substr(0,2))&&k(T.substr(2,2))}function F(T){return t.indexOf(T)!==-1}function M(T,D){var P=S(T.substr(D,2));if(P!==o)return!1;var L=0;for(D+=2;L<5;){if(P=S(T.substr(D,2)),P<s||P>r)return!1;L+=1,D+=2}return S(T.substr(D,2))===i}function R(){this.isLoaded=!0}var O=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};O.isModifier=C,O.isZeroWidthJoiner=A,O.isFlagEmoji=I,O.isRegionalCode=k,O.isCombinedCharacter=F,O.isRegionalFlag=M,O.isVariationSelector=E,O.BLACK_FLAG_CODE_POINT=o;var $={addChars:g,addFonts:v,getCharData:y,getFontByName:_,measureText:w,checkLoadedFonts:m,setIsLoaded:R};return O.prototype=$,O}();function SlotManager(n){this.animationData=n}SlotManager.prototype.getProp=function(n){return this.animationData.slots&&this.animationData.slots[n.sid]?Object.assign(n,this.animationData.slots[n.sid].p):n};function slotFactory(n){return new SlotManager(n)}function RenderableElement(){}RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(e){this.renderableComponents.indexOf(e)===-1&&this.renderableComponents.push(e)},removeRenderableComponent:function(e){this.renderableComponents.indexOf(e)!==-1&&this.renderableComponents.splice(this.renderableComponents.indexOf(e),1)},prepareRenderableFrame:function(e){this.checkLayerLimits(e)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(e){this.data.ip-this.data.st<=e&&this.data.op-this.data.st>e?this.isInRange!==!0&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):this.isInRange!==!1&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var e,t=this.renderableComponents.length;for(e=0;e<t;e+=1)this.renderableComponents[e].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return this.data.ty===5?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=function(){var n={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(e){return n[e]||""}}();function SliderEffect(n,e,t){this.p=PropertyFactory.getProp(e,n.v,0,0,t)}function AngleEffect(n,e,t){this.p=PropertyFactory.getProp(e,n.v,0,0,t)}function ColorEffect(n,e,t){this.p=PropertyFactory.getProp(e,n.v,1,0,t)}function PointEffect(n,e,t){this.p=PropertyFactory.getProp(e,n.v,1,0,t)}function LayerIndexEffect(n,e,t){this.p=PropertyFactory.getProp(e,n.v,0,0,t)}function MaskIndexEffect(n,e,t){this.p=PropertyFactory.getProp(e,n.v,0,0,t)}function CheckboxEffect(n,e,t){this.p=PropertyFactory.getProp(e,n.v,0,0,t)}function NoValueEffect(){this.p={}}function EffectsManager(n,e){var t=n.ef||[];this.effectElements=[];var o,i=t.length,s;for(o=0;o<i;o+=1)s=new GroupEffect(t[o],e),this.effectElements.push(s)}function GroupEffect(n,e){this.init(n,e)}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(n,e){this.data=n,this.effectElements=[],this.initDynamicPropertyContainer(e);var t,o=this.data.ef.length,i,s=this.data.ef;for(t=0;t<o;t+=1){switch(i=null,s[t].ty){case 0:i=new SliderEffect(s[t],e,this);break;case 1:i=new AngleEffect(s[t],e,this);break;case 2:i=new ColorEffect(s[t],e,this);break;case 3:i=new PointEffect(s[t],e,this);break;case 4:case 7:i=new CheckboxEffect(s[t],e,this);break;case 10:i=new LayerIndexEffect(s[t],e,this);break;case 11:i=new MaskIndexEffect(s[t],e,this);break;case 5:i=new EffectsManager(s[t],e);break;default:i=new NoValueEffect(s[t]);break}i&&this.effectElements.push(i)}};function BaseElement(){}BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var e=0,t=this.data.masksProperties.length;e<t;){if(this.data.masksProperties[e].mode!=="n"&&this.data.masksProperties[e].cl!==!1)return!0;e+=1}return!1},initExpressions:function(){var e=getExpressionInterfaces();if(e){var t=e("layer"),o=e("effects"),i=e("shape"),s=e("text"),r=e("comp");this.layerInterface=t(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var a=o.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(a),this.data.ty===0||this.data.xt?this.compInterface=r(this):this.data.ty===4?(this.layerInterface.shapeInterface=i(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):this.data.ty===5&&(this.layerInterface.textInterface=s(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var e=getBlendMode(this.data.bm),t=this.baseElement||this.layerElement;t.style["mix-blend-mode"]=e},initBaseData:function(e,t,o){this.globalData=t,this.comp=o,this.data=e,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}};function FrameElement(){}FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(e,t){var o,i=this.dynamicProperties.length;for(o=0;o<i;o+=1)(t||this._isParent&&this.dynamicProperties[o].propType==="transform")&&(this.dynamicProperties[o].getValue(),this.dynamicProperties[o]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(e){this.dynamicProperties.indexOf(e)===-1&&this.dynamicProperties.push(e)}};function FootageElement(n,e,t){this.initFrame(),this.initRenderable(),this.assetData=e.getAssetData(n.refId),this.footageData=e.imageLoader.getAsset(this.assetData),this.initBaseData(n,e,t)}FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var n=getExpressionInterfaces();if(n){var e=n("footage");this.layerInterface=e(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData};function AudioElement(n,e,t){this.initFrame(),this.initRenderable(),this.assetData=e.getAssetData(n.refId),this.initBaseData(n,e,t),this._isPlaying=!1,this._canPlay=!1;var o=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(o),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=n.tm?PropertyFactory.getProp(this,n.tm,0,e.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,n.au&&n.au.lv?n.au.lv:{k:[100]},1,.01,this)}AudioElement.prototype.prepareFrame=function(n){if(this.prepareRenderableFrame(n,!0),this.prepareProperties(n,!0),this.tm._placeholder)this._currentTime=n/this.data.sr;else{var e=this.tm.v;this._currentTime=e}this._volume=this.lv.v[0];var t=this._volume*this._volumeMultiplier;this._previousVolume!==t&&(this._previousVolume=t,this.audio.volume(t))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(n){this.audio.rate(n)},AudioElement.prototype.volume=function(n){this._volumeMultiplier=n,this._previousVolume=n*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){};function BaseRenderer(){}BaseRenderer.prototype.checkLayers=function(n){var e,t=this.layers.length,o;for(this.completeLayers=!0,e=t-1;e>=0;e-=1)this.elements[e]||(o=this.layers[e],o.ip-o.st<=n-this.layers[e].st&&o.op-o.st>n-this.layers[e].st&&this.buildItem(e)),this.completeLayers=this.elements[e]?this.completeLayers:!1;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(n){switch(n.ty){case 2:return this.createImage(n);case 0:return this.createComp(n);case 1:return this.createSolid(n);case 3:return this.createNull(n);case 4:return this.createShape(n);case 5:return this.createText(n);case 6:return this.createAudio(n);case 13:return this.createCamera(n);case 15:return this.createFootage(n);default:return this.createNull(n)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(n){return new AudioElement(n,this.globalData,this)},BaseRenderer.prototype.createFootage=function(n){return new FootageElement(n,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var n,e=this.layers.length;for(n=0;n<e;n+=1)this.buildItem(n);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(n){this.completeLayers=!1;var e,t=n.length,o,i=this.layers.length;for(e=0;e<t;e+=1)for(o=0;o<i;){if(this.layers[o].id===n[e].id){this.layers[o]=n[e];break}o+=1}},BaseRenderer.prototype.setProjectInterface=function(n){this.globalData.projectInterface=n},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(n,e,t){for(var o=this.elements,i=this.layers,s=0,r=i.length;s<r;)i[s].ind==e&&(!o[s]||o[s]===!0?(this.buildItem(s),this.addPendingElement(n)):(t.push(o[s]),o[s].setAsParent(),i[s].parent!==void 0?this.buildElementParenting(n,i[s].parent,t):n.setHierarchy(t))),s+=1},BaseRenderer.prototype.addPendingElement=function(n){this.pendingElements.push(n)},BaseRenderer.prototype.searchExtraCompositions=function(n){var e,t=n.length;for(e=0;e<t;e+=1)if(n[e].xt){var o=this.createComp(n[e]);o.initExpressions(),this.globalData.projectInterface.registerComposition(o)}},BaseRenderer.prototype.getElementById=function(n){var e,t=this.elements.length;for(e=0;e<t;e+=1)if(this.elements[e].data.ind===n)return this.elements[e];return null},BaseRenderer.prototype.getElementByPath=function(n){var e=n.shift(),t;if(typeof e=="number")t=this.elements[e];else{var o,i=this.elements.length;for(o=0;o<i;o+=1)if(this.elements[o].data.nm===e){t=this.elements[o];break}}return n.length===0?t:t.getElementByPath(n)},BaseRenderer.prototype.setupGlobalData=function(n,e){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(n),this.globalData.fontManager.addChars(n.chars),this.globalData.fontManager.addFonts(n.fonts,e),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=n.fr,this.globalData.nm=n.nm,this.globalData.compSize={w:n.w,h:n.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}TransformElement.prototype={initTransform:function(){var e=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:e,localMat:e,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var e,t=this.finalTransform.mat,o=0,i=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;o<i;){if(this.hierarchy[o].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}o+=1}if(this.finalTransform._matMdf)for(e=this.finalTransform.mProp.v.props,t.cloneFromProps(e),o=0;o<i;o+=1)t.multiply(this.hierarchy[o].finalTransform.mProp.v)}(!this.localTransforms||this.finalTransform._matMdf)&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var e=0,t=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;e<t;)this.localTransforms[e]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[e]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),e+=1;if(this.finalTransform._localMatMdf){var o=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(o),e=1;e<t;e+=1){var i=this.localTransforms[e].matrix;o.multiply(i)}o.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var s=this.finalTransform.localOpacity;for(e=0;e<t;e+=1)s*=this.localTransforms[e].opacity*.01;this.finalTransform.localOpacity=s}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var e=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(e.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var t=0,o=e.length;for(t=0;t<o;t+=1)this.localTransforms.push(e[t])}}},globalToLocal:function(e){var t=[];t.push(this.finalTransform);for(var o=!0,i=this.comp;o;)i.finalTransform?(i.data.hasMask&&t.splice(0,0,i.finalTransform),i=i.comp):o=!1;var s,r=t.length,a;for(s=0;s<r;s+=1)a=t[s].mat.applyToPointArray(0,0,0),e=[e[0]-a[0],e[1]-a[1],0];return e},mHelper:new Matrix};function MaskElement(n,e,t){this.data=n,this.element=e,this.globalData=t,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var o=this.globalData.defs,i,s=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(s),this.solidPath="";var r,a=this.masksProperties,l=0,c=[],d,u,f=createElementID(),h,m,p,v,g="clipPath",y="clip-path";for(i=0;i<s;i+=1)if((a[i].mode!=="a"&&a[i].mode!=="n"||a[i].inv||a[i].o.k!==100||a[i].o.x)&&(g="mask",y="mask"),(a[i].mode==="s"||a[i].mode==="i")&&l===0?(h=createNS("rect"),h.setAttribute("fill","#ffffff"),h.setAttribute("width",this.element.comp.data.w||0),h.setAttribute("height",this.element.comp.data.h||0),c.push(h)):h=null,r=createNS("path"),a[i].mode==="n")this.viewData[i]={op:PropertyFactory.getProp(this.element,a[i].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,a[i],3),elem:r,lastPath:""},o.appendChild(r);else{l+=1,r.setAttribute("fill",a[i].mode==="s"?"#000000":"#ffffff"),r.setAttribute("clip-rule","nonzero");var w;if(a[i].x.k!==0?(g="mask",y="mask",v=PropertyFactory.getProp(this.element,a[i].x,0,null,this.element),w=createElementID(),m=createNS("filter"),m.setAttribute("id",w),p=createNS("feMorphology"),p.setAttribute("operator","erode"),p.setAttribute("in","SourceGraphic"),p.setAttribute("radius","0"),m.appendChild(p),o.appendChild(m),r.setAttribute("stroke",a[i].mode==="s"?"#000000":"#ffffff")):(p=null,v=null),this.storedData[i]={elem:r,x:v,expan:p,lastPath:"",lastOperator:"",filterId:w,lastRadius:0},a[i].mode==="i"){u=c.length;var _=createNS("g");for(d=0;d<u;d+=1)_.appendChild(c[d]);var S=createNS("mask");S.setAttribute("mask-type","alpha"),S.setAttribute("id",f+"_"+l),S.appendChild(r),o.appendChild(S),_.setAttribute("mask","url("+getLocationHref()+"#"+f+"_"+l+")"),c.length=0,c.push(_)}else c.push(r);a[i].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[i]={elem:r,lastPath:"",op:PropertyFactory.getProp(this.element,a[i].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,a[i],3),invRect:h},this.viewData[i].prop.k||this.drawPath(a[i],this.viewData[i].prop.v,this.viewData[i])}for(this.maskElement=createNS(g),s=c.length,i=0;i<s;i+=1)this.maskElement.appendChild(c[i]);l>0&&(this.maskElement.setAttribute("id",f),this.element.maskedElement.setAttribute(y,"url("+getLocationHref()+"#"+f+")"),o.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}MaskElement.prototype.getMaskProperty=function(n){return this.viewData[n].prop},MaskElement.prototype.renderFrame=function(n){var e=this.element.finalTransform.mat,t,o=this.masksProperties.length;for(t=0;t<o;t+=1)if((this.viewData[t].prop._mdf||n)&&this.drawPath(this.masksProperties[t],this.viewData[t].prop.v,this.viewData[t]),(this.viewData[t].op._mdf||n)&&this.viewData[t].elem.setAttribute("fill-opacity",this.viewData[t].op.v),this.masksProperties[t].mode!=="n"&&(this.viewData[t].invRect&&(this.element.finalTransform.mProp._mdf||n)&&this.viewData[t].invRect.setAttribute("transform",e.getInverseMatrix().to2dCSS()),this.storedData[t].x&&(this.storedData[t].x._mdf||n))){var i=this.storedData[t].expan;this.storedData[t].x.v<0?(this.storedData[t].lastOperator!=="erode"&&(this.storedData[t].lastOperator="erode",this.storedData[t].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[t].filterId+")")),i.setAttribute("radius",-this.storedData[t].x.v)):(this.storedData[t].lastOperator!=="dilate"&&(this.storedData[t].lastOperator="dilate",this.storedData[t].elem.setAttribute("filter",null)),this.storedData[t].elem.setAttribute("stroke-width",this.storedData[t].x.v*2))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var n="M0,0 ";return n+=" h"+this.globalData.compSize.w,n+=" v"+this.globalData.compSize.h,n+=" h-"+this.globalData.compSize.w,n+=" v-"+this.globalData.compSize.h+" ",n},MaskElement.prototype.drawPath=function(n,e,t){var o=" M"+e.v[0][0]+","+e.v[0][1],i,s;for(s=e._length,i=1;i<s;i+=1)o+=" C"+e.o[i-1][0]+","+e.o[i-1][1]+" "+e.i[i][0]+","+e.i[i][1]+" "+e.v[i][0]+","+e.v[i][1];if(e.c&&s>1&&(o+=" C"+e.o[i-1][0]+","+e.o[i-1][1]+" "+e.i[0][0]+","+e.i[0][1]+" "+e.v[0][0]+","+e.v[0][1]),t.lastPath!==o){var r="";t.elem&&(e.c&&(r=n.inv?this.solidPath+o:o),t.elem.setAttribute("d",r)),t.lastPath=o}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var n={};n.createFilter=e,n.createAlphaToLuminanceFilter=t;function e(o,i){var s=createNS("filter");return s.setAttribute("id",o),i!==!0&&(s.setAttribute("filterUnits","objectBoundingBox"),s.setAttribute("x","0%"),s.setAttribute("y","0%"),s.setAttribute("width","100%"),s.setAttribute("height","100%")),s}function t(){var o=createNS("feColorMatrix");return o.setAttribute("type","matrix"),o.setAttribute("color-interpolation-filters","sRGB"),o.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),o}return n}(),featureSupport=function(){var n={maskType:!0,svgLumaHidden:!0,offscreenCanvas:typeof OffscreenCanvas<"u"};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(n.maskType=!1),/firefox/i.test(navigator.userAgent)&&(n.svgLumaHidden=!1),n}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(n){var e,t="SourceGraphic",o=n.data.ef?n.data.ef.length:0,i=createElementID(),s=filtersFactory.createFilter(i,!0),r=0;this.filters=[];var a;for(e=0;e<o;e+=1){a=null;var l=n.data.ef[e].ty;if(registeredEffects$1[l]){var c=registeredEffects$1[l].effect;a=new c(s,n.effectsManager.effectElements[e],n,idPrefix+r,t),t=idPrefix+r,registeredEffects$1[l].countsAsEffect&&(r+=1)}a&&this.filters.push(a)}r&&(n.globalData.defs.appendChild(s),n.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+i+")")),this.filters.length&&n.addRenderableComponent(this)}SVGEffects.prototype.renderFrame=function(n){var e,t=this.filters.length;for(e=0;e<t;e+=1)this.filters[e].renderFrame(n)},SVGEffects.prototype.getEffects=function(n){var e,t=this.filters.length,o=[];for(e=0;e<t;e+=1)this.filters[e].type===n&&o.push(this.filters[e]);return o};function registerEffect$1(n,e,t){registeredEffects$1[n]={effect:e,countsAsEffect:t}}function SVGBaseElement(){}SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var e=null;if(this.data.td){this.matteMasks={};var t=createNS("g");t.setAttribute("id",this.layerId),t.appendChild(this.layerElement),e=t,this.globalData.defs.appendChild(t)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),e=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.ty===0&&!this.data.hd){var o=createNS("clipPath"),i=createNS("path");i.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var s=createElementID();if(o.setAttribute("id",s),o.appendChild(i),this.globalData.defs.appendChild(o),this.checkMasks()){var r=createNS("g");r.setAttribute("clip-path","url("+getLocationHref()+"#"+s+")"),r.appendChild(this.layerElement),this.transformedElement=r,e?e.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+s+")")}this.data.bm!==0&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(e){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[e]){var t=this.layerId+"_"+e,o,i,s,r;if(e===1||e===3){var a=createNS("mask");a.setAttribute("id",t),a.setAttribute("mask-type",e===3?"luminance":"alpha"),s=createNS("use"),s.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),a.appendChild(s),this.globalData.defs.appendChild(a),!featureSupport.maskType&&e===1&&(a.setAttribute("mask-type","luminance"),o=createElementID(),i=filtersFactory.createFilter(o),this.globalData.defs.appendChild(i),i.appendChild(filtersFactory.createAlphaToLuminanceFilter()),r=createNS("g"),r.appendChild(s),a.appendChild(r),r.setAttribute("filter","url("+getLocationHref()+"#"+o+")"))}else if(e===2){var l=createNS("mask");l.setAttribute("id",t),l.setAttribute("mask-type","alpha");var c=createNS("g");l.appendChild(c),o=createElementID(),i=filtersFactory.createFilter(o);var d=createNS("feComponentTransfer");d.setAttribute("in","SourceGraphic"),i.appendChild(d);var u=createNS("feFuncA");u.setAttribute("type","table"),u.setAttribute("tableValues","1.0 0.0"),d.appendChild(u),this.globalData.defs.appendChild(i);var f=createNS("rect");f.setAttribute("width",this.comp.data.w),f.setAttribute("height",this.comp.data.h),f.setAttribute("x","0"),f.setAttribute("y","0"),f.setAttribute("fill","#ffffff"),f.setAttribute("opacity","0"),c.setAttribute("filter","url("+getLocationHref()+"#"+o+")"),c.appendChild(f),s=createNS("use"),s.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),c.appendChild(s),featureSupport.maskType||(l.setAttribute("mask-type","luminance"),i.appendChild(filtersFactory.createAlphaToLuminanceFilter()),r=createNS("g"),c.appendChild(f),r.appendChild(this.layerElement),c.appendChild(r)),this.globalData.defs.appendChild(l)}this.matteMasks[e]=t}return this.matteMasks[e]},setMatte:function(e){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+e+")")}};function HierarchyElement(){}HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(e){this.hierarchy=e},setAsParent:function(){this._isParent=!0},checkParenting:function(){this.data.parent!==void 0&&this.comp.buildElementParenting(this,this.data.parent,[])}};function RenderableDOMElement(){}(function(){var n={initElement:function(t,o,i){this.initFrame(),this.initBaseData(t,o,i),this.initTransform(t,o,i),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){if(!this.hidden&&(!this.isInRange||this.isTransparent)){var t=this.baseElement||this.layerElement;t.style.display="none",this.hidden=!0}},show:function(){if(this.isInRange&&!this.isTransparent){if(!this.data.hd){var t=this.baseElement||this.layerElement;t.style.display="block"}this.hidden=!1,this._isFirstFrame=!0}},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(t){this._mdf=!1,this.prepareRenderableFrame(t),this.prepareProperties(t,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}};extendPrototype([RenderableElement,createProxyFunction(n)],RenderableDOMElement)})();function IImageElement(n,e,t){this.assetData=e.getAssetData(n.refId),this.assetData&&this.assetData.sid&&(this.assetData=e.slotManager.getProp(this.assetData)),this.initElement(n,e,t),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var n=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",n),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect};function ProcessedElement(n,e){this.elem=n,this.pos=e}function IShapeElement(){}IShapeElement.prototype={addShapeToModifiers:function(e){var t,o=this.shapeModifiers.length;for(t=0;t<o;t+=1)this.shapeModifiers[t].addShape(e)},isShapeInAnimatedModifiers:function(e){for(var t=0,o=this.shapeModifiers.length;t<o;)if(this.shapeModifiers[t].isAnimatedWithShape(e))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var e,t=this.shapes.length;for(e=0;e<t;e+=1)this.shapes[e].sh.reset();t=this.shapeModifiers.length;var o;for(e=t-1;e>=0&&(o=this.shapeModifiers[e].processShapes(this._isFirstFrame),!o);e-=1);}},searchProcessedElement:function(e){for(var t=this.processedElements,o=0,i=t.length;o<i;){if(t[o].elem===e)return t[o].pos;o+=1}return 0},addProcessedElement:function(e,t){for(var o=this.processedElements,i=o.length;i;)if(i-=1,o[i].elem===e){o[i].pos=t;return}o.push(new ProcessedElement(e,t))},prepareFrame:function(e){this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(n,e,t){this.caches=[],this.styles=[],this.transformers=n,this.lStr="",this.sh=t,this.lvl=e,this._isAnimated=!!t.k;for(var o=0,i=n.length;o<i;){if(n[o].mProps.dynamicProperties.length){this._isAnimated=!0;break}o+=1}}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0};function SVGStyleData(n,e){this.data=n,this.type=n.ty,this.d="",this.lvl=e,this._mdf=!1,this.closed=n.hd===!0,this.pElem=createNS("path"),this.msElem=null}SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1};function DashProperty(n,e,t,o){this.elem=n,this.frameId=-1,this.dataProps=createSizedArray(e.length),this.renderer=t,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",e.length?e.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(o);var i,s=e.length||0,r;for(i=0;i<s;i+=1)r=PropertyFactory.getProp(n,e[i].v,0,0,this),this.k=r.k||this.k,this.dataProps[i]={n:e[i].n,p:r};this.k||this.getValue(!0),this._isAnimated=this.k}DashProperty.prototype.getValue=function(n){if(!(this.elem.globalData.frameId===this.frameId&&!n)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||n,this._mdf)){var e=0,t=this.dataProps.length;for(this.renderer==="svg"&&(this.dashStr=""),e=0;e<t;e+=1)this.dataProps[e].n!=="o"?this.renderer==="svg"?this.dashStr+=" "+this.dataProps[e].p.v:this.dashArray[e]=this.dataProps[e].p.v:this.dashoffset[0]=this.dataProps[e].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty);function SVGStrokeStyleData(n,e,t){this.initDynamicPropertyContainer(n),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(n,e.o,0,.01,this),this.w=PropertyFactory.getProp(n,e.w,0,null,this),this.d=new DashProperty(n,e.d||{},"svg",this),this.c=PropertyFactory.getProp(n,e.c,1,255,this),this.style=t,this._isAnimated=!!this._isAnimated}extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData);function SVGFillStyleData(n,e,t){this.initDynamicPropertyContainer(n),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(n,e.o,0,.01,this),this.c=PropertyFactory.getProp(n,e.c,1,255,this),this.style=t}extendPrototype([DynamicPropertyContainer],SVGFillStyleData);function SVGNoStyleData(n,e,t){this.initDynamicPropertyContainer(n),this.getValue=this.iterateDynamicProperties,this.style=t}extendPrototype([DynamicPropertyContainer],SVGNoStyleData);function GradientProperty(n,e,t){this.data=e,this.c=createTypedArray("uint8c",e.p*4);var o=e.k.k[0].s?e.k.k[0].s.length-e.p*4:e.k.k.length-e.p*4;this.o=createTypedArray("float32",o),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=o,this.initDynamicPropertyContainer(t),this.prop=PropertyFactory.getProp(n,e.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}GradientProperty.prototype.comparePoints=function(n,e){for(var t=0,o=this.o.length/2,i;t<o;){if(i=Math.abs(n[t*4]-n[e*4+t*2]),i>.01)return!1;t+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var n=0,e=this.data.k.k.length;n<e;){if(!this.comparePoints(this.data.k.k[n].s,this.data.p))return!1;n+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(n){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||n){var e,t=this.data.p*4,o,i;for(e=0;e<t;e+=1)o=e%4===0?100:255,i=Math.round(this.prop.v[e]*o),this.c[e]!==i&&(this.c[e]=i,this._cmdf=!n);if(this.o.length)for(t=this.prop.v.length,e=this.data.p*4;e<t;e+=1)o=e%2===0?100:1,i=e%2===0?Math.round(this.prop.v[e]*100):this.prop.v[e],this.o[e-this.data.p*4]!==i&&(this.o[e-this.data.p*4]=i,this._omdf=!n);this._mdf=!n}},extendPrototype([DynamicPropertyContainer],GradientProperty);function SVGGradientFillStyleData(n,e,t){this.initDynamicPropertyContainer(n),this.getValue=this.iterateDynamicProperties,this.initGradientData(n,e,t)}SVGGradientFillStyleData.prototype.initGradientData=function(n,e,t){this.o=PropertyFactory.getProp(n,e.o,0,.01,this),this.s=PropertyFactory.getProp(n,e.s,1,null,this),this.e=PropertyFactory.getProp(n,e.e,1,null,this),this.h=PropertyFactory.getProp(n,e.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(n,e.a||{k:0},0,degToRads,this),this.g=new GradientProperty(n,e.g,this),this.style=t,this.stops=[],this.setGradientData(t.pElem,e),this.setGradientOpacity(e,t),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(n,e){var t=createElementID(),o=createNS(e.t===1?"linearGradient":"radialGradient");o.setAttribute("id",t),o.setAttribute("spreadMethod","pad"),o.setAttribute("gradientUnits","userSpaceOnUse");var i=[],s,r,a;for(a=e.g.p*4,r=0;r<a;r+=4)s=createNS("stop"),o.appendChild(s),i.push(s);n.setAttribute(e.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+t+")"),this.gf=o,this.cst=i},SVGGradientFillStyleData.prototype.setGradientOpacity=function(n,e){if(this.g._hasOpacity&&!this.g._collapsable){var t,o,i,s=createNS("mask"),r=createNS("path");s.appendChild(r);var a=createElementID(),l=createElementID();s.setAttribute("id",l);var c=createNS(n.t===1?"linearGradient":"radialGradient");c.setAttribute("id",a),c.setAttribute("spreadMethod","pad"),c.setAttribute("gradientUnits","userSpaceOnUse"),i=n.g.k.k[0].s?n.g.k.k[0].s.length:n.g.k.k.length;var d=this.stops;for(o=n.g.p*4;o<i;o+=2)t=createNS("stop"),t.setAttribute("stop-color","rgb(255,255,255)"),c.appendChild(t),d.push(t);r.setAttribute(n.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+a+")"),n.ty==="gs"&&(r.setAttribute("stroke-linecap",lineCapEnum[n.lc||2]),r.setAttribute("stroke-linejoin",lineJoinEnum[n.lj||2]),n.lj===1&&r.setAttribute("stroke-miterlimit",n.ml)),this.of=c,this.ms=s,this.ost=d,this.maskId=l,e.msElem=r}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData);function SVGGradientStrokeStyleData(n,e,t){this.initDynamicPropertyContainer(n),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(n,e.w,0,null,this),this.d=new DashProperty(n,e.d||{},"svg",this),this.initGradientData(n,e,t),this._isAnimated=!!this._isAnimated}extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(n,e,t){this.transform={mProps:n,op:e,container:t},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}var buildShapeString=function(e,t,o,i){if(t===0)return"";var s=e.o,r=e.i,a=e.v,l,c=" M"+i.applyToPointStringified(a[0][0],a[0][1]);for(l=1;l<t;l+=1)c+=" C"+i.applyToPointStringified(s[l-1][0],s[l-1][1])+" "+i.applyToPointStringified(r[l][0],r[l][1])+" "+i.applyToPointStringified(a[l][0],a[l][1]);return o&&t&&(c+=" C"+i.applyToPointStringified(s[l-1][0],s[l-1][1])+" "+i.applyToPointStringified(r[0][0],r[0][1])+" "+i.applyToPointStringified(a[0][0],a[0][1]),c+="z"),c},SVGElementsRenderer=function(){var n=new Matrix,e=new Matrix,t={createRenderFunction:o};function o(u){switch(u.ty){case"fl":return a;case"gf":return c;case"gs":return l;case"st":return d;case"sh":case"el":case"rc":case"sr":return r;case"tr":return i;case"no":return s;default:return null}}function i(u,f,h){(h||f.transform.op._mdf)&&f.transform.container.setAttribute("opacity",f.transform.op.v),(h||f.transform.mProps._mdf)&&f.transform.container.setAttribute("transform",f.transform.mProps.v.to2dCSS())}function s(){}function r(u,f,h){var m,p,v,g,y,w,_=f.styles.length,S=f.lvl,C,A,E,k;for(w=0;w<_;w+=1){if(g=f.sh._mdf||h,f.styles[w].lvl<S){for(A=e.reset(),E=S-f.styles[w].lvl,k=f.transformers.length-1;!g&&E>0;)g=f.transformers[k].mProps._mdf||g,E-=1,k-=1;if(g)for(E=S-f.styles[w].lvl,k=f.transformers.length-1;E>0;)A.multiply(f.transformers[k].mProps.v),E-=1,k-=1}else A=n;if(C=f.sh.paths,p=C._length,g){for(v="",m=0;m<p;m+=1)y=C.shapes[m],y&&y._length&&(v+=buildShapeString(y,y._length,y.c,A));f.caches[w]=v}else v=f.caches[w];f.styles[w].d+=u.hd===!0?"":v,f.styles[w]._mdf=g||f.styles[w]._mdf}}function a(u,f,h){var m=f.style;(f.c._mdf||h)&&m.pElem.setAttribute("fill","rgb("+bmFloor(f.c.v[0])+","+bmFloor(f.c.v[1])+","+bmFloor(f.c.v[2])+")"),(f.o._mdf||h)&&m.pElem.setAttribute("fill-opacity",f.o.v)}function l(u,f,h){c(u,f,h),d(u,f,h)}function c(u,f,h){var m=f.gf,p=f.g._hasOpacity,v=f.s.v,g=f.e.v;if(f.o._mdf||h){var y=u.ty==="gf"?"fill-opacity":"stroke-opacity";f.style.pElem.setAttribute(y,f.o.v)}if(f.s._mdf||h){var w=u.t===1?"x1":"cx",_=w==="x1"?"y1":"cy";m.setAttribute(w,v[0]),m.setAttribute(_,v[1]),p&&!f.g._collapsable&&(f.of.setAttribute(w,v[0]),f.of.setAttribute(_,v[1]))}var S,C,A,E;if(f.g._cmdf||h){S=f.cst;var k=f.g.c;for(A=S.length,C=0;C<A;C+=1)E=S[C],E.setAttribute("offset",k[C*4]+"%"),E.setAttribute("stop-color","rgb("+k[C*4+1]+","+k[C*4+2]+","+k[C*4+3]+")")}if(p&&(f.g._omdf||h)){var I=f.g.o;for(f.g._collapsable?S=f.cst:S=f.ost,A=S.length,C=0;C<A;C+=1)E=S[C],f.g._collapsable||E.setAttribute("offset",I[C*2]+"%"),E.setAttribute("stop-opacity",I[C*2+1])}if(u.t===1)(f.e._mdf||h)&&(m.setAttribute("x2",g[0]),m.setAttribute("y2",g[1]),p&&!f.g._collapsable&&(f.of.setAttribute("x2",g[0]),f.of.setAttribute("y2",g[1])));else{var F;if((f.s._mdf||f.e._mdf||h)&&(F=Math.sqrt(Math.pow(v[0]-g[0],2)+Math.pow(v[1]-g[1],2)),m.setAttribute("r",F),p&&!f.g._collapsable&&f.of.setAttribute("r",F)),f.s._mdf||f.e._mdf||f.h._mdf||f.a._mdf||h){F||(F=Math.sqrt(Math.pow(v[0]-g[0],2)+Math.pow(v[1]-g[1],2)));var M=Math.atan2(g[1]-v[1],g[0]-v[0]),R=f.h.v;R>=1?R=.99:R<=-1&&(R=-.99);var O=F*R,$=Math.cos(M+f.a.v)*O+v[0],T=Math.sin(M+f.a.v)*O+v[1];m.setAttribute("fx",$),m.setAttribute("fy",T),p&&!f.g._collapsable&&(f.of.setAttribute("fx",$),f.of.setAttribute("fy",T))}}}function d(u,f,h){var m=f.style,p=f.d;p&&(p._mdf||h)&&p.dashStr&&(m.pElem.setAttribute("stroke-dasharray",p.dashStr),m.pElem.setAttribute("stroke-dashoffset",p.dashoffset[0])),f.c&&(f.c._mdf||h)&&m.pElem.setAttribute("stroke","rgb("+bmFloor(f.c.v[0])+","+bmFloor(f.c.v[1])+","+bmFloor(f.c.v[2])+")"),(f.o._mdf||h)&&m.pElem.setAttribute("stroke-opacity",f.o.v),(f.w._mdf||h)&&(m.pElem.setAttribute("stroke-width",f.w.v),m.msElem&&m.msElem.setAttribute("stroke-width",f.w.v))}return t}();function SVGShapeElement(n,e,t){this.shapes=[],this.shapesData=n.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(n,e,t),this.prevViewData=[]}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var n,e=this.shapes.length,t,o,i=this.stylesList.length,s,r=[],a=!1;for(o=0;o<i;o+=1){for(s=this.stylesList[o],a=!1,r.length=0,n=0;n<e;n+=1)t=this.shapes[n],t.styles.indexOf(s)!==-1&&(r.push(t),a=t._isAnimated||a);r.length>1&&a&&this.setShapesAsAnimated(r)}},SVGShapeElement.prototype.setShapesAsAnimated=function(n){var e,t=n.length;for(e=0;e<t;e+=1)n[e].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(n,e){var t,o=new SVGStyleData(n,e),i=o.pElem;if(n.ty==="st")t=new SVGStrokeStyleData(this,n,o);else if(n.ty==="fl")t=new SVGFillStyleData(this,n,o);else if(n.ty==="gf"||n.ty==="gs"){var s=n.ty==="gf"?SVGGradientFillStyleData:SVGGradientStrokeStyleData;t=new s(this,n,o),this.globalData.defs.appendChild(t.gf),t.maskId&&(this.globalData.defs.appendChild(t.ms),this.globalData.defs.appendChild(t.of),i.setAttribute("mask","url("+getLocationHref()+"#"+t.maskId+")"))}else n.ty==="no"&&(t=new SVGNoStyleData(this,n,o));return(n.ty==="st"||n.ty==="gs")&&(i.setAttribute("stroke-linecap",lineCapEnum[n.lc||2]),i.setAttribute("stroke-linejoin",lineJoinEnum[n.lj||2]),i.setAttribute("fill-opacity","0"),n.lj===1&&i.setAttribute("stroke-miterlimit",n.ml)),n.r===2&&i.setAttribute("fill-rule","evenodd"),n.ln&&i.setAttribute("id",n.ln),n.cl&&i.setAttribute("class",n.cl),n.bm&&(i.style["mix-blend-mode"]=getBlendMode(n.bm)),this.stylesList.push(o),this.addToAnimatedContents(n,t),t},SVGShapeElement.prototype.createGroupElement=function(n){var e=new ShapeGroupData;return n.ln&&e.gr.setAttribute("id",n.ln),n.cl&&e.gr.setAttribute("class",n.cl),n.bm&&(e.gr.style["mix-blend-mode"]=getBlendMode(n.bm)),e},SVGShapeElement.prototype.createTransformElement=function(n,e){var t=TransformPropertyFactory.getTransformProperty(this,n,this),o=new SVGTransformData(t,t.o,e);return this.addToAnimatedContents(n,o),o},SVGShapeElement.prototype.createShapeElement=function(n,e,t){var o=4;n.ty==="rc"?o=5:n.ty==="el"?o=6:n.ty==="sr"&&(o=7);var i=ShapePropertyFactory.getShapeProp(this,n,o,this),s=new SVGShapeData(e,t,i);return this.shapes.push(s),this.addShapeToModifiers(s),this.addToAnimatedContents(n,s),s},SVGShapeElement.prototype.addToAnimatedContents=function(n,e){for(var t=0,o=this.animatedContents.length;t<o;){if(this.animatedContents[t].element===e)return;t+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(n),element:e,data:n})},SVGShapeElement.prototype.setElementStyles=function(n){var e=n.styles,t,o=this.stylesList.length;for(t=0;t<o;t+=1)e.indexOf(this.stylesList[t])===-1&&!this.stylesList[t].closed&&e.push(this.stylesList[t])},SVGShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var n,e=this.itemsData.length;for(n=0;n<e;n+=1)this.prevViewData[n]=this.itemsData[n];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),e=this.dynamicProperties.length,n=0;n<e;n+=1)this.dynamicProperties[n].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(n,e,t,o,i,s,r){var a=[].concat(s),l,c=n.length-1,d,u,f=[],h=[],m,p,v;for(l=c;l>=0;l-=1){if(v=this.searchProcessedElement(n[l]),v?e[l]=t[v-1]:n[l]._render=r,n[l].ty==="fl"||n[l].ty==="st"||n[l].ty==="gf"||n[l].ty==="gs"||n[l].ty==="no")v?e[l].style.closed=n[l].hd:e[l]=this.createStyleElement(n[l],i),n[l]._render&&e[l].style.pElem.parentNode!==o&&o.appendChild(e[l].style.pElem),f.push(e[l].style);else if(n[l].ty==="gr"){if(!v)e[l]=this.createGroupElement(n[l]);else for(u=e[l].it.length,d=0;d<u;d+=1)e[l].prevViewData[d]=e[l].it[d];this.searchShapes(n[l].it,e[l].it,e[l].prevViewData,e[l].gr,i+1,a,r),n[l]._render&&e[l].gr.parentNode!==o&&o.appendChild(e[l].gr)}else n[l].ty==="tr"?(v||(e[l]=this.createTransformElement(n[l],o)),m=e[l].transform,a.push(m)):n[l].ty==="sh"||n[l].ty==="rc"||n[l].ty==="el"||n[l].ty==="sr"?(v||(e[l]=this.createShapeElement(n[l],a,i)),this.setElementStyles(e[l])):n[l].ty==="tm"||n[l].ty==="rd"||n[l].ty==="ms"||n[l].ty==="pb"||n[l].ty==="zz"||n[l].ty==="op"?(v?(p=e[l],p.closed=!1):(p=ShapeModifiers.getModifier(n[l].ty),p.init(this,n[l]),e[l]=p,this.shapeModifiers.push(p)),h.push(p)):n[l].ty==="rp"&&(v?(p=e[l],p.closed=!0):(p=ShapeModifiers.getModifier(n[l].ty),e[l]=p,p.init(this,n,l,e),this.shapeModifiers.push(p),r=!1),h.push(p));this.addProcessedElement(n[l],l+1)}for(c=f.length,l=0;l<c;l+=1)f[l].closed=!0;for(c=h.length,l=0;l<c;l+=1)h[l].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var n,e=this.stylesList.length;for(n=0;n<e;n+=1)this.stylesList[n].reset();for(this.renderShape(),n=0;n<e;n+=1)(this.stylesList[n]._mdf||this._isFirstFrame)&&(this.stylesList[n].msElem&&(this.stylesList[n].msElem.setAttribute("d",this.stylesList[n].d),this.stylesList[n].d="M0 0"+this.stylesList[n].d),this.stylesList[n].pElem.setAttribute("d",this.stylesList[n].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var n,e=this.animatedContents.length,t;for(n=0;n<e;n+=1)t=this.animatedContents[n],(this._isFirstFrame||t.element._isAnimated)&&t.data!==!0&&t.fn(t.data,t.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null};function LetterProps(n,e,t,o,i,s){this.o=n,this.sw=e,this.sc=t,this.fc=o,this.m=i,this.p=s,this._mdf={o:!0,sw:!!e,sc:!!t,fc:!!o,m:!0,p:!0}}LetterProps.prototype.update=function(n,e,t,o,i,s){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var r=!1;return this.o!==n&&(this.o=n,this._mdf.o=!0,r=!0),this.sw!==e&&(this.sw=e,this._mdf.sw=!0,r=!0),this.sc!==t&&(this.sc=t,this._mdf.sc=!0,r=!0),this.fc!==o&&(this.fc=o,this._mdf.fc=!0,r=!0),this.m!==i&&(this.m=i,this._mdf.m=!0,r=!0),s.length&&(this.p[0]!==s[0]||this.p[1]!==s[1]||this.p[4]!==s[4]||this.p[5]!==s[5]||this.p[12]!==s[12]||this.p[13]!==s[13])&&(this.p=s,this._mdf.p=!0,r=!0),r};function TextProperty(n,e){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,e.d&&e.d.sid&&(e.d=n.globalData.slotManager.getProp(e.d)),this.data=e,this.elem=n,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(n,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t]);return n},TextProperty.prototype.setCurrentData=function(n){n.__complete||this.completeTextData(n),this.currentData=n,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(n){this.effectsSequence.push(n),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(n){if(!((this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)&&!n)){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var e=this.currentData,t=this.keysIndex;if(this.lock){this.setCurrentData(this.currentData);return}this.lock=!0,this._mdf=!1;var o,i=this.effectsSequence.length,s=n||this.data.d.k[this.keysIndex].s;for(o=0;o<i;o+=1)t!==this.keysIndex?s=this.effectsSequence[o](s,s.t):s=this.effectsSequence[o](this.currentData,s.t);e!==s&&this.setCurrentData(s),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}},TextProperty.prototype.getKeyframeValue=function(){for(var n=this.data.d.k,e=this.elem.comp.renderedFrame,t=0,o=n.length;t<=o-1&&!(t===o-1||n[t+1].t>e);)t+=1;return this.keysIndex!==t&&(this.keysIndex=t),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(n){for(var e=[],t=0,o=n.length,i,s,r=!1,a=!1,l="";t<o;)r=a,a=!1,i=n.charCodeAt(t),l=n.charAt(t),FontManager.isCombinedCharacter(i)?r=!0:i>=55296&&i<=56319?FontManager.isRegionalFlag(n,t)?l=n.substr(t,14):(s=n.charCodeAt(t+1),s>=56320&&s<=57343&&(FontManager.isModifier(i,s)?(l=n.substr(t,2),r=!0):FontManager.isFlagEmoji(n.substr(t,4))?l=n.substr(t,4):l=n.substr(t,2))):i>56319?(s=n.charCodeAt(t+1),FontManager.isVariationSelector(i)&&(r=!0)):FontManager.isZeroWidthJoiner(i)&&(r=!0,a=!0),r?(e[e.length-1]+=l,r=!1):e.push(l),t+=l.length;return e},TextProperty.prototype.completeTextData=function(n){n.__complete=!0;var e=this.elem.globalData.fontManager,t=this.data,o=[],i,s,r,a=0,l,c=t.m.g,d=0,u=0,f=0,h=[],m=0,p=0,v,g,y=e.getFontByName(n.f),w,_=0,S=getFontProperties(y);n.fWeight=S.weight,n.fStyle=S.style,n.finalSize=n.s,n.finalText=this.buildFinalText(n.t),s=n.finalText.length,n.finalLineHeight=n.lh;var C=n.tr/1e3*n.finalSize,A;if(n.sz)for(var E=!0,k=n.sz[0],I=n.sz[1],F,M;E;){M=this.buildFinalText(n.t),F=0,m=0,s=M.length,C=n.tr/1e3*n.finalSize;var R=-1;for(i=0;i<s;i+=1)A=M[i].charCodeAt(0),r=!1,M[i]===" "?R=i:(A===13||A===3)&&(m=0,r=!0,F+=n.finalLineHeight||n.finalSize*1.2),e.chars?(w=e.getCharData(M[i],y.fStyle,y.fFamily),_=r?0:w.w*n.finalSize/100):_=e.measureText(M[i],n.f,n.finalSize),m+_>k&&M[i]!==" "?(R===-1?s+=1:i=R,F+=n.finalLineHeight||n.finalSize*1.2,M.splice(i,R===i?1:0,"\r"),R=-1,m=0):(m+=_,m+=C);F+=y.ascent*n.finalSize/100,this.canResize&&n.finalSize>this.minimumFontSize&&I<F?(n.finalSize-=1,n.finalLineHeight=n.finalSize*n.lh/n.s):(n.finalText=M,s=n.finalText.length,E=!1)}m=-C,_=0;var O=0,$;for(i=0;i<s;i+=1)if(r=!1,$=n.finalText[i],A=$.charCodeAt(0),A===13||A===3?(O=0,h.push(m),p=m>p?m:p,m=-2*C,l="",r=!0,f+=1):l=$,e.chars?(w=e.getCharData($,y.fStyle,e.getFontByName(n.f).fFamily),_=r?0:w.w*n.finalSize/100):_=e.measureText(l,n.f,n.finalSize),$===" "?O+=_+C:(m+=_+C+O,O=0),o.push({l:_,an:_,add:d,n:r,anIndexes:[],val:l,line:f,animatorJustifyOffset:0}),c==2){if(d+=_,l===""||l===" "||i===s-1){for((l===""||l===" ")&&(d-=_);u<=i;)o[u].an=d,o[u].ind=a,o[u].extra=_,u+=1;a+=1,d=0}}else if(c==3){if(d+=_,l===""||i===s-1){for(l===""&&(d-=_);u<=i;)o[u].an=d,o[u].ind=a,o[u].extra=_,u+=1;d=0,a+=1}}else o[a].ind=a,o[a].extra=0,a+=1;if(n.l=o,p=m>p?m:p,h.push(m),n.sz)n.boxWidth=n.sz[0],n.justifyOffset=0;else switch(n.boxWidth=p,n.j){case 1:n.justifyOffset=-n.boxWidth;break;case 2:n.justifyOffset=-n.boxWidth/2;break;default:n.justifyOffset=0}n.lineWidths=h;var T=t.a,D,P;g=T.length;var L,B,b=[];for(v=0;v<g;v+=1){for(D=T[v],D.a.sc&&(n.strokeColorAnim=!0),D.a.sw&&(n.strokeWidthAnim=!0),(D.a.fc||D.a.fh||D.a.fs||D.a.fb)&&(n.fillColorAnim=!0),B=0,L=D.s.b,i=0;i<s;i+=1)P=o[i],P.anIndexes[v]=B,(L==1&&P.val!==""||L==2&&P.val!==""&&P.val!==" "||L==3&&(P.n||P.val==" "||i==s-1)||L==4&&(P.n||i==s-1))&&(D.s.rn===1&&b.push(B),B+=1);t.a[v].s.totalChars=B;var z=-1,N;if(D.s.rn===1)for(i=0;i<s;i+=1)P=o[i],z!=P.anIndexes[v]&&(z=P.anIndexes[v],N=b.splice(Math.floor(Math.random()*b.length),1)[0]),P.anIndexes[v]=N}n.yOffset=n.finalLineHeight||n.finalSize*1.2,n.ls=n.ls||0,n.ascent=y.ascent*n.finalSize/100},TextProperty.prototype.updateDocumentData=function(n,e){e=e===void 0?this.keysIndex:e;var t=this.copyData({},this.data.d.k[e].s);t=this.copyData(t,n),this.data.d.k[e].s=t,this.recalculate(e),this.setCurrentData(t),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(n){var e=this.data.d.k[n].s;e.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(e)},TextProperty.prototype.canResizeFont=function(n){this.canResize=n,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(n){this.minimumFontSize=Math.floor(n)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var n=Math.max,e=Math.min,t=Math.floor;function o(s,r){this._currentTextLength=-1,this.k=!1,this.data=r,this.elem=s,this.comp=s.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(s),this.s=PropertyFactory.getProp(s,r.s||{k:0},0,0,this),"e"in r?this.e=PropertyFactory.getProp(s,r.e,0,0,this):this.e={v:100},this.o=PropertyFactory.getProp(s,r.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(s,r.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(s,r.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(s,r.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(s,r.a,0,.01,this),this.dynamicProperties.length||this.getValue()}o.prototype={getMult:function(r){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var a=0,l=0,c=1,d=1;this.ne.v>0?a=this.ne.v/100:l=-this.ne.v/100,this.xe.v>0?c=1-this.xe.v/100:d=1+this.xe.v/100;var u=BezierFactory.getBezierEasing(a,l,c,d).get,f=0,h=this.finalS,m=this.finalE,p=this.data.sh;if(p===2)m===h?f=r>=m?1:0:f=n(0,e(.5/(m-h)+(r-h)/(m-h),1)),f=u(f);else if(p===3)m===h?f=r>=m?0:1:f=1-n(0,e(.5/(m-h)+(r-h)/(m-h),1)),f=u(f);else if(p===4)m===h?f=0:(f=n(0,e(.5/(m-h)+(r-h)/(m-h),1)),f<.5?f*=2:f=1-2*(f-.5)),f=u(f);else if(p===5){if(m===h)f=0;else{var v=m-h;r=e(n(0,r+.5-h),m-h);var g=-v/2+r,y=v/2;f=Math.sqrt(1-g*g/(y*y))}f=u(f)}else p===6?(m===h?f=0:(r=e(n(0,r+.5-h),m-h),f=(1+Math.cos(Math.PI+Math.PI*2*r/(m-h)))/2),f=u(f)):(r>=t(h)&&(r-h<0?f=n(0,e(e(m,1)-(h-r),1)):f=n(0,e(m-r,1))),f=u(f));if(this.sm.v!==100){var w=this.sm.v*.01;w===0&&(w=1e-8);var _=.5-w*.5;f<_?f=0:(f=(f-_)/w,f>1&&(f=1))}return f*this.a.v},getValue:function(r){this.iterateDynamicProperties(),this._mdf=r||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,r&&this.data.r===2&&(this.e.v=this._currentTextLength);var a=this.data.r===2?1:100/this.data.totalChars,l=this.o.v/a,c=this.s.v/a+l,d=this.e.v/a+l;if(c>d){var u=c;c=d,d=u}this.finalS=c,this.finalE=d}},extendPrototype([DynamicPropertyContainer],o);function i(s,r,a){return new o(s,r)}return{getTextSelectorProp:i}}();function TextAnimatorDataProperty(n,e,t){var o={propType:!1},i=PropertyFactory.getProp,s=e.a;this.a={r:s.r?i(n,s.r,0,degToRads,t):o,rx:s.rx?i(n,s.rx,0,degToRads,t):o,ry:s.ry?i(n,s.ry,0,degToRads,t):o,sk:s.sk?i(n,s.sk,0,degToRads,t):o,sa:s.sa?i(n,s.sa,0,degToRads,t):o,s:s.s?i(n,s.s,1,.01,t):o,a:s.a?i(n,s.a,1,0,t):o,o:s.o?i(n,s.o,0,.01,t):o,p:s.p?i(n,s.p,1,0,t):o,sw:s.sw?i(n,s.sw,0,0,t):o,sc:s.sc?i(n,s.sc,1,0,t):o,fc:s.fc?i(n,s.fc,1,0,t):o,fh:s.fh?i(n,s.fh,0,0,t):o,fs:s.fs?i(n,s.fs,0,.01,t):o,fb:s.fb?i(n,s.fb,0,.01,t):o,t:s.t?i(n,s.t,0,0,t):o},this.s=TextSelectorProp.getTextSelectorProp(n,e.s,t),this.s.t=e.s.t}function TextAnimatorProperty(n,e,t){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=n,this._renderType=e,this._elem=t,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(t)}TextAnimatorProperty.prototype.searchProperties=function(){var n,e=this._textData.a.length,t,o=PropertyFactory.getProp;for(n=0;n<e;n+=1)t=this._textData.a[n],this._animatorsData[n]=new TextAnimatorDataProperty(this._elem,t,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:o(this._elem,this._textData.p.a,0,0,this),f:o(this._elem,this._textData.p.f,0,0,this),l:o(this._elem,this._textData.p.l,0,0,this),r:o(this._elem,this._textData.p.r,0,0,this),p:o(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=o(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(n,e){if(this.lettersChangedFlag=e,!(!this._mdf&&!this._isFirstFrame&&!e&&(!this._hasMaskedPath||!this._pathData.m._mdf))){this._isFirstFrame=!1;var t=this._moreOptions.alignment.v,o=this._animatorsData,i=this._textData,s=this.mHelper,r=this._renderType,a=this.renderedLetters.length,l,c,d,u,f=n.l,h,m,p,v,g,y,w,_,S,C,A,E,k,I,F;if(this._hasMaskedPath){if(F=this._pathData.m,!this._pathData.n||this._pathData._mdf){var M=F.v;this._pathData.r.v&&(M=M.reverse()),h={tLength:0,segments:[]},u=M._length-1;var R;for(E=0,d=0;d<u;d+=1)R=bez.buildBezierData(M.v[d],M.v[d+1],[M.o[d][0]-M.v[d][0],M.o[d][1]-M.v[d][1]],[M.i[d+1][0]-M.v[d+1][0],M.i[d+1][1]-M.v[d+1][1]]),h.tLength+=R.segmentLength,h.segments.push(R),E+=R.segmentLength;d=u,F.v.c&&(R=bez.buildBezierData(M.v[d],M.v[0],[M.o[d][0]-M.v[d][0],M.o[d][1]-M.v[d][1]],[M.i[0][0]-M.v[0][0],M.i[0][1]-M.v[0][1]]),h.tLength+=R.segmentLength,h.segments.push(R),E+=R.segmentLength),this._pathData.pi=h}if(h=this._pathData.pi,m=this._pathData.f.v,w=0,y=1,v=0,g=!0,C=h.segments,m<0&&F.v.c)for(h.tLength<Math.abs(m)&&(m=-Math.abs(m)%h.tLength),w=C.length-1,S=C[w].points,y=S.length-1;m<0;)m+=S[y].partialLength,y-=1,y<0&&(w-=1,S=C[w].points,y=S.length-1);S=C[w].points,_=S[y-1],p=S[y],A=p.partialLength}u=f.length,l=0,c=0;var O=n.finalSize*1.2*.714,$=!0,T,D,P,L,B;L=o.length;var b,z=-1,N,G,K,ne=m,J=w,se=y,te=-1,Z,Q,le,ae,oe,pe,_e,we,me="",ve=this.defaultPropsArray,be;if(n.j===2||n.j===1){var ue=0,de=0,Se=n.j===2?-.5:-1,ge=0,Ce=!0;for(d=0;d<u;d+=1)if(f[d].n){for(ue&&(ue+=de);ge<d;)f[ge].animatorJustifyOffset=ue,ge+=1;ue=0,Ce=!0}else{for(P=0;P<L;P+=1)T=o[P].a,T.t.propType&&(Ce&&n.j===2&&(de+=T.t.v*Se),D=o[P].s,b=D.getMult(f[d].anIndexes[P],i.a[P].s.totalChars),b.length?ue+=T.t.v*b[0]*Se:ue+=T.t.v*b*Se);Ce=!1}for(ue&&(ue+=de);ge<d;)f[ge].animatorJustifyOffset=ue,ge+=1}for(d=0;d<u;d+=1){if(s.reset(),Z=1,f[d].n)l=0,c+=n.yOffset,c+=$?1:0,m=ne,$=!1,this._hasMaskedPath&&(w=J,y=se,S=C[w].points,_=S[y-1],p=S[y],A=p.partialLength,v=0),me="",we="",pe="",be="",ve=this.defaultPropsArray;else{if(this._hasMaskedPath){if(te!==f[d].line){switch(n.j){case 1:m+=E-n.lineWidths[f[d].line];break;case 2:m+=(E-n.lineWidths[f[d].line])/2;break}te=f[d].line}z!==f[d].ind&&(f[z]&&(m+=f[z].extra),m+=f[d].an/2,z=f[d].ind),m+=t[0]*f[d].an*.005;var ye=0;for(P=0;P<L;P+=1)T=o[P].a,T.p.propType&&(D=o[P].s,b=D.getMult(f[d].anIndexes[P],i.a[P].s.totalChars),b.length?ye+=T.p.v[0]*b[0]:ye+=T.p.v[0]*b),T.a.propType&&(D=o[P].s,b=D.getMult(f[d].anIndexes[P],i.a[P].s.totalChars),b.length?ye+=T.a.v[0]*b[0]:ye+=T.a.v[0]*b);for(g=!0,this._pathData.a.v&&(m=f[0].an*.5+(E-this._pathData.f.v-f[0].an*.5-f[f.length-1].an*.5)*z/(u-1),m+=this._pathData.f.v);g;)v+A>=m+ye||!S?(k=(m+ye-v)/p.partialLength,G=_.point[0]+(p.point[0]-_.point[0])*k,K=_.point[1]+(p.point[1]-_.point[1])*k,s.translate(-t[0]*f[d].an*.005,-(t[1]*O)*.01),g=!1):S&&(v+=p.partialLength,y+=1,y>=S.length&&(y=0,w+=1,C[w]?S=C[w].points:F.v.c?(y=0,w=0,S=C[w].points):(v-=p.partialLength,S=null)),S&&(_=p,p=S[y],A=p.partialLength));N=f[d].an/2-f[d].add,s.translate(-N,0,0)}else N=f[d].an/2-f[d].add,s.translate(-N,0,0),s.translate(-t[0]*f[d].an*.005,-t[1]*O*.01,0);for(P=0;P<L;P+=1)T=o[P].a,T.t.propType&&(D=o[P].s,b=D.getMult(f[d].anIndexes[P],i.a[P].s.totalChars),(l!==0||n.j!==0)&&(this._hasMaskedPath?b.length?m+=T.t.v*b[0]:m+=T.t.v*b:b.length?l+=T.t.v*b[0]:l+=T.t.v*b));for(n.strokeWidthAnim&&(le=n.sw||0),n.strokeColorAnim&&(n.sc?Q=[n.sc[0],n.sc[1],n.sc[2]]:Q=[0,0,0]),n.fillColorAnim&&n.fc&&(ae=[n.fc[0],n.fc[1],n.fc[2]]),P=0;P<L;P+=1)T=o[P].a,T.a.propType&&(D=o[P].s,b=D.getMult(f[d].anIndexes[P],i.a[P].s.totalChars),b.length?s.translate(-T.a.v[0]*b[0],-T.a.v[1]*b[1],T.a.v[2]*b[2]):s.translate(-T.a.v[0]*b,-T.a.v[1]*b,T.a.v[2]*b));for(P=0;P<L;P+=1)T=o[P].a,T.s.propType&&(D=o[P].s,b=D.getMult(f[d].anIndexes[P],i.a[P].s.totalChars),b.length?s.scale(1+(T.s.v[0]-1)*b[0],1+(T.s.v[1]-1)*b[1],1):s.scale(1+(T.s.v[0]-1)*b,1+(T.s.v[1]-1)*b,1));for(P=0;P<L;P+=1){if(T=o[P].a,D=o[P].s,b=D.getMult(f[d].anIndexes[P],i.a[P].s.totalChars),T.sk.propType&&(b.length?s.skewFromAxis(-T.sk.v*b[0],T.sa.v*b[1]):s.skewFromAxis(-T.sk.v*b,T.sa.v*b)),T.r.propType&&(b.length?s.rotateZ(-T.r.v*b[2]):s.rotateZ(-T.r.v*b)),T.ry.propType&&(b.length?s.rotateY(T.ry.v*b[1]):s.rotateY(T.ry.v*b)),T.rx.propType&&(b.length?s.rotateX(T.rx.v*b[0]):s.rotateX(T.rx.v*b)),T.o.propType&&(b.length?Z+=(T.o.v*b[0]-Z)*b[0]:Z+=(T.o.v*b-Z)*b),n.strokeWidthAnim&&T.sw.propType&&(b.length?le+=T.sw.v*b[0]:le+=T.sw.v*b),n.strokeColorAnim&&T.sc.propType)for(oe=0;oe<3;oe+=1)b.length?Q[oe]+=(T.sc.v[oe]-Q[oe])*b[0]:Q[oe]+=(T.sc.v[oe]-Q[oe])*b;if(n.fillColorAnim&&n.fc){if(T.fc.propType)for(oe=0;oe<3;oe+=1)b.length?ae[oe]+=(T.fc.v[oe]-ae[oe])*b[0]:ae[oe]+=(T.fc.v[oe]-ae[oe])*b;T.fh.propType&&(b.length?ae=addHueToRGB(ae,T.fh.v*b[0]):ae=addHueToRGB(ae,T.fh.v*b)),T.fs.propType&&(b.length?ae=addSaturationToRGB(ae,T.fs.v*b[0]):ae=addSaturationToRGB(ae,T.fs.v*b)),T.fb.propType&&(b.length?ae=addBrightnessToRGB(ae,T.fb.v*b[0]):ae=addBrightnessToRGB(ae,T.fb.v*b))}}for(P=0;P<L;P+=1)T=o[P].a,T.p.propType&&(D=o[P].s,b=D.getMult(f[d].anIndexes[P],i.a[P].s.totalChars),this._hasMaskedPath?b.length?s.translate(0,T.p.v[1]*b[0],-T.p.v[2]*b[1]):s.translate(0,T.p.v[1]*b,-T.p.v[2]*b):b.length?s.translate(T.p.v[0]*b[0],T.p.v[1]*b[1],-T.p.v[2]*b[2]):s.translate(T.p.v[0]*b,T.p.v[1]*b,-T.p.v[2]*b));if(n.strokeWidthAnim&&(pe=le<0?0:le),n.strokeColorAnim&&(_e="rgb("+Math.round(Q[0]*255)+","+Math.round(Q[1]*255)+","+Math.round(Q[2]*255)+")"),n.fillColorAnim&&n.fc&&(we="rgb("+Math.round(ae[0]*255)+","+Math.round(ae[1]*255)+","+Math.round(ae[2]*255)+")"),this._hasMaskedPath){if(s.translate(0,-n.ls),s.translate(0,t[1]*O*.01+c,0),this._pathData.p.v){I=(p.point[1]-_.point[1])/(p.point[0]-_.point[0]);var Pe=Math.atan(I)*180/Math.PI;p.point[0]<_.point[0]&&(Pe+=180),s.rotate(-Pe*Math.PI/180)}s.translate(G,K,0),m-=t[0]*f[d].an*.005,f[d+1]&&z!==f[d+1].ind&&(m+=f[d].an/2,m+=n.tr*.001*n.finalSize)}else{switch(s.translate(l,c,0),n.ps&&s.translate(n.ps[0],n.ps[1]+n.ascent,0),n.j){case 1:s.translate(f[d].animatorJustifyOffset+n.justifyOffset+(n.boxWidth-n.lineWidths[f[d].line]),0,0);break;case 2:s.translate(f[d].animatorJustifyOffset+n.justifyOffset+(n.boxWidth-n.lineWidths[f[d].line])/2,0,0);break}s.translate(0,-n.ls),s.translate(N,0,0),s.translate(t[0]*f[d].an*.005,t[1]*O*.01,0),l+=f[d].l+n.tr*.001*n.finalSize}r==="html"?me=s.toCSS():r==="svg"?me=s.to2dCSS():ve=[s.props[0],s.props[1],s.props[2],s.props[3],s.props[4],s.props[5],s.props[6],s.props[7],s.props[8],s.props[9],s.props[10],s.props[11],s.props[12],s.props[13],s.props[14],s.props[15]],be=Z}a<=d?(B=new LetterProps(be,pe,_e,we,me,ve),this.renderedLetters.push(B),a+=1,this.lettersChangedFlag=!0):(B=this.renderedLetters[d],this.lettersChangedFlag=B.update(be,pe,_e,we,me,ve)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty);function ITextElement(){}ITextElement.prototype.initElement=function(n,e,t){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(n,e,t),this.textProperty=new TextProperty(this,n.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(n.t,this.renderType,this),this.initTransform(n,e,t),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(n){this._mdf=!1,this.prepareRenderableFrame(n),this.prepareProperties(n,this.isInRange)},ITextElement.prototype.createPathShape=function(n,e){var t,o=e.length,i,s="";for(t=0;t<o;t+=1)e[t].ty==="sh"&&(i=e[t].ks.k,s+=buildShapeString(i,i.i.length,!0,n));return s},ITextElement.prototype.updateDocumentData=function(n,e){this.textProperty.updateDocumentData(n,e)},ITextElement.prototype.canResizeFont=function(n){this.textProperty.canResizeFont(n)},ITextElement.prototype.setMinimumFontSize=function(n){this.textProperty.setMinimumFontSize(n)},ITextElement.prototype.applyTextPropertiesToMatrix=function(n,e,t,o,i){switch(n.ps&&e.translate(n.ps[0],n.ps[1]+n.ascent,0),e.translate(0,-n.ls,0),n.j){case 1:e.translate(n.justifyOffset+(n.boxWidth-n.lineWidths[t]),0,0);break;case 2:e.translate(n.justifyOffset+(n.boxWidth-n.lineWidths[t])/2,0,0);break}e.translate(o,i,0)},ITextElement.prototype.buildColor=function(n){return"rgb("+Math.round(n[0]*255)+","+Math.round(n[1]*255)+","+Math.round(n[2]*255)+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(n,e,t){this.textSpans=[],this.renderType="svg",this.initElement(n,e,t)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(n){for(var e=0,t=n.length,o=[],i="";e<t;)n[e]==="\r"||n[e]===""?(o.push(i),i=""):i+=n[e],e+=1;return o.push(i),o},SVGTextLottieElement.prototype.buildShapeData=function(n,e){if(n.shapes&&n.shapes.length){var t=n.shapes[0];if(t.it){var o=t.it[t.it.length-1];o.s&&(o.s.k[0]=e,o.s.k[1]=e)}}return n},SVGTextLottieElement.prototype.buildNewText=function(){this.addDynamicProperty(this);var n,e,t=this.textProperty.currentData;this.renderedLetters=createSizedArray(t?t.l.length:0),t.fc?this.layerElement.setAttribute("fill",this.buildColor(t.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),t.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(t.sc)),this.layerElement.setAttribute("stroke-width",t.sw)),this.layerElement.setAttribute("font-size",t.finalSize);var o=this.globalData.fontManager.getFontByName(t.f);if(o.fClass)this.layerElement.setAttribute("class",o.fClass);else{this.layerElement.setAttribute("font-family",o.fFamily);var i=t.fWeight,s=t.fStyle;this.layerElement.setAttribute("font-style",s),this.layerElement.setAttribute("font-weight",i)}this.layerElement.setAttribute("aria-label",t.t);var r=t.l||[],a=!!this.globalData.fontManager.chars;e=r.length;var l,c=this.mHelper,d="",u=this.data.singleShape,f=0,h=0,m=!0,p=t.tr*.001*t.finalSize;if(u&&!a&&!t.sz){var v=this.textContainer,g="start";switch(t.j){case 1:g="end";break;case 2:g="middle";break;default:g="start";break}v.setAttribute("text-anchor",g),v.setAttribute("letter-spacing",p);var y=this.buildTextContents(t.finalText);for(e=y.length,h=t.ps?t.ps[1]+t.ascent:0,n=0;n<e;n+=1)l=this.textSpans[n].span||createNS("tspan"),l.textContent=y[n],l.setAttribute("x",0),l.setAttribute("y",h),l.style.display="inherit",v.appendChild(l),this.textSpans[n]||(this.textSpans[n]={span:null,glyph:null}),this.textSpans[n].span=l,h+=t.finalLineHeight;this.layerElement.appendChild(v)}else{var w=this.textSpans.length,_;for(n=0;n<e;n+=1){if(this.textSpans[n]||(this.textSpans[n]={span:null,childSpan:null,glyph:null}),!a||!u||n===0){if(l=w>n?this.textSpans[n].span:createNS(a?"g":"text"),w<=n){if(l.setAttribute("stroke-linecap","butt"),l.setAttribute("stroke-linejoin","round"),l.setAttribute("stroke-miterlimit","4"),this.textSpans[n].span=l,a){var S=createNS("g");l.appendChild(S),this.textSpans[n].childSpan=S}this.textSpans[n].span=l,this.layerElement.appendChild(l)}l.style.display="inherit"}if(c.reset(),u&&(r[n].n&&(f=-p,h+=t.yOffset,h+=m?1:0,m=!1),this.applyTextPropertiesToMatrix(t,c,r[n].line,f,h),f+=r[n].l||0,f+=p),a){_=this.globalData.fontManager.getCharData(t.finalText[n],o.fStyle,this.globalData.fontManager.getFontByName(t.f).fFamily);var C;if(_.t===1)C=new SVGCompElement(_.data,this.globalData,this);else{var A=emptyShapeData;_.data&&_.data.shapes&&(A=this.buildShapeData(_.data,t.finalSize)),C=new SVGShapeElement(A,this.globalData,this)}if(this.textSpans[n].glyph){var E=this.textSpans[n].glyph;this.textSpans[n].childSpan.removeChild(E.layerElement),E.destroy()}this.textSpans[n].glyph=C,C._debug=!0,C.prepareFrame(0),C.renderFrame(),this.textSpans[n].childSpan.appendChild(C.layerElement),_.t===1&&this.textSpans[n].childSpan.setAttribute("transform","scale("+t.finalSize/100+","+t.finalSize/100+")")}else u&&l.setAttribute("transform","translate("+c.props[12]+","+c.props[13]+")"),l.textContent=r[n].val,l.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}u&&l&&l.setAttribute("d",d)}for(;n<this.textSpans.length;)this.textSpans[n].span.style.display="none",n+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var n=this.layerElement.getBBox();this.bbox={top:n.y,left:n.x,width:n.width,height:n.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var n,e=this.textSpans.length,t;for(this.renderedFrame=this.comp.renderedFrame,n=0;n<e;n+=1)t=this.textSpans[n].glyph,t&&(t.prepareFrame(this.comp.renderedFrame-this.data.st),t._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){this._sizeChanged=!0;var n,e,t=this.textAnimator.renderedLetters,o=this.textProperty.currentData.l;e=o.length;var i,s,r;for(n=0;n<e;n+=1)o[n].n||(i=t[n],s=this.textSpans[n].span,r=this.textSpans[n].glyph,r&&r.renderFrame(),i._mdf.m&&s.setAttribute("transform",i.m),i._mdf.o&&s.setAttribute("opacity",i.o),i._mdf.sw&&s.setAttribute("stroke-width",i.sw),i._mdf.sc&&s.setAttribute("stroke",i.sc),i._mdf.fc&&s.setAttribute("fill",i.fc))}};function ISolidElement(n,e,t){this.initElement(n,e,t)}extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var n=createNS("rect");n.setAttribute("width",this.data.sw),n.setAttribute("height",this.data.sh),n.setAttribute("fill",this.data.sc),this.layerElement.appendChild(n)};function NullElement(n,e,t){this.initFrame(),this.initBaseData(n,e,t),this.initFrame(),this.initTransform(n,e,t),this.initHierarchy()}NullElement.prototype.prepareFrame=function(n){this.prepareProperties(n,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement);function SVGRendererBase(){}extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(n){return new NullElement(n,this.globalData,this)},SVGRendererBase.prototype.createShape=function(n){return new SVGShapeElement(n,this.globalData,this)},SVGRendererBase.prototype.createText=function(n){return new SVGTextLottieElement(n,this.globalData,this)},SVGRendererBase.prototype.createImage=function(n){return new IImageElement(n,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(n){return new ISolidElement(n,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(n){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+n.w+" "+n.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",n.w),this.svgElement.setAttribute("height",n.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),this.renderConfig.focusable!==void 0&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var e=this.globalData.defs;this.setupGlobalData(n,e),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=n;var t=createNS("clipPath"),o=createNS("rect");o.setAttribute("width",n.w),o.setAttribute("height",n.h),o.setAttribute("x",0),o.setAttribute("y",0);var i=createElementID();t.setAttribute("id",i),t.appendChild(o),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+i+")"),e.appendChild(t),this.layers=n.layers,this.elements=createSizedArray(n.layers.length)},SVGRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var n,e=this.layers?this.layers.length:0;for(n=0;n<e;n+=1)this.elements[n]&&this.elements[n].destroy&&this.elements[n].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(n){var e=0,t=this.layers.length;for(e=0;e<t;e+=1)if(this.layers[e].ind===n)return e;return-1},SVGRendererBase.prototype.buildItem=function(n){var e=this.elements;if(!(e[n]||this.layers[n].ty===99)){e[n]=!0;var t=this.createItem(this.layers[n]);if(e[n]=t,getExpressionsPlugin()&&(this.layers[n].ty===0&&this.globalData.projectInterface.registerComposition(t),t.initExpressions()),this.appendElementInPos(t,n),this.layers[n].tt){var o="tp"in this.layers[n]?this.findIndexByInd(this.layers[n].tp):n-1;if(o===-1)return;if(!this.elements[o]||this.elements[o]===!0)this.buildItem(o),this.addPendingElement(t);else{var i=e[o],s=i.getMatte(this.layers[n].tt);t.setMatte(s)}}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var n=this.pendingElements.pop();if(n.checkParenting(),n.data.tt)for(var e=0,t=this.elements.length;e<t;){if(this.elements[e]===n){var o="tp"in n.data?this.findIndexByInd(n.data.tp):e-1,i=this.elements[o],s=i.getMatte(this.layers[e].tt);n.setMatte(s);break}e+=1}}},SVGRendererBase.prototype.renderFrame=function(n){if(!(this.renderedFrame===n||this.destroyed)){n===null?n=this.renderedFrame:this.renderedFrame=n,this.globalData.frameNum=n,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=n,this.globalData._mdf=!1;var e,t=this.layers.length;for(this.completeLayers||this.checkLayers(n),e=t-1;e>=0;e-=1)(this.completeLayers||this.elements[e])&&this.elements[e].prepareFrame(n-this.layers[e].st);if(this.globalData._mdf)for(e=0;e<t;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(n,e){var t=n.getBaseElement();if(t){for(var o=0,i;o<e;)this.elements[o]&&this.elements[o]!==!0&&this.elements[o].getBaseElement()&&(i=this.elements[o].getBaseElement()),o+=1;i?this.layerElement.insertBefore(t,i):this.layerElement.appendChild(t)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"};function ICompElement(){}extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(n,e,t){this.initFrame(),this.initBaseData(n,e,t),this.initTransform(n,e,t),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),(this.data.xt||!e.progressiveLoad)&&this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(n){if(this._mdf=!1,this.prepareRenderableFrame(n),this.prepareProperties(n,this.isInRange),!(!this.isInRange&&!this.data.xt)){if(this.tm._placeholder)this.renderedFrame=n/this.data.sr;else{var e=this.tm.v;e===this.data.op&&(e=this.data.op-1),this.renderedFrame=e}var t,o=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),t=o-1;t>=0;t-=1)(this.completeLayers||this.elements[t])&&(this.elements[t].prepareFrame(this.renderedFrame-this.layers[t].st),this.elements[t]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var n,e=this.layers.length;for(n=0;n<e;n+=1)(this.completeLayers||this.elements[n])&&this.elements[n].renderFrame()},ICompElement.prototype.setElements=function(n){this.elements=n},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var n,e=this.layers.length;for(n=0;n<e;n+=1)this.elements[n]&&this.elements[n].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()};function SVGCompElement(n,e,t){this.layers=n.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(n,e,t),this.tm=n.tm?PropertyFactory.getProp(this,n.tm,0,e.frameRate,this):{_placeholder:!0}}extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(n){return new SVGCompElement(n,this.globalData,this)};function SVGRenderer(n,e){this.animationItem=n,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var t="";if(e&&e.title){var o=createNS("title"),i=createElementID();o.setAttribute("id",i),o.textContent=e.title,this.svgElement.appendChild(o),t+=i}if(e&&e.description){var s=createNS("desc"),r=createElementID();s.setAttribute("id",r),s.textContent=e.description,this.svgElement.appendChild(s),t+=" "+r}t&&this.svgElement.setAttribute("aria-labelledby",t);var a=createNS("defs");this.svgElement.appendChild(a);var l=createNS("g");this.svgElement.appendChild(l),this.layerElement=l,this.renderConfig={preserveAspectRatio:e&&e.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:e&&e.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:e&&e.contentVisibility||"visible",progressiveLoad:e&&e.progressiveLoad||!1,hideOnTransparent:!(e&&e.hideOnTransparent===!1),viewBoxOnly:e&&e.viewBoxOnly||!1,viewBoxSize:e&&e.viewBoxSize||!1,className:e&&e.className||"",id:e&&e.id||"",focusable:e&&e.focusable,filterSize:{width:e&&e.filterSize&&e.filterSize.width||"100%",height:e&&e.filterSize&&e.filterSize.height||"100%",x:e&&e.filterSize&&e.filterSize.x||"0%",y:e&&e.filterSize&&e.filterSize.y||"0%"},width:e&&e.width,height:e&&e.height,runExpressions:!e||e.runExpressions===void 0||e.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:a,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(n){return new SVGCompElement(n,this.globalData,this)};function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}ShapeTransformManager.prototype={addTransformSequence:function(e){var t,o=e.length,i="_";for(t=0;t<o;t+=1)i+=e[t].transform.key+"_";var s=this.sequences[i];return s||(s={transforms:[].concat(e),finalTransform:new Matrix,_mdf:!1},this.sequences[i]=s,this.sequenceList.push(s)),s},processSequence:function(e,t){for(var o=0,i=e.transforms.length,s=t;o<i&&!t;){if(e.transforms[o].transform.mProps._mdf){s=!0;break}o+=1}if(s)for(e.finalTransform.reset(),o=i-1;o>=0;o-=1)e.finalTransform.multiply(e.transforms[o].transform.mProps.v);e._mdf=s},processSequences:function(e){var t,o=this.sequenceList.length;for(t=0;t<o;t+=1)this.processSequence(this.sequenceList[t],e)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var e="__lottie_element_luma_buffer",t=null,o=null,i=null;function s(){var l=createNS("svg"),c=createNS("filter"),d=createNS("feColorMatrix");return c.setAttribute("id",e),d.setAttribute("type","matrix"),d.setAttribute("color-interpolation-filters","sRGB"),d.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),c.appendChild(d),l.appendChild(c),l.setAttribute("id",e+"_svg"),featureSupport.svgLumaHidden&&(l.style.display="none"),l}function r(){t||(i=s(),document.body.appendChild(i),t=createTag("canvas"),o=t.getContext("2d"),o.filter="url(#"+e+")",o.fillStyle="rgba(0,0,0,0)",o.fillRect(0,0,1,1))}function a(l){return t||r(),t.width=l.width,t.height=l.height,o.filter="url(#"+e+")",t}return{load:r,get:a}};function createCanvas(n,e){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(n,e);var t=createTag("canvas");return t.width=n,t.height=e,t}var assetLoader=function(){return{loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas}}(),registeredEffects={};function CVEffects(n){var e,t=n.data.ef?n.data.ef.length:0;this.filters=[];var o;for(e=0;e<t;e+=1){o=null;var i=n.data.ef[e].ty;if(registeredEffects[i]){var s=registeredEffects[i].effect;o=new s(n.effectsManager.effectElements[e],n)}o&&this.filters.push(o)}this.filters.length&&n.addRenderableComponent(this)}CVEffects.prototype.renderFrame=function(n){var e,t=this.filters.length;for(e=0;e<t;e+=1)this.filters[e].renderFrame(n)},CVEffects.prototype.getEffects=function(n){var e,t=this.filters.length,o=[];for(e=0;e<t;e+=1)this.filters[e].type===n&&o.push(this.filters[e]);return o};function registerEffect(n,e){registeredEffects[n]={effect:e}}function CVMaskElement(n,e){this.data=n,this.element=e,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var t,o=this.masksProperties.length,i=!1;for(t=0;t<o;t+=1)this.masksProperties[t].mode!=="n"&&(i=!0),this.viewData[t]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[t],3);this.hasMasks=i,i&&this.element.addRenderableComponent(this)}CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var n=this.element.finalTransform.mat,e=this.element.canvasContext,t,o=this.masksProperties.length,i,s,r;for(e.beginPath(),t=0;t<o;t+=1)if(this.masksProperties[t].mode!=="n"){this.masksProperties[t].inv&&(e.moveTo(0,0),e.lineTo(this.element.globalData.compSize.w,0),e.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),e.lineTo(0,this.element.globalData.compSize.h),e.lineTo(0,0)),r=this.viewData[t].v,i=n.applyToPointArray(r.v[0][0],r.v[0][1],0),e.moveTo(i[0],i[1]);var a,l=r._length;for(a=1;a<l;a+=1)s=n.applyToTriplePoints(r.o[a-1],r.i[a],r.v[a]),e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5]);s=n.applyToTriplePoints(r.o[a-1],r.i[0],r.v[0]),e.bezierCurveTo(s[0],s[1],s[2],s[3],s[4],s[5])}this.element.globalData.renderer.save(!0),e.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};function CVBaseElement(){}var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var e=this.globalData.canvasContext,t=assetLoader.createCanvas(e.canvas.width,e.canvas.height);this.buffers.push(t);var o=assetLoader.createCanvas(e.canvas.width,e.canvas.height);this.buffers.push(o),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var e=this.globalData;if(e.blendMode!==this.data.bm){e.blendMode=this.data.bm;var t=getBlendMode(this.data.bm);e.canvasContext.globalCompositeOperation=t}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){!this.hidden&&(!this.isInRange||this.isTransparent)&&(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(e){e.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var e=this.buffers[0],t=e.getContext("2d");this.clearCanvas(t),t.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var e=this.buffers[1],t=e.getContext("2d");this.clearCanvas(t),t.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform);var o=this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1);if(o.renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var i=assetLoader.getLumaCanvas(this.canvasContext.canvas),s=i.getContext("2d");s.drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(i,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(e,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(e){if(!(this.hidden||this.data.hd)&&!(this.data.td===1&&!e)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var t=this.data.ty===0;this.prepareLayer(),this.globalData.renderer.save(t),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(t),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement;function CVShapeData(n,e,t,o){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var i=4;e.ty==="rc"?i=5:e.ty==="el"?i=6:e.ty==="sr"&&(i=7),this.sh=ShapePropertyFactory.getShapeProp(n,e,i,n);var s,r=t.length,a;for(s=0;s<r;s+=1)t[s].closed||(a={transforms:o.addTransformSequence(t[s].transforms),trNodes:[]},this.styledShapes.push(a),t[s].elements.push(a))}CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated;function CVShapeElement(n,e,t){this.shapes=[],this.shapesData=n.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(n,e,t)}extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(n,e){var t={data:n,type:n.ty,preTransforms:this.transformsManager.addTransformSequence(e),transforms:[],elements:[],closed:n.hd===!0},o={};if(n.ty==="fl"||n.ty==="st"?(o.c=PropertyFactory.getProp(this,n.c,1,255,this),o.c.k||(t.co="rgb("+bmFloor(o.c.v[0])+","+bmFloor(o.c.v[1])+","+bmFloor(o.c.v[2])+")")):(n.ty==="gf"||n.ty==="gs")&&(o.s=PropertyFactory.getProp(this,n.s,1,null,this),o.e=PropertyFactory.getProp(this,n.e,1,null,this),o.h=PropertyFactory.getProp(this,n.h||{k:0},0,.01,this),o.a=PropertyFactory.getProp(this,n.a||{k:0},0,degToRads,this),o.g=new GradientProperty(this,n.g,this)),o.o=PropertyFactory.getProp(this,n.o,0,.01,this),n.ty==="st"||n.ty==="gs"){if(t.lc=lineCapEnum[n.lc||2],t.lj=lineJoinEnum[n.lj||2],n.lj==1&&(t.ml=n.ml),o.w=PropertyFactory.getProp(this,n.w,0,null,this),o.w.k||(t.wi=o.w.v),n.d){var i=new DashProperty(this,n.d,"canvas",this);o.d=i,o.d.k||(t.da=o.d.dashArray,t.do=o.d.dashoffset[0])}}else t.r=n.r===2?"evenodd":"nonzero";return this.stylesList.push(t),o.style=t,o},CVShapeElement.prototype.createGroupElement=function(){var n={it:[],prevViewData:[]};return n},CVShapeElement.prototype.createTransformElement=function(n){var e={transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,n.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,n,this)}};return e},CVShapeElement.prototype.createShapeElement=function(n){var e=new CVShapeData(this,n,this.stylesList,this.transformsManager);return this.shapes.push(e),this.addShapeToModifiers(e),e},CVShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var n,e=this.itemsData.length;for(n=0;n<e;n+=1)this.prevViewData[n]=this.itemsData[n];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),e=this.dynamicProperties.length,n=0;n<e;n+=1)this.dynamicProperties[n].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(n){var e,t=this.stylesList.length;for(e=0;e<t;e+=1)this.stylesList[e].closed||this.stylesList[e].transforms.push(n)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var n,e=this.stylesList.length;for(n=0;n<e;n+=1)this.stylesList[n].closed||this.stylesList[n].transforms.pop()},CVShapeElement.prototype.closeStyles=function(n){var e,t=n.length;for(e=0;e<t;e+=1)n[e].closed=!0},CVShapeElement.prototype.searchShapes=function(n,e,t,o,i){var s,r=n.length-1,a,l,c=[],d=[],u,f,h,m=[].concat(i);for(s=r;s>=0;s-=1){if(u=this.searchProcessedElement(n[s]),u?e[s]=t[u-1]:n[s]._shouldRender=o,n[s].ty==="fl"||n[s].ty==="st"||n[s].ty==="gf"||n[s].ty==="gs")u?e[s].style.closed=!1:e[s]=this.createStyleElement(n[s],m),c.push(e[s].style);else if(n[s].ty==="gr"){if(!u)e[s]=this.createGroupElement(n[s]);else for(l=e[s].it.length,a=0;a<l;a+=1)e[s].prevViewData[a]=e[s].it[a];this.searchShapes(n[s].it,e[s].it,e[s].prevViewData,o,m)}else n[s].ty==="tr"?(u||(h=this.createTransformElement(n[s]),e[s]=h),m.push(e[s]),this.addTransformToStyleList(e[s])):n[s].ty==="sh"||n[s].ty==="rc"||n[s].ty==="el"||n[s].ty==="sr"?u||(e[s]=this.createShapeElement(n[s])):n[s].ty==="tm"||n[s].ty==="rd"||n[s].ty==="pb"||n[s].ty==="zz"||n[s].ty==="op"?(u?(f=e[s],f.closed=!1):(f=ShapeModifiers.getModifier(n[s].ty),f.init(this,n[s]),e[s]=f,this.shapeModifiers.push(f)),d.push(f)):n[s].ty==="rp"&&(u?(f=e[s],f.closed=!0):(f=ShapeModifiers.getModifier(n[s].ty),e[s]=f,f.init(this,n,s,e),this.shapeModifiers.push(f),o=!1),d.push(f));this.addProcessedElement(n[s],s+1)}for(this.removeTransformFromStyleList(),this.closeStyles(c),r=d.length,s=0;s<r;s+=1)d[s].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(n,e){(n._opMdf||e.op._mdf||this._isFirstFrame)&&(e.opacity=n.opacity,e.opacity*=e.op.v,e._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var n,e=this.stylesList.length,t,o,i,s,r,a,l=this.globalData.renderer,c=this.globalData.canvasContext,d,u;for(n=0;n<e;n+=1)if(u=this.stylesList[n],d=u.type,!((d==="st"||d==="gs")&&u.wi===0||!u.data._shouldRender||u.coOp===0||this.globalData.currentGlobalAlpha===0)){for(l.save(),r=u.elements,d==="st"||d==="gs"?(l.ctxStrokeStyle(d==="st"?u.co:u.grd),l.ctxLineWidth(u.wi),l.ctxLineCap(u.lc),l.ctxLineJoin(u.lj),l.ctxMiterLimit(u.ml||0)):l.ctxFillStyle(d==="fl"?u.co:u.grd),l.ctxOpacity(u.coOp),d!=="st"&&d!=="gs"&&c.beginPath(),l.ctxTransform(u.preTransforms.finalTransform.props),o=r.length,t=0;t<o;t+=1){for((d==="st"||d==="gs")&&(c.beginPath(),u.da&&(c.setLineDash(u.da),c.lineDashOffset=u.do)),a=r[t].trNodes,s=a.length,i=0;i<s;i+=1)a[i].t==="m"?c.moveTo(a[i].p[0],a[i].p[1]):a[i].t==="c"?c.bezierCurveTo(a[i].pts[0],a[i].pts[1],a[i].pts[2],a[i].pts[3],a[i].pts[4],a[i].pts[5]):c.closePath();(d==="st"||d==="gs")&&(l.ctxStroke(),u.da&&c.setLineDash(this.dashResetter))}d!=="st"&&d!=="gs"&&this.globalData.renderer.ctxFill(u.r),l.restore()}},CVShapeElement.prototype.renderShape=function(n,e,t,o){var i,s=e.length-1,r;for(r=n,i=s;i>=0;i-=1)e[i].ty==="tr"?(r=t[i].transform,this.renderShapeTransform(n,r)):e[i].ty==="sh"||e[i].ty==="el"||e[i].ty==="rc"||e[i].ty==="sr"?this.renderPath(e[i],t[i]):e[i].ty==="fl"?this.renderFill(e[i],t[i],r):e[i].ty==="st"?this.renderStroke(e[i],t[i],r):e[i].ty==="gf"||e[i].ty==="gs"?this.renderGradientFill(e[i],t[i],r):e[i].ty==="gr"?this.renderShape(r,e[i].it,t[i].it):e[i].ty;o&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(n,e){if(this._isFirstFrame||e._mdf||n.transforms._mdf){var t=n.trNodes,o=e.paths,i,s,r,a=o._length;t.length=0;var l=n.transforms.finalTransform;for(r=0;r<a;r+=1){var c=o.shapes[r];if(c&&c.v){for(s=c._length,i=1;i<s;i+=1)i===1&&t.push({t:"m",p:l.applyToPointArray(c.v[0][0],c.v[0][1],0)}),t.push({t:"c",pts:l.applyToTriplePoints(c.o[i-1],c.i[i],c.v[i])});s===1&&t.push({t:"m",p:l.applyToPointArray(c.v[0][0],c.v[0][1],0)}),c.c&&s&&(t.push({t:"c",pts:l.applyToTriplePoints(c.o[i-1],c.i[0],c.v[0])}),t.push({t:"z"}))}}n.trNodes=t}},CVShapeElement.prototype.renderPath=function(n,e){if(n.hd!==!0&&n._shouldRender){var t,o=e.styledShapes.length;for(t=0;t<o;t+=1)this.renderStyledShape(e.styledShapes[t],e.sh)}},CVShapeElement.prototype.renderFill=function(n,e,t){var o=e.style;(e.c._mdf||this._isFirstFrame)&&(o.co="rgb("+bmFloor(e.c.v[0])+","+bmFloor(e.c.v[1])+","+bmFloor(e.c.v[2])+")"),(e.o._mdf||t._opMdf||this._isFirstFrame)&&(o.coOp=e.o.v*t.opacity)},CVShapeElement.prototype.renderGradientFill=function(n,e,t){var o=e.style,i;if(!o.grd||e.g._mdf||e.s._mdf||e.e._mdf||n.t!==1&&(e.h._mdf||e.a._mdf)){var s=this.globalData.canvasContext,r=e.s.v,a=e.e.v;if(n.t===1)i=s.createLinearGradient(r[0],r[1],a[0],a[1]);else{var l=Math.sqrt(Math.pow(r[0]-a[0],2)+Math.pow(r[1]-a[1],2)),c=Math.atan2(a[1]-r[1],a[0]-r[0]),d=e.h.v;d>=1?d=.99:d<=-1&&(d=-.99);var u=l*d,f=Math.cos(c+e.a.v)*u+r[0],h=Math.sin(c+e.a.v)*u+r[1];i=s.createRadialGradient(f,h,0,r[0],r[1],l)}var m,p=n.g.p,v=e.g.c,g=1;for(m=0;m<p;m+=1)e.g._hasOpacity&&e.g._collapsable&&(g=e.g.o[m*2+1]),i.addColorStop(v[m*4]/100,"rgba("+v[m*4+1]+","+v[m*4+2]+","+v[m*4+3]+","+g+")");o.grd=i}o.coOp=e.o.v*t.opacity},CVShapeElement.prototype.renderStroke=function(n,e,t){var o=e.style,i=e.d;i&&(i._mdf||this._isFirstFrame)&&(o.da=i.dashArray,o.do=i.dashoffset[0]),(e.c._mdf||this._isFirstFrame)&&(o.co="rgb("+bmFloor(e.c.v[0])+","+bmFloor(e.c.v[1])+","+bmFloor(e.c.v[2])+")"),(e.o._mdf||t._opMdf||this._isFirstFrame)&&(o.coOp=e.o.v*t.opacity),(e.w._mdf||this._isFirstFrame)&&(o.wi=e.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0};function CVTextElement(n,e,t){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(n,e,t)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var n=this.textProperty.currentData;this.renderedLetters=createSizedArray(n.l?n.l.length:0);var e=!1;n.fc?(e=!0,this.values.fill=this.buildColor(n.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=e;var t=!1;n.sc&&(t=!0,this.values.stroke=this.buildColor(n.sc),this.values.sWidth=n.sw);var o=this.globalData.fontManager.getFontByName(n.f),i,s,r=n.l,a=this.mHelper;this.stroke=t,this.values.fValue=n.finalSize+"px "+this.globalData.fontManager.getFontByName(n.f).fFamily,s=n.finalText.length;var l,c,d,u,f,h,m,p,v,g,y=this.data.singleShape,w=n.tr*.001*n.finalSize,_=0,S=0,C=!0,A=0;for(i=0;i<s;i+=1){l=this.globalData.fontManager.getCharData(n.finalText[i],o.fStyle,this.globalData.fontManager.getFontByName(n.f).fFamily),c=l&&l.data||{},a.reset(),y&&r[i].n&&(_=-w,S+=n.yOffset,S+=C?1:0,C=!1),f=c.shapes?c.shapes[0].it:[],m=f.length,a.scale(n.finalSize/100,n.finalSize/100),y&&this.applyTextPropertiesToMatrix(n,a,r[i].line,_,S),v=createSizedArray(m-1);var E=0;for(h=0;h<m;h+=1)if(f[h].ty==="sh"){for(u=f[h].ks.k.i.length,p=f[h].ks.k,g=[],d=1;d<u;d+=1)d===1&&g.push(a.applyToX(p.v[0][0],p.v[0][1],0),a.applyToY(p.v[0][0],p.v[0][1],0)),g.push(a.applyToX(p.o[d-1][0],p.o[d-1][1],0),a.applyToY(p.o[d-1][0],p.o[d-1][1],0),a.applyToX(p.i[d][0],p.i[d][1],0),a.applyToY(p.i[d][0],p.i[d][1],0),a.applyToX(p.v[d][0],p.v[d][1],0),a.applyToY(p.v[d][0],p.v[d][1],0));g.push(a.applyToX(p.o[d-1][0],p.o[d-1][1],0),a.applyToY(p.o[d-1][0],p.o[d-1][1],0),a.applyToX(p.i[0][0],p.i[0][1],0),a.applyToY(p.i[0][0],p.i[0][1],0),a.applyToX(p.v[0][0],p.v[0][1],0),a.applyToY(p.v[0][0],p.v[0][1],0)),v[E]=g,E+=1}y&&(_+=r[i].l,_+=w),this.textSpans[A]?this.textSpans[A].elem=v:this.textSpans[A]={elem:v},A+=1}},CVTextElement.prototype.renderInnerContent=function(){this.validateText();var n=this.canvasContext;n.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var e,t,o,i,s,r,a=this.textAnimator.renderedLetters,l=this.textProperty.currentData.l;t=l.length;var c,d=null,u=null,f=null,h,m,p=this.globalData.renderer;for(e=0;e<t;e+=1)if(!l[e].n){if(c=a[e],c&&(p.save(),p.ctxTransform(c.p),p.ctxOpacity(c.o)),this.fill){for(c&&c.fc?d!==c.fc&&(p.ctxFillStyle(c.fc),d=c.fc):d!==this.values.fill&&(d=this.values.fill,p.ctxFillStyle(this.values.fill)),h=this.textSpans[e].elem,i=h.length,this.globalData.canvasContext.beginPath(),o=0;o<i;o+=1)for(m=h[o],r=m.length,this.globalData.canvasContext.moveTo(m[0],m[1]),s=2;s<r;s+=6)this.globalData.canvasContext.bezierCurveTo(m[s],m[s+1],m[s+2],m[s+3],m[s+4],m[s+5]);this.globalData.canvasContext.closePath(),p.ctxFill()}if(this.stroke){for(c&&c.sw?f!==c.sw&&(f=c.sw,p.ctxLineWidth(c.sw)):f!==this.values.sWidth&&(f=this.values.sWidth,p.ctxLineWidth(this.values.sWidth)),c&&c.sc?u!==c.sc&&(u=c.sc,p.ctxStrokeStyle(c.sc)):u!==this.values.stroke&&(u=this.values.stroke,p.ctxStrokeStyle(this.values.stroke)),h=this.textSpans[e].elem,i=h.length,this.globalData.canvasContext.beginPath(),o=0;o<i;o+=1)for(m=h[o],r=m.length,this.globalData.canvasContext.moveTo(m[0],m[1]),s=2;s<r;s+=6)this.globalData.canvasContext.bezierCurveTo(m[s],m[s+1],m[s+2],m[s+3],m[s+4],m[s+5]);this.globalData.canvasContext.closePath(),p.ctxStroke()}c&&this.globalData.renderer.restore()}};function CVImageElement(n,e,t){this.assetData=e.getAssetData(n.refId),this.img=e.imageLoader.getAsset(this.assetData),this.initElement(n,e,t)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var n=createTag("canvas");n.width=this.assetData.w,n.height=this.assetData.h;var e=n.getContext("2d"),t=this.img.width,o=this.img.height,i=t/o,s=this.assetData.w/this.assetData.h,r,a,l=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;i>s&&l==="xMidYMid slice"||i<s&&l!=="xMidYMid slice"?(a=o,r=a*s):(r=t,a=r/s),e.drawImage(this.img,(t-r)/2,(o-a)/2,r,a,0,0,this.assetData.w,this.assetData.h),this.img=n}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null};function CVSolidElement(n,e,t){this.initElement(n,e,t)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)};function CanvasRendererBase(){}extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(n){return new CVShapeElement(n,this.globalData,this)},CanvasRendererBase.prototype.createText=function(n){return new CVTextElement(n,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(n){return new CVImageElement(n,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(n){return new CVSolidElement(n,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(n){n[0]===1&&n[1]===0&&n[4]===0&&n[5]===1&&n[12]===0&&n[13]===0||this.canvasContext.transform(n[0],n[1],n[4],n[5],n[12],n[13])},CanvasRendererBase.prototype.ctxOpacity=function(n){this.canvasContext.globalAlpha*=n<0?0:n},CanvasRendererBase.prototype.ctxFillStyle=function(n){this.canvasContext.fillStyle=n},CanvasRendererBase.prototype.ctxStrokeStyle=function(n){this.canvasContext.strokeStyle=n},CanvasRendererBase.prototype.ctxLineWidth=function(n){this.canvasContext.lineWidth=n},CanvasRendererBase.prototype.ctxLineCap=function(n){this.canvasContext.lineCap=n},CanvasRendererBase.prototype.ctxLineJoin=function(n){this.canvasContext.lineJoin=n},CanvasRendererBase.prototype.ctxMiterLimit=function(n){this.canvasContext.miterLimit=n},CanvasRendererBase.prototype.ctxFill=function(n){this.canvasContext.fill(n)},CanvasRendererBase.prototype.ctxFillRect=function(n,e,t,o){this.canvasContext.fillRect(n,e,t,o)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}this.contextData.reset()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(n){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}n&&(this.globalData.blendMode="source-over"),this.contextData.restore(n)},CanvasRendererBase.prototype.configAnimation=function(n){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var e=this.animationItem.container.style;e.width="100%",e.height="100%";var t="0px 0px 0px";e.transformOrigin=t,e.mozTransformOrigin=t,e.webkitTransformOrigin=t,e["-webkit-transform"]=t,e.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=n,this.layers=n.layers,this.transformCanvas={w:n.w,h:n.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(n,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(n.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(n,e){this.reset();var t,o;n?(t=n,o=e,this.canvasContext.canvas.width=t,this.canvasContext.canvas.height=o):(this.animationItem.wrapper&&this.animationItem.container?(t=this.animationItem.wrapper.offsetWidth,o=this.animationItem.wrapper.offsetHeight):(t=this.canvasContext.canvas.width,o=this.canvasContext.canvas.height),this.canvasContext.canvas.width=t*this.renderConfig.dpr,this.canvasContext.canvas.height=o*this.renderConfig.dpr);var i,s;if(this.renderConfig.preserveAspectRatio.indexOf("meet")!==-1||this.renderConfig.preserveAspectRatio.indexOf("slice")!==-1){var r=this.renderConfig.preserveAspectRatio.split(" "),a=r[1]||"meet",l=r[0]||"xMidYMid",c=l.substr(0,4),d=l.substr(4);i=t/o,s=this.transformCanvas.w/this.transformCanvas.h,s>i&&a==="meet"||s<i&&a==="slice"?(this.transformCanvas.sx=t/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=t/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=o/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=o/(this.transformCanvas.h/this.renderConfig.dpr)),c==="xMid"&&(s<i&&a==="meet"||s>i&&a==="slice")?this.transformCanvas.tx=(t-this.transformCanvas.w*(o/this.transformCanvas.h))/2*this.renderConfig.dpr:c==="xMax"&&(s<i&&a==="meet"||s>i&&a==="slice")?this.transformCanvas.tx=(t-this.transformCanvas.w*(o/this.transformCanvas.h))*this.renderConfig.dpr:this.transformCanvas.tx=0,d==="YMid"&&(s>i&&a==="meet"||s<i&&a==="slice")?this.transformCanvas.ty=(o-this.transformCanvas.h*(t/this.transformCanvas.w))/2*this.renderConfig.dpr:d==="YMax"&&(s>i&&a==="meet"||s<i&&a==="slice")?this.transformCanvas.ty=(o-this.transformCanvas.h*(t/this.transformCanvas.w))*this.renderConfig.dpr:this.transformCanvas.ty=0}else this.renderConfig.preserveAspectRatio==="none"?(this.transformCanvas.sx=t/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=o/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText="");var n,e=this.layers?this.layers.length:0;for(n=e-1;n>=0;n-=1)this.elements[n]&&this.elements[n].destroy&&this.elements[n].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(n,e){if(!(this.renderedFrame===n&&this.renderConfig.clearCanvas===!0&&!e||this.destroyed||n===-1)){this.renderedFrame=n,this.globalData.frameNum=n-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||e,this.globalData.projectInterface.currentFrame=n;var t,o=this.layers.length;for(this.completeLayers||this.checkLayers(n),t=o-1;t>=0;t-=1)(this.completeLayers||this.elements[t])&&this.elements[t].prepareFrame(n-this.layers[t].st);if(this.globalData._mdf){for(this.renderConfig.clearCanvas===!0?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),t=o-1;t>=0;t-=1)(this.completeLayers||this.elements[t])&&this.elements[t].renderFrame();this.renderConfig.clearCanvas!==!0&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(n){var e=this.elements;if(!(e[n]||this.layers[n].ty===99)){var t=this.createItem(this.layers[n],this,this.globalData);e[n]=t,t.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var n=this.pendingElements.pop();n.checkParenting()}},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"};function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){this.stack=[],this.cArrPos=0,this.cTr=new Matrix;var n,e=15;for(n=0;n<e;n+=1){var t=new CanvasContext;this.stack[n]=t}this._length=e,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}CVContextData.prototype.duplicate=function(){var n=this._length*2,e=0;for(e=this._length;e<n;e+=1)this.stack[e]=new CanvasContext;this._length=n},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(n){this.cArrPos-=1;var e=this.stack[this.cArrPos],t=e.transform,o,i=this.cTr.props;for(o=0;o<16;o+=1)i[o]=t[o];if(n){this.nativeContext.restore();var s=this.stack[this.cArrPos+1];this.appliedFillStyle=s.fillStyle,this.appliedStrokeStyle=s.strokeStyle,this.appliedLineWidth=s.lineWidth,this.appliedLineCap=s.lineCap,this.appliedLineJoin=s.lineJoin,this.appliedMiterLimit=s.miterLimit}this.nativeContext.setTransform(t[0],t[1],t[4],t[5],t[12],t[13]),(n||e.opacity!==-1&&this.currentOpacity!==e.opacity)&&(this.nativeContext.globalAlpha=e.opacity,this.currentOpacity=e.opacity),this.currentFillStyle=e.fillStyle,this.currentStrokeStyle=e.strokeStyle,this.currentLineWidth=e.lineWidth,this.currentLineCap=e.lineCap,this.currentLineJoin=e.lineJoin,this.currentMiterLimit=e.miterLimit},CVContextData.prototype.save=function(n){n&&this.nativeContext.save();var e=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var t=this.stack[this.cArrPos],o;for(o=0;o<16;o+=1)t.transform[o]=e[o];this.cArrPos+=1;var i=this.stack[this.cArrPos];i.opacity=t.opacity,i.fillStyle=t.fillStyle,i.strokeStyle=t.strokeStyle,i.lineWidth=t.lineWidth,i.lineCap=t.lineCap,i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit},CVContextData.prototype.setOpacity=function(n){this.stack[this.cArrPos].opacity=n},CVContextData.prototype.setContext=function(n){this.nativeContext=n},CVContextData.prototype.fillStyle=function(n){this.stack[this.cArrPos].fillStyle!==n&&(this.currentFillStyle=n,this.stack[this.cArrPos].fillStyle=n)},CVContextData.prototype.strokeStyle=function(n){this.stack[this.cArrPos].strokeStyle!==n&&(this.currentStrokeStyle=n,this.stack[this.cArrPos].strokeStyle=n)},CVContextData.prototype.lineWidth=function(n){this.stack[this.cArrPos].lineWidth!==n&&(this.currentLineWidth=n,this.stack[this.cArrPos].lineWidth=n)},CVContextData.prototype.lineCap=function(n){this.stack[this.cArrPos].lineCap!==n&&(this.currentLineCap=n,this.stack[this.cArrPos].lineCap=n)},CVContextData.prototype.lineJoin=function(n){this.stack[this.cArrPos].lineJoin!==n&&(this.currentLineJoin=n,this.stack[this.cArrPos].lineJoin=n)},CVContextData.prototype.miterLimit=function(n){this.stack[this.cArrPos].miterLimit!==n&&(this.currentMiterLimit=n,this.stack[this.cArrPos].miterLimit=n)},CVContextData.prototype.transform=function(n){this.transformMat.cloneFromProps(n);var e=this.cTr;this.transformMat.multiply(e),e.cloneFromProps(this.transformMat.props);var t=e.props;this.nativeContext.setTransform(t[0],t[1],t[4],t[5],t[12],t[13])},CVContextData.prototype.opacity=function(n){var e=this.stack[this.cArrPos].opacity;e*=n<0?0:n,this.stack[this.cArrPos].opacity!==e&&(this.currentOpacity!==n&&(this.nativeContext.globalAlpha=n,this.currentOpacity=n),this.stack[this.cArrPos].opacity=e)},CVContextData.prototype.fill=function(n){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(n)},CVContextData.prototype.fillRect=function(n,e,t,o){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(n,e,t,o)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()};function CVCompElement(n,e,t){this.completeLayers=!1,this.layers=n.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(n,e,t),this.tm=n.tm?PropertyFactory.getProp(this,n.tm,0,e.frameRate,this):{_placeholder:!0}}extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var n=this.canvasContext;n.beginPath(),n.moveTo(0,0),n.lineTo(this.data.w,0),n.lineTo(this.data.w,this.data.h),n.lineTo(0,this.data.h),n.lineTo(0,0),n.clip();var e,t=this.layers.length;for(e=t-1;e>=0;e-=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},CVCompElement.prototype.destroy=function(){var n,e=this.layers.length;for(n=e-1;n>=0;n-=1)this.elements[n]&&this.elements[n].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(n){return new CVCompElement(n,this.globalData,this)};function CanvasRenderer(n,e){this.animationItem=n,this.renderConfig={clearCanvas:e&&e.clearCanvas!==void 0?e.clearCanvas:!0,context:e&&e.context||null,progressiveLoad:e&&e.progressiveLoad||!1,preserveAspectRatio:e&&e.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:e&&e.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:e&&e.contentVisibility||"visible",className:e&&e.className||"",id:e&&e.id||"",runExpressions:!e||e.runExpressions===void 0||e.runExpressions},this.renderConfig.dpr=e&&e.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=e&&e.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(n){return new CVCompElement(n,this.globalData,this)};function HBaseElement(){}HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.bm!==0&&this.setBlendMode()},renderElement:function(){var e=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var t=this.finalTransform.mat.toCSS();e.transform=t,e.webkitTransform=t}this.finalTransform._opMdf&&(e.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting;function HSolidElement(n,e,t){this.initElement(n,e,t)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var n;this.data.hasMask?(n=createNS("rect"),n.setAttribute("width",this.data.sw),n.setAttribute("height",this.data.sh),n.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):(n=createTag("div"),n.style.width=this.data.sw+"px",n.style.height=this.data.sh+"px",n.style.backgroundColor=this.data.sc),this.layerElement.appendChild(n)};function HShapeElement(n,e,t){this.shapes=[],this.shapesData=n.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(n,e,t),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var n;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),n=this.svgElement;else{n=createNS("svg");var e=this.comp.data?this.comp.data:this.globalData.compSize;n.setAttribute("width",e.w),n.setAttribute("height",e.h),n.appendChild(this.shapesContainer),this.layerElement.appendChild(n)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=n},HShapeElement.prototype.getTransformedPoint=function(n,e){var t,o=n.length;for(t=0;t<o;t+=1)e=n[t].mProps.v.applyToPointArray(e[0],e[1],0);return e},HShapeElement.prototype.calculateShapeBoundingBox=function(n,e){var t=n.sh.v,o=n.transformers,i,s=t._length,r,a,l,c;if(!(s<=1)){for(i=0;i<s-1;i+=1)r=this.getTransformedPoint(o,t.v[i]),a=this.getTransformedPoint(o,t.o[i]),l=this.getTransformedPoint(o,t.i[i+1]),c=this.getTransformedPoint(o,t.v[i+1]),this.checkBounds(r,a,l,c,e);t.c&&(r=this.getTransformedPoint(o,t.v[i]),a=this.getTransformedPoint(o,t.o[i]),l=this.getTransformedPoint(o,t.i[0]),c=this.getTransformedPoint(o,t.v[0]),this.checkBounds(r,a,l,c,e))}},HShapeElement.prototype.checkBounds=function(n,e,t,o,i){this.getBoundsOfCurve(n,e,t,o);var s=this.shapeBoundingBox;i.x=bmMin(s.left,i.x),i.xMax=bmMax(s.right,i.xMax),i.y=bmMin(s.top,i.y),i.yMax=bmMax(s.bottom,i.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(n,e,t,o){for(var i=[[n[0],o[0]],[n[1],o[1]]],s,r,a,l,c,d,u,f=0;f<2;++f)r=6*n[f]-12*e[f]+6*t[f],s=-3*n[f]+9*e[f]-9*t[f]+3*o[f],a=3*e[f]-3*n[f],r|=0,s|=0,a|=0,s===0&&r===0||(s===0?(l=-a/r,l>0&&l<1&&i[f].push(this.calculateF(l,n,e,t,o,f))):(c=r*r-4*a*s,c>=0&&(d=(-r+bmSqrt(c))/(2*s),d>0&&d<1&&i[f].push(this.calculateF(d,n,e,t,o,f)),u=(-r-bmSqrt(c))/(2*s),u>0&&u<1&&i[f].push(this.calculateF(u,n,e,t,o,f)))));this.shapeBoundingBox.left=bmMin.apply(null,i[0]),this.shapeBoundingBox.top=bmMin.apply(null,i[1]),this.shapeBoundingBox.right=bmMax.apply(null,i[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,i[1])},HShapeElement.prototype.calculateF=function(n,e,t,o,i,s){return bmPow(1-n,3)*e[s]+3*bmPow(1-n,2)*n*t[s]+3*(1-n)*bmPow(n,2)*o[s]+bmPow(n,3)*i[s]},HShapeElement.prototype.calculateBoundingBox=function(n,e){var t,o=n.length;for(t=0;t<o;t+=1)n[t]&&n[t].sh?this.calculateShapeBoundingBox(n[t],e):n[t]&&n[t].it?this.calculateBoundingBox(n[t].it,e):n[t]&&n[t].style&&n[t].w&&this.expandStrokeBoundingBox(n[t].w,e)},HShapeElement.prototype.expandStrokeBoundingBox=function(n,e){var t=0;if(n.keyframes){for(var o=0;o<n.keyframes.length;o+=1){var i=n.keyframes[o].s;i>t&&(t=i)}t*=n.mult}else t=n.v*n.mult;e.x-=t,e.xMax+=t,e.y-=t,e.yMax+=t},HShapeElement.prototype.currentBoxContains=function(n){return this.currentBBox.x<=n.x&&this.currentBBox.y<=n.y&&this.currentBBox.width+this.currentBBox.x>=n.x+n.width&&this.currentBBox.height+this.currentBBox.y>=n.y+n.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var n=this.tempBoundingBox,e=999999;if(n.x=e,n.xMax=-e,n.y=e,n.yMax=-e,this.calculateBoundingBox(this.itemsData,n),n.width=n.xMax<n.x?0:n.xMax-n.x,n.height=n.yMax<n.y?0:n.yMax-n.y,this.currentBoxContains(n))return;var t=!1;if(this.currentBBox.w!==n.width&&(this.currentBBox.w=n.width,this.shapeCont.setAttribute("width",n.width),t=!0),this.currentBBox.h!==n.height&&(this.currentBBox.h=n.height,this.shapeCont.setAttribute("height",n.height),t=!0),t||this.currentBBox.x!==n.x||this.currentBBox.y!==n.y){this.currentBBox.w=n.width,this.currentBBox.h=n.height,this.currentBBox.x=n.x,this.currentBBox.y=n.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var o=this.shapeCont.style,i="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";o.transform=i,o.webkitTransform=i}}};function HTextElement(n,e,t){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(n,e,t)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var n=createNS("g");this.maskedElement.appendChild(n),this.innerElem=n}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var n=this.textProperty.currentData;this.renderedLetters=createSizedArray(n.l?n.l.length:0);var e=this.innerElem.style,t=n.fc?this.buildColor(n.fc):"rgba(0,0,0,0)";e.fill=t,e.color=t,n.sc&&(e.stroke=this.buildColor(n.sc),e.strokeWidth=n.sw+"px");var o=this.globalData.fontManager.getFontByName(n.f);if(!this.globalData.fontManager.chars)if(e.fontSize=n.finalSize+"px",e.lineHeight=n.finalSize+"px",o.fClass)this.innerElem.className=o.fClass;else{e.fontFamily=o.fFamily;var i=n.fWeight,s=n.fStyle;e.fontStyle=s,e.fontWeight=i}var r,a,l=n.l;a=l.length;var c,d,u,f=this.mHelper,h,m="",p=0;for(r=0;r<a;r+=1){if(this.globalData.fontManager.chars?(this.textPaths[p]?c=this.textPaths[p]:(c=createNS("path"),c.setAttribute("stroke-linecap",lineCapEnum[1]),c.setAttribute("stroke-linejoin",lineJoinEnum[2]),c.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[p]?(d=this.textSpans[p],u=d.children[0]):(d=createTag("div"),d.style.lineHeight=0,u=createNS("svg"),u.appendChild(c),styleDiv(d)))):this.isMasked?c=this.textPaths[p]?this.textPaths[p]:createNS("text"):this.textSpans[p]?(d=this.textSpans[p],c=this.textPaths[p]):(d=createTag("span"),styleDiv(d),c=createTag("span"),styleDiv(c),d.appendChild(c)),this.globalData.fontManager.chars){var v=this.globalData.fontManager.getCharData(n.finalText[r],o.fStyle,this.globalData.fontManager.getFontByName(n.f).fFamily),g;if(v?g=v.data:g=null,f.reset(),g&&g.shapes&&g.shapes.length&&(h=g.shapes[0].it,f.scale(n.finalSize/100,n.finalSize/100),m=this.createPathShape(f,h),c.setAttribute("d",m)),this.isMasked)this.innerElem.appendChild(c);else{if(this.innerElem.appendChild(d),g&&g.shapes){document.body.appendChild(u);var y=u.getBBox();u.setAttribute("width",y.width+2),u.setAttribute("height",y.height+2),u.setAttribute("viewBox",y.x-1+" "+(y.y-1)+" "+(y.width+2)+" "+(y.height+2));var w=u.style,_="translate("+(y.x-1)+"px,"+(y.y-1)+"px)";w.transform=_,w.webkitTransform=_,l[r].yOffset=y.y-1}else u.setAttribute("width",1),u.setAttribute("height",1);d.appendChild(u)}}else if(c.textContent=l[r].val,c.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(c);else{this.innerElem.appendChild(d);var S=c.style,C="translate3d(0,"+-n.finalSize/1.2+"px,0)";S.transform=C,S.webkitTransform=C}this.isMasked?this.textSpans[p]=c:this.textSpans[p]=d,this.textSpans[p].style.display="block",this.textPaths[p]=c,p+=1}for(;p<this.textSpans.length;)this.textSpans[p].style.display="none",p+=1},HTextElement.prototype.renderInnerContent=function(){this.validateText();var n;if(this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),n=this.svgElement.style;var e="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";n.transform=e,n.webkitTransform=e}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),!(!this.lettersChangedFlag&&!this.textAnimator.lettersChangedFlag)){var t,o,i=0,s=this.textAnimator.renderedLetters,r=this.textProperty.currentData.l;o=r.length;var a,l,c;for(t=0;t<o;t+=1)r[t].n?i+=1:(l=this.textSpans[t],c=this.textPaths[t],a=s[i],i+=1,a._mdf.m&&(this.isMasked?l.setAttribute("transform",a.m):(l.style.webkitTransform=a.m,l.style.transform=a.m)),l.style.opacity=a.o,a.sw&&a._mdf.sw&&c.setAttribute("stroke-width",a.sw),a.sc&&a._mdf.sc&&c.setAttribute("stroke",a.sc),a.fc&&a._mdf.fc&&(c.setAttribute("fill",a.fc),c.style.color=a.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var d=this.innerElem.getBBox();this.currentBBox.w!==d.width&&(this.currentBBox.w=d.width,this.svgElement.setAttribute("width",d.width)),this.currentBBox.h!==d.height&&(this.currentBBox.h=d.height,this.svgElement.setAttribute("height",d.height));var u=1;if(this.currentBBox.w!==d.width+u*2||this.currentBBox.h!==d.height+u*2||this.currentBBox.x!==d.x-u||this.currentBBox.y!==d.y-u){this.currentBBox.w=d.width+u*2,this.currentBBox.h=d.height+u*2,this.currentBBox.x=d.x-u,this.currentBBox.y=d.y-u,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),n=this.svgElement.style;var f="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";n.transform=f,n.webkitTransform=f}}}};function HCameraElement(n,e,t){this.initFrame(),this.initBaseData(n,e,t),this.initHierarchy();var o=PropertyFactory.getProp;if(this.pe=o(this,n.pe,0,0,this),n.ks.p.s?(this.px=o(this,n.ks.p.x,1,0,this),this.py=o(this,n.ks.p.y,1,0,this),this.pz=o(this,n.ks.p.z,1,0,this)):this.p=o(this,n.ks.p,1,0,this),n.ks.a&&(this.a=o(this,n.ks.a,1,0,this)),n.ks.or.k.length&&n.ks.or.k[0].to){var i,s=n.ks.or.k.length;for(i=0;i<s;i+=1)n.ks.or.k[i].to=null,n.ks.or.k[i].ti=null}this.or=o(this,n.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=o(this,n.ks.rx,0,degToRads,this),this.ry=o(this,n.ks.ry,0,degToRads,this),this.rz=o(this,n.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var n,e=this.comp.threeDElements.length,t,o,i;for(n=0;n<e;n+=1)if(t=this.comp.threeDElements[n],t.type==="3d"){o=t.perspectiveElem.style,i=t.container.style;var s=this.pe.v+"px",r="0px 0px 0px",a="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";o.perspective=s,o.webkitPerspective=s,i.transformOrigin=r,i.mozTransformOrigin=r,i.webkitTransformOrigin=r,o.transform=a,o.webkitTransform=a}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var n=this._isFirstFrame,e,t;if(this.hierarchy)for(t=this.hierarchy.length,e=0;e<t;e+=1)n=this.hierarchy[e].finalTransform.mProp._mdf||n;if(n||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(t=this.hierarchy.length-1,e=t;e>=0;e-=1){var o=this.hierarchy[e].finalTransform.mProp;this.mat.translate(-o.p.v[0],-o.p.v[1],o.p.v[2]),this.mat.rotateX(-o.or.v[0]).rotateY(-o.or.v[1]).rotateZ(o.or.v[2]),this.mat.rotateX(-o.rx.v).rotateY(-o.ry.v).rotateZ(o.rz.v),this.mat.scale(1/o.s.v[0],1/o.s.v[1],1/o.s.v[2]),this.mat.translate(o.a.v[0],o.a.v[1],o.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var i;this.p?i=[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:i=[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var s=Math.sqrt(Math.pow(i[0],2)+Math.pow(i[1],2)+Math.pow(i[2],2)),r=[i[0]/s,i[1]/s,i[2]/s],a=Math.sqrt(r[2]*r[2]+r[0]*r[0]),l=Math.atan2(r[1],a),c=Math.atan2(r[0],-r[2]);this.mat.rotateY(c).rotateX(-l)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var d=!this._prevMat.equals(this.mat);if((d||this.pe._mdf)&&this.comp.threeDElements){t=this.comp.threeDElements.length;var u,f,h;for(e=0;e<t;e+=1)if(u=this.comp.threeDElements[e],u.type==="3d"){if(d){var m=this.mat.toCSS();h=u.container.style,h.transform=m,h.webkitTransform=m}this.pe._mdf&&(f=u.perspectiveElem.style,f.perspective=this.pe.v+"px",f.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(n){this.prepareProperties(n,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null};function HImageElement(n,e,t){this.assetData=e.getAssetData(n.refId),this.initElement(n,e,t)}extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var n=this.globalData.getAssetsPath(this.assetData),e=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",n),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(e),e.crossOrigin="anonymous",e.src=n,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)};function HybridRendererBase(n,e){this.animationItem=n,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:e&&e.className||"",imagePreserveAspectRatio:e&&e.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(e&&e.hideOnTransparent===!1),filterSize:{width:e&&e.filterSize&&e.filterSize.width||"400%",height:e&&e.filterSize&&e.filterSize.height||"400%",x:e&&e.filterSize&&e.filterSize.x||"-100%",y:e&&e.filterSize&&e.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var n=this.pendingElements.pop();n.checkParenting()}},HybridRendererBase.prototype.appendElementInPos=function(n,e){var t=n.getBaseElement();if(t){var o=this.layers[e];if(!o.ddd||!this.supports3d)if(this.threeDElements)this.addTo3dContainer(t,e);else{for(var i=0,s,r,a;i<e;)this.elements[i]&&this.elements[i]!==!0&&this.elements[i].getBaseElement&&(r=this.elements[i],a=this.layers[i].ddd?this.getThreeDContainerByPos(i):r.getBaseElement(),s=a||s),i+=1;s?(!o.ddd||!this.supports3d)&&this.layerElement.insertBefore(t,s):(!o.ddd||!this.supports3d)&&this.layerElement.appendChild(t)}else this.addTo3dContainer(t,e)}},HybridRendererBase.prototype.createShape=function(n){return this.supports3d?new HShapeElement(n,this.globalData,this):new SVGShapeElement(n,this.globalData,this)},HybridRendererBase.prototype.createText=function(n){return this.supports3d?new HTextElement(n,this.globalData,this):new SVGTextLottieElement(n,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(n){return this.camera=new HCameraElement(n,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(n){return this.supports3d?new HImageElement(n,this.globalData,this):new IImageElement(n,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(n){return this.supports3d?new HSolidElement(n,this.globalData,this):new ISolidElement(n,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(n){for(var e=0,t=this.threeDElements.length;e<t;){if(this.threeDElements[e].startPos<=n&&this.threeDElements[e].endPos>=n)return this.threeDElements[e].perspectiveElem;e+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(n,e){var t=createTag("div"),o,i;styleDiv(t);var s=createTag("div");if(styleDiv(s),e==="3d"){o=t.style,o.width=this.globalData.compSize.w+"px",o.height=this.globalData.compSize.h+"px";var r="50% 50%";o.webkitTransformOrigin=r,o.mozTransformOrigin=r,o.transformOrigin=r,i=s.style;var a="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";i.transform=a,i.webkitTransform=a}t.appendChild(s);var l={container:s,perspectiveElem:t,startPos:n,endPos:n,type:e};return this.threeDElements.push(l),l},HybridRendererBase.prototype.build3dContainers=function(){var n,e=this.layers.length,t,o="";for(n=0;n<e;n+=1)this.layers[n].ddd&&this.layers[n].ty!==3?(o!=="3d"&&(o="3d",t=this.createThreeDContainer(n,"3d")),t.endPos=Math.max(t.endPos,n)):(o!=="2d"&&(o="2d",t=this.createThreeDContainer(n,"2d")),t.endPos=Math.max(t.endPos,n));for(e=this.threeDElements.length,n=e-1;n>=0;n-=1)this.resizerElem.appendChild(this.threeDElements[n].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(n,e){for(var t=0,o=this.threeDElements.length;t<o;){if(e<=this.threeDElements[t].endPos){for(var i=this.threeDElements[t].startPos,s;i<e;)this.elements[i]&&this.elements[i].getBaseElement&&(s=this.elements[i].getBaseElement()),i+=1;s?this.threeDElements[t].container.insertBefore(n,s):this.threeDElements[t].container.appendChild(n);break}t+=1}},HybridRendererBase.prototype.configAnimation=function(n){var e=createTag("div"),t=this.animationItem.wrapper,o=e.style;o.width=n.w+"px",o.height=n.h+"px",this.resizerElem=e,styleDiv(e),o.transformStyle="flat",o.mozTransformStyle="flat",o.webkitTransformStyle="flat",this.renderConfig.className&&e.setAttribute("class",this.renderConfig.className),t.appendChild(e),o.overflow="hidden";var i=createNS("svg");i.setAttribute("width","1"),i.setAttribute("height","1"),styleDiv(i),this.resizerElem.appendChild(i);var s=createNS("defs");i.appendChild(s),this.data=n,this.setupGlobalData(n,i),this.globalData.defs=s,this.layers=n.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var n,e=this.layers?this.layers.length:0;for(n=0;n<e;n+=1)this.elements[n]&&this.elements[n].destroy&&this.elements[n].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var n=this.animationItem.wrapper.offsetWidth,e=this.animationItem.wrapper.offsetHeight,t=n/e,o=this.globalData.compSize.w/this.globalData.compSize.h,i,s,r,a;o>t?(i=n/this.globalData.compSize.w,s=n/this.globalData.compSize.w,r=0,a=(e-this.globalData.compSize.h*(n/this.globalData.compSize.w))/2):(i=e/this.globalData.compSize.h,s=e/this.globalData.compSize.h,r=(n-this.globalData.compSize.w*(e/this.globalData.compSize.h))/2,a=0);var l=this.resizerElem.style;l.webkitTransform="matrix3d("+i+",0,0,0,0,"+s+",0,0,0,0,1,0,"+r+","+a+",0,1)",l.transform=l.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var n=this.globalData.compSize.w,e=this.globalData.compSize.h,t,o=this.threeDElements.length;for(t=0;t<o;t+=1){var i=this.threeDElements[t].perspectiveElem.style;i.webkitPerspective=Math.sqrt(Math.pow(n,2)+Math.pow(e,2))+"px",i.perspective=i.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(n){var e,t=n.length,o=createTag("div");for(e=0;e<t;e+=1)if(n[e].xt){var i=this.createComp(n[e],o,this.globalData.comp,null);i.initExpressions(),this.globalData.projectInterface.registerComposition(i)}};function HCompElement(n,e,t){this.layers=n.layers,this.supports3d=!n.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(n,e,t),this.tm=n.tm?PropertyFactory.getProp(this,n.tm,0,e.frameRate,this):{_placeholder:!0}}extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(n,e){for(var t=0,o;t<e;)this.elements[t]&&this.elements[t].getBaseElement&&(o=this.elements[t].getBaseElement()),t+=1;o?this.layerElement.insertBefore(n,o):this.layerElement.appendChild(n)},HCompElement.prototype.createComp=function(n){return this.supports3d?new HCompElement(n,this.globalData,this):new SVGCompElement(n,this.globalData,this)};function HybridRenderer(n,e){this.animationItem=n,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:e&&e.className||"",imagePreserveAspectRatio:e&&e.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(e&&e.hideOnTransparent===!1),filterSize:{width:e&&e.filterSize&&e.filterSize.width||"400%",height:e&&e.filterSize&&e.filterSize.height||"400%",x:e&&e.filterSize&&e.filterSize.x||"-100%",y:e&&e.filterSize&&e.filterSize.y||"-100%"},runExpressions:!e||e.runExpressions===void 0||e.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(n){return this.supports3d?new HCompElement(n,this.globalData,this):new SVGCompElement(n,this.globalData,this)};var CompExpressionInterface=function(){return function(n){function e(t){for(var o=0,i=n.layers.length;o<i;){if(n.layers[o].nm===t||n.layers[o].ind===t)return n.elements[o].layerInterface;o+=1}return null}return Object.defineProperty(e,"_name",{value:n.data.nm}),e.layer=e,e.pixelAspect=1,e.height=n.data.h||n.globalData.compSize.h,e.width=n.data.w||n.globalData.compSize.w,e.pixelAspect=1,e.frameDuration=1/n.globalData.frameRate,e.displayStartTime=0,e.numLayers=n.layers.length,e}}();function _typeof$2(n){"@babel/helpers - typeof";return _typeof$2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$2(n)}function seedRandom(n,e){var t=this,o=256,i=6,s=52,r="random",a=e.pow(o,i),l=e.pow(2,s),c=l*2,d=o-1,u;function f(w,_,S){var C=[];_=_===!0?{entropy:!0}:_||{};var A=v(p(_.entropy?[w,y(n)]:w===null?g():w,3),C),E=new h(C),k=function(){for(var F=E.g(i),M=a,R=0;F<l;)F=(F+R)*o,M*=o,R=E.g(1);for(;F>=c;)F/=2,M/=2,R>>>=1;return(F+R)/M};return k.int32=function(){return E.g(4)|0},k.quick=function(){return E.g(4)/4294967296},k.double=k,v(y(E.S),n),(_.pass||S||function(I,F,M,R){return R&&(R.S&&m(R,E),I.state=function(){return m(E,{})}),M?(e[r]=I,F):I})(k,A,"global"in _?_.global:this==e,_.state)}e["seed"+r]=f;function h(w){var _,S=w.length,C=this,A=0,E=C.i=C.j=0,k=C.S=[];for(S||(w=[S++]);A<o;)k[A]=A++;for(A=0;A<o;A++)k[A]=k[E=d&E+w[A%S]+(_=k[A])],k[E]=_;C.g=function(I){for(var F,M=0,R=C.i,O=C.j,$=C.S;I--;)F=$[R=d&R+1],M=M*o+$[d&($[R]=$[O=d&O+F])+($[O]=F)];return C.i=R,C.j=O,M}}function m(w,_){return _.i=w.i,_.j=w.j,_.S=w.S.slice(),_}function p(w,_){var S=[],C=_typeof$2(w),A;if(_&&C=="object")for(A in w)try{S.push(p(w[A],_-1))}catch{}return S.length?S:C=="string"?w:w+"\0"}function v(w,_){for(var S=w+"",C,A=0;A<S.length;)_[d&A]=d&(C^=_[d&A]*19)+S.charCodeAt(A++);return y(_)}function g(){try{var w=new Uint8Array(o);return(t.crypto||t.msCrypto).getRandomValues(w),y(w)}catch{var _=t.navigator,S=_&&_.plugins;return[+new Date,t,S,t.screen,y(n)]}}function y(w){return String.fromCharCode.apply(0,w)}v(e.random(),n)}function initialize$2(n){seedRandom([],n)}var propTypes={SHAPE:"shape"};function _typeof$1(n){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof$1(n)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};initialize$2(BMMath);function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(n){return n.constructor===Array||n.constructor===Float32Array}function isNumerable(n,e){return n==="number"||e instanceof Number||n==="boolean"||n==="string"}function $bm_neg(n){var e=_typeof$1(n);if(e==="number"||n instanceof Number||e==="boolean")return-n;if($bm_isInstanceOfArray(n)){var t,o=n.length,i=[];for(t=0;t<o;t+=1)i[t]=-n[t];return i}return n.propType?n.v:-n}var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(n,e){var t=_typeof$1(n),o=_typeof$1(e);if(isNumerable(t,n)&&isNumerable(o,e)||t==="string"||o==="string")return n+e;if($bm_isInstanceOfArray(n)&&isNumerable(o,e))return n=n.slice(0),n[0]+=e,n;if(isNumerable(t,n)&&$bm_isInstanceOfArray(e))return e=e.slice(0),e[0]=n+e[0],e;if($bm_isInstanceOfArray(n)&&$bm_isInstanceOfArray(e)){for(var i=0,s=n.length,r=e.length,a=[];i<s||i<r;)(typeof n[i]=="number"||n[i]instanceof Number)&&(typeof e[i]=="number"||e[i]instanceof Number)?a[i]=n[i]+e[i]:a[i]=e[i]===void 0?n[i]:n[i]||e[i],i+=1;return a}return 0}var add=sum;function sub(n,e){var t=_typeof$1(n),o=_typeof$1(e);if(isNumerable(t,n)&&isNumerable(o,e))return t==="string"&&(n=parseInt(n,10)),o==="string"&&(e=parseInt(e,10)),n-e;if($bm_isInstanceOfArray(n)&&isNumerable(o,e))return n=n.slice(0),n[0]-=e,n;if(isNumerable(t,n)&&$bm_isInstanceOfArray(e))return e=e.slice(0),e[0]=n-e[0],e;if($bm_isInstanceOfArray(n)&&$bm_isInstanceOfArray(e)){for(var i=0,s=n.length,r=e.length,a=[];i<s||i<r;)(typeof n[i]=="number"||n[i]instanceof Number)&&(typeof e[i]=="number"||e[i]instanceof Number)?a[i]=n[i]-e[i]:a[i]=e[i]===void 0?n[i]:n[i]||e[i],i+=1;return a}return 0}function mul(n,e){var t=_typeof$1(n),o=_typeof$1(e),i;if(isNumerable(t,n)&&isNumerable(o,e))return n*e;var s,r;if($bm_isInstanceOfArray(n)&&isNumerable(o,e)){for(r=n.length,i=createTypedArray("float32",r),s=0;s<r;s+=1)i[s]=n[s]*e;return i}if(isNumerable(t,n)&&$bm_isInstanceOfArray(e)){for(r=e.length,i=createTypedArray("float32",r),s=0;s<r;s+=1)i[s]=n*e[s];return i}return 0}function div(n,e){var t=_typeof$1(n),o=_typeof$1(e),i;if(isNumerable(t,n)&&isNumerable(o,e))return n/e;var s,r;if($bm_isInstanceOfArray(n)&&isNumerable(o,e)){for(r=n.length,i=createTypedArray("float32",r),s=0;s<r;s+=1)i[s]=n[s]/e;return i}if(isNumerable(t,n)&&$bm_isInstanceOfArray(e)){for(r=e.length,i=createTypedArray("float32",r),s=0;s<r;s+=1)i[s]=n/e[s];return i}return 0}function mod(n,e){return typeof n=="string"&&(n=parseInt(n,10)),typeof e=="string"&&(e=parseInt(e,10)),n%e}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(n,e,t){if(e>t){var o=t;t=e,e=o}return Math.min(Math.max(n,e),t)}function radiansToDegrees(n){return n/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(n){return n*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(n,e){if(typeof n=="number"||n instanceof Number)return e=e||0,Math.abs(n-e);e||(e=helperLengthArray);var t,o=Math.min(n.length,e.length),i=0;for(t=0;t<o;t+=1)i+=Math.pow(e[t]-n[t],2);return Math.sqrt(i)}function normalize(n){return div(n,length(n))}function rgbToHsl(n){var e=n[0],t=n[1],o=n[2],i=Math.max(e,t,o),s=Math.min(e,t,o),r,a,l=(i+s)/2;if(i===s)r=0,a=0;else{var c=i-s;switch(a=l>.5?c/(2-i-s):c/(i+s),i){case e:r=(t-o)/c+(t<o?6:0);break;case t:r=(o-e)/c+2;break;case o:r=(e-t)/c+4;break}r/=6}return[r,a,l,n[3]]}function hue2rgb(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}function hslToRgb(n){var e=n[0],t=n[1],o=n[2],i,s,r;if(t===0)i=o,r=o,s=o;else{var a=o<.5?o*(1+t):o+t-o*t,l=2*o-a;i=hue2rgb(l,a,e+1/3),s=hue2rgb(l,a,e),r=hue2rgb(l,a,e-1/3)}return[i,s,r,n[3]]}function linear(n,e,t,o,i){if((o===void 0||i===void 0)&&(o=e,i=t,e=0,t=1),t<e){var s=t;t=e,e=s}if(n<=e)return o;if(n>=t)return i;var r=t===e?0:(n-e)/(t-e);if(!o.length)return o+(i-o)*r;var a,l=o.length,c=createTypedArray("float32",l);for(a=0;a<l;a+=1)c[a]=o[a]+(i[a]-o[a])*r;return c}function random(n,e){if(e===void 0&&(n===void 0?(n=0,e=1):(e=n,n=void 0)),e.length){var t,o=e.length;n||(n=createTypedArray("float32",o));var i=createTypedArray("float32",o),s=BMMath.random();for(t=0;t<o;t+=1)i[t]=n[t]+s*(e[t]-n[t]);return i}n===void 0&&(n=0);var r=BMMath.random();return n+r*(e-n)}function createPath(n,e,t,o){var i,s=n.length,r=shapePool.newElement();r.setPathData(!!o,s);var a=[0,0],l,c;for(i=0;i<s;i+=1)l=e&&e[i]?e[i]:a,c=t&&t[i]?t[i]:a,r.setTripleAt(n[i][0],n[i][1],c[0]+n[i][0],c[1]+n[i][1],l[0]+n[i][0],l[1]+n[i][1],i,!0);return r}function initiateExpression(elem,data,property){function noOp(n){return n}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=val.indexOf("random")!==-1,elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty._name=elem.data.nm,thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||this.data.hd!==!0,wiggle=(function n(e,t){var o,i,s=this.pv.length?this.pv.length:1,r=createTypedArray("float32",s);e=5;var a=Math.floor(time*e);for(o=0,i=0;o<a;){for(i=0;i<s;i+=1)r[i]+=-t+t*2*BMMath.random();o+=1}var l=time*e,c=l-Math.floor(l),d=createTypedArray("float32",s);if(s>1){for(i=0;i<s;i+=1)d[i]=this.pv[i]+r[i]+(-t+t*2*BMMath.random())*c;return d}return this.pv+r[0]+(-t+t*2*BMMath.random())*c}).bind(this);thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty));function loopInDuration(n,e){return loopIn(n,e,!0)}function loopOutDuration(n,e){return loopOut(n,e,!0)}this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);function lookAt(n,e){var t=[e[0]-n[0],e[1]-n[1],e[2]-n[2]],o=Math.atan2(t[0],Math.sqrt(t[1]*t[1]+t[2]*t[2]))/degToRads,i=-Math.atan2(t[1],t[2])/degToRads;return[i,o,0]}function easeOut(n,e,t,o,i){return applyEase(easeOutBez,n,e,t,o,i)}function easeIn(n,e,t,o,i){return applyEase(easeInBez,n,e,t,o,i)}function ease(n,e,t,o,i){return applyEase(easeInOutBez,n,e,t,o,i)}function applyEase(n,e,t,o,i,s){i===void 0?(i=t,s=o):e=(e-t)/(o-t),e>1?e=1:e<0&&(e=0);var r=n(e);if($bm_isInstanceOfArray(i)){var a,l=i.length,c=createTypedArray("float32",l);for(a=0;a<l;a+=1)c[a]=(s[a]-i[a])*r+i[a];return c}return(s-i)*r+i}function nearestKey(n){var e,t=data.k.length,o,i;if(!data.k.length||typeof data.k[0]=="number")o=0,i=0;else if(o=-1,n*=elem.comp.globalData.frameRate,n<data.k[0].t)o=1,i=data.k[0].t;else{for(e=0;e<t-1;e+=1)if(n===data.k[e].t){o=e+1,i=data.k[e].t;break}else if(n>data.k[e].t&&n<data.k[e+1].t){n-data.k[e].t>data.k[e+1].t-n?(o=e+2,i=data.k[e+1].t):(o=e+1,i=data.k[e].t);break}o===-1&&(o=e+1,i=data.k[e].t)}var s={};return s.index=o,s.time=i/elem.comp.globalData.frameRate,s}function key(n){var e,t,o;if(!data.k.length||typeof data.k[0]=="number")throw new Error("The property has no keyframe at index "+n);n-=1,e={time:data.k[n].t/elem.comp.globalData.frameRate,value:[]};var i=Object.prototype.hasOwnProperty.call(data.k[n],"s")?data.k[n].s:data.k[n-1].e;for(o=i.length,t=0;t<o;t+=1)e[t]=i[t],e.value[t]=i[t];return e}function framesToTime(n,e){return e||(e=elem.comp.globalData.frameRate),n/e}function timeToFrames(n,e){return!n&&n!==0&&(n=time),e||(e=elem.comp.globalData.frameRate),n*e}function seedRandom(n){BMMath.seedrandom(randSeed+n)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(n,e){return typeof value=="string"?e===void 0?value.substring(n):value.substring(n,e):""}function substr(n,e){return typeof value=="string"?e===void 0?value.substr(n):value.substr(n,e):""}function posterizeTime(n){time=n===0?0:Math.floor(time*n)/n,value=valueAtTime(time)}var time,velocity,value,text,textIndex,textTotal,selectorValue,index=elem.data.ind,hasParent=!!(elem.hierarchy&&elem.hierarchy.length),parent,randSeed=Math.floor(Math.random()*1e6),globalData=elem.globalData;function executeExpression(n){return value=n,this.frameExpressionId===elem.globalData.frameId&&this.propType!=="textSelector"?value:(this.propType==="textSelector"&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),elemType===4&&!content&&(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),hasParent=!!(elem.hierarchy&&elem.hierarchy.length),hasParent&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt,scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var n={};n.initExpressions=e,n.resetFrame=ExpressionManager.resetFrame;function e(t){var o=0,i=[];function s(){o+=1}function r(){o-=1,o===0&&l()}function a(c){i.indexOf(c)===-1&&i.push(c)}function l(){var c,d=i.length;for(c=0;c<d;c+=1)i[c].release();i.length=0}t.renderer.compInterface=CompExpressionInterface(t.renderer),t.renderer.globalData.projectInterface.registerComposition(t.renderer),t.renderer.globalData.pushExpression=s,t.renderer.globalData.popExpression=r,t.renderer.globalData.registerExpressionProperty=a}return n}(),MaskManagerInterface=function(){function n(t,o){this._mask=t,this._data=o}Object.defineProperty(n.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(n.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),this._mask.op.v*100}});var e=function(o){var i=createSizedArray(o.viewData.length),s,r=o.viewData.length;for(s=0;s<r;s+=1)i[s]=new n(o.viewData[s],o.masksProperties[s]);var a=function(c){for(s=0;s<r;){if(o.masksProperties[s].nm===c)return i[s];s+=1}return null};return a};return e}(),ExpressionPropertyInterface=function(){var n={pv:0,v:0,mult:1},e={pv:[0,0,0],v:[0,0,0],mult:1};function t(r,a,l){Object.defineProperty(r,"velocity",{get:function(){return a.getVelocityAtTime(a.comp.currentFrame)}}),r.numKeys=a.keyframes?a.keyframes.length:0,r.key=function(c){if(!r.numKeys)return 0;var d="";"s"in a.keyframes[c-1]?d=a.keyframes[c-1].s:"e"in a.keyframes[c-2]?d=a.keyframes[c-2].e:d=a.keyframes[c-2].s;var u=l==="unidimensional"?new Number(d):Object.assign({},d);return u.time=a.keyframes[c-1].t/a.elem.comp.globalData.frameRate,u.value=l==="unidimensional"?d[0]:d,u},r.valueAtTime=a.getValueAtTime,r.speedAtTime=a.getSpeedAtTime,r.velocityAtTime=a.getVelocityAtTime,r.propertyGroup=a.propertyGroup}function o(r){(!r||!("pv"in r))&&(r=n);var a=1/r.mult,l=r.pv*a,c=new Number(l);return c.value=l,t(c,r,"unidimensional"),function(){return r.k&&r.getValue(),l=r.v*a,c.value!==l&&(c=new Number(l),c.value=l,c[0]=l,t(c,r,"unidimensional")),c}}function i(r){(!r||!("pv"in r))&&(r=e);var a=1/r.mult,l=r.data&&r.data.l||r.pv.length,c=createTypedArray("float32",l),d=createTypedArray("float32",l);return c.value=d,t(c,r,"multidimensional"),function(){r.k&&r.getValue();for(var u=0;u<l;u+=1)d[u]=r.v[u]*a,c[u]=d[u];return c}}function s(){return n}return function(r){return r?r.propType==="unidimensional"?o(r):i(r):s}}(),TransformExpressionInterface=function(){return function(n){function e(r){switch(r){case"scale":case"Scale":case"ADBE Scale":case 6:return e.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return e.rotation;case"ADBE Rotate X":return e.xRotation;case"ADBE Rotate Y":return e.yRotation;case"position":case"Position":case"ADBE Position":case 2:return e.position;case"ADBE Position_0":return e.xPosition;case"ADBE Position_1":return e.yPosition;case"ADBE Position_2":return e.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return e.anchorPoint;case"opacity":case"Opacity":case 11:return e.opacity;default:return null}}Object.defineProperty(e,"rotation",{get:ExpressionPropertyInterface(n.r||n.rz)}),Object.defineProperty(e,"zRotation",{get:ExpressionPropertyInterface(n.rz||n.r)}),Object.defineProperty(e,"xRotation",{get:ExpressionPropertyInterface(n.rx)}),Object.defineProperty(e,"yRotation",{get:ExpressionPropertyInterface(n.ry)}),Object.defineProperty(e,"scale",{get:ExpressionPropertyInterface(n.s)});var t,o,i,s;return n.p?s=ExpressionPropertyInterface(n.p):(t=ExpressionPropertyInterface(n.px),o=ExpressionPropertyInterface(n.py),n.pz&&(i=ExpressionPropertyInterface(n.pz))),Object.defineProperty(e,"position",{get:function(){return n.p?s():[t(),o(),i?i():0]}}),Object.defineProperty(e,"xPosition",{get:ExpressionPropertyInterface(n.px)}),Object.defineProperty(e,"yPosition",{get:ExpressionPropertyInterface(n.py)}),Object.defineProperty(e,"zPosition",{get:ExpressionPropertyInterface(n.pz)}),Object.defineProperty(e,"anchorPoint",{get:ExpressionPropertyInterface(n.a)}),Object.defineProperty(e,"opacity",{get:ExpressionPropertyInterface(n.o)}),Object.defineProperty(e,"skew",{get:ExpressionPropertyInterface(n.sk)}),Object.defineProperty(e,"skewAxis",{get:ExpressionPropertyInterface(n.sa)}),Object.defineProperty(e,"orientation",{get:ExpressionPropertyInterface(n.or)}),e}}(),LayerExpressionInterface=function(){function n(c){var d=new Matrix;if(c!==void 0){var u=this._elem.finalTransform.mProp.getValueAtTime(c);u.clone(d)}else{var f=this._elem.finalTransform.mProp;f.applyToMatrix(d)}return d}function e(c,d){var u=this.getMatrix(d);return u.props[12]=0,u.props[13]=0,u.props[14]=0,this.applyPoint(u,c)}function t(c,d){var u=this.getMatrix(d);return this.applyPoint(u,c)}function o(c,d){var u=this.getMatrix(d);return u.props[12]=0,u.props[13]=0,u.props[14]=0,this.invertPoint(u,c)}function i(c,d){var u=this.getMatrix(d);return this.invertPoint(u,c)}function s(c,d){if(this._elem.hierarchy&&this._elem.hierarchy.length){var u,f=this._elem.hierarchy.length;for(u=0;u<f;u+=1)this._elem.hierarchy[u].finalTransform.mProp.applyToMatrix(c)}return c.applyToPointArray(d[0],d[1],d[2]||0)}function r(c,d){if(this._elem.hierarchy&&this._elem.hierarchy.length){var u,f=this._elem.hierarchy.length;for(u=0;u<f;u+=1)this._elem.hierarchy[u].finalTransform.mProp.applyToMatrix(c)}return c.inversePoint(d)}function a(c){var d=new Matrix;if(d.reset(),this._elem.finalTransform.mProp.applyToMatrix(d),this._elem.hierarchy&&this._elem.hierarchy.length){var u,f=this._elem.hierarchy.length;for(u=0;u<f;u+=1)this._elem.hierarchy[u].finalTransform.mProp.applyToMatrix(d);return d.inversePoint(c)}return d.inversePoint(c)}function l(){return[1,1,1,1]}return function(c){var d;function u(p){h.mask=new MaskManagerInterface(p,c)}function f(p){h.effect=p}function h(p){switch(p){case"ADBE Root Vectors Group":case"Contents":case 2:return h.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return d;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return h.effect;case"ADBE Text Properties":return h.textInterface;default:return null}}h.getMatrix=n,h.invertPoint=r,h.applyPoint=s,h.toWorld=t,h.toWorldVec=e,h.fromWorld=i,h.fromWorldVec=o,h.toComp=t,h.fromComp=a,h.sampleImage=l,h.sourceRectAtTime=c.sourceRectAtTime.bind(c),h._elem=c,d=TransformExpressionInterface(c.finalTransform.mProp);var m=getDescriptor(d,"anchorPoint");return Object.defineProperties(h,{hasParent:{get:function(){return c.hierarchy.length}},parent:{get:function(){return c.hierarchy[0].layerInterface}},rotation:getDescriptor(d,"rotation"),scale:getDescriptor(d,"scale"),position:getDescriptor(d,"position"),opacity:getDescriptor(d,"opacity"),anchorPoint:m,anchor_point:m,transform:{get:function(){return d}},active:{get:function(){return c.isInRange}}}),h.startTime=c.data.st,h.index=c.data.ind,h.source=c.data.refId,h.height=c.data.ty===0?c.data.h:100,h.width=c.data.ty===0?c.data.w:100,h.inPoint=c.data.ip/c.comp.globalData.frameRate,h.outPoint=c.data.op/c.comp.globalData.frameRate,h._name=c.data.nm,h.registerMaskInterface=u,h.registerEffectsInterface=f,h}}(),propertyGroupFactory=function(){return function(n,e){return function(t){return t=t===void 0?1:t,t<=0?n:e(t-1)}}}(),PropertyInterface=function(){return function(n,e){var t={_name:n};function o(i){return i=i===void 0?1:i,i<=0?t:e(i-1)}return o}}(),EffectsExpressionInterface=function(){var n={createEffectsInterface:e};function e(i,s){if(i.effectsManager){var r=[],a=i.data.ef,l,c=i.effectsManager.effectElements.length;for(l=0;l<c;l+=1)r.push(t(a[l],i.effectsManager.effectElements[l],s,i));var d=i.data.ef||[],u=function(h){for(l=0,c=d.length;l<c;){if(h===d[l].nm||h===d[l].mn||h===d[l].ix)return r[l];l+=1}return null};return Object.defineProperty(u,"numProperties",{get:function(){return d.length}}),u}return null}function t(i,s,r,a){function l(h){for(var m=i.ef,p=0,v=m.length;p<v;){if(h===m[p].nm||h===m[p].mn||h===m[p].ix)return m[p].ty===5?d[p]:d[p]();p+=1}throw new Error}var c=propertyGroupFactory(l,r),d=[],u,f=i.ef.length;for(u=0;u<f;u+=1)i.ef[u].ty===5?d.push(t(i.ef[u],s.effectElements[u],s.effectElements[u].propertyGroup,a)):d.push(o(s.effectElements[u],i.ef[u].ty,a,c));return i.mn==="ADBE Color Control"&&Object.defineProperty(l,"color",{get:function(){return d[0]()}}),Object.defineProperties(l,{numProperties:{get:function(){return i.np}},_name:{value:i.nm},propertyGroup:{value:c}}),l.enabled=i.en!==0,l.active=l.enabled,l}function o(i,s,r,a){var l=ExpressionPropertyInterface(i.p);function c(){return s===10?r.comp.compInterface(i.p.v):l()}return i.p.setGroupProperty&&i.p.setGroupProperty(PropertyInterface("",a)),c}return n}(),ShapePathInterface=function(){return function(e,t,o){var i=t.sh;function s(a){return a==="Shape"||a==="shape"||a==="Path"||a==="path"||a==="ADBE Vector Shape"||a===2?s.path:null}var r=propertyGroupFactory(s,o);return i.setGroupProperty(PropertyInterface("Path",r)),Object.defineProperties(s,{path:{get:function(){return i.k&&i.getValue(),i}},shape:{get:function(){return i.k&&i.getValue(),i}},_name:{value:e.nm},ix:{value:e.ix},propertyIndex:{value:e.ix},mn:{value:e.mn},propertyGroup:{value:o}}),s}}(),ShapeExpressionInterface=function(){function n(m,p,v){var g=[],y,w=m?m.length:0;for(y=0;y<w;y+=1)m[y].ty==="gr"?g.push(t(m[y],p[y],v)):m[y].ty==="fl"?g.push(o(m[y],p[y],v)):m[y].ty==="st"?g.push(r(m[y],p[y],v)):m[y].ty==="tm"?g.push(a(m[y],p[y],v)):m[y].ty==="tr"||(m[y].ty==="el"?g.push(c(m[y],p[y],v)):m[y].ty==="sr"?g.push(d(m[y],p[y],v)):m[y].ty==="sh"?g.push(ShapePathInterface(m[y],p[y],v)):m[y].ty==="rc"?g.push(u(m[y],p[y],v)):m[y].ty==="rd"?g.push(f(m[y],p[y],v)):m[y].ty==="rp"?g.push(h(m[y],p[y],v)):m[y].ty==="gf"?g.push(i(m[y],p[y],v)):g.push(s(m[y],p[y])));return g}function e(m,p,v){var g,y=function(S){for(var C=0,A=g.length;C<A;){if(g[C]._name===S||g[C].mn===S||g[C].propertyIndex===S||g[C].ix===S||g[C].ind===S)return g[C];C+=1}return typeof S=="number"?g[S-1]:null};y.propertyGroup=propertyGroupFactory(y,v),g=n(m.it,p.it,y.propertyGroup),y.numProperties=g.length;var w=l(m.it[m.it.length-1],p.it[p.it.length-1],y.propertyGroup);return y.transform=w,y.propertyIndex=m.cix,y._name=m.nm,y}function t(m,p,v){var g=function(S){switch(S){case"ADBE Vectors Group":case"Contents":case 2:return g.content;default:return g.transform}};g.propertyGroup=propertyGroupFactory(g,v);var y=e(m,p,g.propertyGroup),w=l(m.it[m.it.length-1],p.it[p.it.length-1],g.propertyGroup);return g.content=y,g.transform=w,Object.defineProperty(g,"_name",{get:function(){return m.nm}}),g.numProperties=m.np,g.propertyIndex=m.ix,g.nm=m.nm,g.mn=m.mn,g}function o(m,p,v){function g(y){return y==="Color"||y==="color"?g.color:y==="Opacity"||y==="opacity"?g.opacity:null}return Object.defineProperties(g,{color:{get:ExpressionPropertyInterface(p.c)},opacity:{get:ExpressionPropertyInterface(p.o)},_name:{value:m.nm},mn:{value:m.mn}}),p.c.setGroupProperty(PropertyInterface("Color",v)),p.o.setGroupProperty(PropertyInterface("Opacity",v)),g}function i(m,p,v){function g(y){return y==="Start Point"||y==="start point"?g.startPoint:y==="End Point"||y==="end point"?g.endPoint:y==="Opacity"||y==="opacity"?g.opacity:null}return Object.defineProperties(g,{startPoint:{get:ExpressionPropertyInterface(p.s)},endPoint:{get:ExpressionPropertyInterface(p.e)},opacity:{get:ExpressionPropertyInterface(p.o)},type:{get:function(){return"a"}},_name:{value:m.nm},mn:{value:m.mn}}),p.s.setGroupProperty(PropertyInterface("Start Point",v)),p.e.setGroupProperty(PropertyInterface("End Point",v)),p.o.setGroupProperty(PropertyInterface("Opacity",v)),g}function s(){function m(){return null}return m}function r(m,p,v){var g=propertyGroupFactory(A,v),y=propertyGroupFactory(C,g);function w(E){Object.defineProperty(C,m.d[E].nm,{get:ExpressionPropertyInterface(p.d.dataProps[E].p)})}var _,S=m.d?m.d.length:0,C={};for(_=0;_<S;_+=1)w(_),p.d.dataProps[_].p.setGroupProperty(y);function A(E){return E==="Color"||E==="color"?A.color:E==="Opacity"||E==="opacity"?A.opacity:E==="Stroke Width"||E==="stroke width"?A.strokeWidth:null}return Object.defineProperties(A,{color:{get:ExpressionPropertyInterface(p.c)},opacity:{get:ExpressionPropertyInterface(p.o)},strokeWidth:{get:ExpressionPropertyInterface(p.w)},dash:{get:function(){return C}},_name:{value:m.nm},mn:{value:m.mn}}),p.c.setGroupProperty(PropertyInterface("Color",g)),p.o.setGroupProperty(PropertyInterface("Opacity",g)),p.w.setGroupProperty(PropertyInterface("Stroke Width",g)),A}function a(m,p,v){function g(w){return w===m.e.ix||w==="End"||w==="end"?g.end:w===m.s.ix?g.start:w===m.o.ix?g.offset:null}var y=propertyGroupFactory(g,v);return g.propertyIndex=m.ix,p.s.setGroupProperty(PropertyInterface("Start",y)),p.e.setGroupProperty(PropertyInterface("End",y)),p.o.setGroupProperty(PropertyInterface("Offset",y)),g.propertyIndex=m.ix,g.propertyGroup=v,Object.defineProperties(g,{start:{get:ExpressionPropertyInterface(p.s)},end:{get:ExpressionPropertyInterface(p.e)},offset:{get:ExpressionPropertyInterface(p.o)},_name:{value:m.nm}}),g.mn=m.mn,g}function l(m,p,v){function g(w){return m.a.ix===w||w==="Anchor Point"?g.anchorPoint:m.o.ix===w||w==="Opacity"?g.opacity:m.p.ix===w||w==="Position"?g.position:m.r.ix===w||w==="Rotation"||w==="ADBE Vector Rotation"?g.rotation:m.s.ix===w||w==="Scale"?g.scale:m.sk&&m.sk.ix===w||w==="Skew"?g.skew:m.sa&&m.sa.ix===w||w==="Skew Axis"?g.skewAxis:null}var y=propertyGroupFactory(g,v);return p.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",y)),p.transform.mProps.p.setGroupProperty(PropertyInterface("Position",y)),p.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",y)),p.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",y)),p.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",y)),p.transform.mProps.sk&&(p.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",y)),p.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",y))),p.transform.op.setGroupProperty(PropertyInterface("Opacity",y)),Object.defineProperties(g,{opacity:{get:ExpressionPropertyInterface(p.transform.mProps.o)},position:{get:ExpressionPropertyInterface(p.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(p.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(p.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(p.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(p.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(p.transform.mProps.sa)},_name:{value:m.nm}}),g.ty="tr",g.mn=m.mn,g.propertyGroup=v,g}function c(m,p,v){function g(_){return m.p.ix===_?g.position:m.s.ix===_?g.size:null}var y=propertyGroupFactory(g,v);g.propertyIndex=m.ix;var w=p.sh.ty==="tm"?p.sh.prop:p.sh;return w.s.setGroupProperty(PropertyInterface("Size",y)),w.p.setGroupProperty(PropertyInterface("Position",y)),Object.defineProperties(g,{size:{get:ExpressionPropertyInterface(w.s)},position:{get:ExpressionPropertyInterface(w.p)},_name:{value:m.nm}}),g.mn=m.mn,g}function d(m,p,v){function g(_){return m.p.ix===_?g.position:m.r.ix===_?g.rotation:m.pt.ix===_?g.points:m.or.ix===_||_==="ADBE Vector Star Outer Radius"?g.outerRadius:m.os.ix===_?g.outerRoundness:m.ir&&(m.ir.ix===_||_==="ADBE Vector Star Inner Radius")?g.innerRadius:m.is&&m.is.ix===_?g.innerRoundness:null}var y=propertyGroupFactory(g,v),w=p.sh.ty==="tm"?p.sh.prop:p.sh;return g.propertyIndex=m.ix,w.or.setGroupProperty(PropertyInterface("Outer Radius",y)),w.os.setGroupProperty(PropertyInterface("Outer Roundness",y)),w.pt.setGroupProperty(PropertyInterface("Points",y)),w.p.setGroupProperty(PropertyInterface("Position",y)),w.r.setGroupProperty(PropertyInterface("Rotation",y)),m.ir&&(w.ir.setGroupProperty(PropertyInterface("Inner Radius",y)),w.is.setGroupProperty(PropertyInterface("Inner Roundness",y))),Object.defineProperties(g,{position:{get:ExpressionPropertyInterface(w.p)},rotation:{get:ExpressionPropertyInterface(w.r)},points:{get:ExpressionPropertyInterface(w.pt)},outerRadius:{get:ExpressionPropertyInterface(w.or)},outerRoundness:{get:ExpressionPropertyInterface(w.os)},innerRadius:{get:ExpressionPropertyInterface(w.ir)},innerRoundness:{get:ExpressionPropertyInterface(w.is)},_name:{value:m.nm}}),g.mn=m.mn,g}function u(m,p,v){function g(_){return m.p.ix===_?g.position:m.r.ix===_?g.roundness:m.s.ix===_||_==="Size"||_==="ADBE Vector Rect Size"?g.size:null}var y=propertyGroupFactory(g,v),w=p.sh.ty==="tm"?p.sh.prop:p.sh;return g.propertyIndex=m.ix,w.p.setGroupProperty(PropertyInterface("Position",y)),w.s.setGroupProperty(PropertyInterface("Size",y)),w.r.setGroupProperty(PropertyInterface("Rotation",y)),Object.defineProperties(g,{position:{get:ExpressionPropertyInterface(w.p)},roundness:{get:ExpressionPropertyInterface(w.r)},size:{get:ExpressionPropertyInterface(w.s)},_name:{value:m.nm}}),g.mn=m.mn,g}function f(m,p,v){function g(_){return m.r.ix===_||_==="Round Corners 1"?g.radius:null}var y=propertyGroupFactory(g,v),w=p;return g.propertyIndex=m.ix,w.rd.setGroupProperty(PropertyInterface("Radius",y)),Object.defineProperties(g,{radius:{get:ExpressionPropertyInterface(w.rd)},_name:{value:m.nm}}),g.mn=m.mn,g}function h(m,p,v){function g(_){return m.c.ix===_||_==="Copies"?g.copies:m.o.ix===_||_==="Offset"?g.offset:null}var y=propertyGroupFactory(g,v),w=p;return g.propertyIndex=m.ix,w.c.setGroupProperty(PropertyInterface("Copies",y)),w.o.setGroupProperty(PropertyInterface("Offset",y)),Object.defineProperties(g,{copies:{get:ExpressionPropertyInterface(w.c)},offset:{get:ExpressionPropertyInterface(w.o)},_name:{value:m.nm}}),g.mn=m.mn,g}return function(m,p,v){var g;function y(_){if(typeof _=="number")return _=_===void 0?1:_,_===0?v:g[_-1];for(var S=0,C=g.length;S<C;){if(g[S]._name===_)return g[S];S+=1}return null}function w(){return v}return y.propertyGroup=propertyGroupFactory(y,w),g=n(m,p,y.propertyGroup),y.numProperties=g.length,y._name="Contents",y}}(),TextExpressionInterface=function(){return function(n){var e;function t(o){switch(o){case"ADBE Text Document":return t.sourceText;default:return null}}return Object.defineProperty(t,"sourceText",{get:function(){n.textProperty.getValue();var i=n.textProperty.currentData.t;return(!e||i!==e.value)&&(e=new String(i),e.value=i||new String(i),Object.defineProperty(e,"style",{get:function(){return{fillColor:n.textProperty.currentData.fc}}})),e}}),t}}();function _typeof(n){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(n)}var FootageInterface=function(){var n=function(o){var i="",s=o.getFootageData();function r(){return i="",s=o.getFootageData(),a}function a(l){if(s[l])return i=l,s=s[l],_typeof(s)==="object"?a:s;var c=l.indexOf(i);if(c!==-1){var d=parseInt(l.substr(c+i.length),10);return s=s[d],_typeof(s)==="object"?a:s}return""}return r},e=function(o){function i(s){return s==="Outline"?i.outlineInterface():null}return i._name="Outline",i.outlineInterface=n(o),i};return function(t){function o(i){return i==="Data"?o.dataInterface:null}return o._name="Data",o.dataInterface=e(t),o}}(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(n){return interfaces[n]||null}var expressionHelpers=function(){function n(r,a,l){a.x&&(l.k=!0,l.x=!0,l.initiateExpression=ExpressionManager.initiateExpression,l.effectsSequence.push(l.initiateExpression(r,a,l).bind(l)))}function e(r){return r*=this.elem.globalData.frameRate,r-=this.offsetTime,r!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<r?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(r,this._cachingAtTime),this._cachingAtTime.lastFrame=r),this._cachingAtTime.value}function t(r){var a=-.01,l=this.getValueAtTime(r),c=this.getValueAtTime(r+a),d=0;if(l.length){var u;for(u=0;u<l.length;u+=1)d+=Math.pow(c[u]-l[u],2);d=Math.sqrt(d)*100}else d=0;return d}function o(r){if(this.vel!==void 0)return this.vel;var a=-.001,l=this.getValueAtTime(r),c=this.getValueAtTime(r+a),d;if(l.length){d=createTypedArray("float32",l.length);var u;for(u=0;u<l.length;u+=1)d[u]=(c[u]-l[u])/a}else d=(c-l)/a;return d}function i(){return this.pv}function s(r){this.propertyGroup=r}return{searchExpressions:n,getSpeedAtTime:t,getVelocityAtTime:o,getValueAtTime:e,getStaticValueAtTime:i,setGroupProperty:s}}();function addPropertyDecorator(){function n(f,h,m){if(!this.k||!this.keyframes)return this.pv;f=f?f.toLowerCase():"";var p=this.comp.renderedFrame,v=this.keyframes,g=v[v.length-1].t;if(p<=g)return this.pv;var y,w;m?(h?y=Math.abs(g-this.elem.comp.globalData.frameRate*h):y=Math.max(0,g-this.elem.data.ip),w=g-y):((!h||h>v.length-1)&&(h=v.length-1),w=v[v.length-1-h].t,y=g-w);var _,S,C;if(f==="pingpong"){var A=Math.floor((p-w)/y);if(A%2!==0)return this.getValueAtTime((y-(p-w)%y+w)/this.comp.globalData.frameRate,0)}else if(f==="offset"){var E=this.getValueAtTime(w/this.comp.globalData.frameRate,0),k=this.getValueAtTime(g/this.comp.globalData.frameRate,0),I=this.getValueAtTime(((p-w)%y+w)/this.comp.globalData.frameRate,0),F=Math.floor((p-w)/y);if(this.pv.length){for(C=new Array(E.length),S=C.length,_=0;_<S;_+=1)C[_]=(k[_]-E[_])*F+I[_];return C}return(k-E)*F+I}else if(f==="continue"){var M=this.getValueAtTime(g/this.comp.globalData.frameRate,0),R=this.getValueAtTime((g-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(C=new Array(M.length),S=C.length,_=0;_<S;_+=1)C[_]=M[_]+(M[_]-R[_])*((p-g)/this.comp.globalData.frameRate)/5e-4;return C}return M+(M-R)*((p-g)/.001)}return this.getValueAtTime(((p-w)%y+w)/this.comp.globalData.frameRate,0)}function e(f,h,m){if(!this.k)return this.pv;f=f?f.toLowerCase():"";var p=this.comp.renderedFrame,v=this.keyframes,g=v[0].t;if(p>=g)return this.pv;var y,w;m?(h?y=Math.abs(this.elem.comp.globalData.frameRate*h):y=Math.max(0,this.elem.data.op-g),w=g+y):((!h||h>v.length-1)&&(h=v.length-1),w=v[h].t,y=w-g);var _,S,C;if(f==="pingpong"){var A=Math.floor((g-p)/y);if(A%2===0)return this.getValueAtTime(((g-p)%y+g)/this.comp.globalData.frameRate,0)}else if(f==="offset"){var E=this.getValueAtTime(g/this.comp.globalData.frameRate,0),k=this.getValueAtTime(w/this.comp.globalData.frameRate,0),I=this.getValueAtTime((y-(g-p)%y+g)/this.comp.globalData.frameRate,0),F=Math.floor((g-p)/y)+1;if(this.pv.length){for(C=new Array(E.length),S=C.length,_=0;_<S;_+=1)C[_]=I[_]-(k[_]-E[_])*F;return C}return I-(k-E)*F}else if(f==="continue"){var M=this.getValueAtTime(g/this.comp.globalData.frameRate,0),R=this.getValueAtTime((g+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(C=new Array(M.length),S=C.length,_=0;_<S;_+=1)C[_]=M[_]+(M[_]-R[_])*(g-p)/.001;return C}return M+(M-R)*(g-p)/.001}return this.getValueAtTime((y-((g-p)%y+g))/this.comp.globalData.frameRate,0)}function t(f,h){if(!this.k)return this.pv;if(f=(f||.4)*.5,h=Math.floor(h||5),h<=1)return this.pv;var m=this.comp.renderedFrame/this.comp.globalData.frameRate,p=m-f,v=m+f,g=h>1?(v-p)/(h-1):1,y=0,w=0,_;this.pv.length?_=createTypedArray("float32",this.pv.length):_=0;for(var S;y<h;){if(S=this.getValueAtTime(p+y*g),this.pv.length)for(w=0;w<this.pv.length;w+=1)_[w]+=S[w];else _+=S;y+=1}if(this.pv.length)for(w=0;w<this.pv.length;w+=1)_[w]/=h;else _/=h;return _}function o(f){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var h=this._transformCachingAtTime.v;if(h.cloneFromProps(this.pre.props),this.appliedTransformations<1){var m=this.a.getValueAtTime(f);h.translate(-m[0]*this.a.mult,-m[1]*this.a.mult,m[2]*this.a.mult)}if(this.appliedTransformations<2){var p=this.s.getValueAtTime(f);h.scale(p[0]*this.s.mult,p[1]*this.s.mult,p[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var v=this.sk.getValueAtTime(f),g=this.sa.getValueAtTime(f);h.skewFromAxis(-v*this.sk.mult,g*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var y=this.r.getValueAtTime(f);h.rotate(-y*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var w=this.rz.getValueAtTime(f),_=this.ry.getValueAtTime(f),S=this.rx.getValueAtTime(f),C=this.or.getValueAtTime(f);h.rotateZ(-w*this.rz.mult).rotateY(_*this.ry.mult).rotateX(S*this.rx.mult).rotateZ(-C[2]*this.or.mult).rotateY(C[1]*this.or.mult).rotateX(C[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var A=this.px.getValueAtTime(f),E=this.py.getValueAtTime(f);if(this.data.p.z){var k=this.pz.getValueAtTime(f);h.translate(A*this.px.mult,E*this.py.mult,-k*this.pz.mult)}else h.translate(A*this.px.mult,E*this.py.mult,0)}else{var I=this.p.getValueAtTime(f);h.translate(I[0]*this.p.mult,I[1]*this.p.mult,-I[2]*this.p.mult)}return h}function i(){return this.v.clone(new Matrix)}var s=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(f,h,m){var p=s(f,h,m);return p.dynamicProperties.length?p.getValueAtTime=o.bind(p):p.getValueAtTime=i.bind(p),p.setGroupProperty=expressionHelpers.setGroupProperty,p};var r=PropertyFactory.getProp;PropertyFactory.getProp=function(f,h,m,p,v){var g=r(f,h,m,p,v);g.kf?g.getValueAtTime=expressionHelpers.getValueAtTime.bind(g):g.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(g),g.setGroupProperty=expressionHelpers.setGroupProperty,g.loopOut=n,g.loopIn=e,g.smooth=t,g.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(g),g.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(g),g.numKeys=h.a===1?h.k.length:0,g.propertyIndex=h.ix;var y=0;return m!==0&&(y=createTypedArray("float32",h.a===1?h.k[0].s.length:h.k.length)),g._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:y},expressionHelpers.searchExpressions(f,h,g),g.k&&v.addDynamicProperty(g),g};function a(f){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),f*=this.elem.globalData.frameRate,f-=this.offsetTime,f!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<f?this._caching.lastIndex:0,this._cachingAtTime.lastTime=f,this.interpolateShape(f,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue}var l=ShapePropertyFactory.getConstructorFunction(),c=ShapePropertyFactory.getKeyframedConstructorFunction();function d(){}d.prototype={vertices:function(h,m){this.k&&this.getValue();var p=this.v;m!==void 0&&(p=this.getValueAtTime(m,0));var v,g=p._length,y=p[h],w=p.v,_=createSizedArray(g);for(v=0;v<g;v+=1)h==="i"||h==="o"?_[v]=[y[v][0]-w[v][0],y[v][1]-w[v][1]]:_[v]=[y[v][0],y[v][1]];return _},points:function(h){return this.vertices("v",h)},inTangents:function(h){return this.vertices("i",h)},outTangents:function(h){return this.vertices("o",h)},isClosed:function(){return this.v.c},pointOnPath:function(h,m){var p=this.v;m!==void 0&&(p=this.getValueAtTime(m,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(p));for(var v=this._segmentsLength,g=v.lengths,y=v.totalLength*h,w=0,_=g.length,S=0,C;w<_;){if(S+g[w].addedLength>y){var A=w,E=p.c&&w===_-1?0:w+1,k=(y-S)/g[w].addedLength;C=bez.getPointInSegment(p.v[A],p.v[E],p.o[A],p.i[E],k,g[w]);break}else S+=g[w].addedLength;w+=1}return C||(C=p.c?[p.v[0][0],p.v[0][1]]:[p.v[p._length-1][0],p.v[p._length-1][1]]),C},vectorOnPath:function(h,m,p){h==1?h=this.v.c:h==0&&(h=.999);var v=this.pointOnPath(h,m),g=this.pointOnPath(h+.001,m),y=g[0]-v[0],w=g[1]-v[1],_=Math.sqrt(Math.pow(y,2)+Math.pow(w,2));if(_===0)return[0,0];var S=p==="tangent"?[y/_,w/_]:[-w/_,y/_];return S},tangentOnPath:function(h,m){return this.vectorOnPath(h,m,"tangent")},normalOnPath:function(h,m){return this.vectorOnPath(h,m,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([d],l),extendPrototype([d],c),c.prototype.getValueAtTime=a,c.prototype.initiateExpression=ExpressionManager.initiateExpression;var u=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(f,h,m,p,v){var g=u(f,h,m,p,v);return g.propertyIndex=h.ix,g.lock=!1,m===3?expressionHelpers.searchExpressions(f,h.pt,g):m===4&&expressionHelpers.searchExpressions(f,h.ks,g),g.k&&f.addDynamicProperty(g),g}}function initialize$1(){addPropertyDecorator()}function addDecorator(){function n(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}TextProperty.prototype.getExpressionValue=function(e,t){var o=this.calculateExpression(t);if(e.t!==o){var i={};return this.copyData(i,e),i.t=o.toString(),i.__complete=!1,i}return e},TextProperty.prototype.searchProperty=function(){var e=this.searchKeyframes(),t=this.searchExpressions();return this.kf=e||t,this.kf},TextProperty.prototype.searchExpressions=n}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function n(e,t){var o=createNS("feMerge");o.setAttribute("result",e);var i,s;for(s=0;s<t.length;s+=1)i=createNS("feMergeNode"),i.setAttribute("in",t[s]),o.appendChild(i),o.appendChild(i);return o}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(n,e,t,o,i){this.filterManager=e;var s=createNS("feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("color-interpolation-filters","linearRGB"),s.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=s,s.setAttribute("result",o+"_tint_1"),n.appendChild(s),s=createNS("feColorMatrix"),s.setAttribute("type","matrix"),s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),s.setAttribute("result",o+"_tint_2"),n.appendChild(s),this.matrixFilter=s;var r=this.createMergeNode(o,[i,o+"_tint_1",o+"_tint_2"]);n.appendChild(r)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(n){if(n||this.filterManager._mdf){var e=this.filterManager.effectElements[0].p.v,t=this.filterManager.effectElements[1].p.v,o=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+o+" 0"),this.matrixFilter.setAttribute("values",t[0]-e[0]+" 0 0 0 "+e[0]+" "+(t[1]-e[1])+" 0 0 0 "+e[1]+" "+(t[2]-e[2])+" 0 0 0 "+e[2]+" 0 0 0 1 0")}};function SVGFillFilter(n,e,t,o){this.filterManager=e;var i=createNS("feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("color-interpolation-filters","sRGB"),i.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),i.setAttribute("result",o),n.appendChild(i),this.matrixFilter=i}SVGFillFilter.prototype.renderFrame=function(n){if(n||this.filterManager._mdf){var e=this.filterManager.effectElements[2].p.v,t=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+e[0]+" 0 0 0 0 "+e[1]+" 0 0 0 0 "+e[2]+" 0 0 0 "+t+" 0")}};function SVGStrokeEffect(n,e,t){this.initialized=!1,this.filterManager=e,this.elem=t,this.paths=[]}SVGStrokeEffect.prototype.initialize=function(){var n=this.elem.layerElement.children||this.elem.layerElement.childNodes,e,t,o,i;for(this.filterManager.effectElements[1].p.v===1?(i=this.elem.maskManager.masksProperties.length,o=0):(o=this.filterManager.effectElements[0].p.v-1,i=o+1),t=createNS("g"),t.setAttribute("fill","none"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-dashoffset",1),o;o<i;o+=1)e=createNS("path"),t.appendChild(e),this.paths.push({p:e,m:o});if(this.filterManager.effectElements[10].p.v===3){var s=createNS("mask"),r=createElementID();s.setAttribute("id",r),s.setAttribute("mask-type","alpha"),s.appendChild(t),this.elem.globalData.defs.appendChild(s);var a=createNS("g");for(a.setAttribute("mask","url("+getLocationHref()+"#"+r+")");n[0];)a.appendChild(n[0]);this.elem.layerElement.appendChild(a),this.masker=s,t.setAttribute("stroke","#fff")}else if(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2){if(this.filterManager.effectElements[10].p.v===2)for(n=this.elem.layerElement.children||this.elem.layerElement.childNodes;n.length;)this.elem.layerElement.removeChild(n[0]);this.elem.layerElement.appendChild(t),this.elem.layerElement.removeAttribute("mask"),t.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=t},SVGStrokeEffect.prototype.renderFrame=function(n){this.initialized||this.initialize();var e,t=this.paths.length,o,i;for(e=0;e<t;e+=1)if(this.paths[e].m!==-1&&(o=this.elem.maskManager.viewData[this.paths[e].m],i=this.paths[e].p,(n||this.filterManager._mdf||o.prop._mdf)&&i.setAttribute("d",o.lastPath),n||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||o.prop._mdf)){var s;if(this.filterManager.effectElements[7].p.v!==0||this.filterManager.effectElements[8].p.v!==100){var r=Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,a=Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,l=i.getTotalLength();s="0 0 0 "+l*r+" ";var c=l*(a-r),d=1+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01,u=Math.floor(c/d),f;for(f=0;f<u;f+=1)s+="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01+" ";s+="0 "+l*10+" 0 0"}else s="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01;i.setAttribute("stroke-dasharray",s)}if((n||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",this.filterManager.effectElements[4].p.v*2),(n||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2)&&(n||this.filterManager.effectElements[3].p._mdf)){var h=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(h[0]*255)+","+bmFloor(h[1]*255)+","+bmFloor(h[2]*255)+")")}};function SVGTritoneFilter(n,e,t,o){this.filterManager=e;var i=createNS("feColorMatrix");i.setAttribute("type","matrix"),i.setAttribute("color-interpolation-filters","linearRGB"),i.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),n.appendChild(i);var s=createNS("feComponentTransfer");s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("result",o),this.matrixFilter=s;var r=createNS("feFuncR");r.setAttribute("type","table"),s.appendChild(r),this.feFuncR=r;var a=createNS("feFuncG");a.setAttribute("type","table"),s.appendChild(a),this.feFuncG=a;var l=createNS("feFuncB");l.setAttribute("type","table"),s.appendChild(l),this.feFuncB=l,n.appendChild(s)}SVGTritoneFilter.prototype.renderFrame=function(n){if(n||this.filterManager._mdf){var e=this.filterManager.effectElements[0].p.v,t=this.filterManager.effectElements[1].p.v,o=this.filterManager.effectElements[2].p.v,i=o[0]+" "+t[0]+" "+e[0],s=o[1]+" "+t[1]+" "+e[1],r=o[2]+" "+t[2]+" "+e[2];this.feFuncR.setAttribute("tableValues",i),this.feFuncG.setAttribute("tableValues",s),this.feFuncB.setAttribute("tableValues",r)}};function SVGProLevelsFilter(n,e,t,o){this.filterManager=e;var i=this.filterManager.effectElements,s=createNS("feComponentTransfer");(i[10].p.k||i[10].p.v!==0||i[11].p.k||i[11].p.v!==1||i[12].p.k||i[12].p.v!==1||i[13].p.k||i[13].p.v!==0||i[14].p.k||i[14].p.v!==1)&&(this.feFuncR=this.createFeFunc("feFuncR",s)),(i[17].p.k||i[17].p.v!==0||i[18].p.k||i[18].p.v!==1||i[19].p.k||i[19].p.v!==1||i[20].p.k||i[20].p.v!==0||i[21].p.k||i[21].p.v!==1)&&(this.feFuncG=this.createFeFunc("feFuncG",s)),(i[24].p.k||i[24].p.v!==0||i[25].p.k||i[25].p.v!==1||i[26].p.k||i[26].p.v!==1||i[27].p.k||i[27].p.v!==0||i[28].p.k||i[28].p.v!==1)&&(this.feFuncB=this.createFeFunc("feFuncB",s)),(i[31].p.k||i[31].p.v!==0||i[32].p.k||i[32].p.v!==1||i[33].p.k||i[33].p.v!==1||i[34].p.k||i[34].p.v!==0||i[35].p.k||i[35].p.v!==1)&&(this.feFuncA=this.createFeFunc("feFuncA",s)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(s.setAttribute("color-interpolation-filters","sRGB"),n.appendChild(s)),(i[3].p.k||i[3].p.v!==0||i[4].p.k||i[4].p.v!==1||i[5].p.k||i[5].p.v!==1||i[6].p.k||i[6].p.v!==0||i[7].p.k||i[7].p.v!==1)&&(s=createNS("feComponentTransfer"),s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("result",o),n.appendChild(s),this.feFuncRComposed=this.createFeFunc("feFuncR",s),this.feFuncGComposed=this.createFeFunc("feFuncG",s),this.feFuncBComposed=this.createFeFunc("feFuncB",s))}SVGProLevelsFilter.prototype.createFeFunc=function(n,e){var t=createNS(n);return t.setAttribute("type","table"),e.appendChild(t),t},SVGProLevelsFilter.prototype.getTableValue=function(n,e,t,o,i){for(var s=0,r=256,a,l=Math.min(n,e),c=Math.max(n,e),d=Array.call(null,{length:r}),u,f=0,h=i-o,m=e-n;s<=256;)a=s/256,a<=l?u=m<0?i:o:a>=c?u=m<0?o:i:u=o+h*Math.pow((a-n)/m,1/t),d[f]=u,f+=1,s+=256/(r-1);return d.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(n){if(n||this.filterManager._mdf){var e,t=this.filterManager.effectElements;this.feFuncRComposed&&(n||t[3].p._mdf||t[4].p._mdf||t[5].p._mdf||t[6].p._mdf||t[7].p._mdf)&&(e=this.getTableValue(t[3].p.v,t[4].p.v,t[5].p.v,t[6].p.v,t[7].p.v),this.feFuncRComposed.setAttribute("tableValues",e),this.feFuncGComposed.setAttribute("tableValues",e),this.feFuncBComposed.setAttribute("tableValues",e)),this.feFuncR&&(n||t[10].p._mdf||t[11].p._mdf||t[12].p._mdf||t[13].p._mdf||t[14].p._mdf)&&(e=this.getTableValue(t[10].p.v,t[11].p.v,t[12].p.v,t[13].p.v,t[14].p.v),this.feFuncR.setAttribute("tableValues",e)),this.feFuncG&&(n||t[17].p._mdf||t[18].p._mdf||t[19].p._mdf||t[20].p._mdf||t[21].p._mdf)&&(e=this.getTableValue(t[17].p.v,t[18].p.v,t[19].p.v,t[20].p.v,t[21].p.v),this.feFuncG.setAttribute("tableValues",e)),this.feFuncB&&(n||t[24].p._mdf||t[25].p._mdf||t[26].p._mdf||t[27].p._mdf||t[28].p._mdf)&&(e=this.getTableValue(t[24].p.v,t[25].p.v,t[26].p.v,t[27].p.v,t[28].p.v),this.feFuncB.setAttribute("tableValues",e)),this.feFuncA&&(n||t[31].p._mdf||t[32].p._mdf||t[33].p._mdf||t[34].p._mdf||t[35].p._mdf)&&(e=this.getTableValue(t[31].p.v,t[32].p.v,t[33].p.v,t[34].p.v,t[35].p.v),this.feFuncA.setAttribute("tableValues",e))}};function SVGDropShadowEffect(n,e,t,o,i){var s=e.container.globalData.renderConfig.filterSize,r=e.data.fs||s;n.setAttribute("x",r.x||s.x),n.setAttribute("y",r.y||s.y),n.setAttribute("width",r.width||s.width),n.setAttribute("height",r.height||s.height),this.filterManager=e;var a=createNS("feGaussianBlur");a.setAttribute("in","SourceAlpha"),a.setAttribute("result",o+"_drop_shadow_1"),a.setAttribute("stdDeviation","0"),this.feGaussianBlur=a,n.appendChild(a);var l=createNS("feOffset");l.setAttribute("dx","25"),l.setAttribute("dy","0"),l.setAttribute("in",o+"_drop_shadow_1"),l.setAttribute("result",o+"_drop_shadow_2"),this.feOffset=l,n.appendChild(l);var c=createNS("feFlood");c.setAttribute("flood-color","#00ff00"),c.setAttribute("flood-opacity","1"),c.setAttribute("result",o+"_drop_shadow_3"),this.feFlood=c,n.appendChild(c);var d=createNS("feComposite");d.setAttribute("in",o+"_drop_shadow_3"),d.setAttribute("in2",o+"_drop_shadow_2"),d.setAttribute("operator","in"),d.setAttribute("result",o+"_drop_shadow_4"),n.appendChild(d);var u=this.createMergeNode(o,[o+"_drop_shadow_4",i]);n.appendChild(u)}extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(n){if(n||this.filterManager._mdf){if((n||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),n||this.filterManager.effectElements[0].p._mdf){var e=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(e[0]*255),Math.round(e[1]*255),Math.round(e[2]*255)))}if((n||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),n||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var t=this.filterManager.effectElements[3].p.v,o=(this.filterManager.effectElements[2].p.v-90)*degToRads,i=t*Math.cos(o),s=t*Math.sin(o);this.feOffset.setAttribute("dx",i),this.feOffset.setAttribute("dy",s)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(n,e,t){this.initialized=!1,this.filterManager=e,this.filterElem=n,this.elem=t,t.matteElement=createNS("g"),t.matteElement.appendChild(t.layerElement),t.matteElement.appendChild(t.transformedElement),t.baseElement=t.matteElement}SVGMatte3Effect.prototype.findSymbol=function(n){for(var e=0,t=_svgMatteSymbols.length;e<t;){if(_svgMatteSymbols[e]===n)return _svgMatteSymbols[e];e+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(n,e){var t=n.layerElement.parentNode;if(t){for(var o=t.children,i=0,s=o.length;i<s&&o[i]!==n.layerElement;)i+=1;var r;i<=s-2&&(r=o[i+1]);var a=createNS("use");a.setAttribute("href","#"+e),r?t.insertBefore(a,r):t.appendChild(a)}},SVGMatte3Effect.prototype.setElementAsMask=function(n,e){if(!this.findSymbol(e)){var t=createElementID(),o=createNS("mask");o.setAttribute("id",e.layerId),o.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(e);var i=n.globalData.defs;i.appendChild(o);var s=createNS("symbol");s.setAttribute("id",t),this.replaceInParent(e,t),s.appendChild(e.layerElement),i.appendChild(s);var r=createNS("use");r.setAttribute("href","#"+t),o.appendChild(r),e.data.hd=!1,e.show()}n.setMatte(e.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var n=this.filterManager.effectElements[0].p.v,e=this.elem.comp.elements,t=0,o=e.length;t<o;)e[t]&&e[t].data.ind===n&&this.setElementAsMask(this.elem,e[t]),t+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()};function SVGGaussianBlurEffect(n,e,t,o){n.setAttribute("x","-100%"),n.setAttribute("y","-100%"),n.setAttribute("width","300%"),n.setAttribute("height","300%"),this.filterManager=e;var i=createNS("feGaussianBlur");i.setAttribute("result",o),n.appendChild(i),this.feGaussianBlur=i}SVGGaussianBlurEffect.prototype.renderFrame=function(n){if(n||this.filterManager._mdf){var e=.3,t=this.filterManager.effectElements[0].p.v*e,o=this.filterManager.effectElements[1].p.v,i=o==3?0:t,s=o==2?0:t;this.feGaussianBlur.setAttribute("stdDeviation",i+" "+s);var r=this.filterManager.effectElements[2].p.v==1?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",r)}};function TransformEffect(){}TransformEffect.prototype.init=function(n){this.effectsManager=n,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(n){if(this._opMdf=!1,this._mdf=!1,n||this.effectsManager._mdf){var e=this.effectsManager.effectElements,t=e[0].p.v,o=e[1].p.v,i=e[2].p.v===1,s=e[3].p.v,r=i?s:e[4].p.v,a=e[5].p.v,l=e[6].p.v,c=e[7].p.v;this.matrix.reset(),this.matrix.translate(-t[0],-t[1],t[2]),this.matrix.scale(r*.01,s*.01,1),this.matrix.rotate(-c*degToRads),this.matrix.skewFromAxis(-a*degToRads,(l+90)*degToRads),this.matrix.translate(o[0],o[1],0),this._mdf=!0,this.opacity!==e[8].p.v&&(this.opacity=e[8].p.v,this._opMdf=!0)}};function SVGTransformEffect(n,e){this.init(e)}extendPrototype([TransformEffect],SVGTransformEffect);function CVTransformEffect(n){this.init(n)}return extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie})}(lottie$1,lottie$1.exports)),lottie$1.exports}var lottieExports=requireLottie();const lottieWeb=getDefaultExportFromCjs(lottieExports);let botContainer=null,bubbleContainer=null,styleInjected=!1,currentObjectiveNumber$1=null,objectiveAudio=null;function injectBotStyles(){if(styleInjected)return;const n=document.createElement("style");n.textContent=`
    #bot-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 2000;
      display: flex;
      align-items: flex-end;
      gap: 12px;
      pointer-events: none;
      flex-direction: row-reverse; 
    }

    #bot-lottie {
      width: 90px;
      height: 90px;
      flex-shrink: 0;
    }

    #bubble-container {
      max-width: 320px;
      background: #fff;
      color: #000;
      border: 0.1px solid #ffffff;
      border-radius: 10px;
      padding: 14px 18px;
      font-family: 'Orbitron', 'Arial', sans-serif;
      font-size: 16px;
      line-height: 1.4;
      box-shadow: 0 4px 16px rgba(255, 255, 255, 0.12);
      opacity: 0;
      transform: translateY(20px);
      animation: bubble-in 0.6s cubic-bezier(.6,1.5,.5,1) forwards;
      position: relative;
      pointer-events: auto;
    }

    /* Tail pointing from robot (right) to bubble (left) */
    #bubble-container::after {
      content: "";
      position: absolute;
      top: 50%;
      right: -12px;
      width: 0;
      height: 0;
      border-top: 10px solid transparent;
      border-bottom: 10px solid transparent;
      border-left: 12px solid #fff;
      filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.2));
      transform: translateY(-50%);
    }

    @keyframes bubble-in {
      0% { opacity: 0; transform: translateY(20px) scale(0.9); }
      80% { opacity: 1; transform: translateY(-4px) scale(1.02); }
      100% { opacity: 1; transform: translateY(0) scale(1); }
    }

    .bubble-main {
      font-weight: 700;
      margin-bottom: 6px;
      color: #0078ff;
    }

    .bubble-sub {
      font-weight: 400;
      opacity: 0.9;
    }
  `,document.head.appendChild(n),styleInjected=!0}function initBot(n="/animations/robot.json"){if(injectBotStyles(),!botContainer){botContainer=document.createElement("div"),botContainer.id="bot-container";const e=document.createElement("div");e.id="bot-lottie",botContainer.appendChild(e),document.body.appendChild(botContainer),lottieWeb.loadAnimation({container:e,renderer:"svg",loop:!0,autoplay:!0,path:n})}}function showObjective(n,e,t="/animations/robot.json"){initBot(t);const o=e[n]||{main:"Objective",sub:""},i=currentObjectiveNumber$1;if(currentObjectiveNumber$1=n,i!==currentObjectiveNumber$1)try{objectiveAudio||(objectiveAudio=new Audio("/audios/objectives.mp3"),objectiveAudio.preload="auto"),objectiveAudio.pause(),objectiveAudio.currentTime=0,objectiveAudio.loop=!1,Promise.resolve(objectiveAudio.play()).catch(()=>{})}catch{}bubbleContainer&&bubbleContainer.remove(),bubbleContainer=document.createElement("div"),bubbleContainer.id="bubble-container",bubbleContainer.innerHTML=`
    <div class="bubble-main">${o.main}</div>
    ${o.sub?`<div class="bubble-sub">${o.sub}</div>`:""}
  `,botContainer.appendChild(bubbleContainer)}function hideObjective(){bubbleContainer&&(bubbleContainer.style.opacity="0",bubbleContainer.style.transform="translateY(20px)",setTimeout(()=>{bubbleContainer&&bubbleContainer.parentNode&&(bubbleContainer.parentNode.removeChild(bubbleContainer),bubbleContainer=null,currentObjectiveNumber$1=null)},400))}function cleanupObjectives(){botContainer&&botContainer.parentNode&&(botContainer.parentNode.removeChild(botContainer),botContainer=null,bubbleContainer=null,currentObjectiveNumber$1=null)}const ObjectiveUI=Object.freeze(Object.defineProperty({__proto__:null,cleanupObjectives,hideObjective,showObjective},Symbol.toStringTag,{value:"Module"})),objectives$3={1:{main:"Get into the bluezone",sub:"Reach the trigger area to meet Electro."},2:{main:"Get the Hoverboard",sub:"Electro will guide you to the hoverboard."},3:{main:"Press E to get into the hoverboard",sub:"Use the E key to mount the hoverboard."},4:{main:"Reach the university entrance",sub:"Use the hoverboard"}},audioInstances=new Map,DEFAULT_RADIUS=10;let currentCamera$4=null,currentScene$4=null;const initializeAudioManager=(n,e)=>{currentCamera$4=n,currentScene$4=e},cleanupAudioManager=()=>{audioInstances.forEach((n,e)=>{n instanceof PositionalAudio?(n.stop(),currentScene$4&&currentScene$4.remove(n),currentCamera$4&&n.listener&&currentCamera$4.remove(n.listener)):n instanceof HTMLAudioElement&&(n.pause(),n.currentTime=0,n.src="")}),audioInstances.clear(),currentCamera$4=null,currentScene$4=null,Object.keys(allAssets$4.audios).forEach(n=>{const e=allAssets$4.audios[n];(e instanceof Audio$1||e instanceof PositionalAudio)&&(e.stop(),e.listener&&currentCamera$4&&currentCamera$4.remove(e.listener))})},playAudio=(n,e=null,t=null)=>{if(!currentCamera$4||!currentScene$4)return console.warn("Audio manager not initialized. Call initializeAudioManager first."),null;console.log("Attempting to play audio:",n);const o=allAssets$4.audios[n];if(!o)return console.warn(`Audio "${n}" not found in assets`),null;if(o.isObject3D)if(e){if(o instanceof PositionalAudio)return o.position.copy(e),t&&o.setRefDistance(t),o.onEnded=()=>{console.log(`Audio ${n} completed`),window.dispatchEvent(new CustomEvent(`audioComplete-${n}`))},o.play(),o;{const s=new AudioListener;currentCamera$4.add(s);const r=new PositionalAudio(s);return r.setBuffer(o.buffer),r.setVolume(o.volume||1),r.setLoop(o.loop||!1),r.position.copy(e),r.setRefDistance(t||DEFAULT_RADIUS),currentScene$4.add(r),audioInstances.set(n,r),r.onEnded=()=>{console.log(`Audio ${n} completed`),window.dispatchEvent(new CustomEvent(`audioComplete-${n}`))},r.play(),r}}else return o.setVolume(o.volume||1),o.setLoop(o.loop||!1),o.onEnded=()=>{console.log(`Audio ${n} completed`),window.dispatchEvent(new CustomEvent(`audioComplete-${n}`))},o.play(),o;if(!audioInstances.has(n)){const s=new Audio(o.path);s.volume=o.volume||1,s.loop=o.loop||!1,s.addEventListener("ended",()=>{console.log(`Audio ${n} completed`),window.dispatchEvent(new CustomEvent(`audioComplete-${n}`))}),audioInstances.set(n,s)}const i=audioInstances.get(n);return i.play().catch(s=>{console.warn(`Failed to play audio "${n}":`,s)}),i},stopAudio=n=>{const e=allAssets$4.audios[n];if(e&&e.isObject3D){e.stop();return}const t=audioInstances.get(n);t&&(t.pause(),t.currentTime=0)},pauseAudio=n=>{const e=allAssets$4.audios[n];if(e&&e.isObject3D){e.pause();return}const t=audioInstances.get(n);t&&t.pause()};let hoverboard=null,hoverboardCollisionMesh=null,isPlayerOnHoverboard=!1,allowManualDetachment=!0,isHoverboardEKeyEnabled=!1;const hoverboardRotationSpeed=2.5;let hoverboardCameraOffset=new Vector3$1(4,2,0),hoverboardCameraTargetOffset=new Vector3$1(0,2,0),isHoverboardCameraActive=!1,hoverboardVelocity=new Vector3$1,hoverboardAcceleration=10,hoverboardDeceleration=5,hoverboardMaxSpeed=40,hoverboardBoostMaxSpeed=60,hoverboardBoostAcceleration=20,isMovingForward=!1,isMovingBackward=!1,isTurningLeft=!1,isTurningRight=!1,isMovingUp=!1,isMovingDown=!1,isBoosting=!1;const hoverboardVerticalSpeed=6;let player$2=null,sceneRef$1=null,hoverboardMountPoint=null,resolution=new Vector2$1(window.innerWidth,window.innerHeight),targetVelocity=new Vector3$1,hoverboardAttachOffset=new Vector3$1(0,1.35,0);const maxRoll=Math.PI/12,maxPitch=Math.PI/18;let currentRoll=0,currentPitch=0,prevBob=0;const bobAmplitude=.1,bobFrequency=.5;let hoverboardTrails=[],trailEmitters=[];const TRAIL_SEGMENTS=48,TRAIL_MIN_SPEED=.5,TRAIL_WIDTH=.25,TRAIL_FADE=1.2,TRAIL_COLOR=new Color(1,.8,.3),TRAIL_CORE_COLOR=new Color(1,1,.9);let boostGlowMeshes=[];const BOOST_GLOW_COLOR=new Color(.2,.4,1),BOOST_GLOW_SIZE=.6;let hoverboardSound=null;const MIN_VOLUME=.3,MAX_VOLUME=.8,VOLUME_RAMP_SPEED=2,FADE_OUT_THRESHOLD=.5,FADE_OUT_SPEED=5,PROPELLER_CONFIG={scale:[.15,.15,.15],positions:[[.8,.05,0],[-.8,.05,0]],rotation:[Math.PI/2,0,0]},propellerVertexShader=`
  varying vec2 vUv;
  void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,propellerFragmentShader=`
  uniform float time;
  varying vec2 vUv;
  
  void main() {
    vec2 center = vec2(0.5, 0.5);
    float dist = length(vUv - center);
    float angle = atan(vUv.y - 0.5, vUv.x - 0.5);
    float blades = sin(angle * 3.0 + time * 10.0) * 0.5 + 0.5;
    float circle = smoothstep(0.5, 0.45, dist);
    float alpha = circle * blades;
    float glow = smoothstep(0.5, 0.2, dist) * 0.5;
    vec3 color = vec3(0.9, 0.9, 1.0);
    gl_FragColor = vec4(color, alpha + glow);
  }
`,propellerGeometry=new CircleGeometry(1,32),propellerMaterial=new ShaderMaterial({vertexShader:propellerVertexShader,fragmentShader:propellerFragmentShader,uniforms:{time:{value:0}},transparent:!0,side:DoubleSide,depthWrite:!1});function createHoverTrail(n){const e=TRAIL_SEGMENTS,t=new Array(e).fill(null).map(()=>new Vector3$1),o=new Float32Array(e).fill(1),i=e*2,s=new Float32Array(i*3),r=new Float32Array(i*3),a=new Float32Array(i*3),l=new Float32Array(i),c=new Float32Array(i);for(let m=0;m<e;m++)l[m*2+0]=-1,l[m*2+1]=1;const d=new BufferGeometry;d.setAttribute("position",new BufferAttribute(s,3)),d.setAttribute("aPrev",new BufferAttribute(r,3)),d.setAttribute("aNext",new BufferAttribute(a,3)),d.setAttribute("aSide",new BufferAttribute(l,1)),d.setAttribute("aAge",new BufferAttribute(c,1));const u=[];for(let m=0;m<e-1;m++){const p=m*2,v=m*2+1,g=(m+1)*2,y=(m+1)*2+1;u.push(p,g,v),u.push(v,g,y)}d.setIndex(u);const f=new ShaderMaterial({transparent:!0,depthWrite:!1,blending:AdditiveBlending,uniforms:{uColor:{value:new Color(TRAIL_COLOR.r,TRAIL_COLOR.g,TRAIL_COLOR.b)},uCoreColor:{value:new Color(TRAIL_CORE_COLOR.r,TRAIL_CORE_COLOR.g,TRAIL_CORE_COLOR.b)},uFade:{value:TRAIL_FADE},uWidth:{value:TRAIL_WIDTH},uMinAlpha:{value:.05},uTime:{value:0}},vertexShader:`
      uniform float uWidth;
      uniform float uTime;
      attribute vec3 aPrev;
      attribute vec3 aNext;
      attribute float aSide;
      attribute float aAge;
      varying float vAge;
      varying float vSide;
      varying float vDistanceFromCenter;
      void main(){
        vec3 P = position;
        vec3 Pprev = aPrev;
        vec3 Pnext = aNext;
        vec3 T = normalize(Pnext - Pprev);
        if (length(T) < 1e-5) T = vec3(0.0, 0.0, 1.0);
        vec3 N = normalize(cross(vec3(0.0, 1.0, 0.0), T));
        if (length(N) < 1e-5) N = normalize(cross(vec3(1.0, 0.0, 0.0), T));
        
        float turbulence = 0.01 * sin(uTime * 3.0 + aAge * 8.0) * (1.0 - aAge);
        vec3 turbulenceOffset = N * turbulence;
        
        float distanceFromCenter = abs(aSide);
        vDistanceFromCenter = distanceFromCenter;
        
        float widthVariation = uWidth * (1.0 - aAge * 0.2) * (1.0 + 0.1 * sin(uTime * 2.0 + aAge * 6.0));
        vec3 offset = N * aSide * widthVariation + turbulenceOffset;
        
        vec3 finalPos = P + offset;
        vAge = aAge;
        vSide = aSide;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(finalPos, 1.0);
      }
    `,fragmentShader:`
      uniform vec3 uColor;
      uniform vec3 uCoreColor;
      uniform float uFade;
      uniform float uMinAlpha;
      uniform float uTime;
      varying float vAge;
      varying float vSide;
      varying float vDistanceFromCenter;
      void main() {
        float alpha = max(uMinAlpha, exp(-uFade * vAge));
        float pulse = 1.0 + 0.2 * sin(uTime * 4.0 + vAge * 10.0);
        alpha *= pulse;
        float edgeFade = smoothstep(0.0, 0.1, vAge) * (1.0 - smoothstep(0.8, 1.0, vAge));
        alpha *= edgeFade;
        float glowStart = smoothstep(0.2, 0.0, vAge);
        float glowIntensity = 0.7 + 0.7 * glowStart;
        vec3 coreColor = uCoreColor * glowIntensity * (1.0 + 0.5 * sin(uTime * 3.0 + vAge * 8.0));
        vec3 edgeColor = uColor * glowIntensity * (2.0 + 0.8 * sin(uTime * 2.0 + vAge * 6.0));
        vec3 finalColor = mix(coreColor, edgeColor, smoothstep(0.1, 1.0, vDistanceFromCenter));
        float sparkle = sin(uTime * 6.0 + vAge * 15.0 + vSide * 10.0) * 0.1 + 0.9;
        finalColor *= sparkle;
        alpha *= (0.5 + edgeFade * 1.5);
        gl_FragColor = vec4(finalColor, alpha);
      }
    `}),h=new Mesh(d,f);return h.frustumCulled=!1,n.add(h),{mesh:h,geometry:d,material:f,points:t,ages:o}}function rebuildTrailGeometry(n){const{geometry:e,points:t,ages:o}=n,i=t.length,s=e.getAttribute("position"),r=e.getAttribute("aPrev"),a=e.getAttribute("aNext"),l=e.getAttribute("aAge");for(let c=0;c<i;c++){const d=t[c],u=t[Math.max(0,c-1)],f=t[Math.min(i-1,c+1)],h=o[c],m=c*2;s.setXYZ(m+0,d.x,d.y,d.z),s.setXYZ(m+1,d.x,d.y,d.z),r.setXYZ(m+0,u.x,u.y,u.z),r.setXYZ(m+1,u.x,u.y,u.z),a.setXYZ(m+0,f.x,f.y,f.z),a.setXYZ(m+1,f.x,f.y,f.z),l.setX(m+0,h),l.setX(m+1,h)}s.needsUpdate=!0,r.needsUpdate=!0,a.needsUpdate=!0,l.needsUpdate=!0}function updateHoverTrail(n,e,t,o){const{points:i,ages:s}=n;for(let r=0;r<s.length;r++)s[r]=Math.min(1,s[r]+o*.6);if(t){for(let r=i.length-1;r>0;r--)i[r].copy(i[r-1]),s[r]=s[r-1];i[0].copy(e),s[0]=0}else i[0]&&i[0].lerp(e,.2);rebuildTrailGeometry(n)}function initializeHoverboard(n,e,t,o=!0){if(player$2=t,sceneRef$1=n,allowManualDetachment=o,!e.models.gltf.hoverboard){console.warn("Hoverboard model not found");return}e.audios.hoverboard&&(hoverboardSound=e.audios.hoverboard,hoverboardSound.setLoop(!0),hoverboardSound.setVolume(MIN_VOLUME)),hoverboard=e.models.gltf.hoverboard.clone(),hoverboard.position.set(0,0,0),hoverboard.rotation.order="YXZ",hoverboard.rotation.y=Math.PI/2,hoverboard.visible=!1,n.add(hoverboard),PROPELLER_CONFIG.positions.forEach(u=>{const f=new PlaneGeometry(.8,.8),h={time:{value:0},resolution:{value:resolution.clone()},zoom:{value:1}},m=new ShaderMaterial({vertexShader:`
        varying vec2 vUv;
        void main() { vUv=uv; gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0); }
      `,fragmentShader:`
        #ifdef GL_ES
        precision highp float;
        #endif
        uniform float time;
        uniform vec2 resolution;
        uniform float zoom;
        varying vec2 vUv;
        #define PI 3.1415926535
        mat2 rotate3d(float angle) {
          return mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
        }
        void main() {
          vec2 p=(vUv*2.0-1.0)*zoom;
          p=rotate3d(time*2.0*PI)*p;
          float t=0.075/abs(0.4-length(p));
          vec3 color=1.0-exp(-vec3(t)*vec3(0.13*(sin(time)+12.0),abs(p.y)*0.7,3.0));
          float alpha=smoothstep(0.0,1.0,length(color)*0.5);
          gl_FragColor=vec4(color,alpha);
        }
      `,uniforms:h,side:DoubleSide,transparent:!0,blending:CustomBlending,blendEquation:AddEquation,blendSrc:SrcAlphaFactor,blendDst:OneFactor,depthWrite:!1,depthTest:!0}),p=new Mesh(f,m);p.position.set(...u),p.position.y=.08,p.rotation.set(...PROPELLER_CONFIG.rotation),hoverboard.add(p)}),PROPELLER_CONFIG.positions.forEach(u=>{const f=new Mesh(propellerGeometry,propellerMaterial.clone());f.scale.set(...PROPELLER_CONFIG.scale),f.position.set(...u),f.rotation.set(...PROPELLER_CONFIG.rotation),hoverboard.add(f)}),hoverboardMountPoint=new Object3D,hoverboardMountPoint.position.set(0,1.35,0),hoverboard.add(hoverboardMountPoint),trailEmitters=[];const i=new Object3D;i.position.set(.8,.05,0),hoverboard.add(i),trailEmitters.push(i),hoverboardTrails=[createHoverTrail(n)],hoverboardTrails.forEach(u=>u.mesh.visible=!1),boostGlowMeshes=[],trailEmitters.forEach(u=>{const f=new CircleGeometry(BOOST_GLOW_SIZE,32),h=new ShaderMaterial({vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:`
        uniform float time;
        uniform vec3 color;
        uniform float intensity;
        varying vec2 vUv;
        
        void main() {
          vec2 center = vec2(0.5, 0.5);
          float dist = length(vUv - center);
          float pulse = 0.5 + 0.5 * sin(time * 5.0);
          float glow = smoothstep(0.5, 0.0, dist) * intensity;
          float outerGlow = smoothstep(0.8, 0.4, dist) * 0.5 * intensity;
          vec3 finalColor = mix(color, vec3(0.7, 0.8, 1.0), outerGlow);
          float alpha = glow * (0.7 + 0.3 * pulse);
          gl_FragColor = vec4(finalColor, alpha);
        }
      `,uniforms:{time:{value:0},color:{value:BOOST_GLOW_COLOR},intensity:{value:0}},transparent:!0,blending:AdditiveBlending,depthWrite:!1,side:DoubleSide}),m=new Mesh(f,h);m.position.copy(u.position),m.rotation.set(-Math.PI/2,0,0),m.visible=!1,hoverboard.add(m),boostGlowMeshes.push(m)});function s(){hoverboard&&hoverboard.traverse(u=>{u.material&&(u.material.uniforms&&u.material.uniforms.time&&(u.material.uniforms.time.value=performance.now()/1e3),u.material.uniforms&&u.material.uniforms.resolution&&u.material.uniforms.resolution.value.copy(resolution))}),requestAnimationFrame(s)}s(),window.addEventListener("resize",()=>resolution.set(window.innerWidth,window.innerHeight));const a=new Box3().setFromObject(hoverboard).getSize(new Vector3$1),l=a.x,c=Math.max(a.y,a.z)*.45,d=new CapsuleGeometry(c,Math.max(.01,l-2*c),8,16);hoverboardCollisionMesh=new Mesh(d,new MeshBasicMaterial({color:65280,wireframe:!0,opacity:1,transparent:!0,visible:!1})),hoverboardCollisionMesh.name="hoverboardCollision",hoverboardCollisionMesh.capsuleInfo={radius:c,segment:new Line3(new Vector3$1(-l/2,0,0),new Vector3$1(l/2,0,0))},hoverboardCollisionMesh.position.copy(hoverboard.position),hoverboardCollisionMesh.rotation.copy(hoverboard.rotation),n.add(hoverboardCollisionMesh),window.addEventListener("keydown",handleHoverboardKeys),window.addEventListener("keyup",handleHoverboardKeyUp),window.addEventListener("resize",()=>{resolution.set(window.innerWidth,window.innerHeight)})}function handleHoverboardKeys(n){if(!hoverboard||!hoverboardCollisionMesh)return;const e=n.type==="keydown",t=n.key.toLowerCase();if(t==="e"&&isHoverboardEKeyEnabled){e&&(hoverboard.visible?isPlayerOnHoverboard&&allowManualDetachment&&(detachPlayerFromHoverboard(),hoverboard.visible=!1):(hoverboard.position.copy(player$2.position.clone().add(new Vector3$1(-1.2,-.8,0))),hoverboard.visible=!0,hoverboardCollisionMesh.position.copy(hoverboard.position),attachPlayerToHoverboard()));return}if(isPlayerOnHoverboard)switch(t){case"arrowup":isMovingForward=e;break;case"arrowdown":isMovingBackward=e;break;case"arrowleft":isTurningLeft=e;break;case"arrowright":isTurningRight=e;break;case"w":isMovingUp=e;break;case"s":isMovingDown=e;break;case"shift":isBoosting=e,e&&(isMovingForward||isMovingBackward)&&hoverspeed&&switchAction&&(hoveraction&&hoveraction.isRunning()&&hoveraction.stop(),switchAction(hoverspeed),hoverspeed.setLoop(LoopOnce),hoverspeed.clampWhenFinished=!0,hoverspeed.reset().play());break}}function handleHoverboardKeyUp(n){switch(n.key.toLowerCase()){case"arrowup":isMovingForward=!1,!isMovingBackward&&isBoosting&&hoverspeed&&hoveraction&&switchAction&&(hoverspeed.isRunning()&&hoverspeed.stop(),switchAction(hoveraction),hoveraction.setLoop(LoopRepeat),hoveraction.reset().fadeIn(.3).play());break;case"arrowdown":isMovingBackward=!1,!isMovingForward&&isBoosting&&hoverspeed&&hoveraction&&switchAction&&(hoverspeed.isRunning()&&hoverspeed.stop(),switchAction(hoveraction),hoveraction.setLoop(LoopRepeat),hoveraction.reset().fadeIn(.3).play());break;case"arrowleft":isTurningLeft=!1;break;case"arrowright":isTurningRight=!1;break;case"w":isMovingUp=!1;break;case"s":isMovingDown=!1;break;case"shift":isBoosting=!1,isPlayerOnHoverboard&&hoveraction&&hoverspeed&&switchAction&&(isMovingForward||isMovingBackward)&&(hoverspeed.isRunning()&&hoverspeed.stop(),switchAction(hoveraction),hoveraction.setLoop(LoopRepeat),hoveraction.reset().fadeIn(.3).play());break}}function attachPlayerToHoverboard(){if(!hoverboard||!player$2)return;togglePlayerControls(!1),togglePlayerPhysics(!1),hoveraction&&switchAction&&(switchAction(hoveraction),hoveraction.setLoop(LoopRepeat),hoveraction.reset().play()),player$2.quaternion.clone();const n=hoverboardAttachOffset.clone();hoverboard.localToWorld(n),player$2.parent!==sceneRef$1&&sceneRef$1&&sceneRef$1.add(player$2),player$2.position.copy(n);const e=new Quaternion$1().setFromAxisAngle(new Vector3$1(0,1,0),Math.PI/2),t=hoverboard.quaternion.clone().multiply(e);if(player$2.quaternion.copy(t),isHoverboardCameraActive=!0,hoverboardSound){hoverboardSound.setVolume(0),hoverboardSound.play();let o=0;const i=.5,s=setInterval(()=>{o+=.016;const r=Math.min(o/i,1);hoverboardSound.setVolume(MIN_VOLUME*r),r>=1&&clearInterval(s)},16)}isPlayerOnHoverboard=!0,window.isPlayerOnHoverboard=!0;try{window.dispatchEvent(new CustomEvent("hoverboard:mounted"))}catch{}}function detachPlayerFromHoverboard(){if(!(!hoverboard||!player$2)){if(playerState.fwdPressed=!1,playerState.bkdPressed=!1,playerState.lftPressed=!1,playerState.rgtPressed=!1,playerState.shiftPressed=!1,playerState.velocity.set(0,0,0),togglePlayerControls(!0),setTimeout(()=>{togglePlayerPhysics(!0)},50),isHoverboardCameraActive=!1,hoverboardSound&&hoverboardSound.isPlaying){const e=hoverboardSound.getVolume();let t=0;const o=setInterval(()=>{t+=.016;const i=Math.min(t/.3,1);hoverboardSound.setVolume(e*(1-i)),i>=1&&(hoverboardSound.stop(),hoverboardSound.setVolume(MIN_VOLUME),hoverboardSound.setPlaybackRate&&hoverboardSound.setPlaybackRate(1),clearInterval(o))},16)}if(hoverboard.visible=!1,hoverboardCollisionMesh&&(hoverboardCollisionMesh.visible=!1),hoverboardTrails&&hoverboardTrails.forEach(n=>{n&&n.mesh&&(n.mesh.visible=!1)}),sceneRef$1&&player$2.parent===hoverboardMountPoint){const n=new Vector3$1,e=new Quaternion$1;player$2.getWorldPosition(n),player$2.getWorldQuaternion(e),sceneRef$1.add(player$2),player$2.position.copy(n),player$2.quaternion.copy(e)}isPlayerOnHoverboard=!1,window.isPlayerOnHoverboard=!1;try{window.dispatchEvent(new CustomEvent("hoverboard:dismounted"))}catch{}}}const MAX_HOVERBOARD_SUBSTEP=1/120;function updateHoverboardMovement(n,e){if(!hoverboard||!hoverboardCollisionMesh||!isPlayerOnHoverboard)return;const t=hoverboardVelocity.length();if(selectedPlayerMixer&&selectedPlayerMixer.update(n),boostGlowMeshes&&boostGlowMeshes.length>0){const c=performance.now()/1e3,d=isBoosting&&(isMovingForward||isMovingBackward)&&t>5;boostGlowMeshes.forEach((u,f)=>{if(u&&u.material&&u.material.uniforms){u.material.uniforms.time.value=c;const h=d?1:0,m=u.material.uniforms.intensity.value,p=MathUtils$1.lerp(m,h,n*5);u.material.uniforms.intensity.value=p,u.visible=p>.01}})}let o=Math.min(n,.2);const i=c=>{var y;const d=hoverboardVelocity.length(),u=isBoosting&&(isMovingForward||isMovingBackward)?hoverboardBoostMaxSpeed:hoverboardMaxSpeed,f=isBoosting&&(isMovingForward||isMovingBackward)?hoverboardBoostAcceleration:hoverboardAcceleration;let h=0;if(isTurningLeft&&(h+=hoverboardRotationSpeed),isTurningRight&&(h-=hoverboardRotationSpeed),hoverboard.rotation.y+=h*c,targetVelocity.set(0,0,0),isMovingForward?targetVelocity.x=-u:isMovingBackward&&(targetVelocity.x=u/2),targetVelocity.length()>0){const w=new Quaternion$1().setFromAxisAngle(new Vector3$1(0,1,0),hoverboard.rotation.y);targetVelocity.applyQuaternion(w),hoverboardVelocity.lerp(targetVelocity,f*c)}else{const w=Math.max(0,1-hoverboardDeceleration*c);hoverboardVelocity.multiplyScalar(w),hoverboardVelocity.length()<.001&&hoverboardVelocity.set(0,0,0)}if(isMovingUp)hoverboardVelocity.y=hoverboardVerticalSpeed;else if(isMovingDown)hoverboardVelocity.y=-hoverboardVerticalSpeed;else{const w=Math.max(0,1-hoverboardDeceleration*c);hoverboardVelocity.y*=w,Math.abs(hoverboardVelocity.y)<.001&&(hoverboardVelocity.y=0)}if(hoverboard.position.addScaledVector(hoverboardVelocity,c),d<.1&&Math.abs(hoverboardVelocity.y)<.1){const w=performance.now()/1e3,_=Math.sin(w*2*Math.PI*bobFrequency)*bobAmplitude;hoverboard.position.y+=_-prevBob,prevBob=_}else prevBob=0;const m=Math.min(d/hoverboardMaxSpeed,1),p=(isMovingForward?-1:isMovingBackward?1:0)*maxPitch*m,v=h*m*maxRoll;currentPitch=MathUtils$1.lerp(currentPitch,p,5*c),currentRoll=MathUtils$1.lerp(currentRoll,v,5*c),hoverboard.rotation.z=currentPitch,hoverboard.rotation.x=currentRoll,hoverboardCollisionMesh.position.copy(hoverboard.position),hoverboardCollisionMesh.rotation.copy(hoverboard.rotation);const g=e.models.gltf.university.collisionMesh;if((y=g==null?void 0:g.geometry)!=null&&y.boundsTree){const w=hoverboardCollisionMesh.capsuleInfo,_=new Box3,S=new Matrix4$1,C=new Line3;S.copy(g.matrixWorld).invert(),C.copy(w.segment),C.start.applyMatrix4(hoverboardCollisionMesh.matrixWorld).applyMatrix4(S),C.end.applyMatrix4(hoverboardCollisionMesh.matrixWorld).applyMatrix4(S),_.expandByPoint(C.start),_.expandByPoint(C.end),_.min.addScalar(-w.radius),_.max.addScalar(w.radius);let A=new Vector3$1,E=new Vector3$1,k=!1,I=1/0;if(g.geometry.boundsTree.shapecast({intersectsBounds:F=>F.intersectsBox(_),intersectsTriangle:F=>{const M=new Vector3$1,R=new Vector3$1,O=F.closestPointToSegment(C,M,R);if(O<w.radius&&O<I){I=O,w.radius-O;const $=R.sub(M).normalize();A.copy($),E.copy(R),k=!0}}}),k){A.applyMatrix4(g.matrixWorld).sub(g.position).normalize();const F=A.clone().multiplyScalar(hoverboardVelocity.dot(A)),M=hoverboardVelocity.clone().sub(F),R=.95,O=.95;F.multiplyScalar(0),M.multiplyScalar(O),hoverboardVelocity.copy(M),hoverboardVelocity.multiplyScalar(R);const $=w.radius-I;if($>0){const T=u*Math.max(c,.001)*3,D=Math.min($,T),P=A.clone().multiplyScalar(D);hoverboard.position.add(P),hoverboardCollisionMesh.position.copy(hoverboard.position)}hoverboardVelocity.length()>u&&hoverboardVelocity.setLength(u)}}};for(;o>1e-6;){const c=Math.min(MAX_HOVERBOARD_SUBSTEP,o);i(c),o-=c}if(hoverboardSound){const c=hoverboardVelocity.length(),d=Math.min(c/hoverboardMaxSpeed,1),u=c>FADE_OUT_THRESHOLD?MIN_VOLUME+(MAX_VOLUME-MIN_VOLUME)*Math.pow(d,.7):0,f=hoverboardSound.getVolume(),h=c>FADE_OUT_THRESHOLD?VOLUME_RAMP_SPEED:FADE_OUT_SPEED,m=MathUtils$1.lerp(f,u,h*n);if(hoverboardSound.setVolume(m),hoverboardSound.setPlaybackRate){const g=isBoosting?.2:0,y=1+.3*d+g,w=hoverboardSound.getPlaybackRate?hoverboardSound.getPlaybackRate():1,_=MathUtils$1.lerp(w,y,3*n);hoverboardSound.setPlaybackRate(_)}c>FADE_OUT_THRESHOLD&&!hoverboardSound.isPlaying?(hoverboardSound.setVolume(MIN_VOLUME),hoverboardSound.play()):c<=FADE_OUT_THRESHOLD&&m<.01&&(hoverboardSound.stop(),hoverboardSound.setVolume(MIN_VOLUME),hoverboardSound.setPlaybackRate&&hoverboardSound.setPlaybackRate(1))}const s=new Color(6737151),r=new Color(11197951),a=new Color(1,.8,.3),l=new Color(1,1,.9);if(hoverboardTrails&&trailEmitters&&hoverboardTrails.length===trailEmitters.length){const c=t>TRAIL_MIN_SPEED&&isMovingForward,d=performance.now()*.001,u=isBoosting&&isMovingForward;for(let f=0;f<trailEmitters.length;f++){const h=trailEmitters[f],m=new Vector3$1;h.getWorldPosition(m);const p=hoverboardTrails[f];isMovingBackward&&p.ages.fill(1),updateHoverTrail(p,m,c,n),u?(p.material.uniforms.uColor.value.lerp(s,.1),p.material.uniforms.uCoreColor.value.lerp(r,.1),p.material.uniforms.uWidth.value+=(TRAIL_WIDTH*.5-p.material.uniforms.uWidth.value)*.1):(p.material.uniforms.uColor.value.lerp(a,.1),p.material.uniforms.uCoreColor.value.lerp(l,.1),p.material.uniforms.uWidth.value+=(TRAIL_WIDTH-p.material.uniforms.uWidth.value)*.1),p.material.uniforms.uTime&&(p.material.uniforms.uTime.value=d);const v=p.ages.some(g=>g<.99);p.mesh.visible=isPlayerOnHoverboard&&(c||v)}}if(isPlayerOnHoverboard&&player$2){const c=hoverboardAttachOffset.clone();hoverboard.localToWorld(c),player$2.position.copy(c);const d=new Quaternion$1().setFromAxisAngle(new Vector3$1(0,1,0),Math.PI/2),u=hoverboard.quaternion.clone().multiply(d);player$2.quaternion.copy(u)}}function updateHoverboardCamera(n,e,t){if(!isHoverboardCameraActive||!hoverboard)return;const o=new Vector3$1;o.copy(hoverboardCameraOffset);const i=new Matrix4$1;i.makeRotationY(hoverboard.rotation.y),o.applyMatrix4(i),o.add(hoverboard.position);const s=new Vector3$1;s.copy(hoverboardCameraTargetOffset),s.applyMatrix4(i),s.add(hoverboard.position);const r=1-Math.exp(-10*t);n.position.lerp(o,r),e.target.lerp(s,r),e.update()}function enableHoverboardEKey(){isHoverboardEKeyEnabled=!0}function disableHoverboardEKey(){isHoverboardEKeyEnabled=!1}let skipButton=null,skipCallback=null;function createSkipButton(n){skipCallback=n;let e=document.getElementById("scene-skip-btn");if(e){skipButton=e,skipButton.onclick=skipCallback;return}const t=document.createElement("button");t.id="scene-skip-btn",t.textContent="SKIP",t.style.cssText=`
        position: fixed;
        bottom: 40px;
        right: 120px;
        padding: 10px 20px;
        background-color: rgba(147, 51, 234, 0.7);
        color: white;
        border: 1px solid #9333ea;
        border-radius: 8px;
        cursor: pointer;
        font-family: 'Lexend', sans-serif;
        font-size: 16px;
        font-weight: 600;
        z-index: 1000;
        opacity: 0;
        pointer-events: none; /* Inactive state */
        transition: opacity 0.3s ease;
        backdrop-filter: blur(5px);
    `,t.onmouseover=()=>t.style.backgroundColor="rgba(147, 51, 234, 0.9)",t.onmouseout=()=>t.style.backgroundColor="rgba(147, 51, 234, 0.7)",t.onclick=skipCallback,document.body.appendChild(t),skipButton=t}function showSkipButton(){skipButton&&(skipButton.style.opacity="1",skipButton.style.pointerEvents="auto")}function hideSkipButton(){skipButton&&(skipButton.style.opacity="0",skipButton.style.pointerEvents="none")}let hasTriggeredFirstElectro=!1,isAutoMoving$1=!1,autoMoveDistance$1=0;const maxAutoMoveDistance=2,autoMoveSpeed=1;let isElectroSequenceActive$1=!1,electroSequenceStartTime=0;const electroLipsDuration=14,secondElectroLipsDuration=20;let shapeKeyControls$3=null,isVRMode=!1,walkSound=null,runSound=null,allAssetsRef=null,electroTriggerRef=null,secondElectroTriggerRef=null,thirdElectroTriggerRef=null,showHoverboardCallbackRef=null,onThirdElectroSequenceCompleteRef=null;const safePositions={first:{position:{x:-.16,y:1.9,z:-254},rotation:{x:0,y:Math.PI,z:0}},second:{position:{x:-2.2,y:1.9,z:-231},rotation:{x:0,y:Math.PI,z:0}},third:{position:{x:-31,y:4,z:608},rotation:{x:0,y:Math.PI,z:0}}},electroTargetPositions={first:{x:-1,y:.6,z:-248,rotationY:Math.PI},second:{x:-3,y:.6,z:-225,rotationY:Math.PI},third:{x:-31,y:3,z:616,rotationY:Math.PI}};let playerReference=null,electroComponents$3=null,activeSequenceType=null;function movePlayerToSafePosition(n,e){if(!n)return;const t=safePositions[e];t&&(n.position.set(t.position.x,t.position.y,t.position.z),n.rotation.set(t.rotation.x,t.rotation.y,t.rotation.z),playerState.velocity.set(0,0,0))}function setVRMode(n){isVRMode=n}function autoPlayerMovement$2(n,e,t){if(!isAutoMoving$1)return;const o=new Vector3$1(0,0,-1).applyQuaternion(e.quaternion),i=autoMoveSpeed*n;e.position.addScaledVector(o,i),autoMoveDistance$1+=i,autoMoveDistance$1>=maxAutoMoveDistance?(isAutoMoving$1=!1,autoMoveDistance$1=0,playerState.velocity.set(0,0,0),playerState.fwdPressed=!1,playerState.bkdPressed=!1,playerState.lftPressed=!1,playerState.rgtPressed=!1,playerState.shiftPressed=!1,updatePlayerAnimation(!1,!1)):updatePlayerAnimation(!0,!1)}function completeCurrentElectroSequence(n,e){var o,i;if(!isElectroSequenceActive$1||!allAssetsRef)return;isElectroSequenceActive$1=!1,hideSkipButton();try{const s="electro"+activeSequenceType+"trigger";(i=(o=allAssetsRef.audios)==null?void 0:o[s])!=null&&i.isPlaying&&allAssetsRef.audios[s].stop()}catch(s){console.warn("Could not stop current electro trigger audio:",s)}shapeKeyControls$3&&shapeKeyControls$3.stopAnimation(),e.talking&&e.talking.isRunning()&&e.talking.fadeOut(.5).stop(),e.breathing_idle.reset().play(),openGate(),n.visible=!1,n.position.set(0,30,0),n.rotation.set(0,Math.PI,0);const t=activeSequenceType;if(activeSequenceType=null,t==="first"?(electroTriggerRef&&electroTriggerRef.removeParticleEffects(),showObjective(2,objectives$3),typeof window.setCurrentObjectiveNumber=="function"&&window.setCurrentObjectiveNumber(2)):t==="second"?(secondElectroTriggerRef&&secondElectroTriggerRef.removeParticleEffects(),showObjective(3,objectives$3),typeof window.setCurrentObjectiveNumber=="function"&&window.setCurrentObjectiveNumber(3),showHoverboardCallbackRef&&showHoverboardCallbackRef()):t==="third"&&thirdElectroTriggerRef&&thirdElectroTriggerRef.removeParticleEffects(),isVRMode){const s=getVRControls();s&&s.enableVRControls(),togglePlayerControls(!1)}else switchToPlayerCamera(),togglePlayerControls(!0),t==="third"&&onThirdElectroSequenceCompleteRef&&onThirdElectroSequenceCompleteRef()}function skipElectroSequence$2(){!isElectroSequenceActive$1||!electroComponents$3||(console.log("Electro sequence skipped by user."),isAutoMoving$1=!1,walkSound&&walkSound.isPlaying&&walkSound.stop(),runSound&&runSound.isPlaying&&runSound.stop(),completeCurrentElectroSequence(electroComponents$3.electro,electroComponents$3.electroActions))}function initializeElectro$3(n,e,t,o){playerReference=t,allAssetsRef=e,createSkipButton(skipElectroSequence$2);const i=e.characters.models.electro;n.add(i),i.position.set(0,30,0),i.rotation.set(0,Math.PI,0),i.visible=!0,shapeKeyControls$3=setupShapeKeyAnimations(i),electroTriggerRef=TriggerPoint(e.vfxs.entryvfx,{x:0,y:.6,z:-252},n,{x:1.5,y:1.5,z:1.5},()=>{var d,u;if(hasTriggeredFirstElectro)return;hasTriggeredFirstElectro=!0,activeSequenceType="first",hideObjective(),movePlayerToSafePosition(playerReference,"first");const l=electroTargetPositions[activeSequenceType];i.position.set(l.x,l.y,l.z),i.rotation.set(0,l.rotationY,0),i.visible=!0,isAutoMoving$1=!0,autoMoveDistance$1=0,togglePlayerControls(!1);const c=getVRControls();if(c&&c.disableVRControls(),setTimeout(()=>{playAudio("electrofirsttrigger")},1e3),!isVRMode)try{switchToElectroFocus(i)}catch(f){console.error("Failed to switch to Electro focus:",f)}(d=e.audios)!=null&&d.walk&&(walkSound=e.audios.walk,walkSound.isPlaying&&walkSound.stop()),(u=e.audios)!=null&&u.run&&(runSound=e.audios.run,runSound.isPlaying&&runSound.stop())}),secondElectroTriggerRef=TriggerPoint(e.vfxs.entryvfx,{x:-2.2,y:.6,z:-230},n,{x:1,y:1,z:1},()=>{var d,u;activeSequenceType="second",hideObjective(),movePlayerToSafePosition(playerReference,"second");const l=electroTargetPositions[activeSequenceType];i.position.set(l.x,l.y,l.z),i.rotation.set(0,l.rotationY,0),i.visible=!0,isAutoMoving$1=!0,autoMoveDistance$1=0,togglePlayerControls(!1);const c=getVRControls();if(c&&c.disableVRControls(),setTimeout(()=>{playAudio("electrosecondtrigger")},1e3),!isVRMode)try{switchToElectroFocus(i)}catch(f){console.error("Failed to switch to Electro focus (second trigger):",f)}(d=e.audios)!=null&&d.walk&&(walkSound=e.audios.walk,walkSound.isPlaying&&walkSound.stop()),(u=e.audios)!=null&&u.run&&(runSound=e.audios.run,runSound.isPlaying&&runSound.stop())}),thirdElectroTriggerRef=TriggerPoint(null,{x:-24,y:3,z:680},n,{x:10,y:10,z:10},()=>{var d,u;window.isPlayerOnHoverboard&&detachPlayerFromHoverboard(),activeSequenceType="third",hideObjective(),movePlayerToSafePosition(playerReference,"third");const l=electroTargetPositions[activeSequenceType];i.position.set(l.x,l.y,l.z),i.rotation.set(0,l.rotationY,0),i.visible=!0,isAutoMoving$1=!0,autoMoveDistance$1=0,setTimeout(()=>{playAudio("electrothirdtrigger")},1e3),togglePlayerControls(!1);const c=getVRControls();if(c&&c.disableVRControls(),!isVRMode)try{switchToElectroFocus(i)}catch(f){console.error("Failed to switch to Electro focus (third trigger):",f)}(d=e.audios)!=null&&d.walk&&(walkSound=e.audios.walk,walkSound.isPlaying&&walkSound.stop()),(u=e.audios)!=null&&u.run&&(runSound=e.audios.run,runSound.isPlaying&&runSound.stop())});const s=e.characters.animations.electro.mixer,r={arm_gesture:"ARM_GESTURE",breathing_idle:"BREATHING_IDLE",entering_code:"ENTERING_CODE",head_nod_yes:"HEAD_NOD_YES",jumping:"JUMPING",landing:"LANDING",looking_behind:"LOOKING_BEHIND",opening_on:"OPENING_ON ",reaching_out:"REACHING_OUT",running:"RUNNING",standing_blocking_idle:"STANDING_BLOCKING_IDLE",talking:"TALKING",talking_02:"TALKING_02",thoughtful_head_shake:"THOUGHTFUL_ HEAD_ SHAKE",walking:"WALKING",waving:"WAVING"},a={};return Object.entries(r).forEach(([l,c])=>{a[l]=e.characters.animations.electro.actions[c]}),Object.values(a).forEach(l=>{l&&(l.setLoop(LoopOnce),l.clampWhenFinished=!0)}),a.talking&&(a.talking.timeScale=.5),electroComponents$3={electro:i,electroTrigger:electroTriggerRef,secondElectroTrigger:secondElectroTriggerRef,thirdElectroTrigger:thirdElectroTriggerRef,electroMixer:s,electroActions:a},electroComponents$3}function updateElectro$3(n,e,t,o,i,s,r,a,l,c,d,u){if(showHoverboardCallbackRef||(showHoverboardCallbackRef=u,onThirdElectroSequenceCompleteRef=c),e&&e.update(n),electroTriggerRef&&electroTriggerRef.updateQuarksScene(n,r),secondElectroTriggerRef&&secondElectroTriggerRef.updateQuarksScene(n,r),thirdElectroTriggerRef&&thirdElectroTriggerRef.updateQuarksScene(n,r),isAutoMoving$1&&r&&autoPlayerMovement$2(n,r),isAutoMoving$1&&!isElectroSequenceActive$1&&startElectroSequence$3(l,t),isElectroSequenceActive$1){const f=(performance.now()-electroSequenceStartTime)/1e3;let h=electroLipsDuration;activeSequenceType==="second"?h=secondElectroLipsDuration:activeSequenceType==="third"&&(h=electroLipsDuration),f>=h&&completeCurrentElectroSequence(l,t)}}function startElectroSequence$3(n,e){isElectroSequenceActive$1=!0,electroSequenceStartTime=performance.now(),showSkipButton(),e.waving.reset(),e.waving.setLoop(LoopRepeat),e.waving.repetitions=2,e.waving.timeScale=.5,e.waving.clampWhenFinished=!1,e.waving.play(),e.talking&&(e.talking.reset(),e.talking.setLoop(LoopRepeat),e.talking.clampWhenFinished=!1,e.talking.fadeIn(2.5).play()),setTimeout(()=>{e.waving.fadeOut(2).stop()},2e3),shapeKeyControls$3&&shapeKeyControls$3.startAnimation()}const arrowGlowEffect=`
precision highp float;

uniform float time;
uniform vec2 resolution;

varying vec2 vUv;

// Helper functions
float line(vec2 p, vec2 p0, vec2 p1, float w) {
    vec2 d = p1 - p0;
    float t = clamp(dot(d,p-p0) / dot(d,d), 0.0, 1.0);
    vec2 proj = p0 + d * t;
    float dist = length(p - proj);
    float weight = 57.0 / resolution.x;
    dist = 1.0/dist * weight * w;
    return min(dist*dist, 1.0);
}

vec3 hsv(float h, float s, float v) {
    vec4 t = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
    vec3 p = abs(fract(vec3(h) + t.xyz) * 6.0 - vec3(t.w));
    return v * mix(vec3(t.x), clamp(p - vec3(t.x), 0.0, 1.0), s);
}

void main() {
    vec2 uv = vUv * 2.0 - 1.0;
    uv.x *= resolution.x / resolution.y;
    
    vec3 color = vec3(0.0);
    float arrowSize = 0.07;
    
    for (float i = 0.0; i < 2.0; i++) {
        float xOffset = (i / 2.0) * 0.22 - 0.25;
        
        vec2 center = vec2(xOffset, 0.0);
        vec2 topPoint = center + vec2(-arrowSize, arrowSize);
        vec2 bottomPoint = center + vec2(-arrowSize, -arrowSize);
        
        float topLine = line(uv, center, topPoint, 0.3);
        float bottomLine = line(uv, center, bottomPoint, 0.3);
        
        float arrow = topLine + bottomLine;
        
        vec3 arrowColor = hsv(i / 2.0 - time * 0.1, 0.8, 1.0);
        float glow = 1.0 + 0.0 * sin(-time * 3.0 + i * 0.2);
        color += arrowColor * arrow * glow;
    }
    
    color *= 1.5;
    color = smoothstep(0.0, 1.0, color);
    
    gl_FragColor = vec4(color, 1.0);
}
`,vertexShader$1=`
varying vec2 vUv;

void main() {
    vUv = uv;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`;class DirectionArrow{constructor(e=[]){this.arrowMaterial=new ShaderMaterial({vertexShader:vertexShader$1,fragmentShader:arrowGlowEffect,uniforms:{time:{value:0},resolution:{value:new Vector2$1(window.innerWidth,window.innerHeight)}},side:DoubleSide,transparent:!0,blending:AdditiveBlending,depthWrite:!1});const t=new PlaneGeometry(5,2);this.arrowPlane=new Mesh(t,this.arrowMaterial),this.triggerPositions=e.map(o=>o instanceof Vector3$1?o:new Vector3$1(o.x,o.y,o.z)),this.currentTriggerIndex=0,this.targetReached=!1,this.arrowGroup=new Group,this.arrowGroup.add(this.arrowPlane),this.arrowPlane.position.set(0,-1.2,-.2),this.arrowPlane.rotation.set(Math.PI/2,0,Math.PI/2),this.triggerRadius=2,this._smoothedPosition=new Vector3$1}setCurrentTrigger(e){e>=0&&e<this.triggerPositions.length?(this.currentTriggerIndex=e,this.targetReached=!1,this.arrowGroup.visible=!0):e>=this.triggerPositions.length&&(this.arrowGroup.visible=!1)}getCurrentTarget(){return this.triggerPositions[this.currentTriggerIndex]}areAllTargetsReached(){return this.currentTriggerIndex>=this.triggerPositions.length-1&&this.targetReached}setTriggerRadius(e){this.triggerRadius=e}setTargetPositions(e){this.triggerPositions=e.map(t=>t instanceof Vector3$1?t:new Vector3$1(t.x,t.y,t.z)),this.reset()}reset(){this.currentTriggerIndex=0,this.targetReached=!1,this.arrowGroup.visible=!0}_update(e,t,o){if(this.triggerPositions.length===0){this.arrowGroup.visible=!1;return}if(this.checkTriggerReached(t)){this.targetReached=!0,this.arrowGroup.visible=!1,this.currentTriggerIndex<this.triggerPositions.length-1&&(this.currentTriggerIndex++,this.targetReached=!1,this.arrowGroup.visible=!0);return}this.arrowMaterial.uniforms&&(this.arrowMaterial.uniforms.time.value+=e);const i=1-Math.exp(-10*e);this._smoothedPosition.lengthSq()===0&&this._smoothedPosition.copy(t),this._smoothedPosition.lerp(t,i),this.arrowGroup.position.copy(this._smoothedPosition);const s=this.triggerPositions[this.currentTriggerIndex],r=new Vector3$1;r.subVectors(s,t),r.y=0;const a=Math.atan2(r.x,r.z),l=this.arrowGroup.rotation.y;let d=a-l;d>Math.PI&&(d-=Math.PI*2),d<-Math.PI&&(d+=Math.PI*2);const u=5;this.arrowGroup.rotation.y+=d*Math.min(e*u,1),this.arrowGroup.rotation.x=0,this.arrowGroup.rotation.z=0,this.arrowGroup.visible=!this.targetReached,this.arrowPlane.scale.setScalar(1)}checkTriggerReached(e){const t=this.triggerPositions[this.currentTriggerIndex];return e.distanceTo(t)<this.triggerRadius}_updateResolution(e,t){this.arrowMaterial.uniforms&&this.arrowMaterial.uniforms.resolution.value.set(e,t)}}let directionArrowInstance=null;function initializeDirectionArrow(n,e){return!n||!(n instanceof Scene)?(console.error("Invalid scene provided to initializeDirectionArrow"),null):(directionArrowInstance||(directionArrowInstance=new DirectionArrow(e),directionArrowInstance.arrowGroup.add(directionArrowInstance.arrowPlane),n.add(directionArrowInstance.arrowGroup)),directionArrowInstance)}function updateDirectionArrow(n,e,t){directionArrowInstance&&directionArrowInstance._update(n,e,t)}function cleanupDirectionArrow(){var n,e;directionArrowInstance&&(directionArrowInstance.arrowGroup&&((n=directionArrowInstance.arrowGroup.parent)==null||n.remove(directionArrowInstance.arrowGroup)),directionArrowInstance.arrowMaterial&&directionArrowInstance.arrowMaterial.dispose(),(e=directionArrowInstance.arrowPlane)!=null&&e.geometry&&directionArrowInstance.arrowPlane.geometry.dispose(),directionArrowInstance=null)}function handlePortalSceneSwitch({renderer:n,nextEntry:e,initializeNextScene:t,cleanupCurrentScene:o,sceneInitialization:i,isSceneTransitioningRef:s,handleKeyPress:r}){if(s.value)return;s.value=!0;const a=n.xr.getSession(),l=c=>{window.removeEventListener("keydown",r),i&&i.cleanUpCollider(),o(),checkExistingAssets(e),t(n,c).finally(()=>{s.value=!1})};a?a.end().then(()=>{l(!0)}).catch(c=>{console.error("Error ending VR session:",c),s.value=!1}):l(!1)}class Portal{constructor(e,t=new Vector3$1(0,0,0),o=new Euler$1(0,Math.PI,0),i=1){const s=new CircleGeometry(2.5,64),a=new TextureLoader().load("/scene11/portal.png");if(!a){console.error("Portal texture not found in public folder");return}a.wrapS=RepeatWrapping,a.wrapT=RepeatWrapping;const l=new ShaderMaterial({side:DoubleSide,transparent:!0,depthWrite:!1,blending:AdditiveBlending,uniforms:{uTime:{value:0},uTexture:{value:a}},vertexShader:`
              varying vec2 vUv;
              varying float vDistortion;
              void main() {
                  vUv = uv;
                  float angle = atan(position.y, position.x);
                  float radius = length(position.xy);
                  float distortion = sin(angle * 8.0 + uv.y * 5.0 + uv.x * 10.0) * 0.05;
                  vec3 displacedPosition = position + normal * distortion;
                  vDistortion = distortion;
                  gl_Position = projectionMatrix * modelViewMatrix * vec4(displacedPosition, 1.0);
              }
          `,fragmentShader:`
              uniform sampler2D uTexture;
              uniform float uTime;
              varying vec2 vUv;
              varying float vDistortion;
              vec3 permute(vec3 x) { return mod(((x*34.0)+1.0)*x, 289.0); }
              float snoise(vec2 v) {
                  const vec4 C = vec4(0.211324865405187, 0.366025403784439,
                                      -0.577350269189626, 0.024390243902439);
                  vec2 i  = floor(v + dot(v, C.yy) );
                  vec2 x0 = v -   i + dot(i, C.xx);
                  vec2 i1;
                  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
                  vec4 x12 = x0.xyxy + C.xxzz;
                  x12.xy -= i1;
                  i = mod(i, 289.0);
                  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))
                      + i.x + vec3(0.0, i1.x, 1.0 ));
                  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),
                      dot(x12.zw,x12.zw)), 0.0);
                  m = m*m ;
                  m = m*m ;
                  vec3 x = 2.0 * fract(p * C.www) - 1.0;
                  vec3 h = abs(x) - 0.5;
                  vec3 ox = floor(x + 0.5);
                  vec3 a0 = x - ox;
                  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );
                  vec3 g;
                  g.x  = a0.x  * x0.x  + h.x  * x0.y;
                  g.yz = a0.yz * x12.xz + h.yz * x12.yw;
                  return 130.0 * dot(m, g);
              }
              void main() {
                  float noise = snoise(vUv * 6.0 + uTime * 0.4) * 0.2;
                  vec2 distortedUV = vUv + vec2(noise * 0.2, noise * 0.15);
                  vec4 texColor = texture2D(uTexture, distortedUV);
                  vec3 energyColor = vec3(0.2 + 0.5 * sin(uTime), 0.8, 1.2);
                  vec3 color = texColor.rgb * energyColor + vec3(noise * 0.3);
                  float alpha = (texColor.r + texColor.g + texColor.b) / 3.0;
                  alpha *= 1.2 + noise * 0.8;
                  alpha = pow(alpha, 2.0);
                  alpha = max(alpha, 0.35);
                  gl_FragColor = vec4(color, alpha);
              }
          `});this.mesh=new Mesh(s,l),this.mesh.position.copy(t),this.mesh.rotation.copy(o),this.mesh.scale.setScalar(i),this.light=new PointLight(65535,4,15),this.light.position.copy(t),e.add(this.mesh),e.add(this.light),this.scene=e}update(e){this.mesh&&this.mesh.material&&(this.mesh.material.uniforms.uTime.value=e,this.light&&(this.light.intensity=4+Math.sin(e*2)*1.5,this.light.distance=15+Math.sin(e*3)*3))}dispose(){this.mesh&&(this.mesh.geometry&&this.mesh.geometry.dispose(),this.mesh.material&&(Array.isArray(this.mesh.material)?this.mesh.material.forEach(e=>e.dispose()):this.mesh.material.dispose()),this.scene.remove(this.mesh)),this.light&&this.scene.remove(this.light)}}const SHARED={capsuleGeometry:null,capsuleMaterial:null};function getSharedCapsuleGeometry(){return SHARED.capsuleGeometry||(SHARED.capsuleGeometry=new CapsuleGeometry(.5,1,4,8)),SHARED.capsuleGeometry}function getSharedCapsuleMaterial(){return SHARED.capsuleMaterial||(SHARED.capsuleMaterial=new MeshStandardMaterial({visible:!1})),SHARED.capsuleMaterial}function createNPC(n,e){const t=e.clone(),o=new Mesh(getSharedCapsuleGeometry(),getSharedCapsuleMaterial());o.position.copy(t),o.castShadow=!0,o.receiveShadow=!0,o.frustumCulled=!1,n.add(o);let i=2,s=[],r=!1,a=null,l=null,c=null;const d=new Vector3$1,u=new Vector3$1;let f=0;return{mesh:o,get speed(){return i},set speed(y){i=y},setModel:y=>{y&&(c=y,c.position.set(0,0,0),c.visible=!0,c.traverse(w=>{w.isObject3D&&(w.frustumCulled=!1,w.isMesh&&(w.castShadow=!0,w.receiveShadow=!0))}),o.add(c))},setAnimationMixer:(y,w)=>{a=y||null,l=w||null,l&&l.play()},setPathPoints:y=>{s=y.map(w=>new Vector3$1(w.x,Math.max(w.y,.6),w.z)),s.length>0&&o.position.copy(s[0]),f=0,r=!0},update:y=>{if(a&&a.update(y),!r||s.length===0)return;c&&!c.visible&&(c.visible=!0);const w=s[f];u.copy(w),d.copy(u).sub(o.position);const _=d.length();_>1e-4&&d.divideScalar(_);const S=i*y;if(S>=_?(o.position.copy(w),f=(f+1)%s.length,f===0&&s.length>1&&s.reverse()):(o.position.x+=d.x*S,o.position.y+=d.y*S,o.position.z+=d.z*S),d.lengthSq()>1e-6){const C=Math.atan2(d.x,d.z);o.rotation.y=C}},cleanup:()=>{try{l&&l.stop()}catch{}try{a&&a.stopAllAction()}catch{}if(c){try{c.traverse(y=>{if(y.isMesh&&(y.geometry&&y.geometry.dispose(),y.material))if(Array.isArray(y.material))y.material.forEach(w=>{if(w.map)try{w.map.dispose()}catch{}try{w.dispose()}catch{}});else{if(y.material.map)try{y.material.map.dispose()}catch{}try{y.material.dispose()}catch{}}}),c.parent&&c.parent.remove(c)}catch{}c=null}o&&o.parent&&o.parent.remove(o),a=null,l=null,r=!1,s=[]}}}function initializeNPCs(n,e=3,t={}){const o=[],{pathData:i=[]}=t;for(let s=0;s<e;s++){const r=new Vector3$1(Math.random()*10-5,0,Math.random()*10-5),a=createNPC(n,r);if(i[s])a.setPathPoints(i[s]);else{const l=3+s,c=[],d=8;for(let u=0;u<d;u++){const f=u/d*Math.PI*2;c.push({x:Math.cos(f)*l,y:.6,z:Math.sin(f)*l})}a.setPathPoints(c)}o.push(a)}return{npcs:o,getNPC:s=>o[s],setPath:(s,r)=>{const a=o[s];return a?(a.setPathPoints(r),!0):!1},attachModel:(s,r)=>{const a=o[s];return a&&r?(a.setModel(r),!0):!1},setAnimation:(s,r,a)=>{const l=o[s];return l?(l.setAnimationMixer(r,a),!0):!1},update:s=>{for(let r=0;r<o.length;r++)o[r].update(s)},playAnimation:s=>{const r=o[s];if(r)try{return r.setAnimationMixer(r.mixer,r.action),!0}catch{}return!1},stopAnimation:s=>{const r=o[s];if(r)try{return r.action&&r.action.stop(),!0}catch{}return!1},cleanup:()=>{for(let s=0;s<o.length;s++)o[s].cleanup()}}}const CDN_BASE$3=(()=>{if(typeof window<"u"){if(window.ASSETS_CDN_BASE)return window.ASSETS_CDN_BASE;if(window.ASSETS_R2_ACCOUNT_ID)return`https://${window.ASSETS_R2_ACCOUNT_ID}.r2.dev`}return"https://pub-4dc5824a7d6645b29006348054fb1f3f.r2.dev"})(),isDevHost$3=()=>{if(typeof window>"u")return!1;const n=window.location.hostname;return n==="localhost"||n==="127.0.0.1"||n==="::1"||/^10\./.test(n)||/^192\.168\./.test(n)||/^172\.(1[6-9]|2[0-9]|3[0-1])\./.test(n)},toCDN$3=n=>{if(!n)return n;if(n.startsWith("/r2/")){if(isDevHost$3())return n;const e=n.replace(/^\/r2\//,"/");return CDN_BASE$3?`${CDN_BASE$3}${e}`:e}return n},assetsEntry$5={characters:[{name:"electro",path:"/characters/electro_facialv7.glb",shadow:!1}],models:[{name:"battery9v",path:"/scene44/battery9vtest.glb",shadow:!1},{name:"introBattery9v",path:"/scene44/introbattery9v.glb",shadow:!1},{name:"capacitor",path:"/scene44/capacitor.glb",shadow:!1},{name:"resistor100",path:"/scene44/resistor.glb",shadow:!1},{name:"dcMotor",path:"/scene44/circuitMotor.glb",shadow:!1},{name:"introMotor",path:"/scene44/motor.glb",shadow:!1},{name:"led",path:"/scene44/led.glb",shadow:!1},{name:"UBEC",path:"/scene44/ubec.glb",shadow:!1},{name:"rgbModule",path:"/scene44/rgbModule.glb",shadow:!1},{name:"powerDistributionModule",path:"/scene44/powerDistributor.glb",shadow:!1},{name:"motorDriver",path:"/scene44/motorDriver.glb",shadow:!1},{name:"button",path:"/scene44/button.glb",shadow:!1},{name:"buzzer",path:"/scene44/buzzer.glb",shadow:!1},{name:"main",path:toCDN$3("/r2/baked_4.5.glb"),shadow:!0}],textures:[{name:"portal",path:"/scene44/Images/Textures/Portal_Base_Upscaled.png"},{name:"screen",path:"/scene44/Images/Textures/Frame 1 (7).png"},{name:"Lock_Base",path:"/scene44/Images/Textures/Lock_Base.png"},{name:"Lock_Base_Alpha",path:"/scene44/Images/Textures/Lock_Base_Alpha.png"},{name:"batteryImg",path:"/scene44/Images/Textures/CircuitImages/batteryBW.png"},{name:"capacitorImg",path:"/scene44/Images/Textures/CircuitImages/capacitorBW.png"},{name:"ledImg",path:"/scene44/Images/Textures/CircuitImages/ledBW.png"},{name:"motorImg",path:"/scene44/Images/Textures/CircuitImages/motorBW.png"},{name:"resistorImg",path:"/scene44/Images/Textures/CircuitImages/resistorBW.png"},{name:"keyboardImg",path:"/scene44/Images/Textures/Keyboard.png"}],videoTextures:[{name:"DTwin",path:"/scene44/Videos/dTwin.mp4"},{name:"ZoeVid",path:"/scene44/Videos/zoeVid.mp4"}],audios:[{name:"background",path:"/audios/background.mp3",volume:1,loop:!0},{name:"electroCaution1",path:"scene44/Audio/electroCaution1.mp3",volume:1,loop:!1,positional:!1},{name:"electroFirstAudio",path:"scene44/Audio/electroFirstAudio.mp3",volume:1,loop:!1,positional:!1},{name:"eIntroFinal",path:"scene44/Audio/eIntroFinalEdit2.mp3",volume:1,loop:!1,positional:!1},{name:"electroCall",path:"scene44/Audio/electroCall.mp3",volume:1,loop:!1,positional:!1},{name:"digiTwinConvo",path:"scene44/Audio/dTwinConvo.mp3",volume:1,loop:!1,positional:!1},{name:"electroIntroDone",path:"scene44/Audio/electroIntroDone.mp3",volume:1,loop:!1,positional:!1},{name:"electroWrongCircuit",path:"scene44/Audio/ElectroCircuitDisagree.mp3",volume:1,loop:!1,positional:!1},{name:"electroCorrectCircuit",path:"scene44/Audio/ElectroCircuitAgree.mp3",volume:1,loop:!1,positional:!1},{name:"electroGateOpen",path:"scene44/Audio/ElectroGateOpen.mp3",volume:1,loop:!1,positional:!1},{name:"digiTwinEnd",path:"scene44/Audio/dtwinEnd.mp3",volume:1,loop:!1,positional:!1}],hdris:[{name:"env",path:toCDN$3("/r2/dark_forest.hdr")}],cubeMaps:[],vfxs:[{name:"zone",path:"vfxFiles/zone.json"},{name:"circuitPuzzleZone",path:"vfxFiles/zone.json"}],pathFiles:[],jsonFiles:[],fonts:[],svgs:[]},objectives$2={1:{main:"Explore the university and Find Zoe",sub:"Navigate through the university to locate Zoe."},2:{main:"Find the Electro",sub:"Use the minimap to find the Electro."},3:{main:"Reach near the Electro",sub:""}};function showSceneObjective$1(n){__vitePreload(async()=>{const{showObjective:e}=await Promise.resolve().then(()=>ObjectiveUI);return{showObjective:e}},void 0).then(({showObjective:e})=>{e(n,objectives$2)})}function hideSceneObjective(){__vitePreload(async()=>{const{hideObjective:n}=await Promise.resolve().then(()=>ObjectiveUI);return{hideObjective:n}},void 0).then(({hideObjective:n})=>{n()})}function createEntryEffect(n,e=new Vector3$1(0,0,0),t=1){let o={hasAnimationPlayed:!1,isEffectComplete:!1};const i=new PlaneGeometry(6*t,6*t),s=(M,R)=>new ShaderMaterial({uniforms:{glowColor:{value:new Color(M)},ringRadius:{value:R*t},ringThickness:{value:.05*t},glowStrength:{value:.1*t},intensity:{value:1}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,fragmentShader:`
            uniform vec3 glowColor;
            uniform float ringRadius;
            uniform float ringThickness;
            uniform float glowStrength;
            uniform float intensity;
            varying vec2 vUv;
            void main() {
                vec2 p = vUv * 2.0 - 1.0;
                float dist = length(p);
                float ring = smoothstep(ringRadius - ringThickness, ringRadius, dist) - 
                             smoothstep(ringRadius, ringRadius + ringThickness, dist);
                float glow = 1.0 - smoothstep(ringRadius, ringRadius + glowStrength, dist);
                glow = pow(glow, intensity);
                vec3 color = glowColor * (glow + ring);
                float alpha = dist < (ringRadius - ringThickness) ? 0.0 : max(ring, glow * 0.3);
                gl_FragColor = vec4(color, alpha);
            }
        `,transparent:!0}),a=[s(65535,.8),s(65535,.6),s(65535,.4)].map((M,R)=>{const O=new Mesh(i,M);return O.rotation.x=-Math.PI/2,O.position.copy(e),O.position.y+=R*.1*t,O.visible=!1,n.add(O),O}),l=new ShaderMaterial({uniforms:{glowColor:{value:new Color(65535)},rectSize:{value:new Vector2$1(.06*t,.01*t)},numGroups:{value:10},radius:{value:.48*t},groupSpacing:{value:.2*t},intraGroupSpacing:{value:.01*t}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,fragmentShader:`
            uniform vec3 glowColor;
            uniform vec2 rectSize;
            uniform int numGroups;
            uniform float radius;
            uniform float groupSpacing;
            uniform float intraGroupSpacing;
            varying vec2 vUv;
            void main() {
                vec2 uv = vUv * 2.0 - 1.0;
                float totalAngle = 6.28318;
                float groupAngleStep = totalAngle / float(numGroups);
                float baseAngleStep = groupAngleStep - groupSpacing;
                float rectAngleStep = baseAngleStep / 8.0;
                float ring = 0.0;
                for (int i = 0; i < 10; i++) {
                    if (i >= numGroups) break;
                    float groupAngle = float(i) * groupAngleStep;
                    for (int j = 0; j < 3; j++) {
                        float angle = groupAngle + float(j) * rectAngleStep;
                        vec2 pos = vec2(cos(angle), sin(angle)) * radius;
                        mat2 rot = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
                        vec2 rUv = rot * (uv - pos);
                        vec2 absUv = abs(rUv);
                        float box = step(absUv.x, rectSize.x) * step(absUv.y, rectSize.y);
                        ring += smoothstep(0.02, 0.03, box);
                    }
                }
                vec3 color = glowColor * ring;
                gl_FragColor = vec4(color, ring);
            }
        `,transparent:!0}),c=new ShaderMaterial({uniforms:{glowColor:{value:new Color(65535)},rectSize:{value:new Vector2$1(.03*t,.04*t)},numRects:{value:12},radius:{value:.3*t}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,fragmentShader:`
            uniform vec3 glowColor;
            uniform vec2 rectSize;
            uniform int numRects;
            uniform float radius;
            varying vec2 vUv;
            void main() {
                vec2 uv = vUv * 2.0 - 1.0;
                float angleStep = 6.28318 / float(numRects);
                float ring = 0.0;
                for (int i = 0; i < 12; i++) {
                    if (i >= numRects) break;
                    float angle = float(i) * angleStep;
                    vec2 pos = vec2(cos(angle), sin(angle)) * radius;
                    mat2 rot = mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
                    vec2 rUv = rot * (uv - pos);
                    float box = step(abs(rUv.x), rectSize.x) * step(abs(rUv.y), rectSize.y);
                    ring += smoothstep(0.02, 0.03, box);
                }
                vec3 color = glowColor * ring;
                gl_FragColor = vec4(color, ring);
            }
        `,transparent:!0}),d=new Mesh(i,l),u=new Mesh(i,c);d.rotation.x=-Math.PI/2,u.rotation.x=-Math.PI/2,d.position.copy(e),u.position.copy(e),d.position.y+=.15*t,u.position.y+=.2*t,d.visible=!1,u.visible=!1,n.add(d),n.add(u);const f=400,h=new BufferGeometry,m=new Float32Array(f*3),p=new Float32Array(f);for(let M=0;M<f;M++){const R=Math.random()*Math.PI*2,O=Math.random()*.8*t;m[M*3]=Math.cos(R)*O,m[M*3+1]=2*t+Math.random()*.5*t,m[M*3+2]=Math.sin(R)*O,p[M]=(.5+Math.random()*1)*t}h.setAttribute("position",new BufferAttribute(m,3));const v=new ShaderMaterial({uniforms:{headColor:{value:new Color(65535)},tailColor:{value:new Color(65535)},pointSize:{value:.2*t},trailLength:{value:50*t}},vertexShader:`
            varying vec3 vPosition;
            void main() {
                vPosition = position;
                gl_PointSize = 40.0;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,fragmentShader:`
            uniform vec3 headColor;
            uniform vec3 tailColor;
            uniform float pointSize;
            uniform float trailLength;
            varying vec3 vPosition;
            void main() {
                vec2 p = gl_PointCoord - vec2(0.5);
                float dist = length(p);
                float circle = 1.0 - smoothstep(pointSize * 0.3, pointSize * 0.5, dist);
                float trail = 1.0 - smoothstep(0.0, trailLength, p.y + 0.5);
                trail *= smoothstep(-0.5, -0.3, p.y);
                float trailWidth = mix(1.0, 0.1, trail);
                trail *= (1.0 - smoothstep(0.0, trailWidth * pointSize, abs(p.x)));
                vec3 color = mix(headColor, tailColor, trail);
                float intensity = max(circle * 2.5, trail * 2.0);
                color *= intensity;
                float alpha = clamp(intensity, 0.0, 1.0);
                gl_FragColor = vec4(color, alpha);
            }
        `,transparent:!0,blending:AdditiveBlending}),g=new Points(h,v);g.position.copy(e),g.position.y+=1*t,g.visible=!1,n.add(g);const y=new ShaderMaterial({uniforms:{glowColor:{value:new Color(51)},neonColor:{value:new Color(65535)},coreRadius:{value:1.5*t},glowRadius:{value:.8*t},intensity:{value:2.5},time:{value:0},innerCutRadius:{value:.4*t}},vertexShader:`
            uniform float time;
            varying vec2 vUv;
            void main() {
                vUv = uv;
                float angle = time * 1.0;
                mat2 rotationMatrix = mat2(
                    cos(angle), -sin(angle),
                    sin(angle), cos(angle)
                );
                vUv = rotationMatrix * (vUv - 0.5) + 0.5;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,fragmentShader:`
            uniform vec3 glowColor;
            uniform vec3 neonColor;
            uniform float coreRadius;
            uniform float glowRadius;
            uniform float intensity;
            uniform float innerCutRadius;
            varying vec2 vUv;
            void main() {
                vec2 p = vUv * 2.0 - 1.0;
                float dist = length(p);
                float innerGlow = 1.0 - smoothstep(innerCutRadius - 0.02, innerCutRadius, dist);
                innerGlow = pow(innerGlow, 3.0);
                float core = 1.0 - smoothstep(coreRadius - 0.01, coreRadius, dist);
                float glow = smoothstep(coreRadius, glowRadius, dist);
                glow = 1.0 - glow;
                glow = pow(glow, intensity);
                vec3 color = mix(glowColor * glow + glowColor * core, neonColor, innerGlow);
                float alpha = max(core, glow * 0.6);
                alpha = max(alpha, innerGlow * 0.8);
                alpha *= step(dist, glowRadius);
                gl_FragColor = vec4(color, alpha);
            }
        `,transparent:!0}),w=new Mesh(i,y);w.rotation.x=-Math.PI/2,w.position.copy(e),w.position.y-=.1*t,w.visible=!1,n.add(w);const _=.1*t,S=5*t,C=32,A=new CylinderGeometry(_,_,S,C,1,!0),E=new ShaderMaterial({uniforms:{time:{value:0},glowColor:{value:new Color(65535)}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,fragmentShader:`
            varying vec2 vUv;
            uniform float time;
            uniform vec3 glowColor;
            void main() {
                float gradient = 1.0 - vUv.y;
                float pulse = 0.5 + 0.5 * sin(time * 5.0 + vUv.y * 10.0);
                float noise = sin(vUv.x * 20.0 + time * 2.0) * 0.1;
                float intensity = gradient * pulse + noise;
                vec3 color = glowColor * intensity;
                gl_FragColor = vec4(color, intensity * 0.8);
            }
        `,side:DoubleSide,transparent:!0}),k=new Mesh(A,E);k.position.copy(e),k.position.y=S/2,k.visible=!1;const I=()=>{a.forEach(M=>{M.visible=!1,M.material.uniforms.intensity.value=0}),d.visible=!1,u.visible=!1,d.material.uniforms.glowColor.value.set(65535),u.material.uniforms.glowColor.value.set(65535),g.visible=!1,w.visible=!1,k.visible=!1,o.hasAnimationPlayed=!1,o.isEffectComplete=!1},F=()=>{if(!o.hasAnimationPlayed)return;const M=performance.now(),R=4e3,O=()=>{const $=performance.now()-M,T=Math.min($/R,1);a.forEach((L,B)=>{L.visible=!0;const b=Math.sin(T*Math.PI)*2;L.material.uniforms.intensity.value=b}),d.visible=!0,u.visible=!0;const D=Math.sin(T*Math.PI)*2;d.material.uniforms.glowColor.value.setRGB(0,D,D),u.material.uniforms.glowColor.value.setRGB(0,D,D),w.visible=!0,w.material.uniforms.time.value=$*.001,k.visible=!0,k.material.uniforms.time.value=$*.001,g.visible=!0;const P=g.geometry.attributes.position.array;for(let L=0;L<f;L++)if(P[L*3+1]-=p[L]*.02,P[L*3+1]<-2*t){const B=Math.random()*Math.PI*2,b=Math.random()*.8*t;P[L*3]=Math.cos(B)*b,P[L*3+1]=2*t+Math.random()*.5*t,P[L*3+2]=Math.sin(B)*b}g.geometry.attributes.position.needsUpdate=!0,T<1?requestAnimationFrame(O):(o.isEffectComplete=!0,I())};O()};return{trigger:()=>{o.hasAnimationPlayed||(I(),o.hasAnimationPlayed=!0,F())},getPosition:()=>e.clone()}}let fallingPieces$1=[],fallingParticles$1=[];new Vector3$1;new Vector3$1(0,1.5,-2);let isFalling$1=!1,floor=null;new GLTFLoader;let scene$9=null,camera$8=null,floorMesh=null,crackMaterial=null,floorPieces=[],isFloorCollapsing=!1,nebulaParticles=[],mainFallingRocks=[],mainFallingDebris=[],mainIsShattering=!1,mainCrackedMeshes=new Set,mainOriginalMeshPositions=new Map;function initializeFallingEffect(n,e,t,o){scene$9=n,camera$8=e,console.log("Initializing falling effect with assets:",t),window.isFalling=!0;const i=new Vector3$1(0,0,-1);i.applyQuaternion(camera$8.quaternion);const s=new Vector3$1;s.copy(camera$8.position).add(i.multiplyScalar(8)),scene$9.traverse(l=>{l.isMesh&&l.name==="polySurface998"&&(floorMesh=l,console.log("Found floor mesh:",floorMesh),createFloorPieces(floorMesh),crackMaterial=new MeshStandardMaterial({color:0,roughness:.9,metalness:.1,emissive:new Color(0),emissiveIntensity:.5,transparent:!0,opacity:.8}),createCrackEffect(floorMesh))});const r=new PlaneGeometry(15,15,30,30),a=new MeshStandardMaterial({color:5592405,roughness:1,metalness:.1,emissive:new Color(2236962),emissiveIntensity:.8});floor=new Mesh(r,a),floor.rotation.x=-Math.PI/2,floor.position.copy(s),floor.receiveShadow=!0,scene$9.add(floor),camera$8.position.set(0,5,0),triggerCrackVisual(),setTimeout(explodeFloor,1500)}function triggerCrackVisual(){if(!floor)return;const n=floor.geometry.attributes.position;for(let e=0;e<n.count;e++){let t=n.getY(e);n.setY(e,t-Math.random()*.5),n.setX(e,n.getX(e)+(Math.random()-.5)*.2),n.setZ(e,n.getZ(e)+(Math.random()-.5)*.2)}n.needsUpdate=!0}function explodeFloor(){if(!floor)return;scene$9.remove(floor);const n=8;for(let e=-n;e<=n;e++)for(let t=-n;t<=n;t++)Math.random()<.4&&createDebris();spawnParticles$1(),isFalling$1=!0}function createFloorPieces(n){if(!n)return;n.geometry;const e=1.5,t=15,o=15;for(let i=-t/2;i<t/2;i+=e*1.5)for(let s=-o/2;s<o/2;s+=e*1.5)if(Math.random()<.7){const r=new PlaneGeometry(e,e),a=new MeshStandardMaterial({color:8947848,roughness:.8,metalness:.2,flatShading:!0}),l=new Mesh(r,a);l.position.set(i,0,s),l.rotation.x=-Math.PI/2,l.castShadow=!0,l.receiveShadow=!0,scene$9.add(l),floorPieces.push({mesh:l,velocity:new Vector3$1(0,0,0),rotationSpeed:new Vector3$1((Math.random()-.5)*.01,(Math.random()-.5)*.01,(Math.random()-.5)*.01),delay:Math.random()*3})}scene$9.remove(n),isFloorCollapsing=!0}function createDebris(n,e){let t;const o=Math.random();o<.4?t=new BoxGeometry(Math.random()*.4+.2,Math.random()*.3+.1,Math.random()*.4+.2):o<.7?t=new BoxGeometry(Math.random()*.5+.2,Math.random()*.15+.05,Math.random()*.5+.2):t=new OctahedronGeometry(Math.random()*.3+.1,0);const i=new MeshStandardMaterial({color:new Color(8947848).offsetHSL(0,0,(Math.random()-.5)*.2),roughness:Math.random()*.5+.5,metalness:Math.random()*.3,flatShading:!0,emissive:new Color(4473924),emissiveIntensity:.4}),s=new Mesh(t,i),r=new Vector3$1(0,0,-1);r.applyQuaternion(camera$8.quaternion);const a=new Vector3$1;a.copy(camera$8.position).add(r.multiplyScalar(5));const l=Math.random()*3,c=Math.random()*Math.PI*2;a.x+=Math.cos(c)*l,a.z+=Math.sin(c)*l,a.y=10+Math.random()*5,s.position.copy(a),s.rotation.set(Math.random()*Math.PI*2,Math.random()*Math.PI*2,Math.random()*Math.PI*2),s.castShadow=!0,s.receiveShadow=!0,scene$9.add(s);const d=Math.random()*.2+.1;fallingPieces$1.push({mesh:s,velocity:new Vector3$1((Math.random()-.5)*d,-Math.random()*.3-.2,(Math.random()-.5)*d),rotationSpeed:new Vector3$1(Math.random()*.02,Math.random()*.02,Math.random()*.02)})}function spawnParticles$1(){for(let t=0;t<1500;t++){const o=new BoxGeometry(.02,.02,.02),i=new MeshBasicMaterial({color:13421772,transparent:!0,opacity:.4}),s=new Mesh(o,i),r=new Vector3$1(0,0,-1);r.applyQuaternion(camera$8.quaternion);const a=new Vector3$1;a.copy(camera$8.position).add(r.multiplyScalar(8));const l=Math.random()*6+2,c=Math.random()*Math.PI*2;a.x+=Math.cos(c)*l,a.z+=Math.sin(c)*l,a.y=15+Math.random()*8,s.position.copy(a),scene$9.add(s),fallingParticles$1.push({mesh:s,velocity:new Vector3$1((Math.random()-.5)*.4,-Math.random()*.5-.3,(Math.random()-.5)*.4)})}for(let t=0;t<300;t++){const o=new OctahedronGeometry(.04,0),i=new MeshStandardMaterial({color:8947848,roughness:.8,metalness:.2,flatShading:!0}),s=new Mesh(o,i),r=new Vector3$1(0,0,-1);r.applyQuaternion(camera$8.quaternion);const a=new Vector3$1;a.copy(camera$8.position).add(r.multiplyScalar(8));const l=Math.random()*6+2,c=Math.random()*Math.PI*2;a.x+=Math.cos(c)*l,a.z+=Math.sin(c)*l,a.y=15+Math.random()*8,s.position.copy(a),scene$9.add(s),fallingParticles$1.push({mesh:s,velocity:new Vector3$1((Math.random()-.5)*.6,-Math.random()*.7-.4,(Math.random()-.5)*.6),rotationSpeed:new Vector3$1(Math.random()*.02,Math.random()*.02,Math.random()*.02)})}}function updateFallingEffect(n,e){if(!isFalling$1)return;const t=new Vector3$1(0,0,-1);t.applyQuaternion(camera$8.quaternion);const o=new Vector3$1;o.copy(camera$8.position).add(t.multiplyScalar(8)),nebulaParticles.forEach(i=>{const s=i.geometry.attributes.position.array;for(let r=0;r<s.length;r+=3)if(s[r+1]+=n*5,s[r+1]>50){const a=Math.random()*4,l=Math.random()*Math.PI*2;s[r]=o.x+Math.cos(l)*a,s[r+1]=o.y-150,s[r+2]=o.z+Math.sin(l)*a}i.geometry.attributes.position.needsUpdate=!0}),isFloorCollapsing&&floorPieces.forEach((i,s)=>{if(i.delay>0){i.delay-=n;return}i.velocity.y-=.005,i.mesh.position.add(i.velocity.clone().multiplyScalar(n*3)),i.mesh.rotation.x+=i.rotationSpeed.x,i.mesh.rotation.y+=i.rotationSpeed.y,i.mesh.rotation.z+=i.rotationSpeed.z,i.mesh.position.y<-20&&(scene$9.remove(i.mesh),floorPieces.splice(s,1))}),fallingPieces$1.forEach(i=>{if(i.velocity.y-=.005,i.mesh.position.add(i.velocity.clone().multiplyScalar(n*3)),i.mesh.rotation.x+=i.rotationSpeed.x,i.mesh.rotation.y+=i.rotationSpeed.y,i.mesh.rotation.z+=i.rotationSpeed.z,i.mesh.position.y<-10){const s=Math.random()*6,r=Math.random()*Math.PI*2;i.mesh.position.set(o.x+Math.cos(r)*s,o.y+50+Math.random()*20,o.z+Math.sin(r)*s),i.velocity.set(0,-Math.random()*.2-.1,0)}}),fallingParticles$1.forEach(i=>{if(i.velocity.y-=.005,i.mesh.position.add(i.velocity.clone().multiplyScalar(n*3)),i.mesh.position.y<-10){const s=Math.random()*6,r=Math.random()*Math.PI*2;i.mesh.position.set(o.x+Math.cos(r)*s,o.y+50+Math.random()*20,o.z+Math.sin(r)*s),i.velocity.y=-Math.random()*.2-.1}})}function cleanupFallingEffect(){window.isFalling=!1,camera$8&&camera$8.userData&&camera$8.userData.controls&&(camera$8.userData.controls.enabled=!0),enablePlayerControls(),togglePlayerControls(!0),enableCameraControls(),setCameraFollowsPlayer(!0),setCameraFocusOnPlayer(!0),floor&&(scene$9&&scene$9.remove(floor),floor.geometry&&floor.geometry.dispose(),floor.material&&(Array.isArray(floor.material)?floor.material.forEach(n=>n.dispose()):floor.material.dispose()),floor=null),fallingPieces$1.forEach(n=>{n.mesh&&(scene$9&&scene$9.remove(n.mesh),n.mesh.geometry&&n.mesh.geometry.dispose(),n.mesh.material&&(Array.isArray(n.mesh.material)?n.mesh.material.forEach(e=>e.dispose()):n.mesh.material.dispose()))}),fallingPieces$1=[],fallingParticles$1.forEach(n=>{n.mesh&&(scene$9&&scene$9.remove(n.mesh),n.mesh.geometry&&n.mesh.geometry.dispose(),n.mesh.material&&(Array.isArray(n.mesh.material)?n.mesh.material.forEach(e=>e.dispose()):n.mesh.material.dispose()))}),fallingParticles$1=[],nebulaParticles.forEach(n=>{scene$9&&scene$9.remove(n),n.geometry&&n.geometry.dispose(),n.material&&n.material.dispose()}),nebulaParticles=[],floorPieces.forEach(n=>{n.mesh&&(scene$9&&scene$9.remove(n.mesh),n.mesh.geometry&&n.mesh.geometry.dispose(),n.mesh.material&&(Array.isArray(n.mesh.material)?n.mesh.material.forEach(e=>e.dispose()):n.mesh.material.dispose()))}),floorPieces=[],isFalling$1=!1,isFloorCollapsing=!1,scene$9=null,camera$8=null,floorMesh=null,crackMaterial&&(crackMaterial.dispose(),crackMaterial=null)}function createCrackEffect(n){if(!n)return;const t=n.geometry.clone().attributes.position.array,o=new Vector3$1;n.geometry.computeBoundingBox(),n.geometry.boundingBox.getCenter(o);const i=[],s=5;for(let a=0;a<s;a++){const l=a/s*Math.PI*2,c=2+Math.random()*3,d=new Vector3$1(o.x+Math.cos(l)*.5,o.y,o.z+Math.sin(l)*.5),u=new Vector3$1(o.x+Math.cos(l)*c,o.y,o.z+Math.sin(l)*c);i.push({start:d,end:u})}for(let a=0;a<t.length;a+=3){const l=new Vector3$1(t[a],t[a+1],t[a+2]);let c=1/0;i.forEach(d=>{const u=distanceToLine(l,d.start,d.end);c=Math.min(c,u)}),c<.5&&(t[a+1]-=(.5-c)*.2,t[a]+=(Math.random()-.5)*.1,t[a+2]+=(Math.random()-.5)*.1)}n.geometry.attributes.position.needsUpdate=!0,n.geometry.computeVertexNormals();const r=new Mesh(n.geometry.clone(),crackMaterial);r.position.copy(n.position),r.rotation.copy(n.rotation),r.scale.copy(n.scale),scene$9.add(r),gsapWithCSS.to(r.material,{opacity:1,duration:1,ease:"power2.inOut"})}function distanceToLine(n,e,t){const o=new Vector3$1().subVectors(t,e),i=o.length();o.normalize();const s=new Vector3$1().subVectors(n,e),r=s.dot(o);if(r<=0)return s.length();if(r>=i)return n.distanceTo(t);const a=new Vector3$1().copy(o).multiplyScalar(r),l=new Vector3$1().addVectors(e,a);return n.distanceTo(l)}function startMainFallingSequence(n,e,t,o){if(!(!n||!e||!t))if(console.log("Starting main falling sequence from fallingEffect.js"),mainIsShattering=!0,performance.now(),t){if(console.log("Found player, starting main fall sequence"),n.traverse(f=>{if(f.isMesh&&f.name==="polySurface998"&&f.material){f.material.transparent=!0,f.material.opacity=.3,f.material.depthWrite=!1,f.material.needsUpdate=!0;const h=f.geometry.clone(),m=new MeshStandardMaterial({color:4925962,roughness:1,metalness:0,transparent:!0,opacity:.8,depthWrite:!1}),p=new Mesh(h,m);p.position.copy(f.position),p.rotation.copy(f.rotation),p.scale.copy(f.scale),n.add(p),gsapWithCSS.to(p.scale,{x:.95,y:.95,z:.95,duration:.5,ease:"power2.inOut"}),gsapWithCSS.to(p.material,{opacity:0,duration:1,delay:.5,ease:"power2.inOut",onComplete:()=>{n.remove(p)}})}}),n.traverse(f=>{(f.name==="playerCapsule"||f.parent&&f.parent.name==="playerCapsule"||f.name==="player"||f.parent&&f.parent.name==="player")&&(f.visible=!0,f.isLight&&(f.intensity=1))}),actionFalling)console.log("Starting falling animation for player using actionFalling"),actionFalling.reset(),actionFalling.setLoop(LoopRepeat),actionFalling.clampWhenFinished=!1,actionFalling.fadeIn(.5).play(),t.userData&&(t.userData.currentAction=actionFalling);else if(t.userData&&t.userData.mixer){const h=(t.userData.animations||[]).find(m=>m.name.toLowerCase().includes("fall")||m.name.toLowerCase().includes("falling")||m.name.toLowerCase().includes("jump"));if(h){console.log("Found fallback falling animation:",h.name);const m=t.userData.mixer.clipAction(h);m.reset(),m.setLoop(LoopRepeat),m.clampWhenFinished=!1,m.fadeIn(.5).play(),t.userData&&(t.userData.currentAction=m)}else console.warn("No falling animation found for player")}o&&(o.visible=!0,o.position.set(t.position.x+1,t.position.y,t.position.z),o.rotation.set(0,Math.PI/2,0)),e.position.y,t.position.y;const i=[],s=[],r=new TextureLoader,a=r.load("/scene33/concrete_diff.jpg"),l=r.load("/scene33/concrete_nor.jpg"),c=()=>{const f=Math.floor(Math.random()*3);let h;if(f===0)h=new BoxGeometry(Math.random()*.6+.3,Math.random()*.2+.1,Math.random()*.3+.15);else if(f===1){h=new BoxGeometry(Math.random()*.5+.2,Math.random()*.5+.2,Math.random()*.5+.2);const y=h.attributes.position;for(let w=0;w<y.count;w++)y.setX(w,y.getX(w)+(Math.random()-.5)*.1),y.setY(w,y.getY(w)+(Math.random()-.5)*.1),y.setZ(w,y.getZ(w)+(Math.random()-.5)*.1);h.computeVertexNormals()}else h=new CylinderGeometry(Math.random()*.2+.1,Math.random()*.3+.15,Math.random()*.5+.3,8);const m=new MeshStandardMaterial({map:a,normalMap:l,color:new Color().setHSL(0,0,.3+Math.random()*.2),roughness:.95,metalness:.05,flatShading:!0}),p=new Mesh(h,m),v=Math.random()*3,g=Math.random()*Math.PI*2;p.position.set(t.position.x+Math.cos(g)*v,t.position.y+5+Math.random()*3,t.position.z+Math.sin(g)*v),p.castShadow=!0,p.receiveShadow=!0,n.add(p),i.push({mesh:p,velocity:new Vector3$1((Math.random()-.5)*.02,-.08,(Math.random()-.5)*.02),rotationSpeed:new Vector3$1(Math.random()*.02,Math.random()*.02,Math.random()*.02)})},d=()=>{const f=[new BoxGeometry(.3,.1,.1),new BoxGeometry(.1,.3,.1),new BoxGeometry(.1,.1,.3),new BoxGeometry(.2,.2,.2),new BoxGeometry(.4,.2,.2),new BoxGeometry(.2,.4,.2),new BoxGeometry(.2,.2,.4)],h=f[Math.floor(Math.random()*f.length)],m=new MeshStandardMaterial({color:4473924,roughness:.8,metalness:.3,emissive:new Color(1118481),emissiveIntensity:.2,flatShading:!0}),p=new Mesh(h,m),v=Math.random()*2,g=Math.random()*Math.PI*2;p.position.set(t.position.x+Math.cos(g)*v,t.position.y+4+Math.random()*2,t.position.z+Math.sin(g)*v),n.add(p),s.push({mesh:p,velocity:new Vector3$1((Math.random()-.5)*.01,-.07,(Math.random()-.5)*.01),rotationSpeed:new Vector3$1(Math.random()*.02,Math.random()*.02,Math.random()*.02)})};for(let f=0;f<5;f++)c(),d();const u=()=>{var f;mainIsShattering&&(t.position.y-=.05,t.rotation.x+=.003,o&&(o.position.y=t.position.y,o.rotation.y+=.002,o.rotation.z+=.005),e.position.y=t.position.y+1.2,e.position.x=t.position.x+1,e.position.z=t.position.z+1,(f=e.userData)!=null&&f.controls&&(e.userData.controls.target.copy(t.position),e.userData.controls.update()),t.position.x+=(Math.random()-.5)*.01,t.position.z+=(Math.random()-.5)*.01,t.userData&&t.userData.mixer&&(t.userData.mixer.update(.016),t.userData.currentAction&&(t.userData.currentAction.isRunning()||t.userData.currentAction.play())),actionFalling&&!actionFalling.isRunning()&&actionFalling.play(),Math.random()<.03&&c(),Math.random()<.04&&d(),i.forEach((h,m)=>{h.mesh.position.add(h.velocity),h.mesh.rotation.x+=h.rotationSpeed.x,h.mesh.rotation.y+=h.rotationSpeed.y,h.mesh.rotation.z+=h.rotationSpeed.z,h.mesh.position.y<-50&&(n.remove(h.mesh),i.splice(m,1))}),s.forEach((h,m)=>{h.mesh.position.add(h.velocity),h.mesh.rotation.x+=h.rotationSpeed.x,h.mesh.rotation.y+=h.rotationSpeed.y,h.mesh.rotation.z+=h.rotationSpeed.z,h.mesh.position.y<-50&&(n.remove(h.mesh),s.splice(m,1))}),requestAnimationFrame(u))};u()}else console.error("Player not found for falling sequence")}function stopMainFallingSequence(){console.log("Stopping main falling sequence"),mainIsShattering=!1,actionFalling&&actionFalling.isRunning()&&(actionFalling.stop(),actionFalling.reset()),scene$9&&scene$9.traverse(n=>{if(n.userData&&n.userData.currentAction){const e=n.userData.currentAction;e&&e.isRunning()&&(e.stop(),e.reset()),delete n.userData.currentAction}})}function cleanupMainFallingSequence(){console.log("Cleaning up main falling sequence"),stopMainFallingSequence(),mainIsShattering=!1,mainFallingRocks.forEach(n=>{n.mesh&&scene$9&&scene$9.remove(n.mesh)}),mainFallingRocks=[],mainFallingDebris.forEach(n=>{n.mesh&&scene$9&&scene$9.remove(n.mesh)}),mainFallingDebris=[],mainCrackedMeshes.clear(),mainOriginalMeshPositions.clear()}let hasTriggeredElectro=!1,entryEffect=null,currentScene$3=null,currentCamera$3=null,skipButtonInitialized$2=!1,isSequenceActive$1=!1,electroTrigger=null,electroSound=null,electroCharacter=null,electroMixer$1=null,electroActions$2=null,soundEndTimeout=null,soundDuration=15,shapeKeyControls$2=null,animationSpeedFactor$1=.5,moduleAllAssets=null,walkTimeline=null,isWalkingActive=!1,walkingFollowConfig={direction:new Vector3$1(-1,0,0),followOffset:new Vector3$1(0,.5,4)},isElectroVisible=!1,isRedAlertActive=!1,redVignette=null,shakeIntervalElectro=null,preShakeCameraStateElectro={position:null,target:null},crackRoot=null,crackMeshes=[],crackOriginalMaterials=[],crackRevealMaterials=[],crackRevealTween=null,crackSharedRevealUniform={value:0};function startElectroCloseupRedAlertAndShake(){if(!isRedAlertActive){isRedAlertActive=!0;try{const n=document.createElement("canvas");n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.zIndex="1000",document.body.appendChild(n);const e=n.getContext("2d");n.width=window.innerWidth,n.height=window.innerHeight,redVignette={canvas:n,ctx:e,rafId:null,startTime:performance.now()};const t=()=>{if(!isRedAlertActive||!redVignette)return;const i=(performance.now()-redVignette.startTime)*.004,r=.25+(Math.sin(i)*.5+.5)*.35;e.clearRect(0,0,n.width,n.height);const a=e.createRadialGradient(n.width/2,n.height/2,0,n.width/2,n.height/2,n.width/2);a.addColorStop(0,`rgba(200, 0, 0, ${r*.25})`),a.addColorStop(1,`rgba(255, 0, 0, ${r})`),e.fillStyle=a,e.fillRect(0,0,n.width,n.height),redVignette.rafId=requestAnimationFrame(t)};redVignette.rafId=requestAnimationFrame(t)}catch{}try{currentCamera$3&&(preShakeCameraStateElectro.position=currentCamera$3.position.clone(),currentCamera$3.userData&&currentCamera$3.userData.controls&&currentCamera$3.userData.controls.target?preShakeCameraStateElectro.target=currentCamera$3.userData.controls.target.clone():preShakeCameraStateElectro.target=null);const n=.02,e=.0015;shakeIntervalElectro&&clearInterval(shakeIntervalElectro),shakeIntervalElectro=setInterval(()=>{if(!currentCamera$3)return;const t=n*(.8+Math.random()*.4);currentCamera$3.position.x+=(Math.random()-.5)*t,currentCamera$3.position.y+=(Math.random()-.5)*t,currentCamera$3.position.z+=(Math.random()-.5)*t,currentCamera$3.rotation.x+=(Math.random()-.5)*e,currentCamera$3.rotation.y+=(Math.random()-.5)*e,currentCamera$3.rotation.z+=(Math.random()-.5)*e},50)}catch{}}}function stopElectroCloseupRedAlertAndShake(){if(isRedAlertActive){isRedAlertActive=!1;try{redVignette&&(redVignette.rafId&&cancelAnimationFrame(redVignette.rafId),redVignette.canvas&&redVignette.canvas.parentNode&&redVignette.canvas.parentNode.removeChild(redVignette.canvas),redVignette=null)}catch{}try{shakeIntervalElectro&&(clearInterval(shakeIntervalElectro),shakeIntervalElectro=null)}catch{}}}function stopAllElectroAnimationsBeforeSequence(){var n,e,t;try{electroActions$2&&Object.values(electroActions$2).forEach(i=>{try{i&&i.isRunning&&i.isRunning()&&i.stop()}catch{}});const o=(e=(n=moduleAllAssets==null?void 0:moduleAllAssets.characters)==null?void 0:n.animations)==null?void 0:e.electro;o!=null&&o.actions&&Object.values(o.actions).forEach(i=>{try{i.stop()}catch{}}),o!=null&&o.mixer&&typeof o.mixer.stopAllAction=="function"&&o.mixer.stopAllAction(),(t=electroCharacter==null?void 0:electroCharacter.userData)!=null&&t.zoeActions&&Object.values(electroCharacter.userData.zoeActions).forEach(i=>{try{i&&i.isRunning&&i.isRunning()&&i.stop()}catch{}})}catch{}}function setupElectroActionsMap(n){var t,o,i;const e=((i=(o=(t=n==null?void 0:n.characters)==null?void 0:t.animations)==null?void 0:o.electro)==null?void 0:i.actions)||{};return{arm_gesture:e.ARM_GESTURE,breathing_idle:e.BREATHING_IDLE,entering_code:e.ENTERING_CODE,head_nod_yes:e.HEAD_NOD_YES,jumping:e.JUMPING,landing:e.LANDING,looking_behind:e.LOOKING_BEHIND,opening_on:e["OPENING_ON "],reaching_out:e.REACHING_OUT,running:e.RUNNING,standing_blocking_idle:e.STANDING_BLOCKING_IDLE,talking:e.TALKING,talking_02:e.TALKING_02,thoughtful_head_shake:e["THOUGHTFUL_ HEAD_ SHAKE"],walking:e.WALKING,waving:e.WAVING,SAD_TALKING:e.SAD_TALKING,FALLING:e.FALLING}}function initializeElectro$2(n,e,t,o){var i,s,r;currentCamera$3=t,currentScene$3=n,moduleAllAssets=e,o&&(currentCamera$3.userData=currentCamera$3.userData||{},currentCamera$3.userData.controls=o);try{const a=(s=(i=moduleAllAssets==null?void 0:moduleAllAssets.models)==null?void 0:i.gltf)==null?void 0:s.interior;if(a&&(crackRoot=null,a.traverse(l=>{if(!crackRoot&&typeof l.name=="string"){const c=l.name.toLowerCase();(c==="crack"||c.includes("crack"))&&(crackRoot=l)}}),crackRoot)){crackMeshes.length=0,crackOriginalMaterials.length=0,crackRevealMaterials.length=0;const l=c=>{c.isMesh&&crackMeshes.push(c),c.children&&c.children.length&&c.children.forEach(l)};l(crackRoot),crackMeshes.forEach(c=>{crackOriginalMaterials.push(c.material);const d=Array.isArray(c.material)?c.material[0]:c.material,u=d&&d.map?d.map:null,f=new ShaderMaterial({uniforms:{map:{value:u},reveal:crackSharedRevealUniform,softness:{value:.2},tint:{value:new Color(1,1,1)}},vertexShader:`
              varying vec2 vUv;
              void main() {
                vUv = uv;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
              }
            `,fragmentShader:`
              uniform sampler2D map;
              uniform float reveal; // sliding boundary (start >1, animate to <0)
              uniform float softness; // edge softness (in UV units 0..1)
              uniform vec3 tint;
              varying vec2 vUv;
              void main() {
                vec4 tex = texture2D(map, vUv);
                float edge = smoothstep(0.0, 1.0, (vUv.x - reveal) / max(softness, 1e-5));
                vec4 color = vec4(tex.rgb * tint, tex.a * edge);
                if (color.a < 0.001) discard;
                gl_FragColor = color;
              }
            `,transparent:!0,depthWrite:!1,side:DoubleSide});crackRevealMaterials.push(f),c.visible=!1})}}catch{}if(e.characters.models.electro){electroCharacter=e.characters.models.electro,n.add(electroCharacter),electroCharacter.position.set(-15,10,-141),electroCharacter.rotation.set(0,Math.PI/6,0),electroCharacter.visible=!0,isElectroVisible=!0,electroCharacter.traverse(l=>{l.isMesh&&(l.geometry&&(l.geometry.computeBoundingSphere(),l.geometry.computeBoundingBox()),l.material&&(l.material.needsUpdate=!1,l.material.fog=!1,l.material.flatShading=!0))}),shapeKeyControls$2=setupShapeKeyAnimations(electroCharacter),electroMixer$1=e.characters.animations.electro.mixer,electroMixer$1&&(electroMixer$1.timeScale=1);const a=setupElectroActionsMap(e);electroActions$2={...a,idleAction:a.breathing_idle||a.standing_blocking_idle,walkAction:a.walking||a.running,talkAction:a.talking_02||a.talking},Object.values(a).forEach(l=>{l&&(l.setLoop(LoopOnce),l.clampWhenFinished=!0)}),a.talking_02&&(a.talking_02.timeScale=.5)}return electroSound=e.audios.electroAudio4,electroSound&&((r=electroSound.buffer)!=null&&r.duration?soundDuration=electroSound.buffer.duration:electroSound.duration&&(soundDuration=electroSound.duration),electroSound.setVolume(.8),electroSound.setLoop(!1),electroSound.setPlaybackRate(1)),entryEffect=createEntryEffect(n,new Vector3$1(-13,-1,-134),1.5),e.vfxs.redzone&&(electroTrigger=TriggerPoint(e.vfxs.redzone,{x:-15,y:-.95,z:-142},n,{x:2.5,y:2.5,z:2.5},()=>{hasTriggeredElectro||isSequenceActive$1||!isElectroVisible||(hasTriggeredElectro=!0,hideSceneObjective(),stopAllElectroAnimationsBeforeSequence(),startElectroSequence$2())}),electroTrigger&&typeof electroTrigger.setVFXVisible=="function"&&electroTrigger.setVFXVisible(!0)),{electroTrigger,electroCharacter,electroMixer:electroMixer$1,electroActions:electroActions$2}}function showElectroAndRedzone(){console.log("Showing electro and redzone after Zoe sequence completion"),electroCharacter&&(electroCharacter.visible=!0,isElectroVisible=!0,console.log("Electro character is now visible")),electroTrigger&&typeof electroTrigger.setVFXVisible=="function"&&(electroTrigger.setVFXVisible(!0),console.log("Redzone is now visible"))}function startTalkingLoop(){if(!electroActions$2||!electroActions$2.talking)return;let n=!0,e=3e3,t=1500,o=2e3,i=2e3;function s(){!n||!isSequenceActive$1||(console.log("Playing TALKING animation"),electroActions$2.talking.enabled=!0,electroActions$2.talking.reset(),electroActions$2.talking.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.talking.setEffectiveWeight(1),electroActions$2.talking.fadeIn(.5).play(),setTimeout(()=>{!n||!isSequenceActive$1||(console.log("Playing THOUGHTFUL_HEAD_SHAKE animation"),electroActions$2.talking.fadeOut(.5),electroActions$2.thoughtful_head_shake?(electroActions$2.thoughtful_head_shake.enabled=!0,electroActions$2.thoughtful_head_shake.reset(),electroActions$2.thoughtful_head_shake.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.thoughtful_head_shake.setEffectiveWeight(1),electroActions$2.thoughtful_head_shake.fadeIn(.5).play(),setTimeout(()=>{!n||!isSequenceActive$1||(console.log("Playing HEAD_NOD_YES animation"),electroActions$2.thoughtful_head_shake.fadeOut(.5),electroActions$2.head_nod_yes?(electroActions$2.head_nod_yes.enabled=!0,electroActions$2.head_nod_yes.reset(),electroActions$2.head_nod_yes.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.head_nod_yes.setEffectiveWeight(1),electroActions$2.head_nod_yes.fadeIn(.5).play(),setTimeout(()=>{!n||!isSequenceActive$1||(console.log("Playing TALKING animation again"),electroActions$2.head_nod_yes.fadeOut(.5),electroActions$2.talking?(electroActions$2.talking.enabled=!0,electroActions$2.talking.reset(),electroActions$2.talking.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.talking.setEffectiveWeight(1),electroActions$2.talking.fadeIn(.5).play(),setTimeout(()=>{!n||!isSequenceActive$1||(console.log("Playing ARM_GESTURE animation"),electroActions$2.talking.fadeOut(.5),electroActions$2.arm_gesture?(electroActions$2.arm_gesture.enabled=!0,electroActions$2.arm_gesture.reset(),electroActions$2.arm_gesture.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.arm_gesture.setEffectiveWeight(1),electroActions$2.arm_gesture.fadeIn(.5).play(),setTimeout(()=>{!n||!isSequenceActive$1||(console.log("Transitioning to BREATHING_IDLE loop"),electroActions$2.arm_gesture.fadeOut(.5),electroActions$2.breathing_idle?(electroActions$2.breathing_idle.enabled=!0,electroActions$2.breathing_idle.reset(),electroActions$2.breathing_idle.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.breathing_idle.setEffectiveWeight(1),electroActions$2.breathing_idle.setLoop(LoopRepeat),electroActions$2.breathing_idle.fadeIn(.5).play(),console.log("BREATHING_IDLE animation started, will loop until sound ends")):(console.warn("breathing_idle action not found, falling back to idleAction"),electroActions$2.idleAction&&(electroActions$2.idleAction.enabled=!0,electroActions$2.idleAction.reset(),electroActions$2.idleAction.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.idleAction.setEffectiveWeight(1),electroActions$2.idleAction.setLoop(LoopRepeat),electroActions$2.idleAction.fadeIn(.5).play())))},i)):(console.warn("arm_gesture action not found, transitioning to breathing idle"),electroActions$2.breathing_idle&&(electroActions$2.breathing_idle.enabled=!0,electroActions$2.breathing_idle.reset(),electroActions$2.breathing_idle.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.breathing_idle.setEffectiveWeight(1),electroActions$2.breathing_idle.setLoop(LoopRepeat),electroActions$2.breathing_idle.fadeIn(.5).play())))},e)):(console.warn("talking action not found, transitioning to arm gesture"),electroActions$2.arm_gesture&&(electroActions$2.arm_gesture.enabled=!0,electroActions$2.arm_gesture.reset(),electroActions$2.arm_gesture.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.arm_gesture.setEffectiveWeight(1),electroActions$2.arm_gesture.fadeIn(.5).play())))},o)):(console.warn("head_nod_yes action not found, transitioning to talking"),electroActions$2.talking&&(electroActions$2.talking.enabled=!0,electroActions$2.talking.reset(),electroActions$2.talking.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.talking.setEffectiveWeight(1),electroActions$2.talking.fadeIn(.5).play())))},t)):(console.warn("thoughtful_head_shake action not found, transitioning to jumping"),electroActions$2.jumping&&(electroActions$2.jumping.enabled=!0,electroActions$2.jumping.reset(),electroActions$2.jumping.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.jumping.setEffectiveWeight(1),electroActions$2.jumping.fadeIn(.5).play())))},e))}s(),window.stopTalkingLoop=()=>{n=!1}}window.showElectroAndRedzone=showElectroAndRedzone;function skipElectroSequence$1(){var n,e;if(isSequenceActive$1){console.log("Electro sequence skipped by user."),window.stopTalkingLoop&&window.stopTalkingLoop();try{gsapWithCSS.killTweensOf(currentCamera$3.position),(e=(n=currentCamera$3.userData)==null?void 0:n.controls)!=null&&e.target&&gsapWithCSS.killTweensOf(currentCamera$3.userData.controls.target)}catch{}electroSound&&electroSound.stop(),shapeKeyControls$2&&shapeKeyControls$2.stopAnimation(),stopElectroCloseupRedAlertAndShake(),hideSkipButton(),endElectroSequence()}}function startElectroSequence$2(){var e;if(isSequenceActive$1||!isElectroVisible)return;isSequenceActive$1=!0,window.isElectroSequencePlaying=!0,skipButtonInitialized$2||(createSkipButton(skipElectroSequence$1),skipButtonInitialized$2=!0),showSkipButton(),disablePlayerControls(),togglePlayerControls(!1),disableCameraControls(),setCameraFollowsPlayer(!1),setCameraFocusOnPlayer(!1),hidePlayerModel(),new Vector3$1(-15,0,-141);const n=new Vector3$1(-15,1,-138);(e=currentCamera$3.userData)!=null&&e.controls&&(currentCamera$3.userData.controls.enabled=!1),gsapWithCSS.to(currentCamera$3.position,{x:n.x,y:n.y,z:n.z,duration:1.5,ease:"power2.inOut",onComplete:()=>{var t;(t=currentCamera$3.userData)!=null&&t.controls&&(currentCamera$3.userData.controls.target.set(-15,1,-135),currentCamera$3.userData.controls.update())}}),entryEffect&&entryEffect.trigger(),electroCharacter&&(shapeKeyControls$2&&shapeKeyControls$2.startAnimation(),electroActions$2&&(Object.values(electroActions$2).forEach(t=>{t&&t.isRunning()&&t.stop()}),electroActions$2.arm_gesture?(console.log("Starting ARM_GESTURE animation"),electroActions$2.arm_gesture.enabled=!0,electroActions$2.arm_gesture.reset(),electroActions$2.arm_gesture.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.arm_gesture.setEffectiveWeight(1),electroActions$2.arm_gesture.fadeIn(.5).play(),setTimeout(()=>{console.log("Transitioning to TALKING animation"),electroActions$2.arm_gesture.fadeOut(.5),electroActions$2.talking?(electroActions$2.talking.enabled=!0,electroActions$2.talking.reset(),electroActions$2.talking.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.talking.setEffectiveWeight(1),electroActions$2.talking.fadeIn(.5).play(),startTalkingLoop()):(console.warn("talking action not found, falling back to talking_02"),electroActions$2.talking_02&&(electroActions$2.talking_02.enabled=!0,electroActions$2.talking_02.reset(),electroActions$2.talking_02.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.talking_02.setEffectiveWeight(1),electroActions$2.talking_02.fadeIn(.5).play()))},2e3)):(console.warn("arm_gesture action not found, starting with talking"),electroActions$2.talking&&(electroActions$2.talking.enabled=!0,electroActions$2.talking.reset(),electroActions$2.talking.setEffectiveTimeScale(animationSpeedFactor$1),electroActions$2.talking.setEffectiveWeight(1),electroActions$2.talking.fadeIn(.5).play()))),electroSound&&(electroSound.play(),soundEndTimeout&&clearTimeout(soundEndTimeout),soundEndTimeout=setTimeout(()=>{endElectroSequence()},soundDuration*1e3+500),electroSound.onEnded=()=>{soundEndTimeout&&clearTimeout(soundEndTimeout),endElectroSequence()}))}function endElectroSequence(){if(window.stopTalkingLoop&&window.stopTalkingLoop(),hideSkipButton(),electroTrigger&&electroTrigger.removeParticleEffects(),shapeKeyControls$2&&shapeKeyControls$2.stopAnimation(),electroCharacter){const n=currentScene$3.getObjectByName("playerCapsule")||currentScene$3.getObjectByName("player");n&&(electroCharacter.visible=!0,electroCharacter.position.set(n.position.x-2,n.position.y-1,n.position.z),electroCharacter.rotation.set(0,Math.PI/2,0))}electroSound&&electroSound.stop(),soundEndTimeout&&(clearTimeout(soundEndTimeout),soundEndTimeout=null),isSequenceActive$1=!1,hasTriggeredElectro=!1,currentScene$3&&currentScene$3.traverse(n=>{(n.name==="playerCapsule"||n.parent&&n.parent.name==="playerCapsule"||n.name==="player"||n.parent&&n.parent.name==="player")&&(n.visible=!0,n.isLight&&(n.intensity=1))}),startWalkingSequenceThenFall()}function updateElectro$2(n,e){var t,o;if(e){if(electroMixer$1&&electroMixer$1.update(n),electroTrigger&&electroTrigger.updateQuarksScene(n,e),isWalkingActive&&currentCamera$3&&e){const i=walkingFollowConfig.direction||new Vector3$1(-1,0,0),s=walkingFollowConfig.followOffset||new Vector3$1(0,.5,4),r=i.clone().multiplyScalar(-s.z),a=new Vector3$1(0,s.y,0),l=new Vector3$1;l.crossVectors(new Vector3$1(0,1,0),i).normalize().multiplyScalar(s.x);const c=e.position.clone().add(r).add(a).add(l);currentCamera$3.position.lerp(c,.2),(t=currentCamera$3.userData)!=null&&t.controls?(currentCamera$3.userData.controls.target.copy(e.position),currentCamera$3.userData.controls.update()):currentCamera$3.lookAt(e.position);try{updatePlayerAnimation(!0,!1)}catch{}return}if(!isWalkingActive&&isSequenceActive$1&&(electroCharacter!=null&&electroCharacter.visible)&&isElectroVisible){const i=new Vector3$1(-15,1,-141);if(currentCamera$3&&(currentCamera$3.lookAt(i),(o=currentCamera$3.userData)!=null&&o.controls&&(currentCamera$3.userData.controls.target.copy(i),currentCamera$3.userData.controls.update())),electroCharacter){const s=new Vector3$1;s.subVectors(currentCamera$3.position,electroCharacter.position).normalize();const r=Math.atan2(s.x,s.z);electroCharacter.rotation.y=r}}}}function cleanupElectro$2(){window.showElectroAndRedzone&&delete window.showElectroAndRedzone,walkTimeline&&(walkTimeline.kill(),walkTimeline=null),hideSkipButton();try{stopElectroCloseupRedAlertAndShake()}catch{}try{if(crackRevealTween&&(crackRevealTween.kill(),crackRevealTween=null),crackMeshes&&crackMeshes.length)for(let n=0;n<crackMeshes.length;n++)try{if(crackMeshes[n].visible=!1,crackOriginalMaterials&&crackOriginalMaterials[n]&&(crackMeshes[n].material=crackOriginalMaterials[n]),crackRevealMaterials&&crackRevealMaterials[n])try{crackRevealMaterials[n].dispose&&crackRevealMaterials[n].dispose()}catch{}}catch{}}catch{}window.isElectroSequencePlaying=!1,electroCharacter&&currentScene$3&&(electroCharacter.traverse(n=>{n.isMesh&&(n.geometry&&n.geometry.dispose(),n.material&&(Array.isArray(n.material)?n.material.forEach(e=>e.dispose()):n.material.dispose()))}),currentScene$3.remove(electroCharacter),electroCharacter=null),electroSound&&(electroSound.stop(),electroSound=null),soundEndTimeout&&(clearTimeout(soundEndTimeout),soundEndTimeout=null)}function startWalkingSequenceThenFall(){const n=currentScene$3.getObjectByName("playerCapsule")||currentScene$3.getObjectByName("player");if(!n||!electroCharacter||!currentCamera$3){proceedToFallingSequence();return}showPlayerModel(),enableCameraControls(),setCameraFollowsPlayer(!1),setCameraFocusOnPlayer(!1);try{n.rotation.set(0,Math.PI/2,0)}catch{}try{const l=electroCharacter.position.clone().add(new Vector3$1(-1,0,0));electroCharacter.lookAt(l)}catch{}if(electroActions$2&&electroActions$2.walkAction)try{electroActions$2.walkAction.enabled=!0,electroActions$2.walkAction.reset(),electroActions$2.walkAction.setLoop(LoopRepeat),electroActions$2.walkAction.setEffectiveTimeScale(animationSpeedFactor$1*.8),electroActions$2.walkAction.setEffectiveWeight(1),electroActions$2.walkAction.fadeIn(.3).play()}catch{}else if(electroActions$2&&electroActions$2.walking)try{electroActions$2.walking.enabled=!0,electroActions$2.walking.reset(),electroActions$2.walking.setLoop(LoopRepeat),electroActions$2.walking.setEffectiveTimeScale(animationSpeedFactor$1*.8),electroActions$2.walking.setEffectiveWeight(1),electroActions$2.walking.fadeIn(.3).play()}catch{}try{updatePlayerAnimation(!0,!1),window.THREE&&window.THREE.AnimationMixer}catch{}const e=new Vector3$1(-1,0,0);walkingFollowConfig.direction.copy(e),walkingFollowConfig.followOffset.set(0,.3,2.5);const o=e.clone().multiplyScalar(14),i=n.position.clone(),s=electroCharacter.position.clone().add(new Vector3$1(0,0,1.5)),r=i.clone().add(o);s.clone().add(o);const a=new Vector3$1(0,.3,2.5);isWalkingActive=!0,walkTimeline&&(walkTimeline.kill(),walkTimeline=null),walkTimeline=gsapWithCSS.timeline({onComplete:()=>{isWalkingActive=!1;try{electroActions$2!=null&&electroActions$2.walkAction&&electroActions$2.walkAction.fadeOut(.2),electroActions$2!=null&&electroActions$2.walking&&electroActions$2.walking.fadeOut(.2)}catch{}try{updatePlayerAnimation(!1,!1)}catch{}proceedToFallingSequence()},onStop:()=>{isWalkingActive=!1;try{updatePlayerAnimation(!1,!1)}catch{}}}),walkTimeline.to(n.position,{x:r.x,y:r.y,z:r.z,duration:4.5,ease:"power1.inOut",onUpdate:()=>{var h;const l=n.position.clone().sub(i);electroCharacter.position.copy(s.clone().add(l));const c=e.clone().multiplyScalar(-a.z),d=new Vector3$1(0,a.y,0),u=new Vector3$1;u.crossVectors(new Vector3$1(0,1,0),e).normalize().multiplyScalar(a.x);const f=n.position.clone().add(c).add(d).add(u);currentCamera$3.position.lerp(f,.15),(h=currentCamera$3.userData)!=null&&h.controls?(currentCamera$3.userData.controls.target.copy(n.position),currentCamera$3.userData.controls.update()):currentCamera$3.lookAt(n.position);try{updatePlayerAnimation(!0,!1)}catch{}}},0)}function proceedToFallingSequence(){var t;const n=moduleAllAssets.audios.fallsound;n&&n.play();const e=currentScene$3.getObjectByName("playerCapsule")||currentScene$3.getObjectByName("player");if(e&&currentCamera$3){const o=electroCharacter||e;console.log("Camera close-up to Electro after walking sequence",{focusName:o.name||"unknown",focusPosition:o.position.clone(),previousCameraPosition:currentCamera$3.position.clone()});try{startElectroCloseupRedAlertAndShake()}catch{}const i=new Vector3$1(-.8,.8,-1),s=new Vector3$1(0,.8,0);currentCamera$3.position.copy(o.position).add(i),(t=currentCamera$3.userData)!=null&&t.controls?(currentCamera$3.userData.controls.target.copy(o.position.clone().add(s)),currentCamera$3.userData.controls.update()):currentCamera$3.lookAt(o.position.clone().add(s)),setTimeout(()=>{var r;try{const a=o.position.clone().add(new Vector3$1(0,-1.2,0));if((r=currentCamera$3.userData)!=null&&r.controls&&currentCamera$3.userData.controls.target){const l=currentCamera$3.userData.controls.target;gsapWithCSS.to(l,{x:a.x,y:a.y,z:a.z,duration:.9,ease:"power2.inOut",onUpdate:()=>{currentCamera$3.userData.controls.update()}})}else{const l={t:0};gsapWithCSS.to(l,{t:1,duration:.9,ease:"power2.inOut",onUpdate:()=>{currentCamera$3.lookAt(a)}})}}catch{}try{if(crackMeshes&&crackMeshes.length&&crackRevealMaterials&&crackRevealMaterials.length){crackSharedRevealUniform.value=1.2;for(let a=0;a<crackMeshes.length;a++)try{crackMeshes[a].material=crackRevealMaterials[a],crackMeshes[a].visible=!0}catch{}if(crackRevealTween){try{crackRevealTween.kill()}catch{}crackRevealTween=null}crackRevealTween=gsapWithCSS.to(crackSharedRevealUniform,{value:-.2,duration:2,ease:"linear"})}}catch{}},2e3)}setTimeout(()=>{try{stopElectroCloseupRedAlertAndShake()}catch{}electroCharacter&&(electroCharacter.visible=!1);try{if(crackRevealTween&&(crackRevealTween.kill(),crackRevealTween=null),crackMeshes&&crackMeshes.length)for(let i=0;i<crackMeshes.length;i++)try{crackMeshes[i].visible=!1}catch{}}catch{}const o=currentScene$3.getObjectByName("playerCapsule")||currentScene$3.getObjectByName("player");startMainFallingSequence(currentScene$3,currentCamera$3,o,electroCharacter),window.dispatchEvent(new CustomEvent("electroSequenceComplete",{detail:{timestamp:Date.now()}})),switchToScene4AfterDelay(3500),window.isElectroSequencePlaying=!1},4e3)}let hasTriggeredZoe=!1,zoeCharacter=null,zoeMixer=null,zoeActions=null,zoeTrigger=null,zoeSound=null,currentCamera$2=null,currentScene$2=null,currentControls=null,currentPlayer=null,playerPosition=new Vector3$1,isSequenceActive=!1,zoeSoundDuration=15,electroSoundDuration=3,zoeSound1Duration=12,zoeSound11Duration=16,animationSpeedFactor=1;const cameraFocusMoveDuration=2.5,animationCrossFadeDuration=.6;let skipButtonInitialized$1=!1,isSequenceSkipped$1=!1,isAutoMoving=!1,autoMoveDistance=0,autoMoveCallback=null;const AUTO_MOVE_CONFIG$1={maxDistance:2,speed:.8};let isAutoMoveCameraAnimating=!1,autoMoveCameraOriginal={position:null,target:null},autoMoveLookRaf=null,autoMoveLookAtTarget=null,autoMoveReturnTimer=null,_prevControlsDamping=null;function zoomToElectroThenReturn(){if(currentCamera$2)try{if(autoMoveCameraOriginal.position||(autoMoveCameraOriginal.position=currentCamera$2.position.clone()),!autoMoveCameraOriginal.target)if(currentControls&&currentControls.target)autoMoveCameraOriginal.target=currentControls.target.clone();else{const t=new Vector3$1(0,0,-1).applyQuaternion(currentCamera$2.quaternion);autoMoveCameraOriginal.target=currentCamera$2.position.clone().add(t)}currentControls&&(_prevControlsDamping={enabled:currentControls.enableDamping,factor:currentControls.dampingFactor},currentControls.enableDamping=!1,currentControls.dampingFactor=0);const n=new Vector3$1(-8.222,.979,-131.244),e=new Vector3$1(-15,.6,-141);currentControls&&currentControls.target&&(currentControls.target.set(e.x,e.y,e.z),currentControls.update&&currentControls.update()),gsapWithCSS.to(currentCamera$2.position,{x:n.x,y:n.y,z:n.z,duration:.6,ease:"power2.inOut",onUpdate:()=>{currentCamera$2.lookAt(e)},onComplete:()=>{autoMoveReturnTimer=setTimeout(()=>{gsapWithCSS.to(currentCamera$2.position,{x:autoMoveCameraOriginal.position.x,y:autoMoveCameraOriginal.position.y,z:autoMoveCameraOriginal.position.z,duration:.8,ease:"power2.inOut",onComplete:()=>{isAutoMoveCameraAnimating=!1,autoMoveCameraOriginal.position=null,autoMoveCameraOriginal.target=null,autoMoveLookAtTarget=null,autoMoveReturnTimer=null,currentControls&&_prevControlsDamping&&(currentControls.enableDamping=_prevControlsDamping.enabled,currentControls.dampingFactor=_prevControlsDamping.factor),_prevControlsDamping=null;try{typeof playElectroBreathingIdleAction=="function"&&playElectroBreathingIdleAction()}catch{}if(typeof autoMoveCallback=="function"){const o=autoMoveCallback;autoMoveCallback=null,o()}}}),currentControls&&currentControls.target&&autoMoveCameraOriginal.target&&gsapWithCSS.to(currentControls.target,{x:autoMoveCameraOriginal.target.x,y:autoMoveCameraOriginal.target.y,z:autoMoveCameraOriginal.target.z,duration:.8,ease:"power2.inOut",onUpdate:()=>{currentControls.update&&currentControls.update()}})},3800)}})}catch(n){if(console.warn("Failed during zoom/return sequence:",n),isAutoMoveCameraAnimating=!1,typeof autoMoveCallback=="function"){const e=autoMoveCallback;autoMoveCallback=null,e()}}}function startAutoMoveCameraSequence(){if(currentCamera$2)try{isAutoMoveCameraAnimating=!0;const n=new Vector3$1(-15,0,-141),e=currentControls&&currentControls.target?currentControls.target.clone():currentCamera$2.position.clone().add(new Vector3$1(0,0,-1).applyQuaternion(currentCamera$2.quaternion)),t=2500,o=performance.now(),i=r=>r<.5?4*r*r*r:1-Math.pow(-2*r+2,3)/2,s=()=>{const r=performance.now(),a=r-o,l=Math.min(a/t,1),c=i(l),d=e.clone().lerp(n,c),f=.12*(1-c),h=Math.sin(r*.0021)*f,m=Math.sin(r*.0033+1.2)*f*.6,p=Math.sin(r*.0017+.6)*f*.4,v=d.clone().add(new Vector3$1(h,m,p));currentControls&&currentControls.target?(currentControls.target.copy(v),currentControls.update&&currentControls.update()):currentCamera$2.lookAt(v),l<1&&isAutoMoveCameraAnimating?autoMoveLookRaf=requestAnimationFrame(s):(currentControls&&currentControls.target?(currentControls.target.copy(n),currentControls.update&&currentControls.update()):currentCamera$2.lookAt(n),autoMoveLookRaf&&cancelAnimationFrame(autoMoveLookRaf),autoMoveLookRaf=null,zoomToElectroThenReturn())};autoMoveLookRaf&&cancelAnimationFrame(autoMoveLookRaf),autoMoveLookRaf=requestAnimationFrame(s)}catch(n){if(console.warn("Failed to turn camera towards Electro:",n),isAutoMoveCameraAnimating=!1,typeof autoMoveCallback=="function"){const e=autoMoveCallback;autoMoveCallback=null,e()}}}function stopAllElectroActions(){try{zoeElectroCharacter&&zoeElectroCharacter.userData&&zoeElectroCharacter.userData.zoeActions&&Object.values(zoeElectroCharacter.userData.zoeActions).forEach(n=>{n&&n.isRunning&&n.isRunning()&&n.stop()})}catch{}}function playElectroTalking02Action(){try{if(!zoeElectroCharacter||!zoeElectroCharacter.userData||!zoeElectroCharacter.userData.zoeActions)return;const n=zoeElectroCharacter.userData.zoeActions.talking_02;if(!n)return;zoeElectroCharacter.visible=!0,stopAllElectroActions(),n.reset(),n.setLoop(LoopRepeat),n.clampWhenFinished=!1,n.fadeIn(.3).play()}catch{}}function playElectroBreathingIdleAction(){try{if(!zoeElectroCharacter||!zoeElectroCharacter.userData||!zoeElectroCharacter.userData.zoeActions)return;const n=zoeElectroCharacter.userData.zoeActions.breathing_idle;if(!n)return;zoeElectroCharacter.visible=!0,stopAllElectroActions(),n.reset(),n.setLoop(LoopRepeat),n.clampWhenFinished=!1,n.fadeIn(.3).play()}catch{}}let postZoeTrigger=null;function skipZoeSequence(){var n,e,t,o,i;if(isSequenceActive){console.log("Zoe sequence skipped by user."),isSequenceSkipped$1=!0;try{gsapWithCSS.killTweensOf(currentCamera$2.position),currentControls&&currentControls.target&&gsapWithCSS.killTweensOf(currentControls.target),gsapWithCSS.killTweensOf(zoeCharacter.position),gsapWithCSS.killTweensOf(zoeElectroCharacter.position),gsapWithCSS.killTweensOf(zoeElectroCharacter.rotation),gsapWithCSS.killTweensOf([]),gsapWithCSS.globalTimeline.clear(),window.zoeTimeline&&(window.zoeTimeline.kill(),window.zoeTimeline=null)}catch{}try{zoeSound&&zoeSound.isPlaying&&zoeSound.stop(),(n=allAssets$3==null?void 0:allAssets$3.audios)!=null&&n.electrosound1&&allAssets$3.audios.electrosound1.isPlaying&&allAssets$3.audios.electrosound1.stop(),(e=allAssets$3==null?void 0:allAssets$3.audios)!=null&&e.zoesound11&&allAssets$3.audios.zoesound11.isPlaying&&allAssets$3.audios.zoesound11.stop(),(t=allAssets$3==null?void 0:allAssets$3.audios)!=null&&t.zoesound1&&allAssets$3.audios.zoesound1.isPlaying&&allAssets$3.audios.zoesound1.stop(),(o=allAssets$3==null?void 0:allAssets$3.audios)!=null&&o.electrosound2&&allAssets$3.audios.electrosound2.isPlaying&&allAssets$3.audios.electrosound2.stop(),shakeSound&&shakeSound.isPlaying&&shakeSound.stop(),(i=allAssets$3==null?void 0:allAssets$3.audios)!=null&&i.electroLookat&&allAssets$3.audios.electroLookat.isPlaying&&allAssets$3.audios.electroLookat.stop()}catch{}try{zoeActions&&Object.values(zoeActions).forEach(s=>{s&&s.isRunning()&&s.stop()})}catch{}try{zoeElectroCharacter&&zoeElectroCharacter.userData.zoeActions&&Object.values(zoeElectroCharacter.userData.zoeActions).forEach(s=>{s&&s.isRunning()&&s.stop()})}catch{}try{zoeShapeKeyControls&&zoeShapeKeyControls.stopAnimation()}catch{}try{hudVideoPlane$2&&hudVideoPlane$2.userData.video&&(hudVideoPlane$2.userData.video.pause(),hudVideoPlane$2.userData.video.currentTime=0,hudVideoPlane$2.visible=!1,hudVideoPlane$2.userData._updateInterval&&(clearInterval(hudVideoPlane$2.userData._updateInterval),hudVideoPlane$2.userData._updateInterval=null))}catch{}stopEyeBlinking(),stopCameraFocusOnZoe(),stopVignetteAndShake(),isAutoMoving=!1,autoMoveDistance=0;try{for(let s=1;s<1e4;s++)clearTimeout(s);for(let s=1;s<1e4;s++)clearInterval(s);autoMoveReturnTimer&&(clearTimeout(autoMoveReturnTimer),autoMoveReturnTimer=null),autoMoveLookRaf&&(cancelAnimationFrame(autoMoveLookRaf),autoMoveLookRaf=null),cameraFocusInterval&&(clearInterval(cameraFocusInterval),cameraFocusInterval=null)}catch{}try{if(zoeElectroCharacter&&zoeElectroCharacter.userData.originalState){const s=zoeElectroCharacter.userData.originalState;zoeElectroCharacter.position.copy(s.position),zoeElectroCharacter.rotation.copy(s.rotation),zoeElectroCharacter.visible=s.visible}}catch{}hideSkipButton(),endZoeSequence()}}let vignetteEffect$1=null,isVignetteActive=!1,shakeIntensity=.3,shakeDuration=0,shakeStartTime=0,shakeInterval=null,shakeSound=null,preShakeCameraState={position:null,target:null},shakeAngleTimeouts=[];const SHAKE_CAMERA_ANGLES=[new Vector3$1(42,3,-55),new Vector3$1(50,2,-70)];let isEyeBlinking=!1,nextBlinkDelay=0,cameraFocusInterval=null,allAssets$3=null,zoeElectroCharacter=null,zoeElectroMixer=null,originalElectroVisible=!1,hudVideoPlane$2=null,tvScreenMesh=null,zoeShapeKeyControls=null;function initializeZoe(n,e,t,o,i){var r,a,l,c,d;currentCamera$2=t,currentScene$2=n,allAssets$3=e,currentControls=i,currentPlayer=n.getObjectByName("playerCapsule")||n.getObjectByName("player");try{const u=(a=(r=allAssets$3==null?void 0:allAssets$3.models)==null?void 0:r.gltf)==null?void 0:a.interior;u&&(tvScreenMesh=u.getObjectByName("tv"),tvScreenMesh||u.traverse(f=>{!tvScreenMesh&&f.isMesh&&typeof f.name=="string"&&f.name.toLowerCase().includes("tv")&&(tvScreenMesh=f)}),tvScreenMesh&&(tvScreenMesh.visible=!1))}catch(u){console.warn("Could not initialize TV mesh visibility:",u)}zoeCharacter=e.characters.models.zoe,n.add(zoeCharacter),zoeCharacter.scale.set(1.3,1.3,1.3),zoeCharacter.position.set(84,-4.45,-60),zoeCharacter.rotation.set(0,-Math.PI/2,0),zoeCharacter.visible=!0,zoeMixer=e.characters.animations.zoe.mixer;const s=e.characters.animations.zoe.actions;if(zoeActions={idleAction:s.Idle_Armature_Armature,walkAction:s.Walk_Armature_Armature,talkAction:s.wexplain,wcircleAction:s.wcircle_action,eyesAction:s.eyesAction,recordAction:s.record_action},!zoeActions.idleAction||!zoeActions.walkAction||!zoeActions.talkAction||!zoeActions.wcircleAction)return console.error("Zoe animations not found. Available animations:",Object.keys(s)),console.error("Missing animations:",{idleAction:!!zoeActions.idleAction,walkAction:!!zoeActions.walkAction,talkAction:!!zoeActions.talkAction,wcircleAction:!!zoeActions.wcircleAction}),null;if(console.log("Zoe animations loaded successfully:",{idleAction:zoeActions.idleAction.name||"unnamed",walkAction:zoeActions.walkAction.name||"unnamed",talkAction:zoeActions.talkAction.name||"unnamed",wcircleAction:zoeActions.wcircleAction.name||"unnamed"}),Object.entries(zoeActions).forEach(([u,f])=>{f&&(u==="eyesAction"?f.timeScale=1:u==="recordAction"?f.timeScale=.5:f.timeScale=animationSpeedFactor)}),zoeActions.walkAction&&(zoeActions.walkAction.timeScale=.7),zoeSound=e.audios.zoesound,e.audios&&(zoeSoundDuration=((l=e.audios.zoesound)==null?void 0:l.duration)||15,electroSoundDuration=((c=e.audios.electrosound1)==null?void 0:c.duration)||3,zoeSound1Duration=((d=e.audios.zoesound1)==null?void 0:d.duration)||12),zoeTrigger=TriggerPoint(e.vfxs.vfx,{x:75,y:-5.5,z:-60},n,{x:2,y:2,z:2},()=>{if(!(hasTriggeredZoe||isSequenceActive)){hasTriggeredZoe=!0,console.log("Player has reached Zoe's location! Player position:",playerPosition);try{hideSceneObjective()}catch{}startZoeSequence()}}),zoeTrigger&&zoeTrigger.effect1&&(zoeTrigger.effect1.scale.set(.2,.2,.2),zoeTrigger.effect1.emitters&&zoeTrigger.effect1.emitters.forEach(u=>{u.scale&&u.scale.multiplyScalar(.2),u.velocity&&u.velocity.multiplyScalar(.2),u.size&&u.size.multiplyScalar(.2)})),setTimeout(()=>{if(zoeCharacter){Object.values(zoeActions).forEach(u=>{u&&(u.reset(),u.paused=!0)});try{startZoeIdle()}catch{zoeActions.idleAction&&!zoeActions.idleAction.isRunning()&&(zoeActions.idleAction.reset(),zoeActions.idleAction.setLoop(LoopRepeat),zoeActions.idleAction.clampWhenFinished=!1,zoeActions.idleAction.paused=!1,zoeActions.idleAction.fadeIn(.3).play())}}},100),shakeSound=e.audios.shakesound,shakeSound&&(shakeSound.setVolume(.3),shakeSound.setLoop(!0),shakeSound.setRefDistance(20),shakeSound.setRolloffFactor(2)),e.characters&&e.characters.models.electro){zoeElectroCharacter=e.characters.models.electro,originalElectroVisible=zoeElectroCharacter.visible,e.characters.animations.electro&&(zoeElectroMixer=new AnimationMixer(zoeElectroCharacter),zoeElectroCharacter.userData.zoeActions={},Object.entries({arm_gesture:"ARM_GESTURE",breathing_idle:"BREATHING_IDLE",entering_code:"ENTERING_CODE",head_nod_yes:"HEAD_NOD_YES",jumping:"JUMPING",landing:"LANDING",looking_behind:"LOOKING_BEHIND",opening_on:"OPENING_ON ",reaching_out:"REACHING_OUT",running:"RUNNING",standing_blocking_idle:"STANDING_BLOCKING_IDLE",talking:"TALKING",talking_02:"TALKING_02",thoughtful_head_shake:"THOUGHTFUL_ HEAD_ SHAKE",walking:"WALKING",waving:"WAVING",SAD_TALKING:"SAD_TALKING",FALLING:"FALLING"}).forEach(([f,h])=>{const m=e.characters.animations.electro.actions[h];if(m){const p=zoeElectroMixer.clipAction(m.getClip());p.setEffectiveTimeScale(animationSpeedFactor),p.setLoop(LoopOnce),p.clampWhenFinished=!0,zoeElectroCharacter.userData.zoeActions[f]=p}}),zoeElectroCharacter.userData.zoeActions.talking_02&&(zoeElectroCharacter.userData.zoeActions.talking_02.timeScale=1));try{zoeShapeKeyControls=setupShapeKeyAnimations(zoeElectroCharacter)}catch{zoeShapeKeyControls=null}}return{zoeCharacter,zoeTrigger,zoeMixer,zoeActions}}function startZoeSequence(){if(!isSequenceActive){if(isSequenceActive=!0,isSequenceSkipped$1=!1,console.log("Starting Zoe sequence"),skipButtonInitialized$1||(createSkipButton(skipZoeSequence),skipButtonInitialized$1=!0),showSkipButton(),createVignetteEffect$2(),disablePlayerControls(),togglePlayerControls(!1),disableCameraControls(),currentControls&&(currentControls.enabled=!1),setCameraFollowsPlayer(!1),setCameraFocusOnPlayer(!1),hidePlayerModel(),zoeCharacter&&currentCamera$2){currentCamera$2.userData.originalPosition=currentCamera$2.position.clone(),currentControls&&currentControls.target&&(currentCamera$2.userData.originalControlsTarget=currentControls.target.clone());const n=new Vector3$1(79,-2.7,-60),e=new Vector3$1(82,-2.7,-60);setTimeout(()=>{gsapWithCSS.to(currentCamera$2.position,{x:n.x,y:n.y,z:n.z,duration:cameraFocusMoveDuration,ease:"power2.inOut",onUpdate:()=>{currentCamera$2.lookAt(e)}}),currentControls&&currentControls.target&&gsapWithCSS.to(currentControls.target,{x:e.x,y:e.y,z:e.z,duration:cameraFocusMoveDuration,ease:"power2.inOut"})},100)}console.log("Preparing Zoe"),Object.entries(zoeActions).forEach(([n,e])=>{e&&n!=="idleAction"&&(e.isRunning()&&(e.stop(),console.log("Stopped running animation:",e.name||"unnamed")),e.reset(),e.paused=!0)}),setTimeout(()=>{if(zoeActions.walkAction){zoeActions.walkAction.reset(),zoeActions.walkAction.setLoop(LoopOnce),zoeActions.walkAction.clampWhenFinished=!0,zoeActions.walkAction.enabled=!0;const r=zoeActions.idleAction&&zoeActions.idleAction.isRunning()?zoeActions.idleAction:null;r?zoeActions.walkAction.crossFadeFrom(r,animationCrossFadeDuration,!1).play():zoeActions.walkAction.fadeIn(.2).play(),console.log("Started walking animation with crossfade from idle"),setTimeout(()=>{zoeActions.walkAction.isRunning()?console.log("Walk animation successfully started"):console.warn("Walk animation failed to start"),zoeActions.idleAction&&zoeActions.idleAction.isRunning()&&zoeActions.idleAction.stop()},animationCrossFadeDuration*1e3+50)}const n=[new Vector3$1(84,-4.45,-60),new Vector3$1(81.5,-4.45,-60)],e=n[0].clone(),t=n[1].clone(),o=2.8,i=Date.now();function s(){if(!isSequenceActive||!zoeCharacter.visible)return;const r=(Date.now()-i)/1e3,a=Math.min(r/o,1);zoeCharacter.position.lerpVectors(e,t,a),a<1?requestAnimationFrame(s):(zoeTrigger&&zoeTrigger.removeParticleEffects(),zoeActions.talkAction&&zoeActions.walkAction?(zoeActions.idleAction&&zoeActions.idleAction.isRunning()&&(zoeActions.idleAction.stop(),console.log("Stopped idle animation during walk-to-talk transition")),zoeActions.talkAction.reset(),zoeActions.talkAction.enabled=!0,zoeActions.talkAction.crossFadeFrom(zoeActions.walkAction,animationCrossFadeDuration,!1).play(),setTimeout(()=>{zoeActions.walkAction&&zoeActions.walkAction.isRunning()&&(zoeActions.walkAction.stop(),console.log("Stopped walk animation after crossfade"))},animationCrossFadeDuration*1e3+50)):zoeActions.talkAction&&(zoeActions.idleAction&&zoeActions.idleAction.isRunning()&&(zoeActions.idleAction.stop(),console.log("Stopped idle animation before talk")),zoeActions.talkAction.reset(),zoeActions.talkAction.fadeIn(.3).play()),["eyesAction","recordAction"].forEach(l=>{zoeActions[l]&&(zoeActions[l].paused=!1,zoeActions[l].play())}),startEyeBlinking(),startCameraFocusOnZoe(),zoeSound&&(console.log("Playing Zoe's first sound"),zoeSound.play(),setTimeout(()=>{if(!isSequenceSkipped$1){if(console.log("Zoe's first sound finished, moving to Electro"),zoeElectroCharacter){const l=zoeElectroCharacter.position.clone(),c=zoeElectroCharacter.rotation.clone();zoeElectroCharacter.visible=!0,zoeElectroCharacter.position.set(81,-4.45,-63),zoeElectroCharacter.rotation.set(0,-Math.PI/2,0);try{zoeShapeKeyControls&&zoeShapeKeyControls.startAnimation()}catch{}zoeElectroCharacter.userData.zoeActions&&zoeElectroCharacter.userData.zoeActions.talking&&(zoeElectroCharacter.userData.zoeActions.talking.reset(),zoeElectroCharacter.userData.zoeActions.talking.setLoop(LoopRepeat),zoeElectroCharacter.userData.zoeActions.talking.clampWhenFinished=!1,zoeElectroCharacter.userData.zoeActions.talking.fadeIn(.5).play()),zoeElectroCharacter.userData.originalState={position:l,rotation:c,visible:originalElectroVisible}}if(window.isElectroSequencePlaying=!0,currentCamera$2&&(currentCamera$2.position.set(80,-3.8,-63),currentCamera$2.lookAt(new Vector3$1(81,-3.6,-63)),currentControls&&currentControls.target&&currentControls.target.set(81,-4,-63)),allAssets$3&&allAssets$3.audios&&allAssets$3.audios.electrosound1){console.log("Playing Electro's sound");const l=allAssets$3.audios.electrosound1;["talkAction","eyesAction","recordAction"].forEach(c=>{zoeActions[c]&&zoeActions[c].isRunning()&&(zoeActions[c].paused=!0)}),stopEyeBlinking(),l.play(),setTimeout(()=>{if(!isSequenceSkipped$1){if(console.log("Electro's sound finished, returning to Zoe"),zoeElectroCharacter&&zoeElectroCharacter.userData.originalState){const c=zoeElectroCharacter.userData.originalState;zoeElectroCharacter.position.copy(c.position),zoeElectroCharacter.rotation.copy(c.rotation),zoeElectroCharacter.visible=c.visible;try{zoeShapeKeyControls&&zoeShapeKeyControls.stopAnimation()}catch{}zoeElectroCharacter.userData.zoeActions&&Object.values(zoeElectroCharacter.userData.zoeActions).forEach(d=>{d.isRunning()&&d.stop()})}if(currentCamera$2&&(currentCamera$2.position.set(79.5,-2.5,-60),currentCamera$2.lookAt(new Vector3$1(82,-2.5,-60)),currentControls&&currentControls.target&&currentControls.target.set(82,-2.5,-60)),["talkAction","eyesAction","recordAction"].forEach(c=>{zoeActions[c]&&(zoeActions[c].paused=!1)}),startEyeBlinking(),allAssets$3&&allAssets$3.audios&&allAssets$3.audios.zoesound11){console.log("Playing Zoe's sound11"),allAssets$3.audios.zoesound11.play();const d=zoeSound11Duration*1e3/2;setTimeout(()=>{isSequenceSkipped$1||(console.log("Playing wcircle_action animation"),zoeActions.wcircleAction&&(["talkAction","eyesAction","recordAction"].forEach(u=>{zoeActions[u]&&zoeActions[u].isRunning()&&(zoeActions[u].paused=!0)}),stopEyeBlinking(),hudVideoPlane$2||(console.log("Creating HUD video TV material"),hudVideoPlane$2=createHUDVideoPlane()),hudVideoPlane$2&&hudVideoPlane$2.userData.loadPromise.then(()=>{const u=hudVideoPlane$2.userData.video;hudVideoPlane$2.visible=!0,u.currentTime=0,u.play().catch(f=>{console.warn("TV video play failed:",f)}),u.addEventListener("ended",()=>{hudVideoPlane$2&&(hudVideoPlane$2.visible=!1,u.currentTime=0,u.pause())}),u.loop=!1}).catch(()=>{if(hudVideoPlane$2)try{hudVideoPlane$2.userData&&hudVideoPlane$2.userData.originalMaterial&&(hudVideoPlane$2.material=hudVideoPlane$2.userData.originalMaterial),hudVideoPlane$2.visible=!1}catch{}}),zoeActions.wcircleAction.reset(),zoeActions.wcircleAction.setLoop(LoopOnce),zoeActions.wcircleAction.clampWhenFinished=!0,zoeActions.wcircleAction.fadeIn(.5).play(),setTimeout(()=>{isSequenceSkipped$1||(zoeActions.wcircleAction.isRunning()&&(zoeActions.wcircleAction.paused=!0),["talkAction","eyesAction","recordAction"].forEach(u=>{zoeActions[u]&&(zoeActions[u].paused=!1)}),startEyeBlinking())},4e3)))},d),setTimeout(()=>{var u;isSequenceSkipped$1||(u=allAssets$3==null?void 0:allAssets$3.audios)!=null&&u.zoesound1&&(allAssets$3.audios.zoesound1.play(),startVignetteAndShake(),setTimeout(()=>{var h;if(!isSequenceSkipped$1)if((h=allAssets$3==null?void 0:allAssets$3.audios)!=null&&h.electrosound2){const m=allAssets$3.audios.electrosound2;if(zoeCharacter&&(zoeCharacter.visible=!1),zoeElectroCharacter){zoeElectroCharacter.visible=!0,zoeElectroCharacter.position.set(81,-4.45,-63),zoeElectroCharacter.rotation.set(0,-Math.PI/2,0),zoeElectroCharacter.userData.zoeActions&&zoeElectroCharacter.userData.zoeActions.SAD_TALKING&&(zoeElectroCharacter.userData.zoeActions.SAD_TALKING.reset(),zoeElectroCharacter.userData.zoeActions.SAD_TALKING.setLoop(LoopOnce),zoeElectroCharacter.userData.zoeActions.SAD_TALKING.clampWhenFinished=!0,zoeElectroCharacter.userData.zoeActions.SAD_TALKING.fadeIn(.5).play(),function(){const p=zoeElectroCharacter.userData.zoeActions,v=p.SAD_TALKING,g=p.breathing_idle;if(!g)return;const y=.5,w=v.getClip(),_=typeof v.getEffectiveTimeScale=="function"?Math.max(1e-4,v.getEffectiveTimeScale()):1,S=((w==null?void 0:w.duration)||0)/_,C=Math.max(0,(S-y)*1e3);g.enabled=!0,g.reset(),g.setLoop(LoopRepeat),g.clampWhenFinished=!1,typeof g.setEffectiveTimeScale=="function"&&g.setEffectiveTimeScale(animationSpeedFactor),typeof g.setEffectiveWeight=="function"&&g.setEffectiveWeight(1);let A=!1;const E=()=>{if(!A)if(A=!0,typeof g.crossFadeFrom=="function")g.crossFadeFrom(v,y,!1).play();else{try{v&&v.fadeOut&&v.fadeOut(y)}catch{}g.fadeIn(y).play()}},k=setTimeout(E,C);try{if(zoeElectroMixer&&typeof zoeElectroMixer.addEventListener=="function"){const I=F=>{try{F&&F.action===v&&(clearTimeout(k),E(),zoeElectroMixer.removeEventListener("finished",I))}catch{}};zoeElectroMixer.addEventListener("finished",I)}}catch{}}());try{zoeShapeKeyControls&&zoeShapeKeyControls.startAnimation()}catch{}}currentCamera$2&&(currentCamera$2.position.set(80,-3.8,-63),currentCamera$2.lookAt(new Vector3$1(81,-3.6,-63)),currentControls&&currentControls.target&&currentControls.target.set(81,-4,-63)),window.isElectroSequencePlaying=!0,m.play(),setTimeout(()=>{if(!isSequenceSkipped$1){if(console.log("Electro's second sound finished, returning to player"),zoeElectroCharacter&&zoeElectroCharacter.userData.originalState){const p=zoeElectroCharacter.userData.originalState;zoeElectroCharacter.position.copy(p.position),zoeElectroCharacter.rotation.copy(p.rotation),zoeElectroCharacter.visible=p.visible;try{zoeShapeKeyControls&&zoeShapeKeyControls.stopAnimation()}catch{}zoeElectroCharacter.userData.zoeActions&&Object.values(zoeElectroCharacter.userData.zoeActions).forEach(v=>{v.isRunning()&&v.stop()})}window.isElectroSequencePlaying=!1,endZoeSequence()}},9500)}else endZoeSequence()},zoeSound1Duration*1e3))},zoeSound11Duration*1e3)}}},electroSoundDuration*1e3)}}},zoeSoundDuration*1e3)))}s()},300)}}function endZoeSequence(){if(showSceneObjective$1(2),console.log("Ending Zoe sequence"),isSequenceSkipped$1=!1,hideSkipButton(),stopVignetteAndShake(),stopCameraFocusOnZoe(),currentCamera$2&&currentCamera$2.userData.originalPosition){try{gsapWithCSS.killTweensOf(currentCamera$2.position)}catch{}if(currentControls&&currentControls.target)try{gsapWithCSS.killTweensOf(currentControls.target)}catch{}currentCamera$2.position.copy(currentCamera$2.userData.originalPosition),currentControls&&currentControls.target&&currentCamera$2.userData.originalControlsTarget&&(currentControls.target.copy(currentCamera$2.userData.originalControlsTarget),currentControls.update&&currentControls.update()),delete currentCamera$2.userData.originalPosition,delete currentCamera$2.userData.originalControlsTarget}else if(currentCamera$2){const n=new Vector3$1(0,0,0),e=new Vector3$1(0,2,-3),t=n.clone().add(e);gsapWithCSS.to(currentCamera$2.position,{x:t.x,y:t.y,z:t.z,duration:cameraFocusMoveDuration,ease:"power2.inOut"}),currentControls&&currentControls.target&&gsapWithCSS.to(currentControls.target,{x:n.x,y:n.y,z:n.z,duration:cameraFocusMoveDuration,ease:"power2.inOut"})}enablePlayerControls(),togglePlayerControls(!0),setCameraFollowsPlayer(!0),setCameraFocusOnPlayer(!0);try{const n=currentScene$2.getObjectByName("playerCapsule")||currentScene$2.getObjectByName("player");n&&currentControls&&currentControls.target&&(currentControls.target.copy(n.position),currentControls.update&&currentControls.update())}catch{}if(showPlayerModel(),currentScene$2.remove(zoeCharacter),zoeActions&&Object.values(zoeActions).forEach(n=>{n&&n.isRunning()&&n.stop()}),enableCameraControls(),currentControls){currentControls.enabled=!0;try{currentControls.update&&currentControls.update()}catch{}}console.log("Cleaned up Zoe and trigger"),isSequenceActive=!1,hasTriggeredZoe=!1,window.isElectroSequencePlaying=!1,showElectroAndRedzone(),createPostZoeTrigger()}function createPostZoeTrigger(){if(!currentScene$2||!allAssets$3){console.error("Scene or assets not available for creating post-Zoe trigger");return}postZoeTrigger=TriggerPoint(allAssets$3.vfxs.vfx,{x:39,y:-.85,z:-61},currentScene$2,{x:2.5,y:2.5,z:2.5},()=>{if(console.log("Player entered post-Zoe trigger zone"),setCameraFollowsPlayer(!1),postZoeTrigger)try{typeof postZoeTrigger.removeParticleEffects=="function"&&postZoeTrigger.removeParticleEffects()}catch(n){console.warn("Failed to remove post-Zoe trigger:",n)}finally{postZoeTrigger=null}try{hideSceneObjective()}catch{}try{typeof playElectroTalking02Action=="function"&&playElectroTalking02Action()}catch{}setTimeout(()=>{var n;try{const e=(n=allAssets$3==null?void 0:allAssets$3.audios)==null?void 0:n.electroLookat;e&&(typeof e.stop=="function"&&e.stop(),typeof e.setLoop=="function"&&e.setLoop(!1),typeof e.setVolume=="function"&&e.setVolume(.9),e.play())}catch(e){console.warn("Could not play electroLookat audio on post-Zoe trigger:",e)}},1200),currentPlayer&&(currentPlayer.position.set(42,currentPlayer.position.y,-61),currentPlayer.rotation.set(0,Math.PI/2,0),playerState.velocity.set(0,0,0)),zoeElectroCharacter&&(zoeElectroCharacter.position.set(-15,0,-141),console.log("Electro snapped to ground position (-15, 0, -141)")),triggerAutoMoveAndDisableControls$1(currentPlayer,()=>{console.log("Auto-move completed after Zoe sequence"),enablePlayerControls(),togglePlayerControls(!0),setCameraFollowsPlayer(!0),currentControls&&(currentControls.enabled=!0);try{showSceneObjective$1(3)}catch{}})}),postZoeTrigger&&typeof postZoeTrigger.setVFXVisible=="function"&&postZoeTrigger.setVFXVisible(!0),console.log("Created post-Zoe trigger point at (40.7, -0.95, -60)")}function updateZoe(n,e){if(!e){console.warn("No player object provided to updateZoe");return}if(currentPlayer||(currentPlayer=e),playerPosition.setFromMatrixPosition(e.matrixWorld),zoeMixer&&zoeMixer.update(n),zoeElectroMixer&&zoeElectroMixer.update(n),zoeTrigger&&zoeTrigger.updateQuarksScene(n,e),postZoeTrigger&&typeof postZoeTrigger.updateQuarksScene=="function"&&postZoeTrigger.updateQuarksScene(n,e),isAutoMoving&&(autoPlayerMovement$1(n),!isAutoMoveCameraAnimating&&currentPlayer&&currentCamera$2)){const t=new Vector3$1(0,0,-1).applyQuaternion(currentPlayer.quaternion).normalize(),o=.6,i=0,s=currentPlayer.position.clone().add(t.clone().multiplyScalar(o)).add(new Vector3$1(0,i,0));currentCamera$2.position.copy(s);const r=currentPlayer.position.clone().add(t.clone().multiplyScalar(3));autoMoveLookAtTarget||(autoMoveLookAtTarget=r.clone()),autoMoveLookAtTarget.lerp(r,.12);const a=performance.now(),l=.06,c=new Vector3$1(Math.sin(a*.0031)*l,Math.sin(a*.0042+.8)*l*.5,Math.sin(a*.0023+1.7)*l*.4),d=autoMoveLookAtTarget.clone().add(c);currentControls&&currentControls.target?(currentControls.target.copy(d),currentControls.update()):currentCamera$2.lookAt(d)}if(Math.random()<.01){const t=[];zoeActions&&Object.entries(zoeActions).forEach(([o,i])=>{i&&i.isRunning()&&t.push(o)}),t.length>1&&console.log("Multiple animations running:",t)}}function cleanupZoe(){if(isSequenceSkipped$1=!1,hideSkipButton(),stopEyeBlinking(),zoeActions&&Object.values(zoeActions).forEach(n=>{n&&n.isRunning()&&n.stop()}),zoeElectroCharacter&&zoeElectroCharacter.userData.originalState){const n=zoeElectroCharacter.userData.originalState;zoeElectroCharacter.position.copy(n.position),zoeElectroCharacter.rotation.copy(n.rotation),zoeElectroCharacter.visible=n.visible,zoeElectroCharacter.userData.zoeActions&&Object.values(zoeElectroCharacter.userData.zoeActions).forEach(e=>{e.isRunning()&&e.stop()})}if(zoeElectroMixer&&(zoeElectroMixer.stopAllAction(),zoeElectroMixer=null),hudVideoPlane$2){const n=tvScreenMesh&&hudVideoPlane$2===tvScreenMesh;if(hudVideoPlane$2.userData.video)try{hudVideoPlane$2.userData.video.pause(),hudVideoPlane$2.userData.video.currentTime=0}catch{}if(typeof hudVideoPlane$2.userData._detachVideoListeners=="function")try{hudVideoPlane$2.userData._detachVideoListeners()}catch{}if(hudVideoPlane$2.userData.videoTexture&&hudVideoPlane$2.userData.videoTexture.dispose)try{hudVideoPlane$2.userData.videoTexture.dispose()}catch{}n?(hudVideoPlane$2.userData.originalMaterial&&(hudVideoPlane$2.userData.videoMaterial&&hudVideoPlane$2.userData.videoMaterial.dispose&&hudVideoPlane$2.userData.videoMaterial.dispose(),hudVideoPlane$2.material=hudVideoPlane$2.userData.originalMaterial),hudVideoPlane$2.visible=!1):(currentScene$2&&currentScene$2.remove(hudVideoPlane$2),hudVideoPlane$2.geometry&&hudVideoPlane$2.geometry.dispose(),hudVideoPlane$2.material&&hudVideoPlane$2.material.dispose()),hudVideoPlane$2=null}currentControls=null,stopCameraFocusOnZoe(),postZoeTrigger&&(typeof postZoeTrigger.removeParticleEffects=="function"&&postZoeTrigger.removeParticleEffects(),postZoeTrigger=null),isAutoMoving=!1,autoMoveDistance=0,autoMoveCallback=null,currentPlayer=null}function createVignetteEffect$2(){const n=document.createElement("canvas");n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100%",n.style.height="100%",n.style.pointerEvents="none",n.style.zIndex="1000",document.body.appendChild(n);const e=n.getContext("2d");n.width=window.innerWidth,n.height=window.innerHeight,vignetteEffect$1={canvas:n,ctx:e,update:function(t){e.clearRect(0,0,n.width,n.height);const o=e.createRadialGradient(n.width/2,n.height/2,0,n.width/2,n.height/2,n.width/2);o.addColorStop(0,`rgba(255, 0, 0, ${t*.5})`),o.addColorStop(1,`rgba(255, 0, 0, ${t})`),e.fillStyle=o,e.fillRect(0,0,n.width,n.height)},cleanup:function(){n&&n.parentNode&&n.parentNode.removeChild(n)}}}function startVignetteAndShake(){isVignetteActive=!0,shakeStartTime=performance.now(),shakeDuration=zoeSoundDuration*500;try{if(currentCamera$2){try{gsapWithCSS.killTweensOf(currentCamera$2.position)}catch{}if(currentControls&&currentControls.target)try{gsapWithCSS.killTweensOf(currentControls.target)}catch{}preShakeCameraState.position=currentCamera$2.position.clone(),preShakeCameraState.target=currentControls&&currentControls.target?currentControls.target.clone():null;const e=SHAKE_CAMERA_ANGLES&&SHAKE_CAMERA_ANGLES[0]?SHAKE_CAMERA_ANGLES[0]:new Vector3$1(42,3,-55),t=zoeCharacter&&zoeCharacter.position?zoeCharacter.position.clone():new Vector3$1(82,-2.5,-60);if(currentCamera$2.position.set(e.x,e.y,e.z),currentControls&&currentControls.target?(currentControls.target.copy(t),currentControls.update&&currentControls.update()):currentCamera$2.lookAt(t),SHAKE_CAMERA_ANGLES&&SHAKE_CAMERA_ANGLES.length>1){const o=Math.max(300,Math.floor(shakeDuration*.5)),i=setTimeout(()=>{if(!isVignetteActive||!currentCamera$2)return;const s=SHAKE_CAMERA_ANGLES[1],r=zoeCharacter&&zoeCharacter.position?zoeCharacter.position.clone():new Vector3$1(82,-2.5,-60);try{gsapWithCSS.killTweensOf(currentCamera$2.position)}catch{}if(currentControls&&currentControls.target)try{gsapWithCSS.killTweensOf(currentControls.target)}catch{}currentCamera$2.position.set(s.x,s.y,s.z),currentControls&&currentControls.target?(currentControls.target.copy(r),currentControls.update&&currentControls.update()):currentCamera$2.lookAt(r)},o);shakeAngleTimeouts.push(i)}}}catch{}if(shakeSound){let i=function(){const s=performance.now()-o,r=Math.min(s/t,1);shakeSound.setVolume(.8*r),r<1&&requestAnimationFrame(i)};const e=new Vector3$1(currentCamera$2.position.x+20,currentCamera$2.position.y,currentCamera$2.position.z+20);shakeSound.position.copy(e),shakeSound.setVolume(0),shakeSound.play();const t=100,o=performance.now();i()}startCameraShake();function n(){if(!isVignetteActive)return;const t=performance.now()-shakeStartTime,o=Math.min(t/shakeDuration,1);if(vignetteEffect$1){const i=Math.sin(o*Math.PI*8)*.5+.5;vignetteEffect$1.update(i*.3)}o<1?requestAnimationFrame(n):stopVignetteAndShake()}n()}function startCameraShake(){if(!currentCamera$2)return;let n=shakeIntensity;const e=.5,t=.002;shakeInterval=setInterval(()=>{if(currentCamera$2){const o=Math.random()*n;currentCamera$2.position.x+=(Math.random()-.5)*o,currentCamera$2.position.y+=(Math.random()-.5)*o,currentCamera$2.position.z+=(Math.random()-.5)*o,currentCamera$2.rotation.x+=(Math.random()-.5)*o*.003,currentCamera$2.rotation.y+=(Math.random()-.5)*o*.003,currentCamera$2.rotation.z+=(Math.random()-.5)*o*.003,n<e&&(n=Math.min(n+t,e))}},50)}function stopVignetteAndShake(){if(isVignetteActive=!1,shakeSound){let o=function(){const i=performance.now()-e,s=Math.min(i/1e3,1);shakeSound.setVolume(t*(1-s)),s<1?requestAnimationFrame(o):shakeSound.stop()};const e=performance.now(),t=shakeSound.getVolume();o()}shakeInterval&&(clearInterval(shakeInterval),shakeInterval=null),vignetteEffect$1&&(vignetteEffect$1.cleanup(),vignetteEffect$1=null);try{if(currentCamera$2&&preShakeCameraState.position){try{gsapWithCSS.killTweensOf(currentCamera$2.position)}catch{}if(currentControls&&currentControls.target)try{gsapWithCSS.killTweensOf(currentControls.target)}catch{}currentCamera$2.position.copy(preShakeCameraState.position),preShakeCameraState.target&&(currentControls&&currentControls.target?(currentControls.target.copy(preShakeCameraState.target),currentControls.update&&currentControls.update()):currentCamera$2.lookAt(preShakeCameraState.target))}}catch{}finally{preShakeCameraState.position=null,preShakeCameraState.target=null,shakeAngleTimeouts.length&&(shakeAngleTimeouts.forEach(n=>{try{clearTimeout(n)}catch{}}),shakeAngleTimeouts.length=0)}}function createHUDVideoPlane(){var h,m,p;if(!allAssets$3||!allAssets$3.videotextures)return console.error("Video textures not found in assets"),null;const n=allAssets$3.videotextures.hudvideo;if(!n)return console.error("HUD video texture not found in assets"),null;const e=document.createElement("video");e.setAttribute("playsinline",""),e.setAttribute("webkit-playsinline",""),e.setAttribute("muted",""),e.setAttribute("crossorigin","anonymous"),e.setAttribute("preload","auto"),e.setAttribute("autoplay",""),e.setAttribute("loop","");const t=document.createElement("source");t.src=n.path,t.type="video/mp4",e.appendChild(t),e.muted=!0,e.loop=!1,e.autoplay=!0;const o=new Promise((v,g)=>{const y=()=>{e.removeEventListener("canplay",y),e.removeEventListener("error",_),e.removeEventListener("loadeddata",w),v()},w=()=>{e.removeEventListener("canplay",y),e.removeEventListener("error",_),e.removeEventListener("loadeddata",w),v()},_=S=>{console.error("Error loading HUD video:",S),e.removeEventListener("canplay",y),e.removeEventListener("error",_),e.removeEventListener("loadeddata",w),g(S)};e.addEventListener("canplay",y),e.addEventListener("loadeddata",w),e.addEventListener("error",_),e.load()}),i=new VideoTexture(e);i.minFilter=LinearFilter,i.magFilter=LinearFilter,i.format=RGBFormat,i.encoding=void 0,i.generateMipmaps=!1;const s=(m=(h=allAssets$3==null?void 0:allAssets$3.models)==null?void 0:h.gltf)==null?void 0:m.interior;if(!s)return console.error("Interior model not found for TV video setup"),null;let r=s.getObjectByName("tv");if(r||s.traverse(v=>{!r&&v.isMesh&&typeof v.name=="string"&&v.name.toLowerCase().includes("tv")&&(r=v)}),!r||!r.isMesh)return console.error("TV mesh not found in interior model"),null;let a=r;(p=r.traverse)==null||p.call(r,v=>{if(v.isMesh&&typeof v.name=="string"){const g=v.name.toLowerCase();(g.includes("screen")||g.includes("glass"))&&(a=v)}});let l=1;try{a.geometry.computeBoundingBox();const v=new Vector3$1;a.geometry.boundingBox.getSize(v);const g=[Math.max(v.x,1e-6),Math.max(v.y,1e-6),Math.max(v.z,1e-6)].sort((y,w)=>w-y);l=g[0]/g[1]}catch{}const c=new ShaderMaterial({uniforms:{videoTexture:{value:i},meshAspect:{value:l},videoAspect:{value:16/9}},vertexShader:`
      varying vec2 vUv;
      void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,fragmentShader:`
      uniform sampler2D videoTexture;
      uniform float meshAspect;
      uniform float videoAspect;
      varying vec2 vUv;
      
      void main() {
        vec2 uv = vUv;
        
        // Rotate UV coordinates 90 degrees clockwise and fix orientation
        // This transforms (x,y) to (y,x) to correct rotation without flipping
        float tempX = uv.x;
        uv.x = uv.y;
        uv.y = tempX;
        
        // No scaling needed - keep video's natural aspect ratio
        // Allow video to extend beyond mesh boundaries naturally
        
        vec4 videoColor = texture2D(videoTexture, uv);
        gl_FragColor = videoColor;
      }
    `,transparent:!0,side:DoubleSide,depthWrite:!1});a.userData.originalMaterial||(a.userData.originalMaterial=a.material),a.material=c,r.userData.targetMesh=a,r.visible=!1,a.visible=!1,r.frustumCulled=!1,a.frustumCulled=!1,r.renderOrder=20,a.renderOrder=21;const d=()=>{if(c&&c.uniforms&&c.uniforms.videoAspect){const v=e.videoWidth||16,g=e.videoHeight||9;g>0&&(c.uniforms.videoAspect.value=v/g)}};e.addEventListener("loadedmetadata",d),e.addEventListener("loadeddata",d),r.userData.video=e,r.userData.loadPromise=o,r.userData.videoTexture=i,r.userData.videoMaterial=c,e.load();const u=()=>{r.visible=!0,r.userData.targetMesh&&(r.userData.targetMesh.visible=!0),r.userData._updateInterval||(r.userData._updateInterval=setInterval(()=>{i&&(i.needsUpdate=!0)},33))},f=()=>{if(r.visible=!1,r.userData.targetMesh&&(r.userData.targetMesh.visible=!1),r.userData._updateInterval&&(clearInterval(r.userData._updateInterval),r.userData._updateInterval=null),c&&c.uniforms&&c.uniforms.videoAspect){const v=e.videoWidth||16,g=e.videoHeight||9;g>0&&(c.uniforms.videoAspect.value=v/g)}};return e.addEventListener("play",u),e.addEventListener("pause",f),e.addEventListener("ended",f),r.userData._detachVideoListeners=()=>{e.removeEventListener("play",u),e.removeEventListener("pause",f),e.removeEventListener("ended",f),r.userData._updateInterval&&(clearInterval(r.userData._updateInterval),r.userData._updateInterval=null)},r}function startEyeBlinking(){if(isEyeBlinking||!zoeActions.eyesAction)return;isEyeBlinking=!0,performance.now();function n(){if(!isEyeBlinking)return;const t=5e3;nextBlinkDelay=Math.random()*(9e3-t)+t,setTimeout(()=>{isEyeBlinking&&(e(),n())},nextBlinkDelay)}function e(){!zoeActions.eyesAction||!isEyeBlinking||(zoeActions.eyesAction.reset(),zoeActions.eyesAction.setLoop(LoopOnce),zoeActions.eyesAction.clampWhenFinished=!0,zoeActions.eyesAction.fadeIn(.1).play(),performance.now())}n()}function stopEyeBlinking(){isEyeBlinking=!1,zoeActions.eyesAction&&zoeActions.eyesAction.isRunning()&&zoeActions.eyesAction.stop()}function startCameraFocusOnZoe(){cameraFocusInterval||(cameraFocusInterval=setInterval(()=>{if(currentCamera$2&&isSequenceActive)if(window.isElectroSequencePlaying){const n=new Vector3$1(-15,0,-141);currentCamera$2.lookAt(n)}else{const n=new Vector3$1(82,-2.5,-60);currentCamera$2.lookAt(n)}else stopCameraFocusOnZoe()},100))}function stopCameraFocusOnZoe(){cameraFocusInterval&&(clearInterval(cameraFocusInterval),cameraFocusInterval=null)}function startZoeIdle(){zoeActions&&zoeActions.idleAction&&zoeCharacter&&zoeCharacter.visible&&(Object.values(zoeActions).forEach(n=>{n&&n!==zoeActions.idleAction&&n.isRunning()&&n.stop()}),zoeActions.idleAction.reset(),zoeActions.idleAction.setLoop(LoopRepeat),zoeActions.idleAction.clampWhenFinished=!1,zoeActions.idleAction.paused=!1,zoeActions.idleAction.fadeIn(.3).play(),console.log("Started Zoe idle animation"))}function resetPlayerState$1(){playerState.velocity.set(0,0,0),playerState.fwdPressed=!1,playerState.bkdPressed=!1,playerState.lftPressed=!1,playerState.rgtPressed=!1,playerState.shiftPressed=!1,updatePlayerAnimation(!1,!1)}function triggerAutoMoveAndDisableControls$1(n,e){console.log("Triggering auto-move with player:",n),isAutoMoving=!0,autoMoveDistance=0,autoMoveCallback=e,togglePlayerControls(!1),currentControls&&(currentControls.enabled=!1),resetPlayerState$1(),console.log("Auto-move triggered successfully")}function autoPlayerMovement$1(n){if(!isAutoMoving||!currentPlayer)return;const e=new Vector3$1(0,0,-1).applyQuaternion(currentPlayer.quaternion),t=AUTO_MOVE_CONFIG$1.speed*n;currentPlayer.position.addScaledVector(e,t),autoMoveDistance+=t,Math.random()<.1&&console.log("Auto-move progress:",{distance:autoMoveDistance,maxDistance:AUTO_MOVE_CONFIG$1.maxDistance,speed:AUTO_MOVE_CONFIG$1.speed,delta:n}),autoMoveDistance>=AUTO_MOVE_CONFIG$1.maxDistance?(console.log("Auto-move completed, distance traveled:",autoMoveDistance),isAutoMoving=!1,autoMoveDistance=0,resetPlayerState$1(),startAutoMoveCameraSequence()):(console.log("Calling updatePlayerAnimation(true, false) for walking animation"),updatePlayerAnimation(!0,!1))}let isEmergencyActive=!1,emergencyAudio=null,originalSceneBackground=null,fallingPieces=[],fallingParticles=[],isFalling=!1,playerVelocity=new Vector3$1;new Vector3$1(0,1.5,-3);let emergencyTriggered=!1,emergencyTriggerPosition=new Vector3$1(-55,2.5,-135),emergencyShakeInterval=null,emergencyCollapseInterval=null,playerLight=null,vignetteEffect=null,triggerMesh=null,particleSystem=null,cometSystem=null,fallingDebrisSystem=null,particleShaderMaterial=null,cometShaderMaterial=null,debrisShaderMaterial=null,spaceParticles=[],rockPieces=[],emergencyStartTime=0,isFadeOutActive$1=!1,currentScene$1=null,originalObjects=[],playerSpotLight=null,fallCharacter=null,fallAnimation=null,fallCharacterLight=null,currentCamera$1=null,fadeOutMaterial$1=null,fadeOutPlane$1=null;function initializeEmergency(n,e,t,o,i){console.log("Initializing emergency sequence"),currentScene$1=n,currentCamera$1=t,n.background&&(originalSceneBackground=n.background.clone()),n.environment&&(n.environment.clone(),n.environment.intensity!==void 0&&(originalEnvMapIntensity=n.environment.intensity)),n.traverse(r=>{(r.isMesh||r.isLight)&&originalObjects.push({object:r,visible:r.visible,intensity:r.isLight?r.intensity:null})});const s=new PlaneGeometry(2,2);if(fadeOutMaterial$1=new MeshBasicMaterial({color:0,transparent:!0,opacity:0}),fadeOutPlane$1=new Mesh(s,fadeOutMaterial$1),fadeOutPlane$1.renderOrder=9999,t.add(fadeOutPlane$1),o&&(o.position.clone(),o.rotation.clone()),t&&(t.position.clone(),t.rotation.clone(),t.userData&&t.userData.controls&&(t.userData.controls.target.clone(),t.userData.controls.enabled)),e.audios.emergency&&(emergencyAudio=e.audios.emergency,emergencyAudio.setLoop(!0)),n.traverse(r=>{r.isDirectionalLight&&r.intensity,r.isAmbientLight&&r.intensity}),playerLight=new PointLight(16777215,1,10),playerLight.position.set(0,1,0),i&&i.add(playerLight),playerSpotLight=new SpotLight(16777215,2),playerSpotLight.angle=Math.PI/4,playerSpotLight.penumbra=.5,playerSpotLight.decay=2,playerSpotLight.distance=10,i&&i.add(playerSpotLight),createVignetteEffect$1(n,t),createParticleSystems(n),e.characters.models.fallcharacter&&(fallCharacter=e.characters.models.fallcharacter.clone(),n.add(fallCharacter),fallCharacter.visible=!1,fallCharacter.position.set(0,2,0),fallCharacterLight=new SpotLight(16777215,2),fallCharacterLight.angle=Math.PI/4,fallCharacterLight.penumbra=.5,fallCharacterLight.decay=2,fallCharacterLight.distance=10,fallCharacter.add(fallCharacterLight),e.characters.animations.fallcharacter)){e.characters.animations.fallcharacter.mixer;const r=e.characters.animations.fallcharacter.actions;r.Fall_Armature&&(fallAnimation=r.Fall_Armature,fallAnimation.setEffectiveTimeScale(1))}return window.addEventListener("electroSequenceComplete",r=>{console.log("Received electroSequenceComplete event",r.detail);const a=n.getObjectByName("Icosphere");if(!a){console.error("Icosphere not found in scene!");return}if(console.log("Found Icosphere at position:",a.position),i){const l=new Vector3$1;l.setFromMatrixPosition(i.matrixWorld),emergencyTriggerPosition.copy(l),console.log("Set emergency trigger position to player position:",emergencyTriggerPosition)}startEmergencySequence(t,o,n,i),emergencyTriggered=!0}),{checkEmergencyTrigger,cleanupEmergency}}function createVignetteEffect$1(n,e){console.log("Creating vignette effect");const t=new PlaneGeometry(2,2),o=new ShaderMaterial({uniforms:{color:{value:new Color(0)},opacity:{value:0}},vertexShader:`
      varying vec2 vUv;
      void main() {
        vUv = uv;
        gl_Position = vec4(position, 1.0);
      }
    `,fragmentShader:`
      uniform vec3 color;
      uniform float opacity;
      varying vec2 vUv;
      void main() {
        float dist = length(vUv - vec2(0.5));
        float vignette = smoothstep(0.5, 0.2, dist);
        gl_FragColor = vec4(color, vignette * opacity);
      }
    `,transparent:!0,depthTest:!1,depthWrite:!1});if(vignetteEffect=new Mesh(t,o),vignetteEffect.renderOrder=9999,e&&(e.add(vignetteEffect),console.log("Added vignette effect to camera")),document.querySelector("canvas")){const s=document.createElement("div");s.style.position="absolute",s.style.top="0",s.style.left="0",s.style.width="100%",s.style.height="100%",s.style.pointerEvents="none",s.style.background="radial-gradient(circle at center, transparent 30%, rgba(0, 0, 0, 0.7) 100%)",s.style.opacity="0",s.style.transition="opacity 1s",s.id="canvas-vignette",document.body.appendChild(s),console.log("Added canvas vignette effect")}}function createParticleSystems(n){particleShaderMaterial=new ShaderMaterial({uniforms:{time:{value:0},color:{value:new Color(16777215)}},vertexShader:`
      varying vec2 vUv;
      void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,fragmentShader:`
      uniform float time;
      uniform vec3 color;
      varying vec2 vUv;
      void main() {
        float alpha = 1.0 - length(vUv - vec2(0.5));
        alpha = smoothstep(0.0, 0.5, alpha);
        gl_FragColor = vec4(color, alpha);
      }
    `,transparent:!0,depthWrite:!1}),cometShaderMaterial=new ShaderMaterial({uniforms:{time:{value:0},color:{value:new Color(16711680)}},vertexShader:`
      varying vec2 vUv;
      void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,fragmentShader:`
      uniform float time;
      uniform vec3 color;
      varying vec2 vUv;
      void main() {
        float alpha = 1.0 - length(vUv - vec2(0.5));
        alpha = smoothstep(0.0, 0.5, alpha);
        gl_FragColor = vec4(color, alpha * 0.8);
      }
    `,transparent:!0,depthWrite:!1}),debrisShaderMaterial=new ShaderMaterial({uniforms:{time:{value:0},color:{value:new Color(8947848)}},vertexShader:`
      varying vec2 vUv;
      void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,fragmentShader:`
      uniform float time;
      uniform vec3 color;
      varying vec2 vUv;
      void main() {
        float alpha = 1.0 - length(vUv - vec2(0.5));
        alpha = smoothstep(0.0, 0.5, alpha);
        gl_FragColor = vec4(color, alpha);
      }
    `,transparent:!0,depthWrite:!1});const e=new BufferGeometry,t=1e3,o=new Float32Array(t*3),i=new Float32Array(t*3),s=new Float32Array(t);for(let v=0;v<t;v++)o[v*3]=(Math.random()-.5)*10,o[v*3+1]=Math.random()*20,o[v*3+2]=(Math.random()-.5)*10,i[v*3]=(Math.random()-.5)*.1,i[v*3+1]=-Math.random()*.2,i[v*3+2]=(Math.random()-.5)*.1,s[v]=Math.random()*.1;e.setAttribute("position",new BufferAttribute(o,3)),e.setAttribute("velocity",new BufferAttribute(i,3)),e.setAttribute("size",new BufferAttribute(s,1)),particleSystem=new Points(e,particleShaderMaterial),n.add(particleSystem);const r=new BufferGeometry,a=2,l=new Float32Array(a*3),c=new Float32Array(a*3),d=new Float32Array(a);for(let v=0;v<a;v++)l[v*3]=(Math.random()-.5)*20,l[v*3+1]=Math.random()*30,l[v*3+2]=(Math.random()-.5)*20,c[v*3]=(Math.random()-.5)*.2,c[v*3+1]=-Math.random()*.5,c[v*3+2]=(Math.random()-.5)*.2,d[v]=Math.random()*.3+.1;r.setAttribute("position",new BufferAttribute(l,3)),r.setAttribute("velocity",new BufferAttribute(c,3)),r.setAttribute("size",new BufferAttribute(d,1)),cometSystem=new Points(r,cometShaderMaterial),n.add(cometSystem);const u=new BufferGeometry,f=200,h=new Float32Array(f*3),m=new Float32Array(f*3),p=new Float32Array(f);for(let v=0;v<f;v++)h[v*3]=(Math.random()-.5)*15,h[v*3+1]=Math.random()*25,h[v*3+2]=(Math.random()-.5)*15,m[v*3]=(Math.random()-.5)*.3,m[v*3+1]=-Math.random()*.7,m[v*3+2]=(Math.random()-.5)*.3,p[v]=Math.random()*.5+.2;u.setAttribute("position",new BufferAttribute(h,3)),u.setAttribute("velocity",new BufferAttribute(m,3)),u.setAttribute("size",new BufferAttribute(p,1)),fallingDebrisSystem=new Points(u,debrisShaderMaterial),n.add(fallingDebrisSystem)}function checkEmergencyTrigger(n,e,t,o){if(emergencyTriggered||!n||!triggerMesh)return;const i=new Vector3$1;i.setFromMatrixPosition(n.matrixWorld),i.distanceTo(triggerMesh.position)<=5&&!emergencyTriggered&&(emergencyTriggered=!0,startEmergencySequence(e,t,o,n))}function startEmergencySequence(n,e,t,o){if(!isEmergencyActive){if(isEmergencyActive=!0,emergencyStartTime=performance.now(),currentCamera$1=n,console.log("Starting emergency sequence"),emergencyAudio&&emergencyAudio.play(),n){const i=new Vector3$1(0,0,-1);i.applyQuaternion(n.quaternion),emergencyTriggerPosition.copy(n.position).add(i.multiplyScalar(5)),emergencyTriggerPosition.y=0,console.log("Set emergency trigger position to:",emergencyTriggerPosition)}if(createShockwaveEffect(t,emergencyTriggerPosition),turnOffAllLights(t),startEarthquakeEffect(n),particleSystem&&cometSystem&&fallingDebrisSystem){if(particleSystem.visible=!0,cometSystem.visible=!0,fallingDebrisSystem.visible=!0,n){const i=new Vector3$1(0,0,-1);i.applyQuaternion(n.quaternion);const s=new Vector3$1;s.copy(n.position).add(i.multiplyScalar(5)),particleSystem.position.copy(s),cometSystem.position.copy(s),fallingDebrisSystem.position.copy(s)}particleSystem.material&&(particleSystem.material.size=.2),cometSystem.material&&(cometSystem.material.size=.3),fallingDebrisSystem.material&&(fallingDebrisSystem.material.size=.4)}startCollapseSequence(t,o)}}function createShockwaveEffect(n,e){const t=new RingGeometry(1,1.2,32),o=new MeshBasicMaterial({color:16711680,transparent:!0,opacity:.8,side:DoubleSide}),i=new Mesh(t,o);i.position.copy(e),i.rotation.x=Math.PI/2,n.add(i);let s=1;const r=()=>{if(s+=.1,i.scale.set(s,s,s),i.material.opacity=Math.max(0,1-s/10),s>10){n.remove(i);return}requestAnimationFrame(r)};r()}function startEarthquakeEffect(n){console.log("Starting earthquake effect");const e=n.position.clone(),t=n.rotation.clone();emergencyShakeInterval=setInterval(()=>{if(n){let o=.1;const i=Math.random()*o;n.position.x=e.x+(Math.random()-.5)*i,n.position.y=e.y+(Math.random()-.5)*i,n.position.z=e.z+(Math.random()-.5)*i,n.rotation.x=t.x+(Math.random()-.5)*i*.1,n.rotation.y=t.y+(Math.random()-.5)*i*.1,n.rotation.z=t.z+(Math.random()-.5)*i*.1,o<1&&(o+=1e-4)}},50)}function turnOffAllLights(n){console.log("Turning off all lights"),n.traverse(t=>{t.isLight&&t!==playerLight&&t!==playerSpotLight&&(t.intensity=0)}),n.background&&(n.background.isColor?n.background.set(0):n.background.isCubeTexture&&(n.background=new Color(0))),n.environment&&n.environment.intensity!==void 0&&(n.environment.intensity=0),vignetteEffect&&vignetteEffect.material.uniforms&&(vignetteEffect.material.uniforms.opacity.value=.7);const e=document.getElementById("canvas-vignette");e&&(e.style.opacity="1")}function startCollapseSequence(n,e){console.log("Starting collapse sequence"),createFloorCracks(n),emergencyCollapseInterval=setInterval(()=>{spawnDebris(n),spawnParticles(n)},100),startPlayerFallingEffect(e)}function createFloorCracks(n){console.log("Creating floor cracks"),n.traverse(e=>{if(e.isMesh&&e.name.toLowerCase().includes("floor")&&e.geometry&&e.geometry.attributes.position){const t=e.geometry.attributes.position;for(let o=0;o<t.count;o++){let i=t.getY(o);t.setY(o,i-Math.random()*.5),t.setX(o,t.getX(o)+(Math.random()-.5)*.2),t.setZ(o,t.getZ(o)+(Math.random()-.5)*.2)}t.needsUpdate=!0}})}function spawnDebris(n,e){const t=new BoxGeometry(Math.random()*3+2,Math.random()*1.5+.8,Math.random()*3+2),o=new MeshStandardMaterial({color:5592405,roughness:.5,metalness:1,emissive:new Color(2236962),emissiveIntensity:.5,flatShading:!0}),i=new Mesh(t,o);if(currentCamera$1){const s=new Vector3$1(0,0,-1);s.applyQuaternion(currentCamera$1.quaternion);const r=new Vector3$1;r.copy(currentCamera$1.position).add(s.multiplyScalar(5));const a=Math.random()*3,l=Math.random()*Math.PI*2;r.x+=Math.cos(l)*a,r.z+=Math.sin(l)*a,r.y=10+Math.random()*5,i.position.copy(r)}else i.position.set((Math.random()-.5)*15,10+Math.random()*5,(Math.random()-.5)*15);i.castShadow=!0,i.receiveShadow=!0,n.add(i),fallingPieces.push({mesh:i,velocity:new Vector3$1((Math.random()-.5)*.8,Math.random()*1.5,(Math.random()-.5)*.8),rotationSpeed:new Vector3$1(Math.random()*.04,Math.random()*.04,Math.random()*.04)})}function spawnParticles(n,e){const t=new SphereGeometry(.1,8,8),o=new MeshBasicMaterial({color:16777215,transparent:!0,opacity:.8});for(let i=0;i<30;i++){const s=new Mesh(t,o);if(currentCamera$1){const r=new Vector3$1(0,0,-1);r.applyQuaternion(currentCamera$1.quaternion);const a=new Vector3$1;a.copy(currentCamera$1.position).add(r.multiplyScalar(5));const l=Math.random()*3,c=Math.random()*Math.PI*2;a.x+=Math.cos(c)*l,a.z+=Math.sin(c)*l,a.y=10+Math.random()*5,s.position.copy(a)}else s.position.set((Math.random()-.5)*15,10+Math.random()*5,(Math.random()-.5)*15);n.add(s),fallingParticles.push({mesh:s,velocity:new Vector3$1((Math.random()-.5)*15,(Math.random()-.5)*15,(Math.random()-.5)*15)})}}function startPlayerFallingEffect(n){if(n){if(console.log("Starting player falling effect"),isFalling=!0,playerVelocity.set((Math.random()-.5)*.1,.07,(Math.random()-.5)*.1),n.userData&&n.userData.animations){const e=n.userData.animations.find(t=>t.name.toLowerCase().includes("fall")||t.name.toLowerCase().includes("falling")||t.name.toLowerCase().includes("jump"));if(e){const t=n.userData.mixer.clipAction(e);t.reset(),t.play(),console.log("Playing fall/jump animation:",e.name)}else console.warn("No fall/jump animation found for player")}createSpaceParticles(n),createRockPieces(n)}}function createSpaceParticles(n){console.log("Creating space particles");const e=new SphereGeometry(.01,4,4),t=new MeshBasicMaterial({color:16777215,transparent:!0,opacity:.8});for(let o=0;o<200;o++){const i=new Mesh(e,t);if(n){const s=new Vector3$1;s.setFromMatrixPosition(n.matrixWorld);const r=Math.random()*10+5,a=Math.random()*Math.PI*2,l=Math.random()*Math.PI;i.position.set(s.x+r*Math.sin(l)*Math.cos(a),s.y+r*Math.sin(l)*Math.sin(a),s.z+r*Math.cos(l))}n.parent.add(i),spaceParticles.push({mesh:i,velocity:new Vector3$1((Math.random()-.5)*.5,(Math.random()-.5)*.5,(Math.random()-.5)*.5),rotationSpeed:new Vector3$1(Math.random()*.02,Math.random()*.02,Math.random()*.02)})}}function createRockPieces(n){console.log("Creating rock pieces");for(let e=0;e<30;e++){const t=new DodecahedronGeometry(Math.random()*.5+.2,0),o=new MeshStandardMaterial({color:8947848,roughness:.8,metalness:.2,flatShading:!0}),i=new Mesh(t,o);if(n){const s=new Vector3$1;s.setFromMatrixPosition(n.matrixWorld);const r=Math.random()*8+3,a=Math.random()*Math.PI*2,l=Math.random()*Math.PI;i.position.set(s.x+r*Math.sin(l)*Math.cos(a),s.y+r*Math.sin(l)*Math.sin(a),s.z+r*Math.cos(l))}i.castShadow=!0,i.receiveShadow=!0,n.parent.add(i),rockPieces.push({mesh:i,velocity:new Vector3$1((Math.random()-.5)*.3,(Math.random()-.5)*.3,(Math.random()-.5)*.3),rotationSpeed:new Vector3$1(Math.random()*.02,Math.random()*.02,Math.random()*.02)})}}function startFadeOut(n){if(isFadeOutActive$1||!currentScene$1)return;isFadeOutActive$1=!0,currentScene$1.background=new Color(0),currentScene$1.traverse(t=>{if(t.isMesh||t.isLight){if(t===fallCharacter||t===fallCharacterLight||t.parent===fallCharacter||t.parent===fallCharacterLight||t.name==="playerCapsule"||t.parent&&t.parent.name==="playerCapsule")return;t.visible=!1,t.isLight&&(t.intensity=0)}}),initializeFallingEffect(currentScene$1,n,allAssets$4);const e=document.getElementById("canvas-vignette");e&&e.remove()}function updateEmergency(n,e,t){if(!isEmergencyActive)return;if((performance.now()-emergencyStartTime)/1e3>=5&&!isFadeOutActive$1&&startFadeOut(t),isFadeOutActive$1){updateFallingEffect(n);return}if(particleSystem){const i=particleSystem.geometry.attributes.position.array,s=particleSystem.geometry.attributes.velocity.array;for(let r=0;r<i.length;r+=3)i[r]+=s[r]*n*5,i[r+1]+=s[r+1]*n*5,i[r+2]+=s[r+2]*n*5,i[r+1]<-10&&(i[r]=(Math.random()-.5)*10,i[r+1]=Math.random()*20,i[r+2]=(Math.random()-.5)*10);particleSystem.geometry.attributes.position.needsUpdate=!0,particleShaderMaterial.uniforms.time.value+=n}if(cometSystem){const i=cometSystem.geometry.attributes.position.array,s=cometSystem.geometry.attributes.velocity.array;for(let r=0;r<i.length;r+=3)i[r]+=s[r]*n*5,i[r+1]+=s[r+1]*n*5,i[r+2]+=s[r+2]*n*5,i[r+1]<-10&&(i[r]=(Math.random()-.5)*10,i[r+1]=Math.random()*30,i[r+2]=(Math.random()-.5)*10);cometSystem.geometry.attributes.position.needsUpdate=!0,cometShaderMaterial.uniforms.time.value+=n}if(fallingDebrisSystem){const i=fallingDebrisSystem.geometry.attributes.position.array,s=fallingDebrisSystem.geometry.attributes.velocity.array;for(let r=0;r<i.length;r+=3)i[r]+=s[r]*n*5,i[r+1]+=s[r+1]*n*5,i[r+2]+=s[r+2]*n*5,i[r+1]<-10&&(i[r]=(Math.random()-.5)*15,i[r+1]=Math.random()*25,i[r+2]=(Math.random()-.5)*15);fallingDebrisSystem.geometry.attributes.position.needsUpdate=!0,debrisShaderMaterial.uniforms.time.value+=n}isFalling&&t&&(t.position.y-=.05,t.position.x+=(Math.random()-.5)*.02,t.position.z+=(Math.random()-.5)*.02,e&&t.lookAt(e.position))}function cleanupEmergency(n){isEmergencyActive&&(console.log("Cleaning up emergency sequence"),emergencyAudio&&emergencyAudio.stop(),emergencyShakeInterval&&clearInterval(emergencyShakeInterval),emergencyCollapseInterval&&clearInterval(emergencyCollapseInterval),cleanupFallingEffect(),particleSystem&&(particleSystem.geometry.dispose(),particleShaderMaterial.dispose(),n.remove(particleSystem)),cometSystem&&(cometSystem.geometry.dispose(),cometShaderMaterial.dispose(),n.remove(cometSystem)),fallingDebrisSystem&&(fallingDebrisSystem.geometry.dispose(),debrisShaderMaterial.dispose(),n.remove(fallingDebrisSystem)),originalObjects.forEach(({object:e,visible:t,intensity:o})=>{e.visible=t,e.isLight&&o!==null&&(e.intensity=o)}),originalObjects=[],originalSceneBackground&&(n.background=originalSceneBackground),isEmergencyActive=!1,isFalling=!1,emergencyTriggered=!1,isFadeOutActive$1=!1,currentScene$1=null,playerSpotLight&&playerSpotLight.parent&&playerSpotLight.parent.remove(playerSpotLight),fallCharacter&&(n.remove(fallCharacter),fallCharacter=null),fallCharacterLight&&(fallCharacterLight=null))}let fadeOutMaterial=null,fadeOutPlane=null,fadeOutOpacity=0,fallingRocks=[],isFadeOutActive=!1,fadeOutStartTime=0,currentScene=null;function initializeFadeOut(n,e){if(!n||!e){console.error("Scene or camera not provided to initializeFadeOut");return}currentScene=n;const t=new PlaneGeometry(2,2);fadeOutMaterial=new MeshBasicMaterial({color:0,transparent:!0,opacity:0}),fadeOutPlane=new Mesh(t,fadeOutMaterial),fadeOutPlane.renderOrder=9999,e.add(fadeOutPlane)}function createFallingRocks(){if(!currentScene){console.error("No scene available for creating falling rocks");return}const n=50,e=new DodecahedronGeometry(.2,0),t=new MeshStandardMaterial({color:8947848,roughness:.8,metalness:.2});for(let o=0;o<n;o++){const i=new Mesh(e,t);i.position.set((Math.random()-.5)*20,Math.random()*20+10,(Math.random()-.5)*20),i.userData.velocity=new Vector3$1((Math.random()-.5)*.1,-Math.random()*.2,(Math.random()-.5)*.1),i.userData.rotationSpeed=new Vector3$1(Math.random()*.02,Math.random()*.02,Math.random()*.02),currentScene.add(i),fallingRocks.push(i)}}function updateFadeOut(n){if(!isFadeOutActive||!currentScene)return;const e=(performance.now()-fadeOutStartTime)/1e3;fadeOutOpacity=Math.min(1,e/2),fadeOutMaterial&&(fadeOutMaterial.opacity=fadeOutOpacity);for(let t=fallingRocks.length-1;t>=0;t--){const o=fallingRocks[t];o.position.add(o.userData.velocity),o.rotation.x+=o.userData.rotationSpeed.x,o.rotation.y+=o.userData.rotationSpeed.y,o.rotation.z+=o.userData.rotationSpeed.z,o.position.y<-10&&(currentScene.remove(o),fallingRocks.splice(t,1))}fallingRocks.length<50&&Math.random()<.1&&createFallingRocks()}function cleanupFadeOut(n){isFadeOutActive=!1,fadeOutOpacity=0,fadeOutMaterial&&(fadeOutMaterial.opacity=0),currentScene&&fallingRocks.forEach(e=>{currentScene.remove(e)}),fallingRocks=[],currentScene=null}const holographicGlobeShader$1={uniforms:{time:{value:0},glowColor:{value:new Color(65535)},glowIntensity:{value:1},glowPower:{value:2},glowSpeed:{value:1}},vertexShader:`
        varying vec3 vNormal;
        varying vec3 vViewPosition;
        varying float vGlow;
        void main() {
            vNormal = normalize(normalMatrix * normal);
            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
            vViewPosition = -mvPosition.xyz;
            // Calculate glow based on view angle
            vGlow = pow(1.0 - abs(dot(normalize(vNormal), normalize(vViewPosition))), 2.0);
            
            gl_Position = projectionMatrix * mvPosition;
        }
    `,fragmentShader:`
        uniform float time;
        uniform vec3 glowColor;
        uniform float glowIntensity;
        uniform float glowPower;
        uniform float glowSpeed;
        
        varying vec3 vNormal;
        varying vec3 vViewPosition;
        varying float vGlow;
        
        void main() {
            // Calculate pulsing glow
            float pulse = sin(time * glowSpeed) * 0.5 + 0.5;
            float glow = pow(vGlow, glowPower) * glowIntensity * (0.5 + pulse * 0.5);
            
            // Only add glow to edges
            vec3 finalColor = glowColor * glow;
            
            gl_FragColor = vec4(finalColor, glow);
        }
    `};var __webpack_require__={};__webpack_require__.d=(n,e)=>{for(var t in e)__webpack_require__.o(e,t)&&!__webpack_require__.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})};__webpack_require__.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e);__webpack_require__.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var __webpack_exports__={};__webpack_require__.d(__webpack_exports__,{g1:()=>AlignItems_namespaceObject,gO:()=>Block,km:()=>ContentDirection_namespaceObject,zV:()=>core_FontLibrary,ol:()=>InlineBlock,uM:()=>JustifyContent_namespaceObject,N1:()=>Keyboard,xv:()=>Text,PH:()=>TextAlign_namespaceObject,UH:()=>Whitespace_namespaceObject,ZP:()=>three_mesh_ui,Vx:()=>update});var ContentDirection_namespaceObject={};__webpack_require__.r(ContentDirection_namespaceObject);__webpack_require__.d(ContentDirection_namespaceObject,{COLUMN:()=>COLUMN,COLUMN_REVERSE:()=>COLUMN_REVERSE,ROW:()=>ROW,ROW_REVERSE:()=>ROW_REVERSE,contentDirection:()=>contentDirection});var AlignItems_namespaceObject={};__webpack_require__.r(AlignItems_namespaceObject);__webpack_require__.d(AlignItems_namespaceObject,{CENTER:()=>CENTER,END:()=>END,START:()=>START,STRETCH:()=>STRETCH,alignItems:()=>alignItems,warnAboutDeprecatedAlignItems:()=>warnAboutDeprecatedAlignItems});var JustifyContent_namespaceObject={};__webpack_require__.r(JustifyContent_namespaceObject);__webpack_require__.d(JustifyContent_namespaceObject,{CENTER:()=>JustifyContent_CENTER,END:()=>JustifyContent_END,SPACE_AROUND:()=>SPACE_AROUND,SPACE_BETWEEN:()=>SPACE_BETWEEN,SPACE_EVENLY:()=>SPACE_EVENLY,START:()=>JustifyContent_START,justifyContent:()=>justifyContent});var Whitespace_namespaceObject={};__webpack_require__.r(Whitespace_namespaceObject);__webpack_require__.d(Whitespace_namespaceObject,{NORMAL:()=>NORMAL,NOWRAP:()=>NOWRAP,PRE:()=>PRE,PRE_LINE:()=>PRE_LINE,PRE_WRAP:()=>PRE_WRAP,WHITE_CHARS:()=>WHITE_CHARS,collapseWhitespaceOnInlines:()=>collapseWhitespaceOnInlines,collapseWhitespaceOnString:()=>collapseWhitespaceOnString,newlineBreakability:()=>newlineBreakability,shouldBreak:()=>Whitespace_shouldBreak});var TextAlign_namespaceObject={};__webpack_require__.r(TextAlign_namespaceObject);__webpack_require__.d(TextAlign_namespaceObject,{CENTER:()=>TextAlign_CENTER,JUSTIFY:()=>JUSTIFY,JUSTIFY_CENTER:()=>JUSTIFY_CENTER,JUSTIFY_LEFT:()=>JUSTIFY_LEFT,JUSTIFY_RIGHT:()=>JUSTIFY_RIGHT,LEFT:()=>LEFT,RIGHT:()=>RIGHT,textAlign:()=>textAlign});var x=n=>{var e={};return __webpack_require__.d(e,n),e};const external_three_namespaceObject=x({BufferAttribute:()=>BufferAttribute,BufferGeometry:()=>BufferGeometry,CanvasTexture:()=>CanvasTexture,Color:()=>Color,FileLoader:()=>FileLoader,LinearFilter:()=>LinearFilter,Mesh:()=>Mesh,Object3D:()=>Object3D,Plane:()=>Plane,PlaneGeometry:()=>PlaneGeometry,ShaderMaterial:()=>ShaderMaterial,TextureLoader:()=>TextureLoader,Vector2:()=>Vector2$1,Vector3:()=>Vector3$1}),ROW="row",ROW_REVERSE="row-reverse",COLUMN="column",COLUMN_REVERSE="column-reverse";function contentDirection(n,e,t,o){let i=t,s="getWidth",r="x",a="y";e.indexOf(COLUMN)===0&&(s="getHeight",r="y",a="x");for(let l=0;l<n.childrenBoxes.length;l++){const c=n.childrenBoxes[l],d=c.id,u=c[s](),f=c.margin||0;i+=f*o,n.childrenPos[d]={[r]:i+u/2*o,[a]:0},i+=o*(u+f)}}const START="start",CENTER="center",END="end",STRETCH="stretch";function alignItems(n,e){const t=n.getAlignItems();AVAILABLE_ALIGN_ITEMS.indexOf(t)===-1&&console.warn(`alignItems === '${t}' is not supported`);let o="getWidth",i="x";e.indexOf(ROW)===0&&(o="getHeight",i="y");const s=n[o]()/2-(n.padding||0);n.childrenBoxes.forEach(r=>{let a;switch(t){case END:case"right":case"bottom":e.indexOf(ROW)===0?a=-s+r[o]()/2+(r.margin||0):a=s-r[o]()/2-(r.margin||0);break;case START:case"left":case"top":e.indexOf(ROW)===0?a=s-r[o]()/2-(r.margin||0):a=-s+r[o]()/2+(r.margin||0);break}n.childrenPos[r.id][i]=a||0})}function warnAboutDeprecatedAlignItems(n){DEPRECATED_ALIGN_ITEMS.indexOf(n)!==-1&&console.warn(`alignItems === '${n}' is deprecated and will be remove in 7.x.x. Fallback are 'start'|'end'`)}const AVAILABLE_ALIGN_ITEMS=[START,CENTER,END,STRETCH,"top","right","bottom","left"],DEPRECATED_ALIGN_ITEMS=["top","right","bottom","left"],JustifyContent_START="start",JustifyContent_CENTER="center",JustifyContent_END="end",SPACE_AROUND="space-around",SPACE_BETWEEN="space-between",SPACE_EVENLY="space-evenly";function justifyContent(n,e,t,o){const i=n.getJustifyContent();AVAILABLE_JUSTIFICATIONS.indexOf(i)===-1&&console.warn(`justifyContent === '${i}' is not supported`);const s=e.indexOf("row")===0?"width":"height",r=n.getChildrenSideSum(s),l=(s==="width"?n.getInnerWidth():n.getInnerHeight())-r,c=t*2-r*Math.sign(t),d=_getJustificationOffset(i,c),u=_getJustificationMargin(n.childrenBoxes,l,i,o),f=e.indexOf("row")===0?"x":"y";n.childrenBoxes.forEach((h,m)=>{n.childrenPos[h.id][f]-=d-u[m]})}const AVAILABLE_JUSTIFICATIONS=[JustifyContent_START,JustifyContent_CENTER,JustifyContent_END,SPACE_AROUND,SPACE_BETWEEN,SPACE_EVENLY];function _getJustificationOffset(n,e){switch(n){case JustifyContent_END:return e;case JustifyContent_CENTER:return e/2}return 0}function _getJustificationMargin(n,e,t,o){const i=Array(n.length).fill(0);if(e>0)switch(t){case SPACE_BETWEEN:if(n.length>1){const s=e/(n.length-1)*o;i[0]=0;for(let r=1;r<n.length;r++)i[r]=s*r}break;case SPACE_EVENLY:if(n.length>1){const s=e/(n.length+1)*o;for(let r=0;r<n.length;r++)i[r]=s*(r+1)}break;case SPACE_AROUND:if(n.length>1){const s=e/n.length*o,r=s/2;i[0]=r;for(let a=1;a<n.length;a++)i[a]=r+s*a}break}return i}function BoxComponent(n){return class extends n{constructor(t){super(t),this.isBoxComponent=!0,this.childrenPos={}}getInnerWidth(){const t=this.getContentDirection();switch(t){case"row":case"row-reverse":return this.width-(this.padding*2||0)||this.getChildrenSideSum("width");case"column":case"column-reverse":return this.getHighestChildSizeOn("width");default:console.error(`Invalid contentDirection : ${t}`);break}}getInnerHeight(){const t=this.getContentDirection();switch(t){case"row":case"row-reverse":return this.getHighestChildSizeOn("height");case"column":case"column-reverse":return this.height-(this.padding*2||0)||this.getChildrenSideSum("height");default:console.error(`Invalid contentDirection : ${t}`);break}}getChildrenSideSum(t){return this.childrenBoxes.reduce((o,i)=>{const s=i.margin*2||0,r=t==="width"?i.getWidth()+s:i.getHeight()+s;return o+r},0)}setPosFromParentRecords(){this.parentUI&&this.parentUI.childrenPos[this.id]&&(this.position.x=this.parentUI.childrenPos[this.id].x,this.position.y=this.parentUI.childrenPos[this.id].y)}computeChildrenPosition(){if(this.children.length>0){const t=this.getContentDirection();let o;switch(t){case ROW:o=-this.getInnerWidth()/2;break;case ROW_REVERSE:o=this.getInnerWidth()/2;break;case COLUMN:o=this.getInnerHeight()/2;break;case COLUMN_REVERSE:o=-this.getInnerHeight()/2;break}const i=-Math.sign(o);contentDirection(this,t,o,i),justifyContent(this,t,o,i),alignItems(this,t)}}getHighestChildSizeOn(t){return this.childrenBoxes.reduce((o,i)=>{const s=i.margin||0,r=t==="width"?i.getWidth()+s*2:i.getHeight()+s*2;return Math.max(o,r)},0)}getWidth(){return this.parentUI&&this.parentUI.getAlignItems()==="stretch"&&this.parentUI.getContentDirection().indexOf("column")!==-1?this.parentUI.getWidth()-(this.parentUI.padding*2||0):this.width||this.getInnerWidth()+(this.padding*2||0)}getHeight(){return this.parentUI&&this.parentUI.getAlignItems()==="stretch"&&this.parentUI.getContentDirection().indexOf("row")!==-1?this.parentUI.getHeight()-(this.parentUI.padding*2||0):this.height||this.getInnerHeight()+(this.padding*2||0)}}}const WHITE_CHARS={"	":"	","\n":`
`,"\r":"\r"," ":" "},NORMAL="normal",NOWRAP="nowrap",PRE="pre",PRE_LINE="pre-line",PRE_WRAP="pre-wrap",collapseWhitespaceOnString=function(n,e){switch(e){case NOWRAP:case NORMAL:n=n.replace(/\n/g," ");case PRE_LINE:n=n.replace(/[ ]{2,}/g," ");break}return n},newlineBreakability=function(n){switch(n){case PRE:case PRE_WRAP:case PRE_LINE:return"mandatory"}},Whitespace_shouldBreak=function(n,e,t,o){const i=n[e];switch(o.WHITESPACE){case NORMAL:case PRE_LINE:case PRE_WRAP:if(i.lineBreak==="mandatory")return!0;const s=i.kerning?i.kerning:0,r=i.xoffset?i.xoffset:0,a=i.xadvance?i.xadvance:i.width;if(t+a+r+s>o.INNER_WIDTH)return!0;const l=_distanceToNextBreak(n,e,o);return _shouldFriendlyBreak(n[e-1],t,l,o);case PRE:return i.lineBreak==="mandatory";case NOWRAP:default:return!1}},collapseWhitespaceOnInlines=function(n,e){const t=n[0],o=n[n.length-1];switch(e){case PRE_WRAP:t.glyph&&t.glyph===`
`&&n.length>1&&_collapseLeftInlines([t],n[1]),o.glyph&&o.glyph===`
`&&n.length>1&&_collapseRightInlines([o],n[n.length-2]);break;case PRE_LINE:case NOWRAP:case NORMAL:let i=[],s;for(let r=0;r<n.length;r++){const a=n[r];if(a.glyph&&WHITE_CHARS[a.glyph]&&n.length>r){i.push(a),s=n[r+1];continue}break}_collapseLeftInlines(i,s),i=[],s=null;for(let r=n.length-1;r>0;r--){const a=n[r];if(a.glyph&&WHITE_CHARS[a.glyph]&&r>0){i.push(a),s=n[r-1];continue}break}_collapseRightInlines(i,s);break;case PRE:break;default:return console.warn(`whiteSpace: '${e}' is not valid`),0}return t.offsetX};function _collapseRightInlines(n,e){if(e)for(let t=0;t<n.length;t++){const o=n[t];o.width=0,o.height=0,o.offsetX=e.offsetX+e.width}}function _collapseLeftInlines(n,e){if(e)for(let t=0;t<n.length;t++){const o=n[t];o.width=0,o.height=0,o.offsetX=e.offsetX}}function _distanceToNextBreak(n,e,t,o){if(o=o||0,!n[e])return o;const i=n[e],s=i.kerning?i.kerning:0,r=i.xoffset?i.xoffset:0,a=i.xadvance?i.xadvance:i.width;return i.lineBreak?o+a:_distanceToNextBreak(n,e+1,t,o+a+t.LETTERSPACING+r+s)}function _shouldFriendlyBreak(n,e,t,o){return!n||!n.glyph||e+t<o.INNER_WIDTH?!1:o.BREAKON.indexOf(n.glyph)>-1}const LEFT="left",RIGHT="right",TextAlign_CENTER="center",JUSTIFY="justify",JUSTIFY_LEFT="justify-left",JUSTIFY_RIGHT="justify-right",JUSTIFY_CENTER="justify-center";function textAlign(n,e,t){for(let o=0;o<n.length;o++){const i=n[o],s=_computeLineOffset(i,e,t,o===n.length-1);for(let r=0;r<i.length;r++)i[r].offsetX+=s;i.x=s}if(e.indexOf(JUSTIFY)===0)for(let o=0;o<n.length;o++){const i=n[o];if(e.indexOf("-")!==-1&&o===n.length-1)return;const s=t-i.width;if(s<=0)return;let r=0;for(let d=1;d<i.length-1;d++)r+=i[d].glyph===" "?1:0;const a=s/r;let l=1;e===JUSTIFY_RIGHT&&(i.reverse(),l=-1);let c=0;for(let d=1;d<=i.length-1;d++){const u=i[d];u.offsetX+=c*l,c+=u.glyph===" "?a:0}e===JUSTIFY_RIGHT&&i.reverse()}}const _computeLineOffset=(n,e,t,o)=>{switch(e){case JUSTIFY_LEFT:case JUSTIFY:case LEFT:return-t/2;case JUSTIFY_RIGHT:case RIGHT:return-n.width+t/2;case TextAlign_CENTER:return-n.width/2;case JUSTIFY_CENTER:return o?-n.width/2:-t/2;default:console.warn(`textAlign: '${e}' is not valid`)}};function InlineManager(n){return class extends n{computeInlinesPosition(){const t=this.getWidth()-(this.padding*2||0),o=this.getHeight()-(this.padding*2||0),i=this.getJustifyContent(),s=this.getTextAlign(),r=this.getInterLine(),a=this.computeLines();a.interLine=r;const l=Math.abs(a.height),c=(()=>{switch(i){case"start":return o/2;case"end":return l-o/2;case"center":return l/2;default:console.warn(`justifyContent: '${i}' is not valid`)}})();a.forEach(d=>{d.y+=c,d.forEach(u=>{u.offsetY+=c})}),textAlign(a,s,t),this.lines=a}calculateBestFit(t){if(this.childrenInlines.length!==0)switch(t){case"grow":this.calculateGrowFit();break;case"shrink":this.calculateShrinkFit();break;case"auto":this.calculateAutoFit();break}}calculateGrowFit(){const t=this.getHeight()-(this.padding*2||0);let o=1;const i=.075,s=this.childrenInlines.find(d=>d.isText);let r=1,a=2,l=s._fitFontSize?s._fitFontSize/s.getFontSize():1,c;do if(c=this.calculateHeight(l),c>t){if(l<=r){this.childrenInlines.forEach(d=>{d.isInlineBlock||(d._fitFontSize=d.getFontSize())});break}a=l,l-=(a-r)/2}else{if(Math.abs(t-c)<i)break;Math.abs(l-a)<5e-10&&(a*=2),r=l,l+=(a-r)/2}while(++o<=10)}calculateShrinkFit(){const t=this.getHeight()-(this.padding*2||0);let o=1;const i=.075,s=this.childrenInlines.find(d=>d.isText);let r=0,a=1,l=s._fitFontSize?s._fitFontSize/s.getFontSize():1,c;do if(c=this.calculateHeight(l),c>t)a=l,l-=(a-r)/2;else{if(l>=a){this.childrenInlines.forEach(d=>{d.isInlineBlock||(d._fitFontSize=d.getFontSize())});break}if(Math.abs(t-c)<i)break;r=l,l+=(a-r)/2}while(++o<=10)}calculateAutoFit(){const t=this.getHeight()-(this.padding*2||0);let o=1;const i=.075,s=this.childrenInlines.find(d=>d.isText);let r=0,a=2,l=s._fitFontSize?s._fitFontSize/s.getFontSize():1,c;do if(c=this.calculateHeight(l),c>t)a=l,l-=(a-r)/2;else{if(Math.abs(t-c)<i)break;Math.abs(l-a)<5e-10&&(a*=2),r=l,l+=(a-r)/2}while(++o<=10)}computeLines(){const t=this.getWidth()-(this.padding*2||0),o=[[]];o.height=0;const i=this.getInterLine();this.childrenInlines.reduce((l,c)=>{if(!c.inlines)return;const d=c._fitFontSize||c.getFontSize(),u=c.isText?c.getLetterSpacing()*d:0,f=c.getWhiteSpace(),h=c.getBreakOn(),m={WHITESPACE:f,LETTERSPACING:u,BREAKON:h,INNER_WIDTH:t};return c.inlines.reduce((v,g,y,w)=>{const _=g.kerning?g.kerning:0,S=g.xoffset?g.xoffset:0,C=g.xadvance?g.xadvance:g.width;return Whitespace_shouldBreak(w,y,v,m)?(o.push([g]),g.offsetX=S,g.width===0?0:C+u):(o[o.length-1].push(g),g.offsetX=v+S+_,v+C+_+u)},l)},0);let s=0,r=0,a=-i/2;return o.forEach(l=>{if(l.lineHeight=l.reduce((d,u)=>{const f=u.lineHeight!==void 0?u.lineHeight:u.height;return Math.max(d,f)},0),l.lineBase=l.reduce((d,u)=>{const f=u.lineBase!==void 0?u.lineBase:u.height;return Math.max(d,f)},0),l.width=0,l.height=l.lineHeight,l[0]){const d=this.getWhiteSpace(),u=collapseWhitespaceOnInlines(l,d);l.forEach(f=>{f.offsetX-=u}),l.width=this.computeLineWidth(l),l.width>s&&(s=l.width),l.forEach(f=>{f.offsetY=a-f.height-f.anchor,f.lineHeight<l.lineHeight&&(f.offsetY-=l.lineBase-f.lineBase)}),l.y=a,r+=l.lineHeight+i,a=a-(l.lineHeight+i)}}),o.height=r,o.width=s,o}calculateHeight(t){this.childrenInlines.forEach(i=>{i.isInlineBlock||(i._fitFontSize=i.getFontSize()*t,i.calculateInlines(i._fitFontSize))});const o=this.computeLines();return Math.abs(o.height)}computeLineWidth(t){const o=t[0],i=t[t.length-1];return i.offsetX+i.width+o.offsetX}}}const fileLoader=new external_three_namespaceObject.FileLoader,requiredFontFamilies=[],fontFamilies={},textureLoader=new external_three_namespaceObject.TextureLoader,requiredFontTextures=[],fontTextures={},records={};function setFontFamily(n,e){typeof e=="string"?loadFontJSON(n,e):(records[n.id]||(records[n.id]={component:n}),_buildFriendlyKerningValues(e),records[n.id].json=e,n._updateFontFamily(e))}function setFontTexture(n,e){requiredFontTextures.indexOf(e)===-1&&(requiredFontTextures.push(e),textureLoader.load(e,t=>{t.generateMipmaps=!1,t.minFilter=external_three_namespaceObject.LinearFilter,t.magFilter=external_three_namespaceObject.LinearFilter,fontTextures[e]=t;for(const o of Object.keys(records))e===records[o].textureURL&&records[o].component._updateFontTexture(t)})),records[n.id]||(records[n.id]={component:n}),records[n.id].textureURL=e,fontTextures[e]&&n._updateFontTexture(fontTextures[e])}function getFontOf(n){const e=records[n.id];return!e&&n.parentUI?getFontOf(n.parentUI):e}function loadFontJSON(n,e){requiredFontFamilies.indexOf(e)===-1&&(requiredFontFamilies.push(e),fileLoader.load(e,t=>{const o=JSON.parse(t);_buildFriendlyKerningValues(o),fontFamilies[e]=o;for(const i of Object.keys(records))e===records[i].jsonURL&&records[i].component._updateFontFamily(o)})),records[n.id]||(records[n.id]={component:n}),records[n.id].jsonURL=e,fontFamilies[e]&&n._updateFontFamily(fontFamilies[e])}function _buildFriendlyKerningValues(n){if(n._kernings)return;const e={};for(let t=0;t<n.kernings.length;t++){const o=n.kernings[t];if(o.amount===0)continue;const i=String.fromCharCode(o.first,o.second);e[i]=o.amount}n._kernings=e}function addFont(n,e,t){t.generateMipmaps=!1,t.minFilter=external_three_namespaceObject.LinearFilter,t.magFilter=external_three_namespaceObject.LinearFilter,requiredFontFamilies.push(n),fontFamilies[n]=e,_buildFriendlyKerningValues(e),t&&(requiredFontTextures.push(n),fontTextures[n]=t)}const FontLibrary={setFontFamily,setFontTexture,getFontOf,addFont},core_FontLibrary=FontLibrary;class UpdateManager{static requestUpdate(e,t,o,i){e.traverse(s=>{s.isUI&&(this.requestedUpdates[s.id]?(t&&(this.requestedUpdates[s.id].updateParsing=!0),o&&(this.requestedUpdates[s.id].updateLayout=!0),i&&(this.requestedUpdates[s.id].updateInner=!0)):this.requestedUpdates[s.id]={updateParsing:t,updateLayout:o,updateInner:i,needCallback:t||o||i})})}static register(e){this.components.includes(e)||this.components.push(e)}static disposeOf(e){const t=this.components.indexOf(e);t>-1&&this.components.splice(t,1)}static update(){if(Object.keys(this.requestedUpdates).length>0){const e=this.components.filter(t=>!t.parentUI);e.forEach(t=>this.traverseParsing(t)),e.forEach(t=>this.traverseUpdates(t))}}static traverseParsing(e){const t=this.requestedUpdates[e.id];t&&t.updateParsing&&(e.parseParams(),t.updateParsing=!1),e.childrenUIs.forEach(o=>this.traverseParsing(o))}static traverseUpdates(e){const t=this.requestedUpdates[e.id];delete this.requestedUpdates[e.id],t&&t.updateLayout&&(t.updateLayout=!1,e.updateLayout()),t&&t.updateInner&&(t.updateInner=!1,e.updateInner()),e.childrenUIs.forEach(o=>{this.traverseUpdates(o)}),t&&t.needCallback&&e.onAfterUpdate()}}UpdateManager.components=[];UpdateManager.requestedUpdates={};const Defaults={container:null,fontFamily:null,fontSize:.05,fontKerning:"normal",bestFit:"none",offset:.01,interLine:.01,breakOn:`- ,.:?!
`,whiteSpace:PRE_LINE,contentDirection:COLUMN,alignItems:CENTER,justifyContent:JustifyContent_START,textAlign:TextAlign_CENTER,textType:"MSDF",fontColor:new external_three_namespaceObject.Color(16777215),fontOpacity:1,fontPXRange:4,fontSupersampling:!0,borderRadius:.01,borderWidth:0,borderColor:new external_three_namespaceObject.Color("black"),borderOpacity:1,backgroundSize:"cover",backgroundColor:new external_three_namespaceObject.Color(2236962),backgroundWhiteColor:new external_three_namespaceObject.Color(16777215),backgroundOpacity:.8,backgroundOpaqueOpacity:1,getDefaultTexture,hiddenOverflow:!1,letterSpacing:0};let defaultTexture;function getDefaultTexture(){if(!defaultTexture){const n=document.createElement("canvas").getContext("2d");n.canvas.width=1,n.canvas.height=1,n.fillStyle="#ffffff",n.fillRect(0,0,1,1),defaultTexture=new external_three_namespaceObject.CanvasTexture(n.canvas),defaultTexture.isDefault=!0}return defaultTexture}function MeshUIComponent(n){return class extends n{constructor(o){super(o);Ie(this,"_rebuildParentUI",()=>{this.parent&&this.parent.isUI?this.parentUI=this.parent:this.parentUI=null});this.states={},this.currentState=void 0,this.isUI=!0,this.autoLayout=!0,this.childrenUIs=[],this.childrenBoxes=[],this.childrenTexts=[],this.childrenInlines=[],this.parentUI=null,this.addEventListener("added",this._rebuildParentUI),this.addEventListener("removed",this._rebuildParentUI)}getClippingPlanes(){const o=[];if(this.parentUI){if(this.isBlock&&this.parentUI.getHiddenOverflow()){const i=this.parentUI.getHeight()/2-(this.parentUI.padding||0),s=this.parentUI.getWidth()/2-(this.parentUI.padding||0),r=[new external_three_namespaceObject.Plane(new external_three_namespaceObject.Vector3(0,1,0),i),new external_three_namespaceObject.Plane(new external_three_namespaceObject.Vector3(0,-1,0),i),new external_three_namespaceObject.Plane(new external_three_namespaceObject.Vector3(1,0,0),s),new external_three_namespaceObject.Plane(new external_three_namespaceObject.Vector3(-1,0,0),s)];r.forEach(a=>{a.applyMatrix4(this.parent.matrixWorld)}),o.push(...r)}this.parentUI.parentUI&&o.push(...this.parentUI.getClippingPlanes())}return o}getHighestParent(){return this.parentUI?this.parent.getHighestParent():this}_getProperty(o){return this[o]===void 0&&this.parentUI?this.parent._getProperty(o):this[o]!==void 0?this[o]:Defaults[o]}getFontSize(){return this._getProperty("fontSize")}getFontKerning(){return this._getProperty("fontKerning")}getLetterSpacing(){return this._getProperty("letterSpacing")}getFontTexture(){return this.fontTexture===void 0&&this.parentUI?this.parent._getProperty("fontTexture"):this.fontTexture!==void 0?this.fontTexture:Defaults.getDefaultTexture()}getFontFamily(){return this._getProperty("fontFamily")}getBreakOn(){return this._getProperty("breakOn")}getWhiteSpace(){return this._getProperty("whiteSpace")}getTextAlign(){return this._getProperty("textAlign")}getTextType(){return this._getProperty("textType")}getFontColor(){return this._getProperty("fontColor")}getFontSupersampling(){return this._getProperty("fontSupersampling")}getFontOpacity(){return this._getProperty("fontOpacity")}getFontPXRange(){return this._getProperty("fontPXRange")}getBorderRadius(){return this._getProperty("borderRadius")}getBorderWidth(){return this._getProperty("borderWidth")}getBorderColor(){return this._getProperty("borderColor")}getBorderOpacity(){return this._getProperty("borderOpacity")}getContainer(){return!this.threeOBJ&&this.parent?this.parent.getContainer():this.threeOBJ?this:Defaults.container}getParentsNumber(o){return o=o||0,this.parentUI?this.parentUI.getParentsNumber(o+1):o}getBackgroundOpacity(){return!this.backgroundOpacity&&this.backgroundOpacity!==0?Defaults.backgroundOpacity:this.backgroundOpacity}getBackgroundColor(){return this.backgroundColor||Defaults.backgroundColor}getBackgroundTexture(){return this.backgroundTexture||Defaults.getDefaultTexture()}getAlignContent(){return this.alignContent||Defaults.alignContent}getAlignItems(){return this.alignItems||Defaults.alignItems}getContentDirection(){return this.contentDirection||Defaults.contentDirection}getJustifyContent(){return this.justifyContent||Defaults.justifyContent}getInterLine(){return this.interLine===void 0?Defaults.interLine:this.interLine}getOffset(){return this.offset===void 0?Defaults.offset:this.offset}getBackgroundSize(){return this.backgroundSize===void 0?Defaults.backgroundSize:this.backgroundSize}getHiddenOverflow(){return this.hiddenOverflow===void 0?Defaults.hiddenOverflow:this.hiddenOverflow}getBestFit(){return this.bestFit===void 0?Defaults.bestFit:this.bestFit}_rebuildChildrenLists(){this.childrenUIs=this.children.filter(o=>o.isUI),this.childrenBoxes=this.children.filter(o=>o.isBoxComponent),this.childrenInlines=this.children.filter(o=>o.isInline),this.childrenTexts=this.children.filter(o=>o.isText)}add(){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);const o=super.add(...arguments);return this._rebuildChildrenLists(),o}remove(){for(const i of Object.keys(arguments))arguments[i].isInline&&this.update(null,!0);const o=super.remove(...arguments);return this._rebuildChildrenLists(),o}update(o,i,s){UpdateManager.requestUpdate(this,o,i,s)}onAfterUpdate(){}_updateFontFamily(o){this.fontFamily=o,this.traverse(i=>{i.isUI&&i.update(!0,!0,!1)}),this.getHighestParent().update(!1,!0,!1)}_updateFontTexture(o){this.fontTexture=o,this.getHighestParent().update(!1,!0,!1)}set(o){let i,s,r;if(UpdateManager.register(this),!(!o||JSON.stringify(o)===JSON.stringify({}))){o.alignContent&&(o.alignItems=o.alignContent,o.textAlign||(o.textAlign=o.alignContent),console.warn("`alignContent` property has been deprecated, please rely on `alignItems` and `textAlign` instead."),delete o.alignContent),o.alignItems&&warnAboutDeprecatedAlignItems(o.alignItems);for(const a of Object.keys(o))if(this[a]!=o[a])switch(a){case"content":case"fontSize":case"fontKerning":case"breakOn":case"whiteSpace":this.isText&&(i=!0),s=!0,this[a]=o[a];break;case"bestFit":this.isBlock&&(i=!0,s=!0),this[a]=o[a];break;case"width":case"height":case"padding":(this.isInlineBlock||this.isBlock&&this.getBestFit()!="none")&&(i=!0),s=!0,this[a]=o[a];break;case"letterSpacing":case"interLine":this.isBlock&&this.getBestFit()!="none"&&(i=!0),s=!0,this[a]=o[a];break;case"margin":case"contentDirection":case"justifyContent":case"alignContent":case"alignItems":case"textAlign":case"textType":s=!0,this[a]=o[a];break;case"fontColor":case"fontOpacity":case"fontSupersampling":case"offset":case"backgroundColor":case"backgroundOpacity":case"backgroundTexture":case"backgroundSize":case"borderRadius":case"borderWidth":case"borderColor":case"borderOpacity":r=!0,this[a]=o[a];break;case"hiddenOverflow":this[a]=o[a];break}o.fontFamily&&core_FontLibrary.setFontFamily(this,o.fontFamily),o.fontTexture&&core_FontLibrary.setFontTexture(this,o.fontTexture),this.parentUI&&this.parentUI.getBestFit()!="none"&&this.parentUI.update(!0,!0,!1),this.update(i,s,r),s&&this.getHighestParent().update(!1,!0,!1)}}setupState(o){this.states[o.state]={attributes:o.attributes,onSet:o.onSet}}setState(o){const i=this.states[o];if(!i){console.warn(`state "${o}" does not exist within this component:`,this.name);return}o!==this.currentState&&(this.currentState=o,i.onSet&&i.onSet(),i.attributes&&this.set(i.attributes))}clear(){this.traverse(o=>{UpdateManager.disposeOf(o),o.material&&o.material.dispose(),o.geometry&&o.geometry.dispose()})}}}function MaterialManager(n){return class extends n{constructor(t){super(t),this.textUniforms={u_texture:{value:this.getFontTexture()},u_color:{value:this.getFontColor()},u_opacity:{value:this.getFontOpacity()},u_pxRange:{value:this.getFontPXRange()},u_useRGSS:{value:this.getFontSupersampling()}},this.backgroundUniforms={u_texture:{value:this.getBackgroundTexture()},u_color:{value:this.getBackgroundColor()},u_opacity:{value:this.getBackgroundOpacity()},u_backgroundMapping:{value:this.getBackgroundSize()},u_borderWidth:{value:this.getBorderWidth()},u_borderColor:{value:this.getBorderColor()},u_borderRadiusTopLeft:{value:this.getBorderRadius()},u_borderRadiusTopRight:{value:this.getBorderRadius()},u_borderRadiusBottomRight:{value:this.getBorderRadius()},u_borderRadiusBottomLeft:{value:this.getBorderRadius()},u_borderOpacity:{value:this.getBorderOpacity()},u_size:{value:new external_three_namespaceObject.Vector2(1,1)},u_tSize:{value:new external_three_namespaceObject.Vector2(1,1)}}}updateBackgroundMaterial(){this.backgroundUniforms.u_texture.value=this.getBackgroundTexture(),this.backgroundUniforms.u_tSize.value.set(this.backgroundUniforms.u_texture.value.image.width,this.backgroundUniforms.u_texture.value.image.height),this.size&&this.backgroundUniforms.u_size.value.copy(this.size),this.backgroundUniforms.u_texture.value.isDefault?(this.backgroundUniforms.u_color.value=this.getBackgroundColor(),this.backgroundUniforms.u_opacity.value=this.getBackgroundOpacity()):(this.backgroundUniforms.u_color.value=this.backgroundColor||Defaults.backgroundWhiteColor,this.backgroundUniforms.u_opacity.value=!this.backgroundOpacity&&this.backgroundOpacity!==0?Defaults.backgroundOpaqueOpacity:this.backgroundOpacity),this.backgroundUniforms.u_backgroundMapping.value=(()=>{switch(this.getBackgroundSize()){case"stretch":return 0;case"contain":return 1;case"cover":return 2}})();const t=this.getBorderRadius();this.backgroundUniforms.u_borderWidth.value=this.getBorderWidth(),this.backgroundUniforms.u_borderColor.value=this.getBorderColor(),this.backgroundUniforms.u_borderOpacity.value=this.getBorderOpacity(),Array.isArray(t)?(this.backgroundUniforms.u_borderRadiusTopLeft.value=t[0],this.backgroundUniforms.u_borderRadiusTopRight.value=t[1],this.backgroundUniforms.u_borderRadiusBottomRight.value=t[2],this.backgroundUniforms.u_borderRadiusBottomLeft.value=t[3]):(this.backgroundUniforms.u_borderRadiusTopLeft.value=t,this.backgroundUniforms.u_borderRadiusTopRight.value=t,this.backgroundUniforms.u_borderRadiusBottomRight.value=t,this.backgroundUniforms.u_borderRadiusBottomLeft.value=t)}updateTextMaterial(){this.textUniforms.u_texture.value=this.getFontTexture(),this.textUniforms.u_color.value=this.getFontColor(),this.textUniforms.u_opacity.value=this.getFontOpacity(),this.textUniforms.u_pxRange.value=this.getFontPXRange(),this.textUniforms.u_useRGSS.value=this.getFontSupersampling()}getBackgroundMaterial(){return(!this.backgroundMaterial||!this.backgroundUniforms)&&(this.backgroundMaterial=this._makeBackgroundMaterial()),this.backgroundMaterial}getFontMaterial(){return(!this.fontMaterial||!this.textUniforms)&&(this.fontMaterial=this._makeTextMaterial()),this.fontMaterial}_makeTextMaterial(){return new external_three_namespaceObject.ShaderMaterial({uniforms:this.textUniforms,transparent:!0,clipping:!0,vertexShader:textVertex,fragmentShader:textFragment,extensions:{derivatives:!0}})}_makeBackgroundMaterial(){return new external_three_namespaceObject.ShaderMaterial({uniforms:this.backgroundUniforms,transparent:!0,clipping:!0,vertexShader:backgroundVertex,fragmentShader:backgroundFragment,extensions:{derivatives:!0}})}updateClippingPlanes(t){const o=t!==void 0?t:this.getClippingPlanes();JSON.stringify(o)!==JSON.stringify(this.clippingPlanes)&&(this.clippingPlanes=o,this.fontMaterial&&(this.fontMaterial.clippingPlanes=this.clippingPlanes),this.backgroundMaterial&&(this.backgroundMaterial.clippingPlanes=this.clippingPlanes))}}}const textVertex=`
varying vec2 vUv;

#include <clipping_planes_pars_vertex>

void main() {

	vUv = uv;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;
	gl_Position.z -= 0.00001;

	#include <clipping_planes_vertex>

}
`,textFragment=`

uniform sampler2D u_texture;
uniform vec3 u_color;
uniform float u_opacity;
uniform float u_pxRange;
uniform bool u_useRGSS;

varying vec2 vUv;

#include <clipping_planes_pars_fragment>

// functions from the original msdf repo:
// https://github.com/Chlumsky/msdfgen#using-a-multi-channel-distance-field

float median(float r, float g, float b) {
	return max(min(r, g), min(max(r, g), b));
}

float screenPxRange() {
	vec2 unitRange = vec2(u_pxRange)/vec2(textureSize(u_texture, 0));
	vec2 screenTexSize = vec2(1.0)/fwidth(vUv);
	return max(0.5*dot(unitRange, screenTexSize), 1.0);
}

float tap(vec2 offsetUV) {
	vec3 msd = texture( u_texture, offsetUV ).rgb;
	float sd = median(msd.r, msd.g, msd.b);
	float screenPxDistance = screenPxRange() * (sd - 0.5);
	float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
	return alpha;
}

void main() {

	float alpha;

	if ( u_useRGSS ) {

		// shader-based supersampling based on https://bgolus.medium.com/sharper-mipmapping-using-shader-based-supersampling-ed7aadb47bec
		// per pixel partial derivatives
		vec2 dx = dFdx(vUv);
		vec2 dy = dFdy(vUv);

		// rotated grid uv offsets
		vec2 uvOffsets = vec2(0.125, 0.375);
		vec2 offsetUV = vec2(0.0, 0.0);

		// supersampled using 2x2 rotated grid
		alpha = 0.0;
		offsetUV.xy = vUv + uvOffsets.x * dx + uvOffsets.y * dy;
		alpha += tap(offsetUV);
		offsetUV.xy = vUv - uvOffsets.x * dx - uvOffsets.y * dy;
		alpha += tap(offsetUV);
		offsetUV.xy = vUv + uvOffsets.y * dx - uvOffsets.x * dy;
		alpha += tap(offsetUV);
		offsetUV.xy = vUv - uvOffsets.y * dx + uvOffsets.x * dy;
		alpha += tap(offsetUV);
		alpha *= 0.25;

	} else {

		alpha = tap( vUv );

	}


	// apply the opacity
	alpha *= u_opacity;

	// this is useful to avoid z-fighting when quads overlap because of kerning
	if ( alpha < 0.02) discard;


	gl_FragColor = vec4( u_color, alpha );

	#include <clipping_planes_fragment>

}
`,backgroundVertex=`
varying vec2 vUv;

#include <clipping_planes_pars_vertex>

void main() {

	vUv = uv;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;

	#include <clipping_planes_vertex>

}
`,backgroundFragment=`

uniform sampler2D u_texture;
uniform vec3 u_color;
uniform float u_opacity;

uniform float u_borderRadiusTopLeft;
uniform float u_borderRadiusTopRight;
uniform float u_borderRadiusBottomLeft;
uniform float u_borderRadiusBottomRight;
uniform float u_borderWidth;
uniform vec3 u_borderColor;
uniform float u_borderOpacity;
uniform vec2 u_size;
uniform vec2 u_tSize;
uniform int u_backgroundMapping;

varying vec2 vUv;

#include <clipping_planes_pars_fragment>

float getEdgeDist() {
	vec2 ndc = vec2( vUv.x * 2.0 - 1.0, vUv.y * 2.0 - 1.0 );
	vec2 planeSpaceCoord = vec2( u_size.x * 0.5 * ndc.x, u_size.y * 0.5 * ndc.y );
	vec2 corner = u_size * 0.5;
	vec2 offsetCorner = corner - abs( planeSpaceCoord );
	float innerRadDist = min( offsetCorner.x, offsetCorner.y ) * -1.0;
	if (vUv.x < 0.5 && vUv.y >= 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusTopLeft, 0.0 ) ) - u_borderRadiusTopLeft;
		float s = step( innerRadDist * -1.0, u_borderRadiusTopLeft );
		return mix( innerRadDist, roundedDist, s );
	}
	if (vUv.x >= 0.5 && vUv.y >= 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusTopRight, 0.0 ) ) - u_borderRadiusTopRight;
		float s = step( innerRadDist * -1.0, u_borderRadiusTopRight );
		return mix( innerRadDist, roundedDist, s );
	}
	if (vUv.x >= 0.5 && vUv.y < 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusBottomRight, 0.0 ) ) - u_borderRadiusBottomRight;
		float s = step( innerRadDist * -1.0, u_borderRadiusBottomRight );
		return mix( innerRadDist, roundedDist, s );
	}
	if (vUv.x < 0.5 && vUv.y < 0.5) {
		float roundedDist = length( max( abs( planeSpaceCoord ) - u_size * 0.5 + u_borderRadiusBottomLeft, 0.0 ) ) - u_borderRadiusBottomLeft;
		float s = step( innerRadDist * -1.0, u_borderRadiusBottomLeft );
		return mix( innerRadDist, roundedDist, s );
	}
}

vec4 sampleTexture() {
	float textureRatio = u_tSize.x / u_tSize.y;
	float panelRatio = u_size.x / u_size.y;
	vec2 uv = vUv;
	if ( u_backgroundMapping == 1 ) { // contain
		if ( textureRatio < panelRatio ) { // repeat on X
			float newX = uv.x * ( panelRatio / textureRatio );
			newX += 0.5 - 0.5 * ( panelRatio / textureRatio );
			uv.x = newX;
		} else { // repeat on Y
			float newY = uv.y * ( textureRatio / panelRatio );
			newY += 0.5 - 0.5 * ( textureRatio / panelRatio );
			uv.y = newY;
		}
	} else if ( u_backgroundMapping == 2 ) { // cover
		if ( textureRatio < panelRatio ) { // stretch on Y
			float newY = uv.y * ( textureRatio / panelRatio );
			newY += 0.5 - 0.5 * ( textureRatio / panelRatio );
			uv.y = newY;
		} else { // stretch on X
			float newX = uv.x * ( panelRatio / textureRatio );
			newX += 0.5 - 0.5 * ( panelRatio / textureRatio );
			uv.x = newX;
		}
	}
	return texture2D( u_texture, uv ).rgba;
}

void main() {

	float edgeDist = getEdgeDist();
	float change = fwidth( edgeDist );

	vec4 textureSample = sampleTexture();
	vec3 blendedColor = textureSample.rgb * u_color;

	float alpha = smoothstep( change, 0.0, edgeDist );
	float blendedOpacity = u_opacity * textureSample.a * alpha;

	vec4 frameColor = vec4( blendedColor, blendedOpacity );

	if ( u_borderWidth <= 0.0 ) {
		gl_FragColor = frameColor;
	} else {
		vec4 borderColor = vec4( u_borderColor, u_borderOpacity * alpha );
		float stp = smoothstep( edgeDist + change, edgeDist, u_borderWidth * -1.0 );
		gl_FragColor = mix( frameColor, borderColor, stp );
	}

	#include <clipping_planes_fragment>
}
`;class Frame extends external_three_namespaceObject.Mesh{constructor(e){const t=new external_three_namespaceObject.PlaneGeometry;super(t,e),this.castShadow=!0,this.receiveShadow=!0,this.name="MeshUI-Frame"}}let _Base=null;function mix(...n){if(!_Base)throw new Error("Cannot use mixins with Base null");let e=_Base;_Base=null;let t=n.length,o;for(;--t>=0;)o=n[t],e=o(e);return e}mix.withBase=n=>(_Base=n,mix);class Block extends mix.withBase(external_three_namespaceObject.Object3D)(BoxComponent,InlineManager,MaterialManager,MeshUIComponent){constructor(e){super(e),this.isBlock=!0,this.size=new external_three_namespaceObject.Vector2(1,1),this.frame=new Frame(this.getBackgroundMaterial()),this.frame.onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()},this.add(this.frame),this.set(e)}parseParams(){const e=this.getBestFit();e!="none"&&this.childrenTexts.length?this.calculateBestFit(e):this.childrenTexts.forEach(t=>{t._fitFontSize=void 0})}updateLayout(){const e=this.getWidth(),t=this.getHeight();if(!e||!t){console.warn("Block got no dimension from its parameters or from children parameters");return}this.size.set(e,t),this.frame.scale.set(e,t,1),this.frame&&this.updateBackgroundMaterial(),this.frame.renderOrder=this.getParentsNumber(),this.autoLayout&&this.setPosFromParentRecords(),this.childrenInlines.length&&this.computeInlinesPosition(),this.computeChildrenPosition(),this.parentUI&&(this.position.z=this.getOffset())}updateInner(){this.parentUI&&(this.position.z=this.getOffset()),this.frame&&this.updateBackgroundMaterial()}}function InlineComponent(n){return class extends n{constructor(t){super(t),this.isInline=!0}}}function mergeBufferGeometries(n,e=!1){const t=n[0].index!==null,o=new Set(Object.keys(n[0].attributes)),i=new Set(Object.keys(n[0].morphAttributes)),s={},r={},a=n[0].morphTargetsRelative,l=new external_three_namespaceObject.BufferGeometry;let c=0;for(let d=0;d<n.length;++d){const u=n[d];let f=0;if(t!==(u.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const h in u.attributes){if(!o.has(h))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+'. All geometries must have compatible attributes; make sure "'+h+'" attribute exists among all geometries, or in none of them.'),null;s[h]===void 0&&(s[h]=[]),s[h].push(u.attributes[h]),f++}if(f!==o.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". Make sure all geometries have the same number of attributes."),null;if(a!==u.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const h in u.morphAttributes){if(!i.has(h))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+".  .morphAttributes must be consistent throughout all geometries."),null;r[h]===void 0&&(r[h]=[]),r[h].push(u.morphAttributes[h])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(u.userData),e){let h;if(t)h=u.index.count;else if(u.attributes.position!==void 0)h=u.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+d+". The geometry must have either an index or a position attribute"),null;l.addGroup(c,h,d),c+=h}}if(t){let d=0;const u=[];for(let f=0;f<n.length;++f){const h=n[f].index;for(let m=0;m<h.count;++m)u.push(h.getX(m)+d);d+=n[f].attributes.position.count}l.setIndex(u)}for(const d in s){const u=mergeBufferAttributes(s[d]);if(!u)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+d+" attribute."),null;l.setAttribute(d,u)}for(const d in r){const u=r[d][0].length;if(u===0)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[d]=[];for(let f=0;f<u;++f){const h=[];for(let p=0;p<r[d].length;++p)h.push(r[d][p][f]);const m=mergeBufferAttributes(h);if(!m)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+d+" morphAttribute."),null;l.morphAttributes[d].push(m)}}return l}function mergeBufferAttributes(n){let e,t,o,i=0;for(let a=0;a<n.length;++a){const l=n[a];if(l.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=l.array.constructor),e!==l.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=l.itemSize),t!==l.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(o===void 0&&(o=l.normalized),o!==l.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;i+=l.array.length}const s=new e(i);let r=0;for(let a=0;a<n.length;++a)s.set(n[a].array,r),r+=n[a].array.length;return new external_three_namespaceObject.BufferAttribute(s,t,o)}class MSDFGlyph extends external_three_namespaceObject.PlaneGeometry{constructor(e,t){const o=e.glyph,i=e.fontSize;super(e.width,e.height),o.match(/\s/g)===null?(t.info.charset.indexOf(o)===-1&&console.error(`The character '${o}' is not included in the font characters set.`),this.mapUVs(t,o),this.transformGeometry(e)):(this.nullifyUVs(),this.scale(0,0,1),this.translate(0,i/2,0))}mapUVs(e,t){const o=e.chars.find(d=>d.char===t),i=e.common,s=o.x/i.scaleW,r=(o.x+o.width)/i.scaleW,a=1-(o.y+o.height)/i.scaleH,l=1-o.y/i.scaleH,c=this.attributes.uv;for(let d=0;d<c.count;d++){let u=c.getX(d),f=c.getY(d);[u,f]=(()=>{switch(d){case 0:return[s,l];case 1:return[r,l];case 2:return[s,a];case 3:return[r,a]}})(),c.setXY(d,u,f)}}nullifyUVs(){const e=this.attributes.uv;for(let t=0;t<e.count;t++)e.setXY(t,0,0)}transformGeometry(e){this.translate(e.width/2,e.height/2,0)}}function getGlyphDimensions(n){const e=n.font,t=n.fontSize,o=n.glyph,i=t/e.info.size,s=e.chars.find(u=>u.char===o);let r=s?s.width*i:t/3,a=s?s.height*i:0;r===0&&(r=s?s.xadvance*i:t),a===0&&(a=t*.7),o===`
`&&(r=0);const l=s?s.xadvance*i:r,c=s?s.xoffset*i:0,d=s?s.yoffset*i:0;return{width:r,height:a,anchor:d,xadvance:l,xoffset:c}}function getGlyphPairKerning(n,e){const t=n._kernings;return t[e]?t[e]:0}function buildText(){const n=[];this.inlines.forEach((o,i)=>{n[i]=new MSDFGlyph(o,this.getFontFamily()),n[i].translate(o.offsetX,o.offsetY,0)});const e=mergeBufferGeometries(n);return new external_three_namespaceObject.Mesh(e,this.getFontMaterial())}const MSDFText={getGlyphDimensions,getGlyphPairKerning,buildText};function TextManager(n){return class extends n{createText(){const t=this,o=(()=>{switch(this.getTextType()){case"MSDF":return MSDFText.buildText.call(this);default:console.warn(`'${this.getTextType()}' is not a supported text type.
See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);break}})();return o.renderOrder=1/0,o.onBeforeRender=function(){t.updateClippingPlanes&&t.updateClippingPlanes()},o}getGlyphDimensions(t){switch(t.textType){case"MSDF":return MSDFText.getGlyphDimensions(t);default:console.warn(`'${t.textType}' is not a supported text type.
See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);break}}getGlyphPairKerning(t,o,i){switch(t){case"MSDF":return MSDFText.getGlyphPairKerning(o,i);default:console.warn(`'${t}' is not a supported text type.
See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);break}}}}function deepDelete(n){n.children.forEach(e=>{e.children.length>0&&deepDelete(e),n.remove(e),UpdateManager.disposeOf(e),e.material&&e.material.dispose(),e.geometry&&e.geometry.dispose()}),n.children=[]}const utils_deepDelete=deepDelete;class Text extends mix.withBase(external_three_namespaceObject.Object3D)(InlineComponent,TextManager,MaterialManager,MeshUIComponent){constructor(e){super(e),this.isText=!0,this.set(e)}parseParams(){this.calculateInlines(this._fitFontSize||this.getFontSize())}updateLayout(){utils_deepDelete(this),this.inlines&&(this.textContent=this.createText(),this.updateTextMaterial(),this.add(this.textContent)),this.position.z=this.getOffset()}updateInner(){this.position.z=this.getOffset(),this.textContent&&this.updateTextMaterial()}calculateInlines(e){const t=this.content,o=this.getFontFamily(),i=this.getBreakOn(),s=this.getTextType(),r=this.getWhiteSpace();if(!o||typeof o=="string"){core_FontLibrary.getFontOf(this)||console.warn("no font was found");return}if(!this.content){this.inlines=null;return}if(!s){console.error(`You must provide a 'textType' attribute so three-mesh-ui knows how to render your text.
 See https://github.com/felixmariotto/three-mesh-ui/wiki/Using-a-custom-text-type`);return}const a=collapseWhitespaceOnString(t,r),l=Array.from?Array.from(a):String(a).split(""),c=e/o.info.size,d=o.common.lineHeight*c,u=o.common.base*c,f=l.map(h=>{const m=this.getGlyphDimensions({textType:s,glyph:h,font:o,fontSize:e});let p=null;return r!==NOWRAP&&(i.includes(h)||h.match(/\s/g))&&(p="possible"),h.match(/\n/g)&&(p=newlineBreakability(r)),{height:m.height,width:m.width,anchor:m.anchor,xadvance:m.xadvance,xoffset:m.xoffset,lineBreak:p,glyph:h,fontSize:e,lineHeight:d,lineBase:u}});if(this.getFontKerning()!=="none")for(let h=1;h<f.length;h++){const m=f[h],p=f[h-1].glyph+f[h].glyph,v=this.getGlyphPairKerning(s,o,p);m.kerning=v*(e/o.info.size)}this.inlines=f}}class InlineBlock extends mix.withBase(external_three_namespaceObject.Object3D)(InlineComponent,BoxComponent,InlineManager,MaterialManager,MeshUIComponent){constructor(e){super(e),this.isInlineBlock=!0,this.size=new external_three_namespaceObject.Vector2(1,1),this.frame=new Frame(this.getBackgroundMaterial()),this.frame.onBeforeRender=()=>{this.updateClippingPlanes&&this.updateClippingPlanes()},this.add(this.frame),this.set(e)}parseParams(){this.width||console.warn("inlineBlock has no width. Set to 0.3 by default"),this.height||console.warn("inlineBlock has no height. Set to 0.3 by default"),this.inlines=[{height:this.height||.3,width:this.width||.3,anchor:0,lineBreak:"possible"}]}updateLayout(){const e=this.getWidth(),t=this.getHeight();if(this.inlines){const o=this.inlines[0];this.position.set(o.width/2,o.height/2,0),this.position.x+=o.offsetX,this.position.y+=o.offsetY}this.size.set(e,t),this.frame.scale.set(e,t,1),this.frame&&this.updateBackgroundMaterial(),this.frame.renderOrder=this.getParentsNumber(),this.childrenInlines.length&&this.computeInlinesPosition(),this.computeChildrenPosition(),this.position.z=this.getOffset()}updateInner(){this.position.z=this.getOffset(),this.frame&&this.updateBackgroundMaterial()}}const Keymaps={fr:[[[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]}],[{width:.2,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],eng:[[[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],ru:[[[{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"q",upperCase:"Q"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"w",upperCase:"W"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"e",upperCase:"E"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"r",upperCase:"R"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"t",upperCase:"T"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"y",upperCase:"Y"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"u",upperCase:"U"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"i",upperCase:"I"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"o",upperCase:"O"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"p",upperCase:"P"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"{",upperCase:"["}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"}",upperCase:"]"}]}],[{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"a",upperCase:"A"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"s",upperCase:"S"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"d",upperCase:"D"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"f",upperCase:"F"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"g",upperCase:"G"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"h",upperCase:"H"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"j",upperCase:"J"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"k",upperCase:"K"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"l",upperCase:"L"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:":",upperCase:";"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:'"',upperCase:"'"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"|",upperCase:"\\"}]}],[{width:1.5/12,command:"shift",chars:[{icon:"shift"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"z",upperCase:"Z"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"x",upperCase:"X"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"c",upperCase:"C"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"v",upperCase:"V"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"b",upperCase:"B"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"n",upperCase:"N"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:"m",upperCase:"M"}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:",",upperCase:""}]},{width:1/12,chars:[{lowerCase:"",upperCase:""},{lowerCase:".",upperCase:""}]},{width:1.5/12,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.15,command:"switch-set",chars:[{lowerCase:"eng"}]},{width:.15,command:"switch",chars:[{lowerCase:".?12"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.3,command:"switch",chars:[{lowerCase:""}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],de:[[[{width:1/11,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:1/11,chars:[{lowerCase:"w",upperCase:"W"}]},{width:1/11,chars:[{lowerCase:"e",upperCase:"E"}]},{width:1/11,chars:[{lowerCase:"r",upperCase:"R"}]},{width:1/11,chars:[{lowerCase:"t",upperCase:"T"}]},{width:1/11,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:1/11,chars:[{lowerCase:"u",upperCase:"U"}]},{width:1/11,chars:[{lowerCase:"i",upperCase:"I"}]},{width:1/11,chars:[{lowerCase:"o",upperCase:"O"}]},{width:1/11,chars:[{lowerCase:"p",upperCase:"P"}]},{width:1/11,chars:[{lowerCase:"",upperCase:""}]}],[{width:1/11,chars:[{lowerCase:"a",upperCase:"A"}]},{width:1/11,chars:[{lowerCase:"s",upperCase:"S"}]},{width:1/11,chars:[{lowerCase:"d",upperCase:"D"}]},{width:1/11,chars:[{lowerCase:"f",upperCase:"F"}]},{width:1/11,chars:[{lowerCase:"g",upperCase:"G"}]},{width:1/11,chars:[{lowerCase:"h",upperCase:"H"}]},{width:1/11,chars:[{lowerCase:"j",upperCase:"J"}]},{width:1/11,chars:[{lowerCase:"k",upperCase:"K"}]},{width:1/11,chars:[{lowerCase:"l",upperCase:"L"}]},{width:1/11,chars:[{lowerCase:"",upperCase:""}]},{width:1/11,chars:[{lowerCase:"",upperCase:""}]}],[{width:2/11,command:"shift",chars:[{icon:"shift"}]},{width:1/11,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:1/11,chars:[{lowerCase:"x",upperCase:"X"}]},{width:1/11,chars:[{lowerCase:"c",upperCase:"C"}]},{width:1/11,chars:[{lowerCase:"v",upperCase:"V"}]},{width:1/11,chars:[{lowerCase:"b",upperCase:"B"}]},{width:1/11,chars:[{lowerCase:"n",upperCase:"N"}]},{width:1/11,chars:[{lowerCase:"m",upperCase:"M"}]},{width:2/11,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],es:[[[{width:.1,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"l",upperCase:"L"}]},{width:.1,chars:[{lowerCase:"",upperCase:""}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],el:[[[{width:.1,chars:[{lowerCase:";",upperCase:":"},{lowerCase:"q",upperCase:"Q"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"w",upperCase:"W"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"e",upperCase:"E"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"r",upperCase:"R"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"t",upperCase:"T"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"y",upperCase:"Y"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"u",upperCase:"U"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"i",upperCase:"I"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"o",upperCase:"O"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"p",upperCase:"P"}]}],[{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"a",upperCase:"A"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"s",upperCase:"S"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"d",upperCase:"D"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"f",upperCase:"F"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"g",upperCase:"G"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"h",upperCase:"H"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"j",upperCase:"J"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"k",upperCase:"K"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"l",upperCase:"L"}]}],[{width:.15,command:"shift",chars:[{icon:"shift"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"z",upperCase:"Z"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"x",upperCase:"X"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"c",upperCase:"C"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"v",upperCase:"V"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"b",upperCase:"B"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"n",upperCase:"N"}]},{width:.1,chars:[{lowerCase:"",upperCase:""},{lowerCase:"m",upperCase:"M"}]},{width:.15,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.15,command:"switch-set",chars:[{lowerCase:"eng"}]},{width:.15,command:"switch",chars:[{lowerCase:".?12"}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]],nord:[[[{width:1/11,chars:[{lowerCase:"q",upperCase:"Q"}]},{width:1/11,chars:[{lowerCase:"w",upperCase:"W"}]},{width:1/11,chars:[{lowerCase:"e",upperCase:"E"}]},{width:1/11,chars:[{lowerCase:"r",upperCase:"R"}]},{width:1/11,chars:[{lowerCase:"t",upperCase:"T"}]},{width:1/11,chars:[{lowerCase:"y",upperCase:"Y"}]},{width:1/11,chars:[{lowerCase:"u",upperCase:"U"}]},{width:1/11,chars:[{lowerCase:"i",upperCase:"I"}]},{width:1/11,chars:[{lowerCase:"o",upperCase:"O"}]},{width:1/11,chars:[{lowerCase:"p",upperCase:"P"}]},{width:1/11,chars:[{lowerCase:"",upperCase:""}]}],[{width:1/11,chars:[{lowerCase:"a",upperCase:"A"}]},{width:1/11,chars:[{lowerCase:"s",upperCase:"S"}]},{width:1/11,chars:[{lowerCase:"d",upperCase:"D"}]},{width:1/11,chars:[{lowerCase:"f",upperCase:"F"}]},{width:1/11,chars:[{lowerCase:"g",upperCase:"G"}]},{width:1/11,chars:[{lowerCase:"h",upperCase:"H"}]},{width:1/11,chars:[{lowerCase:"j",upperCase:"J"}]},{width:1/11,chars:[{lowerCase:"k",upperCase:"K"}]},{width:1/11,chars:[{lowerCase:"l",upperCase:"L"}]},{width:1/11,chars:[{lowerCase:"",upperCase:""}]},{width:1/11,chars:[{lowerCase:"",upperCase:""}]}],[{width:2/11,command:"shift",chars:[{icon:"shift"}]},{width:1/11,chars:[{lowerCase:"z",upperCase:"Z"}]},{width:1/11,chars:[{lowerCase:"x",upperCase:"X"}]},{width:1/11,chars:[{lowerCase:"c",upperCase:"C"}]},{width:1/11,chars:[{lowerCase:"v",upperCase:"V"}]},{width:1/11,chars:[{lowerCase:"b",upperCase:"B"}]},{width:1/11,chars:[{lowerCase:"n",upperCase:"N"}]},{width:1/11,chars:[{lowerCase:"m",upperCase:"M"}]},{width:2/11,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]],[[{width:.1,chars:[{lowerCase:"1"}]},{width:.1,chars:[{lowerCase:"2"}]},{width:.1,chars:[{lowerCase:"3"}]},{width:.1,chars:[{lowerCase:"4"}]},{width:.1,chars:[{lowerCase:"5"}]},{width:.1,chars:[{lowerCase:"6"}]},{width:.1,chars:[{lowerCase:"7"}]},{width:.1,chars:[{lowerCase:"8"}]},{width:.1,chars:[{lowerCase:"9"}]},{width:.1,chars:[{lowerCase:"0"}]}],[{width:.1,chars:[{lowerCase:"@"}]},{width:.1,chars:[{lowerCase:"#"}]},{width:.1,chars:[{lowerCase:"|"}]},{width:.1,chars:[{lowerCase:"_"}]},{width:.1,chars:[{lowerCase:"&"}]},{width:.1,chars:[{lowerCase:"-"}]},{width:.1,chars:[{lowerCase:"+"}]},{width:.1,chars:[{lowerCase:"("}]},{width:.1,chars:[{lowerCase:")"}]},{width:.1,chars:[{lowerCase:"/"}]}],[{width:.1,chars:[{lowerCase:"="}]},{width:.1,chars:[{lowerCase:"*"}]},{width:.1,chars:[{lowerCase:'"'}]},{width:.1,chars:[{lowerCase:"'"}]},{width:.1,chars:[{lowerCase:":"}]},{width:.1,chars:[{lowerCase:";"}]},{width:.1,chars:[{lowerCase:"!"}]},{width:.1,chars:[{lowerCase:"?"}]},{width:.2,command:"backspace",chars:[{icon:"backspace"}]}],[{width:.2,command:"switch",chars:[{lowerCase:".?12"}]},{width:.1,chars:[{lowerCase:","}]},{width:.4,command:"space",chars:[{icon:"space"}]},{width:.1,chars:[{lowerCase:"."}]},{width:.2,command:"enter",chars:[{icon:"enter"}]}]]]},Keyboard_textureLoader=new external_three_namespaceObject.TextureLoader;class Keyboard extends mix.withBase(external_three_namespaceObject.Object3D)(BoxComponent,MeshUIComponent){constructor(e){e||(e={}),e.width||(e.width=1),e.height||(e.height=.4),e.margin||(e.margin=.003),e.padding||(e.padding=.01),super(e),this.currentPanel=0,this.isLowerCase=!0,this.charsetCount=1;let t;if(e.language||navigator.language)switch(e.language||navigator.language){case"fr":case"fr-CH":case"fr-CA":t=Keymaps.fr;break;case"ru":this.charsetCount=2,t=Keymaps.ru;break;case"de":case"de-DE":case"de-AT":case"de-LI":case"de-CH":t=Keymaps.de;break;case"es":case"es-419":case"es-AR":case"es-CL":case"es-CO":case"es-ES":case"es-CR":case"es-US":case"es-HN":case"es-MX":case"es-PE":case"es-UY":case"es-VE":t=Keymaps.es;break;case"el":this.charsetCount=2,t=Keymaps.el;break;case"nord":t=Keymaps.nord;break;default:t=Keymaps.eng;break}else t=Keymaps.eng;this.keys=[],this.panels=t.map(o=>{const i=e.height/o.length-e.margin*2,s=new Block({width:e.width+e.padding*2,height:e.height+e.padding*2,offset:0,padding:e.padding,fontFamily:e.fontFamily,fontTexture:e.fontTexture,backgroundColor:e.backgroundColor,backgroundOpacity:e.backgroundOpacity});return s.charset=0,s.add(...o.map(r=>{const a=new Block({width:e.width,height:i,margin:e.margin,contentDirection:"row",justifyContent:"center"});a.frame.visible=!1;const l=[];return r.forEach(c=>{const d=new Block({width:e.width*c.width-e.margin*2,height:i,margin:e.margin,justifyContent:"center",offset:0}),u=c.chars[s.charset].lowerCase||c.chars[s.charset].icon||"undif";if(u==="enter"&&e.enterTexture||u==="shift"&&e.shiftTexture||u==="backspace"&&e.backspaceTexture){const f=(()=>{switch(u){case"backspace":return e.backspaceTexture;case"enter":return e.enterTexture;case"shift":return e.shiftTexture;default:console.warn("There is no icon image for this key")}})();Keyboard_textureLoader.load(f,h=>{d.add(new InlineBlock({width:d.width*.65,height:d.height*.65,backgroundSize:"contain",backgroundTexture:h}))})}else d.add(new Text({content:u,offset:0}));d.type="Key",d.info=c,d.info.input=u,d.panel=s,l.push(d),this.keys.push(d)}),a.add(...l),a})),s}),this.add(this.panels[0]),this.set(e)}setNextPanel(){this.panels.forEach(e=>{this.remove(e)}),this.currentPanel=(this.currentPanel+1)%this.panels.length,this.add(this.panels[this.currentPanel]),this.update(!0,!0,!0)}setNextCharset(){this.panels[this.currentPanel].charset=(this.panels[this.currentPanel].charset+1)%this.charsetCount,this.keys.forEach(e=>{if(!this.panels[this.currentPanel].getObjectById(e.id))return;const o=e.info.chars[e.panel.charset]||e.info.chars[0],i=this.isLowerCase||!o.upperCase?o.lowerCase:o.upperCase;if(!e.childrenTexts.length)return;const s=e.childrenTexts[0];e.info.input=i,s.set({content:i}),s.update(!0,!0,!0)})}toggleCase(){this.isLowerCase=!this.isLowerCase,this.keys.forEach(e=>{const t=e.info.chars[e.panel.charset]||e.info.chars[0],o=this.isLowerCase||!t.upperCase?t.lowerCase:t.upperCase;if(!e.childrenTexts.length)return;const i=e.childrenTexts[0];e.info.input=o,i.set({content:o}),i.update(!0,!0,!0)})}parseParams(){}updateLayout(){}updateInner(){}}const update=()=>UpdateManager.update(),ThreeMeshUI={Block,Text,InlineBlock,Keyboard,FontLibrary:core_FontLibrary,update,TextAlign:TextAlign_namespaceObject,Whitespace:Whitespace_namespaceObject,JustifyContent:JustifyContent_namespaceObject,AlignItems:AlignItems_namespaceObject,ContentDirection:ContentDirection_namespaceObject};typeof global<"u"&&(global.ThreeMeshUI=ThreeMeshUI);const three_mesh_ui=ThreeMeshUI;__webpack_exports__.g1;var __webpack_exports__Block=__webpack_exports__.gO;__webpack_exports__.km;__webpack_exports__.zV;__webpack_exports__.ol;__webpack_exports__.uM;__webpack_exports__.N1;var __webpack_exports__Text=__webpack_exports__.xv;__webpack_exports__.PH;__webpack_exports__.UH;var __webpack_exports__default=__webpack_exports__.ZP,__webpack_exports__update=__webpack_exports__.Vx;const CDN_BASE$2=(()=>{if(typeof window<"u"){if(window.ASSETS_CDN_BASE)return window.ASSETS_CDN_BASE;if(window.ASSETS_R2_ACCOUNT_ID)return`https://${window.ASSETS_R2_ACCOUNT_ID}.r2.dev`}return"https://pub-4dc5824a7d6645b29006348054fb1f3f.r2.dev"})(),isDevHost$2=()=>{if(typeof window>"u")return!1;const n=window.location.hostname;return n==="localhost"||n==="127.0.0.1"||n==="::1"||/^10\./.test(n)||/^192\.168\./.test(n)||/^172\.(1[6-9]|2[0-9]|3[0-1])\./.test(n)},toCDN$2=n=>{if(n.startsWith("/r2/")){if(isDevHost$2())return n;const e=n.replace(/^\/r2\//,"/");return CDN_BASE$2?`${CDN_BASE$2}${e}`:e}return n},assetsEntry$4={characters:[{name:"electro",path:"/characters/electro_facialv7.glb"}],models:[{name:"underground",path:toCDN$2("/r2/baked_6.9.glb"),shadow:!0},{name:"unoModel",path:"/scene55/uno11.glb"},{name:"nanoModel",path:"/scene55/nano6.glb"},{name:"ldrModel",path:"/scene55/ldr9.glb"},{name:"irModel",path:"/scene55/ir91.glb"},{name:"buck",path:"/scene55/ubec3.glb"},{name:"motordriverModel",path:"/scene55/motordriver1.glb"},{name:"buttonModel",path:"/scene55/button.glb"},{name:"buzzerModel",path:"/scene55/buzzer2.glb"},{name:"pcbModel",path:"/scene55/pcb3.glb"},{name:"rgbModel",path:"/scene55/rgb1.glb"},{name:"motorModel",path:"/scene55/motor.glb"}],textures:[{name:"meshpicture",path:"/scene55/meshimage1.jpg"}],videoTextures:[{name:"hudvideo2",path:"/scene55/zoehud.mp4"},{name:"screenvideo",path:"/scene55/screenvideo.mp4"},{name:"meshvideo",path:"/scene55/screenvideo.mp4"}],audios:[{name:"background",path:"/audios/background.mp3",volume:1,loop:!0},{name:"scene5Intro",path:"/audios/scene5intro.mp3",volume:1,loop:!1},{name:"electrosound",path:"/scene55/electrosound.wav"},{name:"electrosound1",path:"/scene55/electrosound2.wav"},{name:"electrosound2",path:"/scene55/electrosound4.wav"},{name:"electrosound3",path:"/scene55/electrosound5.wav"},{name:"electrosound4",path:"/scene55/electrosound7.mp3"},{name:"componentsound",path:"/scene55/componentsound.mp3"},{name:"bytepanelsound",path:"/scene55/bytepanelsound.mp3"},{name:"spark",path:"/scene55/spark.mp3"}],hdris:[{name:"sky",path:"/hdris/sky.hdr"}],cubeMaps:[],vfxs:[],pathFiles:[],jsonFiles:[],fonts:[{fontName:"roboto",data:{jsonDataPath:"/fonts/msdf/Roboto-msdf.json",textureDataPath:"/fonts/msdf/Roboto-msdf.png"}}],svgs:[]};let container$3,canvas$3,ctx$3,toggleBtn$3,visible$3=!1,physicsController$3,backgroundPattern$3=null;const markers$3=[{type:"portal",color:"#ff00ff",size:8,position:{x:-27.6,y:0,z:-.5}},{type:"info",color:"#ff0000",size:6,position:{x:-3.7,y:0,z:-3}},{type:"objective",color:"#00ff11",size:6,position:{x:-32,y:0,z:-.5}}],playerMarker$3={color:"#00f6ff",size:6},canvasSize=210,centerX=canvasSize/2,centerY=canvasSize/2,mapRadius=centerX-10,worldToMapScale=2;function drawMarkerSymbol$3(n,e){switch(n.save(),n.strokeStyle=e.color,n.fillStyle=e.color,n.lineWidth=2,n.shadowColor=e.color,n.shadowBlur=10,n.textAlign="center",n.textBaseline="middle",e.type){case"friend":n.beginPath(),n.arc(0,0,e.size*.7,0,Math.PI*2),n.stroke(),n.beginPath(),n.arc(-e.size*.8,-e.size*.8,2,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(e.size*.8,-e.size*.8,2,0,Math.PI*2),n.fill();break;case"hoverboard":n.fillRect(-e.size*.5,-e.size*.2,e.size,e.size*.4),n.beginPath(),n.arc(-e.size*.3,e.size*.2,1.5,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(e.size*.3,e.size*.2,1.5,0,Math.PI*2),n.fill();break;case"portal":n.setLineDash([4,4]),n.strokeStyle=e.color;for(const t of[e.size*.6,e.size])n.beginPath(),n.arc(0,0,t,Math.PI*.2,Math.PI*1.8),n.stroke();break;case"info":n.font=`${e.size*2.5}px Arial`,n.fillText("",0,1);break;case"objective":default:n.font=`${e.size*2.5}px Arial`,n.fillText("",0,1);break}n.restore()}function drawSciFiMarker$3(n,e,t,o){n.save(),n.translate(e,t);const i=(Math.sin(performance.now()*.004)+1)/2;n.fillStyle=o.color+"33",n.beginPath(),n.arc(0,0,o.size+2+i*2,0,Math.PI*2),n.fill(),drawMarkerSymbol$3(n,o),n.restore()}function drawPlayerChevron$3(n){n.save(),n.fillStyle=playerMarker$3.color,n.strokeStyle="#ffffff",n.lineWidth=1.5,n.shadowColor=playerMarker$3.color,n.shadowBlur=18,n.beginPath(),n.moveTo(0,-10),n.lineTo(6,6),n.lineTo(0,3),n.lineTo(-6,6),n.closePath(),n.fill(),n.stroke(),n.restore()}function createBackgroundGrid$3(){const n=document.createElement("canvas"),e=n.getContext("2d"),t=40;return n.width=t,n.height=t,e.strokeStyle="rgba(0, 179, 215, 0.58)",e.lineWidth=.5,e.beginPath(),e.moveTo(0,t),e.lineTo(t,0),e.moveTo(0,0),e.lineTo(t,t),e.stroke(),n}function createMinimap$3(n,e){physicsController$3=e,container$3=document.createElement("div"),container$3.id="minimap-container",document.body.appendChild(container$3),canvas$3=document.createElement("canvas"),canvas$3.id="minimap-canvas",canvas$3.width=canvasSize,canvas$3.height=canvasSize,container$3.appendChild(canvas$3),ctx$3=canvas$3.getContext("2d"),toggleBtn$3=document.createElement("button"),toggleBtn$3.id="minimap-toggle",toggleBtn$3.textContent="Hide Map",document.body.appendChild(toggleBtn$3),toggleBtn$3.addEventListener("click",()=>{visible$3=!visible$3,container$3.classList.toggle("visible"),toggleBtn$3.textContent=visible$3?"Hide Map":""});const t=createBackgroundGrid$3();backgroundPattern$3=ctx$3.createPattern(t,"repeat"),setTimeout(()=>{visible$3=!0,container$3.classList.add("visible")},1200)}function updateMinimap$3(){var c;if(!visible$3||!ctx$3||!((c=physicsController$3==null?void 0:physicsController$3.playerFunction)!=null&&c.player))return;const n=physicsController$3.playerFunction.player,e=n.position,t=n.rotation.y;ctx$3.clearRect(0,0,canvas$3.width,canvas$3.height),ctx$3.save(),ctx$3.beginPath(),ctx$3.arc(centerX,centerY,mapRadius+8,0,Math.PI*2),ctx$3.clip(),ctx$3.save();const o=-(e.x*worldToMapScale)%40,i=-(e.z*worldToMapScale)%40;ctx$3.translate(o,i),ctx$3.fillStyle=backgroundPattern$3,ctx$3.fillRect(-40,-40,canvas$3.width+80,canvas$3.height+80),ctx$3.restore();const s=performance.now(),r=s*.002%(Math.PI*2),a=ctx$3.createRadialGradient(centerX,centerY,0,centerX,centerY,mapRadius);a.addColorStop(0,"rgba(0, 255, 255, 0.25)"),a.addColorStop(1,"rgba(0, 255, 255, 0)"),ctx$3.fillStyle=a,ctx$3.beginPath(),ctx$3.moveTo(centerX,centerY),ctx$3.arc(centerX,centerY,mapRadius,r-.3,r+.3),ctx$3.closePath(),ctx$3.fill();const l=(Math.sin(s*.002)+1)/2;ctx$3.strokeStyle=`rgba(0, 255, 255, ${.3-l*.3})`,ctx$3.lineWidth=2,ctx$3.beginPath(),ctx$3.arc(centerX,centerY,mapRadius*l,0,Math.PI*2),ctx$3.stroke();for(const d of markers$3){const u=d.position.x-e.x,f=d.position.z-e.z,h=u*worldToMapScale,m=f*worldToMapScale,p=centerX+h,v=centerY+m;Math.hypot(h,m)<mapRadius&&drawSciFiMarker$3(ctx$3,p,v,d)}ctx$3.save(),ctx$3.translate(centerX,centerY),ctx$3.rotate(t),drawPlayerChevron$3(ctx$3),ctx$3.restore(),ctx$3.fillStyle="rgba(255, 255, 255, 0.7)",ctx$3.font="12px 'Orbitron', sans-serif",ctx$3.textAlign="center",ctx$3.textBaseline="middle",ctx$3.fillText("N",centerX,15),ctx$3.fillText("S",centerX,canvasSize-15),ctx$3.fillText("E",canvasSize-15,centerY),ctx$3.fillText("W",15,centerY),ctx$3.restore()}function cleanupMinimap$3(){toggleBtn$3&&toggleBtn$3.replaceWith(toggleBtn$3.cloneNode(!0)),container$3&&(container$3.innerHTML="",container$3.remove()),toggleBtn$3&&toggleBtn$3.parentNode&&toggleBtn$3.parentNode.removeChild(toggleBtn$3),container$3=null,canvas$3=null,ctx$3=null,toggleBtn$3=null,visible$3=!1,backgroundPattern$3=null,physicsController$3=null}const holographicGlobeShader={uniforms:{time:{value:0},glowColor:{value:new Color(65535)},glowIntensity:{value:1},glowPower:{value:2},glowSpeed:{value:1}},vertexShader:`
        varying vec3 vNormal;
        varying vec3 vViewPosition;
        varying float vGlow;
        
        void main() {
            vNormal = normalize(normalMatrix * normal);
            vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
            vViewPosition = -mvPosition.xyz;
            // Calculate glow based on view angle
            vGlow = pow(1.0 - abs(dot(normalize(vNormal), normalize(vViewPosition))), 2.0);
            
            gl_Position = projectionMatrix * mvPosition;
        }
    `,fragmentShader:`
        uniform float time;
        uniform vec3 glowColor;
        uniform float glowIntensity;
        uniform float glowPower;
        uniform float glowSpeed;
        
        varying vec3 vNormal;
        varying vec3 vViewPosition;
        varying float vGlow;
        
        void main() {
            // Calculate pulsing glow
            float pulse = sin(time * glowSpeed) * 0.5 + 0.5;
            float glow = pow(vGlow, glowPower) * glowIntensity * (0.5 + pulse * 0.5);
            
            // Only add glow to edges
            vec3 finalColor = glowColor * glow;
            
            gl_FragColor = vec4(finalColor, glow);
        }
    `};let isElectroSequenceActive=!1,shapeKeyControls$1=null,allAssets$2=null,electroComponents$2=null;window.isElectroSequencePlaying=!1;new Vector3$1;new Vector3$1;let scene$8=null,camera$7=null,player$1=null,controls$8=null,renderer$9=null,electroActions$1=null,_mixerFinishedHandler=null;function normalizeAction(n,e=LoopOnce,t=!0,o=1){return n&&(n.enabled=!0,n.setLoop(e),n.clampWhenFinished=t,n.timeScale=o,n)}function playExclusive(n,e,t=.25,o=LoopOnce,i=!0,s=1){if(e){if(normalizeAction(e,o,i,s),e.reset(),n&&n!==e)try{n.crossFadeTo(e,t,!0)}catch{}e.play()}}function goToIdle(n=.3){if(!(electroActions$1!=null&&electroActions$1.idleAction))return;const e=electroActions$1.idleAction;normalizeAction(e,LoopRepeat,!1,1),e.reset(),e.fadeIn(n),e.play()}function setDependencies$1(n,e,t,o,i){camera$7=n,player$1=e,scene$8=t,controls$8=o,renderer$9=i}function initializeElectro$1(n,e,t,o,i,s){setDependencies$1(o,t,n,i,s),allAssets$2=e;const r=allAssets$2.characters.models.electro;if(!r)return console.error("Electro model not found in assets"),null;r.visible=!1,n.add(r),r.position.set(-34,0,0),r.rotation.set(0,1.5,0),shapeKeyControls$1=setupShapeKeyAnimations(r),electroActions$1={jumpAction:e.characters.animations.electro.actions.JUMPING,idleAction:e.characters.animations.electro.actions.BREATHING_IDLE,runAction:e.characters.animations.electro.actions.RUNNING,sitAction:e.characters.animations.electro.actions.ENTERING,walkAction:e.characters.animations.electro.actions.WALKING,landingAction:e.characters.animations.electro.actions.LANDING,heyAction:e.characters.animations.electro.actions.THOUGHTFUL_HEAD_SHAKE,cuteAction:e.characters.animations.electro.actions.ARM_GESTURE,explainAction:e.characters.animations.electro.actions.TALKING_01,disbeliefAction:e.characters.animations.electro.actions.DISBELIEF,legAction:e.characters.animations.electro.actions.LEG,pointingAction:e.characters.animations.electro.actions.POINTING_RIGHT,ThumbsupAction:e.characters.animations.electro.actions.THUMSUP_EXPLAIN};const a=allAssets$2.characters.animations.electro.mixer;if(electroComponents$2={electro:r,electroActions:electroActions$1,electroMixer:a},_mixerFinishedHandler)try{a.removeEventListener("finished",_mixerFinishedHandler)}catch{}if(_mixerFinishedHandler=l=>{const c=l==null?void 0:l.action;c&&c!==electroActions$1.idleAction&&goToIdle(.25)},a.addEventListener("finished",_mixerFinishedHandler),electroActions$1.idleAction){const l=normalizeAction(electroActions$1.idleAction,LoopRepeat,!1,1);l.reset(),l.play(),l.time=0,a.update(0)}return r.visible=!0,electroComponents$2}function startElectroSequence$1(){if(isElectroSequenceActive){console.log("Electro sequence already active, ignoring trigger");return}console.log("Starting electro sequence"),isElectroSequenceActive=!0,window.isElectroSequencePlaying=!0;try{window.isComponentIntroSequencePlaying=!0}catch{}performance.now();try{shapeKeyControls$1&&typeof shapeKeyControls$1.startAnimation=="function"&&shapeKeyControls$1.startAnimation()}catch(n){console.warn("[DEBUG] Could not start shape key animations",n)}togglePlayerControls(!1),controls$8&&(controls$8.enabled=!1),setCameraFollowsPlayer(!1),startElectroInteraction()}function startElectroInteraction(){if(!(electroComponents$2!=null&&electroComponents$2.electro)||!player$1)return;const n=electroComponents$2.electro;if(console.log("Starting electro interaction at position:",n.position),electroActions$1.idleAction){const e=normalizeAction(electroActions$1.idleAction,LoopRepeat,!1,1);e.time=.1,e.play(),electroComponents$2.electroMixer.update(0)}createCinematicCameraMovement(n)}function createCinematicCameraMovement(n){if(!camera$7||!n||!player$1)return;new Vector3$1(-33,2,0),camera$7.rotation.clone(),new Vector3$1(-33,2,0);const e=n.position.clone(),t=new Vector3$1(e.x+1.2,e.y+.8,e.z+.1),o=new Vector3$1(e.x-1,e.y+.8,e.z);gsapWithCSS.to(camera$7.position,{x:t.x,y:t.y,z:t.z,duration:3.5,ease:"power1.inOut",onUpdate:()=>{camera$7.lookAt(o),controls$8&&(controls$8.target.copy(o),controls$8.update())},onComplete:()=>{if(console.log("Camera reached Electro, switching to explain before sound"),electroActions$1.ThumbsupAction){const i=electroActions$1.idleAction,s=electroActions$1.ThumbsupAction;if(normalizeAction(s,LoopPingPong,!1,1),s.reset(),i)try{i.crossFadeTo(s,.2,!0)}catch{}s.play()}setTimeout(()=>{var i;if(allAssets$2.audios.electrosound){const s=allAssets$2.audios.electrosound;s.play(),s.source?s.source.onended=()=>{handleElectroAfterSound(n)}:setTimeout(()=>handleElectroAfterSound(n),((i=s.buffer)==null?void 0:i.duration)*1e3||3e3)}},100)}})}function handleElectroAfterSound(n){if(console.log("Electro sound finished  rotate + walk"),electroActions$1.ThumbsupAction&&electroActions$1.walkAction){const t=normalizeAction(electroActions$1.walkAction,LoopRepeat,!1,1);t.reset();try{electroActions$1.ThumbsupAction.crossFadeTo(t,.15,!0)}catch{}t.play()}gsapWithCSS.to(n.rotation,{y:n.rotation.y+Math.PI/2,duration:1,ease:"power1.inOut"});const e=new Vector3$1(-34,0,-3);gsapWithCSS.to(n.position,{x:e.x,y:e.y,z:e.z,duration:4,ease:"power1.inOut",onUpdate:()=>{const t=new Vector3$1(0,1,2),o=n.position.clone().add(t);camera$7.position.lerp(o,.1),camera$7.lookAt(n.position),controls$8&&(controls$8.target.copy(n.position),controls$8.update())},onComplete:()=>{var o,i;if(console.log("Electro finished walking"),electroActions$1.walkAction&&electroActions$1.idleAction){try{electroActions$1.walkAction.crossFadeTo(electroActions$1.idleAction,.3,!0)}catch{}goToIdle(.3)}else goToIdle(.3);if(allAssets$2.audios.electrosound1){const s=allAssets$2.audios.electrosound1;try{(o=s.stop)==null||o.call(s)}catch{}s.play(),electroActions$1.idleAction&&electroActions$1.pointingAction&&playExclusive(electroActions$1.idleAction,electroActions$1.pointingAction,.4,LoopOnce,!0,1);const r=()=>{var u,f,h,m,p,v;if(console.log("[DEBUG] electrosound1 ended"),!r._sound4Handled){r._sound4Handled=!0,electroActions$1.idleAction&&electroActions$1.legAction&&playExclusive(electroActions$1.idleAction,electroActions$1.legAction,.25,LoopOnce,!0,1);const g=(u=allAssets$2==null?void 0:allAssets$2.audios)==null?void 0:u.electrosound4;if(g&&typeof g.play=="function"){try{(f=g.stop)==null||f.call(g)}catch{}try{if(console.log("[DEBUG] Playing electrosound4 after electrosound1"),g.play(),g.source){g.source.onended=()=>{console.log("[DEBUG] electrosound4 finished  proceed to screen video flow"),r()};return}else{setTimeout(()=>{console.log("[DEBUG] electrosound4 fallback timeout  proceed"),r()},((h=g.buffer)==null?void 0:h.duration)*1e3||3e3);return}}catch(y){console.warn("[DEBUG] electrosound4 play error",y)}}}console.log("[DEBUG] proceeding to screenvideo on display001 and camera focus");const a=(p=(m=allAssets$2==null?void 0:allAssets$2.models)==null?void 0:m.gltf)==null?void 0:p.underground;let l=null;if(a&&a.traverse&&a.traverse(g=>{g.isMesh&&g.name==="display001"&&!l&&(l=g)}),l&&((v=allAssets$2==null?void 0:allAssets$2.videotextures)!=null&&v.screenvideo)){const g=document.createElement("video");g.src=allAssets$2.videotextures.screenvideo.path,g.loop=!1,g.muted=!1,g.playsInline=!0,g.crossOrigin="anonymous",g.autoplay=!0,g.preload="auto",g.style.display="none",document.body.appendChild(g);const y=new VideoTexture(g);y.minFilter=LinearFilter,y.magFilter=LinearFilter,y.format=RGBAFormat,y.colorSpace=SRGBColorSpace,l.geometry.boundingBox||l.geometry.computeBoundingBox();const w=l.geometry.boundingBox,_=new Vector3$1;w.getSize(_);const S=w.min.clone(),C=w.max.clone(),E=[{axis:"x",value:Math.abs(_.x)},{axis:"y",value:Math.abs(_.y)},{axis:"z",value:Math.abs(_.z)}].sort((B,b)=>B.value-b.value)[0].axis;let k=0,I=2,F=1;E==="z"?(k=0,I=Math.max(1e-6,Math.abs(_.x)),F=Math.max(1e-6,Math.abs(_.y))):E==="x"?(k=1,I=Math.max(1e-6,Math.abs(_.z)),F=Math.max(1e-6,Math.abs(_.y))):(k=2,I=Math.max(1e-6,Math.abs(_.x)),F=Math.max(1e-6,Math.abs(_.z)));const M=()=>(g.videoWidth||2)/Math.max(1,g.videoHeight||1),R=I/F,O=new ShaderMaterial({uniforms:{map:{value:y},minLocal:{value:S},maxLocal:{value:C},videoAspect:{value:1},meshAspect:{value:R},meshAspectOverride:{value:2},rotate90CW:{value:1},flipY:{value:1},planeMode:{value:k},opacity:{value:1}},vertexShader:`
                varying vec3 vPos;
                void main() {
                  vPos = position; // local-space position
                  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
              `,fragmentShader:`
                uniform sampler2D map;
                uniform vec3 minLocal;
                uniform vec3 maxLocal;
                uniform float videoAspect;
                uniform float meshAspect;
                uniform float meshAspectOverride;
                uniform int rotate90CW;
                uniform int flipY;
                uniform int planeMode; // 0: XY, 1: YZ, 2: XZ
                uniform float opacity;
                varying vec3 vPos;
                
                vec2 computeUV(vec3 p) {
                  vec2 uv;
                  if (planeMode == 0) {
                    // XY
                    uv = vec2((p.x - minLocal.x) / max(1e-6, (maxLocal.x - minLocal.x)),
                               (p.y - minLocal.y) / max(1e-6, (maxLocal.y - minLocal.y)));
                  } else if (planeMode == 1) {
                    // YZ
                    uv = vec2((p.z - minLocal.z) / max(1e-6, (maxLocal.z - minLocal.z)),
                               (p.y - minLocal.y) / max(1e-6, (maxLocal.y - minLocal.y)));
                  } else {
                    // XZ
                    uv = vec2((p.x - minLocal.x) / max(1e-6, (maxLocal.x - minLocal.x)),
                               (p.z - minLocal.z) / max(1e-6, (maxLocal.z - minLocal.z)));
                  }
                  return uv;
                }
                void main() {
                  vec2 uv = computeUV(vPos);
                  // Optional 90 rotation and vertical flip to correct orientation
                  if (rotate90CW == 1) {
                    uv = vec2(uv.y, 1.0 - uv.x);
                  }
                  if (flipY == 1) {
                    uv.y = 1.0 - uv.y;
                  }
                  
                  float usedMeshAspect = meshAspect;
                  if (meshAspectOverride > 0.0) {
                    usedMeshAspect = clamp(meshAspectOverride, 1.5, 2.0);
                  }
                  
                  // Center-fit to preserve aspect ratio (contain)
                  if (usedMeshAspect > videoAspect) {
                    // Pillarbox horizontally
                    float scaleX = videoAspect / usedMeshAspect;
                    uv.x = (uv.x - 0.5) * scaleX + 0.5;
                  } else {
                    // Letterbox vertically
                    float scaleY = usedMeshAspect / videoAspect;
                    uv.y = (uv.y - 0.5) * scaleY + 0.5;
                  }
                  // Clamp outside to black (or transparent)
                  if (any(lessThan(uv, vec2(0.0))) || any(greaterThan(uv, vec2(1.0)))) {
                    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
                    return;
                  }
                  vec4 c = texture2D(map, uv);
                  gl_FragColor = vec4(c.rgb, opacity);
                }
              `,transparent:!0,depthTest:!1,depthWrite:!1,side:DoubleSide,toneMapped:!1}),$=()=>{const B=M();O.uniforms.videoAspect.value=B,y&&(y.needsUpdate=!0)};g.addEventListener("loadedmetadata",$,{once:!0}),g.readyState>=1&&$();const T=l.getObjectByName("display001_video_group");T&&(l.remove(T),T.traverse(B=>{B.isMesh&&(B.geometry&&B.geometry.dispose(),B.material&&(B.material.map&&B.material.map.dispose(),B.material.dispose()))})),l.userData||(l.userData={}),l.userData._origMat||(l.userData._origMat=l.material),l.material=O;const D=()=>{g.play().then(()=>{y.needsUpdate=!0}).catch(B=>console.warn("[DEBUG] screenvideo play error",B))};g.readyState<2&&setTimeout(D,200),D();const P=()=>{var z;try{if(l&&l.userData&&l.userData._origMat){const N=l.material;l.material=l.userData._origMat,l.userData._origMat=null,N&&N.dispose&&N.dispose()}y&&y.dispose&&y.dispose(),g&&g.parentNode&&(g.pause(),g.src="",(z=g.load)==null||z.call(g),g.parentNode.removeChild(g))}catch(N){console.warn("[DEBUG] video cleanup error",N)}const B=new Vector3$1(-35,.5,-2.7),b=new Vector3$1(-35,1.5,-4);gsapWithCSS.to(camera$7.position,{x:B.x,y:B.y,z:B.z,duration:1.8,ease:"power1.inOut",onUpdate:()=>{camera$7.lookAt(b),controls$8&&(controls$8.target.copy(b),controls$8.update())},onComplete:()=>{var K,ne;camera$7.lookAt(b),controls$8&&(controls$8.target.copy(b),controls$8.update());const N=(K=allAssets$2==null?void 0:allAssets$2.audios)==null?void 0:K.electrosound2;if(N&&typeof N.play=="function")try{N.play()}catch(J){console.warn("[DEBUG] electrosound2 play error",J)}else try{playAudio&&playAudio("electrosound2")}catch{}const G=()=>{var be,ue;console.log("[DEBUG] electrosound2 ended  starting switch sequence");const J=(ue=(be=allAssets$2==null?void 0:allAssets$2.models)==null?void 0:be.gltf)==null?void 0:ue.underground;let se=null,te=null,Z=null;if(J&&J.traverse&&J.traverse(de=>{de.isMesh&&(console.log("Meshes are",de.name),de.name==="switch001"&&!se&&(se=de),de.name==="MR_V01010"&&!te&&(te=de),de.name==="display"&&!Z&&(Z=de))}),!se||!te||!Z){console.warn("[DEBUG] Required meshes not found for switch sequence");return}let Q=new __webpack_exports__default.Block({width:.45,height:.15,padding:.04,justifyContent:"center",alignItems:"center",fontFamily:"/fonts/msdf/Roboto-msdf.json",fontTexture:"/fonts/msdf/Roboto-msdf.png",backgroundColor:new Color(16776665),backgroundOpacity:1,borderRadius:.03,borderWidth:.01,borderColor:new Color(3355443),borderOpacity:.4});Q.add(new __webpack_exports__default.Text({content:"Click Red Button",fontSize:.045,fontColor:new Color(0),fontOpacity:1,textAlign:"center"}));const le=new Box3().setFromObject(se),ae=le.getCenter(new Vector3$1),oe=le.getSize(new Vector3$1);Q.position.copy(ae),Q.position.y+=oe.y+.01,scene$8.add(Q);const pe=se.position.clone(),_e=pe.clone().add(new Vector3$1(-.005,0,0));let we=!1;const me=de=>{we||(we=!0,renderer$9.domElement.removeEventListener("click",me),Q&&scene$8&&(scene$8.remove(Q),Q=null),console.log("[DEBUG] Switch clicked  starting electrical sequence"),gsapWithCSS.timeline().to(se.position,{x:_e.x,duration:.15,ease:"power2.out"}).to(se.position,{x:pe.x,duration:.2,ease:"power2.out"}),createFireSparks(te,()=>{playMeshPictureOnDisplay(Z)}))};renderer$9.domElement.addEventListener("click",me);try{window._scene5HandleSwitchClick=me}catch{}const ve=createSwitchOutline(se);ve&&se.add(ve)};N&&N.source?N.source.onended=G:setTimeout(G,((ne=N==null?void 0:N.buffer)==null?void 0:ne.duration)*1e3||5e3)}})};let L=setTimeout(P,14e3);g.addEventListener("ended",()=>{L&&(clearTimeout(L),L=null),P()},{once:!0})}else console.warn("[DEBUG] display001 mesh or screenvideo asset not found");const c=new Vector3$1(-34.5,.7,-3.3);let d=new Vector3$1(-35,.5,-3.5);l&&(l.updateWorldMatrix(!0,!1),d=l.getWorldPosition(new Vector3$1)),gsapWithCSS.to(camera$7.position,{x:c.x,y:c.y,z:c.z,duration:1.5,ease:"power1.inOut",onUpdate:()=>{camera$7.lookAt(d),controls$8&&(controls$8.target.copy(d),controls$8.update())}})};s.source?s.source.onended=r:setTimeout(r,((i=s.buffer)==null?void 0:i.duration)*1e3||3e3)}gsapWithCSS.to(n.rotation,{y:n.rotation.y+Math.PI/1.5,duration:1.5,ease:"power1.inOut"});const t=new Vector3$1(-35,1,-1.5);gsapWithCSS.to(camera$7.position,{x:t.x,y:t.y,z:t.z,duration:1.5,ease:"power1.inOut",onUpdate:()=>{camera$7.lookAt(n.position),controls$8&&(controls$8.target.copy(n.position),controls$8.update())}})}})}function createFireSparks(n,e){var o,i,s,r,a,l;let t=new Vector3$1(-36,1,-5);try{n&&typeof n.getWorldPosition=="function"&&(t=n.getWorldPosition(new Vector3$1))}catch{}try{(s=(i=(o=allAssets$2==null?void 0:allAssets$2.audios)==null?void 0:o.spark)==null?void 0:i.stop)==null||s.call(i)}catch{}try{(l=(a=(r=allAssets$2==null?void 0:allAssets$2.audios)==null?void 0:r.spark)==null?void 0:a.play)==null||l.call(a)}catch{}return createFountainSparksAt(t,.8,e)}function createFountainSparksAt(n,e=2,t){if(!scene$8||!(n&&typeof n.x=="number")){t==null||t();return}const o=200,i=80,s=60,r=1400,a=2e3,l=new Vector3$1(0,-.055,0),c=.992,d=64,u=document.createElement("canvas");u.width=d,u.height=d;const f=u.getContext("2d"),h=f.createRadialGradient(d*.5,d*.5,0,d*.5,d*.5,d*.5);h.addColorStop(0,"rgba(255,255,255,1)"),h.addColorStop(.3,"rgba(255,200,100,0.85)"),h.addColorStop(.8,"rgba(255,120,20,0.3)"),h.addColorStop(1,"rgba(0,0,0,0)"),f.fillStyle=h,f.beginPath(),f.arc(d*.5,d*.5,d*.5,0,Math.PI*2),f.fill();const m=new CanvasTexture(u);m.minFilter=LinearFilter,m.magFilter=LinearFilter,m.colorSpace=SRGBColorSpace;const p=new Float32Array(o*3),v=new Float32Array(o*3),g=new Array(o),y=new Uint32Array(o),w=new Uint16Array(o),_=new Uint8Array(o);for(let $=0;$<o;$++)p[$*3+0]=1e9,p[$*3+1]=1e9,p[$*3+2]=1e9,v[$*3+0]=1,v[$*3+1]=.6,v[$*3+2]=.2,g[$]=new Vector3$1,y[$]=0,w[$]=0,_[$]=0;const S=new BufferGeometry;S.setAttribute("position",new BufferAttribute(p,3)),S.setAttribute("color",new BufferAttribute(v,3));const C=new PointsMaterial({size:.06,map:m,color:16777215,vertexColors:!0,transparent:!0,alphaTest:.15,depthWrite:!1,depthTest:!0,blending:AdditiveBlending,sizeAttenuation:!0}),A=new Points(S,C);A.frustumCulled=!1,scene$8.add(A);const E=()=>{const $=Math.random()*Math.PI*2,T=Math.sqrt(Math.random())*e,D=n.x+Math.cos($)*T,P=n.z+Math.sin($)*T,L=n.y+Math.random()*.1;return new Vector3$1(D,L,P)},k=()=>{for(let $=0;$<o;$++)if(_[$]===0)return $;return-1},I=performance.now();for(let $=0;$<i;$++){const T=k();if(T<0)break;const D=E(),P=(Math.random()-.5)*.8,L=-(.6+Math.random()*1.4),B=(Math.random()-.5)*.8,b=s+Math.floor(Math.random()*(r-s+1));p[T*3+0]=D.x,p[T*3+1]=D.y,p[T*3+2]=D.z,v[T*3+0]=1,v[T*3+1]=.7,v[T*3+2]=.25,g[T].set(P,L,B),y[T]=I,w[T]=b,_[T]=1}S.attributes.position.needsUpdate=!0,S.attributes.color.needsUpdate=!0;let F=!1;const M=performance.now();function R(){if(F)return;const $=performance.now();let T=!1;for(let D=0;D<o;D++){if(_[D]===0)continue;T=!0;const P=$-y[D],L=w[D];if(P>=L){_[D]=0,p[D*3+0]=1e9,p[D*3+1]=1e9,p[D*3+2]=1e9;continue}const B=g[D];B.addScaledVector(l,.016),B.multiplyScalar(c),p[D*3+0]+=B.x*.016,p[D*3+1]+=B.y*.016,p[D*3+2]+=B.z*.016;const b=P/L;v[D*3+0]=1,v[D*3+1]=.7-.45*b,v[D*3+2]=.25-.2*b}S.attributes.position.needsUpdate=!0,S.attributes.color.needsUpdate=!0,$-M<=a+100||T?requestAnimationFrame(R):O()}function O(){var $;F||(F=!0,scene$8.remove(A),S.dispose(),C.dispose(),($=m.dispose)==null||$.call(m),t==null||t())}requestAnimationFrame(R)}function returnToPlayer(){if(!camera$7||!player$1)return;electroComponents$2!=null&&electroComponents$2.electro&&scene$8&&(scene$8.remove(electroComponents$2.electro),console.log("[DEBUG] Electro removed from scene after electrosound"));const n=window.hudVideoPlane,e=window.hudVideoElement;if(n&&camera$7){const t=n.position.clone(),o=t.clone().add(new Vector3$1(0,0,2)),i=player$1.position.clone(),s=player$1.position.clone();n.visible=!0,e&&(e.loop=!1,e.currentTime=0),console.log("[DEBUG] Camera animating to HUD video plane (direct from electro)"),gsapWithCSS.to(camera$7.position,{x:o.x,y:o.y,z:o.z,duration:.5,ease:"power1.inOut",onUpdate:()=>{camera$7.lookAt(t),controls$8&&(controls$8.target.copy(t),controls$8.update()),camera$7.updateProjectionMatrix()},onComplete:()=>{camera$7.lookAt(t),controls$8&&(controls$8.target.copy(t),controls$8.update()),camera$7.updateProjectionMatrix(),console.log("[DEBUG] Camera focused on HUD video (from electrointeraction.js)"),e&&(e.play().then(()=>{console.log("[DEBUG] hudvideo1 started playing (from electrointeraction.js)")}).catch(r=>console.warn("[DEBUG] hudvideo1 play error",r)),e.onended=()=>{console.log("[DEBUG] hudvideo1 ended, moving to Byte panel");const r=new Vector3$1(-39,1.6,-3.21),a=new Vector3$1(-39,1.15,-6);gsapWithCSS.to(camera$7.position,{x:r.x,y:r.y,z:r.z,duration:3.5,ease:"power1.inOut",onUpdate:()=>{camera$7.lookAt(a),controls$8&&(controls$8.target.copy(a),controls$8.update()),camera$7.updateProjectionMatrix()},onComplete:()=>{camera$7.lookAt(a),controls$8&&(controls$8.target.copy(a),controls$8.update()),camera$7.updateProjectionMatrix(),console.log("[DEBUG] Playing bytepanelsound via playAudio"),playAudio("bytepanelsound");const l=()=>{window.removeEventListener("audioComplete-bytepanelsound",l),console.log("[DEBUG] audioComplete-bytepanelsound event received, moving to Component Intro Panel");const c=new Vector3$1(-33,1,3.5),d=new Vector3$1(-33,1.9,7.5);gsapWithCSS.to(camera$7.position,{x:c.x,y:c.y,z:c.z,duration:3.5,ease:"power1.inOut",onUpdate:()=>{camera$7.lookAt(d),controls$8&&(controls$8.target.copy(d),controls$8.update()),camera$7.updateProjectionMatrix()},onComplete:()=>{camera$7.lookAt(d),controls$8&&(controls$8.target.copy(d),controls$8.update()),camera$7.updateProjectionMatrix(),console.log("[DEBUG] Playing componentsound via playAudio"),playAudio("componentsound");const u=()=>{window.removeEventListener("audioComplete-componentsound",u),showFPPOverlay(),gsapWithCSS.to(camera$7.position,{x:i.x,y:i.y+.2,z:i.z+.5,duration:3.5,ease:"power1.inOut",onUpdate:()=>{camera$7.lookAt(s),controls$8&&(controls$8.target.copy(s),controls$8.update()),camera$7.updateProjectionMatrix()},onComplete:()=>{camera$7.lookAt(s),controls$8&&(controls$8.target.copy(s),controls$8.update()),camera$7.updateProjectionMatrix(),typeof switchToFirstPerson=="function"&&switchToFirstPerson(camera$7,controls$8),controls$8&&(controls$8.enabled=!0),setCameraFollowsPlayer(!0),electroComponents$2.electroMixer&&electroComponents$2.electroMixer.stopAllAction(),togglePlayerControls(!0),console.log("[DEBUG] Camera returned to player in FPP and controls re-enabled (from electrointeraction.js)"),n.visible=!1}})};window.addEventListener("audioComplete-componentsound",u)}})};window.addEventListener("audioComplete-bytepanelsound",l)}})})}})}else controls$8&&(controls$8.enabled=!0),electroComponents$2.electroMixer&&electroComponents$2.electroMixer.stopAllAction(),togglePlayerControls(!0),console.log("Electro sequence completed, controls re-enabled");isElectroSequenceActive=!1,isElectroSequencePlaying=!1,window.isElectroSequencePlaying=!1;try{window.isComponentIntroSequencePlaying=!1}catch{}}function createSwitchOutline(n){if(!n||!n.geometry)return null;const e=n.geometry.clone(),t=new MeshBasicMaterial({color:65535,transparent:!0,opacity:.6,side:BackSide}),o=new Mesh(e,t);return o.scale.multiplyScalar(1.05),o.renderOrder=998,o}function playMeshPictureOnDisplay(n){var u;if(!n||!((u=allAssets$2==null?void 0:allAssets$2.textures)!=null&&u.meshpicture)){console.warn("[DEBUG] meshpicture or display mesh not found");return}console.log("[DEBUG] Applying meshpicture to display mesh");const e=allAssets$2.textures.meshpicture;e.wrapS=ClampToEdgeWrapping,e.wrapT=ClampToEdgeWrapping,e.colorSpace=SRGBColorSpace,n.userData||(n.userData={}),n.userData._origMat2||(n.userData._origMat2=n.material);const t=new Box3().setFromObject(n),o=t.getSize(new Vector3$1),i=t.getCenter(new Vector3$1);let s,r;const a=[o.x,o.y,o.z].sort((f,h)=>h-f);s=a[0],r=a[1],e.image&&e.image.width,e.image&&e.image.height;const l=new MeshBasicMaterial({map:e,transparent:!0,side:DoubleSide,depthTest:!1,depthWrite:!1}),c=new PlaneGeometry(s,r),d=new Mesh(c,l);if(d.position.copy(i),scene$8&&(scene$8.add(d),n.userData||(n.userData={}),n.userData._displayPlane=d),n.visible=!1,camera$7){const f=new Vector3$1(-31.5,1.5,-4),h=i.clone();gsapWithCSS.to(camera$7.position,{x:f.x,y:f.y,z:f.z,duration:2.5,ease:"power1.inOut",onUpdate:()=>{camera$7.lookAt(h),controls$8&&(controls$8.target.copy(h),controls$8.update())},onComplete:()=>{var m,p;if((m=allAssets$2==null?void 0:allAssets$2.audios)!=null&&m.electrosound3){const v=allAssets$2.audios.electrosound3;try{v.play(),console.log("[DEBUG] Playing electrosound3 after camera movement"),v.source?v.source.onended=()=>{console.log("[DEBUG] electrosound3 finished, starting return sequence"),returnToPlayer()}:setTimeout(()=>{console.log("[DEBUG] electrosound3 fallback timeout, starting return sequence"),returnToPlayer()},((p=v.buffer)==null?void 0:p.duration)*1e3||5e3)}catch(g){console.warn("[DEBUG] electrosound3 play error",g)}}else console.warn("[DEBUG] electrosound3 audio not found")}})}}function updateElectro$1(n){isElectroSequenceActive&&(electroComponents$2!=null&&electroComponents$2.electroMixer&&electroComponents$2.electroMixer.update(n),typeof __webpack_exports__default<"u"&&__webpack_exports__default.update(),playerControlsEnabled&&togglePlayerControls(!1))}function cleanupElectro$1(){electroComponents$2!=null&&electroComponents$2.electroMixer&&electroComponents$2.electroMixer.stopAllAction(),shapeKeyControls$1&&shapeKeyControls$1.stopAnimation(),electroComponents$2!=null&&electroComponents$2.electro&&scene$8.remove(electroComponents$2.electro),scene$8&&scene$8.traverse(n=>{n.userData&&n.userData._displayPlane&&(scene$8.remove(n.userData._displayPlane),n.userData._displayPlane.geometry&&n.userData._displayPlane.geometry.dispose(),n.userData._displayPlane.material&&(n.userData._displayPlane.material.map&&n.userData._displayPlane.material.map.dispose(),n.userData._displayPlane.material.dispose()),n.userData._displayPlane=null,n.visible=!0)}),isElectroSequenceActive=!1,window.isElectroSequencePlaying=!1;try{window.isComponentIntroSequencePlaying=!1}catch{}electroComponents$2=null,shapeKeyControls$1=null}function createFireSparksAt(n,e=2,t){var o,i,s,r,a,l;try{(s=(i=(o=allAssets$2==null?void 0:allAssets$2.audios)==null?void 0:o.spark)==null?void 0:i.stop)==null||s.call(i)}catch{}try{(l=(a=(r=allAssets$2==null?void 0:allAssets$2.audios)==null?void 0:r.spark)==null?void 0:a.play)==null||l.call(a)}catch{}return createFountainSparksAt(n,e,t)}try{window.createFireSparksAt=createFireSparksAt}catch(n){}var Stats=function(){var n=0,e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(d){d.preventDefault(),o(++n%e.children.length)},!1);function t(d){return e.appendChild(d.dom),d}function o(d){for(var u=0;u<e.children.length;u++)e.children[u].style.display=u===d?"block":"none";n=d}var i=(performance||Date).now(),s=i,r=0,a=t(new Stats.Panel("FPS","#0ff","#002")),l=t(new Stats.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new Stats.Panel("MB","#f08","#201"));return o(0),{REVISION:16,dom:e,addPanel:t,showPanel:o,begin:function(){i=(performance||Date).now()},end:function(){r++;var d=(performance||Date).now();if(l.update(d-i,200),d>=s+1e3&&(a.update(r*1e3/(d-s),100),s=d,r=0,c)){var u=performance.memory;c.update(u.usedJSHeapSize/1048576,u.jsHeapSizeLimit/1048576)}return d},update:function(){i=this.end()},domElement:e,setMode:o}};Stats.Panel=function(n,e,t){var o=1/0,i=0,s=Math.round,r=s(window.devicePixelRatio||1),a=80*r,l=48*r,c=3*r,d=2*r,u=3*r,f=15*r,h=74*r,m=30*r,p=document.createElement("canvas");p.width=a,p.height=l,p.style.cssText="width:80px;height:48px";var v=p.getContext("2d");return v.font="bold "+9*r+"px Helvetica,Arial,sans-serif",v.textBaseline="top",v.fillStyle=t,v.fillRect(0,0,a,l),v.fillStyle=e,v.fillText(n,c,d),v.fillRect(u,f,h,m),v.fillStyle=t,v.globalAlpha=.9,v.fillRect(u,f,h,m),{dom:p,update:function(g,y){o=Math.min(o,g),i=Math.max(i,g),v.fillStyle=t,v.globalAlpha=1,v.fillRect(0,0,a,f),v.fillStyle=e,v.fillText(s(g)+" "+n+" ("+s(o)+"-"+s(i)+")",c,d),v.drawImage(p,u+r,f,h-r,m,u,f,h-r,m),v.fillRect(u+h-r,f,r,m),v.fillStyle=t,v.globalAlpha=.9,v.fillRect(u+h-r,f,r,s((1-g/y)*m))}}};const CDN_BASE$1=(()=>{if(typeof window<"u"){if(window.ASSETS_CDN_BASE)return window.ASSETS_CDN_BASE;if(window.ASSETS_R2_ACCOUNT_ID)return`https://${window.ASSETS_R2_ACCOUNT_ID}.r2.dev`}return"https://pub-4dc5824a7d6645b29006348054fb1f3f.r2.dev"})(),isDevHost$1=()=>{if(typeof window>"u")return!1;const n=window.location.hostname;return n==="localhost"||n==="127.0.0.1"||n==="::1"||/^10\./.test(n)||/^192\.168\./.test(n)||/^172\.(1[6-9]|2[0-9]|3[0-1])\./.test(n)},toCDN$1=n=>{if(n.startsWith("/r2/")){if(isDevHost$1())return n;const e=n.replace(/^\/r2\//,"/");return CDN_BASE$1?`${CDN_BASE$1}${e}`:e}return n},assetsEntry$3={models:[{name:"mainModel",path:"/scene66/robo_lab.glb",shadow:!0},{name:"nano1",path:"/scene66/arduinonano.glb"},{name:"arduinoNano",path:"/scene66/arduinonano3.glb"},{name:"expansionBoard",path:"/scene66/expansion_board.glb"},{name:"expansionBoard2",path:"/scene66/expansion_board3.glb"},{name:"pin4Female",path:"/scene66/femalepin_1.glb",scale:{x:10,y:10,z:10}},{name:"pin2Female",path:"scene66/pin2Female.glb",scale:{x:1,y:1,z:1}},{name:"pin3Female",path:"scene66/pin3Female.glb",scale:{x:10,y:10,z:10}},{name:"rgbLEDModule",path:"/scene66/rgbled_1.glb"},{name:"rgbLed",path:"/scene66/rgbLed.glb",scale:{x:6,y:6,z:6}},{name:"buzzer",path:"/scene66/buzzer.glb",scale:{x:10,y:10,z:10}},{name:"ldr",path:"/scene66/ldr.glb",scale:{x:7,y:7,z:7}},{name:"motorDriver",path:"/scene66/motorDriver.glb",scale:{x:.2,y:.2,z:.2}},{name:"motor",path:"/scene66/motor.glb",scale:{x:.07,y:.07,z:.07}},{name:"battery",path:"/scene66/battery_2.glb",scale:{x:.7,y:.7,z:.7}},{name:"tsop",path:"/scene66/tsop.glb",scale:{x:.4,y:.4,z:.4}},{name:"remote",path:"/scene66/remote.glb",scale:{x:1,y:1,z:1}},{name:"pin4Female2",path:"/scene66/pin4Female2.glb",scale:{x:5,y:5,z:5}},{name:"pin2Female2",path:"/scene66/pin2Female2.glb",scale:{x:.6,y:.6,z:.6}},{name:"pin3Female2",path:"/scene66/pin3Female2.glb",scale:{x:.12,y:.12,z:.12}},{name:"battery2",path:"/scene66/batteryHolder.glb",scale:{x:1,y:1,z:1}}],textures:[],audios:[{name:"narrator_intro",path:"/scene66/audio/intro/narrator_intro.mp3"},{name:"lesson1_s1",path:"/scene66/audio/lesson_1/step_2.wav"},{name:"lesson1_s2",path:"/scene66/audio/lesson_1/step_3.wav"},{name:"lesson1_s3",path:"/scene66/audio/lesson_1/step_4.wav"},{name:"lesson1_s4",path:"/scene66/audio/lesson_1/step_5.wav"},{name:"lesson1_s5",path:"/scene66/audio/lesson_1/step_1.wav"},{name:"lesson1_s6",path:"/scene66/audio/lesson_1/step_6.wav"},{name:"lesson1_s7",path:"/scene66/audio/lesson_1/step_3.wav"},{name:"lesson1_s8",path:"/scene66/audio/lesson_1/step_7.wav"},{name:"lesson2_s1",path:"/scene66/audio/lesson_2/step_1.wav"},{name:"lesson2_s2",path:"/scene66/audio/lesson_2/step_2.wav"},{name:"lesson2_s3",path:"/scene66/audio/lesson_2/step_3.wav"},{name:"lesson2_s4",path:"/scene66/audio/lesson_2/step_4.wav"},{name:"lesson2_s5",path:"/scene66/audio/lesson_2/step_5.wav"},{name:"lesson2_s6",path:"/scene66/audio/lesson_2/buzzer_melody.mp3"},{name:"lesson2_s7",path:"/scene66/audio/lesson_2/step_6.wav"},{name:"lesson2_s8",path:"/scene66/audio/lesson_2/step_7.wav"},{name:"lesson3_s1",path:"/scene66/audio/lesson_3/step_1.wav"},{name:"lesson3_s2",path:"/scene66/audio/lesson_3/step_2.wav"},{name:"lesson3_s3",path:"/scene66/audio/lesson_3/step_3.wav"},{name:"lesson3_s4",path:"/scene66/audio/lesson_3/step_4.wav"},{name:"lesson3_s5",path:"/scene66/audio/lesson_3/step_5.wav"},{name:"lesson3_s6",path:"/scene66/audio/lesson_3/step_6.wav"},{name:"lesson3_s7",path:"/scene66/audio/lesson_3/step_7.wav"},{name:"lesson3_s8",path:"/scene66/audio/lesson_3/step_8.wav"},{name:"lesson3_s9",path:"/scene66/audio/lesson_3/step_9.wav"},{name:"lesson3_s10",path:"/scene66/audio/lesson_3/step_10.wav"},{name:"lesson4_s1",path:"/scene66/audio/lesson_4/step_1.wav"},{name:"lesson4_s2",path:"/scene66/audio/lesson_4/step_2.wav"},{name:"lesson4_s3",path:"/scene66/audio/lesson_4/step_3.wav"},{name:"lesson4_s4",path:"/scene66/audio/lesson_4/step_4.wav"},{name:"lesson4_s5",path:"/scene66/audio/lesson_4/step_5.wav"},{name:"lesson4_s6",path:"/scene66/audio/lesson_4/step_6.wav"},{name:"lesson4_s7",path:"/scene66/audio/lesson_4/step_7.wav"},{name:"lesson4_s8",path:"/scene66/audio/lesson_4/step_8.wav"},{name:"lesson4_s9",path:"/scene66/audio/lesson_4/step_9.wav"},{name:"lesson5_s1",path:"/scene66/audio/lesson_5/step_1.wav"},{name:"lesson5_s2",path:"/scene66/audio/lesson_5/step_2.wav"},{name:"lesson5_s3",path:"/scene66/audio/lesson_5/step_3.wav"},{name:"lesson5_s4",path:"/scene66/audio/lesson_5/step_4.wav"},{name:"lesson5_s5",path:"/scene66/audio/lesson_5/step_5.wav"},{name:"lesson5_s6",path:"/scene66/audio/lesson_5/step_6.wav"},{name:"lesson5_s7",path:"/scene66/audio/lesson_5/step_7.wav"},{name:"lesson5_s8",path:"/scene66/audio/lesson_5/step_8.wav"},{name:"lesson5_s9",path:"/scene66/audio/lesson_5/step_9.wav"},{name:"lesson5_s10",path:"/scene66/audio/lesson_5/step_10.wav"},{name:"lesson5_s11",path:"/scene66/audio/lesson_5/step_11.wav"},{name:"final",path:"/scene66/audio/final_audio.mp3"}],vfxs:[],hdris:[{name:"sky6",path:toCDN$1("/r2/dark_forest.hdr")}],cubeMaps:[],pathFiles:[],jsonFiles:[],fonts:[],svgs:[]};let Wire$1=class{constructor(e,t=null){this.wireConfig=e,this.scene=t,this.wire=null,this.curve=null,this.createGeometry()}createCurve(e,t){const o=new Vector3$1().addVectors(e,t).multiplyScalar(.5);o.y+=.1,this.curve=new CatmullRomCurve3([e,o,t])}createGeometry(){const{startPosition:e,endPosition:t,color:o}=this.wireConfig;this.createCurve(e,t);const i=new TubeGeometry(this.curve,20,.002,8,!1),s=new MeshStandardMaterial({color:o});this.wire=new Mesh(i,s),this.scene&&this.scene.add(this.wire)}updateWire(e){this.wireConfig.endPosition.copy(e),this.createCurve(this.wireConfig.startPosition,this.wireConfig.endPosition);const t=new TubeGeometry(this.curve,20,.002,8,!1);if(!this.wire){this.wire=new Mesh(t,new MeshStandardMaterial({color:this.wireConfig.color})),this.scene&&this.scene.add(this.wire);return}this.wire.geometry&&this.wire.geometry.dispose(),this.wire.geometry=t}dispose(){this.wire&&(this.scene&&this.scene.remove(this.wire),this.wire.geometry.dispose(),this.wire.material.dispose(),this.wire=null)}};var Le;let JstXhFemalePin$2=(Le=class{static getAllModels(){return this.allModels}constructor(e,t){Le.count++,this.config={pinCount:e.pinCount||2,position:e.position||null,wireConfigs:e.wireConfigs||[],twoSide:e.twoSide||!1,jstPinConfig:e.jstPinConfig||[],colors:e.colors||[]},this.scene=t,this.pinGLTF1=null,this.pinGLTF2=null,this.wires=[],this.group=new Group,this.isDraggable=!0,this.pinPositions1=[],this.pinPositions2=[],this.wasAutoMoved=!1,this.configurePinModel(),this.createWires()}configurePinModel(){let{pinCount:e,position:t,twoSide:o,jstPinConfig:i}=this.config,s=null;try{e===2?s=allAssets$4.models.gltf.pin2Female:e===3?s=allAssets$4.models.gltf.pin3Female:e===4&&(s=allAssets$4.models.gltf.pin4Female)}catch{console.warn(`Pin model for ${e} pins not found, creating fallback geometry`)}s||(s=this.createFallbackPinModel(e)),this.pinGLTF1=s.clone(),o?this.pinGLTF1.position.copy(i[0].startPosition):this.pinGLTF1.position.copy(t),this.group.add(this.pinGLTF1),o&&(this.pinGLTF2=s.clone(),this.pinGLTF2.rotation.z=Math.PI*3,this.pinGLTF2.position.copy(i[1].startPosition),this.group.add(this.pinGLTF2)),this.scene.add(this.group),this.extractPinPositions()}createFallbackPinModel(e){const t=new Group,o=new BoxGeometry(.5,.2,.3),i=new MeshPhongMaterial({color:6710886}),s=new Mesh(o,i);t.add(s);const r=.2,a=-(e-1)*r/2;for(let l=0;l<e;l++){const c=new CylinderGeometry(.02,.02,.1,8),d=new MeshPhongMaterial({color:8947848}),u=new Mesh(c,d);u.position.x=a+l*r,u.position.y=.15,u.name=`pin${l+1}`,t.add(u)}return t}extractPinPositions(){let{twoSide:e}=this.config;this.pinPositions1=[],this.pinGLTF1.traverse(t=>{if(t.name.includes("pin")&&t.isMesh){const o=new Vector3$1;t.getWorldPosition(o),this.pinPositions1.push(o)}}),e&&(this.pinPositions2=[],this.pinGLTF2.traverse(t=>{if(t.name.includes("pin")&&t.isMesh){const o=new Vector3$1;t.getWorldPosition(o),this.pinPositions2.push(o)}})),e?Le.allModels.push({instance:this,models:[this.pinGLTF1,this.pinGLTF2]}):Le.allModels.push({instance:this,models:[this.pinGLTF1]})}createWires(){let{twoSide:e,wireConfigs:t,colors:o}=this.config,i=this.config.pinCount-1;for(let s=0;s<this.config.pinCount;s++){const r={startPosition:e?this.pinPositions2[i]:t[s].startPosition.clone(),endPosition:this.pinPositions1[s],color:e?o[s]:t[s].color},a=new Wire$1(r,null);this.wires.push(a),this.group.add(a.wire),i--}}updatePosition(e,t){const o=t===this.pinGLTF1,i=this.config.twoSide&&t===this.pinGLTF2;o?this.pinGLTF1.position.copy(e):i&&this.pinGLTF2.position.copy(e),this.pinPositions1=[],this.pinGLTF1.traverse(r=>{if(r.name.includes("pin")&&r.isMesh){const a=new Vector3$1;r.getWorldPosition(a),this.pinPositions1.push(a)}}),this.config.twoSide&&(this.pinPositions2=[],this.pinGLTF2.traverse(r=>{if(r.name.includes("pin")&&r.isMesh){const a=new Vector3$1;r.getWorldPosition(a),this.pinPositions2.push(a)}}));let s=this.config.pinCount-1;this.wires.forEach((r,a)=>{this.config.twoSide?o?(r.updateWire(this.pinPositions1[a]),r.wireConfig.startPosition.copy(this.pinPositions2[s])):i&&(r.wireConfig.startPosition.copy(this.pinPositions2[s]),r.updateWire(this.pinPositions1[a])):(r.updateWire(this.pinPositions1[a]),r.wireConfig.startPosition.copy(this.config.wireConfigs[a].startPosition)),s--})}dispose(){}},Ie(Le,"count",0),Ie(Le,"allModels",[]),Le);function getSnapHandler(){const n=new Vector3$1(-.03,1.77,-3.26),e=new Vector3$1(-.005,1.757,-3.45),t=new Vector3$1(-.005,1.757,-3.37),o=new Vector3$1(-.63,1.77,-3.25),i=new Vector3$1(-.01,1.82,-3.25),s=new Vector3$1(.45,1.85,-3),r=new Vector3$1(.239,1.78,-3.36),a=new Vector3$1(-.22,1.777,-3.46),l=.1;function c(d){if(!d||window.disableNanoSnap)return!1;let u=n,f=!1;if(window.nanoModel&&d===window.nanoModel&&(window.getCurrentLesson&&window.getCurrentLesson()==="lesson2"?u=t:u=e),window.secondPin4Female&&d===window.secondPin4Female&&(u=o,f=!0),window.jstPin2Side1&&d===window.jstPin2Side1&&(u=i),window.jstPin2Side2&&d===window.jstPin2Side2&&(u=s),window.jstPinBatterySide1&&d===window.jstPinBatterySide1&&(window.getCurrentLesson&&window.getCurrentLesson()==="lesson2"?u=a:u=r),d.position.distanceTo(u)<l){if(d.position.copy(u),f&&window.rgbLEDModel){console.log("Rotating RGB LED after JST pin snap"),window.rgbLEDModel.rotation.clone();const p=new Euler$1(0,-Math.PI,-Math.PI);gsapWithCSS.to(window.rgbLEDModel.rotation,{x:p.x,y:p.y,z:p.z,duration:.8,ease:"power2.out"}),window.jstPin&&window.jstPin.pinGLTF2&&(console.log("Updating second JST pin position and rotation"),window.secondPin4Female=window.jstPin.pinGLTF2,window.jstPin.pinGLTF2.rotation.y=-Math.PI/2,window.jstPin.pinGLTF2.rotation.z=-Math.PI/2,window.jstPin.pinGLTF2.rotation.x=Math.PI/2,window.jstPin.updatePosition(o,window.jstPin.pinGLTF2))}return!0}return!1}return c}const modelTransforms={nano1:{position:new Vector3$1(.7,1.7,-3.7),rotation:new Euler$1(0,-Math.PI/2,0),scale:new Vector3$1(10,10,10),lesson2rotation:new Euler$1(0,Math.PI/2,0)},expansionBoard:{position:new Vector3$1(0,1.77,-3.41),rotation:new Euler$1(0,-Math.PI/2,0),scale:new Vector3$1(10,10,10),lesson2rotation:new Euler$1(0,Math.PI/2,0)},rgbLED:{position:new Vector3$1(-.58,1.78,-3.3),rotation:new Euler$1(0,Math.PI/2,0),scale:new Vector3$1(10,10,10)},pin4Female1:{position:new Vector3$1(.5,2,-3),rotation:new Euler$1(0,0,0),scale:new Vector3$1(10,10,10)},pin4Female2:{position:new Vector3$1(0,1.8,-3),rotation:new Euler$1(0,0,-Math.PI*2)},buzzer:{position:new Vector3$1(.45,1.8,-3.06),rotation:new Euler$1(0,Math.PI/2,0),scale:new Vector3$1(10,10,10)},pin3Female11:{position:new Vector3$1(0,1.8,-3),rotation:new Euler$1(0,Math.PI*3,Math.PI*3),scale:new Vector3$1(10,10,10)},pin3Female12:{position:new Vector3$1(.5,1.7,-3.05),rotation:new Euler$1(0,-Math.PI*3,Math.PI*3),scale:new Vector3$1(10,10,10)},tempSensor:{position:new Vector3$1(.45,1.8,-3.06),rotation:new Euler$1(0,Math.PI/2,0),scale:new Vector3$1(10,10,10)},battery:{position:new Vector3$1(.8,1.5,-3.3),rotation:new Euler$1(0,0,0),scale:new Vector3$1(.7,.7,.7)},pin3Female2:{position:new Vector3$1(0,1.8,-3),rotation:new Euler$1(0,Math.PI*3,Math.PI*3),scale:new Vector3$1(10,10,10)}};var Me;let JstXhFemalePin$1=(Me=class{static getAllModels(){return this.allModels}constructor(e){Me.count++,this.config={pinCount:e.pinCount||2,position:e.position||null,wireConfigs:e.wireConfigs||[],twoSide:e.twoSide||!1,jstPinConfig:e.jstPinConfig||[],colors:e.colors||[],draggablePins:e.draggablePins||["pinGLTF1","pinGLTF2"]},this.pinGLTF1=null,this.pinGLTF2=null,this.wires=[],this.group=new Group,this.isDraggable=!0,this.pinPositions1=[],this.pinPositions2=[],this.wasAutoMoved=!1,this.originalPinPositions=new Map,this.id=Me.count,this.configurePinModel(),this.createWires(),this.groupInitialPosition=this.group.position.clone()}configurePinModel(){let{pinCount:e,position:t,twoSide:o,jstPinConfig:i,draggablePins:s}=this.config,r=null;try{e===2?r=allAssets$4.models.gltf.pin2Female2:e===3?r=allAssets$4.models.gltf.pin3Female2:e===4&&(r=allAssets$4.models.gltf.pin4Female2)}catch{console.warn(`Pin model for ${e} pins not found, creating fallback geometry`)}r||(r=this.createFallbackPinModel(e)),this.pinGLTF1=r.clone(),o?this.pinGLTF1.position.copy(i[0].startPosition):this.pinGLTF1.position.copy(t),this.group.add(this.pinGLTF1),o&&(this.pinGLTF2=r.clone(),this.pinGLTF2.rotation.z=Math.PI*3,this.pinGLTF2.position.copy(i[1].startPosition),this.group.add(this.pinGLTF2)),this.group.name=`jstPin${Me.count}`,this.updateModelDraggability(s)}createFallbackPinModel(e){const t=new Group,o=new BoxGeometry(.5,.2,.3),i=new MeshPhongMaterial({color:6710886}),s=new Mesh(o,i);t.add(s);const r=.2,a=-(e-1)*r/2;for(let l=0;l<e;l++){const c=new CylinderGeometry(.02,.02,.1,8),d=new MeshPhongMaterial({color:8947848}),u=new Mesh(c,d);u.position.x=a+l*r,u.position.y=.15,u.name=`pin${l+1}`,t.add(u)}return t}updateModelDraggability(e){let{twoSide:t}=this.config;this.pinPositions1=[],this.pinGLTF1.traverse(s=>{if(s.name.includes("pin")&&s.isMesh){const r=new Vector3$1;s.getWorldPosition(r),this.pinPositions1.push(r)}});const o=[{model:this.pinGLTF1,draggable:e.includes("pinGLTF1"),pinType:"pinGLTF1"}];t&&(this.pinPositions2=[],this.pinGLTF2.traverse(s=>{if(s.name.includes("pin")&&s.isMesh){const r=new Vector3$1;s.getWorldPosition(r),this.pinPositions2.push(r)}}),o.push({model:this.pinGLTF2,draggable:e.includes("pinGLTF2"),pinType:"pinGLTF2"}));const i=Me.allModels.findIndex(s=>s.id===this.id);i!==-1?Me.allModels[i].models=o:Me.allModels.push({instance:this,models:o,id:this.id}),console.log("Updated allModels:",Me.allModels)}createWires(){let{twoSide:e,wireConfigs:t,colors:o}=this.config,i=this.config.pinCount-1;for(let s=0;s<this.config.pinCount;s++){const r={startPosition:e?this.pinPositions2[i]:t[s].startPosition.clone(),endPosition:this.pinPositions1[s],color:e?o[s]:t[s].color},a=new Wire$1(r,null);this.wires.push(a),this.group.add(a.wire),i--}}updatePosition(e,t){this.group.position.copy(this.groupInitialPosition);const o=t===this.pinGLTF1,i=this.config.twoSide&&t===this.pinGLTF2;this.pinPositions1=[],this.pinGLTF1.traverse(r=>{if(r.name.includes("pin")&&r.isMesh){const a=new Vector3$1;r.getWorldPosition(a),this.pinPositions1.push(a)}}),this.config.twoSide&&(this.pinPositions2=[],this.pinGLTF2.traverse(r=>{if(r.name.includes("pin")&&r.isMesh){const a=new Vector3$1;r.getWorldPosition(a),this.pinPositions2.push(a)}}));let s=this.config.pinCount-1;this.wires.forEach((r,a)=>{this.config.twoSide?o?(r.updateWire(this.pinPositions1[a]),r.wireConfig.startPosition.copy(this.pinPositions2[s])):i&&(r.wireConfig.startPosition.copy(this.pinPositions2[s]),r.updateWire(this.pinPositions1[a])):(r.updateWire(this.pinPositions1[a]),r.wireConfig.startPosition.copy(this.config.wireConfigs[a].startPosition)),s--})}getGroup(){return this.group}dispose(){}},Ie(Me,"count",0),Ie(Me,"allModels",[]),Me);const pages$1=["CONSOLAS.png"],chars$1=JSON.parse('[{"id":124,"index":374,"char":"|","width":7,"height":46,"xoffset":8,"yoffset":-1,"xadvance":23,"chnl":15,"x":0,"y":0,"page":0},{"id":40,"index":383,"char":"(","width":16,"height":43,"xoffset":4,"yoffset":2,"xadvance":23,"chnl":15,"x":0,"y":47,"page":0},{"id":41,"index":384,"char":")","width":16,"height":43,"xoffset":3,"yoffset":2,"xadvance":23,"chnl":15,"x":8,"y":0,"page":0},{"id":91,"index":387,"char":"[","width":14,"height":42,"xoffset":5,"yoffset":3,"xadvance":23,"chnl":15,"x":0,"y":91,"page":0},{"id":93,"index":388,"char":"]","width":14,"height":42,"xoffset":4,"yoffset":3,"xadvance":23,"chnl":15,"x":0,"y":134,"page":0},{"id":106,"index":140,"char":"j","width":19,"height":42,"xoffset":1,"yoffset":4,"xadvance":23,"chnl":15,"x":0,"y":177,"page":0},{"id":123,"index":391,"char":"{","width":19,"height":42,"xoffset":1,"yoffset":3,"xadvance":23,"chnl":15,"x":15,"y":91,"page":0},{"id":125,"index":392,"char":"}","width":19,"height":42,"xoffset":3,"yoffset":3,"xadvance":23,"chnl":15,"x":15,"y":134,"page":0},{"id":64,"index":594,"char":"@","width":27,"height":42,"xoffset":-2,"yoffset":4,"xadvance":23,"chnl":15,"x":17,"y":44,"page":0},{"id":81,"index":20,"char":"Q","width":26,"height":39,"xoffset":-1,"yoffset":6,"xadvance":23,"chnl":15,"x":25,"y":0,"page":0},{"id":36,"index":603,"char":"$","width":22,"height":39,"xoffset":0,"yoffset":2,"xadvance":23,"chnl":15,"x":0,"y":220,"page":0},{"id":92,"index":590,"char":"\\\\","width":21,"height":37,"xoffset":1,"yoffset":4,"xadvance":23,"chnl":15,"x":20,"y":177,"page":0},{"id":47,"index":373,"char":"/","width":21,"height":37,"xoffset":0,"yoffset":4,"xadvance":23,"chnl":15,"x":35,"y":87,"page":0},{"id":103,"index":137,"char":"g","width":23,"height":34,"xoffset":0,"yoffset":12,"xadvance":23,"chnl":15,"x":45,"y":40,"page":0},{"id":37,"index":681,"char":"%","width":26,"height":34,"xoffset":-2,"yoffset":4,"xadvance":23,"chnl":15,"x":52,"y":0,"page":0},{"id":98,"index":132,"char":"b","width":22,"height":33,"xoffset":1,"yoffset":4,"xadvance":23,"chnl":15,"x":35,"y":125,"page":0},{"id":100,"index":134,"char":"d","width":21,"height":33,"xoffset":0,"yoffset":4,"xadvance":23,"chnl":15,"x":57,"y":75,"page":0},{"id":102,"index":136,"char":"f","width":26,"height":33,"xoffset":-2,"yoffset":4,"xadvance":23,"chnl":15,"x":69,"y":35,"page":0},{"id":104,"index":138,"char":"h","width":21,"height":33,"xoffset":1,"yoffset":4,"xadvance":23,"chnl":15,"x":79,"y":0,"page":0},{"id":105,"index":139,"char":"i","width":21,"height":33,"xoffset":2,"yoffset":4,"xadvance":23,"chnl":15,"x":0,"y":260,"page":0},{"id":107,"index":141,"char":"k","width":22,"height":33,"xoffset":2,"yoffset":4,"xadvance":23,"chnl":15,"x":0,"y":294,"page":0},{"id":108,"index":142,"char":"l","width":21,"height":33,"xoffset":2,"yoffset":4,"xadvance":23,"chnl":15,"x":22,"y":260,"page":0},{"id":112,"index":146,"char":"p","width":22,"height":33,"xoffset":1,"yoffset":12,"xadvance":23,"chnl":15,"x":23,"y":215,"page":0},{"id":113,"index":147,"char":"q","width":21,"height":33,"xoffset":0,"yoffset":12,"xadvance":23,"chnl":15,"x":42,"y":159,"page":0},{"id":121,"index":155,"char":"y","width":24,"height":33,"xoffset":-1,"yoffset":12,"xadvance":23,"chnl":15,"x":58,"y":109,"page":0},{"id":33,"index":352,"char":"!","width":9,"height":33,"xoffset":7,"yoffset":4,"xadvance":23,"chnl":15,"x":79,"y":69,"page":0},{"id":38,"index":314,"char":"&","width":26,"height":33,"xoffset":-1,"yoffset":5,"xadvance":23,"chnl":15,"x":0,"y":328,"page":0},{"id":63,"index":355,"char":"?","width":17,"height":33,"xoffset":4,"yoffset":4,"xadvance":23,"chnl":15,"x":23,"y":294,"page":0},{"id":71,"index":10,"char":"G","width":23,"height":32,"xoffset":-1,"yoffset":6,"xadvance":23,"chnl":15,"x":0,"y":362,"page":0},{"id":79,"index":18,"char":"O","width":25,"height":32,"xoffset":-1,"yoffset":6,"xadvance":23,"chnl":15,"x":0,"y":395,"page":0},{"id":83,"index":22,"char":"S","width":22,"height":32,"xoffset":0,"yoffset":6,"xadvance":23,"chnl":15,"x":24,"y":362,"page":0},{"id":48,"index":613,"char":"0","width":23,"height":32,"xoffset":0,"yoffset":6,"xadvance":23,"chnl":15,"x":27,"y":328,"page":0},{"id":51,"index":618,"char":"3","width":21,"height":32,"xoffset":1,"yoffset":6,"xadvance":23,"chnl":15,"x":41,"y":294,"page":0},{"id":56,"index":623,"char":"8","width":22,"height":32,"xoffset":0,"yoffset":6,"xadvance":23,"chnl":15,"x":44,"y":249,"page":0},{"id":59,"index":346,"char":";","width":14,"height":32,"xoffset":3,"yoffset":12,"xadvance":23,"chnl":15,"x":46,"y":193,"page":0},{"id":65,"index":4,"char":"A","width":27,"height":31,"xoffset":-2,"yoffset":6,"xadvance":23,"chnl":15,"x":61,"y":193,"page":0},{"id":66,"index":5,"char":"B","width":22,"height":31,"xoffset":1,"yoffset":6,"xadvance":23,"chnl":15,"x":64,"y":143,"page":0},{"id":67,"index":6,"char":"C","width":23,"height":31,"xoffset":0,"yoffset":6,"xadvance":23,"chnl":15,"x":83,"y":103,"page":0},{"id":68,"index":7,"char":"D","width":23,"height":31,"xoffset":0,"yoffset":6,"xadvance":23,"chnl":15,"x":89,"y":69,"page":0},{"id":69,"index":8,"char":"E","width":19,"height":31,"xoffset":2,"yoffset":6,"xadvance":23,"chnl":15,"x":96,"y":34,"page":0},{"id":70,"index":9,"char":"F","width":19,"height":31,"xoffset":2,"yoffset":6,"xadvance":23,"chnl":15,"x":101,"y":0,"page":0},{"id":72,"index":11,"char":"H","width":23,"height":31,"xoffset":0,"yoffset":6,"xadvance":23,"chnl":15,"x":87,"y":135,"page":0},{"id":73,"index":12,"char":"I","width":20,"height":31,"xoffset":2,"yoffset":6,"xadvance":23,"chnl":15,"x":107,"y":101,"page":0},{"id":74,"index":13,"char":"J","width":18,"height":31,"xoffset":2,"yoffset":6,"xadvance":23,"chnl":15,"x":113,"y":66,"page":0},{"id":75,"index":14,"char":"K","width":22,"height":31,"xoffset":1,"yoffset":6,"xadvance":23,"chnl":15,"x":116,"y":32,"page":0},{"id":76,"index":15,"char":"L","width":19,"height":31,"xoffset":3,"yoffset":6,"xadvance":23,"chnl":15,"x":121,"y":0,"page":0},{"id":77,"index":16,"char":"M","width":25,"height":31,"xoffset":-1,"yoffset":6,"xadvance":23,"chnl":15,"x":0,"y":428,"page":0},{"id":78,"index":17,"char":"N","width":22,"height":31,"xoffset":0,"yoffset":6,"xadvance":23,"chnl":15,"x":0,"y":460,"page":0},{"id":80,"index":19,"char":"P","width":22,"height":31,"xoffset":1,"yoffset":6,"xadvance":23,"chnl":15,"x":23,"y":460,"page":0},{"id":82,"index":21,"char":"R","width":22,"height":31,"xoffset":1,"yoffset":6,"xadvance":23,"chnl":15,"x":26,"y":395,"page":0},{"id":84,"index":23,"char":"T","width":24,"height":31,"xoffset":0,"yoffset":6,"xadvance":23,"chnl":15,"x":26,"y":427,"page":0},{"id":85,"index":24,"char":"U","width":23,"height":31,"xoffset":0,"yoffset":6,"xadvance":23,"chnl":15,"x":47,"y":361,"page":0},{"id":86,"index":25,"char":"V","width":27,"height":31,"xoffset":-2,"yoffset":6,"xadvance":23,"chnl":15,"x":51,"y":327,"page":0},{"id":87,"index":26,"char":"W","width":25,"height":31,"xoffset":-1,"yoffset":6,"xadvance":23,"chnl":15,"x":49,"y":393,"page":0},{"id":88,"index":27,"char":"X","width":26,"height":31,"xoffset":-2,"yoffset":6,"xadvance":23,"chnl":15,"x":71,"y":359,"page":0},{"id":89,"index":28,"char":"Y","width":27,"height":31,"xoffset":-2,"yoffset":6,"xadvance":23,"chnl":15,"x":63,"y":282,"page":0},{"id":90,"index":29,"char":"Z","width":23,"height":31,"xoffset":0,"yoffset":6,"xadvance":23,"chnl":15,"x":79,"y":314,"page":0},{"id":116,"index":150,"char":"t","width":23,"height":31,"xoffset":-1,"yoffset":6,"xadvance":23,"chnl":15,"x":46,"y":459,"page":0},{"id":35,"index":612,"char":"#","width":25,"height":31,"xoffset":-1,"yoffset":6,"xadvance":23,"chnl":15,"x":51,"y":425,"page":0},{"id":49,"index":616,"char":"1","width":22,"height":31,"xoffset":1,"yoffset":6,"xadvance":23,"chnl":15,"x":75,"y":391,"page":0},{"id":50,"index":617,"char":"2","width":22,"height":31,"xoffset":1,"yoffset":6,"xadvance":23,"chnl":15,"x":70,"y":457,"page":0},{"id":52,"index":619,"char":"4","width":25,"height":31,"xoffset":-1,"yoffset":6,"xadvance":23,"chnl":15,"x":77,"y":423,"page":0},{"id":53,"index":620,"char":"5","width":20,"height":31,"xoffset":2,"yoffset":6,"xadvance":23,"chnl":15,"x":67,"y":225,"page":0},{"id":54,"index":621,"char":"6","width":22,"height":31,"xoffset":1,"yoffset":6,"xadvance":23,"chnl":15,"x":88,"y":225,"page":0},{"id":55,"index":622,"char":"7","width":22,"height":31,"xoffset":0,"yoffset":6,"xadvance":23,"chnl":15,"x":91,"y":257,"page":0},{"id":57,"index":624,"char":"9","width":22,"height":31,"xoffset":0,"yoffset":6,"xadvance":23,"chnl":15,"x":93,"y":455,"page":0},{"id":95,"index":591,"char":"_","width":27,"height":7,"xoffset":-2,"yoffset":38,"xadvance":23,"chnl":15,"x":79,"y":346,"page":0},{"id":60,"index":691,"char":"<","width":20,"height":27,"xoffset":1,"yoffset":10,"xadvance":23,"chnl":15,"x":103,"y":289,"page":0},{"id":62,"index":692,"char":">","width":20,"height":27,"xoffset":2,"yoffset":10,"xadvance":23,"chnl":15,"x":103,"y":317,"page":0},{"id":119,"index":153,"char":"w","width":26,"height":25,"xoffset":-1,"yoffset":12,"xadvance":23,"chnl":15,"x":87,"y":167,"page":0},{"id":97,"index":131,"char":"a","width":21,"height":25,"xoffset":1,"yoffset":12,"xadvance":23,"chnl":15,"x":93,"y":487,"page":0},{"id":99,"index":133,"char":"c","width":20,"height":25,"xoffset":1,"yoffset":12,"xadvance":23,"chnl":15,"x":115,"y":487,"page":0},{"id":101,"index":135,"char":"e","width":22,"height":25,"xoffset":0,"yoffset":12,"xadvance":23,"chnl":15,"x":89,"y":193,"page":0},{"id":109,"index":143,"char":"m","width":23,"height":25,"xoffset":0,"yoffset":12,"xadvance":23,"chnl":15,"x":111,"y":133,"page":0},{"id":110,"index":144,"char":"n","width":21,"height":25,"xoffset":1,"yoffset":12,"xadvance":23,"chnl":15,"x":128,"y":98,"page":0},{"id":111,"index":145,"char":"o","width":23,"height":25,"xoffset":0,"yoffset":12,"xadvance":23,"chnl":15,"x":132,"y":64,"page":0},{"id":114,"index":148,"char":"r","width":21,"height":25,"xoffset":2,"yoffset":12,"xadvance":23,"chnl":15,"x":139,"y":32,"page":0},{"id":115,"index":149,"char":"s","width":20,"height":25,"xoffset":2,"yoffset":12,"xadvance":23,"chnl":15,"x":141,"y":0,"page":0},{"id":117,"index":151,"char":"u","width":21,"height":25,"xoffset":1,"yoffset":12,"xadvance":23,"chnl":15,"x":111,"y":219,"page":0},{"id":118,"index":152,"char":"v","width":24,"height":25,"xoffset":-1,"yoffset":12,"xadvance":23,"chnl":15,"x":112,"y":193,"page":0},{"id":120,"index":154,"char":"x","width":24,"height":25,"xoffset":-1,"yoffset":12,"xadvance":23,"chnl":15,"x":114,"y":159,"page":0},{"id":122,"index":156,"char":"z","width":21,"height":25,"xoffset":1,"yoffset":12,"xadvance":23,"chnl":15,"x":135,"y":124,"page":0},{"id":58,"index":347,"char":":","width":10,"height":25,"xoffset":6,"yoffset":12,"xadvance":23,"chnl":15,"x":150,"y":90,"page":0},{"id":126,"index":588,"char":"~","width":24,"height":12,"xoffset":-1,"yoffset":18,"xadvance":23,"chnl":15,"x":0,"y":492,"page":0},{"id":43,"index":683,"char":"+","width":24,"height":24,"xoffset":0,"yoffset":12,"xadvance":23,"chnl":15,"x":156,"y":58,"page":0},{"id":94,"index":587,"char":"^","width":22,"height":17,"xoffset":0,"yoffset":6,"xadvance":23,"chnl":15,"x":64,"y":175,"page":0},{"id":61,"index":688,"char":"=","width":22,"height":14,"xoffset":1,"yoffset":17,"xadvance":23,"chnl":15,"x":70,"y":489,"page":0},{"id":42,"index":395,"char":"*","width":20,"height":21,"xoffset":1,"yoffset":4,"xadvance":23,"chnl":15,"x":46,"y":226,"page":0},{"id":96,"index":316,"char":"`","width":18,"height":12,"xoffset":-2,"yoffset":4,"xadvance":23,"chnl":15,"x":67,"y":257,"page":0},{"id":44,"index":345,"char":",","width":14,"height":18,"xoffset":3,"yoffset":26,"xadvance":23,"chnl":15,"x":25,"y":492,"page":0},{"id":34,"index":593,"char":"\\"","width":17,"height":14,"xoffset":3,"yoffset":4,"xadvance":23,"chnl":15,"x":46,"y":491,"page":0},{"id":45,"index":350,"char":"-","width":16,"height":7,"xoffset":3,"yoffset":20,"xadvance":23,"chnl":15,"x":114,"y":185,"page":0},{"id":39,"index":592,"char":"\'","width":9,"height":14,"xoffset":7,"yoffset":4,"xadvance":23,"chnl":15,"x":91,"y":289,"page":0},{"id":46,"index":348,"char":".","width":11,"height":11,"xoffset":6,"yoffset":27,"xadvance":23,"chnl":15,"x":45,"y":75,"page":0},{"id":32,"index":3,"char":" ","width":0,"height":0,"xoffset":-2,"yoffset":33,"xadvance":23,"chnl":15,"x":57,"y":109,"page":0}]'),info$1={face:"CONSOLAS",size:42,bold:0,italic:0,charset:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","[","\\","]","^","_","`","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","{","|","}","~"," ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/","0","1","2","3","4","5","6","7","8","9",":",";","<","=",">","?","@"],unicode:1,stretchH:100,smooth:1,aa:1,padding:[2,2,2,2],spacing:[0,0]},common$1={lineHeight:49,base:33,scaleW:512,scaleH:512,pages:1,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0},distanceField$1={fieldType:"msdf",distanceRange:4},kernings$1=[],ConsolasFontJSON={pages:pages$1,chars:chars$1,info:info$1,common:common$1,distanceField:distanceField$1,kernings:kernings$1},ConsolasFontImage="/assets/CONSOLAS-DDiytbpg.png",vertexShader=`
  varying vec2 vUv;
  varying vec3 vPosition;
  varying vec3 vNormal;
  
  void main() {
    vUv = uv;
    vPosition = position;
    vNormal = normalize(normalMatrix * normal);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,fragmentShader=`
  uniform float time;
  uniform vec3 baseColor;
  uniform vec3 glowColor;
  uniform float blinkSpeed;
  uniform float glowIntensity;
  
  varying vec2 vUv;
  varying vec3 vPosition;
  varying vec3 vNormal;
  
  void main() {
    // Create a pulsing effect based on time
    float pulse = sin(time * blinkSpeed) * 0.5 + 0.5;
    
    // Create a glow effect that pulses
    float glow = pulse * glowIntensity;
    
    // Mix base color with glow color based on pulse
    vec3 finalColor = mix(baseColor, glowColor, glow);
    
    // Add some variation based on position for more interesting effect
    float positionVariation = sin(vPosition.x * 10.0 + time) * 0.1 + 0.9;
    finalColor *= positionVariation;
    
    // Add edge glow effect
    float edgeGlow = 1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0)));
    edgeGlow = pow(edgeGlow, 2.0);
    finalColor += glowColor * edgeGlow * pulse * 0.3;
    
    gl_FragColor = vec4(finalColor, 1.0);
  }
`,SHADER_CONFIG={lesson1:{0:{target:"jstPin.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.8},onDragStart:"removeFromJstPinAndApplyToRgbPin1",onDragEnd:"none",onSnap:"removeFromRgbPin1"},1:{target:"jstPin.pinGLTF2",action:"blink",config:{baseColor:2899536,glowColor:15158332,blinkSpeed:2.5,glowIntensity:.9},onDragStart:"removeFromJstPinAndApplyToRgbPin",onDragEnd:"none",onSnap:"removeFromRgbPin"},2:{target:"nanoModel",action:"blink",config:{baseColor:2899536,glowColor:10181046,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromNanoApplyToExpansionNano",onDragEnd:"none",onSnap:"removeFromExpansionNano"},3:{target:"jstPinBattery.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:15158332,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromJstPinBatteryAndApplyToPowerPin",onDragEnd:"none",onSnap:"removeFromPowerPin"}},lesson2:{1:{target:"jstPin2.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:15965202,blinkSpeed:2,glowIntensity:.8},onDragStart:"removeFromJstPin2AndApplyToBuzzer",onDragEnd:"none",onSnap:"removeFromBuzzer"},2:{target:"jstPin2.pinGLTF2",action:"blink",config:{baseColor:2899536,glowColor:10181046,blinkSpeed:2,glowIntensity:.8},onDragStart:"removeFromJstPin2AndApplyToMalePin",onDragEnd:"none",onSnap:"removeFromMalePin"},3:{target:"nanoModel",action:"blink",config:{baseColor:2899536,glowColor:10181046,blinkSpeed:2,glowIntensity:.8},onDragStart:"removeFromNanoApplyToExpansionNano",onDragEnd:"none",onSnap:"removeFromExpansionNano"},4:{target:"jstPinBattery.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:10181046,blinkSpeed:2,glowIntensity:.8},onDragStart:"removeFromJstPinBatteryAndApplyToPowerPin",onDragEnd:"none",onSnap:"removeFromPowerPin"}},lesson3:{1:{target:"nanoModel",action:"blink",config:{baseColor:2899536,glowColor:10181046,blinkSpeed:2,glowIntensity:.8},onDragStart:"removeFromNanoApplyToExpansionNano",onDragEnd:"none",onSnap:"removeFromExpansionNano"},2:{target:"jstPin2.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:1752220,blinkSpeed:2,glowIntensity:.8},onDragStart:"removeFromJstPin2AndApplyToLdrPin",onDragEnd:"none",onSnap:"removeFromLdrPin"},3:{target:"jstPin2.pinGLTF2",action:"blink",config:{baseColor:2899536,glowColor:1752220,blinkSpeed:2,glowIntensity:.8},onDragStart:"removeFromJstPin2AndApplyToLdr",onDragEnd:"none",onSnap:"removeFromLdrPin001"},4:{target:"jstPin.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.8},onDragStart:"removeFromJstPinAndApplyToRgbPin1",onDragEnd:"none",onSnap:"removeFromRgbPin1"},5:{target:"jstPin.pinGLTF2",action:"blink",config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.8},onDragStart:"removeFromJstPinAndApplyToRgbLed",onDragEnd:"none",onSnap:"removeFromRgbLed"},6:{target:"batteryWire2.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.8},onDragStart:"removeFromBatteryWire2AndApplyToPowerPin",onDragEnd:"none",onSnap:"removeFromPowerPin"}},lesson4:{1:{target:"nanoModel",action:"blink",config:{baseColor:2899536,glowColor:10181046,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromNanoApplyToExpansionNano",onDragEnd:"none",onSnap:"removeFromExpansionNano"},2:{target:"jstPin.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:15158332,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromJstPinAndApplyToMotorDriverMotorPin1",onDragEnd:"none",onSnap:"removeFromMotorDriverPin"},3:{target:"jstPin.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromJstPinAndApplyToMotorDriverPin",onDragEnd:"none",onSnap:"removeFromMotorDriverPin"},4:{target:"jstPin.pinGLTF2",action:"blink",config:{baseColor:2899536,glowColor:1752220,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromJstPinAndApplyToMotorDriverInputPin",onDragEnd:"none",onSnap:"removeFromMotorDriverInputPin"},5:{target:"jstPin.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:15965202,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromJstPinAndApplyToMotorDriverPowerPin",onDragEnd:"none",onSnap:"removeFromMotorDriverPowerPin"},6:{target:"batteryWire2.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromBatteryWire2AndApplyToPowerPin",onDragEnd:"none",onSnap:"removeFromPowerPin"}},lesson5:{1:{target:"nanoModel",action:"blink",config:{baseColor:2899536,glowColor:10181046,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromNanoApplyToExpansionNano",onDragEnd:"none",onSnap:"removeFromExpansionNano"},2:{target:"jstPin.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:1752220,blinkSpeed:2,glowIntensity:.8},onDragStart:"removeFromJstPinAndApplyToTsopPin",onDragEnd:"none",onSnap:"removeFromTsopPin"},3:{target:"jstPin.pinGLTF2",action:"blink",config:{baseColor:2899536,glowColor:1752220,blinkSpeed:2,glowIntensity:.8},onDragStart:"removeFromJstPinAndApplyToExpansionBoardTsopPin",onDragEnd:"none",onSnap:"removeFromExpansionBoardTsopPin"},4:{target:"jstPin.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:15158332,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromJstPinAndApplyToMotorDriverMotorPin1",onDragEnd:"none",onSnap:"removeFromMotorDriverPin"},5:{target:"jstPin.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromJstPinAndApplyToMotorDriverPin",onDragEnd:"none",onSnap:"removeFromMotorDriverPin"},6:{target:"jstPin.pinGLTF2",action:"blink",config:{baseColor:2899536,glowColor:1752220,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromJstPinAndApplyToMotorDriverInputPin",onDragEnd:"none",onSnap:"removeFromMotorDriverInputPin"},7:{target:"jstPin.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:15965202,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromJstPinAndApplyToMotorDriverPowerPin",onDragEnd:"none",onSnap:"removeFromMotorDriverPowerPin"},8:{target:"jstPin.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromJstPinAndApplyToPowerPin",onDragEnd:"none",onSnap:"removeFromPowerPin"},9:{target:"batteryWire2.pinGLTF1",action:"blink",config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.9},onDragStart:"removeFromBatteryWire2AndApplyToPowerPin",onDragEnd:"none",onSnap:"removeFromPowerPin"}}};class ShaderManager{constructor(){this.currentShader=null,this.originalMaterials=new Map,this.materialMeshes=new Map,this.isActive=!1,this.currentConfig=null,this.lastDraggedObject=null}createShaderMaterial(e){return new ShaderMaterial({uniforms:{time:{value:0},baseColor:{value:new Color(e.baseColor)},glowColor:{value:new Color(e.glowColor)},blinkSpeed:{value:e.blinkSpeed},glowIntensity:{value:e.glowIntensity}},vertexShader,fragmentShader,transparent:!0,side:DoubleSide,toneMapped:!1})}getMeshesFromObject(e){const t=[];return e&&(e.geometry&&e.material?t.push(e):e.children&&e.children.length>0&&e.traverse(o=>{if(o.material&&o.geometry){const i=o.name.toLowerCase(),s=i.includes("wire")||i.includes("line")||i.includes("cable")||i.includes("trace")||i.includes("conductor");let r=!1;if(o.geometry&&(o.geometry.boundingBox||o.geometry.computeBoundingBox(),o.geometry.boundingBox)){const a=o.geometry.boundingBox,l=a.max.x-a.min.x,c=a.max.y-a.min.y,d=a.max.z-a.min.z;r=l<.001||c<.001||d<.001;const u=Math.max(l,c,d),f=Math.min(l,c,d),h=u/(f+1e-4);r=r||h>200}!s&&!r&&t.push(o)}})),t}storeOriginalMaterials(e,t){e.userData||(e.userData={});const o=[];t.forEach((i,s)=>{try{o.push(i.material.clone())}catch(r){console.warn(`Could not clone material for mesh ${s}:`,r),o.push(new MeshStandardMaterial({color:8421504,metalness:.5,roughness:.5}))}}),e.userData.originalMaterials=o,e.userData.materialMeshes=t,this.originalMaterials.set(e,o),this.materialMeshes.set(e,t)}applyShaderToObject(e,t){if(!e)return console.warn("Cannot apply shader: object is null"),!1;const o=this.getMeshesFromObject(e);if(o.length===0)return console.warn("No valid meshes found in object:",e),!1;this.storeOriginalMaterials(e,o);const i=t.config||t;return this.currentShader=this.createShaderMaterial(i),o.forEach(s=>{s.material=this.currentShader}),this.isActive=!0,this.currentConfig=t,console.log(`Shader applied to ${e.name||"object"} with ${o.length} meshes`),console.log("Shader Manager: Current config set to:",this.currentConfig),!0}removeShaderFromObject(e){if(!e||!e.userData||!e.userData.originalMaterials||!e.userData.materialMeshes)return console.warn("Cannot remove shader: no original materials stored"),!1;const t=e.userData.originalMaterials;return e.userData.materialMeshes.forEach((i,s)=>{t[s]&&(i.material=t[s],i.material.needsUpdate!==void 0&&(i.material.needsUpdate=!0))}),this.currentShader=null,console.log(`Shader removed from ${e.name||"object"}`),!0}removeShaderFromObjectAndChildren(e){if(!e)return!1;let t=this.removeShaderFromObject(e);return e.traverse(o=>{if(o.material&&o.userData&&o.userData.originalMaterials){const i=this.removeShaderFromObject(o);t=t||i}else o.material&&o.material.type==="ShaderMaterial"&&(console.log("Shader Manager: Found shader material without original materials, restoring to default"),o.material=new MeshStandardMaterial({color:8421504,metalness:.5,roughness:.5}),o.material.needsUpdate=!0,t=!0)}),t}update(e){this.currentShader&&this.isActive&&(this.currentShader.uniforms.time.value+=e);try{this._dragLabel&&this._dragLabel.visible&&this.faceLabelToCamera(this._dragLabel)}catch{}try{this._dropLabel&&this._dropLabel.visible&&this.faceLabelToCamera(this._dropLabel)}catch{}}ensureMeshUIFontLoaded(){if(!this._fontLoaded){this._textureLoader||(this._textureLoader=new TextureLoader);try{this._fontFamily=ConsolasFontJSON,this._fontTexture=ConsolasFontImage,this._fontLoaded=!0;try{this._dragLabel&&this._dragLabel.set({fontFamily:this._fontFamily,fontTexture:this._fontTexture})}catch{}try{this._dropLabel&&this._dropLabel.set({fontFamily:this._fontFamily,fontTexture:this._fontTexture})}catch{}try{this._dragLabel&&this._dragLabel.traverse(e=>{e&&e.isText&&e.set({color:new Color(0)})})}catch{}try{this._dropLabel&&this._dropLabel.traverse(e=>{e&&e.isText&&e.set({color:new Color(0)})})}catch{}}catch(e){console.warn("Failed to load MeshUI font:",e)}}}getDragLabel(){if(this.ensureMeshUIFontLoaded(),!this._dragLabel){this._dragLabel=new __webpack_exports__default.Block({width:.25,height:.06,padding:.005,margin:.002,backgroundOpacity:1,backgroundColor:new Color(15771648),borderRadius:.01,alignItems:"center",justifyContent:"center",fontFamily:this._fontFamily,fontTexture:this._fontTexture});const e=new __webpack_exports__default.Text({content:"Drag",fontSize:.018,fontFamily:this._fontFamily,fontTexture:this._fontTexture,color:new Color(0)});this._dragLabel.add(e);try{window.currentScene&&window.currentScene.add(this._dragLabel)}catch{}this._dragLabel.visible=!1,this.applyLabelRenderSettings(this._dragLabel);try{e.set({color:new Color(0)})}catch{}}return this._dragLabel}getDropLabel(){if(this.ensureMeshUIFontLoaded(),!this._dropLabel){this._dropLabel=new __webpack_exports__default.Block({width:.25,height:.07,padding:.006,margin:.002,backgroundOpacity:.9,backgroundColor:new Color(15771648),borderRadius:.012,alignItems:"center",justifyContent:"center",fontFamily:this._fontFamily,fontTexture:this._fontTexture});const e=new __webpack_exports__default.Text({content:"Drop",fontSize:.02,fontFamily:this._fontFamily,fontTexture:this._fontTexture,color:new Color(0)});this._dropLabel.add(e);try{window.currentScene&&window.currentScene.add(this._dropLabel)}catch{}this._dropLabel.visible=!1,this.applyLabelRenderSettings(this._dropLabel);try{e.set({color:new Color(0)})}catch{}}return this._dropLabel}ensureMinHeight(e){return e&&typeof e.y=="number"&&(e.y=Math.max(.1,e.y)),e}faceLabelToCamera(e){try{e&&window.camera&&e.lookAt(window.camera.position)}catch{}}applyLabelRenderSettings(e){try{e.renderOrder=9999,e.traverse(t=>{t.material&&(t.material.depthTest=!1,t.renderOrder=9999,t.material.transparent!==!0&&(t.material.transparent=!0))})}catch{}}getSnapPointFor(e){const t={FIRST_FEMALE_PIN_SNAP_POINT:new Vector3$1(-.03,1.77,-3.26),SECOND_FEMALE_PIN_SNAP_POINT:new Vector3$1(-.63,1.77,-3.25),NANO_SNAP_POINT:new Vector3$1(-.005,1.757,-3.45),NANO_SNAP_POINT_LESSON2:new Vector3$1(-.005,1.757,-3.37),JSTPIN2_SIDE1_SNAP_POINT:new Vector3$1(-.01,1.82,-3.25),JSTPIN2_SIDE2_SNAP_POINT:new Vector3$1(.45,1.85,-3),JSTPIN_BATTERY_SNAP_POINT:new Vector3$1(.239,1.78,-3.36),JSTPIN_BATTERY_SNAP_POINT_LESSON2:new Vector3$1(-.22,1.777,-3.46)},o=typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson1",i=typeof window.getCurrentStep=="function"?window.getCurrentStep():0;if(o==="lesson3"){if(i===2&&(e==="jstPin2"||e==="jstPin2.pinGLTF1")){const s=this.getTargetObject("ldrPin");if(s&&s.getWorldPosition){const r=new Vector3$1;return s.getWorldPosition(r),this.ensureMinHeight(r)}}if(i===3&&(e==="jstPin2"||e==="jstPin2.pinGLTF2")){let s=null;try{window.ldrModel&&window.ldrModel.traverse(r=>{!s&&r&&r.name==="ldrPin"&&(s=r)})}catch{}if(s&&s.getWorldPosition){const r=new Vector3$1;return s.getWorldPosition(r),this.ensureMinHeight(r)}}if(i===4&&(e==="jstPin"||e==="jstPin.pinGLTF1")){const s=this.getTargetObject("rgbPin1");if(s&&s.getWorldPosition){const r=new Vector3$1;return s.getWorldPosition(r),this.ensureMinHeight(r)}}if(i===5&&(e==="jstPin"||e==="jstPin.pinGLTF2")){const s=this.getTargetObject("rgbPin");if(s&&s.getWorldPosition){const r=new Vector3$1;return s.getWorldPosition(r),this.ensureMinHeight(r)}}}if(o==="lesson4"){if(i===1&&e==="nanoModel"){const s=this.getTargetObject("expansionBoard");if(s){const r=new Vector3$1;return s.getWorldPosition(r),this.ensureMinHeight(r)}}if(i===2&&(e==="jstPin"||e==="jstPin.pinGLTF1")){const s=typeof window<"u"?window.motorDriverModel:null;try{if(s&&s.children&&s.children[1]){const r=new Vector3$1;return s.children[1].getWorldPosition(r),this.ensureMinHeight(r)}}catch{}}if(i===3&&(e==="jstPin"||e==="jstPin.pinGLTF2")){const s=this.getTargetObject("expansionBoard");if(s){let r=null;try{s.traverse(a=>{!r&&a&&a.name==="motordriverPin"&&(r=a)})}catch{}if(r){const a=new Vector3$1;return r.getWorldPosition(a),this.ensureMinHeight(a)}}}if(i===4&&(e==="jstPin"||e==="jstPin.pinGLTF2")){const s=typeof window<"u"?window.motorDriverModel:null;if(s){let r=null;try{s.traverse(a=>{!r&&a&&a.name==="motorDriverInputPin"&&(r=a)})}catch{}if(r){const a=new Vector3$1;return r.getWorldPosition(a),this.ensureMinHeight(a)}}}if(i===5&&(e==="jstPin"||e==="jstPin.pinGLTF1")){const s=typeof window<"u"?window.motorDriverModel:null;try{if(s&&s.children&&s.children[4]){const r=new Vector3$1;return s.children[4].getWorldPosition(r),this.ensureMinHeight(r)}}catch{}}if(i===6&&(e==="jstPin"||e==="jstPin.pinGLTF1"||e==="batteryWire2")){const s=this.getTargetObject("expansionBoard");if(s){let r=null;try{s.traverse(a=>{!r&&a&&a.name==="powerPin"&&(r=a)})}catch{}if(r){const a=new Vector3$1;return r.getWorldPosition(a),this.ensureMinHeight(a)}}}}switch(e){case"nanoModel":return o==="lesson2"?t.NANO_SNAP_POINT_LESSON2.clone():t.NANO_SNAP_POINT.clone();case"secondPin4Female":return t.SECOND_FEMALE_PIN_SNAP_POINT.clone();case"jstPin2":case"jstPin2.pinGLTF1":return t.JSTPIN2_SIDE1_SNAP_POINT.clone();case"jstPin2.pinGLTF2":return t.JSTPIN2_SIDE2_SNAP_POINT.clone();case"jstPinBattery":case"jstPinBattery.pinGLTF1":return o==="lesson2"?t.JSTPIN_BATTERY_SNAP_POINT_LESSON2.clone():t.JSTPIN_BATTERY_SNAP_POINT.clone();case"jstPin":case"jstPin.pinGLTF1":return t.FIRST_FEMALE_PIN_SNAP_POINT.clone();case"jstPin.pinGLTF2":return t.SECOND_FEMALE_PIN_SNAP_POINT.clone();case"tempSensorModel":return t.FIRST_FEMALE_PIN_SNAP_POINT.clone();default:return null}}handleStepShader(e,t){console.log("Shader Manager: handleStepShader called",{lessonId:e,stepIndex:t});const o=SHADER_CONFIG[e];if(!o||!o[t]){console.log("Shader Manager: No shader config found for",e,"step",t),this.cleanup();return}const i=o[t],s=this.getTargetObject(i.target);if(console.log("Shader Manager: Step config found",{stepConfig:i,targetObject:i.target,foundObject:s}),s){this.originalMaterials.size>0&&(console.log("Shader Manager: Clearing previously applied shaders before applying new step"),this.originalMaterials.forEach((a,l)=>{this.removeShaderFromObject(l)}),this.originalMaterials.clear(),this.materialMeshes.clear(),this.currentShader=null,this.isActive=!1);const r=this.getTargetObject("ldrModel");r&&(console.log("Shader Manager: Additional cleanup - removing shaders from LDR model"),this.removeShaderFromObjectAndChildren(r)),console.log("Shader Manager: Applying shader to target object",s),this.applyShaderToObject(s,i);try{const a=this.getDragLabel(),l=new Vector3$1;s.getWorldPosition(l);const c=l.clone().add(new Vector3$1(0,.15,0));this.ensureMinHeight(c),a.position.copy(c),this.faceLabelToCamera(a),a.visible=!0}catch(a){console.warn("Failed to position Drag label:",a)}}else{console.warn(`Target object '${i.target}' not found for ${e} step ${t}`);return}Array.isArray(i.additionalTargets)&&i.additionalTargets.forEach(r=>{const a=this.getTargetObject(r);a?(console.log("Shader Manager: Applying shader to additional target",r),this.applyShaderToObject(a,i)):console.warn("Shader Manager: Additional target not found:",r)})}getTargetObject(e){var t;switch(console.log("Shader Manager: getTargetObject called with targetName:",e),console.log("Shader Manager: Available objects:",{jstPin:window.jstPin,jstPinGroup:(t=window.jstPin)==null?void 0:t.group,jstPin2:window.jstPin2,jstPin3:window.jstPin3,nanoModel:window.nanoModel,tempSensorModel:window.tempSensorModel,expansionBoardModel:window.expansionBoardModel,rgbLEDModel:window.rgbLEDModel}),e){case"jstPin":const o=window.jstPin?window.jstPin.group:null;return console.log("Shader Manager: jstPin group found:",o),o;case"jstPin.pinGLTF1":return window.jstPin?window.jstPin.pinGLTF1:null;case"jstPin.pinGLTF2":return window.jstPin?window.jstPin.pinGLTF2:null;case"jstPin2":return window.jstPin2?window.jstPin2.group:null;case"jstPin2.pinGLTF1":return window.jstPin2?window.jstPin2.pinGLTF1:null;case"jstPin2.pinGLTF2":return window.jstPin2?window.jstPin2.pinGLTF2:null;case"jstPin3":return window.jstPin3?window.jstPin3.group:null;case"nanoModel":return window.nanoModel;case"tempSensorModel":return window.tempSensorModel;case"expansionBoard":return window.expansionBoardModel;case"buzzer":{if(window.expansionBoardModel){let s=null;if(window.expansionBoardModel.traverse(r=>{typeof r.name=="string"&&r.name.toLowerCase().includes("buzzerpin")&&(s=r)}),s)return s}return window.buzzerModel||null}case"buzzerPin":{if(window.expansionBoardModel){let s=null;if(window.expansionBoardModel.traverse(r=>{typeof r.name=="string"&&r.name.toLowerCase().includes("buzzerpin")&&(s=r)}),s)return s}return window.buzzerModel||null}case"tsopPin":{if(window.tsopModel){let s=null;if(window.tsopModel.traverse(r=>{r&&r.name==="tsopPin"&&(s=r)}),s)return s}if(window.expansionBoardModel){let s=null;return window.expansionBoardModel.traverse(r=>{r&&typeof r.name=="string"&&r.name.toLowerCase().includes("tsoppin")&&(s=r)}),s}return null}case"expansionBoardTsopPin":{if(window.expansionBoardModel){let s=null;return window.expansionBoardModel.traverse(r=>{r&&r.name==="tsopPin"&&(s=r)}),s}return null}case"malePin":{if(window.buzzerModel){let s=null;return window.buzzerModel.traverse(r=>{typeof r.name=="string"&&r.name.toLowerCase().includes("malepin")&&(s=r)}),console.log("Shader Manager: malePin child found:",s),s}return null}case"rgbPin1":const i=window.expansionBoardModel;if(i){let s=null;return i.traverse(r=>{r.name==="rgbPin1"&&(s=r)}),console.log("Shader Manager: rgbPin1 child found:",s),s}return null;case"ldrPin":if(window.expansionBoardModel){let s=null;return window.expansionBoardModel.traverse(r=>{r&&r.name==="ldrPin"&&(s=r)}),console.log("Shader Manager: ldrPin child found:",s),s}return null;case"ldrModel":return console.log("Shader Manager: ldrModel found:",window.ldrModel),window.ldrModel;case"jstPinBattery":return window.jstPinBattery?window.jstPinBattery.group||window.jstPinBattery.pinGLTF1:null;case"jstPinBattery.pinGLTF1":return window.jstPinBattery?window.jstPinBattery.pinGLTF1:null;case"powerPin":if(window.expansionBoardModel){let s=null;return window.expansionBoardModel.traverse(r=>{r.name==="powerPin"&&(s=r)}),console.log("Shader Manager: powerPin child found:",s),s}return null;case"rgbLED":return window.rgbLEDModel;case"rgbPin":{if(window.rgbLEDModel){let s=null;return window.rgbLEDModel.traverse(r=>{r.name==="rgbPin"&&(s=r)}),console.log("Shader Manager: rgbPin child found:",s),s}return null}case"rgbled":if(window.rgbLEDModel){let s=null;return window.rgbLEDModel.traverse(r=>{r.name==="rgbPin"&&(s=r)}),console.log("Shader Manager: rgbled child found:",s),s}return null;case"expansionNano":if(window.expansionBoardModel){let s=null;const r=[];return window.expansionBoardModel.traverse(a=>{r.push(a.name),(a.name==="nano"||a.name==="nanoPin"||a.name==="arduinoPin"||a.name==="arduinoNanoPin"||a.name.toLowerCase().includes("nano")||a.name.toLowerCase().includes("arduino"))&&(s=a)}),console.log("Shader Manager: expansion board children:",r),console.log("Shader Manager: expansion nano child found:",s),s}return null;case"motorDriverPin":{if(window.expansionBoardModel){let s=null;return window.expansionBoardModel.traverse(r=>{r&&typeof r.name=="string"&&r.name.toLowerCase().includes("motordriverpin")&&(s=r)}),s}if(window.motorDriverModel){let s=null;return window.motorDriverModel.traverse(r=>{r&&typeof r.name=="string"&&r.name.toLowerCase().includes("motordriverpin")&&(s=r)}),s}return null}case"motorDriverMotorPin1":{if(window.motorDriverModel){let s=null;if(window.motorDriverModel.traverse(r=>{r&&r.name==="motorDriverMotorPin1"&&(s=r)}),s)return s}if(window.expansionBoardModel){let s=null;return window.expansionBoardModel.traverse(r=>{r&&r.name==="motorDriverMotorPin1"&&(s=r)}),s}return null}case"motorDriverInputPin":{if(window.motorDriverModel){let s=null;if(window.motorDriverModel.traverse(r=>{r&&typeof r.name=="string"&&r.name.toLowerCase().includes("motordriverinputpin")&&(s=r)}),s)return s}if(window.expansionBoardModel){let s=null;return window.expansionBoardModel.traverse(r=>{r&&typeof r.name=="string"&&r.name.toLowerCase().includes("motordriverinputpin")&&(s=r)}),s}return null}case"motorDriverPowerPin":{if(window.motorDriverModel){let r=null;if(window.motorDriverModel.traverse(a=>{a&&typeof a.name=="string"&&a.name.toLowerCase().includes("power")&&(r=a)}),r)return r}return this.getTargetObject("powerPin")}case"rgbLed":return window.rgbLedModel;case"batteryWire2":return window.batteryWire2;case"batteryWire2.pinGLTF1":return window.batteryWire2;default:return console.warn(`Unknown target object: ${e}`),null}}handleDragStart(e){var a,l;console.log("Shader Manager: Drag start detected",{draggedObject:e,isActive:this.isActive,currentConfig:this.currentConfig,hasCurrentShader:!!this.currentShader}),this.lastDraggedObject=e;const t=typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson1",o=typeof window.getCurrentStep=="function"?window.getCurrentStep():0;try{window.orbitControls&&(window.orbitControls.enabled=!1)}catch{}console.log("Shader Manager: Getting current config for lesson/step:",t,o);const i=SHADER_CONFIG[t];if(i&&i[o])this.currentConfig=i[o],console.log("Shader Manager: Updated current config:",this.currentConfig);else{console.warn("Shader Manager: No config found for",t,"step",o);return}const s=this.getObjectName(e),r=(a=this.currentConfig)==null?void 0:a.onDragStart;console.log("Shader Manager: Drag start details",{draggedObjectName:s,onDragStartAction:r,currentConfig:this.currentConfig});try{const c=this.getDragLabel();c.visible=!1}catch{}try{const c=this.getDropLabel(),d=this.getSnapPointFor(s);if(d){const u=d.clone().add(new Vector3$1(0,.08,0));this.ensureMinHeight(u),c.position.copy(u),this.faceLabelToCamera(c),c.visible=!0}else c.visible=!1}catch(c){console.warn("Failed to position Drop label:",c)}if(r==="removeFromJstPinAndApplyToRgbPin1"&&(s==="jstPin"||s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){console.log("Shader Manager: JST pin (or child) dragged, removing shader from dragged object and applying to rgbPin1");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){const u=this.getTargetObject(s);u&&(console.log("Shader Manager: Attempting removal from pin child container:",s),c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin");u?(console.log("Shader Manager: Fallback removal from JST pin group"),this.removeShaderFromObject(u)):console.warn("Shader Manager: JST pin object not found for shader removal")}const d=this.getTargetObject("rgbPin1");if(d){console.log("Shader Manager: Applying shader to rgbPin1 on drag start");const u=this.currentConfig||{config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: rgbPin1 not found for shader application on drag start")}else if(r==="removeFromJstPinAndApplyToRgbPin"&&(s==="jstPin"||s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){console.log("Shader Manager: JST pin (or child) dragged, removing shader from dragged object and applying to rgbPin");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){const u=this.getTargetObject(s);u&&(console.log("Shader Manager: Attempting removal from pin child container:",s),c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin");u?(console.log("Shader Manager: Fallback removal from JST pin group"),this.removeShaderFromObject(u)):console.warn("Shader Manager: JST pin object not found for shader removal")}const d=this.getTargetObject("rgbPin");if(d){console.log("Shader Manager: Applying shader to rgbPin on drag start");const u=this.currentConfig||{config:{baseColor:2899536,glowColor:15158332,blinkSpeed:2.5,glowIntensity:.9}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: rgbPin not found for shader application on drag start")}else if(r==="removeFromJstPinAndApplyToMotorDriverMotorPin1"&&(s==="jstPin"||s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){console.log("Shader Manager: JST pin (or child) dragged, removing shader from dragged object and applying to motorDriverMotorPin1");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){const u=this.getTargetObject(s);u&&(console.log("Shader Manager: Attempting removal from pin child container:",s),c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin");u?(console.log("Shader Manager: Fallback removal from JST pin group"),this.removeShaderFromObject(u)):console.warn("Shader Manager: JST pin object not found for shader removal")}const d=this.getTargetObject("motorDriverMotorPin1");if(d){console.log("Shader Manager: Applying shader to motorDriverMotorPin1 on drag start");const u=this.currentConfig||{config:{baseColor:2899536,glowColor:15158332,blinkSpeed:2,glowIntensity:.9}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: motorDriverMotorPin1 not found for shader application on drag start")}else if(r==="removeFromNanoApplyToExpansionNano"&&(s==="nanoModel"||s==="unknown")){if(console.log('Shader Manager: Nano dragged, removing shader from nanoModel and applying to expansion board child "nano"'),!this.removeShaderFromObject(e)){const u=this.getTargetObject("nanoModel");u?(console.log("Shader Manager: Fallback removal from nanoModel root"),this.removeShaderFromObject(u)):console.warn("Shader Manager: nanoModel object not found for shader removal")}const d=this.getTargetObject("expansionNano");if(console.log("Shader Manager: expansionNano target found:",d),console.log("Shader Manager: expansionBoardModel exists:",!!window.expansionBoardModel),d){console.log('Shader Manager: Applying shader to expansion board child "nano" on drag start');const u=this.currentConfig||{config:{baseColor:2899536,glowColor:10181046,blinkSpeed:2,glowIntensity:.9}},f=this.applyShaderToObject(d,u);console.log("Shader Manager: Shader application to expansionNano successful:",f)}else if(console.warn('Shader Manager: expansion board child "nano" not found for shader application on drag start'),window.expansionBoardModel){const u=[];window.expansionBoardModel.traverse(f=>{u.push(f.name)}),console.log("Shader Manager: All expansion board children:",u)}}else if(r==="removeFromJstPinBatteryAndApplyToPowerPin"){console.log("Shader Manager: Battery pin dragged, remove from jstPinBattery and apply to powerPin");const c=this.getTargetObject("jstPinBattery.pinGLTF1")||this.getTargetObject("jstPinBattery");c&&this.removeShaderFromObject(c);const d=this.getTargetObject("powerPin");if(d){const u=this.currentConfig||{config:{baseColor:2899536,glowColor:15158332,blinkSpeed:2,glowIntensity:.9}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: powerPin child not found for shader application on drag start")}else if(r==="removeFromJstPin2AndApplyToMalePin"&&(s==="jstPin2"||s==="jstPin2.pinGLTF1"||s==="jstPin2.pinGLTF2")){console.log("Shader Manager: Removing from jstPin2 (or child) and applying to malePin");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin2.pinGLTF1"||s==="jstPin2.pinGLTF2")){const u=this.getTargetObject(s);u&&(c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin2");u&&this.removeShaderFromObject(u)}const d=this.getTargetObject("malePin");if(d){const u=this.currentConfig||{config:{baseColor:2899536,glowColor:10181046,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: malePin target not found for shader application")}else if(r==="removeFromJstPin2AndApplyToBuzzer"&&(s==="jstPin2"||s==="jstPin2.pinGLTF1"||s==="jstPin2.pinGLTF2")){console.log("Shader Manager: Removing from jstPin2 (or child) and applying to buzzer");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin2.pinGLTF1"||s==="jstPin2.pinGLTF2")){const u=this.getTargetObject(s);u&&(c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin2");u&&this.removeShaderFromObject(u)}const d=this.getTargetObject("buzzerPin");if(d){const u=this.currentConfig||{config:{baseColor:2899536,glowColor:15965202,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: buzzer target not found for shader application")}else if(r==="removeFromJstPin2AndApplyToRgbPin1"&&(s==="jstPin2"||s==="jstPin2.pinGLTF1"||s==="jstPin2.pinGLTF2")){console.log("Shader Manager: JST pin 2 (or child) dragged, removing shader from dragged object and applying to rgbPin1");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin2.pinGLTF1"||s==="jstPin2.pinGLTF2")){const u=this.getTargetObject(s);u&&(console.log("Shader Manager: Attempting removal from jstPin2 pin child container:",s),c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin2");u?(console.log("Shader Manager: Fallback removal from jstPin2 group"),this.removeShaderFromObject(u)):console.warn("Shader Manager: jstPin2 object not found for shader removal")}const d=this.getTargetObject("rgbPin1");if(d){console.log("Shader Manager: Applying shader to rgbPin1 on drag start (from jstPin2)");const u=this.currentConfig||{config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: rgbPin1 not found for shader application on drag start (from jstPin2)")}else if(r==="removeFromJstPin3AndApplyToRgbPin1"&&(s==="jstPin3"||s==="jstPin3.pinGLTF1"||s==="jstPin3.pinGLTF2")){console.log("Shader Manager: JST pin 3 (or child) dragged, removing shader from dragged object and applying to rgbPin1");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin3.pinGLTF1"||s==="jstPin3.pinGLTF2")){const u=this.getTargetObject(s);u&&(console.log("Shader Manager: Attempting removal from jstPin3 pin child container:",s),c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin3");u?(console.log("Shader Manager: Fallback removal from jstPin3 group"),this.removeShaderFromObject(u)):console.warn("Shader Manager: jstPin3 object not found for shader removal")}const d=this.getTargetObject("rgbPin1");if(d){console.log("Shader Manager: Applying shader to rgbPin1 on drag start (from jstPin3)");const u=this.currentConfig||{config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: rgbPin1 not found for shader application on drag start (from jstPin3)")}else if(r==="removeFromJstPin2AndApplyToLdrPin"&&(s==="jstPin2"||s==="jstPin2.pinGLTF1"||s==="jstPin2.pinGLTF2")){console.log("Shader Manager: Removing from jstPin2 (or child) and applying to ldrPin");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin2.pinGLTF1"||s==="jstPin2.pinGLTF2")){const u=this.getTargetObject(s);u&&(c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin2");u&&this.removeShaderFromObject(u)}const d=this.getTargetObject("ldrPin");if(d){const u=this.currentConfig||{config:{baseColor:2899536,glowColor:1752220,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: ldrPin not found for shader application on drag start")}else if(r==="removeFromJstPin2AndApplyToLdr"&&(s==="jstPin2"||s==="jstPin2.pinGLTF1"||s==="jstPin2.pinGLTF2")){console.log("Shader Manager: Removing from jstPin2 (or child) and applying to ldr model");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin2.pinGLTF1"||s==="jstPin2.pinGLTF2")){const u=this.getTargetObject(s);u&&(c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin2");u&&this.removeShaderFromObject(u)}const d=this.getTargetObject("ldrModel");if(d){const u=this.currentConfig||{config:{baseColor:2899536,glowColor:1752220,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: ldrModel not found for shader application on drag start")}else if(r==="removeFromBatteryWire2AndApplyToPowerPin"&&(s==="batteryWire2"||s==="batteryWire2.pinGLTF1"||s==="unknown")){console.log("Shader Manager: Battery wire dragged, removing shader from batteryWire2 and applying to powerPin");let c=this.removeShaderFromObject(e);if(!c&&s==="batteryWire2.pinGLTF1"){const u=this.getTargetObject("batteryWire2.pinGLTF1");u&&(console.log("Shader Manager: Attempting removal from batteryWire2.pinGLTF1"),c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("batteryWire2");u&&(console.log("Shader Manager: Fallback removal from batteryWire2"),this.removeShaderFromObject(u))}const d=this.getTargetObject("powerPin");if(d){const u=this.currentConfig||{config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: powerPin child not found for shader application on drag start")}else if(r==="removeFromJstPinAndApplyToRgbLed"&&(s==="jstPin"||s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){console.log("Shader Manager: Removing from jstPin (or child) and applying to rgbLed model");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){const u=this.getTargetObject(s);u&&(c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin");u&&this.removeShaderFromObject(u)}const d=this.getTargetObject("rgbLed");if(d){const u=this.currentConfig||{config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: rgbLED model not found for shader application on drag start")}else if(r==="removeFromJstPinAndApplyToTsopPin"&&(s==="jstPin"||s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){console.log("Shader Manager: Removing from jstPin (or child) and applying to tsopPin");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){const u=this.getTargetObject(s);u&&(c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin");u&&this.removeShaderFromObject(u)}const d=this.getTargetObject("tsopPin");if(d){const u=this.currentConfig||{config:{baseColor:2899536,glowColor:1752220,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: tsopPin not found for shader application on drag start")}else if(r==="removeFromJstPinAndApplyToExpansionBoardTsopPin"&&(s==="jstPin"||s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){console.log("Shader Manager: Removing from jstPin (or child) and applying to expansionBoard tsopPin");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){const u=this.getTargetObject(s);u&&(c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin");u&&this.removeShaderFromObject(u)}const d=this.getTargetObject("expansionBoardTsopPin");if(d){const u=this.currentConfig||{config:{baseColor:2899536,glowColor:1752220,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: expansionBoard tsopPin not found for shader application on drag start")}else if(r==="removeFromJstPinAndApplyToMotorDriverPowerPin"&&(s==="jstPin"||s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){console.log("Shader Manager: Removing from jstPin (or child) and applying to motorDriverPowerPin");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){const u=this.getTargetObject(s);u&&(c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin");u&&this.removeShaderFromObject(u)}const d=this.getTargetObject("motorDriverPowerPin");if(d){const u=this.currentConfig||{config:{baseColor:2899536,glowColor:15965202,blinkSpeed:2,glowIntensity:.9}};this.applyShaderToObject(d,u)}}else if(r==="applyToDragged"){console.log("Shader Manager: Applying shader to dragged object");const c=(l=this.currentConfig)==null?void 0:l.target;if(typeof c=="string"){const u=this.getTargetObject(c);u&&this.removeShaderFromObject(u)}const d=this.currentConfig||{config:{baseColor:2899536,glowColor:1752220,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(e,d),this.lastDraggedObject=e}else if(r==="removeFromJstPinAndApplyToMotorDriverPin"&&(s==="jstPin"||s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){console.log("Shader Manager: Removing from jstPin (or child) and applying to motorDriverPin");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){const u=this.getTargetObject(s);u&&(c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin");u&&this.removeShaderFromObject(u)}const d=this.getTargetObject("motorDriverPin");if(d){const u=this.currentConfig||{config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.9}};this.applyShaderToObject(d,u)}}else if(r==="removeFromJstPinAndApplyToMotorDriverInputPin"&&(s==="jstPin"||s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){console.log("Shader Manager: Removing from jstPin (or child) and applying to motorDriverInputPin");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){const u=this.getTargetObject(s);u&&(c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin");u&&this.removeShaderFromObject(u)}const d=this.getTargetObject("motorDriverInputPin");if(d){const u=this.currentConfig||{config:{baseColor:2899536,glowColor:1752220,blinkSpeed:2,glowIntensity:.9}};this.applyShaderToObject(d,u)}}else if(r==="removeFromJstPinAndApplyToPowerPin"&&(s==="jstPin"||s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){console.log("Shader Manager: Removing from jstPin (or child) and applying to powerPin");let c=this.removeShaderFromObject(e);if(!c&&(s==="jstPin.pinGLTF1"||s==="jstPin.pinGLTF2")){const u=this.getTargetObject(s);u&&(c=this.removeShaderFromObject(u)||c)}if(!c){const u=this.getTargetObject("jstPin");u&&this.removeShaderFromObject(u)}const d=this.getTargetObject("powerPin");if(d){const u=this.currentConfig||{config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.9}};this.applyShaderToObject(d,u)}}else{const c=r?r.replace("removeFrom",""):"",d=c.charAt(0).toLowerCase()+c.slice(1);if(console.log("Shader Manager: Action analysis:",{actionTargetName:c,normalizedActionTargetName:d,draggedObjectName:s,matches:s===d}),r&&s===d){console.log("Shader Manager: Condition passed, processing drag start action");const u=this.getTargetObject(d);u?(console.log("Shader Manager: Removing shader from",d,"object:",u),this.removeShaderFromObject(u)):console.warn("Shader Manager: Target object not found for",d)}else console.log("Shader Manager: No matching drag start action for",s),console.log("Shader Manager: Expected action for",s,"but got:",r)}}handleDragEnd(e){var a;console.log("Shader Manager: Drag end detected",{draggedObject:e,currentConfig:this.currentConfig,isActive:this.isActive,hasCurrentShader:!!this.currentShader});try{const l=this.getDropLabel();l.visible=!1}catch{}typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson1"&&window.orbitControls&&(window.orbitControls.enabled=!0,window.orbitControls.update(),console.log("OrbitControls re-enabled and camera lock released after drag end for lesson1 step",getCurrentStep()));const t=typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson1",o=typeof window.getCurrentStep=="function"?window.getCurrentStep():0;console.log("Shader Manager: Getting current config for lesson/step:",t,o);const i=SHADER_CONFIG[t];if(i&&i[o])this.currentConfig=i[o],console.log("Shader Manager: Updated current config:",this.currentConfig);else{console.warn("Shader Manager: No config found for",t,"step",o);return}const s=this.getObjectName(e),r=(a=this.currentConfig)==null?void 0:a.onDragEnd;if(console.log("Shader Manager: Drag end details",{draggedObjectName:s,onDragEndAction:r,currentConfig:this.currentConfig}),r==="none"){console.log("Shader Manager: No action needed on drag end for this step");return}if(r==="applyToRgbPin1"){const l=this.getTargetObject("rgbPin1");if(l){console.log("Shader Manager: Applying shader to rgbPin1 on drag end");const c=this.currentConfig||{config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(l,c)}else console.warn("Shader Manager: rgbPin1 not found for shader application on drag end");return}if(r==="applyToExpansionBoard"){const l=this.getTargetObject("expansionBoard");if(l){console.log("Shader Manager: Applying shader to expansion board on drag end");const c=this.currentConfig||{config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(l,c)}else console.warn("Shader Manager: Expansion board not found for shader application on drag end");return}if(r==="applyToRgbPin"){const l=this.getTargetObject("rgbPin");if(l){console.log("Shader Manager: Applying shader to rgbPin on drag end");const c=this.currentConfig||{config:{baseColor:2899536,glowColor:15158332,blinkSpeed:2.5,glowIntensity:.9}};this.applyShaderToObject(l,c)}else console.warn("Shader Manager: rgbPin not found for shader application on drag end");return}if(typeof r=="string"&&r.startsWith("applyTo")){const l=r.replace("applyTo",""),c=l.charAt(0).toLowerCase()+l.slice(1),d=this.getTargetObject(c);if(d){console.log("Shader Manager: Applying shader generically to",c,"on drag end");const u=this.currentConfig||{config:{baseColor:2899536,glowColor:3447003,blinkSpeed:2,glowIntensity:.8}};this.applyShaderToObject(d,u)}else console.warn("Shader Manager: Target not found for generic apply:",c);return}console.log("Shader Manager: No matching drag end action for",s)}handleSnap(e){var r;console.log("Shader Manager: Snap detected",{snapType:e,currentConfig:this.currentConfig,isActive:this.isActive});try{typeof window.enableOrbitControls=="function"?window.enableOrbitControls():window.orbitControls&&window.orbitControls&&getCurrentStep()!==0&&setTimeout(()=>{window.orbitControls.enabled=!0,window.orbitControls.update(),console.log("OrbitControls enabled after 1s delay in shaderManager snap")},1e3)}catch(a){console.warn("Error in snap handler:",a)}const t=typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson1",o=typeof window.getCurrentStep=="function"?window.getCurrentStep():0;console.log("Shader Manager: Getting current config for lesson/step:",t,o);const i=SHADER_CONFIG[t];if(i&&i[o])this.currentConfig=i[o],console.log("Shader Manager: Updated current config:",this.currentConfig);else{console.warn("Shader Manager: No config found for",t,"step",o);return}const s=(r=this.currentConfig)==null?void 0:r.onSnap;if(console.log("Shader Manager: Snap action:",s),s==="removeFromExpansionBoard"){const a=this.getTargetObject("expansionBoard");a?(console.log("Shader Manager: Removing shader from expansion board on snap"),this.removeShaderFromObject(a)):console.warn("Shader Manager: Expansion board not found for shader removal on snap");return}if(s==="removeFromExpansionBoardTsopPin"){const a=this.getTargetObject("expansionBoardTsopPin");a&&(console.log("Shader Manager: Removing shader from expansionBoard tsopPin on snap"),this.removeShaderFromObject(a));return}if(s==="removeFromTsopPin"){const a=this.getTargetObject("tsopPin");a?(console.log("Shader Manager: Removing shader from tsopPin on snap"),this.removeShaderFromObject(a)):console.warn("Shader Manager: tsopPin not found for shader removal on snap");return}if(s==="removeFromMotorDriverPin"){const a=this.getTargetObject("motorDriverPin");a?(console.log("Shader Manager: Removing shader from motorDriverPin on snap"),this.removeShaderFromObject(a)):console.warn("Shader Manager: motorDriverPin not found for shader removal on snap");return}if(s==="removeFromMotorDriverInputPin"){const a=this.getTargetObject("motorDriverInputPin");a?(console.log("Shader Manager: Removing shader from motorDriverInputPin on snap"),this.removeShaderFromObject(a)):console.warn("Shader Manager: motorDriverInputPin not found for shader removal on snap");return}if(s==="removeFromMotorDriverPowerPin"){const a=this.getTargetObject("motorDriverPowerPin");a?(console.log("Shader Manager: Removing shader from motorDriverPowerPin on snap"),this.removeShaderFromObject(a)):console.warn("Shader Manager: motorDriverPowerPin not found for shader removal on snap");return}if(s==="removeFromRgbPin1"){const a=this.getTargetObject("rgbPin1");a?(console.log("Shader Manager: Removing shader from rgbPin1 on snap"),this.removeShaderFromObject(a)):console.warn("Shader Manager: rgbPin1 not found for shader removal on snap");return}if(s==="removeFromRgbPin"){const a=this.getTargetObject("rgbPin");a?(console.log("Shader Manager: Removing shader from rgbPin on snap"),this.removeShaderFromObject(a)):console.warn("Shader Manager: rgbPin not found for shader removal on snap");return}if(s==="removeFromExpansionNano"){const a=this.getTargetObject("expansionNano");a?(console.log('Shader Manager: Removing shader from expansion board child "nano" on snap'),this.removeShaderFromObject(a)):console.warn('Shader Manager: expansion board child "nano" not found for shader removal on snap');return}if(s==="removeFromPowerPin"){const a=this.getTargetObject("powerPin");a?(console.log("Shader Manager: Removing shader from powerPin on snap"),this.removeShaderFromObject(a)):console.warn("Shader Manager: powerPin child not found for shader removal on snap");return}if(s==="removeFromMalePin"){const a=this.getTargetObject("malePin");a?(console.log("Shader Manager: Removing shader from malePin on snap"),this.removeShaderFromObject(a)):console.warn("Shader Manager: malePin not found for shader removal on snap");return}if(s==="removeFromBuzzer"){const a=this.getTargetObject("buzzerPin");a?(console.log("Shader Manager: Removing shader from buzzer on snap"),this.removeShaderFromObject(a)):console.warn("Shader Manager: buzzer not found for shader removal on snap");return}if(s==="removeFromLdrPin"){const a=this.getTargetObject("ldrPin");a?(console.log("Shader Manager: Removing shader from ldrPin on snap"),this.removeShaderFromObject(a)):console.warn("Shader Manager: ldrPin not found for shader removal on snap");return}if(s==="removeFromLdrPin001"){const a=this.getTargetObject("ldrModel");a?(console.log("Shader Manager: Removing shader from ldrModel and all children on snap"),this.removeShaderFromObjectAndChildren(a),this.currentShader=null,this.isActive=!1,this.currentConfig=null,this.lastDraggedObject=null):console.warn("Shader Manager: ldrModel not found for shader removal on snap");return}if(s==="removeFromRgbLed"){const a=this.getTargetObject("rgbLed");a?(console.log("Shader Manager: Removing shader from rgbLED model and all children on snap"),this.removeShaderFromObjectAndChildren(a),this.currentShader=null,this.isActive=!1,this.currentConfig=null,this.lastDraggedObject=null):console.warn("Shader Manager: rgbLED model not found for shader removal on snap");return}if(s==="removeFromDragged"){this.lastDraggedObject?(console.log("Shader Manager: Removing shader from last dragged object on snap"),this.removeShaderFromObject(this.lastDraggedObject)):console.warn("Shader Manager: No lastDraggedObject to remove shader from");return}if(typeof s=="string"&&s.startsWith("removeFrom")){const a=s.replace("removeFrom",""),l=a.charAt(0).toLowerCase()+a.slice(1),c=this.getTargetObject(l);c?(console.log("Shader Manager: Removing shader generically from",l,"on snap"),this.removeShaderFromObject(c)):console.warn("Shader Manager: Target not found for generic remove:",l);return}console.log("Shader Manager: No matching snap action for",e)}getObjectName(e){var o,i,s,r,a,l,c,d,u,f,h,m,p,v,g,y;if(console.log("Shader Manager: getObjectName called with object:",e),e===((o=window.jstPin)==null?void 0:o.group))return console.log("Shader Manager: Identified as jstPin"),"jstPin";if(e===((i=window.jstPin)==null?void 0:i.pinGLTF1))return console.log("Shader Manager: Identified as jstPin.pinGLTF1"),"jstPin.pinGLTF1";if(e===((s=window.jstPin)==null?void 0:s.pinGLTF2))return console.log("Shader Manager: Identified as jstPin.pinGLTF2"),"jstPin.pinGLTF2";if(e===((r=window.jstPin2)==null?void 0:r.group))return console.log("Shader Manager: Identified as jstPin2"),"jstPin2";if(e===((a=window.jstPin2)==null?void 0:a.pinGLTF1))return console.log("Shader Manager: Identified as jstPin2.pinGLTF1"),"jstPin2.pinGLTF1";if(e===((l=window.jstPin2)==null?void 0:l.pinGLTF2))return console.log("Shader Manager: Identified as jstPin2.pinGLTF2"),"jstPin2.pinGLTF2";if(e===((c=window.jstPin3)==null?void 0:c.group))return console.log("Shader Manager: Identified as jstPin3"),"jstPin3";if(e===((d=window.jstPin3)==null?void 0:d.pinGLTF1))return console.log("Shader Manager: Identified as jstPin3.pinGLTF1"),"jstPin3.pinGLTF1";if(e===((u=window.jstPin3)==null?void 0:u.pinGLTF2))return console.log("Shader Manager: Identified as jstPin3.pinGLTF2"),"jstPin3.pinGLTF2";if(e===window.nanoModel)return console.log("Shader Manager: Identified as nanoModel"),"nanoModel";if(e===window.tempSensorModel)return console.log("Shader Manager: Identified as tempSensorModel"),"tempSensorModel";if(e===window.expansionBoardModel)return console.log("Shader Manager: Identified as expansionBoard"),"expansionBoard";if(e===window.rgbLEDModel)return console.log("Shader Manager: Identified as rgbLED"),"rgbLED";if(e===window.rgbLedModel)return console.log("Shader Manager: Identified as rgbLed"),"rgbLed";if(e===window.buzzerModel)return console.log("Shader Manager: Identified as buzzerModel"),"buzzerModel";if(e===((f=window.jstPinBattery)==null?void 0:f.pinGLTF1))return console.log("Shader Manager: Identified as jstPinBattery.pinGLTF1"),"jstPinBattery.pinGLTF1";if(e===window.batteryWire2)return console.log("Shader Manager: Identified as batteryWire2"),"batteryWire2";if(e===((h=window.batteryWire2)==null?void 0:h.pinGLTF1))return console.log("Shader Manager: Identified as batteryWire2.pinGLTF1"),"batteryWire2.pinGLTF1";let t=e;for(;t&&t.parent;){if(t===((m=window.jstPin)==null?void 0:m.pinGLTF1))return console.log("Shader Manager: Identified via ancestor as jstPin.pinGLTF1"),"jstPin.pinGLTF1";if(t===((p=window.jstPin)==null?void 0:p.pinGLTF2))return console.log("Shader Manager: Identified via ancestor as jstPin.pinGLTF2"),"jstPin.pinGLTF2";if(t===((v=window.jstPin)==null?void 0:v.group))return console.log("Shader Manager: Identified via ancestor as jstPin"),"jstPin";if(t===((g=window.jstPinBattery)==null?void 0:g.pinGLTF1))return console.log("Shader Manager: Identified via ancestor as jstPinBattery.pinGLTF1"),"jstPinBattery.pinGLTF1";if(t===window.buzzerModel)return console.log("Shader Manager: Identified via ancestor as buzzerModel"),"buzzerModel";if(t===window.rgbLedModel)return console.log("Shader Manager: Identified via ancestor as rgbLed"),"rgbLed";if(t===window.batteryWire2)return console.log("Shader Manager: Identified via ancestor as batteryWire2"),"batteryWire2";if(t===((y=window.batteryWire2)==null?void 0:y.pinGLTF1))return console.log("Shader Manager: Identified via ancestor as batteryWire2.pinGLTF1"),"batteryWire2.pinGLTF1";t=t.parent}return window.jstPin&&(e===window.jstPin.pinGLTF1||e===window.jstPin.pinGLTF2)?(console.log("Shader Manager: Identified as jstPin child"),"jstPin"):window.jstPin2&&(e===window.jstPin2.pinGLTF1||e===window.jstPin2.pinGLTF2)?(console.log("Shader Manager: Identified as jstPin2 child"),"jstPin2"):window.jstPin3&&(e===window.jstPin3.pinGLTF1||e===window.jstPin3.pinGLTF2)?(console.log("Shader Manager: Identified as jstPin3 child"),"jstPin3"):(console.log("Shader Manager: Object not identified, returning unknown"),"unknown")}cleanup(){this.isActive&&this.originalMaterials.forEach((e,t)=>{this.removeShaderFromObject(t)}),this.originalMaterials.clear(),this.materialMeshes.clear(),this.isActive=!1,this.currentShader=null,this.currentConfig=null,this.lastDraggedObject=null;try{this._dragLabel&&(this._dragLabel.visible=!1)}catch{}try{this._dropLabel&&(this._dropLabel.visible=!1)}catch{}}setBaseColor(e){this.currentShader&&this.currentShader.uniforms.baseColor.value.set(e)}setGlowColor(e){this.currentShader&&this.currentShader.uniforms.glowColor.value.set(e)}setBlinkSpeed(e){this.currentShader&&(this.currentShader.uniforms.blinkSpeed.value=e)}setGlowIntensity(e){this.currentShader&&(this.currentShader.uniforms.glowIntensity.value=e)}}let shaderManagerInstance=null;function getShaderManager$1(){return shaderManagerInstance||(shaderManagerInstance=new ShaderManager),shaderManagerInstance}function applyStepShader(n,e){getShaderManager$1().handleStepShader(n,e)}function handleDragStart(n){getShaderManager$1().handleDragStart(n)}function handleDragEnd(n){getShaderManager$1().handleDragEnd(n)}function handleSnap(n){getShaderManager$1().handleSnap(n)}function updateShader(n){getShaderManager$1().update(n)}function cleanupShader(){getShaderManager$1().cleanup()}const snapIfClose=getSnapHandler();class RaycasterSetup1{constructor(e,t,o,i){return RaycasterSetup1.instance||(this.scene=e,this.camera=t,this.controls=o,this.mouseCoord=new Vector2$1,this.raycaster=new Raycaster,this.raycaster.near=0,this.raycaster.far=1/0,this.isDragging=!1,this.draggedComponent=null,this.draggedPinModel=null,this.lastPosition=null,this.mouseDownPosition=null,this.referencePlaneGeometry=new PlaneGeometry(10,10,64,64),this.referencePlaneGeometry.rotateX(-Math.PI*.5),this.referencePlaneMaterial=new MeshBasicMaterial({color:"red",transparent:!0,visible:!1,opacity:.5}),this.referencePlane=new Mesh(this.referencePlaneGeometry,this.referencePlaneMaterial),this.referencePlane.position.y=1.8,this.scene.add(this.referencePlane),this.pinModelsRef=JstXhFemalePin$2.getAllModels(),this.nanoModel=window.nanoModel||null,this.onSnap=i,window.addEventListener("mousedown",s=>this.onMouseDown(s)),window.addEventListener("mousemove",s=>this.onMouseMove(s)),window.addEventListener("mouseup",s=>this.onMouseUp(s)),RaycasterSetup1.instance=this),RaycasterSetup1.instance}refreshPinModelsRef(){this.pinModelsRef=JstXhFemalePin$2.getAllModels(),console.log("[RaycasterSetup1] Refreshed pin models reference:",this.pinModelsRef)}update(e){}updateReferencePlane(){const e=new Vector3$1;this.camera.getWorldDirection(e),this.referencePlane.lookAt(this.camera.position.clone().add(e)),this.draggedPinModel?this.referencePlane.position.copy(this.draggedPinModel.position):this.referencePlane.position.set(0,0,0)}onMouseDown(e){this.mouseCoord.x=e.clientX/window.innerWidth*2-1,this.mouseCoord.y=-(e.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(this.mouseCoord,this.camera);const t=this.pinModelsRef.flatMap(i=>i.models);window.nanoModel&&t.push(window.nanoModel),window.jstPinBatterySide1&&t.push(window.jstPinBatterySide1);const o=this.raycaster.intersectObjects(t,!0);if(o.length>0){this.isDragging=!0;let s=o[0].object;for(;s.parent&&!t.includes(s);)s=s.parent;const r=this.pinModelsRef.find(a=>a.models.includes(s));r?(this.draggedComponent=r.instance,this.draggedPinModel=s,this.lastPosition=s.position.clone(),this.controls&&(this.controls.enabled=!1),handleDragStart(this.draggedPinModel)):window.jstPinBatterySide1&&s===window.jstPinBatterySide1?(this.draggedComponent=null,this.draggedPinModel=window.jstPinBatterySide1,this.lastPosition=window.jstPinBatterySide1.position.clone(),this.controls&&(this.controls.enabled=!1),handleDragStart(this.draggedPinModel)):window.nanoModel&&s===window.nanoModel?(this.draggedComponent=null,this.draggedPinModel=window.nanoModel,this.lastPosition=window.nanoModel.position.clone(),this.controls&&(this.controls.enabled=!1),handleDragStart(this.draggedPinModel)):window.rgbLEDModel&&s===window.rgbLEDModel?(this.draggedComponent=null,this.draggedPinModel=window.rgbLEDModel,this.lastPosition=window.rgbLEDModel.position.clone(),this.controls&&(this.controls.enabled=!1),handleDragStart(this.draggedPinModel)):window.tempSensorModel&&s===window.tempSensorModel&&(this.draggedComponent=null,this.draggedPinModel=window.tempSensorModel,this.lastPosition=window.tempSensorModel.position.clone(),this.controls&&(this.controls.enabled=!1),handleDragStart(this.draggedPinModel))}}onMouseMove(e){if(this.mouseCoord.x=e.clientX/window.innerWidth*2-1,this.mouseCoord.y=-(e.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(this.mouseCoord,this.camera),this.isDragging&&this.draggedPinModel){if(snapIfClose(this.draggedPinModel)){if(this.draggedComponent&&this.draggedComponent.updatePosition?this.draggedComponent.updatePosition(this.draggedPinModel.position,this.draggedPinModel):this.draggedPinModel.position.copy(this.draggedPinModel.position),window.setForwardArrowEnabled&&typeof window.getCurrentStep=="function"&&window.getCurrentStep()===0&&window.setForwardArrowEnabled(!0),window.setForwardArrowEnabled&&window.jstPinBatterySide1&&this.draggedPinModel===window.jstPinBatterySide1&&window.setForwardArrowEnabled(!0),window.setForwardArrowEnabled&&typeof window.getCurrentStep=="function"&&window.nanoModel&&this.draggedPinModel===window.nanoModel&&window.getCurrentStep()===2&&window.setForwardArrowEnabled(!0),window.setForwardArrowEnabled&&typeof window.getCurrentStep=="function"&&window.nanoModel&&this.draggedPinModel===window.nanoModel&&typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson2"&&window.getCurrentStep()===3&&window.setForwardArrowEnabled(!0),window.setForwardArrowEnabled&&typeof window.getCurrentStep=="function"&&window.nanoModel&&this.draggedPinModel===window.nanoModel&&typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson3"&&window.getCurrentStep()===3&&window.setForwardArrowEnabled(!0),window.setForwardArrowEnabled&&window.jstPin2Side1&&this.draggedPinModel===window.jstPin2Side1&&window.setForwardArrowEnabled(!0),window.setForwardArrowEnabled&&window.jstPin2Side2&&this.draggedPinModel===window.jstPin2Side2&&window.setForwardArrowEnabled(!0),window.setForwardArrowEnabled&&window.tempSensorModel&&this.draggedPinModel===window.tempSensorModel&&typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson3"&&window.getCurrentStep()===1&&window.setForwardArrowEnabled(!0),window.setForwardArrowEnabled&&window.jstPin3Side1&&this.draggedPinModel===window.jstPin3Side1&&typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson3"&&window.getCurrentStep()===2&&window.setForwardArrowEnabled(!0),window.setForwardArrowEnabled&&window.jstPin3Side2&&this.draggedPinModel===window.jstPin3Side2&&typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson3"&&window.getCurrentStep()===2&&window.setForwardArrowEnabled(!0),window.setForwardArrowEnabled&&window.rgbLEDModel&&this.draggedPinModel===window.rgbLEDModel&&typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson3"&&window.getCurrentStep()===4&&(window.setForwardArrowEnabled(!0),console.log("[Lesson3] Enabled Next button after LED expansion board connection (step 4)")),window.setForwardArrowEnabled&&window.rgbLEDModel&&this.draggedPinModel===window.rgbLEDModel&&typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson3"&&window.getCurrentStep()===5&&(window.setForwardArrowEnabled(!0),console.log("[Lesson3] Enabled Next button after LED module connection (step 5)")),this.onSnap&&(window.secondPin4Female&&this.draggedPinModel===window.secondPin4Female&&(this.onSnap("secondPin4Female"),handleSnap("secondPin4Female")),window.jstPinBatterySide1&&this.draggedPinModel===window.jstPinBatterySide1&&(this.onSnap("jstPinBattery"),handleSnap("jstPinBattery")),window.nanoModel&&this.draggedPinModel===window.nanoModel&&typeof window.getCurrentLesson=="function"&&(window.getCurrentLesson()==="lesson1"||window.getCurrentLesson()==="lesson2"||window.getCurrentLesson()==="lesson3")&&(this.onSnap("nanoModel"),handleSnap("nanoModel")),window.jstPin2Side1&&this.draggedPinModel===window.jstPin2Side1&&(this.onSnap("jstPin2Side1"),handleSnap("jstPin2Side1")),window.jstPin2Side2&&this.draggedPinModel===window.jstPin2Side2&&(this.onSnap("jstPin2Side2"),handleSnap("jstPin2Side2")),window.tempSensorModel&&this.draggedPinModel===window.tempSensorModel&&(this.onSnap("tempSensorModel"),handleSnap("tempSensorModel")),window.jstPin3Side1&&this.draggedPinModel===window.jstPin3Side1&&(this.onSnap("jstPin3Side1"),handleSnap("jstPin3Side1")),window.jstPin3Side2&&this.draggedPinModel===window.jstPin3Side2&&(this.onSnap("jstPin3Side2"),handleSnap("jstPin3Side2")),window.rgbLEDModel&&this.draggedPinModel===window.rgbLEDModel&&typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson3")){const o=typeof window.getCurrentStep=="function"?window.getCurrentStep():0;o===4?(this.onSnap("ledExpansionBoard"),handleSnap("ledExpansionBoard")):o===5&&(this.onSnap("ledModule"),handleSnap("ledModule"))}return}const t=this.raycaster.intersectObject(this.referencePlane);if(t.length>0){const o=t[0].point;this.lastPosition&&o.clone().sub(this.lastPosition).normalize(),this.draggedComponent&&this.draggedComponent.updatePosition?this.draggedComponent.updatePosition(o,this.draggedPinModel):this.draggedPinModel.position.copy(o),this.lastPosition=o.clone()}}}onMouseUp(e){this.isDragging=!1,this.controls&&(this.controls.enabled=!0),this.draggedPinModel&&handleDragEnd(this.draggedPinModel);try{const t=getShaderManager&&getShaderManager();if(t&&t.getDropLabel){const o=t.getDropLabel();o.visible=!1}}catch{}this.draggedComponent=null,this.draggedPinModel=null,this.lastPosition=null;for(const t of this.pinModelsRef)t.instance&&(t.instance.wasAutoMoved=!1)}}let RaycasterSetup2$1=class Ne{constructor(e,t,o,i){return Ne.instance||(this.scene=e,this.camera=t,this.stepCounterCallback=o,this.adjustLedBrightness=i,this.mouseCoord=new Vector2$1,this.raycaster=new Raycaster,this.raycaster.near=0,this.raycaster.far=1/0,this.draggedPinModel=null,this.lastPosition=null,this.pinModelsRef=JstXhFemalePin$1.getAllModels(),console.log("pinModelsRef initialized:",this.pinModelsRef),this.kpLessons=!0,this.interactiveObjects=[],this.isDragging=!1,this.draggedComponent=null,this.originalPosition=null,this.referencePlaneGeometry=new PlaneGeometry(10,10,8,8),this.referencePlaneGeometry.rotateX(-Math.PI*.5),this.referencePlaneMaterial=new MeshBasicMaterial({color:"red",transparent:!0,side:DoubleSide,visible:!1,opacity:.5}),this.referencePlane=new Mesh(this.referencePlaneGeometry,this.referencePlaneMaterial),this.referencePlane.position.set(0,2,0),this.scene.add(this.referencePlane),window.addEventListener("mousedown",s=>this.onMouseDown(s)),window.addEventListener("mousemove",s=>this.onMouseMove(s)),window.addEventListener("mouseup",s=>this.onMouseUp(s)),Ne.instance=this),Ne.instance}refreshPinModelsRef(){this.pinModelsRef=JstXhFemalePin$1.getAllModels(),console.log("Refreshed pinModelsRef:",this.pinModelsRef)}onMouseDown(e){this.mouseCoord.x=e.clientX/window.innerWidth*2-1,this.mouseCoord.y=-(e.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(this.mouseCoord,this.camera);const t=this.pinModelsRef.flatMap(s=>s.models.filter(r=>r.draggable).map(r=>r.model));console.log("All draggable models:",t);const o=this.raycaster.intersectObjects(t,!0);if(console.log("JST intersects:",o),o.length>0){let r=o[0].object;for(;r.parent&&!t.includes(r);)r=r.parent;console.log("Parent group (pin model):",r);const a=this.pinModelsRef.find(l=>l.models.some(c=>c.model===r&&c.draggable));a?(this.isDragging=!0,this.draggedComponent=a.instance,this.draggedPinModel=r,this.originalPosition=r.position.clone(),this.lastPosition=r.position.clone(),console.log("Dragging JST pin:",r,"Instance:",a.instance)):console.warn("No component data found for intersected JST pin model:",r);return}const i=this.raycaster.intersectObjects(this.interactiveObjects,!0);if(i.length>0){let r=i[0].object;for(;r.parent&&!this.interactiveObjects.includes(r);)r=r.parent;this.interactiveObjects.includes(r)&&(this.isDragging=!0,this.draggedComponent=r,this.originalPosition=r.position.clone(),this.draggedPinModel=null,console.log("Dragging interactive object:",r.name||"Unnamed"))}}onMouseMove(e){if(!this.isDragging||!this.draggedComponent)return;this.mouseCoord.x=e.clientX/window.innerWidth*2-1,this.mouseCoord.y=-(e.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(this.mouseCoord,this.camera);const t=this.raycaster.intersectObject(this.referencePlane);if(t.length>0){const o=t[0].point;if(this.draggedComponent instanceof JstXhFemalePin$1){if(!this.draggedPinModel){console.warn("onMouseMove: Dragging aborted - missing draggedPinModel for JST pin");return}const i=this.draggedPinModel.parent;if(!i){console.error("draggedPinModel has no parent:",this.draggedPinModel),this.isDragging=!1;return}const s=i.worldToLocal(o.clone());this.draggedPinModel.position.copy(s),this.draggedComponent.updatePosition(s,this.draggedPinModel)}else if(this.draggedComponent.name==="ldrTestingCube"){this.referencePlane.rotation.x=Math.PI*.5,this.referencePlane.position.set(0,0,-3.3);const i=this.draggedComponent.parent;if(!i){console.error("draggedComponent has no parent:",this.draggedComponent),this.isDragging=!1;return}i.position;let s=Math.max(2,Math.min(2.4,t[0].point.y));this.draggedComponent.position.set(this.draggedComponent.position.x,s,-3.3),this.stepCounterCallback()===6&&this.adjustLedBrightness(s)}else{const i=this.draggedComponent.parent;if(!i){console.error("draggedComponent has no parent:",this.draggedComponent),this.isDragging=!1;return}const s=i.worldToLocal(o.clone());this.draggedComponent.position.copy(s)}}}onMouseUp(e){this.isDragging&&this.draggedComponent,this.isDragging=!1,this.draggedComponent=null,this.originalPosition=null,this.draggedPinModel=null,this.lastPosition=null}snapObject(e,t,o,i,s){gsapWithCSS.to(e.position,{x:t.x,y:t.y-.01,z:t.z,duration:.5,ease:"power2.out",onUpdate:()=>{o instanceof JstXhFemalePin$1&&i&&o.updatePosition(e.position,i)},onComplete:()=>{if(o instanceof JstXhFemalePin$1&&i){o.updatePosition(t,i);const a=this.pinModelsRef.findIndex(l=>l.models.some(c=>c.model===i));if(a!==-1){const c=this.pinModelsRef[a].models.find(d=>d.model===i);c&&(c.draggable=!1,console.log(`Set ${c.pinType} draggability to false`)),console.log("Updated pinModelsRef:",this.pinModelsRef)}else console.warn("Pin model not found in pinModelsRef:",i)}const r=this.interactiveObjects.indexOf(e);r!==-1&&(this.interactiveObjects.splice(r,1),console.log("Removed object from interactiveObjects:",e)),s&&s()}})}addInteractiveObjects(...e){this.interactiveObjects.push(...e)}static getInstance(){return Ne.instance}};const pages=["Roboto-Regular.png"],chars=JSON.parse(`[{"id":40,"index":12,"char":"(","width":15,"height":47,"xoffset":1,"yoffset":0,"xadvance":14,"chnl":15,"x":0,"y":0,"page":0},{"id":41,"index":13,"char":")","width":15,"height":47,"xoffset":-1,"yoffset":0,"xadvance":15,"chnl":15,"x":0,"y":48,"page":0},{"id":91,"index":63,"char":"[","width":12,"height":45,"xoffset":1,"yoffset":0,"xadvance":11,"chnl":15,"x":0,"y":96,"page":0},{"id":93,"index":65,"char":"]","width":12,"height":45,"xoffset":-2,"yoffset":0,"xadvance":11,"chnl":15,"x":0,"y":142,"page":0},{"id":123,"index":95,"char":"{","width":16,"height":44,"xoffset":-1,"yoffset":1,"xadvance":14,"chnl":15,"x":0,"y":188,"page":0},{"id":125,"index":97,"char":"}","width":16,"height":44,"xoffset":-2,"yoffset":1,"xadvance":14,"chnl":15,"x":13,"y":96,"page":0},{"id":1092,"index":247,"char":"","width":30,"height":44,"xoffset":0,"yoffset":3,"xadvance":30,"chnl":15,"x":13,"y":141,"page":0},{"id":197,"index":644,"char":"","width":30,"height":44,"xoffset":-1,"yoffset":-6,"xadvance":27,"chnl":15,"x":16,"y":0,"page":0},{"id":106,"index":78,"char":"j","width":12,"height":43,"xoffset":-3,"yoffset":4,"xadvance":10,"chnl":15,"x":16,"y":45,"page":0},{"id":36,"index":8,"char":"$","width":23,"height":43,"xoffset":0,"yoffset":-1,"xadvance":24,"chnl":15,"x":29,"y":45,"page":0},{"id":64,"index":36,"char":"@","width":37,"height":43,"xoffset":0,"yoffset":5,"xadvance":38,"chnl":15,"x":47,"y":0,"page":0},{"id":198,"index":129,"char":"","width":43,"height":34,"xoffset":-2,"yoffset":4,"xadvance":39,"chnl":15,"x":30,"y":89,"page":0},{"id":958,"index":197,"char":"","width":21,"height":42,"xoffset":0,"yoffset":4,"xadvance":21,"chnl":15,"x":53,"y":44,"page":0},{"id":950,"index":192,"char":"","width":22,"height":42,"xoffset":0,"yoffset":4,"xadvance":22,"chnl":15,"x":0,"y":233,"page":0},{"id":946,"index":188,"char":"","width":23,"height":42,"xoffset":1,"yoffset":4,"xadvance":25,"chnl":15,"x":17,"y":186,"page":0},{"id":1044,"index":217,"char":"","width":33,"height":41,"xoffset":-1,"yoffset":4,"xadvance":32,"chnl":15,"x":0,"y":276,"page":0},{"id":1025,"index":941,"char":"","width":23,"height":41,"xoffset":1,"yoffset":-3,"xadvance":24,"chnl":15,"x":23,"y":229,"page":0},{"id":1046,"index":218,"char":"","width":41,"height":34,"xoffset":-1,"yoffset":4,"xadvance":38,"chnl":15,"x":41,"y":186,"page":0},{"id":1049,"index":954,"char":"","width":27,"height":41,"xoffset":2,"yoffset":-3,"xadvance":30,"chnl":15,"x":44,"y":124,"page":0},{"id":1062,"index":224,"char":"","width":30,"height":41,"xoffset":2,"yoffset":4,"xadvance":31,"chnl":15,"x":72,"y":124,"page":0},{"id":1065,"index":227,"char":"","width":39,"height":41,"xoffset":2,"yoffset":4,"xadvance":41,"chnl":15,"x":75,"y":44,"page":0},{"id":220,"index":664,"char":"","width":26,"height":41,"xoffset":1,"yoffset":-3,"xadvance":27,"chnl":15,"x":85,"y":0,"page":0},{"id":214,"index":660,"char":"","width":28,"height":41,"xoffset":0,"yoffset":-3,"xadvance":29,"chnl":15,"x":112,"y":0,"page":0},{"id":196,"index":643,"char":"","width":30,"height":41,"xoffset":-1,"yoffset":-3,"xadvance":27,"chnl":15,"x":0,"y":318,"page":0},{"id":209,"index":655,"char":"","width":27,"height":41,"xoffset":1,"yoffset":-3,"xadvance":30,"chnl":15,"x":0,"y":360,"page":0},{"id":81,"index":53,"char":"Q","width":28,"height":39,"xoffset":0,"yoffset":4,"xadvance":29,"chnl":15,"x":0,"y":402,"page":0},{"id":87,"index":59,"char":"W","width":39,"height":34,"xoffset":-1,"yoffset":4,"xadvance":37,"chnl":15,"x":74,"y":87,"page":0},{"id":124,"index":96,"char":"|","width":7,"height":39,"xoffset":2,"yoffset":4,"xadvance":10,"chnl":15,"x":28,"y":360,"page":0},{"id":229,"index":671,"char":"","width":22,"height":38,"xoffset":0,"yoffset":1,"xadvance":23,"chnl":15,"x":31,"y":318,"page":0},{"id":216,"index":131,"char":"","width":28,"height":37,"xoffset":0,"yoffset":3,"xadvance":29,"chnl":15,"x":34,"y":271,"page":0},{"id":100,"index":72,"char":"d","width":23,"height":36,"xoffset":0,"yoffset":3,"xadvance":24,"chnl":15,"x":47,"y":221,"page":0},{"id":102,"index":74,"char":"f","width":17,"height":36,"xoffset":-1,"yoffset":2,"xadvance":15,"chnl":15,"x":0,"y":442,"page":0},{"id":104,"index":76,"char":"h","width":21,"height":36,"xoffset":1,"yoffset":3,"xadvance":23,"chnl":15,"x":18,"y":442,"page":0},{"id":107,"index":79,"char":"k","width":22,"height":36,"xoffset":1,"yoffset":3,"xadvance":21,"chnl":15,"x":29,"y":400,"page":0},{"id":108,"index":80,"char":"l","width":8,"height":36,"xoffset":1,"yoffset":3,"xadvance":10,"chnl":15,"x":36,"y":357,"page":0},{"id":98,"index":70,"char":"b","width":23,"height":36,"xoffset":1,"yoffset":3,"xadvance":24,"chnl":15,"x":45,"y":357,"page":0},{"id":47,"index":19,"char":"/","width":20,"height":36,"xoffset":-2,"yoffset":4,"xadvance":17,"chnl":15,"x":54,"y":309,"page":0},{"id":92,"index":64,"char":"\\\\","width":20,"height":36,"xoffset":-1,"yoffset":4,"xadvance":17,"chnl":15,"x":63,"y":258,"page":0},{"id":1073,"index":234,"char":"","width":24,"height":36,"xoffset":0,"yoffset":2,"xadvance":23,"chnl":15,"x":71,"y":221,"page":0},{"id":1060,"index":223,"char":"","width":33,"height":36,"xoffset":0,"yoffset":3,"xadvance":32,"chnl":15,"x":83,"y":166,"page":0},{"id":1064,"index":226,"char":"","width":36,"height":34,"xoffset":2,"yoffset":4,"xadvance":40,"chnl":15,"x":103,"y":122,"page":0},{"id":1070,"index":232,"char":"","width":36,"height":35,"xoffset":2,"yoffset":4,"xadvance":38,"chnl":15,"x":114,"y":86,"page":0},{"id":948,"index":190,"char":"","width":24,"height":36,"xoffset":0,"yoffset":2,"xadvance":24,"chnl":15,"x":115,"y":42,"page":0},{"id":966,"index":204,"char":"","width":30,"height":36,"xoffset":0,"yoffset":12,"xadvance":30,"chnl":15,"x":140,"y":42,"page":0},{"id":968,"index":205,"char":"","width":30,"height":36,"xoffset":0,"yoffset":12,"xadvance":29,"chnl":15,"x":141,"y":0,"page":0},{"id":230,"index":134,"char":"","width":36,"height":27,"xoffset":0,"yoffset":11,"xadvance":35,"chnl":15,"x":0,"y":479,"page":0},{"id":121,"index":93,"char":"y","width":23,"height":35,"xoffset":-2,"yoffset":12,"xadvance":20,"chnl":15,"x":40,"y":437,"page":0},{"id":112,"index":84,"char":"p","width":23,"height":35,"xoffset":1,"yoffset":11,"xadvance":24,"chnl":15,"x":40,"y":473,"page":0},{"id":113,"index":85,"char":"q","width":23,"height":35,"xoffset":0,"yoffset":11,"xadvance":24,"chnl":15,"x":52,"y":394,"page":0},{"id":103,"index":75,"char":"g","width":23,"height":35,"xoffset":0,"yoffset":11,"xadvance":24,"chnl":15,"x":69,"y":346,"page":0},{"id":109,"index":81,"char":"m","width":35,"height":27,"xoffset":1,"yoffset":11,"xadvance":37,"chnl":15,"x":75,"y":295,"page":0},{"id":79,"index":51,"char":"O","width":28,"height":35,"xoffset":0,"yoffset":4,"xadvance":29,"chnl":15,"x":84,"y":258,"page":0},{"id":83,"index":55,"char":"S","width":26,"height":35,"xoffset":0,"yoffset":4,"xadvance":25,"chnl":15,"x":96,"y":203,"page":0},{"id":71,"index":43,"char":"G","width":27,"height":35,"xoffset":1,"yoffset":4,"xadvance":29,"chnl":15,"x":117,"y":157,"page":0},{"id":67,"index":39,"char":"C","width":27,"height":35,"xoffset":0,"yoffset":4,"xadvance":27,"chnl":15,"x":64,"y":430,"page":0},{"id":56,"index":28,"char":"8","width":23,"height":35,"xoffset":0,"yoffset":4,"xadvance":24,"chnl":15,"x":64,"y":466,"page":0},{"id":51,"index":23,"char":"3","width":23,"height":35,"xoffset":0,"yoffset":4,"xadvance":24,"chnl":15,"x":88,"y":466,"page":0},{"id":48,"index":20,"char":"0","width":23,"height":35,"xoffset":0,"yoffset":4,"xadvance":24,"chnl":15,"x":76,"y":382,"page":0},{"id":37,"index":9,"char":"%","width":31,"height":35,"xoffset":0,"yoffset":4,"xadvance":31,"chnl":15,"x":92,"y":418,"page":0},{"id":8364,"index":413,"char":"","width":24,"height":35,"xoffset":0,"yoffset":4,"xadvance":24,"chnl":15,"x":93,"y":323,"page":0},{"id":38,"index":10,"char":"&","width":28,"height":35,"xoffset":0,"yoffset":4,"xadvance":26,"chnl":15,"x":112,"y":454,"page":0},{"id":1105,"index":971,"char":"","width":23,"height":35,"xoffset":0,"yoffset":4,"xadvance":22,"chnl":15,"x":100,"y":359,"page":0},{"id":1078,"index":238,"char":"","width":35,"height":26,"xoffset":-2,"yoffset":12,"xadvance":32,"chnl":15,"x":111,"y":294,"page":0},{"id":1047,"index":219,"char":"","width":26,"height":35,"xoffset":0,"yoffset":4,"xadvance":25,"chnl":15,"x":118,"y":321,"page":0},{"id":1054,"index":957,"char":"","width":28,"height":35,"xoffset":0,"yoffset":4,"xadvance":29,"chnl":15,"x":113,"y":239,"page":0},{"id":1088,"index":967,"char":"","width":23,"height":35,"xoffset":1,"yoffset":11,"xadvance":24,"chnl":15,"x":123,"y":193,"page":0},{"id":1057,"index":960,"char":"","width":27,"height":35,"xoffset":0,"yoffset":4,"xadvance":27,"chnl":15,"x":142,"y":229,"page":0},{"id":1091,"index":969,"char":"","width":23,"height":35,"xoffset":-2,"yoffset":12,"xadvance":20,"chnl":15,"x":145,"y":122,"page":0},{"id":1097,"index":251,"char":"","width":35,"height":33,"xoffset":1,"yoffset":12,"xadvance":35,"chnl":15,"x":145,"y":158,"page":0},{"id":1069,"index":231,"char":"","width":27,"height":35,"xoffset":1,"yoffset":4,"xadvance":28,"chnl":15,"x":147,"y":192,"page":0},{"id":252,"index":691,"char":"","width":21,"height":35,"xoffset":1,"yoffset":4,"xadvance":23,"chnl":15,"x":151,"y":79,"page":0},{"id":246,"index":687,"char":"","width":24,"height":35,"xoffset":0,"yoffset":4,"xadvance":24,"chnl":15,"x":171,"y":37,"page":0},{"id":228,"index":670,"char":"","width":22,"height":35,"xoffset":0,"yoffset":4,"xadvance":23,"chnl":15,"x":172,"y":0,"page":0},{"id":241,"index":682,"char":"","width":21,"height":35,"xoffset":1,"yoffset":3,"xadvance":23,"chnl":15,"x":195,"y":0,"page":0},{"id":961,"index":199,"char":"","width":23,"height":35,"xoffset":1,"yoffset":11,"xadvance":24,"chnl":15,"x":169,"y":115,"page":0},{"id":952,"index":194,"char":"","width":23,"height":35,"xoffset":1,"yoffset":4,"xadvance":24,"chnl":15,"x":173,"y":73,"page":0},{"id":947,"index":189,"char":"","width":23,"height":35,"xoffset":-1,"yoffset":12,"xadvance":21,"chnl":15,"x":196,"y":36,"page":0},{"id":951,"index":193,"char":"","width":22,"height":35,"xoffset":1,"yoffset":11,"xadvance":24,"chnl":15,"x":217,"y":0,"page":0},{"id":955,"index":196,"char":"","width":25,"height":35,"xoffset":-1,"yoffset":3,"xadvance":23,"chnl":15,"x":124,"y":357,"page":0},{"id":967,"index":935,"char":"","width":26,"height":35,"xoffset":0,"yoffset":12,"xadvance":21,"chnl":15,"x":145,"y":321,"page":0},{"id":956,"index":933,"char":"","width":21,"height":35,"xoffset":1,"yoffset":12,"xadvance":24,"chnl":15,"x":147,"y":265,"page":0},{"id":920,"index":179,"char":"","width":28,"height":35,"xoffset":0,"yoffset":4,"xadvance":29,"chnl":15,"x":169,"y":265,"page":0},{"id":927,"index":919,"char":"","width":28,"height":35,"xoffset":0,"yoffset":4,"xadvance":29,"chnl":15,"x":170,"y":228,"page":0},{"id":105,"index":77,"char":"i","width":8,"height":34,"xoffset":1,"yoffset":4,"xadvance":10,"chnl":15,"x":175,"y":192,"page":0},{"id":119,"index":91,"char":"w","width":34,"height":26,"xoffset":-1,"yoffset":12,"xadvance":32,"chnl":15,"x":181,"y":151,"page":0},{"id":65,"index":37,"char":"A","width":30,"height":34,"xoffset":-1,"yoffset":4,"xadvance":27,"chnl":15,"x":193,"y":109,"page":0},{"id":90,"index":62,"char":"Z","width":26,"height":34,"xoffset":0,"yoffset":4,"xadvance":25,"chnl":15,"x":197,"y":72,"page":0},{"id":69,"index":41,"char":"E","width":23,"height":34,"xoffset":1,"yoffset":4,"xadvance":24,"chnl":15,"x":220,"y":36,"page":0},{"id":82,"index":54,"char":"R","width":26,"height":34,"xoffset":1,"yoffset":4,"xadvance":26,"chnl":15,"x":240,"y":0,"page":0},{"id":84,"index":56,"char":"T","width":27,"height":34,"xoffset":-1,"yoffset":4,"xadvance":25,"chnl":15,"x":184,"y":178,"page":0},{"id":89,"index":61,"char":"Y","width":29,"height":34,"xoffset":-2,"yoffset":4,"xadvance":25,"chnl":15,"x":124,"y":393,"page":0},{"id":85,"index":57,"char":"U","width":26,"height":34,"xoffset":1,"yoffset":4,"xadvance":27,"chnl":15,"x":150,"y":357,"page":0},{"id":73,"index":45,"char":"I","width":8,"height":34,"xoffset":2,"yoffset":4,"xadvance":11,"chnl":15,"x":172,"y":301,"page":0},{"id":80,"index":52,"char":"P","width":25,"height":34,"xoffset":1,"yoffset":4,"xadvance":26,"chnl":15,"x":141,"y":428,"page":0},{"id":68,"index":40,"char":"D","width":26,"height":34,"xoffset":1,"yoffset":4,"xadvance":28,"chnl":15,"x":154,"y":392,"page":0},{"id":70,"index":42,"char":"F","width":22,"height":34,"xoffset":1,"yoffset":4,"xadvance":23,"chnl":15,"x":141,"y":463,"page":0},{"id":72,"index":44,"char":"H","width":27,"height":34,"xoffset":1,"yoffset":4,"xadvance":30,"chnl":15,"x":164,"y":463,"page":0},{"id":74,"index":46,"char":"J","width":23,"height":34,"xoffset":-1,"yoffset":4,"xadvance":23,"chnl":15,"x":167,"y":427,"page":0},{"id":75,"index":47,"char":"K","width":27,"height":34,"xoffset":1,"yoffset":4,"xadvance":26,"chnl":15,"x":177,"y":336,"page":0},{"id":76,"index":48,"char":"L","width":22,"height":34,"xoffset":1,"yoffset":4,"xadvance":23,"chnl":15,"x":181,"y":301,"page":0},{"id":77,"index":49,"char":"M","width":34,"height":34,"xoffset":1,"yoffset":4,"xadvance":37,"chnl":15,"x":198,"y":264,"page":0},{"id":88,"index":60,"char":"X","width":28,"height":34,"xoffset":-1,"yoffset":4,"xadvance":26,"chnl":15,"x":204,"y":299,"page":0},{"id":86,"index":58,"char":"V","width":30,"height":34,"xoffset":-1,"yoffset":4,"xadvance":27,"chnl":15,"x":199,"y":213,"page":0},{"id":66,"index":38,"char":"B","width":24,"height":34,"xoffset":1,"yoffset":4,"xadvance":26,"chnl":15,"x":212,"y":178,"page":0},{"id":78,"index":50,"char":"N","width":27,"height":34,"xoffset":1,"yoffset":4,"xadvance":30,"chnl":15,"x":230,"y":213,"page":0},{"id":55,"index":27,"char":"7","width":24,"height":34,"xoffset":0,"yoffset":4,"xadvance":24,"chnl":15,"x":181,"y":371,"page":0},{"id":57,"index":29,"char":"9","width":23,"height":34,"xoffset":0,"yoffset":4,"xadvance":24,"chnl":15,"x":205,"y":334,"page":0},{"id":52,"index":24,"char":"4","width":26,"height":34,"xoffset":-1,"yoffset":4,"xadvance":24,"chnl":15,"x":191,"y":406,"page":0},{"id":53,"index":25,"char":"5","width":23,"height":34,"xoffset":1,"yoffset":4,"xadvance":24,"chnl":15,"x":206,"y":369,"page":0},{"id":54,"index":26,"char":"6","width":23,"height":34,"xoffset":1,"yoffset":4,"xadvance":24,"chnl":15,"x":229,"y":334,"page":0},{"id":49,"index":21,"char":"1","width":15,"height":34,"xoffset":1,"yoffset":4,"xadvance":24,"chnl":15,"x":192,"y":441,"page":0},{"id":50,"index":22,"char":"2","width":24,"height":34,"xoffset":0,"yoffset":4,"xadvance":24,"chnl":15,"x":192,"y":476,"page":0},{"id":33,"index":5,"char":"!","width":8,"height":34,"xoffset":1,"yoffset":4,"xadvance":11,"chnl":15,"x":208,"y":441,"page":0},{"id":63,"index":35,"char":"?","width":21,"height":34,"xoffset":0,"yoffset":4,"xadvance":20,"chnl":15,"x":217,"y":441,"page":0},{"id":163,"index":101,"char":"","width":25,"height":34,"xoffset":0,"yoffset":4,"xadvance":24,"chnl":15,"x":218,"y":404,"page":0},{"id":35,"index":7,"char":"#","width":27,"height":34,"xoffset":0,"yoffset":4,"xadvance":26,"chnl":15,"x":230,"y":369,"page":0},{"id":1040,"index":950,"char":"","width":30,"height":34,"xoffset":-1,"yoffset":4,"xadvance":27,"chnl":15,"x":217,"y":476,"page":0},{"id":1041,"index":216,"char":"","width":25,"height":34,"xoffset":1,"yoffset":4,"xadvance":26,"chnl":15,"x":239,"y":439,"page":0},{"id":1042,"index":951,"char":"","width":24,"height":34,"xoffset":1,"yoffset":4,"xadvance":26,"chnl":15,"x":244,"y":404,"page":0},{"id":1043,"index":952,"char":"","width":22,"height":34,"xoffset":2,"yoffset":4,"xadvance":23,"chnl":15,"x":248,"y":474,"page":0},{"id":1045,"index":953,"char":"","width":23,"height":34,"xoffset":1,"yoffset":4,"xadvance":24,"chnl":15,"x":265,"y":439,"page":0},{"id":1048,"index":220,"char":"","width":27,"height":34,"xoffset":2,"yoffset":4,"xadvance":30,"chnl":15,"x":271,"y":474,"page":0},{"id":1081,"index":965,"char":"","width":22,"height":34,"xoffset":1,"yoffset":4,"xadvance":24,"chnl":15,"x":233,"y":248,"page":0},{"id":1050,"index":947,"char":"","width":27,"height":34,"xoffset":2,"yoffset":4,"xadvance":27,"chnl":15,"x":233,"y":283,"page":0},{"id":1051,"index":221,"char":"","width":29,"height":34,"xoffset":-1,"yoffset":4,"xadvance":30,"chnl":15,"x":256,"y":248,"page":0},{"id":1052,"index":955,"char":"","width":34,"height":34,"xoffset":1,"yoffset":4,"xadvance":37,"chnl":15,"x":253,"y":318,"page":0},{"id":1053,"index":956,"char":"","width":27,"height":34,"xoffset":1,"yoffset":4,"xadvance":30,"chnl":15,"x":261,"y":283,"page":0},{"id":1055,"index":958,"char":"","width":27,"height":34,"xoffset":2,"yoffset":4,"xadvance":30,"chnl":15,"x":258,"y":353,"page":0},{"id":1056,"index":959,"char":"","width":25,"height":34,"xoffset":1,"yoffset":4,"xadvance":26,"chnl":15,"x":269,"y":388,"page":0},{"id":1058,"index":961,"char":"","width":27,"height":34,"xoffset":-1,"yoffset":4,"xadvance":25,"chnl":15,"x":286,"y":353,"page":0},{"id":1059,"index":222,"char":"","width":28,"height":34,"xoffset":0,"yoffset":4,"xadvance":26,"chnl":15,"x":288,"y":318,"page":0},{"id":1061,"index":962,"char":"","width":28,"height":34,"xoffset":-1,"yoffset":4,"xadvance":26,"chnl":15,"x":289,"y":423,"page":0},{"id":1063,"index":225,"char":"","width":26,"height":34,"xoffset":1,"yoffset":4,"xadvance":29,"chnl":15,"x":295,"y":388,"page":0},{"id":1066,"index":228,"char":"","width":34,"height":34,"xoffset":-2,"yoffset":4,"xadvance":32,"chnl":15,"x":314,"y":353,"page":0},{"id":1067,"index":229,"char":"","width":33,"height":34,"xoffset":2,"yoffset":4,"xadvance":36,"chnl":15,"x":299,"y":458,"page":0},{"id":1068,"index":230,"char":"","width":25,"height":34,"xoffset":1,"yoffset":4,"xadvance":26,"chnl":15,"x":318,"y":423,"page":0},{"id":1071,"index":233,"char":"","width":25,"height":34,"xoffset":0,"yoffset":4,"xadvance":27,"chnl":15,"x":322,"y":388,"page":0},{"id":962,"index":200,"char":"","width":22,"height":34,"xoffset":0,"yoffset":11,"xadvance":23,"chnl":15,"x":333,"y":458,"page":0},{"id":969,"index":206,"char":"","width":34,"height":27,"xoffset":1,"yoffset":12,"xadvance":35,"chnl":15,"x":216,"y":144,"page":0},{"id":917,"index":912,"char":"","width":23,"height":34,"xoffset":1,"yoffset":4,"xadvance":24,"chnl":15,"x":344,"y":423,"page":0},{"id":929,"index":920,"char":"","width":25,"height":34,"xoffset":1,"yoffset":4,"xadvance":26,"chnl":15,"x":348,"y":388,"page":0},{"id":932,"index":921,"char":"","width":27,"height":34,"xoffset":-1,"yoffset":4,"xadvance":25,"chnl":15,"x":237,"y":172,"page":0},{"id":933,"index":922,"char":"","width":29,"height":34,"xoffset":-2,"yoffset":4,"xadvance":25,"chnl":15,"x":258,"y":207,"page":0},{"id":921,"index":915,"char":"","width":8,"height":34,"xoffset":2,"yoffset":4,"xadvance":11,"chnl":15,"x":286,"y":242,"page":0},{"id":928,"index":182,"char":"","width":27,"height":34,"xoffset":2,"yoffset":4,"xadvance":30,"chnl":15,"x":289,"y":277,"page":0},{"id":913,"index":910,"char":"","width":30,"height":34,"xoffset":-1,"yoffset":4,"xadvance":27,"chnl":15,"x":356,"y":458,"page":0},{"id":931,"index":183,"char":"","width":25,"height":34,"xoffset":-1,"yoffset":4,"xadvance":24,"chnl":15,"x":368,"y":423,"page":0},{"id":916,"index":178,"char":"","width":32,"height":34,"xoffset":-1,"yoffset":4,"xadvance":30,"chnl":15,"x":387,"y":458,"page":0},{"id":934,"index":184,"char":"","width":31,"height":34,"xoffset":0,"yoffset":4,"xadvance":30,"chnl":15,"x":224,"y":71,"page":0},{"id":915,"index":177,"char":"","width":22,"height":34,"xoffset":2,"yoffset":4,"xadvance":23,"chnl":15,"x":244,"y":35,"page":0},{"id":919,"index":914,"char":"","width":27,"height":34,"xoffset":1,"yoffset":4,"xadvance":30,"chnl":15,"x":224,"y":106,"page":0},{"id":926,"index":181,"char":"","width":23,"height":34,"xoffset":0,"yoffset":4,"xadvance":24,"chnl":15,"x":252,"y":106,"page":0},{"id":922,"index":916,"char":"","width":27,"height":34,"xoffset":1,"yoffset":4,"xadvance":26,"chnl":15,"x":256,"y":70,"page":0},{"id":923,"index":180,"char":"","width":29,"height":34,"xoffset":-1,"yoffset":4,"xadvance":28,"chnl":15,"x":265,"y":141,"page":0},{"id":918,"index":913,"char":"","width":26,"height":34,"xoffset":0,"yoffset":4,"xadvance":25,"chnl":15,"x":276,"y":105,"page":0},{"id":935,"index":923,"char":"","width":28,"height":34,"xoffset":-1,"yoffset":4,"xadvance":26,"chnl":15,"x":288,"y":176,"page":0},{"id":936,"index":185,"char":"","width":29,"height":34,"xoffset":0,"yoffset":4,"xadvance":29,"chnl":15,"x":295,"y":140,"page":0},{"id":937,"index":186,"char":"","width":27,"height":34,"xoffset":0,"yoffset":4,"xadvance":28,"chnl":15,"x":295,"y":211,"page":0},{"id":914,"index":911,"char":"","width":24,"height":34,"xoffset":1,"yoffset":4,"xadvance":26,"chnl":15,"x":317,"y":175,"page":0},{"id":925,"index":918,"char":"","width":27,"height":34,"xoffset":1,"yoffset":4,"xadvance":30,"chnl":15,"x":267,"y":0,"page":0},{"id":924,"index":917,"char":"","width":34,"height":34,"xoffset":1,"yoffset":4,"xadvance":37,"chnl":15,"x":267,"y":35,"page":0},{"id":1076,"index":237,"char":"","width":27,"height":33,"xoffset":-1,"yoffset":12,"xadvance":25,"chnl":15,"x":284,"y":70,"page":0},{"id":1094,"index":248,"char":"","width":24,"height":33,"xoffset":1,"yoffset":12,"xadvance":25,"chnl":15,"x":295,"y":0,"page":0},{"id":1102,"index":256,"char":"","width":33,"height":27,"xoffset":1,"yoffset":11,"xadvance":34,"chnl":15,"x":295,"y":246,"page":0},{"id":116,"index":88,"char":"t","width":16,"height":32,"xoffset":-2,"yoffset":6,"xadvance":14,"chnl":15,"x":303,"y":104,"page":0},{"id":59,"index":31,"char":";","width":10,"height":32,"xoffset":-1,"yoffset":12,"xadvance":9,"chnl":15,"x":302,"y":34,"page":0},{"id":1096,"index":250,"char":"","width":32,"height":26,"xoffset":1,"yoffset":12,"xadvance":34,"chnl":15,"x":323,"y":210,"page":0},{"id":248,"index":137,"char":"","width":24,"height":32,"xoffset":0,"yoffset":9,"xadvance":24,"chnl":15,"x":312,"y":67,"page":0},{"id":1099,"index":253,"char":"","width":30,"height":26,"xoffset":1,"yoffset":12,"xadvance":33,"chnl":15,"x":313,"y":34,"page":0},{"id":1084,"index":243,"char":"","width":29,"height":26,"xoffset":1,"yoffset":12,"xadvance":31,"chnl":15,"x":320,"y":0,"page":0},{"id":1098,"index":252,"char":"","width":28,"height":26,"xoffset":-1,"yoffset":12,"xadvance":26,"chnl":15,"x":320,"y":100,"page":0},{"id":960,"index":198,"char":"","width":28,"height":26,"xoffset":-1,"yoffset":12,"xadvance":25,"chnl":15,"x":337,"y":61,"page":0},{"id":97,"index":69,"char":"a","width":22,"height":27,"xoffset":0,"yoffset":11,"xadvance":23,"chnl":15,"x":265,"y":176,"page":0},{"id":101,"index":73,"char":"e","width":23,"height":27,"xoffset":0,"yoffset":11,"xadvance":22,"chnl":15,"x":344,"y":27,"page":0},{"id":114,"index":86,"char":"r","width":15,"height":27,"xoffset":1,"yoffset":11,"xadvance":14,"chnl":15,"x":325,"y":127,"page":0},{"id":117,"index":89,"char":"u","width":21,"height":27,"xoffset":1,"yoffset":12,"xadvance":23,"chnl":15,"x":341,"y":127,"page":0},{"id":111,"index":83,"char":"o","width":24,"height":27,"xoffset":0,"yoffset":11,"xadvance":24,"chnl":15,"x":349,"y":88,"page":0},{"id":115,"index":87,"char":"s","width":22,"height":27,"xoffset":0,"yoffset":11,"xadvance":22,"chnl":15,"x":366,"y":55,"page":0},{"id":99,"index":71,"char":"c","width":23,"height":27,"xoffset":0,"yoffset":11,"xadvance":22,"chnl":15,"x":342,"y":155,"page":0},{"id":110,"index":82,"char":"n","width":21,"height":27,"xoffset":1,"yoffset":11,"xadvance":23,"chnl":15,"x":363,"y":116,"page":0},{"id":58,"index":30,"char":":","width":9,"height":27,"xoffset":1,"yoffset":12,"xadvance":10,"chnl":15,"x":251,"y":141,"page":0},{"id":126,"index":98,"char":"~","width":27,"height":12,"xoffset":1,"yoffset":18,"xadvance":29,"chnl":15,"x":112,"y":490,"page":0},{"id":1072,"index":963,"char":"","width":22,"height":27,"xoffset":0,"yoffset":11,"xadvance":23,"chnl":15,"x":374,"y":83,"page":0},{"id":1077,"index":964,"char":"","width":23,"height":27,"xoffset":0,"yoffset":11,"xadvance":22,"chnl":15,"x":368,"y":0,"page":0},{"id":1079,"index":239,"char":"","width":21,"height":27,"xoffset":0,"yoffset":11,"xadvance":21,"chnl":15,"x":389,"y":28,"page":0},{"id":1086,"index":966,"char":"","width":24,"height":27,"xoffset":0,"yoffset":11,"xadvance":24,"chnl":15,"x":392,"y":0,"page":0},{"id":1089,"index":968,"char":"","width":23,"height":27,"xoffset":0,"yoffset":11,"xadvance":22,"chnl":15,"x":317,"y":274,"page":0},{"id":1101,"index":255,"char":"","width":22,"height":27,"xoffset":0,"yoffset":11,"xadvance":23,"chnl":15,"x":329,"y":237,"page":0},{"id":949,"index":191,"char":"","width":23,"height":27,"xoffset":0,"yoffset":11,"xadvance":23,"chnl":15,"x":317,"y":302,"page":0},{"id":964,"index":202,"char":"","width":23,"height":27,"xoffset":0,"yoffset":12,"xadvance":22,"chnl":15,"x":341,"y":265,"page":0},{"id":965,"index":203,"char":"","width":22,"height":27,"xoffset":1,"yoffset":12,"xadvance":23,"chnl":15,"x":352,"y":237,"page":0},{"id":959,"index":932,"char":"","width":24,"height":27,"xoffset":0,"yoffset":11,"xadvance":24,"chnl":15,"x":356,"y":183,"page":0},{"id":945,"index":187,"char":"","width":25,"height":27,"xoffset":0,"yoffset":11,"xadvance":24,"chnl":15,"x":366,"y":144,"page":0},{"id":963,"index":201,"char":"","width":26,"height":27,"xoffset":0,"yoffset":12,"xadvance":24,"chnl":15,"x":385,"y":111,"page":0},{"id":122,"index":94,"char":"z","width":22,"height":26,"xoffset":0,"yoffset":12,"xadvance":21,"chnl":15,"x":389,"y":56,"page":0},{"id":120,"index":92,"char":"x","width":23,"height":26,"xoffset":-1,"yoffset":12,"xadvance":21,"chnl":15,"x":397,"y":83,"page":0},{"id":118,"index":90,"char":"v","width":23,"height":26,"xoffset":-1,"yoffset":12,"xadvance":20,"chnl":15,"x":411,"y":28,"page":0},{"id":43,"index":15,"char":"+","width":24,"height":26,"xoffset":0,"yoffset":9,"xadvance":24,"chnl":15,"x":417,"y":0,"page":0},{"id":1074,"index":235,"char":"","width":23,"height":26,"xoffset":1,"yoffset":12,"xadvance":24,"chnl":15,"x":412,"y":55,"page":0},{"id":1075,"index":236,"char":"","width":18,"height":26,"xoffset":1,"yoffset":12,"xadvance":18,"chnl":15,"x":368,"y":28,"page":0},{"id":1080,"index":240,"char":"","width":22,"height":26,"xoffset":1,"yoffset":12,"xadvance":24,"chnl":15,"x":435,"y":27,"page":0},{"id":1082,"index":241,"char":"","width":23,"height":26,"xoffset":1,"yoffset":12,"xadvance":23,"chnl":15,"x":442,"y":0,"page":0},{"id":1083,"index":242,"char":"","width":24,"height":26,"xoffset":-1,"yoffset":12,"xadvance":24,"chnl":15,"x":466,"y":0,"page":0},{"id":1085,"index":244,"char":"","width":22,"height":26,"xoffset":1,"yoffset":12,"xadvance":24,"chnl":15,"x":458,"y":27,"page":0},{"id":1087,"index":245,"char":"","width":22,"height":26,"xoffset":1,"yoffset":12,"xadvance":24,"chnl":15,"x":481,"y":27,"page":0},{"id":1090,"index":246,"char":"","width":23,"height":26,"xoffset":-1,"yoffset":12,"xadvance":20,"chnl":15,"x":341,"y":293,"page":0},{"id":1093,"index":970,"char":"","width":23,"height":26,"xoffset":-1,"yoffset":12,"xadvance":21,"chnl":15,"x":341,"y":320,"page":0},{"id":1095,"index":249,"char":"","width":22,"height":26,"xoffset":0,"yoffset":12,"xadvance":23,"chnl":15,"x":349,"y":347,"page":0},{"id":1100,"index":254,"char":"","width":22,"height":26,"xoffset":1,"yoffset":12,"xadvance":23,"chnl":15,"x":436,"y":54,"page":0},{"id":1103,"index":257,"char":"","width":23,"height":26,"xoffset":-1,"yoffset":12,"xadvance":23,"chnl":15,"x":459,"y":54,"page":0},{"id":953,"index":195,"char":"","width":12,"height":26,"xoffset":2,"yoffset":12,"xadvance":14,"chnl":15,"x":350,"y":0,"page":0},{"id":954,"index":931,"char":"","width":23,"height":26,"xoffset":1,"yoffset":12,"xadvance":23,"chnl":15,"x":483,"y":54,"page":0},{"id":957,"index":934,"char":"","width":23,"height":26,"xoffset":-1,"yoffset":12,"xadvance":20,"chnl":15,"x":436,"y":81,"page":0},{"id":8211,"index":385,"char":"","width":25,"height":7,"xoffset":1,"yoffset":18,"xadvance":28,"chnl":15,"x":64,"y":503,"page":0},{"id":95,"index":67,"char":"_","width":23,"height":7,"xoffset":-2,"yoffset":34,"xadvance":19,"chnl":15,"x":100,"y":395,"page":0},{"id":42,"index":14,"char":"*","width":21,"height":21,"xoffset":-1,"yoffset":4,"xadvance":18,"chnl":15,"x":491,"y":0,"page":0},{"id":61,"index":33,"char":"=","width":21,"height":16,"xoffset":1,"yoffset":14,"xadvance":23,"chnl":15,"x":113,"y":275,"page":0},{"id":176,"index":113,"char":"","width":14,"height":15,"xoffset":1,"yoffset":4,"xadvance":16,"chnl":15,"x":199,"y":248,"page":0},{"id":45,"index":17,"char":"-","width":14,"height":7,"xoffset":-1,"yoffset":20,"xadvance":12,"chnl":15,"x":54,"y":346,"page":0},{"id":44,"index":16,"char":",","width":10,"height":14,"xoffset":-1,"yoffset":30,"xadvance":8,"chnl":15,"x":184,"y":213,"page":0},{"id":34,"index":6,"char":"\\"","width":12,"height":14,"xoffset":1,"yoffset":3,"xadvance":13,"chnl":15,"x":83,"y":203,"page":0},{"id":39,"index":11,"char":"'","width":7,"height":14,"xoffset":0,"yoffset":3,"xadvance":7,"chnl":15,"x":140,"y":498,"page":0},{"id":46,"index":18,"char":".","width":9,"height":9,"xoffset":1,"yoffset":30,"xadvance":11,"chnl":15,"x":123,"y":229,"page":0}]`),info={face:"Roboto-Regular",size:42,bold:0,italic:0,charset:["a","z","e","r","t","y","u","i","o","p","q","s","d","f","g","h","j","k","l","m","w","x","c","v","b","n","A","Z","E","R","T","Y","U","I","O","P","Q","S","D","F","G","H","J","K","L","M","W","X","C","V","B","N","/","\\","*","-","","+","7","8","9","4","5","6","1","2","3","0",",",";",":","!","?",".","%","$","","","=","{","}","(",")","[","]","&","~",'"',"'","#","_","|","","@","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""],unicode:1,stretchH:100,smooth:1,aa:1,padding:[2,2,2,2],spacing:[0,0]},common={lineHeight:44,base:34,scaleW:512,scaleH:512,pages:1,packed:0,alphaChnl:0,redChnl:0,greenChnl:0,blueChnl:0},distanceField={fieldType:"msdf",distanceRange:4},kernings=JSON.parse('[{"first":97,"second":121,"amount":0},{"first":97,"second":118,"amount":0},{"first":97,"second":34,"amount":-1},{"first":97,"second":39,"amount":-1},{"first":97,"second":1090,"amount":0},{"first":97,"second":1091,"amount":0},{"first":97,"second":947,"amount":0},{"first":97,"second":957,"amount":0},{"first":122,"second":101,"amount":0},{"first":122,"second":111,"amount":0},{"first":122,"second":113,"amount":0},{"first":122,"second":100,"amount":0},{"first":122,"second":103,"amount":0},{"first":122,"second":99,"amount":0},{"first":122,"second":1077,"amount":0},{"first":122,"second":1105,"amount":0},{"first":122,"second":1086,"amount":0},{"first":122,"second":1089,"amount":0},{"first":122,"second":1092,"amount":0},{"first":122,"second":246,"amount":0},{"first":122,"second":962,"amount":0},{"first":122,"second":959,"amount":0},{"first":122,"second":945,"amount":0},{"first":122,"second":963,"amount":0},{"first":101,"second":121,"amount":0},{"first":101,"second":118,"amount":0},{"first":101,"second":34,"amount":0},{"first":101,"second":39,"amount":0},{"first":101,"second":1090,"amount":0},{"first":101,"second":1091,"amount":0},{"first":101,"second":947,"amount":0},{"first":101,"second":957,"amount":0},{"first":114,"second":97,"amount":-1},{"first":114,"second":101,"amount":0},{"first":114,"second":116,"amount":1},{"first":114,"second":121,"amount":0},{"first":114,"second":111,"amount":0},{"first":114,"second":113,"amount":0},{"first":114,"second":100,"amount":0},{"first":114,"second":102,"amount":0},{"first":114,"second":103,"amount":0},{"first":114,"second":119,"amount":0},{"first":114,"second":99,"amount":0},{"first":114,"second":118,"amount":0},{"first":114,"second":44,"amount":-3},{"first":114,"second":46,"amount":-3},{"first":114,"second":34,"amount":0},{"first":114,"second":39,"amount":0},{"first":114,"second":1072,"amount":-1},{"first":114,"second":1077,"amount":0},{"first":114,"second":1105,"amount":0},{"first":114,"second":1086,"amount":0},{"first":114,"second":1089,"amount":0},{"first":114,"second":1091,"amount":0},{"first":114,"second":1092,"amount":0},{"first":114,"second":246,"amount":0},{"first":114,"second":228,"amount":-1},{"first":114,"second":962,"amount":0},{"first":114,"second":959,"amount":0},{"first":114,"second":945,"amount":0},{"first":114,"second":963,"amount":0},{"first":114,"second":947,"amount":0},{"first":114,"second":957,"amount":0},{"first":114,"second":229,"amount":-1},{"first":116,"second":111,"amount":0},{"first":116,"second":1086,"amount":0},{"first":116,"second":246,"amount":0},{"first":116,"second":959,"amount":0},{"first":121,"second":97,"amount":0},{"first":121,"second":101,"amount":0},{"first":121,"second":111,"amount":0},{"first":121,"second":113,"amount":0},{"first":121,"second":100,"amount":0},{"first":121,"second":102,"amount":0},{"first":121,"second":103,"amount":0},{"first":121,"second":99,"amount":0},{"first":121,"second":44,"amount":-2},{"first":121,"second":46,"amount":-2},{"first":121,"second":34,"amount":0},{"first":121,"second":39,"amount":0},{"first":121,"second":1072,"amount":0},{"first":121,"second":1076,"amount":-1},{"first":121,"second":1077,"amount":0},{"first":121,"second":1105,"amount":0},{"first":121,"second":1083,"amount":-1},{"first":121,"second":1086,"amount":0},{"first":121,"second":1089,"amount":0},{"first":121,"second":1092,"amount":0},{"first":121,"second":246,"amount":0},{"first":121,"second":228,"amount":0},{"first":121,"second":962,"amount":0},{"first":121,"second":961,"amount":0},{"first":121,"second":964,"amount":0},{"first":121,"second":959,"amount":0},{"first":121,"second":960,"amount":0},{"first":121,"second":945,"amount":0},{"first":121,"second":963,"amount":0},{"first":121,"second":948,"amount":0},{"first":121,"second":229,"amount":0},{"first":111,"second":122,"amount":0},{"first":111,"second":121,"amount":0},{"first":111,"second":120,"amount":0},{"first":111,"second":118,"amount":0},{"first":111,"second":34,"amount":-3},{"first":111,"second":39,"amount":-3},{"first":111,"second":1076,"amount":-1},{"first":111,"second":1078,"amount":0},{"first":111,"second":1083,"amount":0},{"first":111,"second":1090,"amount":0},{"first":111,"second":1091,"amount":0},{"first":111,"second":1093,"amount":0},{"first":111,"second":964,"amount":0},{"first":111,"second":947,"amount":0},{"first":111,"second":957,"amount":0},{"first":112,"second":122,"amount":0},{"first":112,"second":121,"amount":0},{"first":112,"second":120,"amount":0},{"first":112,"second":118,"amount":0},{"first":112,"second":34,"amount":-1},{"first":112,"second":39,"amount":-1},{"first":112,"second":1076,"amount":0},{"first":112,"second":1078,"amount":0},{"first":112,"second":1083,"amount":0},{"first":112,"second":1090,"amount":-2},{"first":112,"second":1091,"amount":0},{"first":112,"second":1093,"amount":0},{"first":112,"second":964,"amount":0},{"first":112,"second":947,"amount":0},{"first":112,"second":957,"amount":0},{"first":102,"second":101,"amount":0},{"first":102,"second":113,"amount":0},{"first":102,"second":100,"amount":0},{"first":102,"second":103,"amount":0},{"first":102,"second":99,"amount":0},{"first":102,"second":125,"amount":0},{"first":102,"second":41,"amount":0},{"first":102,"second":93,"amount":0},{"first":102,"second":34,"amount":0},{"first":102,"second":39,"amount":0},{"first":102,"second":1077,"amount":0},{"first":102,"second":1105,"amount":0},{"first":102,"second":1089,"amount":0},{"first":102,"second":1092,"amount":0},{"first":102,"second":962,"amount":0},{"first":102,"second":945,"amount":0},{"first":102,"second":963,"amount":0},{"first":104,"second":34,"amount":-2},{"first":104,"second":39,"amount":-2},{"first":104,"second":1090,"amount":-1},{"first":107,"second":101,"amount":0},{"first":107,"second":113,"amount":0},{"first":107,"second":100,"amount":0},{"first":107,"second":103,"amount":0},{"first":107,"second":99,"amount":0},{"first":107,"second":1077,"amount":0},{"first":107,"second":1105,"amount":0},{"first":107,"second":1089,"amount":0},{"first":107,"second":1092,"amount":0},{"first":107,"second":962,"amount":0},{"first":107,"second":945,"amount":0},{"first":107,"second":963,"amount":0},{"first":109,"second":34,"amount":-2},{"first":109,"second":39,"amount":-2},{"first":109,"second":1090,"amount":-1},{"first":119,"second":44,"amount":-3},{"first":119,"second":46,"amount":-3},{"first":120,"second":101,"amount":0},{"first":120,"second":111,"amount":0},{"first":120,"second":113,"amount":0},{"first":120,"second":100,"amount":0},{"first":120,"second":103,"amount":0},{"first":120,"second":99,"amount":0},{"first":120,"second":1077,"amount":0},{"first":120,"second":1105,"amount":0},{"first":120,"second":1086,"amount":0},{"first":120,"second":1089,"amount":0},{"first":120,"second":1092,"amount":0},{"first":120,"second":246,"amount":0},{"first":120,"second":962,"amount":0},{"first":120,"second":959,"amount":0},{"first":120,"second":945,"amount":0},{"first":120,"second":963,"amount":0},{"first":99,"second":34,"amount":0},{"first":99,"second":39,"amount":0},{"first":118,"second":97,"amount":0},{"first":118,"second":101,"amount":0},{"first":118,"second":111,"amount":0},{"first":118,"second":113,"amount":0},{"first":118,"second":100,"amount":0},{"first":118,"second":102,"amount":0},{"first":118,"second":103,"amount":0},{"first":118,"second":99,"amount":0},{"first":118,"second":44,"amount":-2},{"first":118,"second":46,"amount":-2},{"first":118,"second":34,"amount":0},{"first":118,"second":39,"amount":0},{"first":118,"second":1072,"amount":0},{"first":118,"second":1076,"amount":-1},{"first":118,"second":1077,"amount":0},{"first":118,"second":1105,"amount":0},{"first":118,"second":1083,"amount":-1},{"first":118,"second":1086,"amount":0},{"first":118,"second":1089,"amount":0},{"first":118,"second":1092,"amount":0},{"first":118,"second":246,"amount":0},{"first":118,"second":228,"amount":0},{"first":118,"second":962,"amount":0},{"first":118,"second":961,"amount":0},{"first":118,"second":964,"amount":0},{"first":118,"second":959,"amount":0},{"first":118,"second":960,"amount":0},{"first":118,"second":945,"amount":0},{"first":118,"second":963,"amount":0},{"first":118,"second":948,"amount":0},{"first":118,"second":229,"amount":0},{"first":98,"second":122,"amount":0},{"first":98,"second":121,"amount":0},{"first":98,"second":120,"amount":0},{"first":98,"second":118,"amount":0},{"first":98,"second":34,"amount":-1},{"first":98,"second":39,"amount":-1},{"first":98,"second":1076,"amount":0},{"first":98,"second":1078,"amount":0},{"first":98,"second":1083,"amount":0},{"first":98,"second":1090,"amount":-2},{"first":98,"second":1091,"amount":0},{"first":98,"second":1093,"amount":0},{"first":98,"second":964,"amount":0},{"first":98,"second":947,"amount":0},{"first":98,"second":957,"amount":0},{"first":110,"second":34,"amount":-2},{"first":110,"second":39,"amount":-2},{"first":110,"second":1090,"amount":-1},{"first":65,"second":122,"amount":0},{"first":65,"second":116,"amount":0},{"first":65,"second":121,"amount":-1},{"first":65,"second":117,"amount":0},{"first":65,"second":111,"amount":0},{"first":65,"second":119,"amount":-1},{"first":65,"second":118,"amount":-1},{"first":65,"second":84,"amount":-3},{"first":65,"second":89,"amount":-2},{"first":65,"second":85,"amount":0},{"first":65,"second":79,"amount":0},{"first":65,"second":81,"amount":0},{"first":65,"second":71,"amount":0},{"first":65,"second":87,"amount":-1},{"first":65,"second":67,"amount":0},{"first":65,"second":86,"amount":-2},{"first":65,"second":63,"amount":-1},{"first":65,"second":34,"amount":-2},{"first":65,"second":39,"amount":-2},{"first":65,"second":1044,"amount":0},{"first":65,"second":1051,"amount":0},{"first":65,"second":1083,"amount":0},{"first":65,"second":1054,"amount":0},{"first":65,"second":1086,"amount":0},{"first":65,"second":1057,"amount":0},{"first":65,"second":1058,"amount":-3},{"first":65,"second":1090,"amount":-1},{"first":65,"second":1091,"amount":-1},{"first":65,"second":1063,"amount":-1},{"first":65,"second":1095,"amount":-2},{"first":65,"second":1068,"amount":-1},{"first":65,"second":252,"amount":0},{"first":65,"second":220,"amount":0},{"first":65,"second":246,"amount":0},{"first":65,"second":214,"amount":0},{"first":65,"second":964,"amount":-1},{"first":65,"second":965,"amount":0},{"first":65,"second":959,"amount":0},{"first":65,"second":947,"amount":-1},{"first":65,"second":955,"amount":0},{"first":65,"second":957,"amount":-1},{"first":65,"second":933,"amount":-2},{"first":65,"second":920,"amount":0},{"first":65,"second":927,"amount":0},{"first":65,"second":934,"amount":-1},{"first":65,"second":936,"amount":-1},{"first":65,"second":216,"amount":0},{"first":90,"second":101,"amount":0},{"first":90,"second":121,"amount":-1},{"first":90,"second":117,"amount":0},{"first":90,"second":111,"amount":0},{"first":90,"second":113,"amount":0},{"first":90,"second":100,"amount":0},{"first":90,"second":103,"amount":0},{"first":90,"second":119,"amount":-1},{"first":90,"second":99,"amount":0},{"first":90,"second":118,"amount":-1},{"first":90,"second":65,"amount":0},{"first":90,"second":79,"amount":-1},{"first":90,"second":81,"amount":-1},{"first":90,"second":71,"amount":-1},{"first":90,"second":67,"amount":-1},{"first":90,"second":1040,"amount":0},{"first":90,"second":1077,"amount":0},{"first":90,"second":1105,"amount":0},{"first":90,"second":1054,"amount":-1},{"first":90,"second":1086,"amount":0},{"first":90,"second":1057,"amount":-1},{"first":90,"second":1089,"amount":0},{"first":90,"second":1091,"amount":-1},{"first":90,"second":1092,"amount":0},{"first":90,"second":252,"amount":0},{"first":90,"second":246,"amount":0},{"first":90,"second":214,"amount":-1},{"first":90,"second":196,"amount":0},{"first":90,"second":962,"amount":0},{"first":90,"second":965,"amount":0},{"first":90,"second":959,"amount":0},{"first":90,"second":945,"amount":0},{"first":90,"second":963,"amount":0},{"first":90,"second":947,"amount":-1},{"first":90,"second":968,"amount":-1},{"first":90,"second":957,"amount":-1},{"first":90,"second":920,"amount":-1},{"first":90,"second":927,"amount":-1},{"first":90,"second":913,"amount":0},{"first":90,"second":916,"amount":0},{"first":90,"second":934,"amount":-1},{"first":90,"second":923,"amount":0},{"first":90,"second":197,"amount":0},{"first":90,"second":216,"amount":-1},{"first":69,"second":101,"amount":0},{"first":69,"second":121,"amount":-1},{"first":69,"second":117,"amount":0},{"first":69,"second":111,"amount":0},{"first":69,"second":113,"amount":0},{"first":69,"second":100,"amount":0},{"first":69,"second":102,"amount":0},{"first":69,"second":103,"amount":0},{"first":69,"second":119,"amount":0},{"first":69,"second":99,"amount":0},{"first":69,"second":118,"amount":-1},{"first":69,"second":84,"amount":0},{"first":69,"second":1077,"amount":0},{"first":69,"second":1105,"amount":0},{"first":69,"second":1086,"amount":0},{"first":69,"second":1089,"amount":0},{"first":69,"second":1058,"amount":0},{"first":69,"second":1091,"amount":-1},{"first":69,"second":1092,"amount":0},{"first":69,"second":252,"amount":0},{"first":69,"second":246,"amount":0},{"first":69,"second":962,"amount":0},{"first":69,"second":965,"amount":0},{"first":69,"second":959,"amount":0},{"first":69,"second":945,"amount":0},{"first":69,"second":963,"amount":0},{"first":69,"second":947,"amount":-1},{"first":69,"second":957,"amount":-1},{"first":82,"second":84,"amount":-2},{"first":82,"second":89,"amount":-1},{"first":82,"second":86,"amount":0},{"first":82,"second":1058,"amount":-2},{"first":82,"second":933,"amount":-1},{"first":84,"second":97,"amount":-2},{"first":84,"second":122,"amount":-1},{"first":84,"second":101,"amount":-2},{"first":84,"second":114,"amount":-2},{"first":84,"second":121,"amount":-1},{"first":84,"second":117,"amount":-2},{"first":84,"second":111,"amount":-2},{"first":84,"second":112,"amount":-2},{"first":84,"second":113,"amount":-2},{"first":84,"second":115,"amount":-2},{"first":84,"second":100,"amount":-2},{"first":84,"second":103,"amount":-2},{"first":84,"second":109,"amount":-2},{"first":84,"second":119,"amount":-1},{"first":84,"second":120,"amount":-2},{"first":84,"second":99,"amount":-2},{"first":84,"second":118,"amount":-1},{"first":84,"second":110,"amount":-2},{"first":84,"second":65,"amount":-2},{"first":84,"second":84,"amount":0},{"first":84,"second":89,"amount":0},{"first":84,"second":79,"amount":-1},{"first":84,"second":81,"amount":-1},{"first":84,"second":83,"amount":0},{"first":84,"second":71,"amount":-1},{"first":84,"second":74,"amount":-5},{"first":84,"second":87,"amount":0},{"first":84,"second":67,"amount":-1},{"first":84,"second":86,"amount":0},{"first":84,"second":45,"amount":-5},{"first":84,"second":8211,"amount":-5},{"first":84,"second":44,"amount":-4},{"first":84,"second":46,"amount":-4},{"first":84,"second":1040,"amount":-2},{"first":84,"second":1072,"amount":-2},{"first":84,"second":1073,"amount":-1},{"first":84,"second":1074,"amount":-2},{"first":84,"second":1075,"amount":-2},{"first":84,"second":1044,"amount":-2},{"first":84,"second":1076,"amount":-3},{"first":84,"second":1077,"amount":-2},{"first":84,"second":1105,"amount":-2},{"first":84,"second":1078,"amount":-2},{"first":84,"second":1079,"amount":-3},{"first":84,"second":1080,"amount":-2},{"first":84,"second":1081,"amount":-2},{"first":84,"second":1082,"amount":-2},{"first":84,"second":1051,"amount":-1},{"first":84,"second":1083,"amount":-3},{"first":84,"second":1084,"amount":-2},{"first":84,"second":1085,"amount":-2},{"first":84,"second":1054,"amount":-1},{"first":84,"second":1086,"amount":-2},{"first":84,"second":1087,"amount":-2},{"first":84,"second":1088,"amount":-2},{"first":84,"second":1057,"amount":-1},{"first":84,"second":1089,"amount":-2},{"first":84,"second":1058,"amount":0},{"first":84,"second":1090,"amount":-2},{"first":84,"second":1091,"amount":-1},{"first":84,"second":1092,"amount":-2},{"first":84,"second":1093,"amount":-2},{"first":84,"second":1094,"amount":-2},{"first":84,"second":1095,"amount":-3},{"first":84,"second":1096,"amount":-2},{"first":84,"second":1097,"amount":-2},{"first":84,"second":1099,"amount":-3},{"first":84,"second":1068,"amount":0},{"first":84,"second":1100,"amount":-2},{"first":84,"second":1101,"amount":-3},{"first":84,"second":1102,"amount":-2},{"first":84,"second":1103,"amount":-3},{"first":84,"second":252,"amount":-2},{"first":84,"second":246,"amount":-2},{"first":84,"second":214,"amount":-1},{"first":84,"second":228,"amount":-2},{"first":84,"second":196,"amount":-2},{"first":84,"second":241,"amount":-2},{"first":84,"second":962,"amount":-2},{"first":84,"second":949,"amount":-3},{"first":84,"second":961,"amount":-3},{"first":84,"second":964,"amount":-2},{"first":84,"second":965,"amount":-2},{"first":84,"second":953,"amount":-3},{"first":84,"second":959,"amount":-2},{"first":84,"second":960,"amount":-2},{"first":84,"second":945,"amount":-2},{"first":84,"second":963,"amount":-2},{"first":84,"second":948,"amount":-1},{"first":84,"second":966,"amount":-3},{"first":84,"second":947,"amount":-1},{"first":84,"second":951,"amount":-2},{"first":84,"second":968,"amount":-3},{"first":84,"second":969,"amount":-3},{"first":84,"second":957,"amount":-1},{"first":84,"second":933,"amount":0},{"first":84,"second":920,"amount":-1},{"first":84,"second":927,"amount":-1},{"first":84,"second":913,"amount":-2},{"first":84,"second":916,"amount":-2},{"first":84,"second":934,"amount":-2},{"first":84,"second":923,"amount":-2},{"first":84,"second":229,"amount":-2},{"first":84,"second":197,"amount":-2},{"first":84,"second":230,"amount":-2},{"first":84,"second":198,"amount":-4},{"first":84,"second":248,"amount":-2},{"first":84,"second":216,"amount":-1},{"first":89,"second":97,"amount":-1},{"first":89,"second":122,"amount":-1},{"first":89,"second":101,"amount":-1},{"first":89,"second":114,"amount":-1},{"first":89,"second":116,"amount":0},{"first":89,"second":121,"amount":0},{"first":89,"second":117,"amount":-1},{"first":89,"second":111,"amount":-1},{"first":89,"second":112,"amount":-1},{"first":89,"second":113,"amount":-1},{"first":89,"second":115,"amount":-1},{"first":89,"second":100,"amount":-1},{"first":89,"second":102,"amount":0},{"first":89,"second":103,"amount":-1},{"first":89,"second":109,"amount":-1},{"first":89,"second":120,"amount":0},{"first":89,"second":99,"amount":-1},{"first":89,"second":118,"amount":0},{"first":89,"second":110,"amount":-1},{"first":89,"second":65,"amount":-2},{"first":89,"second":84,"amount":0},{"first":89,"second":89,"amount":0},{"first":89,"second":85,"amount":-2},{"first":89,"second":79,"amount":-1},{"first":89,"second":81,"amount":-1},{"first":89,"second":83,"amount":0},{"first":89,"second":71,"amount":-1},{"first":89,"second":74,"amount":-2},{"first":89,"second":87,"amount":0},{"first":89,"second":88,"amount":0},{"first":89,"second":67,"amount":-1},{"first":89,"second":86,"amount":0},{"first":89,"second":42,"amount":-1},{"first":89,"second":45,"amount":-1},{"first":89,"second":8211,"amount":-1},{"first":89,"second":44,"amount":-4},{"first":89,"second":46,"amount":-4},{"first":89,"second":125,"amount":0},{"first":89,"second":41,"amount":0},{"first":89,"second":93,"amount":0},{"first":89,"second":38,"amount":-1},{"first":89,"second":1040,"amount":-2},{"first":89,"second":1072,"amount":-1},{"first":89,"second":1075,"amount":-1},{"first":89,"second":1077,"amount":-1},{"first":89,"second":1105,"amount":-1},{"first":89,"second":1046,"amount":0},{"first":89,"second":1078,"amount":0},{"first":89,"second":1080,"amount":-1},{"first":89,"second":1081,"amount":-1},{"first":89,"second":1082,"amount":-1},{"first":89,"second":1084,"amount":-1},{"first":89,"second":1085,"amount":-1},{"first":89,"second":1054,"amount":-1},{"first":89,"second":1086,"amount":-1},{"first":89,"second":1087,"amount":-1},{"first":89,"second":1088,"amount":-1},{"first":89,"second":1057,"amount":-1},{"first":89,"second":1089,"amount":-1},{"first":89,"second":1058,"amount":0},{"first":89,"second":1091,"amount":0},{"first":89,"second":1092,"amount":-1},{"first":89,"second":1061,"amount":0},{"first":89,"second":1093,"amount":0},{"first":89,"second":1094,"amount":-1},{"first":89,"second":1096,"amount":-1},{"first":89,"second":1097,"amount":-1},{"first":89,"second":1100,"amount":-1},{"first":89,"second":1102,"amount":-1},{"first":89,"second":252,"amount":-1},{"first":89,"second":220,"amount":-2},{"first":89,"second":246,"amount":-1},{"first":89,"second":214,"amount":-1},{"first":89,"second":228,"amount":-1},{"first":89,"second":196,"amount":-2},{"first":89,"second":241,"amount":-1},{"first":89,"second":962,"amount":-1},{"first":89,"second":949,"amount":-1},{"first":89,"second":961,"amount":-1},{"first":89,"second":964,"amount":0},{"first":89,"second":965,"amount":-1},{"first":89,"second":952,"amount":0},{"first":89,"second":953,"amount":-1},{"first":89,"second":959,"amount":-1},{"first":89,"second":960,"amount":0},{"first":89,"second":945,"amount":-1},{"first":89,"second":963,"amount":-1},{"first":89,"second":948,"amount":0},{"first":89,"second":966,"amount":-1},{"first":89,"second":947,"amount":0},{"first":89,"second":951,"amount":-1},{"first":89,"second":950,"amount":0},{"first":89,"second":968,"amount":-1},{"first":89,"second":969,"amount":-1},{"first":89,"second":946,"amount":0},{"first":89,"second":957,"amount":0},{"first":89,"second":933,"amount":0},{"first":89,"second":920,"amount":-1},{"first":89,"second":927,"amount":-1},{"first":89,"second":913,"amount":-2},{"first":89,"second":916,"amount":-2},{"first":89,"second":934,"amount":-1},{"first":89,"second":923,"amount":-2},{"first":89,"second":935,"amount":0},{"first":89,"second":229,"amount":-1},{"first":89,"second":197,"amount":-2},{"first":89,"second":230,"amount":-1},{"first":89,"second":198,"amount":-2},{"first":89,"second":248,"amount":-1},{"first":89,"second":216,"amount":-1},{"first":85,"second":65,"amount":0},{"first":85,"second":1040,"amount":0},{"first":85,"second":196,"amount":0},{"first":85,"second":913,"amount":0},{"first":85,"second":916,"amount":0},{"first":85,"second":923,"amount":0},{"first":85,"second":197,"amount":0},{"first":73,"second":65,"amount":0},{"first":73,"second":84,"amount":-1},{"first":73,"second":89,"amount":-1},{"first":73,"second":88,"amount":0},{"first":73,"second":1040,"amount":0},{"first":73,"second":1044,"amount":0},{"first":73,"second":1076,"amount":0},{"first":73,"second":1046,"amount":0},{"first":73,"second":1051,"amount":0},{"first":73,"second":1083,"amount":0},{"first":73,"second":1058,"amount":-1},{"first":73,"second":1061,"amount":0},{"first":73,"second":1063,"amount":-1},{"first":73,"second":1095,"amount":-1},{"first":73,"second":196,"amount":0},{"first":73,"second":933,"amount":-1},{"first":73,"second":913,"amount":0},{"first":73,"second":916,"amount":0},{"first":73,"second":923,"amount":0},{"first":73,"second":935,"amount":0},{"first":73,"second":197,"amount":0},{"first":79,"second":65,"amount":0},{"first":79,"second":90,"amount":0},{"first":79,"second":84,"amount":-1},{"first":79,"second":89,"amount":-1},{"first":79,"second":88,"amount":0},{"first":79,"second":86,"amount":0},{"first":79,"second":44,"amount":-2},{"first":79,"second":46,"amount":-2},{"first":79,"second":1040,"amount":0},{"first":79,"second":1044,"amount":-1},{"first":79,"second":1046,"amount":0},{"first":79,"second":1051,"amount":-1},{"first":79,"second":1058,"amount":-1},{"first":79,"second":1061,"amount":0},{"first":79,"second":1068,"amount":-1},{"first":79,"second":196,"amount":0},{"first":79,"second":955,"amount":0},{"first":79,"second":933,"amount":-1},{"first":79,"second":913,"amount":0},{"first":79,"second":931,"amount":0},{"first":79,"second":916,"amount":0},{"first":79,"second":926,"amount":0},{"first":79,"second":923,"amount":0},{"first":79,"second":918,"amount":0},{"first":79,"second":935,"amount":0},{"first":79,"second":197,"amount":0},{"first":79,"second":198,"amount":-1},{"first":80,"second":97,"amount":0},{"first":80,"second":101,"amount":0},{"first":80,"second":116,"amount":0},{"first":80,"second":121,"amount":0},{"first":80,"second":111,"amount":0},{"first":80,"second":113,"amount":0},{"first":80,"second":100,"amount":0},{"first":80,"second":103,"amount":0},{"first":80,"second":99,"amount":0},{"first":80,"second":118,"amount":0},{"first":80,"second":65,"amount":-3},{"first":80,"second":90,"amount":-1},{"first":80,"second":74,"amount":-4},{"first":80,"second":88,"amount":-1},{"first":80,"second":44,"amount":-7},{"first":80,"second":46,"amount":-7},{"first":80,"second":1040,"amount":-3},{"first":80,"second":1072,"amount":0},{"first":80,"second":1044,"amount":-2},{"first":80,"second":1076,"amount":-1},{"first":80,"second":1077,"amount":0},{"first":80,"second":1105,"amount":0},{"first":80,"second":1046,"amount":-1},{"first":80,"second":1051,"amount":-1},{"first":80,"second":1083,"amount":-1},{"first":80,"second":1086,"amount":0},{"first":80,"second":1089,"amount":0},{"first":80,"second":1091,"amount":0},{"first":80,"second":1092,"amount":0},{"first":80,"second":1061,"amount":-1},{"first":80,"second":246,"amount":0},{"first":80,"second":228,"amount":0},{"first":80,"second":196,"amount":-3},{"first":80,"second":962,"amount":0},{"first":80,"second":961,"amount":-1},{"first":80,"second":959,"amount":0},{"first":80,"second":945,"amount":0},{"first":80,"second":963,"amount":0},{"first":80,"second":948,"amount":0},{"first":80,"second":947,"amount":0},{"first":80,"second":955,"amount":-1},{"first":80,"second":957,"amount":0},{"first":80,"second":913,"amount":-3},{"first":80,"second":916,"amount":-3},{"first":80,"second":923,"amount":-3},{"first":80,"second":918,"amount":-1},{"first":80,"second":935,"amount":-1},{"first":80,"second":229,"amount":0},{"first":80,"second":197,"amount":-3},{"first":80,"second":198,"amount":-2},{"first":81,"second":84,"amount":-1},{"first":81,"second":89,"amount":-1},{"first":81,"second":87,"amount":0},{"first":81,"second":86,"amount":-1},{"first":81,"second":1058,"amount":-1},{"first":81,"second":933,"amount":-1},{"first":68,"second":65,"amount":0},{"first":68,"second":90,"amount":0},{"first":68,"second":84,"amount":-1},{"first":68,"second":89,"amount":-1},{"first":68,"second":88,"amount":0},{"first":68,"second":86,"amount":0},{"first":68,"second":44,"amount":-2},{"first":68,"second":46,"amount":-2},{"first":68,"second":1040,"amount":0},{"first":68,"second":1044,"amount":-1},{"first":68,"second":1046,"amount":0},{"first":68,"second":1051,"amount":-1},{"first":68,"second":1058,"amount":-1},{"first":68,"second":1061,"amount":0},{"first":68,"second":1068,"amount":-1},{"first":68,"second":196,"amount":0},{"first":68,"second":955,"amount":0},{"first":68,"second":933,"amount":-1},{"first":68,"second":913,"amount":0},{"first":68,"second":931,"amount":0},{"first":68,"second":916,"amount":0},{"first":68,"second":926,"amount":0},{"first":68,"second":923,"amount":0},{"first":68,"second":918,"amount":0},{"first":68,"second":935,"amount":0},{"first":68,"second":197,"amount":0},{"first":68,"second":198,"amount":-1},{"first":70,"second":97,"amount":-1},{"first":70,"second":101,"amount":0},{"first":70,"second":114,"amount":-1},{"first":70,"second":121,"amount":0},{"first":70,"second":117,"amount":0},{"first":70,"second":111,"amount":0},{"first":70,"second":113,"amount":0},{"first":70,"second":100,"amount":0},{"first":70,"second":103,"amount":0},{"first":70,"second":99,"amount":0},{"first":70,"second":118,"amount":0},{"first":70,"second":65,"amount":-3},{"first":70,"second":84,"amount":0},{"first":70,"second":74,"amount":-5},{"first":70,"second":44,"amount":-5},{"first":70,"second":46,"amount":-5},{"first":70,"second":1040,"amount":-3},{"first":70,"second":1072,"amount":-1},{"first":70,"second":1077,"amount":0},{"first":70,"second":1105,"amount":0},{"first":70,"second":1086,"amount":0},{"first":70,"second":1089,"amount":0},{"first":70,"second":1058,"amount":0},{"first":70,"second":1091,"amount":0},{"first":70,"second":1092,"amount":0},{"first":70,"second":252,"amount":0},{"first":70,"second":246,"amount":0},{"first":70,"second":228,"amount":-1},{"first":70,"second":196,"amount":-3},{"first":70,"second":962,"amount":0},{"first":70,"second":965,"amount":0},{"first":70,"second":959,"amount":0},{"first":70,"second":945,"amount":0},{"first":70,"second":963,"amount":0},{"first":70,"second":947,"amount":0},{"first":70,"second":957,"amount":0},{"first":70,"second":913,"amount":-3},{"first":70,"second":916,"amount":-3},{"first":70,"second":923,"amount":-3},{"first":70,"second":229,"amount":-1},{"first":70,"second":197,"amount":-3},{"first":72,"second":65,"amount":0},{"first":72,"second":84,"amount":-1},{"first":72,"second":89,"amount":-1},{"first":72,"second":88,"amount":0},{"first":72,"second":1040,"amount":0},{"first":72,"second":1044,"amount":0},{"first":72,"second":1076,"amount":0},{"first":72,"second":1046,"amount":0},{"first":72,"second":1051,"amount":0},{"first":72,"second":1083,"amount":0},{"first":72,"second":1058,"amount":-1},{"first":72,"second":1061,"amount":0},{"first":72,"second":1063,"amount":-1},{"first":72,"second":1095,"amount":-1},{"first":72,"second":196,"amount":0},{"first":72,"second":933,"amount":-1},{"first":72,"second":913,"amount":0},{"first":72,"second":916,"amount":0},{"first":72,"second":923,"amount":0},{"first":72,"second":935,"amount":0},{"first":72,"second":197,"amount":0},{"first":74,"second":65,"amount":0},{"first":74,"second":1040,"amount":0},{"first":74,"second":196,"amount":0},{"first":74,"second":913,"amount":0},{"first":74,"second":916,"amount":0},{"first":74,"second":923,"amount":0},{"first":74,"second":197,"amount":0},{"first":75,"second":101,"amount":-1},{"first":75,"second":121,"amount":-1},{"first":75,"second":117,"amount":0},{"first":75,"second":111,"amount":-1},{"first":75,"second":112,"amount":0},{"first":75,"second":113,"amount":-1},{"first":75,"second":100,"amount":-1},{"first":75,"second":103,"amount":-1},{"first":75,"second":109,"amount":0},{"first":75,"second":119,"amount":-1},{"first":75,"second":99,"amount":-1},{"first":75,"second":118,"amount":-1},{"first":75,"second":110,"amount":0},{"first":75,"second":79,"amount":-1},{"first":75,"second":81,"amount":-1},{"first":75,"second":71,"amount":-1},{"first":75,"second":67,"amount":-1},{"first":75,"second":45,"amount":-1},{"first":75,"second":8211,"amount":-1},{"first":75,"second":1073,"amount":-1},{"first":75,"second":1075,"amount":0},{"first":75,"second":1077,"amount":-1},{"first":75,"second":1105,"amount":-1},{"first":75,"second":1080,"amount":0},{"first":75,"second":1081,"amount":0},{"first":75,"second":1082,"amount":0},{"first":75,"second":1084,"amount":0},{"first":75,"second":1085,"amount":0},{"first":75,"second":1054,"amount":-1},{"first":75,"second":1086,"amount":-1},{"first":75,"second":1087,"amount":0},{"first":75,"second":1088,"amount":0},{"first":75,"second":1057,"amount":-1},{"first":75,"second":1089,"amount":-1},{"first":75,"second":1090,"amount":-1},{"first":75,"second":1091,"amount":-1},{"first":75,"second":1092,"amount":-1},{"first":75,"second":1094,"amount":0},{"first":75,"second":1095,"amount":-2},{"first":75,"second":1096,"amount":0},{"first":75,"second":1097,"amount":0},{"first":75,"second":1100,"amount":0},{"first":75,"second":1102,"amount":0},{"first":75,"second":252,"amount":0},{"first":75,"second":246,"amount":-1},{"first":75,"second":214,"amount":-1},{"first":75,"second":241,"amount":0},{"first":75,"second":962,"amount":-1},{"first":75,"second":964,"amount":-2},{"first":75,"second":965,"amount":0},{"first":75,"second":959,"amount":-1},{"first":75,"second":945,"amount":-1},{"first":75,"second":963,"amount":-1},{"first":75,"second":947,"amount":-1},{"first":75,"second":951,"amount":0},{"first":75,"second":957,"amount":-1},{"first":75,"second":920,"amount":-1},{"first":75,"second":927,"amount":-1},{"first":75,"second":934,"amount":-1},{"first":75,"second":216,"amount":-1},{"first":76,"second":121,"amount":-3},{"first":76,"second":117,"amount":-1},{"first":76,"second":119,"amount":-2},{"first":76,"second":118,"amount":-3},{"first":76,"second":65,"amount":0},{"first":76,"second":84,"amount":-6},{"first":76,"second":89,"amount":-5},{"first":76,"second":85,"amount":-1},{"first":76,"second":79,"amount":-1},{"first":76,"second":81,"amount":-1},{"first":76,"second":71,"amount":-1},{"first":76,"second":87,"amount":-3},{"first":76,"second":67,"amount":-1},{"first":76,"second":86,"amount":-4},{"first":76,"second":34,"amount":-7},{"first":76,"second":39,"amount":-7},{"first":76,"second":1040,"amount":0},{"first":76,"second":1054,"amount":-1},{"first":76,"second":1057,"amount":-1},{"first":76,"second":1058,"amount":-6},{"first":76,"second":1091,"amount":-3},{"first":76,"second":252,"amount":-1},{"first":76,"second":220,"amount":-1},{"first":76,"second":214,"amount":-1},{"first":76,"second":196,"amount":0},{"first":76,"second":965,"amount":-1},{"first":76,"second":947,"amount":-3},{"first":76,"second":957,"amount":-3},{"first":76,"second":933,"amount":-5},{"first":76,"second":920,"amount":-1},{"first":76,"second":927,"amount":-1},{"first":76,"second":913,"amount":0},{"first":76,"second":916,"amount":0},{"first":76,"second":923,"amount":0},{"first":76,"second":197,"amount":0},{"first":76,"second":216,"amount":-1},{"first":77,"second":65,"amount":0},{"first":77,"second":84,"amount":-1},{"first":77,"second":89,"amount":-1},{"first":77,"second":88,"amount":0},{"first":77,"second":1040,"amount":0},{"first":77,"second":1044,"amount":0},{"first":77,"second":1076,"amount":0},{"first":77,"second":1046,"amount":0},{"first":77,"second":1051,"amount":0},{"first":77,"second":1083,"amount":0},{"first":77,"second":1058,"amount":-1},{"first":77,"second":1061,"amount":0},{"first":77,"second":1063,"amount":-1},{"first":77,"second":1095,"amount":-1},{"first":77,"second":196,"amount":0},{"first":77,"second":933,"amount":-1},{"first":77,"second":913,"amount":0},{"first":77,"second":916,"amount":0},{"first":77,"second":923,"amount":0},{"first":77,"second":935,"amount":0},{"first":77,"second":197,"amount":0},{"first":87,"second":97,"amount":-1},{"first":87,"second":101,"amount":-1},{"first":87,"second":114,"amount":0},{"first":87,"second":117,"amount":0},{"first":87,"second":111,"amount":-1},{"first":87,"second":113,"amount":-1},{"first":87,"second":100,"amount":-1},{"first":87,"second":103,"amount":-1},{"first":87,"second":99,"amount":-1},{"first":87,"second":65,"amount":-1},{"first":87,"second":84,"amount":0},{"first":87,"second":45,"amount":-1},{"first":87,"second":8211,"amount":-1},{"first":87,"second":44,"amount":-3},{"first":87,"second":46,"amount":-3},{"first":87,"second":125,"amount":0},{"first":87,"second":41,"amount":0},{"first":87,"second":93,"amount":0},{"first":87,"second":1040,"amount":-1},{"first":87,"second":1072,"amount":-1},{"first":87,"second":1077,"amount":-1},{"first":87,"second":1105,"amount":-1},{"first":87,"second":1086,"amount":-1},{"first":87,"second":1089,"amount":-1},{"first":87,"second":1058,"amount":0},{"first":87,"second":1092,"amount":-1},{"first":87,"second":252,"amount":0},{"first":87,"second":246,"amount":-1},{"first":87,"second":228,"amount":-1},{"first":87,"second":196,"amount":-1},{"first":87,"second":962,"amount":-1},{"first":87,"second":965,"amount":0},{"first":87,"second":959,"amount":-1},{"first":87,"second":945,"amount":-1},{"first":87,"second":963,"amount":-1},{"first":87,"second":913,"amount":-1},{"first":87,"second":916,"amount":-1},{"first":87,"second":923,"amount":-1},{"first":87,"second":229,"amount":-1},{"first":87,"second":197,"amount":-1},{"first":88,"second":101,"amount":-1},{"first":88,"second":121,"amount":-1},{"first":88,"second":117,"amount":0},{"first":88,"second":111,"amount":0},{"first":88,"second":113,"amount":-1},{"first":88,"second":100,"amount":-1},{"first":88,"second":103,"amount":-1},{"first":88,"second":99,"amount":-1},{"first":88,"second":118,"amount":-1},{"first":88,"second":79,"amount":-1},{"first":88,"second":81,"amount":-1},{"first":88,"second":71,"amount":-1},{"first":88,"second":67,"amount":-1},{"first":88,"second":86,"amount":0},{"first":88,"second":45,"amount":-1},{"first":88,"second":8211,"amount":-1},{"first":88,"second":1073,"amount":0},{"first":88,"second":1044,"amount":0},{"first":88,"second":1077,"amount":-1},{"first":88,"second":1105,"amount":-1},{"first":88,"second":1051,"amount":0},{"first":88,"second":1083,"amount":0},{"first":88,"second":1054,"amount":-1},{"first":88,"second":1086,"amount":0},{"first":88,"second":1057,"amount":-1},{"first":88,"second":1089,"amount":-1},{"first":88,"second":1090,"amount":-1},{"first":88,"second":1091,"amount":-1},{"first":88,"second":1092,"amount":-1},{"first":88,"second":1095,"amount":-1},{"first":88,"second":252,"amount":0},{"first":88,"second":246,"amount":0},{"first":88,"second":214,"amount":-1},{"first":88,"second":962,"amount":-1},{"first":88,"second":964,"amount":-1},{"first":88,"second":965,"amount":0},{"first":88,"second":952,"amount":0},{"first":88,"second":959,"amount":0},{"first":88,"second":945,"amount":-1},{"first":88,"second":963,"amount":-1},{"first":88,"second":948,"amount":0},{"first":88,"second":966,"amount":-1},{"first":88,"second":947,"amount":-1},{"first":88,"second":955,"amount":0},{"first":88,"second":968,"amount":-1},{"first":88,"second":969,"amount":0},{"first":88,"second":957,"amount":-1},{"first":88,"second":920,"amount":-1},{"first":88,"second":927,"amount":-1},{"first":88,"second":934,"amount":-1},{"first":88,"second":216,"amount":-1},{"first":67,"second":84,"amount":-1},{"first":67,"second":125,"amount":0},{"first":67,"second":41,"amount":-1},{"first":67,"second":93,"amount":0},{"first":67,"second":1058,"amount":-1},{"first":86,"second":97,"amount":-1},{"first":86,"second":101,"amount":-1},{"first":86,"second":114,"amount":-1},{"first":86,"second":121,"amount":0},{"first":86,"second":117,"amount":-1},{"first":86,"second":111,"amount":-1},{"first":86,"second":113,"amount":-1},{"first":86,"second":100,"amount":-1},{"first":86,"second":103,"amount":-1},{"first":86,"second":99,"amount":-1},{"first":86,"second":118,"amount":0},{"first":86,"second":65,"amount":-2},{"first":86,"second":79,"amount":0},{"first":86,"second":81,"amount":0},{"first":86,"second":71,"amount":0},{"first":86,"second":67,"amount":0},{"first":86,"second":45,"amount":-1},{"first":86,"second":8211,"amount":-1},{"first":86,"second":44,"amount":-5},{"first":86,"second":46,"amount":-5},{"first":86,"second":125,"amount":0},{"first":86,"second":41,"amount":0},{"first":86,"second":93,"amount":0},{"first":86,"second":1040,"amount":-2},{"first":86,"second":1072,"amount":-1},{"first":86,"second":1077,"amount":-1},{"first":86,"second":1105,"amount":-1},{"first":86,"second":1054,"amount":0},{"first":86,"second":1086,"amount":-1},{"first":86,"second":1057,"amount":0},{"first":86,"second":1089,"amount":-1},{"first":86,"second":1091,"amount":0},{"first":86,"second":1092,"amount":-1},{"first":86,"second":252,"amount":-1},{"first":86,"second":246,"amount":-1},{"first":86,"second":214,"amount":0},{"first":86,"second":228,"amount":-1},{"first":86,"second":196,"amount":-2},{"first":86,"second":962,"amount":-1},{"first":86,"second":965,"amount":-1},{"first":86,"second":959,"amount":-1},{"first":86,"second":945,"amount":-1},{"first":86,"second":963,"amount":-1},{"first":86,"second":947,"amount":0},{"first":86,"second":957,"amount":0},{"first":86,"second":920,"amount":0},{"first":86,"second":927,"amount":0},{"first":86,"second":913,"amount":-2},{"first":86,"second":916,"amount":-2},{"first":86,"second":923,"amount":-2},{"first":86,"second":229,"amount":-1},{"first":86,"second":197,"amount":-2},{"first":86,"second":216,"amount":0},{"first":66,"second":84,"amount":-1},{"first":66,"second":89,"amount":-1},{"first":66,"second":86,"amount":0},{"first":66,"second":1058,"amount":-1},{"first":66,"second":1059,"amount":0},{"first":66,"second":933,"amount":-1},{"first":78,"second":65,"amount":0},{"first":78,"second":84,"amount":-1},{"first":78,"second":89,"amount":-1},{"first":78,"second":88,"amount":0},{"first":78,"second":1040,"amount":0},{"first":78,"second":1044,"amount":0},{"first":78,"second":1076,"amount":0},{"first":78,"second":1046,"amount":0},{"first":78,"second":1051,"amount":0},{"first":78,"second":1083,"amount":0},{"first":78,"second":1058,"amount":-1},{"first":78,"second":1061,"amount":0},{"first":78,"second":1063,"amount":-1},{"first":78,"second":1095,"amount":-1},{"first":78,"second":196,"amount":0},{"first":78,"second":933,"amount":-1},{"first":78,"second":913,"amount":0},{"first":78,"second":916,"amount":0},{"first":78,"second":923,"amount":0},{"first":78,"second":935,"amount":0},{"first":78,"second":197,"amount":0},{"first":47,"second":47,"amount":-5},{"first":44,"second":34,"amount":-3},{"first":44,"second":39,"amount":-3},{"first":46,"second":34,"amount":-3},{"first":46,"second":39,"amount":-3},{"first":123,"second":85,"amount":0},{"first":123,"second":74,"amount":0},{"first":123,"second":220,"amount":0},{"first":40,"second":89,"amount":0},{"first":40,"second":87,"amount":0},{"first":40,"second":86,"amount":0},{"first":40,"second":933,"amount":0},{"first":91,"second":85,"amount":0},{"first":91,"second":74,"amount":0},{"first":91,"second":220,"amount":0},{"first":34,"second":97,"amount":-1},{"first":34,"second":101,"amount":-1},{"first":34,"second":111,"amount":-1},{"first":34,"second":112,"amount":0},{"first":34,"second":113,"amount":-1},{"first":34,"second":115,"amount":-2},{"first":34,"second":100,"amount":-1},{"first":34,"second":103,"amount":-1},{"first":34,"second":109,"amount":0},{"first":34,"second":119,"amount":0},{"first":34,"second":99,"amount":-1},{"first":34,"second":110,"amount":0},{"first":34,"second":65,"amount":-2},{"first":34,"second":34,"amount":-2},{"first":34,"second":39,"amount":-2},{"first":34,"second":1040,"amount":-2},{"first":34,"second":1072,"amount":-1},{"first":34,"second":1075,"amount":0},{"first":34,"second":1077,"amount":-1},{"first":34,"second":1105,"amount":-1},{"first":34,"second":1080,"amount":0},{"first":34,"second":1081,"amount":0},{"first":34,"second":1082,"amount":0},{"first":34,"second":1084,"amount":0},{"first":34,"second":1085,"amount":0},{"first":34,"second":1086,"amount":-1},{"first":34,"second":1087,"amount":0},{"first":34,"second":1088,"amount":0},{"first":34,"second":1089,"amount":-1},{"first":34,"second":1092,"amount":-1},{"first":34,"second":1094,"amount":0},{"first":34,"second":1096,"amount":0},{"first":34,"second":1097,"amount":0},{"first":34,"second":1100,"amount":0},{"first":34,"second":1102,"amount":0},{"first":34,"second":246,"amount":-1},{"first":34,"second":228,"amount":-1},{"first":34,"second":196,"amount":-2},{"first":34,"second":241,"amount":0},{"first":34,"second":962,"amount":-1},{"first":34,"second":959,"amount":-1},{"first":34,"second":945,"amount":-1},{"first":34,"second":963,"amount":-1},{"first":34,"second":951,"amount":0},{"first":34,"second":913,"amount":-2},{"first":34,"second":916,"amount":-2},{"first":34,"second":923,"amount":-2},{"first":34,"second":229,"amount":-1},{"first":34,"second":197,"amount":-2},{"first":39,"second":97,"amount":-1},{"first":39,"second":101,"amount":-1},{"first":39,"second":111,"amount":-1},{"first":39,"second":112,"amount":0},{"first":39,"second":113,"amount":-1},{"first":39,"second":115,"amount":-2},{"first":39,"second":100,"amount":-1},{"first":39,"second":103,"amount":-1},{"first":39,"second":109,"amount":0},{"first":39,"second":119,"amount":0},{"first":39,"second":99,"amount":-1},{"first":39,"second":110,"amount":0},{"first":39,"second":65,"amount":-2},{"first":39,"second":34,"amount":-2},{"first":39,"second":39,"amount":-2},{"first":39,"second":1040,"amount":-2},{"first":39,"second":1072,"amount":-1},{"first":39,"second":1075,"amount":0},{"first":39,"second":1077,"amount":-1},{"first":39,"second":1105,"amount":-1},{"first":39,"second":1080,"amount":0},{"first":39,"second":1081,"amount":0},{"first":39,"second":1082,"amount":0},{"first":39,"second":1084,"amount":0},{"first":39,"second":1085,"amount":0},{"first":39,"second":1086,"amount":-1},{"first":39,"second":1087,"amount":0},{"first":39,"second":1088,"amount":0},{"first":39,"second":1089,"amount":-1},{"first":39,"second":1092,"amount":-1},{"first":39,"second":1094,"amount":0},{"first":39,"second":1096,"amount":0},{"first":39,"second":1097,"amount":0},{"first":39,"second":1100,"amount":0},{"first":39,"second":1102,"amount":0},{"first":39,"second":246,"amount":-1},{"first":39,"second":228,"amount":-1},{"first":39,"second":196,"amount":-2},{"first":39,"second":241,"amount":0},{"first":39,"second":962,"amount":-1},{"first":39,"second":959,"amount":-1},{"first":39,"second":945,"amount":-1},{"first":39,"second":963,"amount":-1},{"first":39,"second":951,"amount":0},{"first":39,"second":913,"amount":-2},{"first":39,"second":916,"amount":-2},{"first":39,"second":923,"amount":-2},{"first":39,"second":229,"amount":-1},{"first":39,"second":197,"amount":-2},{"first":1040,"second":122,"amount":0},{"first":1040,"second":116,"amount":0},{"first":1040,"second":121,"amount":-1},{"first":1040,"second":117,"amount":0},{"first":1040,"second":111,"amount":0},{"first":1040,"second":119,"amount":-1},{"first":1040,"second":118,"amount":-1},{"first":1040,"second":84,"amount":-3},{"first":1040,"second":89,"amount":-2},{"first":1040,"second":85,"amount":0},{"first":1040,"second":79,"amount":0},{"first":1040,"second":81,"amount":0},{"first":1040,"second":71,"amount":0},{"first":1040,"second":87,"amount":-1},{"first":1040,"second":67,"amount":0},{"first":1040,"second":86,"amount":-2},{"first":1040,"second":63,"amount":-1},{"first":1040,"second":34,"amount":-2},{"first":1040,"second":39,"amount":-2},{"first":1040,"second":1044,"amount":0},{"first":1040,"second":1051,"amount":0},{"first":1040,"second":1083,"amount":0},{"first":1040,"second":1054,"amount":0},{"first":1040,"second":1086,"amount":0},{"first":1040,"second":1057,"amount":0},{"first":1040,"second":1058,"amount":-3},{"first":1040,"second":1090,"amount":-1},{"first":1040,"second":1091,"amount":-1},{"first":1040,"second":1063,"amount":-1},{"first":1040,"second":1095,"amount":-2},{"first":1040,"second":1068,"amount":-1},{"first":1040,"second":252,"amount":0},{"first":1040,"second":220,"amount":0},{"first":1040,"second":246,"amount":0},{"first":1040,"second":214,"amount":0},{"first":1040,"second":964,"amount":-1},{"first":1040,"second":965,"amount":0},{"first":1040,"second":959,"amount":0},{"first":1040,"second":947,"amount":-1},{"first":1040,"second":955,"amount":0},{"first":1040,"second":957,"amount":-1},{"first":1040,"second":933,"amount":-2},{"first":1040,"second":920,"amount":0},{"first":1040,"second":927,"amount":0},{"first":1040,"second":934,"amount":-1},{"first":1040,"second":936,"amount":-1},{"first":1040,"second":216,"amount":0},{"first":1072,"second":121,"amount":0},{"first":1072,"second":118,"amount":0},{"first":1072,"second":34,"amount":-1},{"first":1072,"second":39,"amount":-1},{"first":1072,"second":1090,"amount":0},{"first":1072,"second":1091,"amount":0},{"first":1072,"second":947,"amount":0},{"first":1072,"second":957,"amount":0},{"first":1041,"second":120,"amount":0},{"first":1041,"second":84,"amount":-1},{"first":1041,"second":89,"amount":-1},{"first":1041,"second":88,"amount":0},{"first":1041,"second":86,"amount":-1},{"first":1041,"second":1046,"amount":0},{"first":1041,"second":1078,"amount":0},{"first":1041,"second":1058,"amount":-1},{"first":1041,"second":1090,"amount":-1},{"first":1041,"second":1059,"amount":0},{"first":1041,"second":1061,"amount":0},{"first":1041,"second":1093,"amount":0},{"first":1041,"second":1063,"amount":0},{"first":1041,"second":1068,"amount":-1},{"first":1041,"second":933,"amount":-1},{"first":1041,"second":935,"amount":0},{"first":1073,"second":112,"amount":0},{"first":1073,"second":109,"amount":0},{"first":1073,"second":120,"amount":0},{"first":1073,"second":110,"amount":0},{"first":1073,"second":1075,"amount":0},{"first":1073,"second":1076,"amount":0},{"first":1073,"second":1078,"amount":0},{"first":1073,"second":1080,"amount":0},{"first":1073,"second":1081,"amount":0},{"first":1073,"second":1082,"amount":0},{"first":1073,"second":1084,"amount":0},{"first":1073,"second":1085,"amount":0},{"first":1073,"second":1087,"amount":0},{"first":1073,"second":1088,"amount":0},{"first":1073,"second":1090,"amount":0},{"first":1073,"second":1093,"amount":0},{"first":1073,"second":1094,"amount":0},{"first":1073,"second":1096,"amount":0},{"first":1073,"second":1097,"amount":0},{"first":1073,"second":1100,"amount":0},{"first":1073,"second":1102,"amount":0},{"first":1073,"second":241,"amount":0},{"first":1073,"second":951,"amount":0},{"first":1042,"second":84,"amount":-1},{"first":1042,"second":89,"amount":-1},{"first":1042,"second":86,"amount":0},{"first":1042,"second":1058,"amount":-1},{"first":1042,"second":1059,"amount":0},{"first":1042,"second":933,"amount":-1},{"first":1074,"second":121,"amount":0},{"first":1074,"second":118,"amount":0},{"first":1074,"second":34,"amount":0},{"first":1074,"second":39,"amount":0},{"first":1074,"second":1090,"amount":0},{"first":1074,"second":1091,"amount":0},{"first":1074,"second":947,"amount":0},{"first":1074,"second":957,"amount":0},{"first":1043,"second":97,"amount":-4},{"first":1043,"second":122,"amount":-3},{"first":1043,"second":101,"amount":-4},{"first":1043,"second":114,"amount":-3},{"first":1043,"second":121,"amount":-3},{"first":1043,"second":117,"amount":-4},{"first":1043,"second":111,"amount":-4},{"first":1043,"second":112,"amount":-4},{"first":1043,"second":113,"amount":-4},{"first":1043,"second":115,"amount":-4},{"first":1043,"second":100,"amount":-4},{"first":1043,"second":103,"amount":-4},{"first":1043,"second":109,"amount":-4},{"first":1043,"second":119,"amount":-2},{"first":1043,"second":120,"amount":-3},{"first":1043,"second":99,"amount":-4},{"first":1043,"second":118,"amount":-3},{"first":1043,"second":110,"amount":-4},{"first":1043,"second":65,"amount":-4},{"first":1043,"second":84,"amount":0},{"first":1043,"second":89,"amount":0},{"first":1043,"second":79,"amount":-1},{"first":1043,"second":81,"amount":-1},{"first":1043,"second":83,"amount":-1},{"first":1043,"second":71,"amount":-1},{"first":1043,"second":87,"amount":0},{"first":1043,"second":67,"amount":-1},{"first":1043,"second":86,"amount":0},{"first":1043,"second":45,"amount":-8},{"first":1043,"second":8211,"amount":-8},{"first":1043,"second":44,"amount":-8},{"first":1043,"second":46,"amount":-8},{"first":1043,"second":1040,"amount":-4},{"first":1043,"second":1072,"amount":-4},{"first":1043,"second":1073,"amount":-1},{"first":1043,"second":1074,"amount":-4},{"first":1043,"second":1075,"amount":-4},{"first":1043,"second":1044,"amount":-4},{"first":1043,"second":1076,"amount":-5},{"first":1043,"second":1077,"amount":-4},{"first":1043,"second":1105,"amount":-4},{"first":1043,"second":1078,"amount":-3},{"first":1043,"second":1079,"amount":-5},{"first":1043,"second":1080,"amount":-4},{"first":1043,"second":1081,"amount":-4},{"first":1043,"second":1082,"amount":-4},{"first":1043,"second":1051,"amount":-2},{"first":1043,"second":1083,"amount":-5},{"first":1043,"second":1084,"amount":-4},{"first":1043,"second":1085,"amount":-4},{"first":1043,"second":1054,"amount":-1},{"first":1043,"second":1086,"amount":-4},{"first":1043,"second":1087,"amount":-4},{"first":1043,"second":1088,"amount":-4},{"first":1043,"second":1057,"amount":-1},{"first":1043,"second":1089,"amount":-4},{"first":1043,"second":1058,"amount":0},{"first":1043,"second":1090,"amount":-3},{"first":1043,"second":1091,"amount":-3},{"first":1043,"second":1092,"amount":-4},{"first":1043,"second":1093,"amount":-3},{"first":1043,"second":1094,"amount":-4},{"first":1043,"second":1095,"amount":-5},{"first":1043,"second":1096,"amount":-4},{"first":1043,"second":1097,"amount":-4},{"first":1043,"second":1099,"amount":-5},{"first":1043,"second":1068,"amount":0},{"first":1043,"second":1100,"amount":-4},{"first":1043,"second":1101,"amount":-5},{"first":1043,"second":1102,"amount":-4},{"first":1043,"second":1103,"amount":-5},{"first":1043,"second":252,"amount":-4},{"first":1043,"second":246,"amount":-4},{"first":1043,"second":214,"amount":-1},{"first":1043,"second":228,"amount":-4},{"first":1043,"second":196,"amount":-4},{"first":1043,"second":241,"amount":-4},{"first":1043,"second":962,"amount":-4},{"first":1043,"second":949,"amount":-5},{"first":1043,"second":961,"amount":-6},{"first":1043,"second":964,"amount":-4},{"first":1043,"second":965,"amount":-4},{"first":1043,"second":953,"amount":-6},{"first":1043,"second":959,"amount":-4},{"first":1043,"second":960,"amount":-5},{"first":1043,"second":945,"amount":-4},{"first":1043,"second":963,"amount":-4},{"first":1043,"second":948,"amount":-2},{"first":1043,"second":966,"amount":-6},{"first":1043,"second":947,"amount":-3},{"first":1043,"second":951,"amount":-4},{"first":1043,"second":968,"amount":-5},{"first":1043,"second":969,"amount":-6},{"first":1043,"second":957,"amount":-3},{"first":1043,"second":933,"amount":0},{"first":1043,"second":920,"amount":-1},{"first":1043,"second":927,"amount":-1},{"first":1043,"second":913,"amount":-4},{"first":1043,"second":916,"amount":-4},{"first":1043,"second":934,"amount":-3},{"first":1043,"second":923,"amount":-4},{"first":1043,"second":229,"amount":-4},{"first":1043,"second":197,"amount":-4},{"first":1043,"second":230,"amount":-4},{"first":1043,"second":198,"amount":-7},{"first":1043,"second":248,"amount":-4},{"first":1043,"second":216,"amount":-1},{"first":1075,"second":101,"amount":0},{"first":1075,"second":111,"amount":0},{"first":1075,"second":113,"amount":0},{"first":1075,"second":100,"amount":0},{"first":1075,"second":103,"amount":0},{"first":1075,"second":99,"amount":0},{"first":1075,"second":1076,"amount":-1},{"first":1075,"second":1077,"amount":0},{"first":1075,"second":1105,"amount":0},{"first":1075,"second":1083,"amount":-1},{"first":1075,"second":1086,"amount":0},{"first":1075,"second":1089,"amount":0},{"first":1075,"second":1092,"amount":0},{"first":1075,"second":246,"amount":0},{"first":1075,"second":962,"amount":0},{"first":1075,"second":959,"amount":0},{"first":1075,"second":945,"amount":0},{"first":1075,"second":963,"amount":0},{"first":1044,"second":65,"amount":0},{"first":1044,"second":84,"amount":-1},{"first":1044,"second":89,"amount":-1},{"first":1044,"second":79,"amount":0},{"first":1044,"second":81,"amount":0},{"first":1044,"second":71,"amount":0},{"first":1044,"second":67,"amount":0},{"first":1044,"second":86,"amount":-1},{"first":1044,"second":1040,"amount":0},{"first":1044,"second":1044,"amount":0},{"first":1044,"second":1076,"amount":0},{"first":1044,"second":1051,"amount":0},{"first":1044,"second":1083,"amount":0},{"first":1044,"second":1054,"amount":0},{"first":1044,"second":1057,"amount":0},{"first":1044,"second":1058,"amount":-1},{"first":1044,"second":1063,"amount":-1},{"first":1044,"second":1095,"amount":-1},{"first":1044,"second":1068,"amount":-1},{"first":1044,"second":214,"amount":0},{"first":1044,"second":196,"amount":0},{"first":1044,"second":933,"amount":-1},{"first":1044,"second":920,"amount":0},{"first":1044,"second":927,"amount":0},{"first":1044,"second":913,"amount":0},{"first":1044,"second":916,"amount":0},{"first":1044,"second":923,"amount":0},{"first":1044,"second":197,"amount":0},{"first":1044,"second":216,"amount":0},{"first":1076,"second":1076,"amount":0},{"first":1076,"second":1090,"amount":0},{"first":1076,"second":1095,"amount":0},{"first":1076,"second":1098,"amount":-1},{"first":1045,"second":101,"amount":0},{"first":1045,"second":121,"amount":-1},{"first":1045,"second":117,"amount":0},{"first":1045,"second":111,"amount":0},{"first":1045,"second":113,"amount":0},{"first":1045,"second":100,"amount":0},{"first":1045,"second":102,"amount":0},{"first":1045,"second":103,"amount":0},{"first":1045,"second":119,"amount":0},{"first":1045,"second":99,"amount":0},{"first":1045,"second":118,"amount":-1},{"first":1045,"second":84,"amount":0},{"first":1045,"second":1077,"amount":0},{"first":1045,"second":1105,"amount":0},{"first":1045,"second":1086,"amount":0},{"first":1045,"second":1089,"amount":0},{"first":1045,"second":1058,"amount":0},{"first":1045,"second":1091,"amount":-1},{"first":1045,"second":1092,"amount":0},{"first":1045,"second":252,"amount":0},{"first":1045,"second":246,"amount":0},{"first":1045,"second":962,"amount":0},{"first":1045,"second":965,"amount":0},{"first":1045,"second":959,"amount":0},{"first":1045,"second":945,"amount":0},{"first":1045,"second":963,"amount":0},{"first":1045,"second":947,"amount":-1},{"first":1045,"second":957,"amount":-1},{"first":1077,"second":121,"amount":0},{"first":1077,"second":118,"amount":0},{"first":1077,"second":34,"amount":0},{"first":1077,"second":39,"amount":0},{"first":1077,"second":1090,"amount":0},{"first":1077,"second":1091,"amount":0},{"first":1077,"second":947,"amount":0},{"first":1077,"second":957,"amount":0},{"first":1025,"second":101,"amount":0},{"first":1025,"second":121,"amount":-1},{"first":1025,"second":117,"amount":0},{"first":1025,"second":111,"amount":0},{"first":1025,"second":113,"amount":0},{"first":1025,"second":100,"amount":0},{"first":1025,"second":102,"amount":0},{"first":1025,"second":103,"amount":0},{"first":1025,"second":119,"amount":0},{"first":1025,"second":99,"amount":0},{"first":1025,"second":118,"amount":-1},{"first":1025,"second":84,"amount":0},{"first":1025,"second":1077,"amount":0},{"first":1025,"second":1105,"amount":0},{"first":1025,"second":1086,"amount":0},{"first":1025,"second":1089,"amount":0},{"first":1025,"second":1058,"amount":0},{"first":1025,"second":1091,"amount":-1},{"first":1025,"second":1092,"amount":0},{"first":1025,"second":252,"amount":0},{"first":1025,"second":246,"amount":0},{"first":1025,"second":962,"amount":0},{"first":1025,"second":965,"amount":0},{"first":1025,"second":959,"amount":0},{"first":1025,"second":945,"amount":0},{"first":1025,"second":963,"amount":0},{"first":1025,"second":947,"amount":-1},{"first":1025,"second":957,"amount":-1},{"first":1105,"second":121,"amount":0},{"first":1105,"second":118,"amount":0},{"first":1105,"second":34,"amount":0},{"first":1105,"second":39,"amount":0},{"first":1105,"second":1090,"amount":0},{"first":1105,"second":1091,"amount":0},{"first":1105,"second":947,"amount":0},{"first":1105,"second":957,"amount":0},{"first":1046,"second":101,"amount":-1},{"first":1046,"second":121,"amount":-1},{"first":1046,"second":117,"amount":0},{"first":1046,"second":111,"amount":0},{"first":1046,"second":113,"amount":-1},{"first":1046,"second":100,"amount":-1},{"first":1046,"second":103,"amount":-1},{"first":1046,"second":99,"amount":-1},{"first":1046,"second":118,"amount":-1},{"first":1046,"second":79,"amount":-1},{"first":1046,"second":81,"amount":-1},{"first":1046,"second":71,"amount":-1},{"first":1046,"second":67,"amount":-1},{"first":1046,"second":86,"amount":0},{"first":1046,"second":45,"amount":-1},{"first":1046,"second":8211,"amount":-1},{"first":1046,"second":1073,"amount":0},{"first":1046,"second":1044,"amount":0},{"first":1046,"second":1077,"amount":-1},{"first":1046,"second":1105,"amount":-1},{"first":1046,"second":1051,"amount":0},{"first":1046,"second":1083,"amount":0},{"first":1046,"second":1054,"amount":-1},{"first":1046,"second":1086,"amount":0},{"first":1046,"second":1057,"amount":-1},{"first":1046,"second":1089,"amount":-1},{"first":1046,"second":1090,"amount":-1},{"first":1046,"second":1091,"amount":-1},{"first":1046,"second":1092,"amount":-1},{"first":1046,"second":1095,"amount":-1},{"first":1046,"second":252,"amount":0},{"first":1046,"second":246,"amount":0},{"first":1046,"second":214,"amount":-1},{"first":1046,"second":962,"amount":-1},{"first":1046,"second":964,"amount":-1},{"first":1046,"second":965,"amount":0},{"first":1046,"second":952,"amount":0},{"first":1046,"second":959,"amount":0},{"first":1046,"second":945,"amount":-1},{"first":1046,"second":963,"amount":-1},{"first":1046,"second":948,"amount":0},{"first":1046,"second":966,"amount":-1},{"first":1046,"second":947,"amount":-1},{"first":1046,"second":955,"amount":0},{"first":1046,"second":968,"amount":-1},{"first":1046,"second":969,"amount":0},{"first":1046,"second":957,"amount":-1},{"first":1046,"second":920,"amount":-1},{"first":1046,"second":927,"amount":-1},{"first":1046,"second":934,"amount":-1},{"first":1046,"second":216,"amount":-1},{"first":1078,"second":101,"amount":0},{"first":1078,"second":111,"amount":0},{"first":1078,"second":113,"amount":0},{"first":1078,"second":100,"amount":0},{"first":1078,"second":103,"amount":0},{"first":1078,"second":99,"amount":0},{"first":1078,"second":1077,"amount":0},{"first":1078,"second":1105,"amount":0},{"first":1078,"second":1086,"amount":0},{"first":1078,"second":1089,"amount":0},{"first":1078,"second":1092,"amount":0},{"first":1078,"second":246,"amount":0},{"first":1078,"second":962,"amount":0},{"first":1078,"second":959,"amount":0},{"first":1078,"second":945,"amount":0},{"first":1078,"second":963,"amount":0},{"first":1047,"second":84,"amount":0},{"first":1047,"second":89,"amount":0},{"first":1047,"second":88,"amount":0},{"first":1047,"second":86,"amount":0},{"first":1047,"second":55,"amount":0},{"first":1047,"second":1046,"amount":0},{"first":1047,"second":1051,"amount":0},{"first":1047,"second":1058,"amount":0},{"first":1047,"second":1059,"amount":0},{"first":1047,"second":1061,"amount":0},{"first":1047,"second":1068,"amount":0},{"first":1047,"second":933,"amount":0},{"first":1047,"second":935,"amount":0},{"first":1079,"second":34,"amount":0},{"first":1079,"second":39,"amount":0},{"first":1048,"second":65,"amount":0},{"first":1048,"second":84,"amount":-1},{"first":1048,"second":89,"amount":-1},{"first":1048,"second":88,"amount":0},{"first":1048,"second":1040,"amount":0},{"first":1048,"second":1044,"amount":0},{"first":1048,"second":1076,"amount":0},{"first":1048,"second":1046,"amount":0},{"first":1048,"second":1051,"amount":0},{"first":1048,"second":1083,"amount":0},{"first":1048,"second":1058,"amount":-1},{"first":1048,"second":1061,"amount":0},{"first":1048,"second":1063,"amount":-1},{"first":1048,"second":1095,"amount":-1},{"first":1048,"second":196,"amount":0},{"first":1048,"second":933,"amount":-1},{"first":1048,"second":913,"amount":0},{"first":1048,"second":916,"amount":0},{"first":1048,"second":923,"amount":0},{"first":1048,"second":935,"amount":0},{"first":1048,"second":197,"amount":0},{"first":1050,"second":101,"amount":-1},{"first":1050,"second":121,"amount":-1},{"first":1050,"second":117,"amount":0},{"first":1050,"second":111,"amount":-1},{"first":1050,"second":112,"amount":0},{"first":1050,"second":113,"amount":-1},{"first":1050,"second":100,"amount":-1},{"first":1050,"second":103,"amount":-1},{"first":1050,"second":109,"amount":0},{"first":1050,"second":119,"amount":-1},{"first":1050,"second":99,"amount":-1},{"first":1050,"second":118,"amount":-1},{"first":1050,"second":110,"amount":0},{"first":1050,"second":79,"amount":-1},{"first":1050,"second":81,"amount":-1},{"first":1050,"second":71,"amount":-1},{"first":1050,"second":67,"amount":-1},{"first":1050,"second":45,"amount":-1},{"first":1050,"second":8211,"amount":-1},{"first":1050,"second":1073,"amount":-1},{"first":1050,"second":1075,"amount":0},{"first":1050,"second":1077,"amount":-1},{"first":1050,"second":1105,"amount":-1},{"first":1050,"second":1080,"amount":0},{"first":1050,"second":1081,"amount":0},{"first":1050,"second":1082,"amount":0},{"first":1050,"second":1084,"amount":0},{"first":1050,"second":1085,"amount":0},{"first":1050,"second":1054,"amount":-1},{"first":1050,"second":1086,"amount":-1},{"first":1050,"second":1087,"amount":0},{"first":1050,"second":1088,"amount":0},{"first":1050,"second":1057,"amount":-1},{"first":1050,"second":1089,"amount":-1},{"first":1050,"second":1090,"amount":-1},{"first":1050,"second":1091,"amount":-1},{"first":1050,"second":1092,"amount":-1},{"first":1050,"second":1094,"amount":0},{"first":1050,"second":1095,"amount":-2},{"first":1050,"second":1096,"amount":0},{"first":1050,"second":1097,"amount":0},{"first":1050,"second":1100,"amount":0},{"first":1050,"second":1102,"amount":0},{"first":1050,"second":252,"amount":0},{"first":1050,"second":246,"amount":-1},{"first":1050,"second":214,"amount":-1},{"first":1050,"second":241,"amount":0},{"first":1050,"second":962,"amount":-1},{"first":1050,"second":964,"amount":-2},{"first":1050,"second":965,"amount":0},{"first":1050,"second":959,"amount":-1},{"first":1050,"second":945,"amount":-1},{"first":1050,"second":963,"amount":-1},{"first":1050,"second":947,"amount":-1},{"first":1050,"second":951,"amount":0},{"first":1050,"second":957,"amount":-1},{"first":1050,"second":920,"amount":-1},{"first":1050,"second":927,"amount":-1},{"first":1050,"second":934,"amount":-1},{"first":1050,"second":216,"amount":-1},{"first":1082,"second":101,"amount":0},{"first":1082,"second":111,"amount":0},{"first":1082,"second":113,"amount":0},{"first":1082,"second":100,"amount":0},{"first":1082,"second":103,"amount":0},{"first":1082,"second":99,"amount":0},{"first":1082,"second":1077,"amount":0},{"first":1082,"second":1105,"amount":0},{"first":1082,"second":1086,"amount":0},{"first":1082,"second":1089,"amount":0},{"first":1082,"second":1092,"amount":0},{"first":1082,"second":246,"amount":0},{"first":1082,"second":962,"amount":0},{"first":1082,"second":959,"amount":0},{"first":1082,"second":945,"amount":0},{"first":1082,"second":963,"amount":0},{"first":1051,"second":65,"amount":0},{"first":1051,"second":84,"amount":-1},{"first":1051,"second":89,"amount":-1},{"first":1051,"second":88,"amount":0},{"first":1051,"second":1040,"amount":0},{"first":1051,"second":1044,"amount":0},{"first":1051,"second":1076,"amount":0},{"first":1051,"second":1046,"amount":0},{"first":1051,"second":1051,"amount":0},{"first":1051,"second":1083,"amount":0},{"first":1051,"second":1058,"amount":-1},{"first":1051,"second":1061,"amount":0},{"first":1051,"second":1063,"amount":-1},{"first":1051,"second":1095,"amount":-1},{"first":1051,"second":196,"amount":0},{"first":1051,"second":933,"amount":-1},{"first":1051,"second":913,"amount":0},{"first":1051,"second":916,"amount":0},{"first":1051,"second":923,"amount":0},{"first":1051,"second":935,"amount":0},{"first":1051,"second":197,"amount":0},{"first":1052,"second":65,"amount":0},{"first":1052,"second":84,"amount":-1},{"first":1052,"second":89,"amount":-1},{"first":1052,"second":88,"amount":0},{"first":1052,"second":1040,"amount":0},{"first":1052,"second":1044,"amount":0},{"first":1052,"second":1076,"amount":0},{"first":1052,"second":1046,"amount":0},{"first":1052,"second":1051,"amount":0},{"first":1052,"second":1083,"amount":0},{"first":1052,"second":1058,"amount":-1},{"first":1052,"second":1061,"amount":0},{"first":1052,"second":1063,"amount":-1},{"first":1052,"second":1095,"amount":-1},{"first":1052,"second":196,"amount":0},{"first":1052,"second":933,"amount":-1},{"first":1052,"second":913,"amount":0},{"first":1052,"second":916,"amount":0},{"first":1052,"second":923,"amount":0},{"first":1052,"second":935,"amount":0},{"first":1052,"second":197,"amount":0},{"first":1053,"second":65,"amount":0},{"first":1053,"second":84,"amount":-1},{"first":1053,"second":89,"amount":-1},{"first":1053,"second":88,"amount":0},{"first":1053,"second":1040,"amount":0},{"first":1053,"second":1044,"amount":0},{"first":1053,"second":1076,"amount":0},{"first":1053,"second":1046,"amount":0},{"first":1053,"second":1051,"amount":0},{"first":1053,"second":1083,"amount":0},{"first":1053,"second":1058,"amount":-1},{"first":1053,"second":1061,"amount":0},{"first":1053,"second":1063,"amount":-1},{"first":1053,"second":1095,"amount":-1},{"first":1053,"second":196,"amount":0},{"first":1053,"second":933,"amount":-1},{"first":1053,"second":913,"amount":0},{"first":1053,"second":916,"amount":0},{"first":1053,"second":923,"amount":0},{"first":1053,"second":935,"amount":0},{"first":1053,"second":197,"amount":0},{"first":1054,"second":65,"amount":0},{"first":1054,"second":90,"amount":0},{"first":1054,"second":84,"amount":-1},{"first":1054,"second":89,"amount":-1},{"first":1054,"second":88,"amount":0},{"first":1054,"second":86,"amount":0},{"first":1054,"second":44,"amount":-2},{"first":1054,"second":46,"amount":-2},{"first":1054,"second":1040,"amount":0},{"first":1054,"second":1044,"amount":-1},{"first":1054,"second":1046,"amount":0},{"first":1054,"second":1051,"amount":-1},{"first":1054,"second":1058,"amount":-1},{"first":1054,"second":1061,"amount":0},{"first":1054,"second":1068,"amount":-1},{"first":1054,"second":196,"amount":0},{"first":1054,"second":955,"amount":0},{"first":1054,"second":933,"amount":-1},{"first":1054,"second":913,"amount":0},{"first":1054,"second":931,"amount":0},{"first":1054,"second":916,"amount":0},{"first":1054,"second":926,"amount":0},{"first":1054,"second":923,"amount":0},{"first":1054,"second":918,"amount":0},{"first":1054,"second":935,"amount":0},{"first":1054,"second":197,"amount":0},{"first":1054,"second":198,"amount":-1},{"first":1086,"second":122,"amount":0},{"first":1086,"second":121,"amount":0},{"first":1086,"second":120,"amount":0},{"first":1086,"second":118,"amount":0},{"first":1086,"second":34,"amount":-3},{"first":1086,"second":39,"amount":-3},{"first":1086,"second":1076,"amount":-1},{"first":1086,"second":1078,"amount":0},{"first":1086,"second":1083,"amount":0},{"first":1086,"second":1090,"amount":0},{"first":1086,"second":1091,"amount":0},{"first":1086,"second":1093,"amount":0},{"first":1086,"second":964,"amount":0},{"first":1086,"second":947,"amount":0},{"first":1086,"second":957,"amount":0},{"first":1056,"second":97,"amount":0},{"first":1056,"second":101,"amount":0},{"first":1056,"second":116,"amount":0},{"first":1056,"second":121,"amount":0},{"first":1056,"second":111,"amount":0},{"first":1056,"second":113,"amount":0},{"first":1056,"second":100,"amount":0},{"first":1056,"second":103,"amount":0},{"first":1056,"second":99,"amount":0},{"first":1056,"second":118,"amount":0},{"first":1056,"second":65,"amount":-3},{"first":1056,"second":90,"amount":-1},{"first":1056,"second":74,"amount":-4},{"first":1056,"second":88,"amount":-1},{"first":1056,"second":44,"amount":-7},{"first":1056,"second":46,"amount":-7},{"first":1056,"second":1040,"amount":-3},{"first":1056,"second":1072,"amount":0},{"first":1056,"second":1044,"amount":-2},{"first":1056,"second":1076,"amount":-1},{"first":1056,"second":1077,"amount":0},{"first":1056,"second":1105,"amount":0},{"first":1056,"second":1046,"amount":-1},{"first":1056,"second":1051,"amount":-1},{"first":1056,"second":1083,"amount":-1},{"first":1056,"second":1086,"amount":0},{"first":1056,"second":1089,"amount":0},{"first":1056,"second":1091,"amount":0},{"first":1056,"second":1092,"amount":0},{"first":1056,"second":1061,"amount":-1},{"first":1056,"second":246,"amount":0},{"first":1056,"second":228,"amount":0},{"first":1056,"second":196,"amount":-3},{"first":1056,"second":962,"amount":0},{"first":1056,"second":961,"amount":-1},{"first":1056,"second":959,"amount":0},{"first":1056,"second":945,"amount":0},{"first":1056,"second":963,"amount":0},{"first":1056,"second":948,"amount":0},{"first":1056,"second":947,"amount":0},{"first":1056,"second":955,"amount":-1},{"first":1056,"second":957,"amount":0},{"first":1056,"second":913,"amount":-3},{"first":1056,"second":916,"amount":-3},{"first":1056,"second":923,"amount":-3},{"first":1056,"second":918,"amount":-1},{"first":1056,"second":935,"amount":-1},{"first":1056,"second":229,"amount":0},{"first":1056,"second":197,"amount":-3},{"first":1056,"second":198,"amount":-2},{"first":1088,"second":122,"amount":0},{"first":1088,"second":121,"amount":0},{"first":1088,"second":120,"amount":0},{"first":1088,"second":118,"amount":0},{"first":1088,"second":34,"amount":-1},{"first":1088,"second":39,"amount":-1},{"first":1088,"second":1076,"amount":0},{"first":1088,"second":1078,"amount":0},{"first":1088,"second":1083,"amount":0},{"first":1088,"second":1090,"amount":-2},{"first":1088,"second":1091,"amount":0},{"first":1088,"second":1093,"amount":0},{"first":1088,"second":964,"amount":0},{"first":1088,"second":947,"amount":0},{"first":1088,"second":957,"amount":0},{"first":1057,"second":84,"amount":-1},{"first":1057,"second":125,"amount":0},{"first":1057,"second":41,"amount":-1},{"first":1057,"second":93,"amount":0},{"first":1057,"second":1058,"amount":-1},{"first":1089,"second":34,"amount":0},{"first":1089,"second":39,"amount":0},{"first":1058,"second":97,"amount":-2},{"first":1058,"second":122,"amount":-1},{"first":1058,"second":101,"amount":-2},{"first":1058,"second":114,"amount":-2},{"first":1058,"second":121,"amount":-1},{"first":1058,"second":117,"amount":-2},{"first":1058,"second":111,"amount":-2},{"first":1058,"second":112,"amount":-2},{"first":1058,"second":113,"amount":-2},{"first":1058,"second":115,"amount":-2},{"first":1058,"second":100,"amount":-2},{"first":1058,"second":103,"amount":-2},{"first":1058,"second":109,"amount":-2},{"first":1058,"second":119,"amount":-1},{"first":1058,"second":120,"amount":-2},{"first":1058,"second":99,"amount":-2},{"first":1058,"second":118,"amount":-1},{"first":1058,"second":110,"amount":-2},{"first":1058,"second":65,"amount":-2},{"first":1058,"second":84,"amount":0},{"first":1058,"second":89,"amount":0},{"first":1058,"second":79,"amount":-1},{"first":1058,"second":81,"amount":-1},{"first":1058,"second":83,"amount":0},{"first":1058,"second":71,"amount":-1},{"first":1058,"second":74,"amount":-5},{"first":1058,"second":87,"amount":0},{"first":1058,"second":67,"amount":-1},{"first":1058,"second":86,"amount":0},{"first":1058,"second":45,"amount":-5},{"first":1058,"second":8211,"amount":-5},{"first":1058,"second":44,"amount":-4},{"first":1058,"second":46,"amount":-4},{"first":1058,"second":1040,"amount":-2},{"first":1058,"second":1072,"amount":-2},{"first":1058,"second":1073,"amount":-1},{"first":1058,"second":1074,"amount":-2},{"first":1058,"second":1075,"amount":-2},{"first":1058,"second":1044,"amount":-2},{"first":1058,"second":1076,"amount":-3},{"first":1058,"second":1077,"amount":-2},{"first":1058,"second":1105,"amount":-2},{"first":1058,"second":1078,"amount":-2},{"first":1058,"second":1079,"amount":-3},{"first":1058,"second":1080,"amount":-2},{"first":1058,"second":1081,"amount":-2},{"first":1058,"second":1082,"amount":-2},{"first":1058,"second":1051,"amount":-1},{"first":1058,"second":1083,"amount":-3},{"first":1058,"second":1084,"amount":-2},{"first":1058,"second":1085,"amount":-2},{"first":1058,"second":1054,"amount":-1},{"first":1058,"second":1086,"amount":-2},{"first":1058,"second":1087,"amount":-2},{"first":1058,"second":1088,"amount":-2},{"first":1058,"second":1057,"amount":-1},{"first":1058,"second":1089,"amount":-2},{"first":1058,"second":1058,"amount":0},{"first":1058,"second":1090,"amount":-2},{"first":1058,"second":1091,"amount":-1},{"first":1058,"second":1092,"amount":-2},{"first":1058,"second":1093,"amount":-2},{"first":1058,"second":1094,"amount":-2},{"first":1058,"second":1095,"amount":-3},{"first":1058,"second":1096,"amount":-2},{"first":1058,"second":1097,"amount":-2},{"first":1058,"second":1099,"amount":-3},{"first":1058,"second":1068,"amount":0},{"first":1058,"second":1100,"amount":-2},{"first":1058,"second":1101,"amount":-3},{"first":1058,"second":1102,"amount":-2},{"first":1058,"second":1103,"amount":-3},{"first":1058,"second":252,"amount":-2},{"first":1058,"second":246,"amount":-2},{"first":1058,"second":214,"amount":-1},{"first":1058,"second":228,"amount":-2},{"first":1058,"second":196,"amount":-2},{"first":1058,"second":241,"amount":-2},{"first":1058,"second":962,"amount":-2},{"first":1058,"second":949,"amount":-3},{"first":1058,"second":961,"amount":-3},{"first":1058,"second":964,"amount":-2},{"first":1058,"second":965,"amount":-2},{"first":1058,"second":953,"amount":-3},{"first":1058,"second":959,"amount":-2},{"first":1058,"second":960,"amount":-2},{"first":1058,"second":945,"amount":-2},{"first":1058,"second":963,"amount":-2},{"first":1058,"second":948,"amount":-1},{"first":1058,"second":966,"amount":-3},{"first":1058,"second":947,"amount":-1},{"first":1058,"second":951,"amount":-2},{"first":1058,"second":968,"amount":-3},{"first":1058,"second":969,"amount":-3},{"first":1058,"second":957,"amount":-1},{"first":1058,"second":933,"amount":0},{"first":1058,"second":920,"amount":-1},{"first":1058,"second":927,"amount":-1},{"first":1058,"second":913,"amount":-2},{"first":1058,"second":916,"amount":-2},{"first":1058,"second":934,"amount":-2},{"first":1058,"second":923,"amount":-2},{"first":1058,"second":229,"amount":-2},{"first":1058,"second":197,"amount":-2},{"first":1058,"second":230,"amount":-2},{"first":1058,"second":198,"amount":-4},{"first":1058,"second":248,"amount":-2},{"first":1058,"second":216,"amount":-1},{"first":1090,"second":97,"amount":0},{"first":1090,"second":101,"amount":-2},{"first":1090,"second":121,"amount":0},{"first":1090,"second":111,"amount":-1},{"first":1090,"second":113,"amount":-2},{"first":1090,"second":100,"amount":-2},{"first":1090,"second":102,"amount":0},{"first":1090,"second":103,"amount":-2},{"first":1090,"second":99,"amount":-2},{"first":1090,"second":118,"amount":0},{"first":1090,"second":34,"amount":0},{"first":1090,"second":39,"amount":0},{"first":1090,"second":1072,"amount":0},{"first":1090,"second":1076,"amount":-2},{"first":1090,"second":1077,"amount":-2},{"first":1090,"second":1105,"amount":-2},{"first":1090,"second":1083,"amount":-2},{"first":1090,"second":1086,"amount":-1},{"first":1090,"second":1089,"amount":-2},{"first":1090,"second":1091,"amount":0},{"first":1090,"second":1092,"amount":-2},{"first":1090,"second":246,"amount":-1},{"first":1090,"second":228,"amount":0},{"first":1090,"second":962,"amount":-1},{"first":1090,"second":961,"amount":-2},{"first":1090,"second":959,"amount":-1},{"first":1090,"second":945,"amount":-2},{"first":1090,"second":963,"amount":-2},{"first":1090,"second":948,"amount":-2},{"first":1090,"second":966,"amount":-1},{"first":1090,"second":947,"amount":0},{"first":1090,"second":957,"amount":0},{"first":1090,"second":229,"amount":0},{"first":1059,"second":97,"amount":-2},{"first":1059,"second":101,"amount":-1},{"first":1059,"second":111,"amount":-1},{"first":1059,"second":112,"amount":-2},{"first":1059,"second":113,"amount":-1},{"first":1059,"second":115,"amount":-1},{"first":1059,"second":100,"amount":-1},{"first":1059,"second":103,"amount":-1},{"first":1059,"second":109,"amount":-2},{"first":1059,"second":99,"amount":-1},{"first":1059,"second":110,"amount":-2},{"first":1059,"second":65,"amount":-2},{"first":1059,"second":84,"amount":0},{"first":1059,"second":89,"amount":0},{"first":1059,"second":79,"amount":0},{"first":1059,"second":81,"amount":0},{"first":1059,"second":71,"amount":0},{"first":1059,"second":67,"amount":0},{"first":1059,"second":45,"amount":-2},{"first":1059,"second":8211,"amount":-2},{"first":1059,"second":44,"amount":-8},{"first":1059,"second":46,"amount":-8},{"first":1059,"second":1040,"amount":-2},{"first":1059,"second":1072,"amount":-2},{"first":1059,"second":1074,"amount":-1},{"first":1059,"second":1075,"amount":-2},{"first":1059,"second":1044,"amount":-2},{"first":1059,"second":1076,"amount":-2},{"first":1059,"second":1077,"amount":-1},{"first":1059,"second":1105,"amount":-1},{"first":1059,"second":1079,"amount":-1},{"first":1059,"second":1080,"amount":-2},{"first":1059,"second":1081,"amount":-2},{"first":1059,"second":1082,"amount":-2},{"first":1059,"second":1051,"amount":-1},{"first":1059,"second":1083,"amount":-1},{"first":1059,"second":1084,"amount":-2},{"first":1059,"second":1085,"amount":-2},{"first":1059,"second":1054,"amount":0},{"first":1059,"second":1086,"amount":-1},{"first":1059,"second":1087,"amount":-2},{"first":1059,"second":1088,"amount":-2},{"first":1059,"second":1057,"amount":0},{"first":1059,"second":1089,"amount":-1},{"first":1059,"second":1058,"amount":0},{"first":1059,"second":1092,"amount":-1},{"first":1059,"second":1094,"amount":-2},{"first":1059,"second":1095,"amount":0},{"first":1059,"second":1096,"amount":-2},{"first":1059,"second":1097,"amount":-2},{"first":1059,"second":1099,"amount":-1},{"first":1059,"second":1068,"amount":0},{"first":1059,"second":1100,"amount":-2},{"first":1059,"second":1102,"amount":-2},{"first":1059,"second":1103,"amount":-1},{"first":1059,"second":246,"amount":-1},{"first":1059,"second":214,"amount":0},{"first":1059,"second":228,"amount":-2},{"first":1059,"second":196,"amount":-2},{"first":1059,"second":241,"amount":-2},{"first":1059,"second":962,"amount":-1},{"first":1059,"second":959,"amount":-1},{"first":1059,"second":945,"amount":-1},{"first":1059,"second":963,"amount":-1},{"first":1059,"second":951,"amount":-2},{"first":1059,"second":933,"amount":0},{"first":1059,"second":920,"amount":0},{"first":1059,"second":927,"amount":0},{"first":1059,"second":913,"amount":-2},{"first":1059,"second":916,"amount":-2},{"first":1059,"second":923,"amount":-2},{"first":1059,"second":229,"amount":-2},{"first":1059,"second":197,"amount":-2},{"first":1059,"second":216,"amount":0},{"first":1091,"second":97,"amount":0},{"first":1091,"second":101,"amount":0},{"first":1091,"second":111,"amount":0},{"first":1091,"second":113,"amount":0},{"first":1091,"second":100,"amount":0},{"first":1091,"second":102,"amount":0},{"first":1091,"second":103,"amount":0},{"first":1091,"second":99,"amount":0},{"first":1091,"second":44,"amount":-2},{"first":1091,"second":46,"amount":-2},{"first":1091,"second":34,"amount":0},{"first":1091,"second":39,"amount":0},{"first":1091,"second":1072,"amount":0},{"first":1091,"second":1076,"amount":-1},{"first":1091,"second":1077,"amount":0},{"first":1091,"second":1105,"amount":0},{"first":1091,"second":1083,"amount":-1},{"first":1091,"second":1086,"amount":0},{"first":1091,"second":1089,"amount":0},{"first":1091,"second":1092,"amount":0},{"first":1091,"second":246,"amount":0},{"first":1091,"second":228,"amount":0},{"first":1091,"second":962,"amount":0},{"first":1091,"second":961,"amount":0},{"first":1091,"second":964,"amount":0},{"first":1091,"second":959,"amount":0},{"first":1091,"second":960,"amount":0},{"first":1091,"second":945,"amount":0},{"first":1091,"second":963,"amount":0},{"first":1091,"second":948,"amount":0},{"first":1091,"second":229,"amount":0},{"first":1092,"second":122,"amount":0},{"first":1092,"second":121,"amount":0},{"first":1092,"second":120,"amount":0},{"first":1092,"second":118,"amount":0},{"first":1092,"second":34,"amount":-1},{"first":1092,"second":39,"amount":-1},{"first":1092,"second":1076,"amount":0},{"first":1092,"second":1078,"amount":0},{"first":1092,"second":1083,"amount":0},{"first":1092,"second":1090,"amount":-2},{"first":1092,"second":1091,"amount":0},{"first":1092,"second":1093,"amount":0},{"first":1092,"second":964,"amount":0},{"first":1092,"second":947,"amount":0},{"first":1092,"second":957,"amount":0},{"first":1061,"second":101,"amount":-1},{"first":1061,"second":121,"amount":-1},{"first":1061,"second":117,"amount":0},{"first":1061,"second":111,"amount":0},{"first":1061,"second":113,"amount":-1},{"first":1061,"second":100,"amount":-1},{"first":1061,"second":103,"amount":-1},{"first":1061,"second":99,"amount":-1},{"first":1061,"second":118,"amount":-1},{"first":1061,"second":79,"amount":-1},{"first":1061,"second":81,"amount":-1},{"first":1061,"second":71,"amount":-1},{"first":1061,"second":67,"amount":-1},{"first":1061,"second":86,"amount":0},{"first":1061,"second":45,"amount":-1},{"first":1061,"second":8211,"amount":-1},{"first":1061,"second":1073,"amount":0},{"first":1061,"second":1044,"amount":0},{"first":1061,"second":1077,"amount":-1},{"first":1061,"second":1105,"amount":-1},{"first":1061,"second":1051,"amount":0},{"first":1061,"second":1083,"amount":0},{"first":1061,"second":1054,"amount":-1},{"first":1061,"second":1086,"amount":0},{"first":1061,"second":1057,"amount":-1},{"first":1061,"second":1089,"amount":-1},{"first":1061,"second":1090,"amount":-1},{"first":1061,"second":1091,"amount":-1},{"first":1061,"second":1092,"amount":-1},{"first":1061,"second":1095,"amount":-1},{"first":1061,"second":252,"amount":0},{"first":1061,"second":246,"amount":0},{"first":1061,"second":214,"amount":-1},{"first":1061,"second":962,"amount":-1},{"first":1061,"second":964,"amount":-1},{"first":1061,"second":965,"amount":0},{"first":1061,"second":952,"amount":0},{"first":1061,"second":959,"amount":0},{"first":1061,"second":945,"amount":-1},{"first":1061,"second":963,"amount":-1},{"first":1061,"second":948,"amount":0},{"first":1061,"second":966,"amount":-1},{"first":1061,"second":947,"amount":-1},{"first":1061,"second":955,"amount":0},{"first":1061,"second":968,"amount":-1},{"first":1061,"second":969,"amount":0},{"first":1061,"second":957,"amount":-1},{"first":1061,"second":920,"amount":-1},{"first":1061,"second":927,"amount":-1},{"first":1061,"second":934,"amount":-1},{"first":1061,"second":216,"amount":-1},{"first":1093,"second":101,"amount":0},{"first":1093,"second":111,"amount":0},{"first":1093,"second":113,"amount":0},{"first":1093,"second":100,"amount":0},{"first":1093,"second":103,"amount":0},{"first":1093,"second":99,"amount":0},{"first":1093,"second":1077,"amount":0},{"first":1093,"second":1105,"amount":0},{"first":1093,"second":1086,"amount":0},{"first":1093,"second":1089,"amount":0},{"first":1093,"second":1092,"amount":0},{"first":1093,"second":246,"amount":0},{"first":1093,"second":962,"amount":0},{"first":1093,"second":959,"amount":0},{"first":1093,"second":945,"amount":0},{"first":1093,"second":963,"amount":0},{"first":1062,"second":65,"amount":0},{"first":1062,"second":84,"amount":-1},{"first":1062,"second":89,"amount":-1},{"first":1062,"second":88,"amount":0},{"first":1062,"second":1040,"amount":0},{"first":1062,"second":1044,"amount":0},{"first":1062,"second":1076,"amount":0},{"first":1062,"second":1046,"amount":0},{"first":1062,"second":1051,"amount":0},{"first":1062,"second":1083,"amount":0},{"first":1062,"second":1058,"amount":-1},{"first":1062,"second":1061,"amount":0},{"first":1062,"second":1063,"amount":-1},{"first":1062,"second":1095,"amount":-1},{"first":1062,"second":196,"amount":0},{"first":1062,"second":933,"amount":-1},{"first":1062,"second":913,"amount":0},{"first":1062,"second":916,"amount":0},{"first":1062,"second":923,"amount":0},{"first":1062,"second":935,"amount":0},{"first":1062,"second":197,"amount":0},{"first":1094,"second":1076,"amount":0},{"first":1094,"second":1083,"amount":0},{"first":1094,"second":1090,"amount":0},{"first":1094,"second":1095,"amount":0},{"first":1094,"second":1103,"amount":0},{"first":1063,"second":65,"amount":0},{"first":1063,"second":84,"amount":-1},{"first":1063,"second":89,"amount":-1},{"first":1063,"second":88,"amount":0},{"first":1063,"second":1040,"amount":0},{"first":1063,"second":1044,"amount":0},{"first":1063,"second":1076,"amount":0},{"first":1063,"second":1046,"amount":0},{"first":1063,"second":1051,"amount":0},{"first":1063,"second":1083,"amount":0},{"first":1063,"second":1058,"amount":-1},{"first":1063,"second":1061,"amount":0},{"first":1063,"second":1063,"amount":-1},{"first":1063,"second":1095,"amount":-1},{"first":1063,"second":196,"amount":0},{"first":1063,"second":933,"amount":-1},{"first":1063,"second":913,"amount":0},{"first":1063,"second":916,"amount":0},{"first":1063,"second":923,"amount":0},{"first":1063,"second":935,"amount":0},{"first":1063,"second":197,"amount":0},{"first":1064,"second":65,"amount":0},{"first":1064,"second":84,"amount":-1},{"first":1064,"second":89,"amount":-1},{"first":1064,"second":88,"amount":0},{"first":1064,"second":1040,"amount":0},{"first":1064,"second":1044,"amount":0},{"first":1064,"second":1076,"amount":0},{"first":1064,"second":1046,"amount":0},{"first":1064,"second":1051,"amount":0},{"first":1064,"second":1083,"amount":0},{"first":1064,"second":1058,"amount":-1},{"first":1064,"second":1061,"amount":0},{"first":1064,"second":1063,"amount":-1},{"first":1064,"second":1095,"amount":-1},{"first":1064,"second":196,"amount":0},{"first":1064,"second":933,"amount":-1},{"first":1064,"second":913,"amount":0},{"first":1064,"second":916,"amount":0},{"first":1064,"second":923,"amount":0},{"first":1064,"second":935,"amount":0},{"first":1064,"second":197,"amount":0},{"first":1065,"second":65,"amount":0},{"first":1065,"second":84,"amount":-1},{"first":1065,"second":89,"amount":-1},{"first":1065,"second":88,"amount":0},{"first":1065,"second":86,"amount":-1},{"first":1065,"second":1040,"amount":0},{"first":1065,"second":1044,"amount":0},{"first":1065,"second":1076,"amount":0},{"first":1065,"second":1046,"amount":0},{"first":1065,"second":1051,"amount":0},{"first":1065,"second":1083,"amount":0},{"first":1065,"second":1058,"amount":-1},{"first":1065,"second":1090,"amount":-1},{"first":1065,"second":1059,"amount":0},{"first":1065,"second":1061,"amount":0},{"first":1065,"second":1063,"amount":-1},{"first":1065,"second":1095,"amount":0},{"first":1065,"second":1068,"amount":-1},{"first":1065,"second":1069,"amount":0},{"first":1065,"second":196,"amount":0},{"first":1065,"second":933,"amount":-1},{"first":1065,"second":913,"amount":0},{"first":1065,"second":916,"amount":0},{"first":1065,"second":923,"amount":0},{"first":1065,"second":935,"amount":0},{"first":1065,"second":197,"amount":0},{"first":1097,"second":101,"amount":0},{"first":1097,"second":113,"amount":0},{"first":1097,"second":100,"amount":0},{"first":1097,"second":103,"amount":0},{"first":1097,"second":99,"amount":0},{"first":1097,"second":1076,"amount":1},{"first":1097,"second":1077,"amount":0},{"first":1097,"second":1105,"amount":0},{"first":1097,"second":1083,"amount":0},{"first":1097,"second":1089,"amount":0},{"first":1097,"second":1090,"amount":-1},{"first":1097,"second":1092,"amount":0},{"first":1097,"second":1095,"amount":0},{"first":1097,"second":962,"amount":0},{"first":1097,"second":945,"amount":0},{"first":1097,"second":963,"amount":0},{"first":1066,"second":120,"amount":-1},{"first":1066,"second":84,"amount":-5},{"first":1066,"second":89,"amount":-2},{"first":1066,"second":88,"amount":0},{"first":1066,"second":86,"amount":-1},{"first":1066,"second":34,"amount":-1},{"first":1066,"second":39,"amount":-1},{"first":1066,"second":1046,"amount":0},{"first":1066,"second":1078,"amount":-1},{"first":1066,"second":1051,"amount":0},{"first":1066,"second":1058,"amount":-5},{"first":1066,"second":1090,"amount":-1},{"first":1066,"second":1059,"amount":0},{"first":1066,"second":1061,"amount":0},{"first":1066,"second":1093,"amount":-1},{"first":1066,"second":1063,"amount":-1},{"first":1066,"second":1068,"amount":-1},{"first":1066,"second":933,"amount":-2},{"first":1066,"second":935,"amount":0},{"first":1098,"second":121,"amount":-1},{"first":1098,"second":120,"amount":0},{"first":1098,"second":118,"amount":-1},{"first":1098,"second":34,"amount":-3},{"first":1098,"second":39,"amount":-3},{"first":1098,"second":1078,"amount":0},{"first":1098,"second":1090,"amount":-1},{"first":1098,"second":1091,"amount":-1},{"first":1098,"second":1093,"amount":0},{"first":1098,"second":1095,"amount":-1},{"first":1098,"second":947,"amount":-1},{"first":1098,"second":957,"amount":-1},{"first":1067,"second":65,"amount":0},{"first":1067,"second":84,"amount":-1},{"first":1067,"second":89,"amount":-1},{"first":1067,"second":88,"amount":0},{"first":1067,"second":1040,"amount":0},{"first":1067,"second":1044,"amount":0},{"first":1067,"second":1076,"amount":0},{"first":1067,"second":1046,"amount":0},{"first":1067,"second":1051,"amount":0},{"first":1067,"second":1083,"amount":0},{"first":1067,"second":1058,"amount":-1},{"first":1067,"second":1061,"amount":0},{"first":1067,"second":1063,"amount":-1},{"first":1067,"second":1095,"amount":-1},{"first":1067,"second":196,"amount":0},{"first":1067,"second":933,"amount":-1},{"first":1067,"second":913,"amount":0},{"first":1067,"second":916,"amount":0},{"first":1067,"second":923,"amount":0},{"first":1067,"second":935,"amount":0},{"first":1067,"second":197,"amount":0},{"first":1068,"second":120,"amount":-1},{"first":1068,"second":84,"amount":-5},{"first":1068,"second":89,"amount":-2},{"first":1068,"second":88,"amount":0},{"first":1068,"second":86,"amount":-1},{"first":1068,"second":34,"amount":-1},{"first":1068,"second":39,"amount":-1},{"first":1068,"second":1046,"amount":0},{"first":1068,"second":1078,"amount":-1},{"first":1068,"second":1051,"amount":0},{"first":1068,"second":1058,"amount":-5},{"first":1068,"second":1090,"amount":-1},{"first":1068,"second":1059,"amount":0},{"first":1068,"second":1061,"amount":0},{"first":1068,"second":1093,"amount":-1},{"first":1068,"second":1063,"amount":-1},{"first":1068,"second":1068,"amount":-1},{"first":1068,"second":933,"amount":-2},{"first":1068,"second":935,"amount":0},{"first":1100,"second":121,"amount":-1},{"first":1100,"second":120,"amount":0},{"first":1100,"second":118,"amount":-1},{"first":1100,"second":34,"amount":-3},{"first":1100,"second":39,"amount":-3},{"first":1100,"second":1078,"amount":0},{"first":1100,"second":1090,"amount":-1},{"first":1100,"second":1091,"amount":-1},{"first":1100,"second":1093,"amount":0},{"first":1100,"second":1095,"amount":-1},{"first":1100,"second":947,"amount":-1},{"first":1100,"second":957,"amount":-1},{"first":1069,"second":84,"amount":-1},{"first":1069,"second":89,"amount":-1},{"first":1069,"second":88,"amount":-1},{"first":1069,"second":1044,"amount":-1},{"first":1069,"second":1046,"amount":-1},{"first":1069,"second":1051,"amount":-1},{"first":1069,"second":1083,"amount":0},{"first":1069,"second":1058,"amount":-1},{"first":1069,"second":1059,"amount":0},{"first":1069,"second":1061,"amount":-1},{"first":1069,"second":933,"amount":-1},{"first":1069,"second":935,"amount":-1},{"first":1101,"second":122,"amount":0},{"first":1101,"second":121,"amount":0},{"first":1101,"second":120,"amount":0},{"first":1101,"second":118,"amount":0},{"first":1101,"second":34,"amount":-1},{"first":1101,"second":39,"amount":-1},{"first":1101,"second":1076,"amount":0},{"first":1101,"second":1078,"amount":0},{"first":1101,"second":1083,"amount":0},{"first":1101,"second":1090,"amount":-2},{"first":1101,"second":1091,"amount":0},{"first":1101,"second":1093,"amount":0},{"first":1101,"second":964,"amount":0},{"first":1101,"second":947,"amount":0},{"first":1101,"second":957,"amount":0},{"first":1070,"second":84,"amount":-1},{"first":1070,"second":88,"amount":-1},{"first":1070,"second":1044,"amount":-1},{"first":1070,"second":1076,"amount":-1},{"first":1070,"second":1046,"amount":-1},{"first":1070,"second":1051,"amount":-1},{"first":1070,"second":1083,"amount":0},{"first":1070,"second":1058,"amount":-1},{"first":1070,"second":1059,"amount":0},{"first":1070,"second":1061,"amount":-1},{"first":1070,"second":935,"amount":-1},{"first":1102,"second":121,"amount":0},{"first":1102,"second":120,"amount":0},{"first":1102,"second":118,"amount":0},{"first":1102,"second":1076,"amount":0},{"first":1102,"second":1078,"amount":0},{"first":1102,"second":1083,"amount":0},{"first":1102,"second":1091,"amount":0},{"first":1102,"second":1093,"amount":0},{"first":1102,"second":947,"amount":0},{"first":1102,"second":957,"amount":0},{"first":1071,"second":84,"amount":0},{"first":1071,"second":89,"amount":0},{"first":1071,"second":1058,"amount":0},{"first":1071,"second":933,"amount":0},{"first":220,"second":65,"amount":0},{"first":220,"second":1040,"amount":0},{"first":220,"second":196,"amount":0},{"first":220,"second":913,"amount":0},{"first":220,"second":916,"amount":0},{"first":220,"second":923,"amount":0},{"first":220,"second":197,"amount":0},{"first":246,"second":122,"amount":0},{"first":246,"second":121,"amount":0},{"first":246,"second":120,"amount":0},{"first":246,"second":118,"amount":0},{"first":246,"second":34,"amount":-3},{"first":246,"second":39,"amount":-3},{"first":246,"second":1076,"amount":-1},{"first":246,"second":1078,"amount":0},{"first":246,"second":1083,"amount":0},{"first":246,"second":1090,"amount":0},{"first":246,"second":1091,"amount":0},{"first":246,"second":1093,"amount":0},{"first":246,"second":964,"amount":0},{"first":246,"second":947,"amount":0},{"first":246,"second":957,"amount":0},{"first":214,"second":65,"amount":0},{"first":214,"second":90,"amount":0},{"first":214,"second":84,"amount":-1},{"first":214,"second":89,"amount":-1},{"first":214,"second":88,"amount":0},{"first":214,"second":86,"amount":0},{"first":214,"second":44,"amount":-2},{"first":214,"second":46,"amount":-2},{"first":214,"second":1040,"amount":0},{"first":214,"second":1044,"amount":-1},{"first":214,"second":1046,"amount":0},{"first":214,"second":1051,"amount":-1},{"first":214,"second":1058,"amount":-1},{"first":214,"second":1061,"amount":0},{"first":214,"second":1068,"amount":-1},{"first":214,"second":196,"amount":0},{"first":214,"second":955,"amount":0},{"first":214,"second":933,"amount":-1},{"first":214,"second":913,"amount":0},{"first":214,"second":931,"amount":0},{"first":214,"second":916,"amount":0},{"first":214,"second":926,"amount":0},{"first":214,"second":923,"amount":0},{"first":214,"second":918,"amount":0},{"first":214,"second":935,"amount":0},{"first":214,"second":197,"amount":0},{"first":214,"second":198,"amount":-1},{"first":228,"second":121,"amount":0},{"first":228,"second":118,"amount":0},{"first":228,"second":34,"amount":-1},{"first":228,"second":39,"amount":-1},{"first":228,"second":1090,"amount":0},{"first":228,"second":1091,"amount":0},{"first":228,"second":947,"amount":0},{"first":228,"second":957,"amount":0},{"first":196,"second":122,"amount":0},{"first":196,"second":116,"amount":0},{"first":196,"second":121,"amount":-1},{"first":196,"second":117,"amount":0},{"first":196,"second":111,"amount":0},{"first":196,"second":119,"amount":-1},{"first":196,"second":118,"amount":-1},{"first":196,"second":84,"amount":-3},{"first":196,"second":89,"amount":-2},{"first":196,"second":85,"amount":0},{"first":196,"second":79,"amount":0},{"first":196,"second":81,"amount":0},{"first":196,"second":71,"amount":0},{"first":196,"second":87,"amount":-1},{"first":196,"second":67,"amount":0},{"first":196,"second":86,"amount":-2},{"first":196,"second":63,"amount":-1},{"first":196,"second":34,"amount":-2},{"first":196,"second":39,"amount":-2},{"first":196,"second":1044,"amount":0},{"first":196,"second":1051,"amount":0},{"first":196,"second":1083,"amount":0},{"first":196,"second":1054,"amount":0},{"first":196,"second":1086,"amount":0},{"first":196,"second":1057,"amount":0},{"first":196,"second":1058,"amount":-3},{"first":196,"second":1090,"amount":-1},{"first":196,"second":1091,"amount":-1},{"first":196,"second":1063,"amount":-1},{"first":196,"second":1095,"amount":-2},{"first":196,"second":1068,"amount":-1},{"first":196,"second":252,"amount":0},{"first":196,"second":220,"amount":0},{"first":196,"second":246,"amount":0},{"first":196,"second":214,"amount":0},{"first":196,"second":964,"amount":-1},{"first":196,"second":965,"amount":0},{"first":196,"second":959,"amount":0},{"first":196,"second":947,"amount":-1},{"first":196,"second":955,"amount":0},{"first":196,"second":957,"amount":-1},{"first":196,"second":933,"amount":-2},{"first":196,"second":920,"amount":0},{"first":196,"second":927,"amount":0},{"first":196,"second":934,"amount":-1},{"first":196,"second":936,"amount":-1},{"first":196,"second":216,"amount":0},{"first":241,"second":34,"amount":-2},{"first":241,"second":39,"amount":-2},{"first":241,"second":1090,"amount":-1},{"first":209,"second":65,"amount":0},{"first":209,"second":84,"amount":-1},{"first":209,"second":89,"amount":-1},{"first":209,"second":88,"amount":0},{"first":209,"second":1040,"amount":0},{"first":209,"second":1044,"amount":0},{"first":209,"second":1076,"amount":0},{"first":209,"second":1046,"amount":0},{"first":209,"second":1051,"amount":0},{"first":209,"second":1083,"amount":0},{"first":209,"second":1058,"amount":-1},{"first":209,"second":1061,"amount":0},{"first":209,"second":1063,"amount":-1},{"first":209,"second":1095,"amount":-1},{"first":209,"second":196,"amount":0},{"first":209,"second":933,"amount":-1},{"first":209,"second":913,"amount":0},{"first":209,"second":916,"amount":0},{"first":209,"second":923,"amount":0},{"first":209,"second":935,"amount":0},{"first":209,"second":197,"amount":0},{"first":962,"second":1090,"amount":-1},{"first":961,"second":122,"amount":0},{"first":961,"second":121,"amount":0},{"first":961,"second":120,"amount":0},{"first":961,"second":118,"amount":0},{"first":961,"second":34,"amount":-1},{"first":961,"second":39,"amount":-1},{"first":961,"second":1076,"amount":0},{"first":961,"second":1078,"amount":0},{"first":961,"second":1083,"amount":0},{"first":961,"second":1090,"amount":-2},{"first":961,"second":1091,"amount":0},{"first":961,"second":1093,"amount":0},{"first":961,"second":964,"amount":0},{"first":961,"second":947,"amount":0},{"first":961,"second":957,"amount":0},{"first":964,"second":101,"amount":0},{"first":964,"second":121,"amount":0},{"first":964,"second":111,"amount":0},{"first":964,"second":113,"amount":0},{"first":964,"second":100,"amount":0},{"first":964,"second":102,"amount":0},{"first":964,"second":103,"amount":0},{"first":964,"second":99,"amount":0},{"first":964,"second":118,"amount":0},{"first":964,"second":34,"amount":0},{"first":964,"second":39,"amount":0},{"first":964,"second":1077,"amount":0},{"first":964,"second":1105,"amount":0},{"first":964,"second":1086,"amount":0},{"first":964,"second":1089,"amount":0},{"first":964,"second":1091,"amount":0},{"first":964,"second":1092,"amount":0},{"first":964,"second":246,"amount":0},{"first":964,"second":962,"amount":0},{"first":964,"second":964,"amount":0},{"first":964,"second":959,"amount":0},{"first":964,"second":960,"amount":0},{"first":964,"second":945,"amount":0},{"first":964,"second":963,"amount":0},{"first":964,"second":948,"amount":0},{"first":964,"second":947,"amount":0},{"first":964,"second":957,"amount":0},{"first":965,"second":1090,"amount":-1},{"first":953,"second":101,"amount":0},{"first":953,"second":121,"amount":-1},{"first":953,"second":117,"amount":0},{"first":953,"second":113,"amount":0},{"first":953,"second":100,"amount":0},{"first":953,"second":103,"amount":0},{"first":953,"second":99,"amount":0},{"first":953,"second":118,"amount":-1},{"first":953,"second":34,"amount":-1},{"first":953,"second":39,"amount":-1},{"first":953,"second":1077,"amount":0},{"first":953,"second":1105,"amount":0},{"first":953,"second":1089,"amount":0},{"first":953,"second":1091,"amount":-1},{"first":953,"second":1092,"amount":0},{"first":953,"second":252,"amount":0},{"first":953,"second":962,"amount":0},{"first":953,"second":964,"amount":-1},{"first":953,"second":965,"amount":0},{"first":953,"second":952,"amount":0},{"first":953,"second":960,"amount":0},{"first":953,"second":945,"amount":0},{"first":953,"second":963,"amount":0},{"first":953,"second":966,"amount":-1},{"first":953,"second":947,"amount":-1},{"first":953,"second":955,"amount":0},{"first":953,"second":957,"amount":-1},{"first":959,"second":122,"amount":0},{"first":959,"second":121,"amount":0},{"first":959,"second":120,"amount":0},{"first":959,"second":118,"amount":0},{"first":959,"second":34,"amount":-3},{"first":959,"second":39,"amount":-3},{"first":959,"second":1076,"amount":-1},{"first":959,"second":1078,"amount":0},{"first":959,"second":1083,"amount":0},{"first":959,"second":1090,"amount":0},{"first":959,"second":1091,"amount":0},{"first":959,"second":1093,"amount":0},{"first":959,"second":964,"amount":0},{"first":959,"second":947,"amount":0},{"first":959,"second":957,"amount":0},{"first":945,"second":955,"amount":0},{"first":963,"second":964,"amount":0},{"first":948,"second":1090,"amount":-1},{"first":948,"second":964,"amount":0},{"first":966,"second":122,"amount":0},{"first":966,"second":120,"amount":0},{"first":966,"second":1078,"amount":0},{"first":966,"second":1090,"amount":-2},{"first":966,"second":1093,"amount":0},{"first":947,"second":97,"amount":0},{"first":947,"second":101,"amount":0},{"first":947,"second":111,"amount":0},{"first":947,"second":113,"amount":0},{"first":947,"second":100,"amount":0},{"first":947,"second":102,"amount":0},{"first":947,"second":103,"amount":0},{"first":947,"second":99,"amount":0},{"first":947,"second":44,"amount":-2},{"first":947,"second":46,"amount":-2},{"first":947,"second":34,"amount":0},{"first":947,"second":39,"amount":0},{"first":947,"second":1072,"amount":0},{"first":947,"second":1076,"amount":-1},{"first":947,"second":1077,"amount":0},{"first":947,"second":1105,"amount":0},{"first":947,"second":1083,"amount":-1},{"first":947,"second":1086,"amount":0},{"first":947,"second":1089,"amount":0},{"first":947,"second":1092,"amount":0},{"first":947,"second":246,"amount":0},{"first":947,"second":228,"amount":0},{"first":947,"second":962,"amount":0},{"first":947,"second":961,"amount":0},{"first":947,"second":964,"amount":0},{"first":947,"second":959,"amount":0},{"first":947,"second":960,"amount":0},{"first":947,"second":945,"amount":0},{"first":947,"second":963,"amount":0},{"first":947,"second":948,"amount":0},{"first":947,"second":229,"amount":0},{"first":951,"second":34,"amount":-2},{"first":951,"second":39,"amount":-2},{"first":951,"second":1090,"amount":-1},{"first":958,"second":101,"amount":-1},{"first":958,"second":113,"amount":-1},{"first":958,"second":100,"amount":-1},{"first":958,"second":103,"amount":-1},{"first":958,"second":99,"amount":-1},{"first":958,"second":1077,"amount":-1},{"first":958,"second":1105,"amount":-1},{"first":958,"second":1089,"amount":-1},{"first":958,"second":1092,"amount":-1},{"first":958,"second":962,"amount":-1},{"first":958,"second":945,"amount":-1},{"first":958,"second":963,"amount":-1},{"first":958,"second":955,"amount":0},{"first":955,"second":121,"amount":-1},{"first":955,"second":117,"amount":0},{"first":955,"second":102,"amount":0},{"first":955,"second":118,"amount":-1},{"first":955,"second":34,"amount":-2},{"first":955,"second":39,"amount":-2},{"first":955,"second":1091,"amount":-1},{"first":955,"second":252,"amount":0},{"first":955,"second":964,"amount":-5},{"first":955,"second":965,"amount":0},{"first":955,"second":952,"amount":0},{"first":955,"second":960,"amount":0},{"first":955,"second":947,"amount":-1},{"first":955,"second":955,"amount":0},{"first":955,"second":957,"amount":-1},{"first":950,"second":101,"amount":-1},{"first":950,"second":121,"amount":-1},{"first":950,"second":117,"amount":-1},{"first":950,"second":111,"amount":-1},{"first":950,"second":112,"amount":0},{"first":950,"second":113,"amount":-1},{"first":950,"second":100,"amount":-1},{"first":950,"second":103,"amount":-1},{"first":950,"second":109,"amount":0},{"first":950,"second":99,"amount":-1},{"first":950,"second":118,"amount":-1},{"first":950,"second":110,"amount":0},{"first":950,"second":1075,"amount":0},{"first":950,"second":1077,"amount":-1},{"first":950,"second":1105,"amount":-1},{"first":950,"second":1080,"amount":0},{"first":950,"second":1081,"amount":0},{"first":950,"second":1082,"amount":0},{"first":950,"second":1084,"amount":0},{"first":950,"second":1085,"amount":0},{"first":950,"second":1086,"amount":-1},{"first":950,"second":1087,"amount":0},{"first":950,"second":1088,"amount":0},{"first":950,"second":1089,"amount":-1},{"first":950,"second":1091,"amount":-1},{"first":950,"second":1092,"amount":-1},{"first":950,"second":1094,"amount":0},{"first":950,"second":1096,"amount":0},{"first":950,"second":1097,"amount":0},{"first":950,"second":1100,"amount":0},{"first":950,"second":1102,"amount":0},{"first":950,"second":252,"amount":-1},{"first":950,"second":246,"amount":-1},{"first":950,"second":241,"amount":0},{"first":950,"second":962,"amount":-1},{"first":950,"second":949,"amount":-1},{"first":950,"second":964,"amount":-1},{"first":950,"second":965,"amount":-1},{"first":950,"second":952,"amount":0},{"first":950,"second":953,"amount":0},{"first":950,"second":959,"amount":-1},{"first":950,"second":960,"amount":-1},{"first":950,"second":945,"amount":-1},{"first":950,"second":963,"amount":-1},{"first":950,"second":948,"amount":0},{"first":950,"second":966,"amount":-1},{"first":950,"second":947,"amount":-1},{"first":950,"second":951,"amount":0},{"first":950,"second":958,"amount":0},{"first":950,"second":968,"amount":-1},{"first":950,"second":969,"amount":-1},{"first":950,"second":957,"amount":-1},{"first":968,"second":122,"amount":0},{"first":968,"second":120,"amount":0},{"first":968,"second":1078,"amount":0},{"first":968,"second":1093,"amount":0},{"first":969,"second":122,"amount":0},{"first":969,"second":121,"amount":0},{"first":969,"second":120,"amount":0},{"first":969,"second":118,"amount":0},{"first":969,"second":1078,"amount":0},{"first":969,"second":1091,"amount":0},{"first":969,"second":1093,"amount":0},{"first":969,"second":947,"amount":0},{"first":969,"second":957,"amount":0},{"first":957,"second":97,"amount":0},{"first":957,"second":101,"amount":0},{"first":957,"second":111,"amount":0},{"first":957,"second":113,"amount":0},{"first":957,"second":100,"amount":0},{"first":957,"second":102,"amount":0},{"first":957,"second":103,"amount":0},{"first":957,"second":99,"amount":0},{"first":957,"second":44,"amount":-2},{"first":957,"second":46,"amount":-2},{"first":957,"second":34,"amount":0},{"first":957,"second":39,"amount":0},{"first":957,"second":1072,"amount":0},{"first":957,"second":1076,"amount":-1},{"first":957,"second":1077,"amount":0},{"first":957,"second":1105,"amount":0},{"first":957,"second":1083,"amount":-1},{"first":957,"second":1086,"amount":0},{"first":957,"second":1089,"amount":0},{"first":957,"second":1092,"amount":0},{"first":957,"second":246,"amount":0},{"first":957,"second":228,"amount":0},{"first":957,"second":962,"amount":0},{"first":957,"second":961,"amount":0},{"first":957,"second":964,"amount":0},{"first":957,"second":959,"amount":0},{"first":957,"second":960,"amount":0},{"first":957,"second":945,"amount":0},{"first":957,"second":963,"amount":0},{"first":957,"second":948,"amount":0},{"first":957,"second":229,"amount":0},{"first":917,"second":101,"amount":0},{"first":917,"second":121,"amount":-1},{"first":917,"second":117,"amount":0},{"first":917,"second":111,"amount":0},{"first":917,"second":113,"amount":0},{"first":917,"second":100,"amount":0},{"first":917,"second":102,"amount":0},{"first":917,"second":103,"amount":0},{"first":917,"second":119,"amount":0},{"first":917,"second":99,"amount":0},{"first":917,"second":118,"amount":-1},{"first":917,"second":84,"amount":0},{"first":917,"second":1077,"amount":0},{"first":917,"second":1105,"amount":0},{"first":917,"second":1086,"amount":0},{"first":917,"second":1089,"amount":0},{"first":917,"second":1058,"amount":0},{"first":917,"second":1091,"amount":-1},{"first":917,"second":1092,"amount":0},{"first":917,"second":252,"amount":0},{"first":917,"second":246,"amount":0},{"first":917,"second":962,"amount":0},{"first":917,"second":965,"amount":0},{"first":917,"second":959,"amount":0},{"first":917,"second":945,"amount":0},{"first":917,"second":963,"amount":0},{"first":917,"second":947,"amount":-1},{"first":917,"second":957,"amount":-1},{"first":929,"second":97,"amount":0},{"first":929,"second":101,"amount":0},{"first":929,"second":116,"amount":0},{"first":929,"second":121,"amount":0},{"first":929,"second":111,"amount":0},{"first":929,"second":113,"amount":0},{"first":929,"second":100,"amount":0},{"first":929,"second":103,"amount":0},{"first":929,"second":99,"amount":0},{"first":929,"second":118,"amount":0},{"first":929,"second":65,"amount":-3},{"first":929,"second":90,"amount":-1},{"first":929,"second":74,"amount":-4},{"first":929,"second":88,"amount":-1},{"first":929,"second":44,"amount":-7},{"first":929,"second":46,"amount":-7},{"first":929,"second":1040,"amount":-3},{"first":929,"second":1072,"amount":0},{"first":929,"second":1044,"amount":-2},{"first":929,"second":1076,"amount":-1},{"first":929,"second":1077,"amount":0},{"first":929,"second":1105,"amount":0},{"first":929,"second":1046,"amount":-1},{"first":929,"second":1051,"amount":-1},{"first":929,"second":1083,"amount":-1},{"first":929,"second":1086,"amount":0},{"first":929,"second":1089,"amount":0},{"first":929,"second":1091,"amount":0},{"first":929,"second":1092,"amount":0},{"first":929,"second":1061,"amount":-1},{"first":929,"second":246,"amount":0},{"first":929,"second":228,"amount":0},{"first":929,"second":196,"amount":-3},{"first":929,"second":962,"amount":0},{"first":929,"second":961,"amount":-1},{"first":929,"second":959,"amount":0},{"first":929,"second":945,"amount":0},{"first":929,"second":963,"amount":0},{"first":929,"second":948,"amount":0},{"first":929,"second":947,"amount":0},{"first":929,"second":955,"amount":-1},{"first":929,"second":957,"amount":0},{"first":929,"second":913,"amount":-3},{"first":929,"second":916,"amount":-3},{"first":929,"second":923,"amount":-3},{"first":929,"second":918,"amount":-1},{"first":929,"second":935,"amount":-1},{"first":929,"second":229,"amount":0},{"first":929,"second":197,"amount":-3},{"first":929,"second":198,"amount":-2},{"first":932,"second":97,"amount":-2},{"first":932,"second":122,"amount":-1},{"first":932,"second":101,"amount":-2},{"first":932,"second":114,"amount":-2},{"first":932,"second":121,"amount":-1},{"first":932,"second":117,"amount":-2},{"first":932,"second":111,"amount":-2},{"first":932,"second":112,"amount":-2},{"first":932,"second":113,"amount":-2},{"first":932,"second":115,"amount":-2},{"first":932,"second":100,"amount":-2},{"first":932,"second":103,"amount":-2},{"first":932,"second":109,"amount":-2},{"first":932,"second":119,"amount":-1},{"first":932,"second":120,"amount":-2},{"first":932,"second":99,"amount":-2},{"first":932,"second":118,"amount":-1},{"first":932,"second":110,"amount":-2},{"first":932,"second":65,"amount":-2},{"first":932,"second":84,"amount":0},{"first":932,"second":89,"amount":0},{"first":932,"second":79,"amount":-1},{"first":932,"second":81,"amount":-1},{"first":932,"second":83,"amount":0},{"first":932,"second":71,"amount":-1},{"first":932,"second":74,"amount":-5},{"first":932,"second":87,"amount":0},{"first":932,"second":67,"amount":-1},{"first":932,"second":86,"amount":0},{"first":932,"second":45,"amount":-5},{"first":932,"second":8211,"amount":-5},{"first":932,"second":44,"amount":-4},{"first":932,"second":46,"amount":-4},{"first":932,"second":1040,"amount":-2},{"first":932,"second":1072,"amount":-2},{"first":932,"second":1073,"amount":-1},{"first":932,"second":1074,"amount":-2},{"first":932,"second":1075,"amount":-2},{"first":932,"second":1044,"amount":-2},{"first":932,"second":1076,"amount":-3},{"first":932,"second":1077,"amount":-2},{"first":932,"second":1105,"amount":-2},{"first":932,"second":1078,"amount":-2},{"first":932,"second":1079,"amount":-3},{"first":932,"second":1080,"amount":-2},{"first":932,"second":1081,"amount":-2},{"first":932,"second":1082,"amount":-2},{"first":932,"second":1051,"amount":-1},{"first":932,"second":1083,"amount":-3},{"first":932,"second":1084,"amount":-2},{"first":932,"second":1085,"amount":-2},{"first":932,"second":1054,"amount":-1},{"first":932,"second":1086,"amount":-2},{"first":932,"second":1087,"amount":-2},{"first":932,"second":1088,"amount":-2},{"first":932,"second":1057,"amount":-1},{"first":932,"second":1089,"amount":-2},{"first":932,"second":1058,"amount":0},{"first":932,"second":1090,"amount":-2},{"first":932,"second":1091,"amount":-1},{"first":932,"second":1092,"amount":-2},{"first":932,"second":1093,"amount":-2},{"first":932,"second":1094,"amount":-2},{"first":932,"second":1095,"amount":-3},{"first":932,"second":1096,"amount":-2},{"first":932,"second":1097,"amount":-2},{"first":932,"second":1099,"amount":-3},{"first":932,"second":1068,"amount":0},{"first":932,"second":1100,"amount":-2},{"first":932,"second":1101,"amount":-3},{"first":932,"second":1102,"amount":-2},{"first":932,"second":1103,"amount":-3},{"first":932,"second":252,"amount":-2},{"first":932,"second":246,"amount":-2},{"first":932,"second":214,"amount":-1},{"first":932,"second":228,"amount":-2},{"first":932,"second":196,"amount":-2},{"first":932,"second":241,"amount":-2},{"first":932,"second":962,"amount":-2},{"first":932,"second":949,"amount":-3},{"first":932,"second":961,"amount":-3},{"first":932,"second":964,"amount":-2},{"first":932,"second":965,"amount":-2},{"first":932,"second":953,"amount":-3},{"first":932,"second":959,"amount":-2},{"first":932,"second":960,"amount":-2},{"first":932,"second":945,"amount":-2},{"first":932,"second":963,"amount":-2},{"first":932,"second":948,"amount":-1},{"first":932,"second":966,"amount":-3},{"first":932,"second":947,"amount":-1},{"first":932,"second":951,"amount":-2},{"first":932,"second":968,"amount":-3},{"first":932,"second":969,"amount":-3},{"first":932,"second":957,"amount":-1},{"first":932,"second":933,"amount":0},{"first":932,"second":920,"amount":-1},{"first":932,"second":927,"amount":-1},{"first":932,"second":913,"amount":-2},{"first":932,"second":916,"amount":-2},{"first":932,"second":934,"amount":-2},{"first":932,"second":923,"amount":-2},{"first":932,"second":229,"amount":-2},{"first":932,"second":197,"amount":-2},{"first":932,"second":230,"amount":-2},{"first":932,"second":198,"amount":-4},{"first":932,"second":248,"amount":-2},{"first":932,"second":216,"amount":-1},{"first":933,"second":97,"amount":-1},{"first":933,"second":122,"amount":-1},{"first":933,"second":101,"amount":-1},{"first":933,"second":114,"amount":-1},{"first":933,"second":116,"amount":0},{"first":933,"second":121,"amount":0},{"first":933,"second":117,"amount":-1},{"first":933,"second":111,"amount":-1},{"first":933,"second":112,"amount":-1},{"first":933,"second":113,"amount":-1},{"first":933,"second":115,"amount":-1},{"first":933,"second":100,"amount":-1},{"first":933,"second":102,"amount":0},{"first":933,"second":103,"amount":-1},{"first":933,"second":109,"amount":-1},{"first":933,"second":120,"amount":0},{"first":933,"second":99,"amount":-1},{"first":933,"second":118,"amount":0},{"first":933,"second":110,"amount":-1},{"first":933,"second":65,"amount":-2},{"first":933,"second":84,"amount":0},{"first":933,"second":89,"amount":0},{"first":933,"second":85,"amount":-2},{"first":933,"second":79,"amount":-1},{"first":933,"second":81,"amount":-1},{"first":933,"second":83,"amount":0},{"first":933,"second":71,"amount":-1},{"first":933,"second":74,"amount":-2},{"first":933,"second":87,"amount":0},{"first":933,"second":88,"amount":0},{"first":933,"second":67,"amount":-1},{"first":933,"second":86,"amount":0},{"first":933,"second":42,"amount":-1},{"first":933,"second":45,"amount":-1},{"first":933,"second":8211,"amount":-1},{"first":933,"second":44,"amount":-4},{"first":933,"second":46,"amount":-4},{"first":933,"second":125,"amount":0},{"first":933,"second":41,"amount":0},{"first":933,"second":93,"amount":0},{"first":933,"second":38,"amount":-1},{"first":933,"second":1040,"amount":-2},{"first":933,"second":1072,"amount":-1},{"first":933,"second":1075,"amount":-1},{"first":933,"second":1077,"amount":-1},{"first":933,"second":1105,"amount":-1},{"first":933,"second":1046,"amount":0},{"first":933,"second":1078,"amount":0},{"first":933,"second":1080,"amount":-1},{"first":933,"second":1081,"amount":-1},{"first":933,"second":1082,"amount":-1},{"first":933,"second":1084,"amount":-1},{"first":933,"second":1085,"amount":-1},{"first":933,"second":1054,"amount":-1},{"first":933,"second":1086,"amount":-1},{"first":933,"second":1087,"amount":-1},{"first":933,"second":1088,"amount":-1},{"first":933,"second":1057,"amount":-1},{"first":933,"second":1089,"amount":-1},{"first":933,"second":1058,"amount":0},{"first":933,"second":1091,"amount":0},{"first":933,"second":1092,"amount":-1},{"first":933,"second":1061,"amount":0},{"first":933,"second":1093,"amount":0},{"first":933,"second":1094,"amount":-1},{"first":933,"second":1096,"amount":-1},{"first":933,"second":1097,"amount":-1},{"first":933,"second":1100,"amount":-1},{"first":933,"second":1102,"amount":-1},{"first":933,"second":252,"amount":-1},{"first":933,"second":220,"amount":-2},{"first":933,"second":246,"amount":-1},{"first":933,"second":214,"amount":-1},{"first":933,"second":228,"amount":-1},{"first":933,"second":196,"amount":-2},{"first":933,"second":241,"amount":-1},{"first":933,"second":962,"amount":-1},{"first":933,"second":949,"amount":-1},{"first":933,"second":961,"amount":-1},{"first":933,"second":964,"amount":0},{"first":933,"second":965,"amount":-1},{"first":933,"second":952,"amount":0},{"first":933,"second":953,"amount":-1},{"first":933,"second":959,"amount":-1},{"first":933,"second":960,"amount":0},{"first":933,"second":945,"amount":-1},{"first":933,"second":963,"amount":-1},{"first":933,"second":948,"amount":0},{"first":933,"second":966,"amount":-1},{"first":933,"second":947,"amount":0},{"first":933,"second":951,"amount":-1},{"first":933,"second":950,"amount":0},{"first":933,"second":968,"amount":-1},{"first":933,"second":969,"amount":-1},{"first":933,"second":946,"amount":0},{"first":933,"second":957,"amount":0},{"first":933,"second":933,"amount":0},{"first":933,"second":920,"amount":-1},{"first":933,"second":927,"amount":-1},{"first":933,"second":913,"amount":-2},{"first":933,"second":916,"amount":-2},{"first":933,"second":934,"amount":-1},{"first":933,"second":923,"amount":-2},{"first":933,"second":935,"amount":0},{"first":933,"second":229,"amount":-1},{"first":933,"second":197,"amount":-2},{"first":933,"second":230,"amount":-1},{"first":933,"second":198,"amount":-2},{"first":933,"second":248,"amount":-1},{"first":933,"second":216,"amount":-1},{"first":920,"second":65,"amount":0},{"first":920,"second":90,"amount":0},{"first":920,"second":84,"amount":-1},{"first":920,"second":89,"amount":-1},{"first":920,"second":88,"amount":0},{"first":920,"second":86,"amount":0},{"first":920,"second":44,"amount":-2},{"first":920,"second":46,"amount":-2},{"first":920,"second":1040,"amount":0},{"first":920,"second":1044,"amount":-1},{"first":920,"second":1046,"amount":0},{"first":920,"second":1051,"amount":-1},{"first":920,"second":1058,"amount":-1},{"first":920,"second":1061,"amount":0},{"first":920,"second":1068,"amount":-1},{"first":920,"second":196,"amount":0},{"first":920,"second":955,"amount":0},{"first":920,"second":933,"amount":-1},{"first":920,"second":913,"amount":0},{"first":920,"second":931,"amount":0},{"first":920,"second":916,"amount":0},{"first":920,"second":926,"amount":0},{"first":920,"second":923,"amount":0},{"first":920,"second":918,"amount":0},{"first":920,"second":935,"amount":0},{"first":920,"second":197,"amount":0},{"first":920,"second":198,"amount":-1},{"first":921,"second":65,"amount":0},{"first":921,"second":84,"amount":-1},{"first":921,"second":89,"amount":-1},{"first":921,"second":88,"amount":0},{"first":921,"second":1040,"amount":0},{"first":921,"second":1044,"amount":0},{"first":921,"second":1076,"amount":0},{"first":921,"second":1046,"amount":0},{"first":921,"second":1051,"amount":0},{"first":921,"second":1083,"amount":0},{"first":921,"second":1058,"amount":-1},{"first":921,"second":1061,"amount":0},{"first":921,"second":1063,"amount":-1},{"first":921,"second":1095,"amount":-1},{"first":921,"second":196,"amount":0},{"first":921,"second":933,"amount":-1},{"first":921,"second":913,"amount":0},{"first":921,"second":916,"amount":0},{"first":921,"second":923,"amount":0},{"first":921,"second":935,"amount":0},{"first":921,"second":197,"amount":0},{"first":927,"second":65,"amount":0},{"first":927,"second":90,"amount":0},{"first":927,"second":84,"amount":-1},{"first":927,"second":89,"amount":-1},{"first":927,"second":88,"amount":0},{"first":927,"second":86,"amount":0},{"first":927,"second":44,"amount":-2},{"first":927,"second":46,"amount":-2},{"first":927,"second":1040,"amount":0},{"first":927,"second":1044,"amount":-1},{"first":927,"second":1046,"amount":0},{"first":927,"second":1051,"amount":-1},{"first":927,"second":1058,"amount":-1},{"first":927,"second":1061,"amount":0},{"first":927,"second":1068,"amount":-1},{"first":927,"second":196,"amount":0},{"first":927,"second":955,"amount":0},{"first":927,"second":933,"amount":-1},{"first":927,"second":913,"amount":0},{"first":927,"second":931,"amount":0},{"first":927,"second":916,"amount":0},{"first":927,"second":926,"amount":0},{"first":927,"second":923,"amount":0},{"first":927,"second":918,"amount":0},{"first":927,"second":935,"amount":0},{"first":927,"second":197,"amount":0},{"first":927,"second":198,"amount":-1},{"first":913,"second":122,"amount":0},{"first":913,"second":116,"amount":0},{"first":913,"second":121,"amount":-1},{"first":913,"second":117,"amount":0},{"first":913,"second":111,"amount":0},{"first":913,"second":119,"amount":-1},{"first":913,"second":118,"amount":-1},{"first":913,"second":84,"amount":-3},{"first":913,"second":89,"amount":-2},{"first":913,"second":85,"amount":0},{"first":913,"second":79,"amount":0},{"first":913,"second":81,"amount":0},{"first":913,"second":71,"amount":0},{"first":913,"second":87,"amount":-1},{"first":913,"second":67,"amount":0},{"first":913,"second":86,"amount":-2},{"first":913,"second":63,"amount":-1},{"first":913,"second":34,"amount":-2},{"first":913,"second":39,"amount":-2},{"first":913,"second":1044,"amount":0},{"first":913,"second":1051,"amount":0},{"first":913,"second":1083,"amount":0},{"first":913,"second":1054,"amount":0},{"first":913,"second":1086,"amount":0},{"first":913,"second":1057,"amount":0},{"first":913,"second":1058,"amount":-3},{"first":913,"second":1090,"amount":-1},{"first":913,"second":1091,"amount":-1},{"first":913,"second":1063,"amount":-1},{"first":913,"second":1095,"amount":-2},{"first":913,"second":1068,"amount":-1},{"first":913,"second":252,"amount":0},{"first":913,"second":220,"amount":0},{"first":913,"second":246,"amount":0},{"first":913,"second":214,"amount":0},{"first":913,"second":964,"amount":-1},{"first":913,"second":965,"amount":0},{"first":913,"second":959,"amount":0},{"first":913,"second":947,"amount":-1},{"first":913,"second":955,"amount":0},{"first":913,"second":957,"amount":-1},{"first":913,"second":933,"amount":-2},{"first":913,"second":920,"amount":0},{"first":913,"second":927,"amount":0},{"first":913,"second":934,"amount":-1},{"first":913,"second":936,"amount":-1},{"first":913,"second":216,"amount":0},{"first":931,"second":79,"amount":-1},{"first":931,"second":81,"amount":-1},{"first":931,"second":71,"amount":-1},{"first":931,"second":67,"amount":-1},{"first":931,"second":1054,"amount":-1},{"first":931,"second":1057,"amount":-1},{"first":931,"second":214,"amount":-1},{"first":931,"second":955,"amount":0},{"first":931,"second":920,"amount":-1},{"first":931,"second":927,"amount":-1},{"first":931,"second":934,"amount":-1},{"first":931,"second":216,"amount":-1},{"first":916,"second":122,"amount":0},{"first":916,"second":116,"amount":0},{"first":916,"second":121,"amount":-1},{"first":916,"second":117,"amount":0},{"first":916,"second":111,"amount":0},{"first":916,"second":119,"amount":-1},{"first":916,"second":118,"amount":-1},{"first":916,"second":84,"amount":-3},{"first":916,"second":89,"amount":-2},{"first":916,"second":85,"amount":0},{"first":916,"second":79,"amount":0},{"first":916,"second":81,"amount":0},{"first":916,"second":71,"amount":0},{"first":916,"second":87,"amount":-1},{"first":916,"second":67,"amount":0},{"first":916,"second":86,"amount":-2},{"first":916,"second":63,"amount":-1},{"first":916,"second":34,"amount":-2},{"first":916,"second":39,"amount":-2},{"first":916,"second":1044,"amount":0},{"first":916,"second":1051,"amount":0},{"first":916,"second":1083,"amount":0},{"first":916,"second":1054,"amount":0},{"first":916,"second":1086,"amount":0},{"first":916,"second":1057,"amount":0},{"first":916,"second":1058,"amount":-3},{"first":916,"second":1090,"amount":-1},{"first":916,"second":1091,"amount":-1},{"first":916,"second":1063,"amount":-1},{"first":916,"second":1095,"amount":-2},{"first":916,"second":1068,"amount":-1},{"first":916,"second":252,"amount":0},{"first":916,"second":220,"amount":0},{"first":916,"second":246,"amount":0},{"first":916,"second":214,"amount":0},{"first":916,"second":964,"amount":-1},{"first":916,"second":965,"amount":0},{"first":916,"second":959,"amount":0},{"first":916,"second":947,"amount":-1},{"first":916,"second":955,"amount":0},{"first":916,"second":957,"amount":-1},{"first":916,"second":933,"amount":-2},{"first":916,"second":920,"amount":0},{"first":916,"second":927,"amount":0},{"first":916,"second":934,"amount":-1},{"first":916,"second":936,"amount":-1},{"first":916,"second":216,"amount":0},{"first":934,"second":65,"amount":-1},{"first":934,"second":89,"amount":-1},{"first":934,"second":88,"amount":-1},{"first":934,"second":1040,"amount":-1},{"first":934,"second":1046,"amount":-1},{"first":934,"second":1061,"amount":-1},{"first":934,"second":196,"amount":-1},{"first":934,"second":955,"amount":-1},{"first":934,"second":933,"amount":-1},{"first":934,"second":913,"amount":-1},{"first":934,"second":916,"amount":-1},{"first":934,"second":923,"amount":-1},{"first":934,"second":935,"amount":-1},{"first":934,"second":197,"amount":-1},{"first":915,"second":97,"amount":-4},{"first":915,"second":122,"amount":-3},{"first":915,"second":101,"amount":-4},{"first":915,"second":114,"amount":-3},{"first":915,"second":121,"amount":-3},{"first":915,"second":117,"amount":-4},{"first":915,"second":111,"amount":-4},{"first":915,"second":112,"amount":-4},{"first":915,"second":113,"amount":-4},{"first":915,"second":115,"amount":-4},{"first":915,"second":100,"amount":-4},{"first":915,"second":103,"amount":-4},{"first":915,"second":109,"amount":-4},{"first":915,"second":119,"amount":-2},{"first":915,"second":120,"amount":-3},{"first":915,"second":99,"amount":-4},{"first":915,"second":118,"amount":-3},{"first":915,"second":110,"amount":-4},{"first":915,"second":65,"amount":-4},{"first":915,"second":84,"amount":0},{"first":915,"second":89,"amount":0},{"first":915,"second":79,"amount":-1},{"first":915,"second":81,"amount":-1},{"first":915,"second":83,"amount":-1},{"first":915,"second":71,"amount":-1},{"first":915,"second":87,"amount":0},{"first":915,"second":67,"amount":-1},{"first":915,"second":86,"amount":0},{"first":915,"second":45,"amount":-8},{"first":915,"second":8211,"amount":-8},{"first":915,"second":44,"amount":-8},{"first":915,"second":46,"amount":-8},{"first":915,"second":1040,"amount":-4},{"first":915,"second":1072,"amount":-4},{"first":915,"second":1073,"amount":-1},{"first":915,"second":1074,"amount":-4},{"first":915,"second":1075,"amount":-4},{"first":915,"second":1044,"amount":-4},{"first":915,"second":1076,"amount":-5},{"first":915,"second":1077,"amount":-4},{"first":915,"second":1105,"amount":-4},{"first":915,"second":1078,"amount":-3},{"first":915,"second":1079,"amount":-5},{"first":915,"second":1080,"amount":-4},{"first":915,"second":1081,"amount":-4},{"first":915,"second":1082,"amount":-4},{"first":915,"second":1051,"amount":-2},{"first":915,"second":1083,"amount":-5},{"first":915,"second":1084,"amount":-4},{"first":915,"second":1085,"amount":-4},{"first":915,"second":1054,"amount":-1},{"first":915,"second":1086,"amount":-4},{"first":915,"second":1087,"amount":-4},{"first":915,"second":1088,"amount":-4},{"first":915,"second":1057,"amount":-1},{"first":915,"second":1089,"amount":-4},{"first":915,"second":1058,"amount":0},{"first":915,"second":1090,"amount":-3},{"first":915,"second":1091,"amount":-3},{"first":915,"second":1092,"amount":-4},{"first":915,"second":1093,"amount":-3},{"first":915,"second":1094,"amount":-4},{"first":915,"second":1095,"amount":-5},{"first":915,"second":1096,"amount":-4},{"first":915,"second":1097,"amount":-4},{"first":915,"second":1099,"amount":-5},{"first":915,"second":1068,"amount":0},{"first":915,"second":1100,"amount":-4},{"first":915,"second":1101,"amount":-5},{"first":915,"second":1102,"amount":-4},{"first":915,"second":1103,"amount":-5},{"first":915,"second":252,"amount":-4},{"first":915,"second":246,"amount":-4},{"first":915,"second":214,"amount":-1},{"first":915,"second":228,"amount":-4},{"first":915,"second":196,"amount":-4},{"first":915,"second":241,"amount":-4},{"first":915,"second":962,"amount":-4},{"first":915,"second":949,"amount":-5},{"first":915,"second":961,"amount":-6},{"first":915,"second":964,"amount":-4},{"first":915,"second":965,"amount":-4},{"first":915,"second":953,"amount":-6},{"first":915,"second":959,"amount":-4},{"first":915,"second":960,"amount":-5},{"first":915,"second":945,"amount":-4},{"first":915,"second":963,"amount":-4},{"first":915,"second":948,"amount":-2},{"first":915,"second":966,"amount":-6},{"first":915,"second":947,"amount":-3},{"first":915,"second":951,"amount":-4},{"first":915,"second":968,"amount":-5},{"first":915,"second":969,"amount":-6},{"first":915,"second":957,"amount":-3},{"first":915,"second":933,"amount":0},{"first":915,"second":920,"amount":-1},{"first":915,"second":927,"amount":-1},{"first":915,"second":913,"amount":-4},{"first":915,"second":916,"amount":-4},{"first":915,"second":934,"amount":-3},{"first":915,"second":923,"amount":-4},{"first":915,"second":229,"amount":-4},{"first":915,"second":197,"amount":-4},{"first":915,"second":230,"amount":-4},{"first":915,"second":198,"amount":-7},{"first":915,"second":248,"amount":-4},{"first":915,"second":216,"amount":-1},{"first":919,"second":65,"amount":0},{"first":919,"second":84,"amount":-1},{"first":919,"second":89,"amount":-1},{"first":919,"second":88,"amount":0},{"first":919,"second":1040,"amount":0},{"first":919,"second":1044,"amount":0},{"first":919,"second":1076,"amount":0},{"first":919,"second":1046,"amount":0},{"first":919,"second":1051,"amount":0},{"first":919,"second":1083,"amount":0},{"first":919,"second":1058,"amount":-1},{"first":919,"second":1061,"amount":0},{"first":919,"second":1063,"amount":-1},{"first":919,"second":1095,"amount":-1},{"first":919,"second":196,"amount":0},{"first":919,"second":933,"amount":-1},{"first":919,"second":913,"amount":0},{"first":919,"second":916,"amount":0},{"first":919,"second":923,"amount":0},{"first":919,"second":935,"amount":0},{"first":919,"second":197,"amount":0},{"first":926,"second":79,"amount":0},{"first":926,"second":81,"amount":0},{"first":926,"second":71,"amount":0},{"first":926,"second":67,"amount":0},{"first":926,"second":1054,"amount":0},{"first":926,"second":1057,"amount":0},{"first":926,"second":214,"amount":0},{"first":926,"second":955,"amount":0},{"first":926,"second":920,"amount":0},{"first":926,"second":927,"amount":0},{"first":926,"second":216,"amount":0},{"first":922,"second":101,"amount":-1},{"first":922,"second":121,"amount":-1},{"first":922,"second":117,"amount":0},{"first":922,"second":111,"amount":-1},{"first":922,"second":112,"amount":0},{"first":922,"second":113,"amount":-1},{"first":922,"second":100,"amount":-1},{"first":922,"second":103,"amount":-1},{"first":922,"second":109,"amount":0},{"first":922,"second":119,"amount":-1},{"first":922,"second":99,"amount":-1},{"first":922,"second":118,"amount":-1},{"first":922,"second":110,"amount":0},{"first":922,"second":79,"amount":-1},{"first":922,"second":81,"amount":-1},{"first":922,"second":71,"amount":-1},{"first":922,"second":67,"amount":-1},{"first":922,"second":45,"amount":-1},{"first":922,"second":8211,"amount":-1},{"first":922,"second":1073,"amount":-1},{"first":922,"second":1075,"amount":0},{"first":922,"second":1077,"amount":-1},{"first":922,"second":1105,"amount":-1},{"first":922,"second":1080,"amount":0},{"first":922,"second":1081,"amount":0},{"first":922,"second":1082,"amount":0},{"first":922,"second":1084,"amount":0},{"first":922,"second":1085,"amount":0},{"first":922,"second":1054,"amount":-1},{"first":922,"second":1086,"amount":-1},{"first":922,"second":1087,"amount":0},{"first":922,"second":1088,"amount":0},{"first":922,"second":1057,"amount":-1},{"first":922,"second":1089,"amount":-1},{"first":922,"second":1090,"amount":-1},{"first":922,"second":1091,"amount":-1},{"first":922,"second":1092,"amount":-1},{"first":922,"second":1094,"amount":0},{"first":922,"second":1095,"amount":-2},{"first":922,"second":1096,"amount":0},{"first":922,"second":1097,"amount":0},{"first":922,"second":1100,"amount":0},{"first":922,"second":1102,"amount":0},{"first":922,"second":252,"amount":0},{"first":922,"second":246,"amount":-1},{"first":922,"second":214,"amount":-1},{"first":922,"second":241,"amount":0},{"first":922,"second":962,"amount":-1},{"first":922,"second":964,"amount":-2},{"first":922,"second":965,"amount":0},{"first":922,"second":959,"amount":-1},{"first":922,"second":945,"amount":-1},{"first":922,"second":963,"amount":-1},{"first":922,"second":947,"amount":-1},{"first":922,"second":951,"amount":0},{"first":922,"second":957,"amount":-1},{"first":922,"second":920,"amount":-1},{"first":922,"second":927,"amount":-1},{"first":922,"second":934,"amount":-1},{"first":922,"second":216,"amount":-1},{"first":923,"second":122,"amount":0},{"first":923,"second":116,"amount":0},{"first":923,"second":121,"amount":-1},{"first":923,"second":117,"amount":0},{"first":923,"second":111,"amount":0},{"first":923,"second":119,"amount":-1},{"first":923,"second":118,"amount":-1},{"first":923,"second":84,"amount":-3},{"first":923,"second":89,"amount":-2},{"first":923,"second":85,"amount":0},{"first":923,"second":79,"amount":0},{"first":923,"second":81,"amount":0},{"first":923,"second":71,"amount":0},{"first":923,"second":87,"amount":-1},{"first":923,"second":67,"amount":0},{"first":923,"second":86,"amount":-2},{"first":923,"second":63,"amount":-1},{"first":923,"second":34,"amount":-2},{"first":923,"second":39,"amount":-2},{"first":923,"second":1044,"amount":0},{"first":923,"second":1051,"amount":0},{"first":923,"second":1083,"amount":0},{"first":923,"second":1054,"amount":0},{"first":923,"second":1086,"amount":0},{"first":923,"second":1057,"amount":0},{"first":923,"second":1058,"amount":-3},{"first":923,"second":1090,"amount":-1},{"first":923,"second":1091,"amount":-1},{"first":923,"second":1063,"amount":-1},{"first":923,"second":1095,"amount":-2},{"first":923,"second":1068,"amount":-1},{"first":923,"second":252,"amount":0},{"first":923,"second":220,"amount":0},{"first":923,"second":246,"amount":0},{"first":923,"second":214,"amount":0},{"first":923,"second":964,"amount":-1},{"first":923,"second":965,"amount":0},{"first":923,"second":959,"amount":0},{"first":923,"second":947,"amount":-1},{"first":923,"second":955,"amount":0},{"first":923,"second":957,"amount":-1},{"first":923,"second":933,"amount":-2},{"first":923,"second":920,"amount":0},{"first":923,"second":927,"amount":0},{"first":923,"second":934,"amount":-1},{"first":923,"second":936,"amount":-1},{"first":923,"second":216,"amount":0},{"first":918,"second":101,"amount":0},{"first":918,"second":121,"amount":-1},{"first":918,"second":117,"amount":0},{"first":918,"second":111,"amount":0},{"first":918,"second":113,"amount":0},{"first":918,"second":100,"amount":0},{"first":918,"second":103,"amount":0},{"first":918,"second":119,"amount":-1},{"first":918,"second":99,"amount":0},{"first":918,"second":118,"amount":-1},{"first":918,"second":65,"amount":0},{"first":918,"second":79,"amount":-1},{"first":918,"second":81,"amount":-1},{"first":918,"second":71,"amount":-1},{"first":918,"second":67,"amount":-1},{"first":918,"second":1040,"amount":0},{"first":918,"second":1077,"amount":0},{"first":918,"second":1105,"amount":0},{"first":918,"second":1054,"amount":-1},{"first":918,"second":1086,"amount":0},{"first":918,"second":1057,"amount":-1},{"first":918,"second":1089,"amount":0},{"first":918,"second":1091,"amount":-1},{"first":918,"second":1092,"amount":0},{"first":918,"second":252,"amount":0},{"first":918,"second":246,"amount":0},{"first":918,"second":214,"amount":-1},{"first":918,"second":196,"amount":0},{"first":918,"second":962,"amount":0},{"first":918,"second":965,"amount":0},{"first":918,"second":959,"amount":0},{"first":918,"second":945,"amount":0},{"first":918,"second":963,"amount":0},{"first":918,"second":947,"amount":-1},{"first":918,"second":968,"amount":-1},{"first":918,"second":957,"amount":-1},{"first":918,"second":920,"amount":-1},{"first":918,"second":927,"amount":-1},{"first":918,"second":913,"amount":0},{"first":918,"second":916,"amount":0},{"first":918,"second":934,"amount":-1},{"first":918,"second":923,"amount":0},{"first":918,"second":197,"amount":0},{"first":918,"second":216,"amount":-1},{"first":935,"second":101,"amount":-1},{"first":935,"second":121,"amount":-1},{"first":935,"second":117,"amount":0},{"first":935,"second":111,"amount":0},{"first":935,"second":113,"amount":-1},{"first":935,"second":100,"amount":-1},{"first":935,"second":103,"amount":-1},{"first":935,"second":99,"amount":-1},{"first":935,"second":118,"amount":-1},{"first":935,"second":79,"amount":-1},{"first":935,"second":81,"amount":-1},{"first":935,"second":71,"amount":-1},{"first":935,"second":67,"amount":-1},{"first":935,"second":86,"amount":0},{"first":935,"second":45,"amount":-1},{"first":935,"second":8211,"amount":-1},{"first":935,"second":1073,"amount":0},{"first":935,"second":1044,"amount":0},{"first":935,"second":1077,"amount":-1},{"first":935,"second":1105,"amount":-1},{"first":935,"second":1051,"amount":0},{"first":935,"second":1083,"amount":0},{"first":935,"second":1054,"amount":-1},{"first":935,"second":1086,"amount":0},{"first":935,"second":1057,"amount":-1},{"first":935,"second":1089,"amount":-1},{"first":935,"second":1090,"amount":-1},{"first":935,"second":1091,"amount":-1},{"first":935,"second":1092,"amount":-1},{"first":935,"second":1095,"amount":-1},{"first":935,"second":252,"amount":0},{"first":935,"second":246,"amount":0},{"first":935,"second":214,"amount":-1},{"first":935,"second":962,"amount":-1},{"first":935,"second":964,"amount":-1},{"first":935,"second":965,"amount":0},{"first":935,"second":952,"amount":0},{"first":935,"second":959,"amount":0},{"first":935,"second":945,"amount":-1},{"first":935,"second":963,"amount":-1},{"first":935,"second":948,"amount":0},{"first":935,"second":966,"amount":-1},{"first":935,"second":947,"amount":-1},{"first":935,"second":955,"amount":0},{"first":935,"second":968,"amount":-1},{"first":935,"second":969,"amount":0},{"first":935,"second":957,"amount":-1},{"first":935,"second":920,"amount":-1},{"first":935,"second":927,"amount":-1},{"first":935,"second":934,"amount":-1},{"first":935,"second":216,"amount":-1},{"first":936,"second":65,"amount":-1},{"first":936,"second":44,"amount":-5},{"first":936,"second":46,"amount":-5},{"first":936,"second":1040,"amount":-1},{"first":936,"second":196,"amount":-1},{"first":936,"second":961,"amount":0},{"first":936,"second":913,"amount":-1},{"first":936,"second":916,"amount":-1},{"first":936,"second":923,"amount":-1},{"first":936,"second":197,"amount":-1},{"first":914,"second":84,"amount":-1},{"first":914,"second":89,"amount":-1},{"first":914,"second":86,"amount":0},{"first":914,"second":1058,"amount":-1},{"first":914,"second":1059,"amount":0},{"first":914,"second":933,"amount":-1},{"first":925,"second":65,"amount":0},{"first":925,"second":84,"amount":-1},{"first":925,"second":89,"amount":-1},{"first":925,"second":88,"amount":0},{"first":925,"second":1040,"amount":0},{"first":925,"second":1044,"amount":0},{"first":925,"second":1076,"amount":0},{"first":925,"second":1046,"amount":0},{"first":925,"second":1051,"amount":0},{"first":925,"second":1083,"amount":0},{"first":925,"second":1058,"amount":-1},{"first":925,"second":1061,"amount":0},{"first":925,"second":1063,"amount":-1},{"first":925,"second":1095,"amount":-1},{"first":925,"second":196,"amount":0},{"first":925,"second":933,"amount":-1},{"first":925,"second":913,"amount":0},{"first":925,"second":916,"amount":0},{"first":925,"second":923,"amount":0},{"first":925,"second":935,"amount":0},{"first":925,"second":197,"amount":0},{"first":924,"second":65,"amount":0},{"first":924,"second":84,"amount":-1},{"first":924,"second":89,"amount":-1},{"first":924,"second":88,"amount":0},{"first":924,"second":1040,"amount":0},{"first":924,"second":1044,"amount":0},{"first":924,"second":1076,"amount":0},{"first":924,"second":1046,"amount":0},{"first":924,"second":1051,"amount":0},{"first":924,"second":1083,"amount":0},{"first":924,"second":1058,"amount":-1},{"first":924,"second":1061,"amount":0},{"first":924,"second":1063,"amount":-1},{"first":924,"second":1095,"amount":-1},{"first":924,"second":196,"amount":0},{"first":924,"second":933,"amount":-1},{"first":924,"second":913,"amount":0},{"first":924,"second":916,"amount":0},{"first":924,"second":923,"amount":0},{"first":924,"second":935,"amount":0},{"first":924,"second":197,"amount":0},{"first":229,"second":121,"amount":0},{"first":229,"second":118,"amount":0},{"first":229,"second":34,"amount":-1},{"first":229,"second":39,"amount":-1},{"first":229,"second":1090,"amount":0},{"first":229,"second":1091,"amount":0},{"first":229,"second":947,"amount":0},{"first":229,"second":957,"amount":0},{"first":197,"second":122,"amount":0},{"first":197,"second":116,"amount":0},{"first":197,"second":121,"amount":-1},{"first":197,"second":117,"amount":0},{"first":197,"second":111,"amount":0},{"first":197,"second":119,"amount":-1},{"first":197,"second":118,"amount":-1},{"first":197,"second":84,"amount":-3},{"first":197,"second":89,"amount":-2},{"first":197,"second":85,"amount":0},{"first":197,"second":79,"amount":0},{"first":197,"second":81,"amount":0},{"first":197,"second":71,"amount":0},{"first":197,"second":87,"amount":-1},{"first":197,"second":67,"amount":0},{"first":197,"second":86,"amount":-2},{"first":197,"second":63,"amount":-1},{"first":197,"second":34,"amount":-2},{"first":197,"second":39,"amount":-2},{"first":197,"second":1044,"amount":0},{"first":197,"second":1051,"amount":0},{"first":197,"second":1083,"amount":0},{"first":197,"second":1054,"amount":0},{"first":197,"second":1086,"amount":0},{"first":197,"second":1057,"amount":0},{"first":197,"second":1058,"amount":-3},{"first":197,"second":1090,"amount":-1},{"first":197,"second":1091,"amount":-1},{"first":197,"second":1063,"amount":-1},{"first":197,"second":1095,"amount":-2},{"first":197,"second":1068,"amount":-1},{"first":197,"second":252,"amount":0},{"first":197,"second":220,"amount":0},{"first":197,"second":246,"amount":0},{"first":197,"second":214,"amount":0},{"first":197,"second":964,"amount":-1},{"first":197,"second":965,"amount":0},{"first":197,"second":959,"amount":0},{"first":197,"second":947,"amount":-1},{"first":197,"second":955,"amount":0},{"first":197,"second":957,"amount":-1},{"first":197,"second":933,"amount":-2},{"first":197,"second":920,"amount":0},{"first":197,"second":927,"amount":0},{"first":197,"second":934,"amount":-1},{"first":197,"second":936,"amount":-1},{"first":197,"second":216,"amount":0}]'),FontJSON={pages,chars,info,common,distanceField,kernings},FontImage="/assets/Roboto-msdf-CKMe7dvC.png";function getWorldPosititon$1(n){const e=new Vector3$1;return n.getWorldPosition(e),e}function getChildrenMesh$1(n,e){let t=null;return n.traverse(o=>{o.name===e&&(t=o)}),t}class LessonCleaner{constructor(e){console.log("LessonCleaner constructor: scene =",e),this.nonRemovableObjects=[],this.scene=e}removeObjects(){if(!this.scene){console.error("LessonCleaner: scene is undefined in removeObjects");return}const e=[];this.scene.traverse(t=>{t.name==="mainModel"&&t.traverse(o=>{o.name==="table2"&&o.children.filter(s=>!this.nonRemovableObjects.includes(s.name)).forEach(s=>{this.disposeObject(s),o.remove(s)})}),t.name.startsWith("jstPin")&&e.push(t)}),e.forEach(t=>{this.disposeObject(t),t.parent&&t.parent.remove(t)})}disposeObject(e){e.traverse(t=>{t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach(o=>o.dispose()):t.material.dispose(),t.material.map&&t.material.map.dispose())})}}let motorGears$1=null,rotationSpeed=0,upKey=!1,downKey=!1,leftKey=!1,rightKey=!1,remoteKeys=new Map;function KpIRLesson(n,e){console.log("KpIRLesson called with scene:",n,"camera:",e),console.log("Available models:",Object.keys(allAssets$4.models.gltf||{})),new LessonCleaner(n);function t(){new Vector3$1(e.position.x,e.position.y,e.position.z-1),setForwardArrowEnabled(!0)}function o(){window.addEventListener("keydown",s=>{switch(s.key.toLowerCase()){case"w":rotationSpeed=.5,upKey=!0;break;case"s":rotationSpeed=-.5,downKey=!0;break;case"a":rotationSpeed=.25,leftKey=!0;break;case"d":rotationSpeed=-.25,rightKey=!0;break}}),window.addEventListener("keyup",s=>{["w","s","a","d"].includes(s.key.toLowerCase())&&(rotationSpeed=0,upKey=!1,downKey=!1,leftKey=!1,rightKey=!1)})}async function i(){let s=1,r=null,a=null,l;try{l=new RaycasterSetup2$1(n,e,()=>s)}catch(I){console.error("Failed to initialize RaycasterSetup2:",I);return}const c=allAssets$4.models.gltf.nano1,d=allAssets$4.models.gltf.expansionBoard,u=allAssets$4.models.gltf.battery2,f=allAssets$4.models.gltf.tsop,h=allAssets$4.models.gltf.remote,m=allAssets$4.models.gltf.motorDriver,p=allAssets$4.models.gltf.motor;if(console.log("Model availability check:",{arduinoNano:!!c,expansionBoard:!!d,battery:!!u,tsop:!!f,remote:!!h,motorDriver:!!m,motor:!!p,mainModel:!!allAssets$4.models.gltf.mainModel}),!c||!d||!u||!f||!h||!m||!p){console.error("Required models not loaded for KpIRLesson:",{arduinoNano:!!c,expansionBoard:!!d,battery:!!u,tsop:!!f,remote:!!h,motorDriver:!!m,motor:!!p});return}c.rotation.y=-Math.PI*.5,c.scale.set(5,5,5),c.position.set(0,.3,.2),d.position.set(-.4,.3,.3),d.rotation.y=-Math.PI*.5,d.scale.set(5,5,5),u.position.set(-1,.3,.4),f.scale.set(.3,.3,.3),f.position.set(.5,.3,0),h.position.set(-1,.3,0),m.position.set(-.7,.3,.3),p.position.set(-.2,.3,.4);let v=null;if(allAssets$4.models.gltf.mainModel&&allAssets$4.models.gltf.mainModel.traverse(I=>{I.name==="table2"&&(v=I)}),!v){console.error("Table not found in mainModel");return}try{v.add(c,d,u,f,h,m,p)}catch(I){console.error("Failed to add models to table:",I);return}try{window.nanoModel=c,window.expansionBoardModel=d,window.tsopModel=f,window.motorDriverModel=m,window.getCurrentLesson=()=>"lesson5",window.getCurrentStep=()=>s}catch{}function g(){l.addInteractiveObjects(c),setTimeout(()=>{applyStepShader("lesson5",1)},500);const I=l.onMouseUp;l.onMouseUp=F=>{if(l.isDragging&&l.draggedComponent===c&&s===1){const M=getWorldPosititon$1(c),R=getWorldPosititon$1(d);M.distanceTo(R)<2&&l.snapObject(c,d.position,null,null,()=>{console.log("Arduino Nano snapped to Expansion Board");try{handleSnap("removeFromExpansionNano")}catch{}try{cleanupShader()}catch{}s=2,setTimeout(()=>{t()},2e3),y()})}I.call(l,F)}}function y(){f.position.set(.3,.5,0),r=new JstXhFemalePin$1({pinCount:3,twoSide:!0,jstPinConfig:[{startPosition:{x:.1,y:1.8,z:-2.8}},{startPosition:{x:-.4,y:1.8,z:-3}}],colors:["black","brown","red"],draggablePins:["pinGLTF1"]}),n.add(r.getGroup());try{window.jstPin=r}catch{}r.pinGLTF1.rotation.y=Math.PI,r.updatePosition(r.pinGLTF1.position.clone(),r.pinGLTF1),setTimeout(()=>{applyStepShader("lesson5",2)},500);const I=l.onMouseDown;l.onMouseDown=M=>{var R,O;I.call(l,M);try{if(l.isDragging&&l.draggedComponent instanceof JstXhFemalePin$1&&s===2){const $=l.draggedPinModel||((O=(R=l.draggedComponent)==null?void 0:R.getGroup)==null?void 0:O.call(R))||l.draggedComponent;handleDragStart($)}}catch{}};const F=l.onMouseUp;l.onMouseUp=M=>{if(l.isDragging&&l.draggedComponent instanceof JstXhFemalePin$1&&s===2){const R=l.draggedPinModel,O=getWorldPosititon$1(R);let $=getChildrenMesh$1(allAssets$4.models.gltf.tsop,"tsopPin");const T=getWorldPosititon$1($),D=O.distanceTo(T);console.log("Step 2 distance:",D),D<1&&l.snapObject(R,T,r,R,()=>{console.log("JST pin snapped to tsop's pin");try{handleSnap("removeFromTsopPin")}catch{}s=3,setTimeout(()=>{t()},2e3),w()})}F.call(l,M)}}function w(){if(console.log("irJstPin in Step3:",r),!r){console.error("JST pin from Step 2 not found");return}r.config.draggablePins=["pinGLTF2"],r.updateModelDraggability(["pinGLTF2"]),l.refreshPinModelsRef(),r.pinGLTF2.rotation.x=Math.PI,r.updatePosition(r.pinGLTF2.position.clone(),r.pinGLTF2),setTimeout(()=>{applyStepShader("lesson5",3)},500);const I=l.onMouseDown;l.onMouseDown=O=>{var $,T;I.call(l,O);try{if(l.isDragging&&l.draggedComponent instanceof JstXhFemalePin$1&&s===3){const D=l.draggedPinModel||((T=($=l.draggedComponent)==null?void 0:$.getGroup)==null?void 0:T.call($))||l.draggedComponent;handleDragStart(D)}}catch{}};let F=getChildrenMesh$1(d,"tsopPin");const M=getWorldPosititon$1(F),R=l.onMouseUp;l.onMouseUp=O=>{if(l.isDragging&&l.draggedComponent instanceof JstXhFemalePin$1&&s===3){const $=new Vector3$1,T=l.draggedPinModel;T.getWorldPosition($);const D=$.distanceTo(M);console.log("Step 3 distance:",D),D<5.5&&l.snapObject(T,M,r,T,()=>{console.log("JST pin snapped to expansionBoard's tsopPin");try{handleSnap("removeFromTsopPin")}catch{}s=4,console.log("Step 3 completed"),setTimeout(()=>{t()},2e3),_()})}R.call(l,O)}}function _(){let I=getChildrenMesh$1(p,"motorPin1"),F=getChildrenMesh$1(p,"motorPin2");const M=getWorldPosititon$1(I),R=getWorldPosititon$1(F),O=new JstXhFemalePin$1({pinCount:2,twoSide:!1,position:new Vector3$1(-.1,1.8,-3),wireConfigs:[{startPosition:M,color:16711680},{startPosition:R,color:65280}]},n);n.add(O.getGroup());try{window.jstPin=O}catch{}O.pinGLTF1.rotation.y=Math.PI*.5,O.updatePosition(O.pinGLTF1.position,O.pinGLTF1),setTimeout(()=>{applyStepShader("lesson5",4)},500);const $=l.onMouseDown;l.onMouseDown=D=>{var P,L;$.call(l,D);try{if(l.isDragging&&l.draggedComponent instanceof JstXhFemalePin$1&&s===4){const B=l.draggedPinModel||((L=(P=l.draggedComponent)==null?void 0:P.getGroup)==null?void 0:L.call(P))||l.draggedComponent;handleDragStart(B)}}catch{}};const T=l.onMouseUp;l.onMouseUp=D=>{if(l.isDragging&&l.draggedComponent instanceof JstXhFemalePin$1&&s===4){const P=l.draggedPinModel,L=getWorldPosititon$1(P);O.originalPinPositions=new Map,O.originalPinPositions.set(O.pinGLTF1,O.pinGLTF1.position.clone());const B=getChildrenMesh$1(m,"motorDriverMotorPin1"),b=getWorldPosititon$1(B),z=L.distanceTo(b);console.log("Step 4 distance:",z),z<2&&l.snapObject(P,b,O,P,()=>{console.log("JST pin snapped to motorDriver's pin");try{handleSnap("removeFromMotorDriverPin")}catch{}try{cleanupShader()}catch{}s=5,setTimeout(()=>{t()},2e3),S()})}T.call(l,D)}}function S(){c.rotation.y=Math.PI*.5,d.rotation.y=Math.PI*.5;const I=getChildrenMesh$1(d,"tsopPin");console.log(I);const F=getWorldPosititon$1(I);r.pinGLTF2.position.copy(F),r.updatePosition(r.pinGLTF1.position.clone(),r.pinGLTF2),a=new JstXhFemalePin$1({pinCount:4,twoSide:!0,jstPinConfig:[{startPosition:{x:0,y:1.8,z:-3}},{startPosition:{x:-.4,y:1.8,z:-3}}],colors:["black","brown","red","green"],draggablePins:["pinGLTF1"]}),n.add(a.getGroup()),a.pinGLTF2.rotation.x=Math.PI,a.updatePosition(a.pinGLTF2.position.clone(),a.pinGLTF2);try{window.jstPin=a}catch{}setTimeout(()=>{applyStepShader("lesson5",5)},500);const M=l.onMouseDown;l.onMouseDown=O=>{var $,T;M.call(l,O);try{if(l.isDragging&&l.draggedComponent instanceof JstXhFemalePin$1&&s===5){const D=l.draggedPinModel||((T=($=l.draggedComponent)==null?void 0:$.getGroup)==null?void 0:T.call($))||l.draggedComponent;handleDragStart(D)}}catch{}};const R=l.onMouseUp;l.onMouseUp=O=>{if(l.isDragging&&l.draggedComponent instanceof JstXhFemalePin$1&&s===5){const $=l.draggedPinModel,T=getWorldPosititon$1($),D=getChildrenMesh$1(d,"motordriverPin"),P=getWorldPosititon$1(D),L=T.distanceTo(P);console.log("Step 5 distance:",L),L<2&&l.snapObject($,P,a,$,()=>{console.log("JST pin snapped to motorDriver's input pin");try{handleSnap("removeFromMotorDriverInputPin")}catch{}try{cleanupShader()}catch{}s=6,setTimeout(()=>{t()},2e3),C()})}R.call(l,O)}}function C(){console.log("Step6: motorDriverInputJstPin:",a);let I=getChildrenMesh$1(m,"motorDriverInputPin");a.config.draggablePins=["pinGLTF2"],a.updateModelDraggability(["pinGLTF2"]),l.refreshPinModelsRef(),a.pinGLTF2.rotation.y=Math.PI*.5,a.updatePosition(a.pinGLTF2.position.clone(),a.pinGLTF2);try{window.jstPin=a}catch{}setTimeout(()=>{applyStepShader("lesson5",6)},500);const F=l.onMouseDown;l.onMouseDown=O=>{var $,T;F.call(l,O);try{if(l.isDragging&&l.draggedComponent instanceof JstXhFemalePin$1&&s===6){const D=l.draggedPinModel||((T=($=l.draggedComponent)==null?void 0:$.getGroup)==null?void 0:T.call($))||l.draggedComponent;handleDragStart(D)}}catch{}};const M=getWorldPosititon$1(I),R=l.onMouseUp;l.onMouseUp=O=>{if(l.isDragging&&l.draggedComponent instanceof JstXhFemalePin$1&&l.draggedComponent===a&&s===6){const $=l.draggedPinModel,D=getWorldPosititon$1($).distanceTo(M);console.log("Step 6 distance:",D),D<5.5&&l.snapObject($,M,a,$,()=>{console.log("JST pin snapped to motorDriver's input pin"),s=7,console.log("Step 6 completed");try{handleSnap("removeFromMotorDriverInputPin")}catch{}try{cleanupShader()}catch{}setTimeout(()=>{t()},2e3),A()})}R.call(l,O)}}function A(){const I=getChildrenMesh$1(u,"positiveTerminal"),F=getChildrenMesh$1(u,"negativeTerminal");console.log(I,F);const M=getWorldPosititon$1(I),R=getWorldPosititon$1(F),O=new JstXhFemalePin$1({pinCount:2,twoSide:!1,position:new Vector3$1(-.5,1.8,-3.5),wireConfigs:[{startPosition:M,color:16711680},{startPosition:R,color:65280}]},n);n.add(O.getGroup());try{window.jstPin=O}catch{}O.pinGLTF1.rotation.y=-Math.PI*.5,O.updatePosition(O.pinGLTF1.position,O.pinGLTF1);const $=getChildrenMesh$1(m,"motorDriverPowerPin"),T=getWorldPosititon$1($),D=l.onMouseUp;setTimeout(()=>{applyStepShader("lesson5",7)},500);const P=l.onMouseDown;l.onMouseDown=L=>{var B,b;P.call(l,L);try{if(l.isDragging&&l.draggedComponent instanceof JstXhFemalePin$1&&s===7){const z=l.draggedPinModel||((b=(B=l.draggedComponent)==null?void 0:B.getGroup)==null?void 0:b.call(B))||l.draggedComponent;handleDragStart(z)}}catch{}},l.onMouseUp=L=>{if(l.isDragging&&l.draggedComponent instanceof JstXhFemalePin$1&&s===7){const B=l.draggedPinModel,z=getWorldPosititon$1(B).distanceTo(T);console.log("Step 7 distance:",z),z<2&&l.snapObject(B,T,O,B,()=>{console.log("JST pin snapped to motorDriver's power pin");try{handleSnap("removeFromMotorDriverPowerPin")}catch{}try{cleanupShader()}catch{}s=8,setTimeout(()=>{t()},2e3),E()})}D.call(l,L)}}function E(){const I=getChildrenMesh$1(u,"positiveTerminal"),F=getChildrenMesh$1(u,"negativeTerminal"),M=getWorldPosititon$1(I),R=getWorldPosititon$1(F),O=new JstXhFemalePin$1({pinCount:2,twoSide:!1,position:new Vector3$1(-.5,1.8,-3.5),wireConfigs:[{startPosition:M,color:16711680},{startPosition:R,color:65280}]},n);n.add(O.getGroup()),O.pinGLTF1.rotation.y=-Math.PI*.5,O.updatePosition(O.pinGLTF1.position,O.pinGLTF1);try{window.jstPin=O}catch{}try{window.batteryWire2=O.pinGLTF1}catch{}setTimeout(()=>{applyStepShader("lesson5",8)},500);const $=l.onMouseDown;l.onMouseDown=L=>{var B,b;$.call(l,L);try{if(l.isDragging&&l.draggedComponent instanceof JstXhFemalePin$1&&s===8){const z=l.draggedPinModel||((b=(B=l.draggedComponent)==null?void 0:B.getGroup)==null?void 0:b.call(B))||l.draggedComponent;handleDragStart(z)}}catch{}};const T=getChildrenMesh$1(d,"powerPin"),D=getWorldPosititon$1(T),P=l.onMouseUp;l.onMouseUp=L=>{if(l.isDragging&&l.draggedComponent instanceof JstXhFemalePin$1&&s===8){const B=l.draggedPinModel,z=getWorldPosititon$1(B).distanceTo(D);console.log("Step 8 distance:",z),z<2&&l.snapObject(B,D,O,B,()=>{console.log("JST pin snapped to expansionBoard's power pin"),s=10,console.log("Step 8 completed");try{handleSnap("removeFromPowerPin")}catch{}try{cleanupShader()}catch{}try{const N=new Vector3$1(e.position.x,e.position.y,e.position.z-1);setTimeout(()=>{try{setForwardArrowEnabled(!1),forwardArrow&&(forwardArrow.visible=!1)}catch{}n&&runCodeButton&&(n.children.includes(runCodeButton)||n.add(runCodeButton),runCodeButton.visible=!0,runCodeButton.traverse&&runCodeButton.traverse(G=>{G.userData&&(G.userData.clickable=!0)}))})}catch{}})}P.call(l,L)}}function k(){motorGears$1=new Map,["gear1","gear2","gear3","gear4","gear5","gear6","shaft"].forEach(M=>{p.traverse(R=>{R.name===M&&motorGears$1.set(M,R)})}),console.log(motorGears$1);const F=["leftButton","rightButton","frontButton","backButton"];h.traverse(M=>{F.includes(M.name)&&remoteKeys.set(M.name,M)}),o();try{typeof setForwardArrowEnabled=="function"&&setForwardArrowEnabled(!1)}catch{}try{typeof forwardArrow<"u"&&forwardArrow&&(forwardArrow.visible=!1)}catch{}}try{window._startLesson5Step10Inner=k}catch{}g()}i();try{window.startLesson5=()=>{try{typeof stepCounter<"u"&&(stepCounter=1)}catch{}i()}}catch{}try{window.startLesson5Step10=()=>{try{typeof stepCounter<"u"&&(stepCounter=10)}catch{}try{typeof window._startLesson5Step10Inner=="function"&&window._startLesson5Step10Inner()}catch{}}}catch{}}function updateRemoteKeys(){let n=remoteKeys.get("frontButton"),e=remoteKeys.get("backButton"),t=remoteKeys.get("leftButton"),o=remoteKeys.get("rightButton");n.position.z=.015,e.position.z=.015,t.position.z=.015,o.position.z=.015,upKey&&(n.position.z=.01),downKey&&(e.position.z=.01),leftKey&&(t.position.z=.01),rightKey&&(o.position.z=.01)}function updateFunction$1(n){motorGears$1&&(motorGears$1.forEach(e=>{e.rotation.x+=n*rotationSpeed}),remoteKeys.size&&updateRemoteKeys())}let motorGears=null;function KpMotorLesson(n,e){console.log("KpMotorLesson called with scene:",n,"camera:",e),console.log("Available models:",Object.keys(allAssets$4.models.gltf||{}));function t(){setForwardArrowEnabled(!0)}let o=1,i;try{i=new RaycasterSetup2$1(n,e,()=>o)}catch(g){console.error("Failed to initialize RaycasterSetup2:",g);return}let s=null;const r=allAssets$4.models.gltf.nano1,a=allAssets$4.models.gltf.expansionBoard,l=allAssets$4.models.gltf.motorDriver,c=allAssets$4.models.gltf.motor,d=allAssets$4.models.gltf.battery;if(console.log("Model availability check:",{arduinoNano:!!r,expansionBoard:!!a,motorDriver:!!l,motor:!!c,battery:!!d,mainModel:!!allAssets$4.models.gltf.mainModel}),!r||!a||!l||!c||!d){console.error("Required models not loaded for KpMotorLesson:",{arduinoNano:!!r,expansionBoard:!!a,motorDriver:!!l,motor:!!c,battery:!!d});return}r.position.set(.2,.3,.3),r.scale.set(5,5,5),a.scale.set(5,5,5),a.position.set(-.4,.3,.3),l.position.set(-.7,.3,.3),c.position.set(-.2,.3,.3),d.position.set(-1,.3,.3);let u=null;if(allAssets$4.models.gltf.mainModel&&(u=getChildrenMesh$1(allAssets$4.models.gltf.mainModel,"table2")),!u){console.error("Table not found in mainModel");return}try{u.add(r,a,l,c,d)}catch(g){console.error("Failed to add models to table:",g);return}let f=getChildrenMesh$1(c,"motorPin1"),h=getChildrenMesh$1(c,"motorPin2");if(!f||!h){console.error("Motor pins not found:",{motorPin1:!!f,motorPin2:!!h});return}c.updateMatrixWorld(!0);const m=getWorldPosititon$1(f),p=getWorldPosititon$1(h);i.addInteractiveObjects(r);async function v(){function g(){console.log("Step 1: Drag Arduino Nano to Expansion Board");try{window.nanoModel=r,window.expansionBoardModel=a,window.motorDriverModel=l,window.getCurrentLesson=()=>"lesson4",window.getCurrentStep=()=>o}catch{}setTimeout(()=>{applyStepShader("lesson4",1)},500);const E=i.onMouseDown;i.onMouseDown=I=>{var F,M;E.call(i,I);try{if(i.isDragging&&i.draggedComponent===r&&o===1){const R=((M=(F=i.draggedComponent)==null?void 0:F.getGroup)==null?void 0:M.call(F))||i.draggedComponent;handleDragStart(R)}}catch{}};const k=i.onMouseUp;i.onMouseUp=I=>{if(i.isDragging&&i.draggedComponent===r&&o===1){const F=getWorldPosititon$1(r),M=getWorldPosititon$1(a);F.distanceTo(M)<1&&i.snapObject(r,a.position,null,null,()=>{console.log("Arduino Nano snapped to Expansion Board");try{handleSnap("removeFromExpansionNano")}catch{}try{cleanupShader()}catch{}o=2,setTimeout(()=>{t(),y()},2e3)})}k.call(i,I)}}function y(){const E=new JstXhFemalePin$1({pinCount:2,twoSide:!1,position:new Vector3$1(-.1,1.8,-3),wireConfigs:[{startPosition:m,color:16711680},{startPosition:p,color:65280}]},n);n.add(E.getGroup());try{window.jstPin=E}catch{}E.pinGLTF1.rotation.y=Math.PI*.5,E.updatePosition(E.pinGLTF1.position,E.pinGLTF1),setTimeout(()=>{applyStepShader("lesson4",2)},500);const k=i.onMouseDown;i.onMouseDown=F=>{var M,R;k.call(i,F);try{if(i.isDragging&&i.draggedComponent instanceof JstXhFemalePin$1&&o===2){const O=i.draggedPinModel||((R=(M=i.draggedComponent)==null?void 0:M.getGroup)==null?void 0:R.call(M))||i.draggedComponent;handleDragStart(O)}}catch{}};const I=i.onMouseUp;i.onMouseUp=F=>{if(i.isDragging&&i.draggedComponent instanceof JstXhFemalePin$1&&o===2){const M=i.draggedPinModel,R=getWorldPosititon$1(M);E.originalPinPositions=new Map,E.originalPinPositions.set(E.pinGLTF1,E.pinGLTF1.position.clone());const O=allAssets$4.models.gltf.motorDriver.children[1],$=new Vector3$1;O.getWorldPosition($);const T=R.distanceTo($);console.log("Step 2 distance:",T),T<1&&i.snapObject(M,$,E,M,()=>{console.log("JST pin snapped to motorDriver's pin");try{handleSnap("removeFromMotorDriverPin")}catch{}try{cleanupShader()}catch{}setTimeout(()=>{t()},2e3),o=3,w()})}I.call(i,F)}}function w(){s=new JstXhFemalePin$1({pinCount:4,twoSide:!0,jstPinConfig:[{startPosition:{x:0,y:1.8,z:-3}},{startPosition:{x:-.4,y:1.8,z:-3}}],colors:["black","brown","red","green"]}),n.add(s.getGroup());try{window.jstPin=s}catch{}s.pinGLTF2.rotation.x=Math.PI,s.updatePosition(s.pinGLTF2.position.clone(),s.pinGLTF2),setTimeout(()=>{applyStepShader("lesson4",3)},500);const E=i.onMouseDown;i.onMouseDown=I=>{var F,M;E.call(i,I);try{if(i.isDragging&&i.draggedComponent instanceof JstXhFemalePin$1&&o===3){const R=i.draggedPinModel||((M=(F=i.draggedComponent)==null?void 0:F.getGroup)==null?void 0:M.call(F))||i.draggedComponent;handleDragStart(R)}}catch{}};const k=i.onMouseUp;i.onMouseUp=I=>{if(i.isDragging&&i.draggedComponent instanceof JstXhFemalePin$1&&o===3){const F=new Vector3$1,M=i.draggedPinModel;M.getWorldPosition(F);const R=getChildrenMesh$1(a,"motordriverPin"),O=new Vector3$1;R.getWorldPosition(O);const $=F.distanceTo(O);console.log("Step 3 distance:",$),$<1&&i.snapObject(M,O,s,M,()=>{console.log("JST pin snapped to expansionBoard's pin");try{handleSnap("removeFromMotorDriverPin")}catch{}try{cleanupShader()}catch{}setTimeout(()=>{t()},2e3),o=4,_()})}k.call(i,I)}}function _(){console.log("Step 4: Snap JST pin to motorDriver's input pin");let E=null;l.traverse($=>{$.name==="motorDriverInputPin"&&(E=$)}),console.log("Motor driver input pin found:",E);const k=s;if(!k){console.error("JST pin from Step 3 not found");return}console.log("motorInputPin2:",k),k.pinGLTF2.rotation.y=Math.PI*.5,k.updatePosition(k.pinGLTF2.position.clone(),k.pinGLTF2),setTimeout(()=>{applyStepShader("lesson4",4)},500);const I=i.onMouseDown;i.onMouseDown=$=>{var T,D;I.call(i,$);try{if(i.isDragging&&i.draggedComponent instanceof JstXhFemalePin$1&&o===4){const P=i.draggedPinModel||((D=(T=i.draggedComponent)==null?void 0:T.getGroup)==null?void 0:D.call(T))||i.draggedComponent;handleDragStart(P)}}catch{}};const F=i.pinModelsRef,M=F.find($=>$.instance===k);if(M){const $=M.models.find(T=>T.model===k.pinGLTF2);$?($.draggable=!0,console.log("Set pinGLTF2 as draggable for Step 4"),console.log("Updated pinModelsRef:",F)):console.warn("Could not find pinGLTF2 model in pinModelsRef")}else console.warn("Could not find motorInputPin2 in pinModelsRef");const R=new Vector3$1;E.getWorldPosition(R),console.log("Motor driver input pin world position:",R);const O=i.onMouseUp;i.onMouseUp=$=>{if(console.log("Step 4 onMouseUp - isDragging:",i.isDragging,"draggedComponent:",i.draggedComponent,"stepCounter:",o),i.isDragging&&i.draggedComponent===k&&o===4){const T=new Vector3$1,D=i.draggedPinModel;D.getWorldPosition(T);const P=T.distanceTo(R);console.log("Step 4 distance:",P,"threshold: 10.0"),P<10&&(console.log("Attempting to snap pin to motorDriver input pin"),i.snapObject(D,R,k,D,()=>{console.log("JST pin snapped to motorDriver's input pin");try{handleSnap("removeFromMotorDriverInputPin")}catch{}try{cleanupShader()}catch{}setTimeout(()=>{t()},2e3),o=5,console.log("Step 4 completed"),S()}))}O.call(i,$)}}function S(){const E=new Vector3$1;d.children[2].getWorldPosition(E);const k=new Vector3$1;d.children[1].getWorldPosition(k);const I=new JstXhFemalePin$1({pinCount:2,twoSide:!1,position:new Vector3$1(-.5,1.8,-3.5),wireConfigs:[{startPosition:E,color:16711680},{startPosition:k,color:65280}]},n);n.add(I.getGroup());try{window.jstPin=I}catch{}I.pinGLTF1.rotation.y=Math.PI*.5,I.updatePosition(I.pinGLTF1.position,I.pinGLTF1);const F=new Vector3$1;l.children[4].getWorldPosition(F),setTimeout(()=>{applyStepShader("lesson4",5)},500);const M=i.onMouseDown;i.onMouseDown=O=>{var $,T;M.call(i,O);try{if(i.isDragging&&i.draggedComponent instanceof JstXhFemalePin$1&&o===5){const D=i.draggedPinModel||((T=($=i.draggedComponent)==null?void 0:$.getGroup)==null?void 0:T.call($))||i.draggedComponent;handleDragStart(D)}}catch{}};const R=i.onMouseUp;i.onMouseUp=O=>{if(i.isDragging&&i.draggedComponent instanceof JstXhFemalePin$1&&o===5){const $=new Vector3$1,T=i.draggedPinModel;T.getWorldPosition($);const D=$.distanceTo(F);console.log("Step 5 distance:",D),D<2&&i.snapObject(T,F,I,T,()=>{console.log("JST pin snapped to motorDriver's input pin");try{handleSnap("removeFromMotorDriverPowerPin")}catch{}try{cleanupShader()}catch{}setTimeout(()=>{t()},2e3),o=6,console.log("Step 5 completed"),C()})}R.call(i,O)}}function C(){const E=new Vector3$1;d.children[2].getWorldPosition(E);const k=new Vector3$1;d.children[1].getWorldPosition(k);const I=new JstXhFemalePin$1({pinCount:2,twoSide:!1,position:new Vector3$1(-.5,1.8,-3.5),wireConfigs:[{startPosition:E,color:16711680},{startPosition:k,color:65280}]},n);n.add(I.getGroup()),I.pinGLTF1.rotation.y=-Math.PI*.5,I.updatePosition(I.pinGLTF1.position,I.pinGLTF1);try{window.batteryWire2=I.pinGLTF1}catch{}const F=getChildrenMesh$1(a,"powerPin"),M=getWorldPosititon$1(F);setTimeout(()=>{applyStepShader("lesson4",6)},500);const R=i.onMouseDown;i.onMouseDown=$=>{var T,D;R.call(i,$);try{if(i.isDragging&&i.draggedComponent instanceof JstXhFemalePin$1&&o===6){const P=i.draggedPinModel||((D=(T=i.draggedComponent)==null?void 0:T.getGroup)==null?void 0:D.call(T))||i.draggedComponent;handleDragStart(P)}}catch{}};const O=i.onMouseUp;i.onMouseUp=$=>{if(i.isDragging&&i.draggedComponent instanceof JstXhFemalePin$1&&o===6){const T=new Vector3$1,D=i.draggedPinModel;D.getWorldPosition(T);const P=T.distanceTo(M);console.log("Step 6 distance:",P),P<2&&i.snapObject(D,M,I,D,()=>{console.log("JST pin snapped to expansionBoard's power pin");try{const L=new Vector3$1(e.position.x,e.position.y,e.position.z-1);setTimeout(()=>{setTimeout(()=>{try{setForwardArrowEnabled(!1),forwardArrow&&(forwardArrow.visible=!1)}catch{}n&&runCodeButton&&(n.children.includes(runCodeButton)||n.add(runCodeButton),runCodeButton.visible=!0,runCodeButton.traverse&&runCodeButton.traverse(B=>{B.userData&&(B.userData.clickable=!0)}))})},2e3)}catch{}try{handleSnap("removeFromPowerPin")}catch{}try{cleanupShader()}catch{}o=7,console.log("Step 6 completed")})}O.call(i,$)}}function A(){motorGears=new Map,["gear1","gear2","gear3","gear4","gear5","gear6","shaft"].forEach(k=>{c.traverse(I=>{I.name===k&&motorGears.set(k,I)})})}try{window._startLesson4Step7Inner=A}catch{}g()}v();try{window.startLesson4=()=>{try{typeof o<"u"&&(o=1)}catch{}v()}}catch{}try{window.startLesson4Step7=()=>{try{typeof o<"u"&&(o=7)}catch{}try{typeof window._startLesson4Step7Inner=="function"&&window._startLesson4Step7Inner()}catch{}}}catch{}}function updateFunction(n){try{!(typeof window<"u"&&window._lesson4_s7Played||!1)&&typeof window<"u"&&motorGears&&motorGears.size>0}catch{}motorGears&&motorGears.size>0?(console.log("[MotorLesson] updateFunction running, motorGears size:",motorGears.size),motorGears.forEach((e,t)=>{e&&e.rotation&&(e.rotation.x+=n*.5,console.log(`[MotorLesson] Rotating gear ${t}, rotation.x:`,e.rotation.x))})):console.log("[MotorLesson] updateFunction called but motorGears not ready:",motorGears?motorGears.size:"null")}function KpRgbDefault(n,e,t){console.log("KpRgbDefault called with scene:",n,"camera:",e),console.log("Available models:",Object.keys(allAssets$4.models.gltf||{})),new Vector3$1(e.position.x,e.position.y,e.position.z-1);function o(){setForwardArrowEnabled(!0)}let i=1,s=null;const r=p=>{if(!s)return;const v=2,g=2.4,y=.2,w=1,_=0,S=1,C=(p-v)/(g-v),A=y+C*(w-y);s.material.opacity=Math.max(y,Math.min(w,A));const E=_+C*(S-_);s.material.emissiveIntensity=Math.max(_,Math.min(S,E)),s.material.emissive=new Color(1,1,1),s.material.needsUpdate=!0};let a;try{a=new RaycasterSetup2$1(n,e,()=>i,r);try{window.kpL3Raycaster=a}catch{}}catch(p){console.error("Failed to initialize RaycasterSetup2:",p);return}const l=allAssets$4.models.gltf.nano1,c=allAssets$4.models.gltf.expansionBoard,d=allAssets$4.models.gltf.ldr,u=allAssets$4.models.gltf.rgbLed,f=allAssets$4.models.gltf.battery2;if(console.log("Model availability check:",{arduinoNano:!!l,expansionBoard:!!c,ldr:!!d,rgbLed:!!u,battery:!!f,mainModel:!!allAssets$4.models.gltf.mainModel}),!l||!c||!d||!u||!f){console.error("Required models not loaded for KpRgbDefault:",{arduinoNano:!!l,expansionBoard:!!c,ldr:!!d,rgbLed:!!u,battery:!!f});return}try{window.ldrModel=d}catch{}try{window.rgbLedModel=u}catch{}f.position.set(.2,.3,.4),f.scale.set(.6,.6,.6),l.userData.kpLesson3=!0,c.userData.kpLesson3=!0,d.userData.kpLesson3=!0,u.userData.kpLesson3=!0;let h=null;if(allAssets$4.models.gltf.mainModel&&allAssets$4.models.gltf.mainModel.traverse(p=>{p.name==="table2"&&(h=p)}),!h){console.error("Table not found in mainModel");return}try{h.add(l,c,d,u,f)}catch(p){console.error("Failed to add models to table:",p);return}l.position.set(-.4,.4,0),l.scale.set(5,5,5),c.position.set(0,.3,.2),c.scale.set(5,5,5),d.position.set(-1,.45,0),u.position.set(-.7,.5,.2),a.addInteractiveObjects(l);try{window.expansionBoardModel=c,window.ldrModel=d,window.getCurrentLesson=()=>"lesson3",window.getCurrentStep=()=>i}catch{}async function m(){let p=null;window.jstPinRgb=p;function v(){console.log("Step 1: Drag Arduino Nano to Expansion Board");const A=a.onMouseUp;a.onMouseUp=E=>{if(a.isDragging&&a.draggedComponent===l&&i===1){const k=getWorldPosititon$1(l),I=getWorldPosititon$1(c);k.distanceTo(I)<1&&a.snapObject(l,c.position,null,null,()=>{console.log("Arduino Nano snapped to Expansion Board"),setTimeout(()=>{o(),setTimeout(()=>{i=2,g()},1e3)},1e3)})}A.call(a,E)}}function g(){console.log("Step 2: Connect LDR to Expansion Board with JST Pin"),o();const A=new JstXhFemalePin$1({pinCount:3,twoSide:!0,jstPinConfig:[{startPosition:{x:0,y:1.8,z:-3}},{startPosition:{x:-.4,y:1.8,z:-3}}],colors:["black","brown","red"]});n.add(A.getGroup());try{window.jstPin2=A}catch{}setTimeout(()=>{applyStepShader("lesson3",2)},1e3),d.rotation.x=Math.PI;const E=a.onMouseDown;a.onMouseDown=I=>{var F,M;E.call(a,I);try{if(a.isDragging&&a.draggedComponent instanceof JstXhFemalePin$1&&i===2){const R=a.draggedPinModel||((M=(F=a.draggedComponent)==null?void 0:F.getGroup)==null?void 0:M.call(F))||a.draggedComponent;handleDragStart(R)}}catch{}};const k=a.onMouseUp;a.onMouseUp=I=>{if(a.isDragging&&a.draggedComponent instanceof JstXhFemalePin$1&&i===2){const F=a.draggedPinModel,M=getWorldPosititon$1(F),R=getChildrenMesh$1(c,"ldrPin"),O=getWorldPosititon$1(R),$=M.distanceTo(O);console.log("Step 2 distance:",$),$<1&&a.snapObject(F,O,A,F,()=>{A.updatePosition(O,F),console.log("JST pin snapped to expansionBoard's ldrPin");try{handleSnap("step2Snap")}catch{}try{cleanupShader()}catch{}i=3,setTimeout(()=>{o(),y()},1e3)})}k.call(a,I)}}function y(){var M;let A=getChildrenMesh$1(d,"ldrPin");const E=getWorldPosititon$1(A),k=(M=JstXhFemalePin$1.getAllModels().find(R=>R.instance.config.twoSide))==null?void 0:M.instance;if(!k){console.error("JST pin from Step 2 not found");return}k.pinGLTF2.rotation.x=Math.PI,k.pinGLTF2.rotation.y=Math.PI,k.updatePosition(k.pinGLTF2.position,k.pinGLTF2),o(),setTimeout(()=>{applyStepShader("lesson3",3)},1e3);const I=a.onMouseDown;a.onMouseDown=R=>{I.call(a,R);try{const O=()=>{var $,T;if(a.draggedComponent instanceof JstXhFemalePin$1&&i===3){const D=a.draggedPinModel||((T=($=a.draggedComponent)==null?void 0:$.getGroup)==null?void 0:T.call($))||a.draggedComponent;handleDragStart(D)}};O(),setTimeout(O,0)}catch{}};const F=a.onMouseUp;a.onMouseUp=R=>{if(a.isDragging&&a.draggedComponent instanceof JstXhFemalePin$1&&a.draggedComponent===k&&i===3){const O=a.draggedPinModel,T=getWorldPosititon$1(O).distanceTo(E);console.log("Step 3 distance:",T),T<1&&a.snapObject(O,E,k,O,()=>{try{handleSnap("removeFromLdrPin001")}catch{}try{cleanupShader()}catch{}try{const B=window.ldrModel;B&&B.traverse(b=>{b.material&&b.material.type==="ShaderMaterial"&&(console.log("Step 3 cleanup: Restoring LDR child material to default"),b.material=new MeshStandardMaterial({color:8421504,metalness:.5,roughness:.5}),b.material.needsUpdate=!0)})}catch(B){console.warn("Error during LDR cleanup:",B)}k.updatePosition(E,O),i=4,l.rotation.y=-Math.PI*.5,c.rotation.y=-Math.PI*.5,d.rotation.x=0,k.pinGLTF2.rotation.x=0;const D=getWorldPosititon$1(A);k.pinGLTF2.position.copy(D),k.updatePosition(D,k.pinGLTF2);const P=getChildrenMesh$1(c,"ldrPin"),L=getWorldPosititon$1(P);k.pinGLTF1.position.copy(L),k.updatePosition(D,k.pinGLTF1),setTimeout(()=>{o(),setTimeout(()=>{w()},1e3)},1e3)})}F.call(a,R)}}function w(){try{const k=window.ldrModel;k&&k.traverse(I=>{I.material&&I.material.type==="ShaderMaterial"&&(console.log("Step 4 cleanup: Restoring LDR child material to default"),I.material=new MeshStandardMaterial({color:8421504,metalness:.5,roughness:.5}),I.material.needsUpdate=!0)})}catch(k){console.warn("Error during Step 4 cleanup:",k)}p=new JstXhFemalePin$1({pinCount:4,twoSide:!0,jstPinConfig:[{startPosition:{x:.4,y:1.8,z:-3}},{startPosition:{x:-.3,y:1.8,z:-3}}],colors:["black","brown","red","blue"]}),n.add(p.getGroup()),window.jstPin=p,u.rotation.x=Math.PI,o(),setTimeout(()=>{applyStepShader("lesson3",4)},1e3);const A=a.onMouseDown;a.onMouseDown=k=>{var I,F;A.call(a,k);try{if(a.draggedComponent instanceof JstXhFemalePin$1&&i===4){const M=a.draggedPinModel||((F=(I=a.draggedComponent)==null?void 0:I.getGroup)==null?void 0:F.call(I))||a.draggedComponent;handleDragStart(M)}}catch{}};const E=a.onMouseUp;a.onMouseUp=k=>{if(a.isDragging&&a.draggedComponent instanceof JstXhFemalePin$1&&i===4){const I=a.draggedPinModel,F=getWorldPosititon$1(I),M=getChildrenMesh$1(c,"rgbPin1"),R=getWorldPosititon$1(M),O=F.distanceTo(R);console.log("Step 4 distance:",O),O<1&&a.snapObject(I,R,p,I,()=>{try{handleSnap("removeFromRgbPin1")}catch{}try{cleanupShader()}catch{}p.updatePosition(R,I),console.log("JST pin snapped to expansionBoard's rgbPin"),i=5,setTimeout(()=>{o(),_()},1e3)})}E.call(a,k)}}function _(){console.log("Step 5: Connect the other JST pin to RGB model's rgbPin"),o(),setTimeout(()=>{applyStepShader("lesson3",5)},1e3);const A=a.onMouseDown;a.onMouseDown=M=>{var R,O;A.call(a,M);try{if(a.draggedComponent instanceof JstXhFemalePin$1&&i===5){const $=a.draggedPinModel||((O=(R=a.draggedComponent)==null?void 0:R.getGroup)==null?void 0:O.call(R))||a.draggedComponent;handleDragStart($)}}catch{}};let E=getChildrenMesh$1(u,"rgbPin");const k=getWorldPosititon$1(E);p.pinGLTF2.rotation.x=Math.PI,p.pinGLTF2.rotation.y=Math.PI;const I=getWorldPosititon$1(p.pinGLTF2);p.updatePosition(I,p.pinGLTF2);const F=a.onMouseUp;a.onMouseUp=M=>{if(a.isDragging&&a.draggedComponent instanceof JstXhFemalePin$1&&a.draggedComponent===p&&i===5){const R=new Vector3$1,O=a.draggedPinModel;O.getWorldPosition(R);const $=R.distanceTo(k);console.log("Step 5 distance:",$),$<1&&a.snapObject(O,k,p,O,()=>{try{handleSnap("removeFromRgbLed")}catch{}try{cleanupShader()}catch{}p.updatePosition(k,O),console.log("JST pin snapped to RGB's rgbPin"),i=6,console.log("Step 5 completed"),u.rotation.x=0,p.pinGLTF2.rotation.x=0;const T=getWorldPosititon$1(E);p.pinGLTF2.position.copy(T),p.updatePosition(T,p.pinGLTF2),setTimeout(()=>{o(),S()},1e3)})}F.call(a,M)}}function S(){console.log("Step 6: Connect battery wire to expansion board power pin"),o(),setTimeout(()=>{applyStepShader("lesson3",6)},1e3);const A=a.onMouseDown;a.onMouseDown=O=>{var $,T;A.call(a,O);try{if(a.draggedComponent instanceof JstXhFemalePin$1&&i===6){const D=a.draggedPinModel||((T=($=a.draggedComponent)==null?void 0:$.getGroup)==null?void 0:T.call($))||a.draggedComponent;handleDragStart(D)}}catch{}};const E=new Vector3$1;f.children[2].getWorldPosition(E);const k=new Vector3$1;f.children[1].getWorldPosition(k);const I=new JstXhFemalePin$1({pinCount:2,twoSide:!1,position:new Vector3$1(.5,1.8,-3),wireConfigs:[{startPosition:E,color:16711680},{startPosition:k,color:65280}]},n);n.add(I.getGroup()),I.pinGLTF1.rotation.y=-Math.PI*.5,I.updatePosition(I.pinGLTF1.posititon,I.pinGLTF1);try{window.batteryWire2=I.pinGLTF1}catch{}const F=getChildrenMesh$1(c,"powerPin"),M=getWorldPosititon$1(F),R=a.onMouseUp;a.onMouseUp=O=>{if(a.isDragging&&a.draggedComponent instanceof JstXhFemalePin$1&&i===6){const $=new Vector3$1,T=a.draggedPinModel;T.getWorldPosition($);const D=$.distanceTo(M);console.log("Step 5 distance:",D),D<1&&a.snapObject(T,M,I,T,()=>{try{handleSnap("removeFromPowerPin")}catch{}try{cleanupShader()}catch{}console.log("JST pin snapped to motorDriver's input pin");try{try{setForwardArrowEnabled(!1),forwardArrow&&(forwardArrow.visible=!1)}catch{}n&&runCodeButton&&(n.children.includes(runCodeButton)||n.add(runCodeButton),runCodeButton.visible=!0,runCodeButton.traverse&&runCodeButton.traverse(P=>{P.userData&&(P.userData.clickable=!0)}))}catch{}i=7,console.log("Step 6 completed")})}R.call(a,O)}}function C(){if(console.log("Step 6: Drag ldrTestingCube to adjust RGB LED brightness"),playAudio("lesson3_s8"),u.traverse(M=>{M.name==="ledGlass"&&M.isMesh&&(s=M)}),!s){console.error("ledGlass not found in RGB model");return}s.material.transparent||(s.material.transparent=!0,s.material.needsUpdate=!0);const A=getWorldPosititon$1(d),E=new BoxGeometry(.1,.1,.1),k=new MeshBasicMaterial,I=new Mesh(E,k);I.name="ldrTestingCube",I.position.set(A.x,A.y+.2,A.z),n.add(I),a.addInteractiveObjects(I),r(I.position.y);const F=a.onMouseUp;a.onMouseUp=M=>{if(a.isDragging&&a.draggedComponent===I&&i===7){const R=getWorldPosititon$1(I);r(R.y),console.log("Step 7 interaction completed")}F.call(a,M)}}try{window.startLesson3Step7=()=>{try{typeof i<"u"&&(i=7)}catch{}C()}}catch{}v()}m()}function cleanupKpRgbLesson(n){var e;if(console.log("Starting comprehensive cleanup of lesson3 (RGB/LDR) components..."),console.log("cleanupKpRgbLesson: scene parameter type:",typeof n,"value:",n),!n){console.warn("cleanupKpRgbLesson: scene parameter is undefined or null, skipping cleanup");return}if(typeof n.traverse!="function"){console.warn("cleanupKpRgbLesson: scene.traverse is not a function, scene type:",typeof n);return}try{window.kpL3Raycaster&&typeof window.kpL3Raycaster.dispose=="function"&&window.kpL3Raycaster.dispose(),window.kpL3Raycaster=null}catch{}try{if(window.jstPinRgb&&window.jstPinRgb.getGroup){const t=window.jstPinRgb.getGroup();t&&t.parent&&(t.parent.remove(t),console.log("Removed jstPinRgb group from scene")),window.jstPinRgb.wires&&Array.isArray(window.jstPinRgb.wires)&&(window.jstPinRgb.wires.forEach(o=>{try{typeof o.dispose=="function"&&o.dispose()}catch{}}),console.log("Disposed jstPinRgb wires")),window.jstPinRgb=null,console.log("Cleared jstPinRgb reference")}if(window.jstPin&&window.jstPin.getGroup){const t=window.jstPin.getGroup();t&&t.parent&&(t.parent.remove(t),console.log("Removed global jstPin group from scene")),window.jstPin.wires&&Array.isArray(window.jstPin.wires)&&(window.jstPin.wires.forEach(o=>{try{typeof o.dispose=="function"&&o.dispose()}catch{}}),console.log("Disposed global jstPin wires")),window.jstPin=null,console.log("Cleared global jstPin reference")}window.batteryWire2&&window.batteryWire2.parent&&(window.batteryWire2.parent.remove(window.batteryWire2),console.log("Removed batteryWire2 from scene"),window.batteryWire2=null,console.log("Cleared batteryWire2 reference")),window.ldrModel&&(window.ldrModel=null,console.log("Cleared ldrModel reference")),window.rgbLedModel&&(window.rgbLedModel=null,console.log("Cleared rgbLedModel reference")),window.jstPin2&&(window.jstPin2=null,console.log("Cleared jstPin2 reference")),window.expansionBoardModel&&(window.expansionBoardModel=null,console.log("Cleared expansionBoardModel reference")),window.nanoModel&&(window.nanoModel=null,console.log("Cleared nanoModel reference")),window.getCurrentLesson&&typeof window.getCurrentLesson=="function"&&(delete window.getCurrentLesson,console.log("Cleared getCurrentLesson function")),window.getCurrentStep&&typeof window.getCurrentStep=="function"&&(delete window.getCurrentStep,console.log("Cleared getCurrentStep function"));try{n&&typeof n.traverse=="function"&&n.traverse(t=>{t.userData&&t.userData.kpLesson3===!0&&t.parent&&(t.parent.remove(t),console.log(`Removed lesson3-tagged model: ${t.name||"unnamed"}`))})}catch(t){console.warn("Error cleaning up lesson3-tagged models:",t)}try{let t=null;n&&typeof n.traverse=="function"&&n.traverse(o=>{o.name==="table2"&&(t=o)}),t&&t.children.length===0&&t.parent&&(t.parent.remove(t),console.log("Removed empty table2 after lesson3 cleanup"))}catch(t){console.warn("Error cleaning up table2:",t)}}catch(t){console.warn("Error cleaning up jstPinRgb:",t)}try{JstXhFemalePin$1&&typeof JstXhFemalePin$1<"u"&&typeof JstXhFemalePin$1.getAllModels=="function"&&(JstXhFemalePin$1.getAllModels()||[]).forEach(o=>{const i=(o==null?void 0:o.instance)||o,s=i&&typeof i.getGroup=="function"?i.getGroup():(i==null?void 0:i.group)||(o==null?void 0:o.group);s&&s.parent&&s.parent.remove(s);try{i&&Array.isArray(i.wires)&&i.wires.forEach(r=>{try{typeof r.dispose=="function"&&r.dispose()}catch{}})}catch{}})}catch{}try{if(!((e=allAssets$4==null?void 0:allAssets$4.models)!=null&&e.gltf)){console.warn("cleanupKpRgbLesson: allAssets.models.gltf is not available");return}const t=allAssets$4.models.gltf.nano,o=allAssets$4.models.gltf.expansionBoard,i=allAssets$4.models.gltf.ldr,s=allAssets$4.models.gltf.rgbLed;[i,s].forEach(r=>{try{r&&r.parent&&r.parent.remove(r)}catch{}}),[t,o].forEach(r=>{try{if(!r)return;n&&r.parent!==n&&n.add(r)}catch{}})}catch{}try{let t=null;n&&typeof n.traverse=="function"&&n.traverse(o=>{o.name==="ldrTestingCube"&&(t=o)}),t&&t.parent&&t.parent.remove(t)}catch{}}const lessonSteps={lesson1:["Insert the JST-XH connector into the RGB port on the expansion board.","Attach the  opposite side of the JST-XH connector on the RGB LED.","Connect the Arduino Nano to the expansion board.","Connect the JST-XH connector from the battery to the expansion board power pin",""],lesson2:["Buzzer","Connect the JST-XH connector into the  buzzer port on the expansion board.","Connect the another side JST-XH connector into the buzzer","Connect the Arduino Nano to the expansion board","Connect the JST-XH connector from the battery to the expansion board power pin"],lesson3:["LDR SENSOR","Connect the Arduino Nano to the expansion board.","Connect the JST-XH connector to the ldr male connector on the expansion board.","Connect the JST-XH connector to the ldr male connector on the LDR Module.","Connect the JST-XH connector to the Led male connector on the expansion board.","Connect the JST-XH connector to the Led male connector on the Led Module.","Connect the Battery JSX Female Pin to Expansion Board"],lesson4:["MOTOR DRIVER","Connect the Arduino Nano to the expansion board.","Connect the JST-XH connector from the motor to the motor driver.","Connect the JST-XH connector to the motor driver pin of expansion board","Connect the JST-XH connector to the motor driver male connector.","Connect the JST-XH connector from the battery to the motor driver","Connect the JST-XH connector from the battery to the expansion board power pin ","Test the motor driver setup.","Complete motor driver lesson.","Transition to next lesson."],lesson5:["IR SENSOR","Connect the Arduino Nano to the expansion board.","Connect the JST-XH connector to the TSOP sensor.","Connect the JST-XH connector to the TSOP pin on expansion board.","Connect the JST-XH connector from the motor to the motor driver.","Connect the JST-XH connector to the motor driver pin of expansion board","Connect the JST-XH connector to the motor driver male connector.","Connect the JST-XH connector from the battery to the motor driver","Connect the JST-XH connector from the battery to the expansion board power pin "]},titleSteps={lesson1:[],lesson2:[0],lesson3:[0],lesson4:[0],lesson5:[0]};let currentLessonId="lesson1",currentStep=0;function isCurrentStepTitle(){return titleSteps[currentLessonId]&&titleSteps[currentLessonId].includes(currentStep)}function updateNextButtonState(){setForwardArrowEnabled(!1);const n=currentLessonId,e=currentStep;if(n==="lesson1"){if(e===0)setForwardArrowEnabled(!0);else if(e!==1){if(e!==2){if(isLastStep()){runCodeButton.visible=!0,console.log("Last step - showing runCodeButton");try{window._lesson1StartCodingAudioPlayed||(playAudio("lesson1_s5"),window._lesson1StartCodingAudioPlayed=!0)}catch(t){console.warn("Failed to play lesson1_s5:",t)}}}}}else if(n==="lesson2")e===0&&setForwardArrowEnabled(!0);else if(n==="lesson3"){if(e===0)setForwardArrowEnabled(!0);else if(e!==1){if(e!==2){if(e!==3){if(e!==4){if(isLastStep()){runCodeButton.visible=!0,console.log("Last step - showing runCodeButton");try{window._lesson3StartCodingAudioPlayed||(playAudio("lesson3_s5"),window._lesson3StartCodingAudioPlayed=!0)}catch(t){console.warn("Failed to play lesson3_s5:",t)}}}}}}}else n==="lesson4"?e===0&&setForwardArrowEnabled(!0):n==="lesson5"&&(e===0?setForwardArrowEnabled(!0):e===1||e===2||e===3||e===4||e===5||e===6||e===7||e===8&&setForwardArrowEnabled(!1))}const runCodeButton=new __webpack_exports__default.Block({width:.55,height:.12,justifyContent:"center",contentDirection:"row",borderRadius:.05,backgroundOpacity:1,backgroundColor:new Color(16777215),fontFamily:FontJSON,fontTexture:FontImage,fontSize:.07,padding:.04}).add(new __webpack_exports__default.Text({content:"Start Coding"}));runCodeButton.set({backgroundColor:new Color(16777215),backgroundOpacity:1,fontColor:new Color(0)});runCodeButton.position.set(.2,2.1,-4.01);runCodeButton.userData.clickable=!0;runCodeButton.visible=!1;runCodeButton.traverse(n=>{n.isMesh&&(n.userData.clickable=!0,n.userData.parentButton=runCodeButton)});function setLesson(n){if(lessonSteps[n]){if(console.log(" setLesson called with:",n,"previous lesson was:",currentLessonId),console.log(" Current step before transition:",currentStep),console.log(" Window currentLessonId before transition:",window.currentLessonId),currentLessonId==="lesson1"&&n==="lesson2"){console.log(" DETECTED lesson1->lesson2 transition - attempting to play lesson1_s8");try{console.log(" Calling playAudio('lesson1_s8')");const e=playAudio("lesson1_s8");console.log(" playAudio result:",e),allAssets$4&&allAssets$4.audios?(console.log(" Available audios:",Object.keys(allAssets$4.audios)),console.log(" lesson1_s8 audio object:",allAssets$4.audios.lesson1_s8),allAssets$4.audios.lesson1_s8&&console.log(" Audio object details:",{hasBuffer:!!allAssets$4.audios.lesson1_s8.buffer,isPlaying:allAssets$4.audios.lesson1_s8.isPlaying,volume:allAssets$4.audios.lesson1_s8.getVolume?allAssets$4.audios.lesson1_s8.getVolume():"N/A"})):console.log(" allAssets.audios not available")}catch(e){console.error(" Failed to play lesson1_s8 audio during lesson1->lesson2 transition:",e)}}if(currentLessonId==="lesson2"&&n==="lesson3"){console.log(" DETECTED lesson2->lesson3 transition - attempting to play lesson2_s8"),console.log(" allAssets object:",allAssets$4),console.log(" allAssets.audios:",allAssets$4==null?void 0:allAssets$4.audios);try{console.log(" Calling playAudio('lesson2_s8')");const e=playAudio("lesson2_s8");console.log(" playAudio result:",e),allAssets$4&&allAssets$4.audios?(console.log(" Available audios:",Object.keys(allAssets$4.audios)),console.log(" lesson2_s8 audio object:",allAssets$4.audios.lesson2_s8),allAssets$4.audios.lesson2_s8?console.log(" Audio object details:",{hasBuffer:!!allAssets$4.audios.lesson2_s8.buffer,isPlaying:allAssets$4.audios.lesson2_s8.isPlaying,volume:allAssets$4.audios.lesson2_s8.getVolume?allAssets$4.audios.lesson2_s8.getVolume():"N/A"}):(console.log(" lesson2_s8 is undefined in allAssets.audios"),console.log(" This means the audio file failed to load during asset loading"))):console.log(" allAssets.audios not available")}catch(e){console.error(" Failed to play lesson2_s8 audio during lesson2->lesson3 transition:",e)}}if(currentLessonId==="lesson3"&&n==="lesson4"){console.log(" DETECTED lesson3->lesson4 transition - attempting to play lesson3_s10");try{console.log(" Calling playAudio('lesson3_s10')");const e=playAudio("lesson3_s10");console.log(" playAudio result:",e),allAssets$4&&allAssets$4.audios?(console.log(" Available audios:",Object.keys(allAssets$4.audios)),console.log(" lesson3_s10 audio object:",allAssets$4.audios.lesson3_s10),allAssets$4.audios.lesson3_s10?console.log(" Audio object details:",{hasBuffer:!!allAssets$4.audios.lesson3_s10.buffer,isPlaying:allAssets$4.audios.lesson3_s10.isPlaying,volume:allAssets$4.audios.lesson3_s10.getVolume?allAssets$4.audios.lesson3_s10.getVolume():"N/A"}):(console.log(" lesson3_s10 is undefined in allAssets.audios"),console.log(" This means the audio file failed to load during asset loading"))):console.log(" allAssets.audios not available")}catch(e){console.error(" Failed to play lesson3_s10 audio during lesson3->lesson4 transition:",e)}}if(currentLessonId==="lesson4"&&n==="lesson5"){console.log(" DETECTED lesson4->lesson5 transition - attempting to play lesson4_s9");try{console.log(" Calling playAudio('lesson4_s9')");const e=playAudio("lesson4_s9");console.log(" playAudio result:",e),allAssets$4&&allAssets$4.audios?(console.log(" Available audios:",Object.keys(allAssets$4.audios)),console.log(" lesson4_s9 audio object:",allAssets$4.audios.lesson4_s9),allAssets$4.audios.lesson4_s9?console.log(" Audio object details:",{hasBuffer:!!allAssets$4.audios.lesson4_s9.buffer,isPlaying:allAssets$4.audios.lesson4_s9.isPlaying,volume:allAssets$4.audios.lesson4_s9.getVolume?allAssets$4.audios.lesson4_s9.getVolume():"N/A"}):(console.log(" lesson4_s9 is undefined in allAssets.audios"),console.log(" This means the audio file failed to load during asset loading"))):console.log(" allAssets.audios not available")}catch(e){console.error(" Failed to play lesson4_s9 audio during lesson4->lesson5 transition:",e)}}if(currentLessonId==="lesson5"&&n==="lesson6"){console.log(" DETECTED lesson5->lesson6 transition - attempting to play lesson5_s9");try{console.log(" Calling playAudio('lesson5_s9')");const e=playAudio("lesson5_s9");console.log(" playAudio result:",e),allAssets$4&&allAssets$4.audios?(console.log(" Available audios:",Object.keys(allAssets$4.audios)),console.log(" lesson5_s9 audio object:",allAssets$4.audios.lesson5_s9),allAssets$4.audios.lesson5_s9?console.log(" Audio object details:",{hasBuffer:!!allAssets$4.audios.lesson5_s9.buffer,isPlaying:allAssets$4.audios.lesson5_s9.isPlaying,volume:allAssets$4.audios.lesson5_s9.getVolume?allAssets$4.audios.lesson5_s9.getVolume():"N/A"}):(console.log(" lesson5_s9 is undefined in allAssets.audios"),console.log(" This means the audio file failed to load during asset loading"))):console.log(" allAssets.audios not available")}catch(e){console.error(" Failed to play lesson5_s9 audio during lesson5->lesson6 transition:",e)}}console.log(" Transition check - currentLessonId:",currentLessonId,"lessonId:",n),console.log(" lesson2->lesson3 condition:",currentLessonId==="lesson2"&&n==="lesson3"),cleanupShader(),currentLessonId=n,window.currentLessonId=currentLessonId,console.log(" After transition - currentLessonId:",currentLessonId,"window.currentLessonId:",window.currentLessonId);try{window.getCurrentLesson=function(){return currentLessonId},window.getCurrentStep=function(){return currentStep}}catch{}currentStep=0;try{window._lesson1ContinueAudioPlayed=!1}catch{}try{window._lesson1StartCodingAudioPlayed=!1}catch{}try{window._lesson3StartCodingAudioPlayed=!1}catch{}try{window._lesson4S6TransitionSetUp=!1}catch{}try{window._lesson5AudioSequenceSetUp=!1}catch{}try{window._lesson5ContinueAudioPlayed=!1}catch{}updateNextButtonState();try{typeof window.setCodeEditorLesson=="function"&&window.setCodeEditorLesson(n)}catch(e){console.warn("setCodeEditorLesson call failed:",e)}if(n==="lesson3"){console.log("Starting lesson3 with scene:",scene$7,"camera:",window.camera);try{if(!scene$7||!window.camera){console.error("Scene or camera not available for lesson3");return}KpRgbDefault(scene$7,window.camera),console.log("Lesson3 has started - call your function here!")}catch(e){console.error("Error starting lesson3:",e)}}if(n==="lesson4"){console.log("Starting lesson4 with scene:",scene$7,"camera:",window.camera);try{if(!scene$7||!window.camera){console.error("Scene or camera not available for lesson4");return}window._motorLessonInitialized?console.log("[Lesson4] KpMotorLesson already initialized, skipping"):(window._motorLessonInitialized=!0,console.log("[Lesson4] KpMotorLesson initialized (once)")),console.log("Lesson4 has started - motor lesson initialized!")}catch(e){console.error("Error starting lesson4:",e)}}if(n==="lesson5"){console.log("Starting lesson5 with scene:",scene$7,"camera:",window.camera);try{if(!scene$7||!window.camera){console.error("Scene or camera not available for lesson5");return}window._irLessonInitialized?console.log("[Lesson5] KpIRLesson already initialized, skipping"):(window._irLessonInitialized=!0,console.log("[Lesson5] KpIRLesson initialized (once)")),console.log("Lesson5 has started - IR lesson initialized!")}catch(e){console.error("Error starting lesson5:",e)}}console.log("setLesson completed. Current lesson is now:",currentLessonId)}else console.warn("Lesson ID not found:",n)}function getCurrentStepText(){return lessonSteps[currentLessonId][currentStep]}function getCurrentStep$1(){return currentStep}function getTotalSteps(){return lessonSteps[currentLessonId].length}function isLastStep(){return currentStep===lessonSteps[currentLessonId].length-1}function nextStep(){if(currentStep<lessonSteps[currentLessonId].length-1){if(currentStep++,currentLessonId==="lesson2"){let n=null;switch(currentStep){case 1:n="lesson2_s1";break;case 2:n="lesson2_s2";break;case 3:n="lesson2_s3";break;case 4:n="lesson2_s4";break;case 5:n="lesson2_s5";break}if(n){console.log(` Revealing lesson2 step ${currentStep} - playing ${n} audio`);try{playAudio(n),currentStep===4&&n==="lesson2_s4"&&(console.log(" Setting up audio sequence: lesson2_s4  lesson2_s5"),setTimeout(()=>{console.log(" lesson2_s4 finished, now playing lesson2_s5");try{playAudio("lesson2_s5")}catch(e){console.error(" Failed to play lesson2_s5 in sequence:",e)}},5e3))}catch(e){console.error(` Failed to play ${n} audio:`,e)}}}if(currentLessonId==="lesson3"){console.log(" Lesson3 detected - checking step:",currentStep);let n=null;switch(currentStep){case 1:n="lesson3_s1";break;case 2:n="lesson3_s2";break;case 3:n="lesson3_s3";break;case 4:n="lesson3_s4";break;case 5:n="lesson3_s5";break;case 6:n="lesson3_s6";break;case 7:n="lesson3_s7";break;case 8:n="lesson3_s8";break;case 9:n="lesson3_s9";break}if(console.log(" Audio to play:",n),n){console.log(` Revealing lesson3 step ${currentStep} - playing ${n} audio`),allAssets$4.audios&&(console.log(" Available audios in lesson3:",Object.keys(allAssets$4.audios)),console.log(` ${n} audio object:`,allAssets$4.audios[n]),allAssets$4.audios[n]||(console.error(` ${n} is not found in allAssets.audios`),console.error(" This means the lesson3 audio files failed to load"),console.log(" Checking assetsEntry for lesson3 audio files..."),console.log(" allAssets object structure:",allAssets$4),console.log(" allAssets.audios object:",allAssets$4.audios),["lesson3_s1","lesson3_s2","lesson3_s3","lesson3_s4","lesson3_s5","lesson3_s6","lesson3_s7","lesson3_s8","lesson3_s9"].forEach(t=>{console.log(` ${t}:`,allAssets$4.audios[t]?"EXISTS":"MISSING")})));try{if(playAudio(n),currentStep===6&&n==="lesson3_s6"){console.log(" Setting up audio sequence: lesson3_s6  lesson3_s7");const e=()=>{console.log(" lesson3_s6 finished, now playing lesson3_s7");try{playAudio("lesson3_s7"),window.removeEventListener("audioComplete-lesson3_s6",e)}catch(t){console.error(" Failed to play lesson3_s7 in sequence:",t)}};window.addEventListener("audioComplete-lesson3_s6",e)}currentStep===8&&n==="lesson3_s8"&&(console.log(" Setting up audio sequence: lesson3_s8  lesson3_s9"),setupLesson3S8ToS9Transition()),currentStep===9&&n==="lesson3_s9"&&(console.log(" Setting up audio sequence: lesson3_s9  lesson3_s10"),setupLesson3S9ToS10Transition())}catch(e){console.error(` Failed to play ${n} audio:`,e)}}else console.log(" No audio found for lesson3 step:",currentStep)}if(currentLessonId==="lesson4"){console.log(" Lesson4 detected - checking step:",currentStep);let n=null;switch(currentStep){case 1:n="lesson4_s1";break;case 2:n="lesson4_s2";break;case 3:n="lesson4_s3";break;case 4:n="lesson4_s4";break;case 5:n="lesson4_s5";break;case 6:n="lesson4_s6";break;case 7:n="lesson4_s7";break;case 8:n="lesson4_s8";break;case 9:n="lesson4_s9";break}if(console.log(" Audio to play:",n),n){console.log(` Revealing lesson4 step ${currentStep} - playing ${n} audio`),allAssets$4.audios&&(console.log(" Available audios in lesson4:",Object.keys(allAssets$4.audios)),console.log(` ${n} audio object:`,allAssets$4.audios[n]),allAssets$4.audios[n]||(console.error(` ${n} is not found in allAssets.audios`),console.error(" This means the lesson4 audio files failed to load"),console.log(" Checking assetsEntry for lesson4 audio files..."),console.log(" allAssets object structure:",allAssets$4),console.log(" allAssets.audios object:",allAssets$4.audios),["lesson4_s1","lesson4_s2","lesson4_s3","lesson4_s4","lesson4_s5","lesson4_s6","lesson4_s7","lesson4_s8","lesson4_s9"].forEach(t=>{console.log(` ${t}:`,allAssets$4.audios[t]?"EXISTS":"MISSING")})));try{playAudio(n),currentStep===6&&n==="lesson4_s6"&&(console.log(" Setting up audio sequence: lesson4_s6  lesson4_s7"),setupLesson4S6ToS7Transition())}catch(e){console.error(` Failed to play ${n} audio:`,e)}}else console.log(" No audio found for lesson4 step:",currentStep)}if(currentLessonId==="lesson5"){console.log(" Lesson5 detected - checking step:",currentStep);let n=null;switch(currentStep){case 1:n="lesson5_s1";break;case 2:n="lesson5_s2";break;case 3:n="lesson5_s3";break;case 4:n="lesson5_s4";break;case 5:n="lesson5_s5";break;case 6:n="lesson5_s6";break;case 7:n="lesson5_s7";break;case 8:n="lesson5_s8";break;case 9:n="lesson5_s9";break;case 10:n="lesson5_s10";break;case 11:n="lesson5_s11";break}if(console.log(" Audio to play:",n),n){console.log(` Revealing lesson5 step ${currentStep} - playing ${n} audio`),allAssets$4.audios&&(console.log(" Available audios in lesson5:",Object.keys(allAssets$4.audios)),console.log(` ${n} audio object:`,allAssets$4.audios[n]),allAssets$4.audios[n]||(console.error(` ${n} is not found in allAssets.audios`),console.error(" This means the lesson5 audio files failed to load"),console.log(" Checking assetsEntry for lesson5 audio files..."),console.log(" allAssets object structure:",allAssets$4),console.log(" allAssets.audios object:",allAssets$4.audios),["lesson5_s1","lesson5_s2","lesson5_s3","lesson5_s4","lesson5_s5","lesson5_s6","lesson5_s7","lesson5_s8","lesson5_s9","lesson5_s10","lesson5_s11"].forEach(t=>{console.log(` ${t}:`,allAssets$4.audios[t]?"EXISTS":"MISSING")})));try{playAudio(n)}catch(e){console.error(` Failed to play ${n} audio:`,e)}}else console.log(" No audio found for lesson5 step:",currentStep)}updateNextButtonState()}}const codePlane=new __webpack_exports__default.Block({width:1.8,height:.4,justifyContent:"start",contentDirection:"row",borderRadius:.08,backgroundOpacity:0,fontFamily:FontJSON,fontTexture:FontImage,fontSize:.07,padding:.05});codePlane.set({backgroundOpacity:0});codePlane.update();const codePlaneText=new __webpack_exports__default.Text({content:"",textAlign:"left"});codePlane.add(codePlaneText);codePlane.position.set(0,0,0);codePlane.userData.clickable=!0;codePlane.traverse(n=>{n.userData.clickable=!0,n.userData.parentButton=codePlane});try{codePlane.renderOrder=10,codePlane.traverse(n=>{n.material&&(n.material.depthTest=!0,n.material.depthWrite=!1)})}catch(n){}const beginBlinkButton=new __webpack_exports__default.Block({width:.55,height:.12,justifyContent:"center",contentDirection:"row",borderRadius:.05,backgroundOpacity:1,backgroundColor:new Color(16777215),fontFamily:FontJSON,fontTexture:FontImage,fontSize:.06,padding:.04}).add(new __webpack_exports__default.Text({content:"Begin the Blink!"}));beginBlinkButton.set({backgroundColor:new Color(16777215),backgroundOpacity:1,fontColor:new Color(0)});beginBlinkButton.position.set(.2,2.1,-4.01);beginBlinkButton.userData.clickable=!0;beginBlinkButton.traverse(n=>{n.userData.clickable=!0,n.userData.parentButton=beginBlinkButton});try{beginBlinkButton.renderOrder=10}catch(n){}const forwardArrow=new __webpack_exports__default.Block({width:.4,height:.14,justifyContent:"center",contentDirection:"row",borderRadius:.05,backgroundOpacity:1,backgroundColor:new Color(16777215),fontFamily:FontJSON,fontTexture:FontImage,fontSize:.075,padding:.025}),forwardArrowText=new __webpack_exports__default.Text({content:"Next"});forwardArrow.add(forwardArrowText);forwardArrowText.set({fontColor:new Color(0),color:new Color(0)});forwardArrow.position.set(1,0,0);forwardArrow.userData.clickable=!0;forwardArrow.traverse(n=>{n.userData.clickable=!0,n.userData.parentButton=forwardArrow});try{forwardArrow.renderOrder=10}catch(n){}function setForwardArrowEnabled(n){forwardArrow.userData.clickable=n,forwardArrowText.set({fontColor:n?new Color(0):new Color(8947848),color:n?new Color(0):new Color(8947848)}),forwardArrow.set({backgroundColor:n?new Color(16777215):new Color(13421772),backgroundOpacity:1}),forwardArrow.visible=n,forwardArrow.update()}const nextLessonButton=new __webpack_exports__default.Block({width:.55,height:.12,justifyContent:"center",contentDirection:"row",borderRadius:.05,backgroundOpacity:1,backgroundColor:new Color(16777215),fontFamily:FontJSON,fontTexture:FontImage,fontSize:.07,padding:.04}).add(new __webpack_exports__default.Text({content:"Next Lesson"}));nextLessonButton.set({backgroundColor:new Color(16777215),backgroundOpacity:1,fontColor:new Color(0)});nextLessonButton.position.set(.2,2,-4.01);try{nextLessonButton.renderOrder=1e3,nextLessonButton.traverse(n=>{n.material&&(n.material.depthTest=!1,n.material.depthWrite=!1,n.material.transparent=!0),n.userData&&(n.userData.clickable=!0)})}catch(n){}defineNextLessonButtonClickable();nextLessonButton.visible=!1;function defineNextLessonButtonClickable(){nextLessonButton.userData.clickable=!0,nextLessonButton.traverse(n=>{n.userData.clickable=!0,n.userData.parentButton=nextLessonButton})}function updateCodePlaneWithInstruction(n){if(codePlaneText&&codePlane){const t=isCurrentStepTitle()?.11:.07;codePlaneText.set({content:n,fontSize:t,textAlign:"left"}),codePlane.set({backgroundOpacity:0,backgroundColor:new Color(0)}),codePlane.update(),codePlaneText.update(),isCurrentStepTitle()?(codePlane.visible=!0,hideInstructionsLabel()):(codePlane.visible=!0,n&&n.length>0?showInstructionsLabel():hideInstructionsLabel());try{typeof window<"u"&&typeof window.hideQuestionsPanel=="function"&&window.hideQuestionsPanel()}catch(i){console.warn("Failed to hide questions panel when steps panel is shown:",i)}}}function setCodePlaneToInstructions(){if(codePlaneText){codePlaneText.set({content:"RGB LED",fontSize:.09}),codePlaneText.update();const n=isCurrentStepTitle();codePlane&&(codePlane.visible=!0),hideInstructionsLabel();try{typeof window<"u"&&typeof window.hideQuestionsPanel=="function"&&window.hideQuestionsPanel()}catch(e){console.warn("Failed to hide questions panel when steps panel is shown:",e)}}}function showNextLessonButton(){nextLessonButton.visible=!0,nextLessonButton.userData.clickable=!0,nextLessonButton.traverse(n=>{n.userData.clickable=!0});try{window.codeEditorGroup&&(window.codeEditorGroup.visible=!0)}catch{}try{const n=typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson5";let e=null;nextLessonButton.children.forEach(t=>{t&&typeof t.set=="function"&&t.isUI&&(e=t)}),e&&e.set({content:n?"Lets Build":"Next Lesson"})}catch{}attachNextLessonHandler();try{typeof __webpack_exports__default<"u"&&__webpack_exports__default.update&&__webpack_exports__default.update()}catch{}}function hideNextLessonButton(){nextLessonButton.visible=!1,detachNextLessonHandler()}function attachNextLessonHandler(){window._nextLessonRaycastHandler||(window._nextLessonRaycastHandler=n=>{const e=new Vector2$1(n.clientX/window.innerWidth*2-1,-(n.clientY/window.innerHeight)*2+1),t=new Raycaster,o=window.camera||window._sceneCamera;if(!o)return;t.setFromCamera(e,o),t.intersectObjects([nextLessonButton],!0).length>0&&nextLessonButton.visible&&typeof onNextLesson=="function"&&onNextLesson()},window.addEventListener("pointerdown",window._nextLessonRaycastHandler))}function detachNextLessonHandler(){window._nextLessonRaycastHandler&&(window.removeEventListener("pointerdown",window._nextLessonRaycastHandler),window._nextLessonRaycastHandler=null)}let onNextLesson=null;function setOnNextLesson(n){onNextLesson=n}const makeSomeNoiseButton=new __webpack_exports__default.Block({width:.55,height:.12,justifyContent:"center",contentDirection:"row",borderRadius:.05,backgroundOpacity:1,backgroundColor:new Color(16777215),fontFamily:FontJSON,fontTexture:FontImage,fontSize:.05,padding:.04}).add(new __webpack_exports__default.Text({content:"Make Some Noise!"}));makeSomeNoiseButton.set({backgroundColor:new Color(16777215),backgroundOpacity:1,fontColor:new Color(0)});makeSomeNoiseButton.position.set(.2,2,-4.01);makeSomeNoiseButton.visible=!1;makeSomeNoiseButton.userData.clickable=!0;makeSomeNoiseButton.traverse(n=>{n.userData.clickable=!0,n.userData.parentButton=makeSomeNoiseButton});const showBlinkingButton=new __webpack_exports__default.Block({width:.8,height:.15,justifyContent:"center",contentDirection:"row",borderRadius:.05,backgroundOpacity:.85,fontFamily:FontJSON,fontTexture:FontImage,fontSize:.08,padding:.05}).add(new __webpack_exports__default.Text({content:"Show blinking"}));showBlinkingButton.position.set(.2,1.9,-4.01);showBlinkingButton.visible=!1;showBlinkingButton.userData.clickable=!0;showBlinkingButton.traverse(n=>{n.userData.clickable=!0,n.userData.parentButton=showBlinkingButton});const instructionsLabel=new __webpack_exports__default.Block({width:.48,height:.08,justifyContent:"center",contentDirection:"row",borderRadius:.02,backgroundOpacity:.8,backgroundColor:new Color(2899536),fontFamily:FontJSON,fontTexture:FontImage,fontSize:.08,padding:.02}).add(new __webpack_exports__default.Text({content:"Instructions",color:new Color(16777215)}));instructionsLabel.position.set(.2,2.8,-4.01);instructionsLabel.visible=!1;try{instructionsLabel.renderOrder=10}catch(n){}function showInstructionsLabel(){instructionsLabel&&(instructionsLabel.visible=!0,instructionsLabel.update())}function hideInstructionsLabel(){instructionsLabel&&(instructionsLabel.visible=!1,instructionsLabel.update())}window.getCurrentLesson=function(){return console.log("getCurrentLesson called, returning:",currentLessonId),currentLessonId};function setupLesson3S8ToS9Transition(){if(console.log(" Setting up lesson3_s8  lesson3_s9 transition"),window._lesson3S8TransitionSetUp){console.log(" Transition already set up, skipping...");return}const n=()=>{console.log(" EVENT FIRED: lesson3_s8 finished, now playing lesson3_s9");try{console.log(" Attempting to play lesson3_s9...");const e=playAudio("lesson3_s9");console.log(" playAudio result:",e),window._lesson3S8TransitionSetUp=!1}catch(e){console.error(" Failed to play lesson3_s9 in sequence:",e)}};window.addEventListener("audioComplete-lesson3_s8",n),console.log(" Event listener added successfully for audioComplete-lesson3_s8"),window._lesson3S8TransitionSetUp=!0}window.addEventListener("audioComplete-lesson3_s8",()=>{if(console.log(" GLOBAL EVENT: audioComplete-lesson3_s8 fired!"),typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson3"){console.log(" AUTO-TRANSITION: lesson3_s8 completed, automatically playing lesson3_s9");try{const n=playAudio("lesson3_s9");console.log(" Auto-transition result:",n)}catch(n){console.error(" Auto-transition failed:",n)}}});window.addEventListener("audioComplete-lesson3_s6",()=>{console.log(" GLOBAL EVENT: audioComplete-lesson3_s6 fired!")});function setupLesson3S9ToS10Transition(){if(console.log(" Setting up lesson3_s9  lesson3_s10 transition"),window._lesson3S9TransitionSetUp){console.log(" lesson3_s9  lesson3_s10 transition already set up, skipping...");return}const n=()=>{console.log(" EVENT FIRED: lesson3_s9 finished, now playing lesson3_s10");try{if(!window._lesson3S10Played){const e=playAudio("lesson3_s10");console.log(" playAudio result (s10):",e),window._lesson3S10Played=!0}}catch(e){console.error(" Failed to play lesson3_s10 in sequence:",e)}finally{try{window.removeEventListener("audioComplete-lesson3_s9",n)}catch{}window._lesson3S9TransitionSetUp=!1}};window.addEventListener("audioComplete-lesson3_s9",n),window._lesson3S9TransitionSetUp=!0}window.addEventListener("audioComplete-lesson3_s9",()=>{if(console.log(" GLOBAL EVENT: audioComplete-lesson3_s9 fired!"),typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson3")try{if(!window._lesson3S10Played){const n=playAudio("lesson3_s10");console.log(" Global auto-transition result (s10):",n),window._lesson3S10Played=!0}}catch(n){console.error(" Global auto-transition to lesson3_s10 failed:",n)}});window.addEventListener("audioComplete-lesson3_s10",()=>{if(console.log(" GLOBAL EVENT: audioComplete-lesson3_s10 fired!"),typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson3")try{try{setForwardArrowEnabled(!1)}catch{}try{forwardArrow&&(forwardArrow.visible=!1)}catch{}showNextLessonButton()}catch(n){console.error(" Failed to show Next Lesson after lesson3_s10:",n)}});window.testLesson3AudioSequence=function(){console.log(" TESTING: Manual test of lesson3 audio sequence"),console.log(" Attempting to play lesson3_s8...");try{const n=playAudio("lesson3_s8");console.log(" lesson3_s8 play result:",n),setTimeout(()=>{console.log(" MANUAL TEST: Dispatching audioComplete-lesson3_s8 event"),window.dispatchEvent(new CustomEvent("audioComplete-lesson3_s8"))},3e3)}catch(n){console.error(" Failed to play lesson3_s8 in test:",n)}};function setupLesson4S6ToS7Transition(){if(console.log(" Setting up lesson4_s6  lesson4_s7 transition"),window._lesson4S6TransitionSetUp){console.log(" Transition already set up, skipping...");return}const n=()=>{console.log(" EVENT FIRED: lesson4_s6 finished, now playing lesson4_s7");try{console.log(" Attempting to play lesson4_s7...");const e=playAudio("lesson4_s7");console.log(" playAudio result:",e),window._lesson4S6TransitionSetUp=!1}catch(e){console.error(" Failed to play lesson4_s7 in sequence:",e)}};window.addEventListener("audioComplete-lesson4_s6",n),console.log(" Event listener added successfully for audioComplete-lesson4_s6"),window._lesson4S6TransitionSetUp=!0}window.addEventListener("audioComplete-lesson4_s6",()=>{if(console.log(" GLOBAL EVENT: audioComplete-lesson4_s6 fired!"),typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson4"){console.log(" AUTO-TRANSITION: lesson4_s6 completed, automatically playing lesson4_s7");try{const n=playAudio("lesson4_s7");console.log(" Auto-transition result:",n)}catch(n){console.error(" Auto-transition failed:",n)}}});window.addEventListener("audioComplete-lesson4_s7",()=>{console.log(" GLOBAL EVENT: audioComplete-lesson4_s7 fired!"),typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson4"&&console.log(" lesson4_s7 completed in lesson4")});window.addEventListener("audioComplete-lesson5_s8",()=>{if(console.log(" GLOBAL EVENT: audioComplete-lesson5_s8 fired!"),typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson5"){console.log(" FALLBACK: lesson5_s8 completed, automatically playing lesson5_s9");try{const n=playAudio("lesson5_s9");console.log(" Fallback playAudio result:",n)}catch(n){console.error(" Fallback failed:",n)}}});window.addEventListener("audioComplete-lesson5_s9",()=>{console.log(" GLOBAL EVENT: audioComplete-lesson5_s9 fired!")});window.addEventListener("audioComplete-lesson5_s10",()=>{console.log(" GLOBAL EVENT: audioComplete-lesson5_s10 fired!")});window.addEventListener("audioComplete-lesson5_s11",()=>{console.log(" GLOBAL EVENT: audioComplete-lesson5_s11 fired!"),console.log(" lesson5_s11 completed, automatically playing final audio");try{const n=playAudio("final");console.log(" Final audio play result:",n)}catch(n){console.error(" Failed to play final audio after lesson5_s11:",n)}});window.testLesson4Audio=function(){if(console.log(" TESTING: Manual test of lesson4 audio"),console.log(" Checking if lesson4 audio files are loaded..."),allAssets$4.audios){console.log(" Available audios:",Object.keys(allAssets$4.audios)),["lesson4_s1","lesson4_s2","lesson4_s3","lesson4_s4","lesson4_s5","lesson4_s6","lesson4_s7","lesson4_s8","lesson4_s9"].forEach(e=>{console.log(` ${e}:`,allAssets$4.audios[e]?"EXISTS":"MISSING")});try{console.log(" Attempting to play lesson4_s1...");const e=playAudio("lesson4_s1");console.log(" lesson4_s1 play result:",e)}catch(e){console.error(" Failed to play lesson4_s1:",e)}}else console.error(" allAssets or allAssets.audios not available")};window.testLesson4AudioSequence=function(){console.log(" TESTING: Manual test of lesson4 audio sequence"),console.log(" Attempting to play lesson4_s6...");try{const n=playAudio("lesson4_s6");console.log(" lesson4_s6 play result:",n),setTimeout(()=>{console.log(" MANUAL TEST: Dispatching audioComplete-lesson4_s6 event"),window.dispatchEvent(new CustomEvent("audioComplete-lesson4_s6"))},3e3)}catch(n){console.error(" Failed to play lesson4_s6 in test:",n)}};window.testLesson4S7Audio=function(){console.log(" TESTING: Manual test of lesson4_s7 audio");try{const n=playAudio("lesson4_s7");console.log(" lesson4_s7 play result:",n)}catch(n){console.error(" Failed to play lesson4_s7:",n)}};window.testLesson4S9Audio=function(){console.log(" TESTING: Manual test of lesson4_s9 audio");try{const n=playAudio("lesson4_s9");console.log(" lesson4_s9 play result:",n)}catch(n){console.error(" Failed to play lesson4_s9:",n)}};window.testLesson5Audio=function(){if(console.log(" TESTING: Manual test of lesson5 audio"),console.log(" Checking if lesson5 audio files are loaded..."),allAssets$4.audios){console.log(" Available audios:",Object.keys(allAssets$4.audios)),["lesson5_s1","lesson5_s2","lesson5_s3","lesson5_s4","lesson5_s5","lesson5_s6","lesson5_s7","lesson5_s8","lesson5_s9","lesson5_s10","lesson5_s11"].forEach(e=>{console.log(` ${e}:`,allAssets$4.audios[e]?"EXISTS":"MISSING")});try{console.log(" Attempting to play lesson5_s1...");const e=playAudio("lesson5_s1");console.log(" lesson5_s1 play result:",e)}catch(e){console.error(" Failed to play lesson5_s1:",e)}}else console.error(" allAssets or allAssets.audios not available")};window.testLesson5S8Audio=function(){console.log(" TESTING: Manual test of lesson5_s8 audio");try{const n=playAudio("lesson5_s8");console.log(" lesson5_s8 play result:",n)}catch(n){console.error(" Failed to play lesson5_s8:",n)}};window.testLesson5S9Audio=function(){console.log(" TESTING: Manual test of lesson5_s9 audio");try{const n=playAudio("lesson5_s9");console.log(" lesson5_s9 play result:",n)}catch(n){console.error(" Failed to play lesson5_s9:",n)}};window.testLesson5S10Audio=function(){console.log(" TESTING: Manual test of lesson5_s10 audio");try{const n=playAudio("lesson5_s10");console.log(" lesson5_s10 play result:",n)}catch(n){console.error(" Failed to play lesson5_s10:",n)}};window.testLesson5S11Audio=function(){console.log(" TESTING: Manual test of lesson5_s11 audio");try{const n=playAudio("lesson5_s11");console.log(" lesson5_s11 play result:",n)}catch(n){console.error(" Failed to play lesson5_s11:",n)}};window.testFinalAudio=function(){console.log(" TESTING: Manual test of final audio");try{const n=playAudio("final");console.log(" Final audio play result:",n)}catch(n){console.error(" Failed to play final audio:",n)}};window.testLesson5S11ToFinalSequence=function(){console.log(" TESTING: Manual test of lesson5_s11  final audio sequence");try{const n=playAudio("lesson5_s11");console.log(" lesson5_s11 play result:",n),console.log(" lesson5_s11 started - final audio should play automatically when it completes")}catch(n){console.error(" Failed to play lesson5_s11 in sequence test:",n)}};window.testLesson5AudioSequence=function(){console.log(" TESTING: Manual test of lesson5 audio sequence"),console.log(" Attempting to play lesson5_s8...");try{const n=playAudio("lesson5_s8");console.log(" lesson5_s8 play result:",n),setTimeout(()=>{console.log(" MANUAL TEST: Dispatching audioComplete-lesson5_s8 event"),window.dispatchEvent(new CustomEvent("audioComplete-lesson5_s8"))},3e3)}catch(n){console.error(" Failed to play lesson5_s8 in test:",n)}};window.testLesson5S9Direct=function(){console.log(" TESTING: Direct test of lesson5_s9 audio");try{const n=playAudio("lesson5_s9");console.log(" lesson5_s9 direct play result:",n)}catch(n){console.error(" Failed to play lesson5_s9 directly:",n)}};const pinDefinitionsContents=[`#define RGB_RED   9
#define RGB_GREEN 10
#define RGB_BLUE  11

#define: Gives a name to a number.

Here we name pin 9 as RGB_RED, 
pin 10 as RGB_GREEN, and 
pin 11 as RGB_BLUE.

This makes the code easier to read 
instead of writing "pin 9" everywhere.

These pins are PWM-capable (they can 
change brightness, not just on/off).`,"setup() explanation here...","loop() explanation here...","pinMode() explanation here...","digitalWrite() explanation here...","digitalRead() explanation here...","analogWrite() explanation here...","analogRead() explanation here...","delay() explanation here...","Serial.begin() explanation here..."],lessonConfigs=JSON.parse('{"lesson1":{"labels":["#define","setup()","loop()","pinMode()","setRGBColor()","analogWrite()","analogRead()","delay()"],"contents":["#define\\n\\nWhat it is: \\nA preprocessor directive in C/C++ \\nthat replaces a word with a constant value before the program is compiled.\\n\\nHow it works: \\nWhen the compiler sees RGB_RED, it substitutes it with 8 everywhere in the code.\\n\\nWhy useful:\\n Instead of hard-coding numbers (magic numbers), we use names that describe their purpose. \\nThis makes the program easier to read and maintain.\\nIf you ever change the pin, you only edit it once at the top.\\n\\nExample:\\n#define RGB_RED 8   // Name pin 8 as RGB_RED\\n#define RGB_GREEN 7 // Name pin 7 as RGB_GREEN\\n#define RGB_BLUE 11 // Name pin 11 as RGB_BLUE\\n\\nSo later in the program, writing pinMode(RGB_RED, OUTPUT); \\nis much clearer than pinMode(8, OUTPUT);.","setup()\\n\\nWhat it is: A special function in Arduino that runs only once at the beginning of the program (after reset or power-on).\\n\\nPurpose: Used for all initial settings like declaring pin modes, starting serial communication, and setting default values.\\n\\nHow it works: After setup() finishes, Arduino automatically jumps to loop() and never comes back to setup().\\n\\nWhy useful: Separates initialization code from the main running code, keeping programs structured.\\n\\nExample:\\nvoid setup() {\\n  pinMode(RGB_RED, OUTPUT);\\n  pinMode(RGB_GREEN, OUTPUT);\\n  pinMode(RGB_BLUE, OUTPUT);\\n\\n  setRGBColor(255, 255, 255); // LED starts white\\n}","loop()\\n\\nWhat it is: The main function in Arduino that runs over and over forever.\\n\\nHow it works: After setup() finishes, Arduino enters loop(). When it reaches the end, it starts loop() again from the top.\\n\\nWhy useful: It allows your Arduino to react continuously (blink LEDs, read sensors, control motors, etc.).\\n\\nExample:\\nvoid loop() {\\n  setRGBColor(255, 0, 0);   // Red\\n  delay(1000);              // Wait 1 sec\\n  setRGBColor(0, 255, 0);   // Green\\n  delay(1000);\\n  setRGBColor(0, 0, 255);   // Blue\\n  delay(1000);\\n}","pinMode()\\n\\nWhat it is: A built-in Arduino function that tells a pin whether it should be used for INPUT or OUTPUT.\\n\\nHow it works: OUTPUT means the pin sends signals (to LEDs, motors, etc.). INPUT means the pin listens (from buttons, sensors, etc.).\\n\\nWhy useful: Prevents errors  Arduino must know the role of each pin before its used.\\n\\nExample:\\nvoid setup() {\\n  pinMode(RGB_RED, OUTPUT);   // Red pin sends signal to LED\\n  pinMode(RGB_GREEN, OUTPUT); // Green pin sends signal to LED\\n  pinMode(RGB_BLUE, OUTPUT);  // Blue pin sends signal to LED\\n}","setRGBColor()\\n\\nWhat it is: A custom function we wrote. Not built into Arduino.\\n\\nPurpose: Simplifies code by grouping three analogWrite() commands into one reusable function.\\n\\nHow it works: Accepts three numbers (0255) for red, green, and blue. Then writes these values to the LED pins to mix a color.\\n\\nWhy useful: Instead of writing analogWrite() three times everywhere, we just call setRGBColor(). Easier, shorter, less error-prone.\\n\\nExample:\\nvoid setRGBColor(int red, int green, int blue) {\\n  analogWrite(RGB_RED, red);\\n  analogWrite(RGB_GREEN, green);\\n  analogWrite(RGB_BLUE, blue);\\n}","analogWrite()\\n\\nWhat it is: A built-in Arduino function that outputs a PWM signal (Pulse Width Modulation) on certain pins.\\n\\nHow it works: Even though Arduino doesnt have true analog voltage output, PWM rapidly switches the pin on and off so fast that devices (like LEDs or motors) see it as variable brightness or speed.\\n\\nRange: Value can be 0255.\\n   - 0 = always off\\n   - 255 = always on (full brightness)\\n   - 128 = about 50% brightness\\n\\nWhy useful: Lets us dim LEDs or control motor speeds smoothly.\\n\\nExample:\\nanalogWrite(RGB_RED, 128);  // Half brightness red\\nanalogWrite(RGB_GREEN, 255); // Full brightness green","analogRead()\\n\\nWhat it is: A built-in Arduino function that reads a value from an analog input pin (A0A5 on most boards).\\n\\nHow it works: Measures voltage (05V usually) and converts it to a number between 0 and 1023.\\n\\nWhy useful: Lets Arduino understand sensor data (light, temperature, potentiometers, etc.).\\n\\nExample:\\nvoid loop() {\\n  int sensorValue = analogRead(A0);  // Read sensor on pin A0\\n  int brightness = map(sensorValue, 0, 1023, 0, 255); // Convert to 0255\\n  analogWrite(RGB_BLUE, brightness); // Adjust LED brightness with sensor\\n  delay(100);\\n}","delay()\\n\\nWhat it is: A built-in Arduino function that pauses the program for a set time (milliseconds).\\n\\nHow it works: Arduino does nothing else during this pause.\\n\\nTime: 1000 ms = 1 second.\\n\\nWhy useful: Used to create blinking, timing sequences, or slow down loops.\\n\\nExample:\\nvoid loop() {\\n  setRGBColor(255, 255, 255); // White\\n  delay(1000);                // Wait 1 second\\n  setRGBColor(255, 0, 255);   // Purple\\n  delay(1000);                // Wait 1 second\\n}"],"tryThisCode":"#define RGB_RED 8\\n#define RGB_GREEN 7\\n#define RGB_BLUE 11\\n\\nvoid setup() {\\n  // Initialize pins\\n  pinMode(RGB_RED, OUTPUT);\\n  pinMode(RGB_GREEN, OUTPUT);\\n  pinMode(RGB_BLUE, OUTPUT);\\n\\n  // Set initial RGB color for IR mode\\n  setRGBColor(255, 255, 255); // White for IR mode\\n}\\n\\nvoid setRGBColor(int red, int green, int blue) {\\n  analogWrite(RGB_RED, red);\\n  analogWrite(RGB_GREEN, green);\\n  analogWrite(RGB_BLUE, blue);\\n}\\n\\nvoid loop() {\\n  setRGBColor(255, 255, 255); // White\\n  delay(1000);\\n  setRGBColor(255, 0, 255);   // Purple\\n  delay(1000);\\n}\\n"},"lesson2":{"labels":["tone()","noTone()","millis()","for loop","volatile"],"contents":["tone()\\n\\nWhat it is: A built-in Arduino function that generates a square wave (sound) of a specific frequency (in Hz) on a pin connected to a buzzer or speaker.\\n\\nHow it works: You call tone(pin, frequency, duration). The buzzer then plays that note.\\n\\nWhy useful: Lets Arduino make music, alarms, or feedback sounds.\\n\\nExample:\\ntone(BUZZER_PIN, 440, 500); // Play A4 (440Hz) for 0.5 seconds","noTone()\\n\\nWhat it is: A built-in Arduino function that stops any sound being played on a pin by tone().\\n\\nHow it works: When called, it turns off the signal going to the buzzer.\\n\\nWhy useful: Needed to silence the buzzer or end a note early.\\n\\nExample:\\nnoTone(BUZZER_PIN); // Stop buzzer sound","millis()\\n\\nWhat it is: A built-in Arduino function that returns the number of milliseconds since the board was powered on or reset.\\n\\nHow it works: It continuously increases over time and resets after about 50 days.\\n\\nWhy useful: Used for non-blocking timing instead of delay(). This lets you do multiple things at once while still keeping track of time.\\n\\nExample:\\nunsigned long startTime = millis();\\nwhile (millis() - startTime < 1000) {\\n  // wait 1 second without using delay()\\n}","for loop\\n\\nWhat it is: A control structure in C/C++ that repeats a block of code a set number of times.\\n\\nHow it works: for(initialization; condition; increment) { code }\\n\\nWhy useful: Perfect for repeating patterns, like playing through a melody or updating LEDs.\\n\\nExample:\\nfor (int i = 0; i < 8; i++) {\\n  tone(BUZZER_PIN, melody[i], 250);\\n  delay(300);\\n}","volatile\\n\\nWhat it is: A keyword in C/C++ used before a variable declaration.\\n\\nHow it works: Tells the compiler that the variable can change unexpectedly (for example, inside an interrupt). This prevents the compiler from making optimizations that could cause errors.\\n\\nWhy useful: Ensures safe and reliable use of variables that might be modified in the background.\\n\\nExample:\\nvolatile unsigned long lastInterruptTime = 0; // Safe to use inside interrupts"],"tryThisCode":"#define BUZZER_PIN 4 // Buzzer pin\\n\\n// Melody definition (frequencies in Hz and durations in ms)\\nconst int melody[] = {262, 294, 330, 349, 392, 440, 494, 523};        // C4 to C5\\nconst int noteDurations[] = {250, 250, 250, 250, 250, 250, 250, 250}; // Quarter notes\\nconst int melodyLength = 8;\\nvolatile unsigned long lastInterruptTime = 0; // For debouncing\\n\\nvoid setup() {\\n  pinMode(BUZZER_PIN, OUTPUT);\\n}\\n\\nvoid toggleMode() {\\n  noTone(BUZZER_PIN);\\n}\\n\\nvoid playMelody() {\\n  for (int i = 0; i < melodyLength; i++) {\\n    tone(BUZZER_PIN, melody[i], noteDurations[i]);\\n    unsigned long startTime = millis();\\n    while (millis() - startTime < noteDurations[i] * 1.3) {\\n      noTone(BUZZER_PIN);\\n      return;\\n    }\\n  }\\n  noTone(BUZZER_PIN);\\n}\\nvoid loop() {\\n  playMelody();\\n}\\n"},"lesson3":{"labels":["Serial.begin()","Serial.println()","PWM"],"contents":["Serial.begin()\\n\\nWhat it is: A built-in Arduino function that starts the serial communication between the Arduino and your computer.\\n\\nHow it works: You pass a number for speed (called baud rate). Common is 9600, which means 9600 bits per second.\\n\\nWhy useful: Lets Arduino send messages to the Serial Monitor for debugging or data logging.\\n\\nExample:\\nvoid setup() {\\n  Serial.begin(9600); // Start communication\\n  Serial.println(\\"Program started\\");\\n}","Serial.println()\\n\\nWhat it is: A built-in Arduino function that sends text or numbers from the Arduino to your computer.\\n\\nHow it works: Anything inside Serial.println() appears in the Serial Monitor, followed by a new line.\\n\\nWhy useful: Helps you debug by printing sensor values, motor states, or custom messages.\\n\\nExample:\\nSerial.println(\\"Motors stopped\\");\\nSerial.println(speedValue);","DC Motor Control with PWM\\n\\nWhat it is: Using analogWrite() with motor driver pins to control speed and direction of DC motors.\\n\\nHow it works:\\n- Each motor has two pins (A and B). One pin HIGH (or PWM > 0) and the other LOW makes it spin in one direction.\\n- Reversing which pin gets PWM flips the direction.\\n- Giving both pins 0 stops the motor.\\n- PWM value (0255) controls speed.\\n\\nWhy useful: With just two pins per motor, you can fully control forward, backward, stop, and speed.\\n\\nExample:\\n// Forward at full speed\\nanalogWrite(MOTOR1_A, 0);\\nanalogWrite(MOTOR1_B, 255);\\n\\n// Backward at half speed\\nanalogWrite(MOTOR1_A, 128);\\nanalogWrite(MOTOR1_B, 0);\\n\\n// Stop motor\\nanalogWrite(MOTOR1_A, 0);\\nanalogWrite(MOTOR1_B, 0);"],"tryThisCode":"#define MOTOR1_A 5    // Left motor\\n#define MOTOR1_B 6\\n#define MOTOR2_A 9    // Right motor\\n#define MOTOR2_B 10\\n\\nvoid setup() {\\n  pinMode(MOTOR1_A, OUTPUT);\\n  pinMode(MOTOR1_B, OUTPUT);\\n  pinMode(MOTOR2_A, OUTPUT);\\n  pinMode(MOTOR2_B, OUTPUT);\\n  Serial.begin(9600);\\n}\\n\\nvoid loop() {\\n  analogWrite(MOTOR1_A, 0);\\n  analogWrite(MOTOR1_B, 0);\\n  analogWrite(MOTOR2_A, 0);\\n  analogWrite(MOTOR2_B, 0);\\n  Serial.println(\\"Motors stopped\\");\\n  delay(1000);\\n\\n  analogWrite(MOTOR1_A, 0);\\n  analogWrite(MOTOR1_B, 255);\\n  analogWrite(MOTOR2_A, 255);\\n  analogWrite(MOTOR2_B, 0);\\n  Serial.println(\\"Moving forward\\");\\n  delay(1000);\\n\\n  analogWrite(MOTOR1_A, 255);\\n  analogWrite(MOTOR1_B, 0);\\n  analogWrite(MOTOR2_A, 255);\\n  analogWrite(MOTOR2_B, 0);\\n  Serial.println(\\"Moving backward\\");\\n  delay(1000);\\n}"},"lesson4":{"labels":["#include","Function prototype","const keyword","LDR","ifelse","switchcase","Serial.print()"],"contents":["#include\\n\\nWhat it is: A preprocessor directive used to include external libraries or the Arduino core.\\n\\nHow it works: `#include <Arduino.h>` gives access to Arduino functions. `#include <IRremote.h>` adds IR remote control functions from the library.\\n\\nWhy useful: Libraries extend Arduino with ready-made code for sensors, motors, communication, etc.\\n\\nExample:\\n#include <Arduino.h>\\n#include <Servo.h>  // Include Servo motor library","Function prototype\\n\\nWhat it is: A declaration of a function before it is defined.\\n\\nHow it works: Placed at the top of the code so the compiler knows the function exists, even if its full body is written later.\\n\\nWhy useful: Keeps the code organized when functions are defined after `setup()` and `loop()`.\\n\\nExample:\\nvoid setRGBColor(int red, int green, int blue);","const keyword\\n\\nWhat it is: A keyword in C/C++ that makes a variable value constant (cannot be changed after initialization).\\n\\nHow it works: Used for fixed values like thresholds or pin numbers.\\n\\nWhy useful: Prevents accidental changes to values that should stay the same.\\n\\nExample:\\nconst int LDR_LOW = 300;\\nconst int LDR_HIGH = 700;","LDR (Light Dependent Resistor)\\n\\nWhat it is: A sensor that changes resistance with light intensity.\\n\\nHow it works: Connected to an analog pin, `analogRead()` measures a value from 0 (dark) to 1023 (bright).\\n\\nWhy useful: Lets Arduino detect light levels for automatic night lights, alarms, or brightness controls.\\n\\nExample:\\nint ldrValue = analogRead(A7);\\nSerial.println(ldrValue);","ifelse\\n\\nWhat it is: A control structure that runs code only if a condition is true, otherwise runs alternative code.\\n\\nHow it works: Arduino checks the condition and chooses the matching block.\\n\\nWhy useful: Allows decision-making based on sensor values.\\n\\nExample:\\nif (ldrValue < LDR_LOW) {\\n  setRGBColor(255, 0, 0);\\n} else {\\n  setRGBColor(0, 255, 0);\\n}","switchcase\\n\\nWhat it is: A control structure that selects one block of code from many options, based on a variable.\\n\\nHow it works: Arduino checks the variable and jumps to the matching case.\\n\\nWhy useful: Cleaner than writing many ifelse statements when handling multiple modes.\\n\\nExample:\\nswitch (currentMode) {\\n  case LDR_MODE:\\n    handleLDR();\\n    break;\\n  case IR_MODE:\\n    // IR control code\\n    break;\\n}","Serial.print()\\n\\nWhat it is: A function that sends text or numbers to the Serial Monitor without moving to a new line.\\n\\nHow it works: Unlike Serial.println(), it keeps printing on the same line until you add another print/println.\\n\\nWhy useful: Useful for printing sensor data with labels.\\n\\nExample:\\nSerial.print(\\"LDR Value: \\");\\nSerial.println(ldrValue);"],"tryThisCode":"#include <Arduino.h>\\n#include <IRremote.h>\\n\\n#define RGB_RED 8\\n#define RGB_GREEN 7\\n#define RGB_BLUE 11\\n#define LDR_PIN A7\\n\\nconst int LDR_LOW = 300;\\nconst int LDR_HIGH = 700;\\n\\nvoid setRGBColor(int red, int green, int blue);\\n\\nvoid setup() {\\n  pinMode(RGB_RED, OUTPUT);\\n  pinMode(RGB_GREEN, OUTPUT);\\n  pinMode(RGB_BLUE, OUTPUT);\\n  pinMode(LDR_PIN, INPUT);\\n\\n  Serial.begin(9600);\\n  setRGBColor(255, 255, 255);\\n  Serial.println(\\"Started in LDR Mode - RGB: White\\");\\n}\\n\\nvoid setRGBColor(int red, int green, int blue) {\\n  analogWrite(RGB_RED, red);\\n  analogWrite(RGB_GREEN, green);\\n  analogWrite(RGB_BLUE, blue);\\n}\\n\\nvoid handleLDR() {\\n  int ldrValue = analogRead(LDR_PIN);\\n  Serial.print(\\"LDR Value: \\");\\n  Serial.println(ldrValue);\\n\\n  if (ldrValue < LDR_LOW) {\\n    setRGBColor(255, 0, 0);\\n    Serial.println(\\"Low Light -> Red\\");\\n  } else if (ldrValue < LDR_HIGH) {\\n    setRGBColor(0, 255, 0);\\n    Serial.println(\\"Medium Light -> Green\\");\\n  } else {\\n    setRGBColor(0, 0, 255);\\n    Serial.println(\\"High Light -> Blue\\");\\n  }\\n  delay(200);\\n}\\n\\nvoid loop() {\\n  handleLDR();\\n}\\n"},"lesson5":{"labels":["enum","volatile","attachInterrupt()","Debouncing","IRremote library","Motor acceleration","tone() and noTone()","switchcase with IR codes"],"contents":["enum\\n\\nWhat it is: A way to create a set of named constants (enumeration).\\n\\nHow it works: Defines a variable that can only take one of the listed values.\\n\\nWhy useful: Makes mode selection (IR_MODE, MUSIC_MODE, LDR_MODE) more readable and safer than using numbers.\\n\\nExample:\\nenum Mode { IR_MODE, MUSIC_MODE, LDR_MODE };\\nMode currentMode = IR_MODE;","volatile\\n\\nWhat it is: A keyword in C/C++ that tells the compiler a variable may change unexpectedly (e.g., in an interrupt).\\n\\nHow it works: Prevents compiler optimizations that could ignore changes to the variable.\\n\\nWhy useful: Needed when variables are modified inside an interrupt function (e.g., currentMode, lastInterruptTime).\\n\\nExample:\\nvolatile Mode currentMode = IR_MODE;","attachInterrupt()\\n\\nWhat it is: A function that runs a special function automatically when a pin changes state.\\n\\nHow it works: Uses hardware interrupts instead of constantly checking the pin in loop().\\n\\nWhy useful: Allows instant response to a button press for changing modes.\\n\\nExample:\\nattachInterrupt(digitalPinToInterrupt(BUTTON_PIN), toggleMode, FALLING);","Debouncing\\n\\nWhat it is: A method to prevent false multiple button presses caused by mechanical noise.\\n\\nHow it works: Use a time delay (like DEBOUNCE_DELAY) before accepting another press.\\n\\nWhy useful: Ensures stable button mode switching.\\n\\nExample:\\nif (millis() - lastInterruptTime > DEBOUNCE_DELAY) { ... }","IRremote library\\n\\nWhat it is: A library to receive and decode IR remote signals.\\n\\nHow it works: `IrReceiver.decode()` checks for a new signal, and `IrReceiver.decodedIRData.decodedRawData` gives the button\'s code.\\n\\nWhy useful: Makes it easy to use any IR remote control with Arduino.\\n\\nExample:\\nif (IrReceiver.decode()) {\\n  unsigned long code = IrReceiver.decodedIRData.decodedRawData;\\n  Serial.println(code, HEX);\\n  IrReceiver.resume();\\n}","Motor acceleration\\n\\nWhat it is: Gradually increasing motor speed instead of instantly setting it.\\n\\nHow it works: Uses a for-loop to raise PWM values step by step.\\n\\nWhy useful: Prevents jerky starts and protects the motors from stress.\\n\\nExample:\\nfor (int speed = 0; speed <= 255; speed += 25) {\\n  analogWrite(MOTOR1_A, speed);\\n  delay(20);\\n}","tone() and noTone()\\n\\nWhat it is: Functions to play sounds on a buzzer.\\n\\nHow it works: `tone(pin, frequency, duration)` plays a note, and `noTone(pin)` stops it.\\n\\nWhy useful: Allows Arduino to play melodies or sound effects.\\n\\nExample:\\ntone(BUZZER_PIN, 440, 500);\\ndelay(500);\\nnoTone(BUZZER_PIN);","switchcase with IR codes\\n\\nWhat it is: A decision structure to run different motor functions depending on which button is pressed.\\n\\nHow it works: Each IR code is matched to a specific case (Forward, Backward, Left, Right, Stop).\\n\\nWhy useful: Organizes remote control commands neatly and avoids long ifelse chains.\\n\\nExample:\\nswitch (irCode) {\\n  case Forward: moveForward(); break;\\n  case Backward: moveBackward(); break;\\n  case Left: turnLeft(); break;\\n  case Right: turnRight(); break;\\n  case Stop: stopMotors(); break;\\n}"],"tryThisCode":"#include <Arduino.h>\\n#include <IRremote.h>\\n\\n#define RECV_PIN 12\\n#define MOTOR1_A 5\\n#define MOTOR1_B 6\\n#define MOTOR2_A 9\\n#define MOTOR2_B 10\\n#define BUTTON_PIN 2\\n\\n// IR receiver setup\\nIRrecv irrecv(RECV_PIN);\\ndecode_results results;\\n\\n// IR codes (example values)\\nconst unsigned long Forward = 0xBF40FD02;\\nconst unsigned long Backward = 0xB748FD02;\\nconst unsigned long Right = 0xFB04FD02;\\nconst unsigned long Left = 0xB847FD02;\\nconst unsigned long Stop = 0xFA05FD02;\\n\\n// Mode variables\\nenum Mode { IR_MODE, MUSIC_MODE, LDR_MODE };\\nvolatile Mode currentMode = IR_MODE;\\nvolatile unsigned long lastInterruptTime = 0;\\nconst int DEBOUNCE_DELAY = 1000;\\n\\nvoid toggleMode();\\nvoid stopMotors();\\n\\nvoid setup() {\\n  pinMode(MOTOR1_A, OUTPUT);\\n  pinMode(MOTOR1_B, OUTPUT);\\n  pinMode(MOTOR2_A, OUTPUT);\\n  pinMode(MOTOR2_B, OUTPUT);\\n  pinMode(BUTTON_PIN, INPUT_PULLUP);\\n\\n  irrecv.enableIRIn();\\n  attachInterrupt(digitalPinToInterrupt(BUTTON_PIN), toggleMode, FALLING);\\n  Serial.begin(9600);\\n}\\n\\nvoid toggleMode() {\\n  unsigned long currentTime = millis();\\n  if (currentTime - lastInterruptTime > DEBOUNCE_DELAY) {\\n    if (currentMode == IR_MODE) {\\n      currentMode = MUSIC_MODE;\\n      Serial.println(\\"Switched to Music Mode\\");\\n      irrecv.disableIRIn();\\n      stopMotors();\\n    } else {\\n      currentMode = IR_MODE;\\n      Serial.println(\\"Switched to IR Mode\\");\\n      irrecv.enableIRIn();\\n    }\\n    lastInterruptTime = currentTime;\\n  }\\n}\\n\\nvoid stopMotors() {\\n  analogWrite(MOTOR1_A, 0);\\n  analogWrite(MOTOR1_B, 0);\\n  analogWrite(MOTOR2_A, 0);\\n  analogWrite(MOTOR2_B, 0);\\n}\\n\\nvoid moveForward() {\\n  Serial.println(\\"Forward\\");\\n  analogWrite(MOTOR1_B, 255);\\n  analogWrite(MOTOR2_B, 255);\\n  delay(200);\\n  stopMotors();\\n}\\n\\nvoid moveBackward() {\\n  Serial.println(\\"Backward\\");\\n  analogWrite(MOTOR1_A, 255);\\n  analogWrite(MOTOR2_A, 255);\\n  delay(200);\\n  stopMotors();\\n}\\n\\nvoid turnLeft() {\\n  Serial.println(\\"Left\\");\\n  analogWrite(MOTOR1_A, 255);\\n  analogWrite(MOTOR2_B, 255);\\n  delay(200);\\n  stopMotors();\\n}\\n\\nvoid turnRight() {\\n  Serial.println(\\"Right\\");\\n  analogWrite(MOTOR1_B, 255);\\n  analogWrite(MOTOR2_A, 255);\\n  delay(200);\\n  stopMotors();\\n}\\n\\nvoid handleIRControl() {\\n  if (IrReceiver.decode()) {\\n    unsigned long code = IrReceiver.decodedIRData.decodedRawData;\\n    Serial.print(\\"IR Code: \\");\\n    Serial.println(code, HEX);\\n\\n    switch (code) {\\n      case Forward: moveForward(); break;\\n      case Backward: moveBackward(); break;\\n      case Left: turnLeft(); break;\\n      case Right: turnRight(); break;\\n      case Stop: stopMotors(); break;\\n    }\\n    irrecv.resume();\\n  }\\n}\\n\\nvoid loop() {\\n  if (currentMode == IR_MODE) {\\n    handleIRControl();\\n  }\\n}\\n"}}'),lessonsData={pinDefinitionsContents,lessonConfigs},lessonId$4="lesson1",title$4="Arduino Basics - Quiz",description$4="Test your knowledge about Arduino basics such as #define, setup, loop, pinMode, and functions",questions$4=[{id:"l1q1",question:"What does #define do in an Arduino program?",options:["Runs once at startup","Pauses the program","Replaces a word with a constant value","Reads sensor data"],answerIndex:2,explanation:"#define replaces a word with a constant value before the program is compiled."},{id:"l1q2",question:"Why is using #define useful?",options:["It makes code easier to read and maintain","It slows down the program","It creates infinite loops","It changes how setup() runs"],answerIndex:0,explanation:"Using #define avoids magic numbers and makes code clearer and easier to maintain."},{id:"l1q3",question:"When does setup() run in an Arduino program?",options:["Only once at the start","Forever in a loop","When a button is pressed","Every second"],answerIndex:0,explanation:"setup() runs only once at the beginning of the program."},{id:"l1q4",question:"Which of the following is usually placed inside setup()?",options:["pinMode() declarations","The infinite loop","Main logic","Serial.print() in a loop"],answerIndex:0,explanation:"pinMode() and other initialization tasks are typically placed in setup()."},{id:"l1q5",question:"What makes loop() special in Arduino?",options:["Runs only once","Runs forever, repeating","Reads pin numbers","Defines constants"],answerIndex:1,explanation:"loop() repeats continuously after setup() finishes."},{id:"l1q6",question:"What happens when Arduino reaches the end of loop()?",options:["It stops running","It restarts loop() from the top","It reruns setup()","It powers off"],answerIndex:1,explanation:"After finishing loop(), Arduino automatically starts loop() again from the top."},{id:"l1q7",question:"What does pinMode(RGB_RED, OUTPUT); mean?",options:["Pin sends signals","Pin reads signals","Pin is unused","Pin delays"],answerIndex:0,explanation:"OUTPUT mode means the pin sends signals, like powering an LED."},{id:"l1q8",question:"Which mode should be used in pinMode() to read a button?",options:["OUTPUT","INPUT","DELAY","LOOP"],answerIndex:1,explanation:"Buttons and sensors require INPUT mode to read their values."},{id:"l1q9",question:"Why do we create the function setRGBColor()?",options:["To group three analogWrite() calls","To create delays","To replace pinMode()","To run setup() again"],answerIndex:0,explanation:"setRGBColor() simplifies code by grouping three analogWrite() calls into one reusable function."},{id:"l1q10",question:"What values does setRGBColor(red, green, blue) accept?",options:["01","0255","01023","True/False"],answerIndex:1,explanation:"Each color channel accepts a value from 0255, controlling brightness."},{id:"l1q11",question:"What is the range of values accepted by analogWrite()?",options:["01023","0255","01","1100"],answerIndex:1,explanation:"analogWrite() accepts values from 0 to 255."},{id:"l1q12",question:"What does analogWrite(RGB_GREEN, 0); do?",options:["Turns the green LED fully off","Turns the green LED fully on","Sets green LED to half brightness","Makes the LED blink"],answerIndex:0,explanation:"A value of 0 means the LED is completely off."},{id:"l1q13",question:"What does analogWrite(RGB_RED, 255); do?",options:["Turns the red LED off","Turns the red LED to full brightness","Turns the red LED to half brightness","Makes the LED flicker"],answerIndex:1,explanation:"A value of 255 means the LED is at maximum brightness."},{id:"l1q14",question:"What does analogRead(A0) return?",options:["0255","01023","True/False","Always 5V"],answerIndex:1,explanation:"analogRead() returns a value between 0 and 1023."},{id:"l1q15",question:"If analogRead(A0) returns 1023, what does it mean?",options:["Pin is at 0V","Pin is at maximum voltage (~5V)","Pin is floating","Pin is disconnected"],answerIndex:1,explanation:"1023 means the pin is reading maximum voltage, usually 5V."},{id:"l1q16",question:"Which function pauses the program?",options:["loop()","delay()","analogRead()","pinMode()"],answerIndex:1,explanation:"delay() pauses the program for a given time in milliseconds."},{id:"l1q17",question:"What does delay(1000); do?",options:["Pauses for 1 ms","Pauses for 1 second","Pauses for 10 seconds","Turns LED off"],answerIndex:1,explanation:"delay(1000); pauses for 1000 milliseconds, which is 1 second."},{id:"l1q18",question:"If you want to pause for 5 seconds, what delay value should you use?",options:["5","50","500","5000"],answerIndex:3,explanation:"5 seconds equals 5000 milliseconds, so delay(5000); is used."},{id:"l1q19",question:"Why might using too many delay() calls be a problem?",options:["It makes LEDs brighter","It blocks the Arduino from doing other tasks","It increases speed","It improves sensor readings"],answerIndex:1,explanation:"delay() stops everything else, so too many delays can block other tasks."},{id:"l1q20",question:"Which function is used to declare whether a pin is input or output?",options:["pinMode()","analogWrite()","delay()","setup()"],answerIndex:0,explanation:"pinMode() sets a pin as INPUT or OUTPUT before use."}],questionsLesson1={lessonId:lessonId$4,title:title$4,description:description$4,questions:questions$4},lessonId$3="lesson2",title$3="Arduino Sound & Timing - Quiz",description$3="Test your knowledge of tone(), noTone(), millis(), for loop, and volatile in Arduino programming.",questions$3=[{id:"l2q1",question:"What does the tone() function do in Arduino?",options:["Generates a square wave on a pin to produce sound","Measures sound frequency from a microphone","Stops sound output from a buzzer","Plays MP3 audio files"],answerIndex:0,explanation:"tone() generates a square wave signal on a specified pin to drive a buzzer or speaker."},{id:"l2q2",question:"Which function is used to stop a sound started by tone()?",options:["stopTone()","mute()","noTone()","silence()"],answerIndex:2,explanation:"noTone() stops any sound currently being played on a pin by tone()."},{id:"l2q3",question:"What does millis() return?",options:["Time in seconds since the last delay() call","CPU temperature","Milliseconds since the board was powered on","Remaining time before shutdown"],answerIndex:2,explanation:"millis() returns the number of milliseconds since the Arduino started running."},{id:"l2q4",question:"Why is millis() preferred over delay() in some cases?",options:["It makes the code run slower","It allows multitasking without stopping the program","It uses less memory","It only works with tone()"],answerIndex:1,explanation:"Unlike delay(), millis() allows you to keep the program running while tracking time."},{id:"l2q5",question:"Which of the following is the correct structure of a for loop?",options:["for(condition; increment; initialization)","for(initialization; condition; increment)","for(increment; initialization; condition)","for(condition; initialization; increment)"],answerIndex:1,explanation:"A for loop follows the structure: for(initialization; condition; increment)."},{id:"l2q6",question:"What is the purpose of the volatile keyword?",options:["To increase execution speed","To prevent variables from changing","To tell the compiler that a variable may change unexpectedly","To store data permanently"],answerIndex:2,explanation:"volatile tells the compiler not to optimize a variable because it may change unpredictably (e.g., in an interrupt)."},{id:"l2q7",question:"What happens if you forget to use volatile on a variable used inside an interrupt?",options:["The program will stop compiling","The variable may not update correctly, causing bugs","The system will restart automatically","Nothing will change"],answerIndex:1,explanation:"Without volatile, the compiler may optimize the variable and ignore changes made inside an interrupt."},{id:"l2q8",question:"Which of the following correctly plays a sound at 500Hz for 1 second?",options:["tone(4, 500);","tone(4, 500, 1000);","playTone(500, 1000);","beep(500, 1);"],answerIndex:1,explanation:"tone(pin, frequency, duration) is the correct format."},{id:"l2q9",question:"In the provided tryThisCode, what does playMelody() do?",options:["Detects sound frequency","Loops through multiple tones and plays them one by one","Records audio","Plays a single tone forever"],answerIndex:1,explanation:"playMelody() runs a for loop to iterate through an array of frequencies and plays them in sequence."},{id:"l2q10",question:"What is the role of noTone(BUZZER_PIN) inside playMelody()?",options:["To pause between notes","To increase volume","To restart the loop","To reduce power consumption"],answerIndex:0,explanation:"noTone() briefly stops sound to act as a delay between musical notes."}],questionsLesson2={lessonId:lessonId$3,title:title$3,description:description$3,questions:questions$3},lessonId$2="lesson3",title$2="Arduino Serial Communication & Motor Control - Quiz",description$2="Test your knowledge of Serial communication and PWM motor control in Arduino.",questions$2=[{id:"l3q1",question:"What does Serial.begin(9600) do?",options:["Starts the motor at speed 9600","Starts serial communication at 9600 baud","Sends data to the LCD screen","Sets PWM frequency to 9600 Hz"],answerIndex:1,explanation:"Serial.begin(9600) starts communication with your computer at 9600 bits per second."},{id:"l3q2",question:"Which of the following prints a message to the Serial Monitor with a new line?",options:["Serial.write()","Serial.print()","Serial.println()","Serial.begin()"],answerIndex:2,explanation:"Serial.println() prints text followed by a newline character."},{id:"l3q3",question:"What is the common baud rate used for beginner Arduino projects?",options:["4800","9600","19200","115200"],answerIndex:1,explanation:"9600 baud is the most common beginner-friendly speed for Arduino serial communication."},{id:"l3q4",question:"What does PWM stand for?",options:["Pulse Width Modulation","Power Watt Management","Pin Wiring Mode","Programmable Wave Method"],answerIndex:0,explanation:"PWM stands for Pulse Width Modulation, used to control motor speed and LED brightness."},{id:"l3q5",question:"What happens if both motor pins are set to 0 with analogWrite()?",options:["The motor spins forward","The motor spins backward","The motor stops","The motor overheats"],answerIndex:2,explanation:"Giving both motor pins 0 stops the motor."},{id:"l3q6",question:"How do you make a DC motor spin backward using two motor pins?",options:["Set both pins HIGH","Give PWM to pin A, 0 to pin B","Give 0 to pin A, PWM to pin B","Use Serial.println()"],answerIndex:1,explanation:"Giving PWM > 0 to pin A and 0 to pin B makes the motor spin backward."},{id:"l3q7",question:"Which function is used to send sensor values to the Serial Monitor for debugging?",options:["Serial.read()","Serial.println()","analogWrite()","tone()"],answerIndex:1,explanation:"Serial.println() sends text or numbers to the Serial Monitor."},{id:"l3q8",question:"What is the range of PWM values in Arduinos analogWrite()?",options:["0 to 100","0 to 1023","0 to 255","0 to 9999"],answerIndex:2,explanation:"PWM values range from 0 (off) to 255 (full power)."},{id:"l3q9",question:'In the tryThisCode, what does Serial.println("Moving forward"); do?',options:["Sends the text 'Moving forward' to the Serial Monitor","Moves the motor forward","Prints the motor speed","Stops the motor"],answerIndex:0,explanation:'Serial.println("Moving forward"); only prints a message, it doesnt control the motor directly.'},{id:"l3q10",question:"If you want the motor to move forward at half speed, what PWM value should you use?",options:["128","255","64","9600"],answerIndex:0,explanation:"Half speed corresponds to about 128 in the 0255 PWM range."}],questionsLesson3={lessonId:lessonId$2,title:title$2,description:description$2,questions:questions$2},lessonId$1="lesson4",title$1="Arduino Sensors & Control Structures - Quiz",description$1="Test your knowledge of includes, constants, LDRs, and decision-making structures in Arduino.",questions$1=[{id:"l4q1",question:"What does the #include directive do in Arduino?",options:["Defines a constant value","Includes external libraries or core Arduino code","Starts the Serial Monitor","Declares a function prototype"],answerIndex:1,explanation:"#include is used to bring in external libraries or Arduinos core functionality."},{id:"l4q2",question:"Which of these correctly includes the Servo motor library?",options:["#include <Servo.h>","#include Servo.h","import Servo.h","use Servo.h"],answerIndex:0,explanation:"The correct syntax is #include <Servo.h>."},{id:"l4q3",question:"What is a function prototype?",options:["A complete function with body","A declaration of a function before it is defined","A built-in Arduino keyword","A variable that cannot change"],answerIndex:1,explanation:"A function prototype tells the compiler a function exists before it is defined."},{id:"l4q4",question:"What does the const keyword do?",options:["Creates a variable that can change","Creates a variable that cannot change","Declares a function","Imports a library"],answerIndex:1,explanation:"const makes a variable value fixed so it cannot be modified after initialization."},{id:"l4q5",question:"What type of sensor is an LDR?",options:["Temperature sensor","Light sensor","Sound sensor","Pressure sensor"],answerIndex:1,explanation:"An LDR (Light Dependent Resistor) detects light intensity."},{id:"l4q6",question:"What does analogRead(LDR_PIN) return?",options:["A value between 0 and 255","A value between 0 and 1023","Only HIGH or LOW","The frequency of light"],answerIndex:1,explanation:"analogRead() returns values from 0 to 1023 representing voltage on the analog pin."},{id:"l4q7",question:"Which structure runs code only if a condition is true, otherwise runs something else?",options:["for loop","switchcase","ifelse","while loop"],answerIndex:2,explanation:"ifelse lets Arduino decide between two blocks of code."},{id:"l4q8",question:"When is switchcase more useful than ifelse?",options:["When you have only one condition","When you need to loop infinitely","When checking many possible values of one variable","When declaring constants"],answerIndex:2,explanation:"switchcase is cleaner for handling multiple options of a single variable."},{id:"l4q9",question:"What is the difference between Serial.print() and Serial.println()?",options:["Serial.print() sends text, Serial.println() cannot","Serial.println() adds a new line, Serial.print() does not","Serial.print() is faster","They are exactly the same"],answerIndex:1,explanation:"Serial.print() keeps printing on the same line, Serial.println() adds a newline at the end."},{id:"l4q10",question:"If an LDR value is below LDR_LOW, what happens in the tryThisCode example?",options:["LED turns Green","LED turns Blue","LED turns Red","LED stays White"],answerIndex:2,explanation:"If light is below LDR_LOW, setRGBColor(255, 0, 0) makes the LED Red."}],questionsLesson4={lessonId:lessonId$1,title:title$1,description:description$1,questions:questions$1},lessonId="lesson5",title="Interrupts, IR Remote & Motor Control - Quiz",description="Test your knowledge of enums, interrupts, IRremote, and motor control in Arduino.",questions=[{id:"l5q1",question:"What is an enum used for in Arduino?",options:["To declare floating-point constants","To define a set of named constant values","To store a list of strings","To create a hardware interrupt"],answerIndex:1,explanation:"enum lets you create a list of named constants like IR_MODE or MUSIC_MODE."},{id:"l5q2",question:"What does the volatile keyword indicate?",options:["The variable value never changes","The variable may change unexpectedly, such as inside an interrupt","The variable stores floating point data","The variable is stored in EEPROM"],answerIndex:1,explanation:"volatile prevents the compiler from optimizing out variables that change in interrupts."},{id:"l5q3",question:"Which function attaches an interrupt to a specific pin?",options:["pinMode()","attachInterrupt()","enableInterrupt()","startInterrupt()"],answerIndex:1,explanation:"attachInterrupt() runs a function automatically when a pin changes state."},{id:"l5q4",question:"What is debouncing in Arduino?",options:["A method to speed up button response","A technique to filter electrical noise from analog sensors","A method to ignore multiple false button presses caused by mechanical bounce","A way to smooth PWM signals"],answerIndex:2,explanation:"Debouncing prevents detecting multiple presses from one physical button press."},{id:"l5q5",question:"Which function from the IRremote library checks if a signal has been received?",options:["IrReceiver.decode()","IrReceiver.resume()","IrReceiver.read()","IrReceiver.listen()"],answerIndex:0,explanation:"IrReceiver.decode() returns true when a new IR signal is detected."},{id:"l5q6",question:"Why is motor acceleration implemented gradually using a for-loop?",options:["To make motors reverse faster","To prevent sudden jerks and reduce motor stress","To reduce PWM resolution","To save power"],answerIndex:1,explanation:"Gradually increasing PWM prevents sudden motor strain and smoother motion."},{id:"l5q7",question:"Which pair of functions is used to generate and stop sound?",options:["soundOn() and soundOff()","tone() and noTone()","beep() and stopBeep()","buzzerOn() and buzzerOff()"],answerIndex:1,explanation:"tone() plays a sound at a given frequency, noTone() stops it."},{id:"l5q8",question:"What parameter in attachInterrupt() specifies which pin to monitor?",options:["The digital pin number directly","digitalPinToInterrupt(pin)","The analog pin name","The PWM channel"],answerIndex:1,explanation:"digitalPinToInterrupt(pin) converts a pin number into its interrupt number."},{id:"l5q9",question:"What happens inside switchcase when the Forward IR code is received?",options:["The motors stop","The moveForward() function runs","The mode switches to MUSIC_MODE","The IR receiver resets"],answerIndex:1,explanation:"When the Forward code is detected, switchcase calls moveForward()."},{id:"l5q10",question:"Why is lastInterruptTime used with DEBOUNCE_DELAY in toggleMode()?",options:["To time how long the motor runs","To avoid reading the IR signal twice","To ensure enough time passes between button presses","To measure PWM frequency"],answerIndex:2,explanation:"It checks that the time since the last interrupt exceeds the debounce delay, preventing repeated triggers."}],questionsLesson5={lessonId,title,description,questions};(function n(){try{if(!THREE||!BufferGeometry||BufferGeometry.__hardened_once)return;const e=BufferGeometry.prototype.computeBoundingSphere,t=new Set;BufferGeometry.prototype.computeBoundingSphere=function(){const o=this.attributes&&this.attributes.position;if(!o||!o.array||o.count===0){this.boundingSphere=new Sphere(new Vector3$1,0);return}const i=o.array;let s=!1;for(let r=0;r<i.length;r++)Number.isFinite(i[r])||(s=!0,i[r]=0);if(s&&!t.has(this.uuid)){t.add(this.uuid);try{o.needsUpdate=!0}catch{}}try{e.call(this),(!this.boundingSphere||!Number.isFinite(this.boundingSphere.radius))&&(this.boundingSphere=new Sphere(new Vector3$1,0))}catch{this.boundingSphere=new Sphere(new Vector3$1,0)}},BufferGeometry.__hardened_once=!0}catch{}})();const fontFamily=ConsolasFontJSON,fontTexture=ConsolasFontImage;let learningPanel=null,learningNextArrow=null,learningArrowClickHandler=null,learningArrowCamera=null,currentLessonName=null,currentLessonIndex=0,learningSceneRef=null,sectionContainers={what:null,how:null,why:null,syntax:null};function sanitizeForMSDFFont(n){return n?n.replace(/[\u2022]/g,"-").replace(/[\u2014]/g,"-").replace(/[\u2013]/g,"-").replace(/[""\u201C\u201D]/g,'"').replace(/[''\u2018\u2019]/g,"'").replace(/\u00A0/g," ").replace(/[\u2000-\u200B]/g," ").replace(/[^\x20-\x7E\n\r\t]/g,""):""}function formatAsSections(n){const e=typeof n=="string"?n:"";if(!e.trim())return"";const t=d=>{const u=new RegExp(d+"\\s*:?\\s*([\\s\\S]*?)(?=\\n\\s*\\n|\\n[A-Za-z].*?:|$)","i"),f=e.match(u);return f&&f[1]?f[1].trim():""},o=t("What it is"),i=t("How it works"),s=t("Why useful"),r=t("Syntax"),a=t("Example"),l=r||a,c=[];return o&&c.push(`What it is:
`+o),i&&c.push(`How it works:
`+i),s&&c.push(`Why useful:
`+s),l&&c.push(`Syntax / Example:
`+l),c.length>0?c.join(`

`):e}function extractSections(n){const e=typeof n=="string"?n:"";if(!e.trim())return{};const t=o=>{const i=new RegExp(o+"\\s*:?\\s*([\\s\\S]*?)(?=\\n\\s*\\n|\\n[A-Za-z].*?:|$)","i"),s=e.match(i);return s&&s[1]?s[1].trim():""};return{what:t("What it is"),how:t("How it works"),why:t("Why useful"),syntax:t("Syntax"),example:t("Example")}}function calculateSectionHeight(n){if(!n||n.trim()==="")return .08;const e=n.split(`
`).length,t=n.split(/\s+/).length,o=n.length;let i=.08;return i+=Math.max(0,e-1)*.035,i+=Math.min(.12,t*.0025),i+=Math.min(.06,o*12e-5),Math.min(.5,Math.max(.08,i))}function formatCodeForMeshUI(n){const t=(typeof n=="string"?n:"").split(/\r?\n/),o=i=>"".repeat(i);return t.map(i=>{const s=i.replace(/\t/g,"  "),r=s.match(/^(\s*)/),l=(r?r[1]:"").length;return o(l)+s.slice(l)}).join(`
`)}function createLearningPanel(n){learningSceneRef=n||learningSceneRef,learningPanel=new __webpack_exports__Block({width:1.7,justifyContent:"start",contentDirection:"column",borderRadius:.05,backgroundOpacity:0,backgroundColor:new Color(0),padding:.08,fontFamily,fontTexture,fontSize:.04}),learningPanel.position.set(0,2.4,-4.1),learningPanel.visible=!1;const e=new __webpack_exports__Text({content:"",fontSize:.06,fontFamily,fontTexture,textAlign:"center",color:new Color(8369151)}),t=new __webpack_exports__Text({content:"",fontSize:.05,fontFamily,fontTexture,textAlign:"center",color:new Color(16777215)}),o=new __webpack_exports__Block({width:1.55,contentDirection:"column",justifyContent:"start",alignItems:"stretch",backgroundOpacity:0,margin:.03,padding:.02}),i=(c,d,u=2899536)=>{const f=new __webpack_exports__Block({width:1.5,contentDirection:"column",justifyContent:"start",alignItems:"stretch",borderRadius:.03,backgroundOpacity:0,backgroundColor:new Color(0),borderWidth:.005,borderColor:new Color(3447003),borderOpacity:.3,margin:.01,padding:.02}),h=new __webpack_exports__Text({content:d,fontSize:.04,fontFamily,fontTexture,textAlign:"left",color:new Color(3447003)}),m=new __webpack_exports__Text({content:"",fontSize:.032,fontFamily,fontTexture,textAlign:"left",color:new Color(15528177),width:1.2,lineHeight:1.15,margin:.005});return f.add(h),f.add(m),{container:f,title:h,content:m}};sectionContainers.what=i("what","What it is:",2899536),sectionContainers.how=i("how","How it works:",2600544),sectionContainers.why=i("why","Why useful:",15158332),sectionContainers.syntax=i("syntax","Syntax / Example:",10181046),o.add(sectionContainers.what.container),o.add(sectionContainers.how.container),o.add(sectionContainers.why.container),o.add(sectionContainers.syntax.container);const s=new __webpack_exports__Text({content:"",fontSize:.035,fontFamily,fontTexture,textAlign:"center",color:new Color(3447003),width:1.8,lineHeight:1.2});learningNextArrow=new __webpack_exports__Block({width:.2,height:.1,justifyContent:"center",contentDirection:"row",borderRadius:.05,backgroundOpacity:.95,backgroundColor:new Color(3066993),margin:.005});const r=new __webpack_exports__Text({content:">",fontSize:.04,fontFamily,fontTexture,textAlign:"center",color:new Color(0)});learningNextArrow.add(r),learningNextArrow.visible=!1,learningNextArrow.userData.clickable=!0,learningNextArrow.traverse(c=>{c&&c.userData&&(c.userData.clickable=!0)}),learningQuizButton=new __webpack_exports__Block({width:.4,height:.1,justifyContent:"center",contentDirection:"row",borderRadius:.05,backgroundOpacity:.95,backgroundColor:new Color(10181046),margin:.01});const a=new __webpack_exports__Text({content:"Take Quiz",fontSize:.035,fontFamily,fontTexture,textAlign:"center",color:new Color(0)});learningQuizButton.add(a),learningQuizButton.visible=!1,learningQuizButton.userData.clickable=!0,learningQuizButton.traverse(c=>{c&&c.userData&&(c.userData.clickable=!0)});const l=new __webpack_exports__Block({width:1.84,height:.12,contentDirection:"row",justifyContent:"end",alignItems:"center",backgroundOpacity:0,margin:.005});l.add(learningQuizButton),l.add(learningNextArrow),learningPanel.add(e),learningPanel.add(t),learningPanel.add(o),learningPanel.add(s),learningPanel.add(l),e.position.set(0,.1,.01),t.position.set(0,.1,.01),s.position.set(0,-.25,.01),n.add(learningPanel);try{typeof window<"u"&&window.camera&&(attachLearningArrowHandler(window.camera),attachLearningQuizHandler(window.camera))}catch{}try{learningPanel.renderOrder=1e3,learningPanel.traverse(c=>{c.material&&(c.material.depthTest=!1,c.material.depthWrite=!1,c.material.transparent=!0);try{c.frustumCulled=!1}catch{}})}catch{}return console.log("Learning panel created and added to scene"),learningPanel}function showLearningPanel(){if(learningPanel){uiMode="learning",learningPanel.visible=!0;try{hideQuestionsPanel()}catch{}console.log("Learning panel is now visible")}else console.warn("Learning panel not found - make sure createLearningPanel was called first")}function hideLearningPanel(){learningPanel?(learningPanel.visible=!1,console.log("Learning panel is now hidden")):console.warn("Learning panel not found")}function updateLearningPanelContent(n,e,t){if(learningPanel){const o=sanitizeForMSDFFont(n);sanitizeForMSDFFont(e);const i=sanitizeForMSDFFont(t),s=extractSections(e);if(learningPanel.children.forEach((r,a)=>{if(r.isText)switch(a){case 0:o&&r.set({content:o});break;case 1:o&&r.set({content:o});break;case 3:i&&r.set({content:i});break}}),sectionContainers.what&&sectionContainers.what.content){const r=s.what||"No content available";sectionContainers.what.content.set({content:sanitizeForMSDFFont(r)});const a=calculateSectionHeight(r);sectionContainers.what.container.set({height:a})}if(sectionContainers.how&&sectionContainers.how.content){const r=s.how||"No content available";sectionContainers.how.content.set({content:sanitizeForMSDFFont(r)});const a=calculateSectionHeight(r);sectionContainers.how.container.set({height:a})}if(sectionContainers.why&&sectionContainers.why.content){const r=s.why||"No content available";sectionContainers.why.content.set({content:sanitizeForMSDFFont(r)});const a=calculateSectionHeight(r);sectionContainers.why.container.set({height:a})}if(sectionContainers.syntax&&sectionContainers.syntax.content){const r=s.syntax||s.example||"No content available";sectionContainers.syntax.content.set({content:sanitizeForMSDFFont(r)});const a=calculateSectionHeight(r);sectionContainers.syntax.container.set({height:a})}console.log("Learning panel content updated with bordered sections");try{uiMode==="learning"&&hideQuestionsPanel(),learningPanel&&learningPanel.visible&&hideQuestionsPanel()}catch{}}else console.warn("Learning panel not found - cannot update content")}function getLessonConfig(n){return!lessonsData||!lessonsData.lessonConfigs?null:lessonsData.lessonConfigs[n]||null}function clampIndex(n,e){return n<0?0:n>=e?e-1:n}let learningQuizButton=null,learningQuizClickHandler=null,learningQuizCamera=null,uiMode="learning",questionsPanel=null,questionsCamera=null,questionTitleText=null,questionBodyText=null,optionButtons=[],currentQuestionIndex=0,quizData=null,questionsClickHandler=null,quizResults=[],showingSummary=!1,runCodeClickHandler=null,runCodeAnimId=null,optionsColumnRef=null,questionInteractionLocked=!1,lastQuestionPointerDownAt=0,bestScoresByLesson={};function createQuestionsPanel(n){var s,r,a;if(console.log("[Quiz] createQuestionsPanel called with scene:",!!n,"currentLessonName:",currentLessonName),questionsPanel)return console.log("[Quiz] Questions panel already exists, returning existing"),questionsPanel;const e=currentLessonName||(typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson1");console.log(`[Quiz] createQuestionsPanel - Actual lesson determined: ${e} (currentLessonName: ${currentLessonName})`),e==="lesson2"?(quizData=questionsLesson2,console.log("[Quiz] Loaded lesson2 quiz data:",!!quizData)):e==="lesson3"?(quizData=questionsLesson3,console.log("[Quiz] Loaded lesson3 quiz data:",!!quizData,"questions count:",(s=quizData==null?void 0:quizData.questions)==null?void 0:s.length)):e==="lesson4"?(quizData=questionsLesson4,console.log("[Quiz] Loaded lesson4 quiz data:",!!quizData,"questions count:",(r=quizData==null?void 0:quizData.questions)==null?void 0:r.length)):e==="lesson5"?(quizData=questionsLesson5,console.log("[Quiz] Loaded lesson5 quiz data:",!!quizData,"questions count:",(a=quizData==null?void 0:quizData.questions)==null?void 0:a.length)):(quizData=questionsLesson1,console.log("[Quiz] Loaded lesson1 quiz data (default):",!!quizData)),quizData&&quizData.questions&&quizData.questions.length>5&&(quizData={...quizData,questions:quizData.questions.slice(0,5)});const t=n||learningSceneRef||(typeof window<"u"?window.scene:null);console.log("[Quiz] Target scene available:",!!t,"scene type:",typeof t),t||console.warn("[Learning] createQuestionsPanel: No scene available to attach questionsPanel"),questionsPanel=new __webpack_exports__Block({width:1.5,height:1,justifyContent:"start",contentDirection:"column",alignItems:"stretch",borderRadius:.05,backgroundOpacity:0,backgroundColor:new Color(1118481),padding:.08,fontFamily,fontTexture,fontSize:.04});try{learningPanel?questionsPanel.position.set(0,learningPanel.position.y+.1,-4.1):questionsPanel.position.set(0,2.5,-4.1)}catch{questionsPanel.position.set(0,2.2,-4.1)}questionsPanel.visible=!1;try{questionsPanel.renderOrder=1100,questionsPanel.traverse(l=>{l.material&&(l.material.depthTest=!1,l.material.depthWrite=!1,l.material.transparent=!0);try{l.frustumCulled=!1}catch{}})}catch{}questionTitleText=new __webpack_exports__Text({content:sanitizeForMSDFFont(quizData&&quizData.title?quizData.title:"Questions"),fontSize:.05,fontFamily,fontTexture,textAlign:"center",color:new Color(8369151),width:1.84,lineHeight:1.2,margin:.02});try{questionTitleText.renderOrder=1102}catch{}try{questionTitleText.set({content:""})}catch{}try{questionTitleText.visible=!1}catch{}questionBodyText=new __webpack_exports__Text({content:"",fontSize:.05,fontFamily,fontTexture,textAlign:"left",color:new Color(16777215),width:1.84,lineHeight:1.3,margin:0,padding:0});try{questionBodyText.renderOrder=1102}catch{}const o=new __webpack_exports__Block({width:1.84,height:1.2,contentDirection:"column",justifyContent:"start",alignItems:"stretch",backgroundOpacity:0,margin:.2});optionsColumnRef=o;const i=()=>new __webpack_exports__Block({width:1.84,height:.09,justifyContent:"center",contentDirection:"row",borderRadius:.04,backgroundOpacity:.95,backgroundColor:new Color(2899536),margin:.02});for(let l=0;l<4;l+=1){const c=i();try{c.renderOrder=1100}catch{}const d=new __webpack_exports__Text({content:"",fontSize:.04,fontFamily,fontTexture,textAlign:"left",color:new Color(15528177),width:1.76,lineHeight:1.2,margin:0,padding:0});try{d.renderOrder=1101}catch{}c.add(d),c.userData.clickable=!0,c.traverse(u=>{u&&u.userData&&(u.userData.clickable=!0)}),optionButtons.push(c),o.add(c)}questionsPanel.add(questionTitleText),questionsPanel.add(questionBodyText),questionsPanel.add(o),t?(t.add(questionsPanel),console.log("[Quiz] Questions panel added to scene")):console.error("[Quiz] No target scene available, questions panel not added to scene");try{typeof window<"u"&&window.camera&&attachQuestionsHandler(window.camera)}catch{}updateQuestionsPanelContent();try{__webpack_exports__update()}catch{}return questionsPanel}function showQuestionsPanel(){if(console.log("[Quiz] showQuestionsPanel called"),uiMode!=="quiz"){console.log("[Quiz] Aborting showQuestionsPanel because uiMode is",uiMode);return}if(learningPanel&&learningPanel.visible){console.log("[Quiz] Aborting showQuestionsPanel because learning panel is visible");return}if(typeof window<"u"&&window.codePlane&&window.codePlane.visible){console.log("[Quiz] Aborting showQuestionsPanel because steps panel (codePlane) is visible");return}if(!questionsPanel){console.log("[Quiz] Creating new questions panel");try{createQuestionsPanel(learningSceneRef)}catch(n){console.error("[Quiz] Error creating questions panel:",n)}}if(questionsPanel){console.log("[Quiz] Questions panel exists, making visible");try{updateQuestionsPanelContent(),__webpack_exports__update(),__webpack_exports__update()}catch(n){console.error("[Quiz] Error updating questions panel content:",n)}questionsPanel.visible=!0,console.log("[Quiz] Questions panel visibility set to:",questionsPanel.visible);try{__webpack_exports__update()}catch(n){console.error("[Quiz] Error updating ThreeMeshUI:",n)}}else console.error("[Quiz] Questions panel is null after creation attempt")}function hideQuestionsPanel(){if(questionsPanel){questionsPanel.visible=!1;try{__webpack_exports__update()}catch{}}}typeof window<"u"&&(window.hideQuestionsPanel=hideQuestionsPanel);function updateQuestionsPanelContent(){if(!quizData||!quizData.questions||quizData.questions.length===0){console.warn("[Quiz] No quiz data available for updateQuestionsPanelContent");return}currentQuestionIndex=Math.max(0,Math.min(currentQuestionIndex,quizData.questions.length-1));const n=quizData.questions[currentQuestionIndex],e=`${currentQuestionIndex+1}/${quizData.questions.length} - ${n.question}`;console.log(`[Quiz] Updating question ${currentQuestionIndex+1}: ${n.question.substring(0,50)}...`),questionBodyText&&questionBodyText.set({content:sanitizeForMSDFFont(e),textAlign:"left",margin:0,padding:0,alignContent:"left",alignItems:"left",justifyContent:"start",position:new Vector3$1(-.92,questionBodyText.position.y,questionBodyText.position.z)});const t=Array.isArray(n&&n.options)?n.options.length:0,o=typeof window<"u"&&typeof window.getCurrentLesson=="function"?window.getCurrentLesson():typeof currentLessonName=="string"?currentLessonName:"",s=["lesson2","lesson3","lesson4","lesson5"].includes(o),r=1.2,a=1.2;try{optionsColumnRef&&typeof optionsColumnRef.set=="function"&&optionsColumnRef.set({alignItems:"center"})}catch{}const l=()=>new __webpack_exports__Block({width:r,maxWidth:r,minWidth:r,height:.09,justifyContent:"center",contentDirection:"row",flexGrow:0,flexShrink:0,borderRadius:.04,backgroundOpacity:.95,backgroundColor:new Color(2899536),margin:.02}),c=()=>new __webpack_exports__Text({content:"",fontSize:.04,fontFamily,fontTexture,textAlign:"left",color:new Color(15528177),width:a,maxWidth:a,minWidth:a,whiteSpace:"normal",lineHeight:1.2,margin:0,padding:0});try{if(optionsColumnRef)for(;optionButtons.length<t;){const u=l();try{u.renderOrder=1100}catch{}const f=c();try{f.renderOrder=1101}catch{}u.add(f),u.userData.clickable=!0,u.traverse(h=>{h&&h.userData&&(h.userData.clickable=!0)}),optionButtons.push(u),optionsColumnRef.add(u)}}catch{}const d="ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let u=0;u<optionButtons.length;u+=1){const f=optionButtons[u],h=u<t;try{f.visible=h,f.set({width:r,maxWidth:r,minWidth:r,flexGrow:0,flexShrink:0})}catch{}if(!h)continue;let m=null;if(f.children&&f.children.length>0&&(m=f.children.find(y=>y&&y.isText)||f.children[0]),!m||!m.isText){m=c();try{m.renderOrder=1102}catch{}f.add(m)}const p=n&&n.options&&n.options[u]!=null?String(n.options[u]):"",g=`${d[u]||String(u+1)}) ${p}`;f.set({backgroundColor:new Color(2899536)}),m&&m.set({content:sanitizeForMSDFFont(g),textAlign:"center",margin:0,padding:0,alignContent:"center",alignItems:"center",justifyContent:"center",width:a,maxWidth:a,minWidth:a,whiteSpace:"normal"})}try{__webpack_exports__update()}catch{}}function onOptionSelected(n){if(!quizData||showingSummary||questionInteractionLocked)return;questionInteractionLocked=!0;const e=quizData.questions[currentQuestionIndex],t=e&&typeof e.answerIndex=="number"&&e.answerIndex===n;quizResults.push({questionIndex:currentQuestionIndex,selectedOption:n,correctOption:e.answerIndex,isCorrect:t,question:e.question});const o=optionButtons[n];if(o){o.set({backgroundColor:new Color(3447003)});try{__webpack_exports__update()}catch{}}setTimeout(()=>{if(currentQuestionIndex+=1,currentQuestionIndex>=quizData.questions.length){showQuizSummary(),questionInteractionLocked=!1;return}updateQuestionsPanelContent();try{__webpack_exports__update()}catch{}questionInteractionLocked=!1},800)}function showQuizSummary(){showingSummary=!0;const n=quizResults.filter(c=>c.isCorrect).length,e=quizResults.filter(c=>!c.isCorrect).length,t=quizResults.length,o=Math.round(n/t*100);try{const c=currentLessonName||"defaultLesson",d=typeof bestScoresByLesson[c]=="number"?bestScoresByLesson[c]:0,u=Math.max(d,o);bestScoresByLesson[c]=u}catch{}const i=currentLessonName||"Lesson",s=typeof bestScoresByLesson[i]=="number"?bestScoresByLesson[i]:o,r=`Quiz Complete!

Correct: ${n}
Wrong: ${e}
Total: ${t}
Score: ${s}%

Click "Take quiz again" to retry.`;questionBodyText&&questionBodyText.set({content:sanitizeForMSDFFont(r)}),optionButtons.forEach((c,d)=>{c.visible=!1;try{c.set({backgroundColor:new Color(2899536)})}catch{}});const a=optionButtons[0];if(a){a.visible=!0;try{a.set({backgroundColor:new Color(10181046),width:.3,alignSelf:"end",margin:.22})}catch{}try{const d=a.parent;d&&typeof d.set=="function"&&d.set({alignItems:"end",justifyContent:"end"})}catch{}try{const d=a.position?a.position.z:0;a.position.set(.04,.06,d)}catch{}let c=null;a.children&&a.children.length>0&&(c=a.children.find(d=>d&&d.isText)||a.children[0]),(!c||!c.isText)&&(c=new __webpack_exports__Text({content:"",justifyContent:"start",contentDirection:"column",fontSize:.03,fontFamily,fontTexture,textAlign:"left",color:new Color(0),width:.1,lineHeight:1.2}),a.add(c));try{const d=e===0;c.set({content:d?"Try this!":"Take quiz again",textAlign:"center",width:.1,fontSize:.03})}catch{}}try{__webpack_exports__update()}catch{}const l=c=>{try{const d=questionsCamera;if(d&&a&&a.visible){const u=new Vector2$1(c.clientX/window.innerWidth*2-1,-(c.clientY/window.innerHeight)*2+1),f=new Raycaster;if(f.setFromCamera(u,d),f.intersectObjects([a],!0).length>0){const m=quizResults.filter(g=>g.isCorrect).length,p=quizResults.length;if(m===p&&p>0){let g="";try{const y=getLessonConfig&&currentLessonName?getLessonConfig(currentLessonName):null;g=y&&y.tryThisCode?String(y.tryThisCode):lessonsData&&lessonsData.tryThisCode?String(lessonsData.tryThisCode):""}catch{}if(g||(g="No code available."),questionBodyText)try{const y=formatCodeForMeshUI(g);if(questionBodyText.set({content:y,textAlign:"left",width:1.84,fontSize:.03,lineHeight:1.15,margin:0,padding:0,alignContent:"left",alignItems:"left",justifyContent:"start"}),questionBodyText.position.set(.3,0,questionBodyText.position?questionBodyText.position.z:0),questionBodyText.parent)try{questionBodyText.parent.set({alignContent:"left",alignItems:"left",justifyContent:"start",padding:0,margin:0})}catch{}}catch{}try{if(a){a.visible=!0,a.set({backgroundColor:new Color(10181046),width:.3,alignSelf:"end",margin:.22});const y=a.parent;y&&typeof y.set=="function"&&y.set({alignItems:"end",justifyContent:"end"});let w=null;a.children&&a.children.length>0&&(w=a.children.find(_=>_&&_.isText)||a.children[0]),(!w||!w.isText)&&(w=new __webpack_exports__Text({content:"",fontSize:.03,fontFamily,fontTexture,textAlign:"center",color:new Color(0),width:.1,lineHeight:1.2}),a.add(w)),w.set({content:"Run Code",textAlign:"center"})}}catch{}try{__webpack_exports__update()}catch{}document.removeEventListener("pointerdown",l);try{runCodeClickHandler&&document.removeEventListener("pointerdown",runCodeClickHandler),runCodeClickHandler=y=>{try{const w=questionsCamera;if(!w||!a||!a.visible)return;const _=new Vector2$1(y.clientX/window.innerWidth*2-1,-(y.clientY/window.innerHeight)*2+1),S=new Raycaster;if(S.setFromCamera(_,w),S.intersectObjects([a],!0).length>0){try{a.visible=!1,__webpack_exports__update()}catch{}startCodeBounceAnimation()}}catch{}},document.addEventListener("pointerdown",runCodeClickHandler)}catch{}return}try{restartQuiz()}catch{quizResults=[],showingSummary=!1,currentQuestionIndex=0,optionButtons.forEach(y=>{y.visible=!0}),updateQuestionsPanelContent()}try{__webpack_exports__update()}catch{}document.removeEventListener("pointerdown",l)}}}catch{}};document.addEventListener("pointerdown",l)}function startCodeBounceAnimation(){try{if(!questionBodyText)return;runCodeAnimId&&cancelAnimationFrame(runCodeAnimId);const n=questionBodyText.position?questionBodyText.position.y:0,e=.03,t=4,o=2e3,i=performance.now(),s=r=>{const a=r-i,l=a/1e3*t*Math.PI*2;try{questionBodyText.position.set(questionBodyText.position?questionBodyText.position.x:0,n+Math.sin(l)*e,questionBodyText.position?questionBodyText.position.z:0)}catch{}try{__webpack_exports__update()}catch{}if(a<o)runCodeAnimId=requestAnimationFrame(s);else{try{questionBodyText.position.set(questionBodyText.position?questionBodyText.position.x:0,n,questionBodyText.position?questionBodyText.position.z:0)}catch{}try{__webpack_exports__update()}catch{}runCodeAnimId=null;try{questionBodyText&&(questionBodyText.visible=!1,__webpack_exports__update())}catch{}try{currentLessonName==="lesson3"&&typeof window.startLesson3Step7=="function"&&(console.log("[Lesson3] Starting LDR testing cube step after code animation"),window.startLesson3Step7())}catch(c){console.error("[Lesson3] Error starting LDR testing step:",c)}try{if(console.log("[Learning] Code animation completed, currentLessonName:",currentLessonName),currentLessonName==="lesson4"||typeof window<"u"&&typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson4"){if(console.log("[Lesson4] Code animation completed, setting lesson4CodeAnimationCompleted flag"),typeof window<"u"){window.lesson4CodeAnimationCompleted=!0,console.log("[Lesson4] lesson4CodeAnimationCompleted set to:",window.lesson4CodeAnimationCompleted);try{if(!window._lesson4_s8Played&&(typeof allAssets<"u"&&allAssets.audios&&!!allAssets.audios.lesson4_s8||console.warn("[Lesson4] lesson4_s8 audio not found in assets"),playAudio)){playAudio("lesson4_s8"),window._lesson4_s8Played=!0;const u=()=>{try{window.removeEventListener("audioComplete-lesson4_s8",u)}catch{}try{window._lesson4_s9Played||(typeof allAssets<"u"&&allAssets.audios&&allAssets.audios.lesson4_s9||console.warn("[Lesson4] lesson4_s9 audio not found in assets"),playAudio&&playAudio("lesson4_s9"),window._lesson4_s9Played=!0)}catch(h){console.warn("[Lesson4] Failed to play lesson4_s9",h)}};try{window.addEventListener("audioComplete-lesson4_s8",u)}catch{}const f=()=>{try{window.removeEventListener("audioComplete-lesson4_s9",f)}catch{}try{typeof window.showNextLessonButton=="function"&&window.showNextLessonButton(),typeof window.setForwardArrowEnabled=="function"&&window.setForwardArrowEnabled(!1),window.forwardArrow&&(window.forwardArrow.visible=!1)}catch(h){console.warn("[Lesson4] Failed to show Next Lesson button after s9",h)}};try{window.addEventListener("audioComplete-lesson4_s9",f)}catch{}}}catch(d){console.warn("[Lesson4] Failed to play lesson4_s8 from learning.js",d)}typeof window.startLesson4Step7=="function"?(console.log("[Lesson4] Starting Step7 to initialize motorGears"),window.startLesson4Step7()):console.warn("[Lesson4] startLesson4Step7 function not available")}}else console.log("[Learning] Not lesson4, currentLessonName:",currentLessonName,"window lesson:",typeof window<"u"&&typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"unknown")}catch(c){console.error("[Lesson4] Error setting code animation completed flag:",c)}try{if(currentLessonName==="lesson5"||typeof window<"u"&&typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson5"){try{typeof window<"u"&&!window._lesson5_s10Played&&(typeof allAssets<"u"&&allAssets.audios&&allAssets.audios.lesson5_s10||console.warn("[Lesson5] lesson5_s10 audio not found in assets"),playAudio&&playAudio("lesson5_s10"),window._lesson5_s10Played=!0)}catch(d){console.warn("[Lesson5] Failed to play lesson5_s10",d)}typeof window.startLesson5Step10=="function"?(console.log("[Lesson5] Starting Step10 after code animation"),window.startLesson5Step10()):console.warn("[Lesson5] startLesson5Step10 function not available");try{const d=()=>{try{window.removeEventListener("audioComplete-lesson5_s10",d)}catch{}try{window._lesson5_s11Played||(typeof allAssets<"u"&&allAssets.audios&&allAssets.audios.lesson5_s11||console.warn("[Lesson5] lesson5_s11 audio not found in assets"),playAudio&&playAudio("lesson5_s11"),window._lesson5_s11Played=!0)}catch(h){console.warn("[Lesson5] Failed to play lesson5_s11",h)}};window.addEventListener("audioComplete-lesson5_s10",d);const u=()=>{try{window.removeEventListener("audioComplete-lesson5_s11",u)}catch{}try{window._finalPlayed||(typeof allAssets<"u"&&allAssets.audios&&allAssets.audios.final||console.warn("[Lesson5] final audio not found in assets"),playAudio&&playAudio("final"),window._finalPlayed=!0)}catch(h){console.warn("[Lesson5] Failed to play final audio",h)}};window.addEventListener("audioComplete-lesson5_s11",u);const f=()=>{try{window.removeEventListener("audioComplete-final",f)}catch{}try{typeof window.showNextLessonButton=="function"&&window.showNextLessonButton(),typeof window.setForwardArrowEnabled=="function"&&window.setForwardArrowEnabled(!1),window.forwardArrow&&(window.forwardArrow.visible=!1)}catch(h){console.warn("[Lesson5] Failed to show Next/Lets Build button after final",h)}};window.addEventListener("audioComplete-final",f)}catch(d){console.warn("[Lesson5] Failed to wire audio completion chain",d)}}}catch(c){console.error("[Lesson5] Error starting Step10 after code animation:",c)}try{typeof window<"u"&&(typeof window.applyRGBLEDBlinkShader=="function"&&window.applyRGBLEDBlinkShader(),typeof window.controlRGBLEDBlink=="function"&&window.controlRGBLEDBlink("start"))}catch{}try{currentLessonName==="lesson2"?playAudio&&playAudio("lesson2_s6"):currentLessonName==="lesson3"?(playAudio&&playAudio("lesson3_s6"),setTimeout(()=>{try{typeof allAssets<"u"&&allAssets.audios&&allAssets.audios.lesson3_s8?(console.log("[Audio] Fallback triggering lesson3_s8"),playAudio&&playAudio("lesson3_s8")):console.warn("[Audio] lesson3_s8 not found in assets; check assetsEntry.js")}catch(c){console.warn("[Audio] lesson3_s8 fallback failed",c)}},4e3)):playAudio&&playAudio("lesson1_s6")}catch{}try{if(typeof window<"u"&&currentLessonName==="lesson2"){const c=()=>{try{playAudio&&playAudio("lesson2_s7")}catch{}try{const d=()=>{try{playAudio&&playAudio("lesson2_s8")}catch{}try{window.removeEventListener("audioComplete-lesson2_s7",d)}catch{}};window.addEventListener("audioComplete-lesson2_s7",d)}catch{}try{window.removeEventListener("audioComplete-lesson2_s6",c)}catch{}};window.addEventListener("audioComplete-lesson2_s6",c)}}catch{}try{if(typeof window<"u"&&currentLessonName==="lesson1"){const c=()=>{try{playAudio&&playAudio("lesson1_s8")}catch{}try{window.removeEventListener("audioComplete-lesson1_s6",c)}catch{}try{const d=()=>{try{typeof window.showNextLessonButton=="function"&&window.showNextLessonButton(),typeof window.setForwardArrowEnabled=="function"&&window.setForwardArrowEnabled(!1),window.forwardArrow&&(window.forwardArrow.visible=!1)}catch{}try{window.removeEventListener("audioComplete-lesson1_s8",d)}catch{}};window.addEventListener("audioComplete-lesson1_s8",d)}catch{}};window.addEventListener("audioComplete-lesson1_s6",c)}}catch{}try{if(typeof window<"u"&&currentLessonName==="lesson3"){const c=()=>{try{playAudio&&playAudio("lesson3_s7")}catch{}try{window.removeEventListener("audioComplete-lesson3_s6",c)}catch{}const d=()=>{try{playAudio&&playAudio("lesson3_s8")}catch{}try{window.removeEventListener("audioComplete-lesson3_s7",d)}catch{}const u=()=>{try{runCodeButton&&(runCodeButton.visible=!0,runCodeButton.userData.clickable=!0,runCodeButton.traverse(f=>{f.isMesh&&(f.userData.clickable=!0)}),console.log("[Lesson3] Showing Start Coding button after quiz completion")),window._lesson3StartCodingAudioPlayed||(playAudio("lesson3_s5"),window._lesson3StartCodingAudioPlayed=!0)}catch(f){console.error("Error showing Start Coding button for lesson3:",f)}try{window.removeEventListener("audioComplete-lesson3_s8",u)}catch{}};window.addEventListener("audioComplete-lesson3_s8",u)};window.addEventListener("audioComplete-lesson3_s7",d)};window.addEventListener("audioComplete-lesson3_s6",c)}}catch{}try{if(typeof window<"u"&&currentLessonName==="lesson2"){const c=()=>{try{window.codeEditorGroup&&(window.codeEditorGroup.visible=!0),typeof window.showNextLessonButton=="function"&&window.showNextLessonButton(),typeof window.setForwardArrowEnabled=="function"&&window.setForwardArrowEnabled(!1),window.forwardArrow&&(window.forwardArrow.visible=!1)}catch{}try{window.removeEventListener("audioComplete-lesson2_s8",c)}catch{}};window.addEventListener("audioComplete-lesson2_s8",c)}}catch{}}};runCodeAnimId=requestAnimationFrame(s)}catch{}}function restartQuiz(){showingSummary=!1,currentQuestionIndex=0,quizResults=[],questionInteractionLocked=!1,optionButtons.forEach(n=>{n.visible=!0});try{const n=optionButtons[0];n&&n.position&&n.position.set(0,0,n.position.z||0)}catch{}try{questionBodyText&&questionBodyText.position&&questionBodyText.position.set(0,0,questionBodyText.position.z||0)}catch{}try{questionsPanel&&typeof questionsPanel.set=="function"&&questionsPanel.set({padding:.08})}catch{}try{runCodeClickHandler&&document.removeEventListener("pointerdown",runCodeClickHandler),runCodeClickHandler=null,runCodeAnimId&&(cancelAnimationFrame(runCodeAnimId),runCodeAnimId=null)}catch{}try{const n=optionButtons&&optionButtons.length>0?optionButtons[0].parent:null;n&&typeof n.set=="function"&&(n.set({contentDirection:"column",justifyContent:"start",alignItems:"stretch",width:1.84,height:1.2,margin:.2}),n.position&&n.position.set(0,0,n.position.z||0)),optionButtons.forEach(e=>{try{e.set({width:1.84,height:.09,justifyContent:"center",contentDirection:"row",borderRadius:.04,backgroundOpacity:.95,backgroundColor:new Color(2899536),alignSelf:"stretch",margin:.02}),e.position&&e.position.set(0,0,e.position.z||0);let t=null;if(e.children&&e.children.length>0&&(t=e.children.find(o=>o&&o.isText)||e.children[0]),t&&t.isText)try{t.set({width:1.76,textAlign:"left",fontSize:.04,lineHeight:1.2,color:new Color(15528177)}),t.position&&t.position.set(0,0,t.position.z||0)}catch{}}catch{}})}catch{}updateQuestionsPanelContent();try{__webpack_exports__update()}catch{}}function attachQuestionsHandler(n){questionsCamera=n||(typeof window<"u"?window.camera:null),questionsCamera||console.warn("[Learning] attachQuestionsHandler: camera not provided and window.camera not found"),!questionsClickHandler&&(questionsClickHandler=e=>{if(!questionsPanel||!questionsPanel.visible||questionInteractionLocked||typeof e.button=="number"&&e.pointerType==="mouse"&&e.button!==0)return;const t=performance.now?performance.now():Date.now();if(t-lastQuestionPointerDownAt<500)return;const o=questionsCamera;if(!o)return;const i=new Vector2$1(e.clientX/window.innerWidth*2-1,-(e.clientY/window.innerHeight)*2+1),s=new Raycaster;s.setFromCamera(i,o);const r=optionButtons.filter(l=>l&&l.visible),a=s.intersectObjects(r,!0);if(a.length>0){const l=a[0].object,c=optionButtons.findIndex(d=>l===d||d.children.includes(l)||l.parent&&l.parent.parent===d);if(c>=0){lastQuestionPointerDownAt=t;try{e.stopPropagation()}catch{}try{e.preventDefault&&e.preventDefault()}catch{}onOptionSelected(c)}}},document.addEventListener("pointerdown",questionsClickHandler))}function fireTakeQuiz(){try{document.dispatchEvent(new CustomEvent("learning:takeQuiz",{detail:{lesson:currentLessonName,index:currentLessonIndex}}))}catch{}startFreshQuiz()}function startFreshQuiz(){console.log(`[Quiz] Starting fresh quiz for lesson: ${currentLessonName}`);try{const n=currentLessonName||(typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson1");console.log(`[Quiz] Actual lesson determined: ${n} (currentLessonName: ${currentLessonName})`),n==="lesson2"?(quizData=questionsLesson2||null,console.log("[Quiz] Loaded lesson2 questions")):n==="lesson3"?(quizData=questionsLesson3||null,console.log("[Quiz] Loaded lesson3 questions")):n==="lesson4"?(quizData=questionsLesson4||null,console.log("[Quiz] Loaded lesson4 questions")):n==="lesson5"?(quizData=questionsLesson5||null,console.log("[Quiz] Loaded lesson5 questions")):(quizData=questionsLesson1||null,console.log("[Quiz] Loaded lesson1 questions (default)"));try{quizData&&quizData.questions&&quizData.questions.length>5&&(quizData={...quizData,questions:quizData.questions.slice(0,5)})}catch{}if(currentQuestionIndex=0,quizResults=[],showingSummary=!1,questionInteractionLocked=!1,questionsPanel){try{restartQuiz()}catch{}try{questionBodyText&&(questionBodyText.visible=!0,questionBodyText.set({content:"",fontSize:.05,fontFamily,fontTexture,textAlign:"left",color:new Color(16777215),width:1.84,lineHeight:1.3,margin:0,padding:0}))}catch{}updateQuestionsPanelContent();try{__webpack_exports__update()}catch{}}}catch{}uiMode="quiz";try{hideLearningPanel()}catch{}try{showQuestionsPanel()}catch{}}function refreshFromState(){if(!currentLessonName)return;const n=getLessonConfig(currentLessonName);if(!n)return;const e=n.labels||[],t=n.contents||[],o=Math.min(e.length,t.length);if(o===0)return;currentLessonIndex=clampIndex(currentLessonIndex,o);const i=e[currentLessonIndex]||"",s=t[currentLessonIndex]||"",r=formatAsSections(s),a=`${currentLessonIndex+1}/${o} - Click Next to continue`;updateLearningPanelContent(i,r,a);try{__webpack_exports__update()}catch{}uiMode="learning";try{hideQuestionsPanel(),learningPanel&&learningPanel.visible&&questionsPanel&&(questionsPanel.visible=!1)}catch{}if(learningNextArrow){const l=currentLessonName&&currentLessonIndex<o-1;learningNextArrow.visible=!!l}if(learningQuizButton){const c=!(currentLessonName&&currentLessonIndex<o-1),d=currentLessonIndex===0;learningQuizButton.visible=c&&!d;try{__webpack_exports__update()}catch{}}}function setLearningLesson(n){currentLessonName=n,currentLessonIndex=0,refreshFromState()}function nextLearningItem(){if(!currentLessonName)return;const n=getLessonConfig(currentLessonName);if(!n)return;const e=Math.min((n.labels||[]).length,(n.contents||[]).length);e!==0&&currentLessonIndex<e-1&&(currentLessonIndex+=1,refreshFromState())}function attachLearningArrowHandler(n){learningArrowCamera=n||(typeof window<"u"?window.camera:null),learningArrowCamera||console.warn("[Learning] attachLearningArrowHandler: camera not provided and window.camera not found"),!learningArrowClickHandler&&(learningArrowClickHandler=e=>{if(!learningNextArrow||!learningNextArrow.visible)return;const t=learningArrowCamera;if(!t)return;const o=new Vector2$1(e.clientX/window.innerWidth*2-1,-(e.clientY/window.innerHeight)*2+1),i=new Raycaster;i.setFromCamera(o,t);const s=[learningNextArrow].filter(a=>a&&a.visible);if(i.intersectObjects(s,!0).length>0){nextLearningItem();try{__webpack_exports__update()}catch{}}},document.addEventListener("pointerdown",learningArrowClickHandler))}function attachLearningQuizHandler(n){learningQuizCamera=n||(typeof window<"u"?window.camera:null),learningQuizCamera||console.warn("[Learning] attachLearningQuizHandler: camera not provided and window.camera not found"),!learningQuizClickHandler&&(learningQuizClickHandler=e=>{if(!learningQuizButton||!learningQuizButton.visible)return;const t=learningQuizCamera;if(!t)return;const o=new Vector2$1(e.clientX/window.innerWidth*2-1,-(e.clientY/window.innerHeight)*2+1),i=new Raycaster;i.setFromCamera(o,t);const s=[learningQuizButton].filter(a=>a&&a.visible);if(i.intersectObjects(s,!0).length>0){fireTakeQuiz();try{__webpack_exports__update()}catch{}}},document.addEventListener("pointerdown",learningQuizClickHandler))}async function markSceneCompleted$4(n){try{const e=auth.currentUser;if(!e)return;await updateDoc(doc(db,"users",e.uid),{[`scenesCompleted.${n}`]:!0})}catch(e){console.error("Failed to mark scene completed",e)}}let scene$7=null,camera$6,renderer$8,controls$7,animationFrameId$6=null,stats,isOrbitMode=!1,snapCameraAdjusted=!1,lesson4RunCodeClicked=!1,lesson4CodeAnimationCompleted=!1,_scene6CurrentAudio=null;function playScene6Audio(n,e=null,t=null){try{if(_scene6CurrentAudio)try{typeof _scene6CurrentAudio.stop=="function"?_scene6CurrentAudio.stop():typeof _scene6CurrentAudio.pause=="function"&&(_scene6CurrentAudio.pause(),"currentTime"in _scene6CurrentAudio&&(_scene6CurrentAudio.currentTime=0))}catch{}const o=playAudio(n,e,t);if(_scene6CurrentAudio=o||null,o)try{if(typeof o.addEventListener=="function")o.addEventListener("ended",()=>{_scene6CurrentAudio===o&&(_scene6CurrentAudio=null)},{once:!0});else if("onEnded"in o){const i=o.onEnded;o.onEnded=(...s)=>{try{typeof i=="function"&&i.apply(o,s)}catch{}_scene6CurrentAudio===o&&(_scene6CurrentAudio=null)}}}catch{}return o}catch{return playAudio(n,e,t)}}function isAllowedLesson(){if(typeof window.getCurrentLesson=="function"){const n=window.getCurrentLesson();return n==="lesson1"||n==="lesson2"||n==="lesson3"||n==="lesson4"||n==="lesson5"}return!1}async function initializeScene6(n,e){var v,g;setCurrentScene("scene6");const t=getUserInfo();stats=new Stats,stats.showPanel(0),document.body.appendChild(stats.dom),createGUI().close(),camera$6=new PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),window.camera=camera$6,renderer$8=n,renderer$8.shadowMap.enabled=!0,renderer$8.shadowMap.type=PCFSoftShadowMap,renderer$8.physicallyCorrectLights=!0,renderer$8.toneMapping=ACESFilmicToneMapping,renderer$8.toneMappingExposure=1,renderer$8.outputEncoding=void 0,renderer$8.domElement.parentElement||document.body.appendChild(renderer$8.domElement),await loadAllAsset(assetsEntry$3,camera$6,renderer$8),console.log("[Scene6] Loaded model keys:",Object.keys(allAssets$4.models.gltf)),console.log("[Scene6] Battery present:",!!allAssets$4.models.gltf.battery),scene$7=new Scene,allAssets$4.hdris.sky6&&(scene$7.environment=allAssets$4.hdris.sky6,scene$7.background=allAssets$4.hdris.sky6),scene$7.add(camera$6),window.currentScene=scene$7,window.showBlinkingButton=showBlinkingButton,initializeAudioManager(camera$6,scene$7);let i=null;const s=allAssets$4.models.gltf.mainModel;if(s){s.traverse(w=>{w.isMesh&&console.log("Mesh found in mainModel:",w.name)});let y=null;s.traverse(w=>{w.isMesh&&w.name==="screen"&&(y=w)}),console.log("Reference to screen mesh:",y),i=initializePhysicsAndPlayer(s,{position:{x:0,y:1,z:0},rotation:{x:0,y:0,z:0}},[],scene$7,camera$6,controls$7),(v=i==null?void 0:i.playerFunction)!=null&&v.model&&(i.playerFunction.model.visible=!1)}window.addEventListener("loadingScreenHidden-scene6",()=>{console.log("Loading screen hidden - Scene6 is ready!");try{playScene6Audio("narrator_intro")}catch(y){console.warn("Failed to start narrator_intro:",y)}});const r=new AmbientLight(16777215,1);scene$7.add(r);const a=new DirectionalLight(16777215,1);if(a.position.set(5,5,5),a.castShadow=!0,scene$7.add(a),isAllowedLesson()){const y=allAssets$4.models.gltf.nano1;y&&(y.position.copy(modelTransforms.nano1.position),y.scale.copy(modelTransforms.nano1.scale),y.rotation.copy(modelTransforms.nano1.rotation),scene$7.add(y),window.nanoModel=y);const w=allAssets$4.models.gltf.expansionBoard;w&&(w.position.copy(modelTransforms.expansionBoard.position),w.scale.copy(modelTransforms.expansionBoard.scale),w.rotation.copy(modelTransforms.expansionBoard.rotation),scene$7.add(w),window.expansionBoardModel=w);const _=allAssets$4.models.gltf.rgbLEDModule;_&&(_.position.copy(modelTransforms.rgbLED.position),_.scale.copy(modelTransforms.rgbLED.scale),_.rotation.copy(modelTransforms.rgbLED.rotation),scene$7.add(_),window.rgbLEDModel=_,window.rgbLEDModel=_,window.applyRGBLEDBlinkShader=function(){try{let R=!1;const O=[];_.traverse($=>{if($.isMesh){if(console.log("RGB LED child name:",$.name),O.push($.name||"<no-name>"),R)return;if(typeof $.name=="string"&&$.name==="rgbled"){const P=new MeshStandardMaterial({color:16711680,emissive:16711680,emissiveIntensity:.5,transparent:!0,opacity:1,metalness:.1,roughness:.3});$.userData.originalMaterial=$.material,$.material=P;let L=0;const B=2;$.userData.blinkUpdate=b=>{if($.userData.blinkActive===!1)return;const z=$.userData.blinkSpeed||B;L+=b*z;const N=Math.sin(L*Math.PI*2)*.5+.5;P.emissiveIntensity=N*.8,P.opacity=.3+N*.7;const G=.3+N*.7;P.color.setRGB(G,0,0),P.emissive.setRGB(G*.5,0,0)},$.userData.blinkActive=!0,$.userData.blinkSpeed=B,window.rgbLEDBlinkMaterial=P,window.rgbLEDBlinkMesh=$,R=!0,console.log("Blink shader applied to RGB LED child:",$.name)}}}),R?console.log("RGB LED blink shader successfully applied"):console.warn("RGB LED child 'rgbled' not found. Available child names:",O)}catch(R){console.error("Failed to apply blink shader to RGB LED:",R)}},console.log("RGB LED blink shader function created. Call window.applyRGBLEDBlinkShader() to apply it."));const S=[];(g=window.rgbLEDModel)==null||g.traverse(R=>{R.isMesh&&S.push(R.name)}),console.log(S);const C=allAssets$4.models.gltf.buzzer;C&&(C.position.copy(modelTransforms.buzzer.position),C.scale.copy(modelTransforms.buzzer.scale),C.rotation.copy(modelTransforms.buzzer.rotation),scene$7.add(C),window.buzzerModel=C,C.visible=!1);const A=allAssets$4.models.gltf.tempSensor;A&&(A.position.copy(modelTransforms.tempSensor.position),A.scale.copy(modelTransforms.tempSensor.scale),A.rotation.copy(modelTransforms.tempSensor.rotation),scene$7.add(A),window.tempSensorModel=A,A.visible=!1);const E=allAssets$4.models.gltf.battery;if(console.log("[Scene6] batteryModel fetched:",!!E),E)try{E.position.set(.8,1.7,-3.4),E.scale.copy(modelTransforms.battery.scale),scene$7.add(E),window.batteryModel=E,E.visible=!0,console.log("[Scene6] batteryModel added to scene.")}catch(R){console.error("[Scene6] Error adding batteryModel:",R)}else console.warn("[Scene6] batteryModel not found in allAssets.models.gltf");const k=new JstXhFemalePin$2({pinCount:2,twoSide:!1,position:new Vector3$1(.8,1.7,-3.2),wireConfigs:[{startPosition:new Vector3$1(.8,1.7,-3.3),color:16711680},{startPosition:new Vector3$1(.76,1.7,-3.3),color:65280}]},scene$7);k.group.visible=!0,window.jstPinBattery=k,window.jstPinBatterySide1=k.pinGLTF1,k.pinGLTF1&&(k.pinGLTF1.rotation.y=-Math.PI/2,k.updatePosition(new Vector3$1(.8,1.7,-3.2),k.pinGLTF1));const I=new JstXhFemalePin$2({pinCount:3,twoSide:!0,jstPinConfig:[{startPosition:new Vector3$1(-.5,1.8,-3)},{startPosition:new Vector3$1(0,1.7,-3.05)}],colors:["black","brown","red"]},scene$7);I.group.visible=!1,window.jstPin3=I,window.jstPin3Side1=I.pinGLTF1,window.jstPin3Side2=I.pinGLTF2,I.pinGLTF1&&I.pinGLTF2&&(I.pinGLTF1.rotation.z=Math.PI*3,I.pinGLTF1.rotation.y=-Math.PI*3,I.updatePosition(new Vector3$1(-.5,1.8,-3),I.pinGLTF1),I.pinGLTF2.rotation.y=-Math.PI*3,I.pinGLTF2.rotation.z=Math.PI*3,I.updatePosition(new Vector3$1(0,1.8,-3.05),I.pinGLTF2));const F=new JstXhFemalePin$2({pinCount:3,twoSide:!0,jstPinConfig:[{startPosition:new Vector3$1(-.5,1.8,-3)},{startPosition:new Vector3$1(0,1.7,-3.05)}],colors:["black","brown","red"]},scene$7);F.group.visible=!1,window.jstPin2=F,window.jstPin2Side1=F.pinGLTF1,window.jstPin2Side2=F.pinGLTF2,F.pinGLTF1&&F.pinGLTF2&&(window.secondPin4Female=F.pinGLTF1,F.pinGLTF1.rotation.z=Math.PI*3,F.pinGLTF1.rotation.y=-Math.PI*3,F.updatePosition(new Vector3$1(-.5,1.8,-3),F.pinGLTF1),window.secondPin4Female=F.pinGLTF2,F.pinGLTF2.rotation.y=-Math.PI*3,F.pinGLTF2.rotation.z=Math.PI*3,F.updatePosition(new Vector3$1(0,1.8,-3.05),F.pinGLTF2)),window.raycasterSetup&&typeof window.raycasterSetup.refreshPinModelsRef=="function"&&(window.raycasterSetup.refreshPinModelsRef(),console.log("[Scene6] Refreshed raycaster pin models reference after creating lesson2 JST pins"));const M=new JstXhFemalePin$2({pinCount:4,twoSide:!0,jstPinConfig:[{startPosition:new Vector3$1(.5,1.8,-3)},{startPosition:new Vector3$1(0,1.8,-3)}]},scene$7);window.jstPin=M,M.pinGLTF1&&M.updatePosition(new Vector3$1(.5,1.8,-3),M.pinGLTF1),M.pinGLTF2&&(window.secondPin4Female=M.pinGLTF2,M.pinGLTF2.rotation.z=-Math.PI*2,M.updatePosition(new Vector3$1(0,1.8,-3),M.pinGLTF2))}if(!window.batteryModel&&allAssets$4.models.gltf.battery)try{const y=allAssets$4.models.gltf.battery;y.position.set(-.5,1.8,-3.1),scene$7.add(y),window.batteryModel=y,y.visible=!0,console.log("[Scene6] batteryModel added via fallback.")}catch(y){console.error("[Scene6] Error adding batteryModel (fallback):",y)}let l=null;if(l=new Group,scene$7.add(l),scene$7.add(codePlane),codePlane.position.set(.2,2.5,-4.01),l.add(codePlane),scene$7.add(instructionsLabel),l.add(instructionsLabel),window.codeEditorGroup=l,typeof setCodePlaneToInstructions=="function"&&setCodePlaneToInstructions(),scene$7.add(forwardArrow),l.add(forwardArrow),scene$7.add(runCodeButton),scene$7.add(showBlinkingButton),scene$7.add(nextLessonButton),l.add(nextLessonButton),window.showNextLessonButton=showNextLessonButton,window.hideNextLessonButton=hideNextLessonButton,window._runCodeRaycastHandler||(window._runCodeRaycastHandler=y=>{var C,A,E,k,I,F,M,R,O,$,T,D;if(!runCodeButton||!runCodeButton.visible||!camera$6)return;const w=new Vector2$1(y.clientX/window.innerWidth*2-1,-(y.clientY/window.innerHeight)*2+1),_=new Raycaster;if(_.setFromCamera(w,camera$6),_.intersectObjects([runCodeButton],!0).length>0){try{typeof window.showCodeEditorPanels=="function"?window.showCodeEditorPanels():(emptyPanel&&(emptyPanel.visible=!0),rgbPinContainer&&(rgbPinContainer.visible=!0))}catch{}if(typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson1"){console.log("[Lesson1] Start Coding button clicked!");try{runCodeButton.userData.clickable=!1,runCodeButton.visible=!1,runCodeButton.parent&&runCodeButton.parent.remove(runCodeButton),console.log("[Lesson1] Start Coding button hidden")}catch(P){console.warn("[Lesson1] Error hiding Start Coding button:",P)}createLearningPanel(scene$7),showLearningPanel(),setTimeout(()=>{try{setLearningLesson(typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson1")}catch{}},100);try{window.codePlane&&(window.codePlane.visible=!1),typeof hideInstructionsLabel=="function"&&hideInstructionsLabel()}catch{}try{typeof setForwardArrowEnabled=="function"&&setForwardArrowEnabled(!0),typeof forwardArrow<"u"&&forwardArrow&&(forwardArrow.visible=!1)}catch{}new Vector3$1(((A=(C=window.lesson1CameraGUI)==null?void 0:C.targetPos)==null?void 0:A.x)??6,((k=(E=window.lesson1CameraGUI)==null?void 0:E.targetPos)==null?void 0:k.y)??2,((F=(I=window.lesson1CameraGUI)==null?void 0:I.targetPos)==null?void 0:F.z)??4),new Vector3$1(((R=(M=window.lesson1CameraGUI)==null?void 0:M.targetLook)==null?void 0:R.x)??6,(($=(O=window.lesson1CameraGUI)==null?void 0:O.targetLook)==null?void 0:$.y)??2.25,((D=(T=window.lesson1CameraGUI)==null?void 0:T.targetLook)==null?void 0:D.z)??4);return}if(typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson3"){console.log("[Lesson3] Start Coding button clicked! (no camera animation)");try{createLearningPanel(scene$7),showLearningPanel();try{setLearningLesson(typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson3")}catch{}try{window.codePlane&&(window.codePlane.visible=!1),typeof hideInstructionsLabel=="function"&&hideInstructionsLabel()}catch{}}catch(P){console.warn("[Lesson3] Error preparing learning panel:",P)}try{runCodeButton.userData.clickable=!1,runCodeButton.visible=!1,runCodeButton.parent&&runCodeButton.parent.remove(runCodeButton)}catch{}try{window.codeEditorGroup&&(window.codeEditorGroup.visible=!1)}catch{}window.setForwardArrowEnabled&&window.setForwardArrowEnabled(!1),window.forwardArrow&&(window.forwardArrow.visible=!1);return}if(typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson2"){console.log("[Lesson2] Start Coding button clicked! (no camera animation)");try{createLearningPanel(scene$7),showLearningPanel();try{setLearningLesson(typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson2")}catch{}try{window.codePlane&&(window.codePlane.visible=!1),typeof hideInstructionsLabel=="function"&&hideInstructionsLabel()}catch{}}catch(P){console.warn("[Lesson2] Error preparing learning panel:",P)}try{runCodeButton.userData.clickable=!1,runCodeButton.visible=!1,runCodeButton.parent&&runCodeButton.parent.remove(runCodeButton)}catch{}try{window.codeEditorGroup&&(window.codeEditorGroup.visible=!1)}catch{}window.setForwardArrowEnabled&&window.setForwardArrowEnabled(!1),window.forwardArrow&&(window.forwardArrow.visible=!1);return}if(typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson4"){console.log("[Lesson4] Start Coding button clicked! (no camera animation)"),lesson4RunCodeClicked=!0,typeof window<"u"&&(window.lesson4RunCodeClicked=!0,console.log("[Lesson4] Run code button clicked, lesson4RunCodeClicked set to:",window.lesson4RunCodeClicked));try{createLearningPanel(scene$7),showLearningPanel();const P=typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson4";console.log("[Lesson4] Setting learning lesson to:",P);try{setLearningLesson(P)}catch(L){console.error("[Lesson4] Error setting learning lesson:",L)}try{window.codePlane&&(window.codePlane.visible=!1),typeof hideInstructionsLabel=="function"&&hideInstructionsLabel()}catch{}}catch(P){console.warn("[Lesson4] Error preparing learning panel:",P)}try{runCodeButton.userData.clickable=!1,runCodeButton.visible=!1,runCodeButton.parent&&runCodeButton.parent.remove(runCodeButton)}catch{}try{window.codeEditorGroup&&(window.codeEditorGroup.visible=!1)}catch{}window.setForwardArrowEnabled&&window.setForwardArrowEnabled(!1),window.forwardArrow&&(window.forwardArrow.visible=!1);try{togglePlayerControls&&togglePlayerControls(!1)}catch{}try{enableCameraControls&&enableCameraControls()}catch{}try{isOrbitMode=!0}catch{}return}if(typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson5"){console.log("[Lesson5] Start Coding button clicked! (no camera animation)");try{createLearningPanel(scene$7),showLearningPanel();try{setLearningLesson(typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson5")}catch{}try{window.codePlane&&(window.codePlane.visible=!1),typeof hideInstructionsLabel=="function"&&hideInstructionsLabel()}catch{}}catch(P){console.warn("[Lesson5] Error preparing learning panel:",P)}try{runCodeButton.userData.clickable=!1,runCodeButton.visible=!1,runCodeButton.parent&&runCodeButton.parent.remove(runCodeButton)}catch{}try{window.codeEditorGroup&&(window.codeEditorGroup.visible=!1)}catch{}window.setForwardArrowEnabled&&window.setForwardArrowEnabled(!1),window.forwardArrow&&(window.forwardArrow.visible=!1);return}controls$7&&(controls$7.enabled=!1,controls$7.minDistance=0,controls$7.maxDistance=1/0,controls$7.minAzimuthAngle=-1/0,controls$7.maxAzimuthAngle=1/0,controls$7.minPolarAngle=0,controls$7.maxPolarAngle=Math.PI,controls$7.enablePan=!0,controls$7.enableZoom=!0,console.log("[StartCoding] Orbit controls disabled and limits cleared")),function(){new Vector3$1(-2.5,2.25,-2.3);const P=new Vector3$1(-1.2,2,-1);gsapWithCSS.to(camera$6.position,{x:P.x,y:P.y,z:P.z,duration:2,ease:"power2.inOut",onUpdate:()=>{},onComplete:()=>{}})}();try{runCodeButton.userData.clickable=!1,runCodeButton.visible=!1,runCodeButton.parent&&runCodeButton.parent.remove(runCodeButton)}catch{}}},window.addEventListener("pointerdown",window._runCodeRaycastHandler)),window.forwardArrow=forwardArrow,window.setForwardArrowEnabled=setForwardArrowEnabled,window.getCurrentStep=getCurrentStep$1,updateNextButtonState(),forwardArrow.position.set(.2+.7,2.1,-4.01),!window._codeEditorRaycastHandler){let y=!1;window._codeEditorRaycastHandler=w=>{const _=new Vector2$1(w.clientX/window.innerWidth*2-1,-(w.clientY/window.innerHeight)*2+1),S=new Raycaster;S.setFromCamera(_,camera$6);const C=[];l.traverse(E=>{(E.isMesh||E.isUI)&&C.push(E)}),C.includes(codePlane)||C.push(codePlane),C.includes(forwardArrow)||C.push(forwardArrow),C.includes(instructionsLabel)||C.push(instructionsLabel);const A=S.intersectObjects(C,!0);if(A.length>0){let E=null;for(const k of A){const I=k.object.userData&&k.object.userData.parentButton?k.object.userData.parentButton:k.object;if(I===forwardArrow){E=forwardArrow;break}I===codePlane&&(E=codePlane)}if(E===forwardArrow&&w.type==="pointerdown"){let R=function(){F++;const O=I.slice(0,F).join(" ");if(updateCodePlaneWithInstruction(O),F<I.length)setTimeout(R,M);else{try{const L=typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson1";if(L==="lesson4"){const B=getCurrentStep$1();setTimeout(()=>{},1e3);return}}catch{}const $=getCurrentStep$1(),T=typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson2"&&$===1;isLastStep(),T&&(scene$7.children.includes(makeSomeNoiseButton)||scene$7.add(makeSomeNoiseButton),makeSomeNoiseButton.visible=!1);const D=typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson1";$!==0&&applyStepShader(D,$),window.orbitControls&&$>=1&&(window.orbitControls.enabled=!0,console.log("OrbitControls enabled after step",$,"reveal")),setTimeout(()=>{},1e3)}};if(!forwardArrow.userData.clickable||window.cameraAnimationDisabled)return;try{if(learningPanel&&learningPanel.visible&&typeof nextLearningItem=="function"){nextLearningItem();return}}catch{}if(typeof setForwardArrowEnabled=="function"&&getCurrentStep$1()<getTotalSteps()-1&&setForwardArrowEnabled(!1),getCurrentStep$1()===0&&!y){let P=function(){T++;const L=$.slice(0,T).join(" ");updateCodePlaneWithInstruction(L),T<$.length?setTimeout(P,D):(l.add(beginBlinkButton),beginBlinkButton.visible=!0,beginBlinkButton.material&&beginBlinkButton.traverse(B=>{B.material&&gsapWithCSS.to(B.material,{opacity:.4,duration:.6,yoyo:!0,repeat:-1,ease:"power1.inOut",repeatRefresh:!0,onRepeat:function(){}})}),window._beginBlinkRaycastHandler=B=>{const b=new Vector2$1(B.clientX/window.innerWidth*2-1,-(B.clientY/window.innerHeight)*2+1),z=new Raycaster;if(z.setFromCamera(b,camera$6),z.intersectObjects([beginBlinkButton],!0).length>0){console.log("Begin Blink button clicked! Applying shader...");const G=typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson1",K=typeof getCurrentStep$1=="function"?getCurrentStep$1():0;console.log("Applying shader for lesson:",G,"step:",K),applyStepShader(G,K),beginBlinkButton.visible=!1,l.remove(beginBlinkButton),window.removeEventListener("pointerdown",window._beginBlinkRaycastHandler),window._beginBlinkRaycastHandler=null,beginBlinkButton.traverse(ne=>{ne.material&&(gsapWithCSS.killTweensOf(ne.material),ne.material.opacity=.85)})}},window.addEventListener("pointerdown",window._beginBlinkRaycastHandler))};y=!0,togglePlayerControls(!1),enableCameraControls(),isOrbitMode=!0;const $=getCurrentStepText().split(" ");let T=0;const D=450;try{typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson1"&&getCurrentStep$1()===0&&playScene6Audio("lesson1_s1")}catch(L){console.warn("Failed to play lesson1 step 1 audio:",L)}updateCodePlaneWithInstruction(""),typeof setForwardArrowEnabled=="function"&&getCurrentStep$1()===0&&setForwardArrowEnabled(!1),P();return}if(getCurrentStep$1()===getTotalSteps()-1&&getCurrentStepText&&getCurrentStepText().length>0){typeof showNextLessonButton=="function"&&showNextLessonButton(),forwardArrow&&(forwardArrow.visible=!1);return}try{typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson4"&&window.jstPin3&&window.jstPin3.group&&(window.jstPin3.group.visible=!1)}catch{}nextStep();try{const O=typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson2",$=typeof getCurrentStep$1=="function"?getCurrentStep$1():-1;O&&$===1&&(scene$7&&!scene$7.children.includes(makeSomeNoiseButton)&&scene$7.add(makeSomeNoiseButton),makeSomeNoiseButton.visible=!1)}catch{}const I=getCurrentStepText().split(" ");let F=0;const M=250;try{const O=typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson1";O&&getCurrentStep$1()===1?playScene6Audio("lesson1_s2"):O&&getCurrentStep$1()===2?playScene6Audio("lesson1_s3"):O&&getCurrentStep$1()===3&&playScene6Audio("lesson1_s4")}catch(O){console.warn("Failed to play lesson1 step 2 audio:",O)}R()}}},window.addEventListener("pointerdown",window._codeEditorRaycastHandler)}if(typeof window.getCurrentLesson=="function"&&(window.getCurrentLesson()==="lesson1"||window.getCurrentLesson()==="lesson2"||window.getCurrentLesson()==="lesson3"||window.getCurrentLesson()==="lesson4")){const y=new RaycasterSetup1(scene$7,camera$6,controls$7,w=>{w==="secondPin4Female"&&(window.orbitControls&&getCurrentStep$1()>=1&&(window.orbitControls.enabled=!1,setTimeout(()=>{window.orbitControls.enabled=!0,console.log("OrbitControls enabled after 1s delay for secondPin4Female snap")},1e3)),window.setForwardArrowEnabled&&window.setForwardArrowEnabled(!0),window.rgbLEDModel&&console.log("RGB LED rotation triggered by JST pin snap")),w==="jstPinBattery"&&(window.orbitControls&&getCurrentStep$1()>=1&&(window.orbitControls.enabled=!1,setTimeout(()=>{window.orbitControls.enabled=!0,console.log("OrbitControls enabled after 1s delay for jstPinBattery snap")},1e3)),window.getCurrentLesson&&window.getCurrentLesson()==="lesson2"?(window.setForwardArrowEnabled&&window.setForwardArrowEnabled(!1),window.forwardArrow&&(window.forwardArrow.visible=!1),runCodeButton&&(scene$7&&!scene$7.children.includes(runCodeButton)&&scene$7.add(runCodeButton),runCodeButton.userData.clickable=!0,runCodeButton.traverse(_=>{_.isMesh&&(_.userData.clickable=!0)}),runCodeButton.visible=!0,typeof runCodeButton.update=="function"&&runCodeButton.update())):window.getCurrentLesson&&window.getCurrentLesson()==="lesson3"?(runCodeButton&&(scene$7&&!scene$7.children.includes(runCodeButton)&&scene$7.add(runCodeButton),runCodeButton.userData.clickable=!0,runCodeButton.traverse(_=>{_.isMesh&&(_.userData.clickable=!0)}),runCodeButton.visible=!0,typeof runCodeButton.update=="function"&&runCodeButton.update()),window.setForwardArrowEnabled&&window.setForwardArrowEnabled(!1),window.forwardArrow&&(window.forwardArrow.visible=!1)):window.setForwardArrowEnabled&&window.setForwardArrowEnabled(!0)),w==="nanoModelStep2"&&(new Vector3$1(camera$6.position.x,camera$6.position.y,camera$6.position.z-2),typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson1"?setTimeout(runAnim,2e3):runAnim()),w==="jstPin3Side1"&&!window.cameraAnimationDisabled&&(new Vector3$1(camera$6.position.x,camera$6.position.y,camera$6.position.z-2),setTimeout(()=>{window.setForwardArrowEnabled&&typeof getCurrentStep$1=="function"&&getCurrentStep$1()===2&&(window.setForwardArrowEnabled(!0),console.log("[Lesson3] Enabled Next button after jstPin3Side1 connection"))})),w==="jstPin3Side2"&&!window.cameraAnimationDisabled&&(new Vector3$1(camera$6.position.x,camera$6.position.y,camera$6.position.z-2),setTimeout(()=>{window.setForwardArrowEnabled&&typeof getCurrentStep$1=="function"&&getCurrentStep$1()===3&&(window.setForwardArrowEnabled(!0),console.log("[Lesson3] Enabled Next button after jstPin3Side2 connection"))})),w==="ledExpansionBoard"&&!window.cameraAnimationDisabled&&(new Vector3$1(camera$6.position.x,camera$6.position.y,camera$6.position.z-2),setTimeout(()=>{window.setForwardArrowEnabled&&typeof getCurrentStep$1=="function"&&getCurrentStep$1()===4&&(window.setForwardArrowEnabled(!0),console.log("[Lesson3] Enabled Next button after LED expansion board connection"))})),w==="ledModule"&&!window.cameraAnimationDisabled&&(new Vector3$1(camera$6.position.x,camera$6.position.y,camera$6.position.z-2),setTimeout(()=>{window.setForwardArrowEnabled&&typeof getCurrentStep$1=="function"&&getCurrentStep$1()===5&&(window.setForwardArrowEnabled(!0),console.log("[Lesson3] Enabled Next button after LED module connection"))})),w==="jstPinBattery"&&!window.cameraAnimationDisabled&&(new Vector3$1(camera$6.position.x,camera$6.position.y,camera$6.position.z-2),setTimeout(()=>{if(window.setForwardArrowEnabled&&typeof getCurrentStep$1=="function"&&getCurrentStep$1()===6&&typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson3"&&(window.setForwardArrowEnabled(!0),console.log("[Lesson3] Enabled Next button after battery connection")),typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson3"&&typeof getCurrentStep$1=="function"&&getCurrentStep$1()===6)try{runCodeButton&&(scene$7&&!scene$7.children.includes(runCodeButton)&&scene$7.add(runCodeButton),runCodeButton.userData.clickable=!0,runCodeButton.traverse(_=>{_.isMesh&&(_.userData.clickable=!0)}),runCodeButton.visible=!0,typeof runCodeButton.update=="function"&&runCodeButton.update(),console.log("[Lesson3] Showed Start Coding button after battery connection")),window.setForwardArrowEnabled&&window.setForwardArrowEnabled(!1),window.forwardArrow&&(window.forwardArrow.visible=!1)}catch(_){console.warn("[Lesson3] Error showing Start Coding button:",_)}}))});window.raycasterSetup=y}renderer$8.render(scene$7,camera$6);const f=new Clock;function h(){if(t.modeSelected==="vr")renderer$8.setAnimationLoop(m);else{let y=function(){if(!camera$6){cancelAnimationFrame(animationFrameId$6);return}animationFrameId$6=requestAnimationFrame(y),m()};y()}}function m(){var _;if(!camera$6)return;stats.begin();const y=f.getDelta();if(controls$7&&window.orbitControls&&window.orbitControls.update(),t.modeSelected==="vr"&&updateVR(),!isOrbitMode&&((_=i==null?void 0:i.playerFunction)!=null&&_.player)){const S=i.playerFunction.player;S.updateMatrixWorld(),s.collisionMesh&&handleCollisions(S,s.collisionMesh,playerState.velocity,y),playerState.velocity.length()>0&&(S.position.x+=playerState.velocity.x*y,S.position.z+=playerState.velocity.z*y,playerState.onGround||(S.position.y+=playerState.velocity.y*y)),camera$6.position.set(S.position.x,S.position.y+.05,S.position.z);const A=10,E=new Vector3$1(0,0,-1);E.applyAxisAngle(new Vector3$1(0,1,0),S.rotation.y),new Vector3$1().copy(camera$6.position).add(E.multiplyScalar(A))}if(getCurrentStep$1()===0&&typeof jstPin<"u"&&jstPin&&jstPin.pinGLTF1){const S=new Vector3$1(-.03,1.77,-3.26),C=.01,E=jstPin.pinGLTF1.position.distanceTo(S);E<C&&!snapCameraAdjusted&&(isOrbitMode=!0,snapCameraAdjusted=!0),E>=C&&(snapCameraAdjusted=!1)}const w=typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"unknown";if(w==="lesson4"){const S=lesson4RunCodeClicked||typeof window<"u"&&window.lesson4RunCodeClicked,C=lesson4CodeAnimationCompleted||typeof window<"u"&&window.lesson4CodeAnimationCompleted;(S||C)&&console.log("[Lesson4] Debug - currentLesson:",w,"runCodeClicked:",S,"animationCompleted:",C),S&&C&&(console.log("[Lesson4] Both conditions met, running updateFunction"),updateFunction(y))}if(window.getCurrentLesson()==="lesson5"&&updateFunction$1(y),updateShader(y),window.rgbLEDBlinkMesh&&window.rgbLEDBlinkMesh.userData.blinkUpdate)try{window.rgbLEDBlinkMesh.userData.blinkUpdate(y)}catch(S){console.warn("Error updating RGB LED blink animation:",S)}window.raycasterSetup&&typeof window.raycasterSetup.update=="function"&&window.raycasterSetup.update(y);try{typeof __webpack_exports__default<"u"&&typeof __webpack_exports__default.update=="function"?__webpack_exports__default.update():console.warn("ThreeMeshUI.update is not available")}catch(S){console.warn("Error during ThreeMeshUI.update:",S)}renderer$8.render(scene$7,camera$6),stats.end()}h();const p=()=>{const y=window.innerWidth/window.innerHeight;camera$6&&renderer$8&&(camera$6.aspect=y,camera$6.updateProjectionMatrix(),renderer$8.setSize(window.innerWidth,window.innerHeight))};return window.addEventListener("resize",p),e&&initializeVR(renderer$8,scene$7,camera$6,null,null,[],()=>{}),setLesson("lesson1"),window.logLesson3Models=function(){console.log("=== LESSON3 MODELS OVERVIEW (Called from console) ==="),console.log("Current lesson:",typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"unknown"),console.log("All available GLTF models:",Object.keys(allAssets$4.models.gltf)),console.log("--- LESSON3 SPECIFIC MODELS ---"),console.log("tempSensorModel:",{exists:!!window.tempSensorModel,name:window.tempSensorModel?window.tempSensorModel.name:"N/A",inScene:window.tempSensorModel&&scene$7?scene$7.children.includes(window.tempSensorModel):!1,visible:window.tempSensorModel?window.tempSensorModel.visible:!1,position:window.tempSensorModel?window.tempSensorModel.position:"N/A",scale:window.tempSensorModel?window.tempSensorModel.scale:"N/A"}),console.log("jstPin3 (lesson3 JST pin):",{exists:!!window.jstPin3,inScene:window.jstPin3&&window.jstPin3.group&&scene$7?scene$7.children.includes(window.jstPin3.group):!1,visible:window.jstPin3&&window.jstPin3.group?window.jstPin3.group.visible:!1,pin1Exists:!!window.jstPin3Side1,pin2Exists:!!window.jstPin3Side2}),console.log("--- COMMON MODELS USED IN LESSON3 ---"),console.log("nanoModel (Arduino):",{exists:!!window.nanoModel,name:window.nanoModel?window.nanoModel.name:"N/A",inScene:window.nanoModel&&scene$7?scene$7.children.includes(window.nanoModel):!1,visible:window.nanoModel?window.nanoModel.visible:!1,position:window.nanoModel?window.nanoModel.position:"N/A"}),console.log("expansionBoardModel:",{exists:!!window.expansionBoardModel,name:window.expansionBoardModel?window.expansionBoardModel.name:"N/A",inScene:window.expansionBoardModel&&scene$7?scene$7.children.includes(window.expansionBoardModel):!1,visible:window.expansionBoardModel?window.expansionBoardModel.visible:!1,position:window.expansionBoardModel?window.expansionBoardModel.position:"N/A"}),console.log("batteryModel:",{exists:!!window.batteryModel,name:window.batteryModel?window.batteryModel.name:"N/A",inScene:window.batteryModel&&scene$7?scene$7.children.includes(window.batteryModel):!1,visible:window.batteryModel?window.batteryModel.visible:!1,position:window.batteryModel?window.batteryModel.position:"N/A"}),console.log("jstPinBattery:",{exists:!!window.jstPinBattery,inScene:window.jstPinBattery&&window.jstPinBattery.group&&scene$7?scene$7.children.includes(window.jstPinBattery.group):!1,visible:window.jstPinBattery&&window.jstPinBattery.group?window.jstPinBattery.group.visible:!1}),console.log("--- LESSON2 MODELS (SHOULD BE HIDDEN IN LESSON3) ---"),console.log("buzzerModel:",{exists:!!window.buzzerModel,name:window.buzzerModel?window.buzzerModel.name:"N/A",inScene:window.buzzerModel&&scene$7?scene$7.children.includes(window.buzzerModel):!1,visible:window.buzzerModel?window.buzzerModel.visible:!1}),console.log("jstPin2 (lesson2 JST pin):",{exists:!!window.jstPin2,inScene:window.jstPin2&&window.jstPin2.group&&scene$7?scene$7.children.includes(window.jstPin2.group):!1,visible:window.jstPin2&&window.jstPin2.group?window.jstPin2.group.visible:!1}),console.log("--- LESSON1 MODELS (SHOULD BE HIDDEN IN LESSON3) ---"),console.log("rgbLEDModel:",{exists:!!window.rgbLEDModel,name:window.rgbLEDModel?window.rgbLEDModel.name:"N/A",inScene:window.rgbLEDModel&&scene$7?scene$7.children.includes(window.rgbLEDModel):!1,visible:window.rgbLEDModel?window.rgbLEDModel.visible:!1}),console.log("jstPin (lesson1 JST pin):",{exists:!!window.jstPin,inScene:window.jstPin&&window.jstPin.group&&scene$7?scene$7.children.includes(window.jstPin.group):!1,visible:window.jstPin&&window.jstPin.group?window.jstPin.group.visible:!1}),console.log("--- ALL SCENE CHILDREN ---"),scene$7&&scene$7.children&&scene$7.children.forEach((y,w)=>{console.log(`Scene child ${w}:`,{name:y.name||"unnamed",type:y.type,visible:y.visible,isGroup:y.isGroup,childrenCount:y.children?y.children.length:0})}),console.log("=== END LESSON3 MODELS OVERVIEW ===")},console.log("Global function 'logLesson3Models()' is now available. Call it from the console to see all lesson3 models!"),window.fixModelVisibility=function(y){if(console.log(`[DEBUG] Manually fixing model visibility for: ${y}`),y)cleanupLessonModels("unknown",y),updateLessonVisibility(y);else{const w=typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson1";console.log(`[DEBUG] No lesson specified, using current lesson: ${w}`),cleanupLessonModels("unknown",w),updateLessonVisibility(w)}console.log(`[DEBUG] Model visibility fix completed for: ${y||"current lesson"}`)},console.log("Global function 'fixModelVisibility(lessonName)' is now available. Call it from the console to fix model visibility!"),window.checkModelVisibility=function(){console.log("=== CURRENT MODEL VISIBILITY STATE ==="),console.log("rgbLEDModel (lesson1):",{exists:!!window.rgbLEDModel,visible:window.rgbLEDModel?window.rgbLEDModel.visible:"N/A",inScene:window.rgbLEDModel&&scene$7?scene$7.children.includes(window.rgbLEDModel):!1}),console.log("jstPin (lesson1):",{exists:!!window.jstPin,visible:window.jstPin&&window.jstPin.group?window.jstPin.group.visible:"N/A",inScene:window.jstPin&&window.jstPin.group&&scene$7?scene$7.children.includes(window.jstPin.group):!1}),console.log("buzzerModel (lesson2):",{exists:!!window.buzzerModel,visible:window.buzzerModel?window.buzzerModel.visible:"N/A",inScene:window.buzzerModel&&scene$7?scene$7.children.includes(window.buzzerModel):!1}),console.log("jstPin2 (lesson2):",{exists:!!window.jstPin2,visible:window.jstPin2&&window.jstPin2.group?window.jstPin2.group.visible:"N/A",inScene:window.jstPin2&&window.jstPin2.group&&scene$7?scene$7.children.includes(window.jstPin2.group):!1}),console.log("tempSensorModel (lesson3):",{exists:!!window.tempSensorModel,visible:window.tempSensorModel?window.tempSensorModel.visible:"N/A",inScene:window.tempSensorModel&&scene$7?scene$7.children.includes(window.tempSensorModel):!1}),console.log("jstPin3 (lesson3):",{exists:!!window.jstPin3,visible:window.jstPin3&&window.jstPin3.group?window.jstPin3.group.visible:"N/A",inScene:window.jstPin3&&window.jstPin3.group&&scene$7?scene$7.children.includes(window.jstPin3.group):!1}),console.log("makeSomeNoiseButton (lesson2):",{exists:!!window.makeSomeNoiseButton,visible:window.makeSomeNoiseButton?window.makeSomeNoiseButton.visible:"N/A",inScene:window.makeSomeNoiseButton&&scene$7?scene$7.children.includes(window.makeSomeNoiseButton):!1}),console.log("showBlinkingButton (lesson1):",{exists:!!window.showBlinkingButton,visible:window.showBlinkingButton?window.showBlinkingButton.visible:"N/A",inScene:window.showBlinkingButton&&scene$7?scene$7.children.includes(window.showBlinkingButton):!1}),console.log("Current lesson:",typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"unknown"),console.log("=====================================")},console.log("Global function 'checkModelVisibility()' is now available. Call it from the console to check current model visibility!"),window.refreshRaycasterPinModels=function(){window.raycasterSetup&&typeof window.raycasterSetup.refreshPinModelsRef=="function"?(window.raycasterSetup.refreshPinModelsRef(),console.log("[DEBUG] Manually refreshed raycaster pin models reference")):console.warn("[DEBUG] RaycasterSetup not available or refreshPinModelsRef method not found")},console.log("Global function 'refreshRaycasterPinModels()' is now available. Call it from the console to refresh pin models!"),window.enableNextButton=function(){window.setForwardArrowEnabled&&(window.setForwardArrowEnabled(!0),console.log("[DEBUG] Manually enabled Next button")),window.forwardArrow&&(window.forwardArrow.visible=!0,console.log("[DEBUG] Made forward arrow visible"))},console.log("Global function 'enableNextButton()' is now available. Call it from the console to enable the Next button!"),window.showStartCodingButton=function(){window.runCodeButton?(scene$7&&!scene$7.children.includes(runCodeButton)&&scene$7.add(runCodeButton),runCodeButton.userData.clickable=!0,runCodeButton.traverse(y=>{y.isMesh&&(y.userData.clickable=!0)}),runCodeButton.visible=!0,typeof runCodeButton.update=="function"&&runCodeButton.update(),console.log("[DEBUG] Manually showed Start Coding button")):console.warn("[DEBUG] Start Coding button not available")},console.log("Global function 'showStartCodingButton()' is now available. Call it from the console to show the Start Coding button!"),window.controlRGBLEDBlink=function(y,w=2){if(window.rgbLEDBlinkMesh&&window.rgbLEDBlinkMesh.userData.blinkUpdate)switch(y){case"start":window.rgbLEDBlinkMesh.userData.blinkSpeed=w,window.rgbLEDBlinkMesh.userData.blinkActive=!0,console.log("RGB LED blink started with speed:",w);break;case"stop":window.rgbLEDBlinkMesh.userData.blinkActive=!1,window.rgbLEDBlinkMaterial&&(window.rgbLEDBlinkMaterial.emissiveIntensity=.5,window.rgbLEDBlinkMaterial.opacity=1,window.rgbLEDBlinkMaterial.color.setRGB(1,0,0),window.rgbLEDBlinkMaterial.emissive.setRGB(.5,0,0)),console.log("RGB LED blink stopped");break;case"speed":window.rgbLEDBlinkMesh.userData.blinkSpeed=w,console.log("RGB LED blink speed changed to:",w);break;default:console.log("Available actions: start, stop, speed")}else console.warn("RGB LED blink mesh not found")},console.log("Global function 'controlRGBLEDBlink(action, speed)' is now available. Actions: 'start', 'stop', 'speed'"),window.setOnNextLesson=setOnNextLesson,window.setOnNextLesson(()=>{cleanupShader(),window.disableNanoSnap=!0,window.nanoModel&&(window.nanoModel.position.copy(modelTransforms.nano1.position),window.nanoModel.rotation.copy(modelTransforms.nano1.lesson2rotation),window.nanoModel.scale.copy(modelTransforms.nano1.scale)),window.expansionBoardModel&&(window.expansionBoardModel.position.copy(modelTransforms.expansionBoard.position),window.expansionBoardModel.rotation.copy(modelTransforms.expansionBoard.lesson2rotation),window.expansionBoardModel.scale.copy(modelTransforms.expansionBoard.scale));const y=typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"lesson1";let w;switch(y){case"lesson1":w="lesson2";break;case"lesson2":w="lesson3";break;case"lesson3":w="lesson4";break;case"lesson4":w="lesson5";break;case"lesson5":console.log("Lesson5 completed - transitioning to scene7"),setTimeout(async()=>{try{console.log("Starting scene7 transition...");const S=await __vitePreload(()=>Promise.resolve().then(()=>scene7),void 0),C=await __vitePreload(()=>Promise.resolve().then(()=>assetsEntry$1),void 0);console.log("Scene7 modules loaded successfully"),cleanupScene6(),console.log("Scene6 cleaned up"),markSceneCompleted$4("scene6"),checkExistingAssets(C.assetsEntry),console.log("Scene7 assets loaded");const A=getUserInfo(),E=A&&A.modeSelected==="vr";console.log("Initializing scene7 with VR mode:",E),await S.initializeScene7(renderer$8,E),console.log("Scene7 initialized successfully")}catch(S){console.error("Error transitioning to scene7:",S)}},100);return;default:w="lesson2"}console.log(`Moving from ${y} to ${w}`);const _=()=>{console.log("=== Current JST Pin States ==="),console.log("jstPin (lesson1):",{exists:!!window.jstPin,inScene:window.jstPin&&window.currentScene?window.currentScene.children.includes(window.jstPin.group):!1,visible:window.jstPin&&window.jstPin.group?window.jstPin.group.visible:!1}),console.log("jstPin2 (lesson2):",{exists:!!window.jstPin2,inScene:window.jstPin2&&window.currentScene?window.currentScene.children.includes(window.jstPin2.group):!1,visible:window.jstPin2&&window.jstPin2.group?window.jstPin2.group.visible:!1}),console.log("jstPin3 (lesson3):",{exists:!!window.jstPin3,inScene:window.jstPin3&&window.currentScene?window.currentScene.children.includes(window.jstPin3.group):!1,visible:window.jstPin3&&window.jstPin3.group?window.jstPin3.group.visible:!1}),console.log("jstPinBattery:",{exists:!!window.jstPinBattery,inScene:window.jstPinBattery&&window.currentScene?window.currentScene.children.includes(window.jstPinBattery.group):!1,visible:window.jstPinBattery&&window.jstPinBattery.group?window.jstPinBattery.group.visible:!1}),console.log("================================")};if(_(),y==="lesson1"&&w==="lesson2"){console.log("Cleaning up lesson1 components for lesson2 transition");try{window.currentScene&&window.rgbLEDModel&&(window.currentScene.remove(window.rgbLEDModel),console.log("Removed rgbLEDModel from scene")),window.jstPin&&(window.jstPin.group&&window.currentScene&&(window.currentScene.remove(window.jstPin.group),console.log("Removed jstPin group from scene")),window.jstPin.wires&&Array.isArray(window.jstPin.wires)&&(window.jstPin.wires.forEach(S=>{try{typeof S.dispose=="function"&&S.dispose()}catch{}}),console.log("Disposed jstPin wires")),window.jstPin=null,window.secondPin4Female=null,console.log("Cleared jstPin references"))}catch(S){console.warn("Error cleaning up lesson1 components:",S)}}else if(y==="lesson2"&&w==="lesson3"){console.log("Cleaning up lesson2 components for lesson3 transition");try{window.buzzerModel&&window.currentScene&&(window.currentScene.remove(window.buzzerModel),console.log("Removed buzzerModel from scene")),window.jstPin2&&window.jstPin2.group&&window.currentScene&&(window.currentScene.remove(window.jstPin2.group),console.log("Removed jstPin2 group from scene")),window.jstPin&&window.jstPin.group&&window.currentScene&&(window.currentScene.remove(window.jstPin.group),console.log("Removed lesson1 jstPin group from scene (cleanup)"),window.jstPin.wires&&Array.isArray(window.jstPin.wires)&&(window.jstPin.wires.forEach(S=>{try{typeof S.dispose=="function"&&S.dispose()}catch{}}),console.log("Disposed lesson1 jstPin wires")),window.jstPin=null,window.secondPin4Female=null),window.rgbLEDModel&&(window.rgbLEDModel.visible=!1,console.log("Hidden rgbLEDModel (lesson1) for lesson3 transition")),window.makeSomeNoiseButton&&(window.makeSomeNoiseButton.visible=!1,console.log("Hidden makeSomeNoiseButton (lesson2) for lesson3 transition")),window.showBlinkingButton&&(window.showBlinkingButton.visible=!1,console.log("Hidden showBlinkingButton (lesson1) for lesson3 transition")),window.buzzerModel=null,window.jstPin2=null,console.log("Cleared lesson2 component references")}catch(S){console.warn("Error cleaning up lesson2 components:",S)}}else if(y==="lesson3"&&w==="lesson4"){console.log("Transitioning from lesson3 to lesson4, scene state:",!!scene$7,"scene type:",typeof scene$7);try{console.log("About to call cleanupKpRgbLesson with scene:",!!scene$7),cleanupKpRgbLesson(scene$7)}catch(S){console.warn("Error in cleanupKpRgbLesson during lesson3lesson4:",S),console.error("Full error details:",S)}setLesson("lesson4"),console.log("Cleaning up lesson3 components for lesson4 transition (via LessonCleaner)");try{const S=new LessonCleaner(scene$7);S.nonRemovableObjects=["nano","expansionBoard","battery"],S.removeObjects(),window.jstPin=null,window.jstPin2=null,window.jstPin3=null,window.tempSensorModel=null,console.log("Lesson3 components cleaned via LessonCleaner")}catch(S){console.warn("Error cleaning via LessonCleaner:",S)}}else if(y==="lesson4"&&w==="lesson5"){setLesson("lesson5"),lesson4RunCodeClicked=!1,lesson4CodeAnimationCompleted=!1,typeof window<"u"&&(window.lesson4RunCodeClicked=!1,window.lesson4CodeAnimationCompleted=!1),console.log("Cleaning up lesson4 components for lesson5 transition (via LessonCleaner)");try{const S=new LessonCleaner(scene$7);S.nonRemovableObjects=["nano","expansionBoard","battery"],S.removeObjects(),window.jstPin=null,window.jstPin2=null,window.jstPin3=null,window.tempSensorModel=null,console.log("Lesson4 components cleaned via LessonCleaner"),window.batteryModel&&(window.batteryModel.visible=!1,console.log("[DEBUG] Hidden original batteryModel for lesson5 transition")),window.jstPinBattery&&window.jstPinBattery.group&&(window.jstPinBattery.group.visible=!1,console.log("[DEBUG] Hidden original jstPinBattery for lesson5 transition"))}catch(S){console.warn("Error cleaning via LessonCleaner:",S)}}console.log("=== JST Pin States After Cleanup ==="),_(),window.jstPinBattery&&window.jstPinBattery.pinGLTF1&&(window.jstPinBattery.pinGLTF1.rotation.y=-Math.PI/2,typeof window.jstPinBattery.updatePosition=="function"?window.jstPinBattery.updatePosition(new Vector3$1(.8,1.7,-3.2),window.jstPinBattery.pinGLTF1):window.jstPinBattery.pinGLTF1.position&&window.jstPinBattery.pinGLTF1.position.set(.8,1.7,-3.2)),setTimeout(()=>{window.disableNanoSnap=!1},500),console.log("Current lesson state before switch:",{currentLesson:y,nextLesson:w,getCurrentLesson:typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"not available",scene:!!scene$7,runCodeButton:!!runCodeButton}),setLesson(w),cleanupLessonModels(y,w),updateLessonVisibility(w),setTimeout(()=>{try{learningPanel&&learningPanel.visible&&(setLearningLesson(w),console.log(`[Lesson Transition] Updated learning panel to show ${w} content`))}catch(S){console.warn("Failed to update learning panel after lesson transition:",S)}},200),console.log("Lesson state after switch:",{newCurrentLesson:typeof window.getCurrentLesson=="function"?window.getCurrentLesson():"not available",nextLesson:w});try{typeof window.setCodeEditorLesson=="function"&&(window.setCodeEditorLesson(w),console.log(`Code editor updated to show ${w}`))}catch(S){console.warn("Failed to update code editor lesson:",S)}try{runCodeButton&&scene$7&&!scene$7.children.includes(runCodeButton)&&scene$7.add(runCodeButton),runCodeButton&&(runCodeButton.userData.clickable=!0,runCodeButton.traverse(S=>{S.isMesh&&(S.userData.clickable=!0)}),runCodeButton.visible=!1,typeof runCodeButton.update=="function"&&runCodeButton.update())}catch{}try{if(typeof updateCodePlaneWithInstruction=="function"&&typeof getCurrentStepText=="function"){const S=getCurrentStepText();updateCodePlaneWithInstruction(S||"")}}catch{}if(w==="lesson1"){console.log("Setting up lesson1 specific components");try{window.buzzerModel&&(window.buzzerModel.visible=!1,console.log("Double-check: Hidden buzzerModel for lesson1")),window.jstPin2&&window.jstPin2.group&&(window.jstPin2.group.visible=!1,console.log("Double-check: Hidden jstPin2 (lesson2) for lesson1")),window.tempSensorModel&&(window.tempSensorModel.visible=!1,console.log("Double-check: Hidden tempSensorModel for lesson1")),window.jstPin3&&window.jstPin3.group&&(window.jstPin3.group.visible=!1,console.log("Double-check: Hidden jstPin3 group for lesson1")),window.makeSomeNoiseButton&&(window.makeSomeNoiseButton.visible=!1,console.log("Double-check: Hidden makeSomeNoiseButton for lesson1")),window.rgbLEDModel&&(window.rgbLEDModel.visible=!0,console.log("Made rgbLEDModel visible for lesson1")),window.jstPin&&window.jstPin.group&&(scene$7.children.includes(window.jstPin.group)||scene$7.add(window.jstPin.group),window.jstPin.group.visible=!0,console.log("Made jstPin (lesson1) visible for lesson1")),window.showBlinkingButton&&(window.showBlinkingButton.visible=!0,console.log("Made showBlinkingButton visible for lesson1")),console.log("Lesson1 components setup completed with comprehensive cleanup")}catch(S){console.warn("Error setting up lesson1 components:",S)}}else if(w==="lesson2"){try{const S=new Vector3$1(-.5,1.8,-3.14),C=new Vector3$1(-.5,1.8,-3.4);window.batteryModel&&(window.batteryModel.position.copy(S),window.batteryModel.visible=!0),window.jstPinBattery&&window.jstPinBattery.pinGLTF1&&(window.jstPinBattery.pinGLTF1.rotation.y=-Math.PI/2,window.jstPinBattery.config&&Array.isArray(window.jstPinBattery.config.wireConfigs)&&(window.jstPinBattery.config.wireConfigs[0].startPosition=C.clone().add(new Vector3$1(.04,0,.2)),window.jstPinBattery.config.wireConfigs[1].startPosition=C.clone().add(new Vector3$1(0,0,.2))),typeof window.jstPinBattery.updatePosition=="function"?window.jstPinBattery.updatePosition(C,window.jstPinBattery.pinGLTF1):window.jstPinBattery.pinGLTF1.position&&window.jstPinBattery.pinGLTF1.position.copy(C),Array.isArray(window.jstPinBattery.wires)&&window.jstPinBattery.wires.forEach((A,E)=>{var k;try{(k=window.jstPinBattery.config.wireConfigs[E])!=null&&k.startPosition&&A.wireConfig.startPosition.copy(window.jstPinBattery.config.wireConfigs[E].startPosition),A.updateWire(A.wireConfig.endPosition)}catch{}}))}catch{}try{window.rgbLEDModel&&(window.rgbLEDModel.visible=!1,console.log("Double-check: Hidden rgbLEDModel for lesson2")),window.jstPin&&window.jstPin.group&&(window.jstPin.group.visible=!1,console.log("Double-check: Hidden jstPin (lesson1) for lesson2")),window.tempSensorModel&&(window.tempSensorModel.visible=!1,console.log("Double-check: Hidden tempSensorModel for lesson2")),window.jstPin3&&window.jstPin3.group&&(window.jstPin3.group.visible=!1,console.log("Double-check: Hidden jstPin3 group for lesson2")),window.buzzerModel&&(window.buzzerModel.visible=!0,console.log("Made buzzerModel visible for lesson2")),window.jstPin2&&window.jstPin2.group&&scene$7&&(scene$7.children.includes(window.jstPin2.group)||scene$7.add(window.jstPin2.group),window.jstPin2.group.visible=!0,console.log("Made jstPin2 group visible for lesson2")),window.showBlinkingButton&&(window.showBlinkingButton.visible=!1,console.log("Hidden showBlinkingButton for lesson2")),typeof updateNextButtonState=="function"&&(updateNextButtonState(),console.log("Updated next button state for lesson2")),window.raycasterSetup&&typeof window.raycasterSetup.refreshPinModelsRef=="function"&&(window.raycasterSetup.refreshPinModelsRef(),console.log("[Scene6] Refreshed raycaster pin models reference for lesson2"))}catch(S){console.warn("Error setting up lesson2 visuals:",S)}}else if(w==="lesson3"){console.log("Setting up lesson3 specific components"),console.log("=== LESSON3 MODELS OVERVIEW ==="),console.log("All available GLTF models:",Object.keys(allAssets$4.models.gltf)),console.log("--- LESSON3 SPECIFIC MODELS ---"),console.log("tempSensorModel:",{exists:!!window.tempSensorModel,name:window.tempSensorModel?window.tempSensorModel.name:"N/A",inScene:window.tempSensorModel&&scene$7?scene$7.children.includes(window.tempSensorModel):!1,visible:window.tempSensorModel?window.tempSensorModel.visible:!1,position:window.tempSensorModel?window.tempSensorModel.position:"N/A",scale:window.tempSensorModel?window.tempSensorModel.scale:"N/A"}),console.log("jstPin3 (lesson3 JST pin):",{exists:!!window.jstPin3,inScene:window.jstPin3&&window.jstPin3.group&&scene$7?scene$7.children.includes(window.jstPin3.group):!1,visible:window.jstPin3&&window.jstPin3.group?window.jstPin3.group.visible:!1,pin1Exists:!!window.jstPin3Side1,pin2Exists:!!window.jstPin3Side2}),console.log("--- COMMON MODELS USED IN LESSON3 ---"),console.log("nanoModel (Arduino):",{exists:!!window.nanoModel,name:window.nanoModel?window.nanoModel.name:"N/A",inScene:window.nanoModel&&scene$7?scene$7.children.includes(window.nanoModel):!1,visible:window.nanoModel?window.nanoModel.visible:!1,position:window.nanoModel?window.nanoModel.position:"N/A"}),console.log("expansionBoardModel:",{exists:!!window.expansionBoardModel,name:window.expansionBoardModel?window.expansionBoardModel.name:"N/A",inScene:window.expansionBoardModel&&scene$7?scene$7.children.includes(window.expansionBoardModel):!1,visible:window.expansionBoardModel?window.expansionBoardModel.visible:!1,position:window.expansionBoardModel?window.expansionBoardModel.position:"N/A"}),console.log("batteryModel:",{exists:!!window.batteryModel,name:window.batteryModel?window.batteryModel.name:"N/A",inScene:window.batteryModel&&scene$7?scene$7.children.includes(window.batteryModel):!1,visible:window.batteryModel?window.batteryModel.visible:!1,position:window.batteryModel?window.batteryModel.position:"N/A"}),console.log("jstPinBattery:",{exists:!!window.jstPinBattery,inScene:window.jstPinBattery&&window.jstPinBattery.group&&scene$7?scene$7.children.includes(window.jstPinBattery.group):!1,visible:window.jstPinBattery&&window.jstPinBattery.group?window.jstPinBattery.group.visible:!1}),console.log("--- LESSON2 MODELS (SHOULD BE HIDDEN IN LESSON3) ---"),console.log("buzzerModel:",{exists:!!window.buzzerModel,name:window.buzzerModel?window.buzzerModel.name:"N/A",inScene:window.buzzerModel&&scene$7?scene$7.children.includes(window.buzzerModel):!1,visible:window.buzzerModel?window.buzzerModel.visible:!1}),console.log("jstPin2 (lesson2 JST pin):",{exists:!!window.jstPin2,inScene:window.jstPin2&&window.jstPin2.group&&scene$7?scene$7.children.includes(window.jstPin2.group):!1,visible:window.jstPin2&&window.jstPin2.group?window.jstPin2.group.visible:!1}),console.log("--- LESSON1 MODELS (SHOULD BE HIDDEN IN LESSON3) ---"),console.log("rgbLEDModel:",{exists:!!window.rgbLEDModel,name:window.rgbLEDModel?window.rgbLEDModel.name:"N/A",inScene:window.rgbLEDModel&&scene$7?scene$7.children.includes(window.rgbLEDModel):!1,visible:window.rgbLEDModel?window.rgbLEDModel.visible:!1}),console.log("jstPin (lesson1 JST pin):",{exists:!!window.jstPin,inScene:window.jstPin&&window.jstPin.group&&scene$7?scene$7.children.includes(window.jstPin.group):!1,visible:window.jstPin&&window.jstPin.group?window.jstPin.group.visible:!1}),console.log("--- ALL SCENE CHILDREN ---"),scene$7&&scene$7.children&&scene$7.children.forEach((S,C)=>{console.log(`Scene child ${C}:`,{name:S.name||"unnamed",type:S.type,visible:S.visible,isGroup:S.isGroup,childrenCount:S.children?S.children.length:0})}),console.log("=== END LESSON3 MODELS OVERVIEW ===");try{window.tempSensorModel&&(scene$7.children.includes(window.tempSensorModel)||scene$7.add(window.tempSensorModel),window.tempSensorModel.visible=!0,console.log("Made tempSensorModel visible for lesson3")),window.jstPin3&&window.jstPin3.group&&(scene$7.children.includes(window.jstPin3.group)||scene$7.add(window.jstPin3.group),window.jstPin3.group.visible=!1,console.log("[DEBUG] jstPin3 (lesson3) added to scene but kept hidden")),window.rgbLEDModel&&(window.rgbLEDModel.visible=!1,console.log("Double-check: Hidden rgbLEDModel for lesson3")),window.jstPin&&window.jstPin.group&&(window.jstPin.group.visible=!1,console.log("Double-check: Hidden jstPin (lesson1) for lesson3")),window.buzzerModel&&(window.buzzerModel.visible=!1,console.log("Double-check: Hidden buzzerModel for lesson3")),window.jstPin2&&window.jstPin2.group&&(window.jstPin2.group.visible=!1,console.log("Double-check: Hidden jstPin2 (lesson2) for lesson3")),window.makeSomeNoiseButton&&(window.makeSomeNoiseButton.visible=!1,console.log("Double-check: Hidden makeSomeNoiseButton for lesson3")),window.showBlinkingButton&&(window.showBlinkingButton.visible=!1,console.log("Double-check: Hidden showBlinkingButton for lesson3")),window.batteryModel&&(window.batteryModel.visible=!1,console.log("Battery hidden for lesson3")),window.jstPinBattery&&window.jstPinBattery.group&&(window.jstPinBattery.group.visible=!1,console.log("jstPinBattery hidden for lesson3")),console.log("Lesson3 components setup completed with comprehensive cleanup")}catch(S){console.warn("Error setting up lesson3 components:",S)}}else if(w==="lesson4"){console.log("Setting up lesson4 specific components"),lesson4RunCodeClicked=!1,lesson4CodeAnimationCompleted=!1;try{typeof window<"u"&&(window._lesson4_s7Played=!1,window._lesson4_s7Attempted=!1,window._lesson4_s8Played=!1)}catch{}typeof window<"u"&&(window.lesson4RunCodeClicked=!1,window.lesson4CodeAnimationCompleted=!1),KpMotorLesson(scene$7,camera$6)}else w==="lesson5"&&(console.log("Setting up lesson5 specific components"),window.batteryModel&&(window.batteryModel.visible=!1,console.log("[DEBUG] Hidden original batteryModel for lesson5")),window.jstPinBattery&&window.jstPinBattery.group&&(window.jstPinBattery.group.visible=!1,console.log("[DEBUG] Hidden original jstPinBattery for lesson5")),KpIRLesson(scene$7,camera$6));console.log("=== Final JST Pin States After Lesson Setup ==="),_(),typeof hideNextLessonButton=="function"&&hideNextLessonButton(),updateMakeSomeNoiseButtonVisibility()}),controls$7=new OrbitControls(camera$6,renderer$8.domElement),controls$7.enableDamping=!0,controls$7.dampingFactor=.05,controls$7.screenSpacePanning=!1,controls$7.minDistance=.5,controls$7.maxDistance=1.15,controls$7.maxPolarAngle=Math.PI/2,controls$7.minAzimuthAngle=-Math.PI/6,controls$7.maxAzimuthAngle=Math.PI/6,controls$7.target.set(0,2,-3),controls$7.update(),window.orbitControls=controls$7,{scene:scene$7,camera:camera$6,renderer:renderer$8,controls:controls$7}}function cleanupScene6(){stats&&stats.dom.remove(),animationFrameId$6&&(cancelAnimationFrame(animationFrameId$6),animationFrameId$6=null),window._codeEditorRaycastHandler&&(window.removeEventListener("pointerdown",window._codeEditorRaycastHandler),window.removeEventListener("pointermove",window._codeEditorRaycastHandler),window._codeEditorRaycastHandler=null),window._scene6RaycastHandler&&(window.removeEventListener("pointerdown",window._scene6RaycastHandler),window._scene6RaycastHandler=null),typeof handleKeyNavigation<"u"&&handleKeyNavigation&&window.removeEventListener("keydown",handleKeyNavigation),destroyGUI(),cleanupAudioManager(),cleanupVR(),scene$7&&scene$7.traverse(n=>{n.geometry&&n.geometry.dispose(),n.material&&(Array.isArray(n.material)?n.material.forEach(e=>e.dispose()):n.material.dispose())}),scene$7=null,camera$6=null,controls$7=null,typeof skybox<"u"&&(skybox=null),window.nanoModel&&(window.nanoModel=null),window.expansionBoardModel&&(window.expansionBoardModel=null),window.rgbLEDModel&&(window.rgbLEDModel=null),window.secondPin4Female&&(window.secondPin4Female=null),window.currentScene&&(window.currentScene=null),typeof beginBlinkButton<"u"&&beginBlinkButton&&(beginBlinkButton.visible=!1,beginBlinkButton.parent&&beginBlinkButton.parent.remove(beginBlinkButton)),window._beginBlinkRaycastHandler&&(window.removeEventListener("pointerdown",window._beginBlinkRaycastHandler),window._beginBlinkRaycastHandler=null),cleanupShader()}function showContentAfterCameraAnimation(n,e){}function updateLessonVisibility(n){if(console.log(`[DEBUG] updateLessonVisibility called for lesson: ${n}`),window.rgbLEDModel&&(window.rgbLEDModel.visible=n==="lesson1",console.log(`[DEBUG] rgbLEDModel visibility set to: ${n==="lesson1"}`)),window.jstPin&&window.jstPin.group&&(n==="lesson1"?(scene$7&&!scene$7.children.includes(window.jstPin.group)&&scene$7.add(window.jstPin.group),window.jstPin.group.visible=!0,console.log("[DEBUG] jstPin (lesson1) made visible and added to scene")):(window.jstPin.group.visible=!1,console.log("[DEBUG] jstPin (lesson1) hidden"))),window.buzzerModel&&(window.buzzerModel.visible=n==="lesson2",console.log(`[DEBUG] buzzerModel visibility set to: ${n==="lesson2"}`)),window.jstPin2&&window.jstPin2.group&&(n==="lesson2"?(scene$7&&!scene$7.children.includes(window.jstPin2.group)&&scene$7.add(window.jstPin2.group),window.jstPin2.group.visible=!0,console.log("[DEBUG] jstPin2 (lesson2) made visible and added to scene")):(window.jstPin2.group.visible=!1,console.log("[DEBUG] jstPin2 (lesson2) hidden"))),window.makeSomeNoiseButton&&(n==="lesson2"?(scene$7&&!scene$7.children.includes(makeSomeNoiseButton)&&scene$7.add(makeSomeNoiseButton),makeSomeNoiseButton.visible=!1,console.log("[DEBUG] makeSomeNoiseButton prepared (hidden) for lesson2; will show after reveal")):(makeSomeNoiseButton.visible=!1,console.log("[DEBUG] makeSomeNoiseButton hidden for non-lesson2"))),window.tempSensorModel&&(window.tempSensorModel.visible=n==="lesson3",console.log(`[DEBUG] tempSensorModel visibility set to: ${n==="lesson3"}`)),window.jstPin3&&window.jstPin3.group&&(n==="lesson3"?(scene$7&&!scene$7.children.includes(window.jstPin3.group)&&scene$7.add(window.jstPin3.group),window.jstPin3.group.visible=!0,console.log("[DEBUG] jstPin3 (lesson3) made visible and added to scene")):(window.jstPin3.group.visible=!1,console.log("[DEBUG] jstPin3 (lesson3) hidden"))),window.runCodeButton&&(n==="lesson3"?(window.runCodeButton.visible=!1,console.log("[DEBUG] Start Coding button hidden initially for lesson3 (will show after battery connection)")):n==="lesson2"?(window.runCodeButton.visible=!1,console.log("[DEBUG] Start Coding button hidden initially for lesson2 (will show after power connection)")):(window.runCodeButton.visible=!1,console.log(`[DEBUG] Start Coding button hidden for lesson: ${n}`))),window.batteryModel){const e=n!=="lesson3"&&n!=="lesson5";window.batteryModel.visible=e,console.log(`[DEBUG] batteryModel visibility set to: ${e} (hidden in lesson3/lesson5)`)}if(window.jstPinBattery&&window.jstPinBattery.group){const e=n!=="lesson3"&&n!=="lesson4"&&n!=="lesson5";window.jstPinBattery.group.visible=e,console.log(`[DEBUG] jstPinBattery visibility set to: ${e} (hidden in lesson3/lesson4/lesson5)`)}window.nanoModel&&(window.nanoModel.visible=!0,console.log("[DEBUG] nanoModel kept visible for all lessons")),window.expansionBoardModel&&(window.expansionBoardModel.visible=!0,console.log("[DEBUG] expansionBoardModel kept visible for all lessons")),window.showBlinkingButton&&(window.showBlinkingButton.visible=n==="lesson1",console.log(`[DEBUG] showBlinkingButton visibility set to: ${n==="lesson1"}`)),console.log(`[DEBUG] === Final Model Visibility State for ${n} ===`),console.log(`[DEBUG] rgbLEDModel (lesson1): ${window.rgbLEDModel?window.rgbLEDModel.visible:"N/A"}`),console.log(`[DEBUG] jstPin (lesson1): ${window.jstPin&&window.jstPin.group?window.jstPin.group.visible:"N/A"}`),console.log(`[DEBUG] buzzerModel (lesson2): ${window.buzzerModel?window.buzzerModel.visible:"N/A"}`),console.log(`[DEBUG] jstPin2 (lesson2): ${window.jstPin2&&window.jstPin2.group?window.jstPin2.group.visible:"N/A"}`),console.log(`[DEBUG] tempSensorModel (lesson3): ${window.tempSensorModel?window.tempSensorModel.visible:"N/A"}`),console.log(`[DEBUG] jstPin3 (lesson3): ${window.jstPin3&&window.jstPin3.group?window.jstPin3.group.visible:"N/A"}`),console.log("[DEBUG] ==========================================")}if(typeof window.setLesson=="function"){const n=window.setLesson;window.setLesson=function(e){n(e),updateLessonVisibility(e),setupLessonModels(scene$7,e)}}setLesson("lesson1");updateLessonVisibility("lesson1");function updateMakeSomeNoiseButtonVisibility(){scene$7.children.includes(makeSomeNoiseButton)||scene$7.add(makeSomeNoiseButton),makeSomeNoiseButton.visible=!1}window._makeSomeNoiseRaycastHandler||(window._makeSomeNoiseRaycastHandler=n=>{if(!makeSomeNoiseButton.visible||!camera$6)return;const e=new Vector2$1(n.clientX/window.innerWidth*2-1,-(n.clientY/window.innerHeight)*2+1),t=new Raycaster;if(t.setFromCamera(e,camera$6),t.intersectObjects([makeSomeNoiseButton],!0).length>0){try{typeof window.getCurrentLesson=="function"&&window.getCurrentLesson()==="lesson2"&&applyStepShader("lesson2",1)}catch(a){console.warn("[Lesson2] Failed to apply shader on Make Some Noise click:",a)}new Vector3$1(0,2,-3);const i=camera$6.quaternion.clone(),s=camera$6.quaternion.clone();camera$6.quaternion.copy(i);const r={t:0};gsapWithCSS.to(r,{t:1,duration:2,ease:"power2.inOut",onUpdate:()=>{camera$6.quaternion.copy(i).slerp(s,r.t)},onComplete:()=>{camera$6.quaternion.copy(s)}}),makeSomeNoiseButton.visible=!1}},window.addEventListener("pointerdown",window._makeSomeNoiseRaycastHandler));function cleanupLessonModels(n,e){var o,i,s,r,a,l;console.log(`[DEBUG] cleanupLessonModels called: ${n} -> ${e}`),[{model:window.rgbLEDModel,name:"rgbLEDModel",lesson:"lesson1"},{model:(o=window.jstPin)==null?void 0:o.group,name:"jstPin (lesson1)",lesson:"lesson1"},{model:window.buzzerModel,name:"buzzerModel",lesson:"lesson2"},{model:(i=window.jstPin2)==null?void 0:i.group,name:"jstPin2 (lesson2)",lesson:"lesson2"},{model:window.tempSensorModel,name:"tempSensorModel",lesson:"lesson3"},{model:(s=window.jstPin3)==null?void 0:s.group,name:"jstPin3 (lesson3)",lesson:"lesson3"},{model:window.makeSomeNoiseButton,name:"makeSomeNoiseButton",lesson:"lesson2"},{model:window.showBlinkingButton,name:"showBlinkingButton",lesson:"lesson1"}].forEach(({model:c,name:d,lesson:u})=>{c&&(c.visible=!1,console.log(`[DEBUG] Hidden ${d} (${u}) during transition`))}),e==="lesson1"?(window.rgbLEDModel&&(window.rgbLEDModel.visible=!0),(r=window.jstPin)!=null&&r.group&&(window.jstPin.group.visible=!0),window.showBlinkingButton&&(window.showBlinkingButton.visible=!0),console.log("[DEBUG] Made lesson1 models visible")):e==="lesson2"?(window.buzzerModel&&(window.buzzerModel.visible=!0),(a=window.jstPin2)!=null&&a.group&&(window.jstPin2.group.visible=!0),window.makeSomeNoiseButton&&(window.makeSomeNoiseButton.visible=!1),console.log("[DEBUG] Made lesson2 models visible (Make Some Noise button stays hidden until reveal ends)")):e==="lesson3"?(window.tempSensorModel&&(window.tempSensorModel.visible=!0),console.log("[DEBUG] Made lesson3 models visible (jstPin3 kept hidden)")):e==="lesson4"?console.log("[DEBUG] Lesson4 will use the original battery model (handled by KpMotorLesson)"):e==="lesson5"&&(window.batteryModel&&(window.batteryModel.visible=!1),(l=window.jstPinBattery)!=null&&l.group&&(window.jstPinBattery.group.visible=!1),console.log("[DEBUG] Hidden original battery and JST pin for lesson5 (lesson5 uses its own battery setup)")),console.log(`[DEBUG] cleanupLessonModels completed for ${e}`)}let hoverPointerMoveHandler=null,meshPointerDownHandler=null,loadingHiddenHandler$1=null,skybox$2,scene$6,renderer$7,controls$6,hudVideoPlane$1=null,resizeHandler$5=null,sceneInitialization$5,collisionMesh$4,animationFrameId$5=null,camera$5=null,isSceneTransitioning$5=!1;const COMPONENT_KEYS=["unoModel","nanoModel","ldrModel","irModel","buck","motordriverModel","buttonModel","buzzerModel","pcbModel","rgbModel","motorModel"];let componentModels={};COMPONENT_KEYS.forEach(n=>{componentModels[n]={model:null,orbitControls:null,outline:null,originalPosition:null,originalRotation:null,originalScale:null,isNearCamera:!1,isAnimating:!1,animationDirection:null,animationStartTime:0,targetPosition:null,targetRotation:null,meshes:[],hoveredMesh:null,hoveredOutlineMesh:null,selectedMesh:null}});let focusedComponentKey=null,meshUIPanel=null,glassPlane=null,backgroundAudio$2;const COMPONENT_ANIMATION_DURATION=2,nanoMeshInfo={Body4004:{heading:"Microcontroller",description:'It is the "brain" of the board. This IC executes your code and handles input/output operations.'},Body4001:{heading:"Mini USB Port",description:"Used to connect the Nano to a computer for programming and serial communication. Also supplies 5V power"},Body4007:{heading:"Reset Button",description:"Restarts the microcontroller. Useful for restarting programs or entering bootloader mode."},Body4010:{heading:"Power Pins",description:"Used to power the board or provide power to external modules/sensors."},Body4005:{heading:"Bootloader / ICSP Header",description:"These pins allow direct programming of the microcontroller using an external programmer."},Body4008:{heading:"Crystal Oscillator (16 MHz)",description:"Provides clock signals for the microcontroller, allowing it to run at a stable speed."},Body4006:{heading:"LED",description:"Provides clock signals for the microcontroller, allowing it to run at a stable speed."}},buckMeshInfo={UBEC_2_v1001:{heading:"Microcontroller",description:'It is the "brain" of the board. This IC executes your code and handles input/output operations.'},UBEC_2_v1004:{heading:"Mini USB Port",description:"Used to connect the buck to a computer for programming and serial communication. Also supplies 5V power"},UBEC_2_v1003:{heading:"Reset Button",description:"Restarts the microcontroller. Useful for restarting programs or entering bootloader mode."},UBEC_2_v1006:{heading:"Power Pins",description:"Used to power the board or provide power to external modules/sensors."},UBEC_2_v1007:{heading:"Bootloader / ICSP Header",description:"These pins allow direct programming of the microcontroller using an external programmer."},UBEC_2_v1008:{heading:"Crystal Oscillator (16 MHz)",description:"Provides clock signals for the microcontroller, allowing it to run at a stable speed."},UBEC_2_v1005:{heading:"LED",description:"Provides clock signals for the microcontroller, allowing it to run at a stable speed."}},motordriverMeshInfo={"2pinheader1":{heading:"Microcontroller",description:'It is the "brain" of the board. This IC executes your code and handles input/output operations.'},COMPOUND151:{heading:"Mini USB Port",description:"Used to connect the motordriver to a computer for programming and serial communication. Also supplies 5V power"},"2pinheader1001":{heading:"Reset Button",description:"Restarts the microcontroller. Useful for restarting programs or entering bootloader mode."},COMPOUND183:{heading:"Power Pins",description:"Used to power the board or provide power to external modules/sensors."},COMPOUND182:{heading:"Bootloader / ICSP Header",description:"These pins allow direct programming of the microcontroller using an external programmer."},COMPOUND181:{heading:"Crystal Oscillator (16 MHz)",description:"Provides clock signals for the microcontroller, allowing it to run at a stable speed."},COMPOUND180:{heading:"LED",description:"Provides clock signals for the microcontroller, allowing it to run at a stable speed."},jstpin:{heading:"LED",description:"Provides clock signals for the microcontroller, allowing it to run at a stable speed."}},buttonMeshInfo={BUTTON_BEINCHEN_004:{heading:"Microcontroller",description:'It is the "brain" of the board. This IC executes your code and handles input/output operations.'},"JST_XH_B3B-XH-A_1x03_P250mm_Vertical003":{heading:"Mini USB Port",description:"Used to connect the button to a computer for programming and serial communication. Also supplies 5V power"},R_0805_2012Metric002001:{heading:"Reset Button",description:"Restarts the microcontroller. Useful for restarting programs or entering bootloader mode."}},pcbMeshInfo={jstpin1:{heading:"Microcontroller",description:'It is the "brain" of the board. This IC executes your code and handles input/output operations.'},jstpin2:{heading:"Mini USB Port",description:"Used to connect the pcb to a computer for programming and serial communication. Also supplies 5V power"},jstpin3:{heading:"Reset Button",description:"Restarts the microcontroller. Useful for restarting programs or entering bootloader mode."},jstpin4:{heading:"Reset Button",description:"Restarts the microcontroller. Useful for restarting programs or entering bootloader mode."},jstpin5:{heading:"Reset Button",description:"Restarts the microcontroller. Useful for restarting programs or entering bootloader mode."}},motorMeshInfo={gear1:{heading:"Gears",description:"Used different dimension gears to regulate the torque of the motor."},gear2:{heading:"Mini USB Port",description:"Used to connect the gear to a computer for programming and serial communication. Also supplies 5V power"},gear3:{heading:"Mini USB Port",description:"Used to connect the gear to a computer for programming and serial communication. Also supplies 5V power"}},rgbMeshInfo={123:{heading:"Microcontroller",description:'It is the "brain" of the board. This IC executes your code and handles input/output operations.'},143:{heading:"RGB",description:"It shows different colors according to the input voltage."}},buzzerMeshInfo={buzzerModel:{heading:"Buzzer",description:"Modulates sound according the input voltage."},jstpin:{heading:"JSTXH male pin",description:"Used to connect the buzzer to  Arduino for programming and serial communication. Also supplies power"}},irMeshInfo={mesh_1:{heading:"JST Female Connector",description:"Used for connecting power and signal lines. It has 3 pins."},mesh_2:{heading:"TSOP IR Receiver",description:"Receives modulated IR signals (typically 38kHz), used for remote control detection or proximity sensing."},mesh_3:{heading:"SMD Capacitor",description:"Filters noise on power lines to TSOP sensor."},mesh_4:{heading:"SMD Resistors",description:"Used for limiting current or pull-up/down configuration for TSOP."}},unoMeshInfo={jst_2pin1:{heading:"JST Female 2-Pin",description:"Connect power or single signal modules securely."},jst_4pin1:{heading:"JST Female 4-Pin",description:"Used for I2C sensors, displays, and communication modules. Provides secure and polarized connection."},jst_4pin:{heading:"JST Female 4-Pin",description:"Used for I2C sensors, displays, and communication modules. Provides secure and polarized connection."},jst_2pin:{heading:"Pin Female Header",description:"Used to receive male pins from jumper wires or modules."},resistors:{heading:"Resistors",description:"Limits current flow to protect components. Used for limiting current or pull-up/down configuration."},jst_malepin1:{heading:"Pin Male Header",description:"Provides exposed pins to connect with female headers or breadboards."}},ldrMeshInfo={ldr_3pinfemale:{heading:"JST Female 3-Pin",description:"Used to connect the module to Arduino. Carries VCC, GND, and OUT (analog or digital)"},ldr:{heading:"LDR",description:"Detects ambient light intensity. Resistance decreases with increasing light."},resistor1_1:{heading:"Resistors",description:"Forms a voltage divider with the LDR. Converts resistance change to voltage change"}};function addGlassPlaneBehindUno(){var n;if(glassPlane){if((n=componentModels[focusedComponentKey])!=null&&n.targetPosition&&camera$5){const e=camera$5.getWorldDirection(new Vector3$1);glassPlane.position.copy(componentModels[focusedComponentKey].targetPosition.clone().sub(e.clone().multiplyScalar(1.2))),glassPlane.lookAt(camera$5.position)}glassPlane.visible=!0}}function removeGlassPlane(){glassPlane&&(glassPlane.visible=!1)}function handleKeyPress$4(n){n.key.toLowerCase()==="y"&&!isSceneTransitioning$5&&transitionToScene6()}function transitionToScene6(){var t;if(isSceneTransitioning$5)return;isSceneTransitioning$5=!0;const n=(t=renderer$7==null?void 0:renderer$7.xr)!=null&&t.getSession?renderer$7.xr.getSession():null,e=o=>{try{markSceneCompleted$3("scene5")}catch{}if(window.removeEventListener("keydown",handleKeyPress$4),sceneInitialization$5)try{sceneInitialization$5.cleanUpCollider()}catch{}cleanupScene5(),checkExistingAssets(assetsEntry$3),initializeScene6(renderer$7,o).finally(()=>{isSceneTransitioning$5=!1})};n&&typeof n.end=="function"?n.end().then(()=>e(!0)).catch(o=>{console.error("Error ending VR session:",o),e(!0)}):e(!1)}function animateComponentToCamera(n){scene$6.background=new Color(1812);const e=componentModels[n];if(!e.model||e.isAnimating)return;e.isAnimating=!0,e.animationStartTime=performance.now(),e.animationDuration=COMPONENT_ANIMATION_DURATION,e.animationDirection="toCamera",e.originalPosition||(e.originalPosition=e.model.position.clone(),e.originalRotation=e.model.rotation.clone(),e.originalScale=e.model.scale.clone());const t=camera$5.getWorldDirection(new Vector3$1),o=camera$5.getWorldPosition(new Vector3$1),s=new Vector3$1(-1,0,0).applyQuaternion(camera$5.quaternion).normalize().multiplyScalar(.4);e.targetPosition=o.clone().add(t.multiplyScalar(.9)).add(s),e.targetRotation=new Euler$1(e.originalRotation.x,e.originalRotation.y-Math.PI,e.originalRotation.z),e.outline&&(e.outline.visible=!1),controls$6&&(controls$6.enabled=!1),e.orbitControls.enabled=!0;const r=document.getElementById("closeUnoButton");r&&(r.style.display="block"),focusedComponentKey=n,COMPONENT_KEYS.forEach(a=>{a!==n&&componentModels[a].isNearCamera&&animateComponentToOriginal(a)}),setTimeout(()=>{const a=componentModels[n];a.meshes&&a.meshes.length>0&&showMeshUIPanel(a.meshes[0])},1e3)}function animateComponentToOriginal(n){const e=componentModels[n];if(!e.model||e.isAnimating||!e.originalPosition)return;e.isAnimating=!0,e.animationStartTime=performance.now(),e.animationDuration=COMPONENT_ANIMATION_DURATION,e.animationDirection="toOriginal",e.outline&&(e.outline.visible=!0),e.orbitControls.enabled=!1,controls$6&&!window.isComponentIntroSequencePlaying&&(controls$6.enabled=!0);const t=document.getElementById("closeUnoButton");t&&(t.style.display="none"),focusedComponentKey=null,scene$6.background=null}function handleComponentClick(n){window.isComponentIntroSequencePlaying||componentModels[n].isNearCamera||(animateComponentToCamera(n),setTimeout(()=>{const e=componentModels[n];e.meshes&&e.meshes.length>0&&showMeshUIPanel(e.meshes[0])},1e3))}function createComponentOutline(n){const e=componentModels[n];e.model&&e.model.traverse(t=>{if(t.isMesh){const o=t.geometry.clone(),i=1.01,s=o.attributes.position;for(let l=0;l<s.count;l++)s.setXYZ(l,s.getX(l)*i,s.getY(l)*i,s.getZ(l)*i);s.needsUpdate=!0;const r=new ShaderMaterial({uniforms:{time:{value:0},glowColor:{value:new Color(65535)},glowIntensity:{value:1.5},glowPower:{value:2},glowSpeed:{value:2}},vertexShader:holographicGlobeShader.vertexShader,fragmentShader:holographicGlobeShader.fragmentShader,transparent:!0,side:BackSide,blending:AdditiveBlending}),a=new Mesh(o,r);a.position.copy(t.position),a.rotation.copy(t.rotation),a.scale.copy(t.scale),e.model.add(a),e.outline||(e.outline=a)}})}function createCloseButton(){const n=document.createElement("div");return n.id="closeUnoButton",n.innerHTML="",n.style.cssText=`
    position: fixed;
    top: 20px;
    right: 20px;
    width: 40px;
    height: 40px;
    background: rgba(255, 0, 0, 0.8);
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
    display: none;
    z-index: 1000;
    text-align: center;
    line-height: 40px;
    transition: background 0.3s ease;
  `,n.addEventListener("mouseenter",()=>{n.style.background="rgba(255, 0, 0, 1)"}),n.addEventListener("mouseleave",()=>{n.style.background="rgba(255, 0, 0, 0.8)"}),n.addEventListener("click",()=>{window.isComponentIntroSequencePlaying||(scene$6.background=null,focusedComponentKey&&(animateComponentToOriginal(focusedComponentKey),hideMeshUIPanel(),removeGlassPlane()))}),document.body.appendChild(n),n}function createPanel(n){var o,i,s,r,a,l,c,d,u,f,h,m,p,v,g,y,w,_,S,C,A,E;meshUIPanel=new __webpack_exports__default.Block({width:.9,height:.7,padding:.05,fontFamily:"/fonts/msdf/Roboto-msdf.json",fontTexture:"/fonts/msdf/Roboto-msdf.png",backgroundColor:new Color(0),backgroundOpacity:.02,borderRadius:.02,borderWidth:.001,borderColor:new Color(65535),borderOpacity:.95,fontColor:new Color(16777215)});let e=null,t="";if(focusedComponentKey==="nano"&&n&&n.name&&nanoMeshInfo[n.name]?(e=nanoMeshInfo[n.name],t="Arduino Nano"):focusedComponentKey==="ir"&&n&&n.name&&irMeshInfo[n.name]?(e=irMeshInfo[n.name],t="TSOP IR"):focusedComponentKey==="unoModel"&&n&&n.name&&unoMeshInfo[n.name]?(e=unoMeshInfo[n.name],t="Expansion board"):focusedComponentKey==="ldrModel"&&n&&n.name&&ldrMeshInfo[n.name]?(e=ldrMeshInfo[n.name],t="LDR Module"):focusedComponentKey==="buck"&&n&&((o=n.parent)!=null&&o.name)&&buckMeshInfo[(i=n.parent)==null?void 0:i.name]?(e=buckMeshInfo[(s=n.parent)==null?void 0:s.name],t="Buck Convertor"):focusedComponentKey==="motordriverModel"&&n&&((r=n.parent)!=null&&r.name)&&motordriverMeshInfo[(a=n.parent)==null?void 0:a.name]?(e=motordriverMeshInfo[(l=n.parent)==null?void 0:l.name],t="Motor Driver"):focusedComponentKey==="buttonModel"&&n&&((c=n.parent)!=null&&c.name)&&buttonMeshInfo[(d=n.parent)==null?void 0:d.name]?(e=buttonMeshInfo[(u=n.parent)==null?void 0:u.name],t="Button"):focusedComponentKey==="buzzerModel"&&n&&((f=n.parent)!=null&&f.name)&&buzzerMeshInfo[(h=n.parent)==null?void 0:h.name]?(e=buzzerMeshInfo[(m=n.parent)==null?void 0:m.name],t="Buzzer"):focusedComponentKey==="pcbModel"&&n&&((p=n.parent)!=null&&p.name)&&pcbMeshInfo[(v=n.parent)==null?void 0:v.name]?(e=pcbMeshInfo[(g=n.parent)==null?void 0:g.name],t="PCB"):focusedComponentKey==="rgbModel"&&n&&((y=n.parent)!=null&&y.name)&&rgbMeshInfo[(w=n.parent)==null?void 0:w.name]?(e=rgbMeshInfo[(_=n.parent)==null?void 0:_.name],t="RGB"):focusedComponentKey==="motorModel"&&n&&((S=n.parent)!=null&&S.name)&&motorMeshInfo[(C=n.parent)==null?void 0:C.name]&&(e=motorMeshInfo[(A=n.parent)==null?void 0:A.name],t="motor"),e){const k=new __webpack_exports__default.Block({width:.85,height:.15,backgroundColor:new Color(41727),backgroundOpacity:.1,margin:.02,padding:.02,justifyContent:"center",alignItems:"center",borderWidth:.006,borderColor:new Color(65535),borderOpacity:.9,borderRadius:.02});k.add(new __webpack_exports__default.Text({content:t,fontSize:.06,fontColor:new Color(65535),fontOpacity:.9})),meshUIPanel.add(k);const I=new __webpack_exports__default.Block({width:.65,height:.12,margin:.02,padding:.025,borderWidth:.001,backgroundColor:new Color(6707),backgroundOpacity:15e-5,justifyContent:"start",borderRadius:.02});I.add(new __webpack_exports__default.Text({content:e.heading,fontSize:.045,fontColor:new Color(65535),fontOpacity:.95})),meshUIPanel.add(I);const F=new __webpack_exports__default.Block({width:.85,height:.25,margin:.02,padding:.03,backgroundColor:new Color(0),backgroundOpacity:.2,justifyContent:"start",borderOpacity:0});if(F.add(new __webpack_exports__default.Text({content:e.description,fontSize:.04,fontColor:new Color(16777215),fontOpacity:.85})),meshUIPanel.add(F),scene$6.add(meshUIPanel),(E=componentModels[focusedComponentKey])!=null&&E.model&&camera$5){const M=new Box3().setFromObject(componentModels[focusedComponentKey].model),R=M.getCenter(new Vector3$1),O=M.getSize(new Vector3$1);meshUIPanel.position.copy(R).add(new Vector3$1(-O.x*1.2,.1,0)),meshUIPanel.lookAt(camera$5.position)}}}function showMeshUIPanel(n){meshUIPanel&&scene$6.children.includes(meshUIPanel)&&(scene$6.remove(meshUIPanel),meshUIPanel=null),createPanel(n),window.vrClickableObjects&&meshUIPanel&&(meshUIPanel.userData={...meshUIPanel.userData,isMeshUIPanel:!0,onClick:()=>{console.log("VR Controller clicked on mesh UI panel")}},window.vrClickableObjects.push(meshUIPanel))}function hideMeshUIPanel(){if(meshUIPanel){if(window.vrClickableObjects){const n=window.vrClickableObjects.indexOf(meshUIPanel);n>-1&&window.vrClickableObjects.splice(n,1)}scene$6.remove(meshUIPanel),meshUIPanel=null}}function showFPPOverlay(){let n=document.getElementById("fpp-overlay-container");n&&n.remove();const e=document.createElement("div");e.id="fpp-overlay-container",e.style.position="fixed",e.style.bottom="20px",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.zIndex="99999",e.style.fontFamily="'Orbitron', 'Segoe UI', Arial, sans-serif",e.style.display="flex",e.style.flexDirection="column",e.style.alignItems="center",e.style.gap="10px",e.style.padding="18px 28px 14px 28px",e.style.borderRadius="18px",e.style.background="rgba(20, 30, 40, 0.55)",e.style.boxShadow="0 4px 32px 0 rgba(0, 255, 255, 0.18)",e.style.border="1.5px solid rgba(0, 255, 255, 0.18)",e.style.backdropFilter="blur(14px) saturate(1.2)",e.style.transition="opacity 1s cubic-bezier(.4,0,.2,1)",e.style.opacity="0",e.style.pointerEvents="none";const t=document.createElement("div");t.textContent="You are now Entering first person perspective",t.style.color="#00f6ff",t.style.fontSize="18px",t.style.fontWeight="bold",t.style.textShadow="0 0 8px #00f6ff88",t.style.letterSpacing="1.5px",t.style.marginBottom="2px",e.appendChild(t);const o=document.createElement("div");o.style.display="flex",o.style.flexDirection="row",o.style.alignItems="center",o.style.gap="18px";const i=document.createElement("div");i.style.display="flex",i.style.flexDirection="column",i.style.alignItems="center",i.style.gap="2px";const s=document.createElement("div");s.style.display="flex",s.style.flexDirection="column",s.style.alignItems="center",s.style.gap="1px";const r=document.createElement("div");r.style.display="flex",r.style.justifyContent="center",r.style.width="100%";const a=_("W"),l=_("");r.appendChild(a),r.appendChild(l),s.appendChild(r);const c=document.createElement("div");c.style.display="flex",c.style.justifyContent="center",c.style.width="100%",c.style.gap="1px";const d=_("A"),u=_(""),f=_("S"),h=_(""),m=_("D"),p=_("");c.appendChild(d),c.appendChild(u),c.appendChild(f),c.appendChild(h),c.appendChild(m),c.appendChild(p),s.appendChild(c);const v=document.createElement("div");v.textContent="MOVE",v.style.color="#00f6ff",v.style.fontSize="12px",v.style.marginTop="1px",v.style.textShadow="0 0 4px #00f6ff88",v.style.letterSpacing="0.5px",i.appendChild(s),i.appendChild(v);const g=document.createElement("div");g.style.display="flex",g.style.flexDirection="column",g.style.alignItems="center",g.style.gap="1px";const y=_("SHIFT");y.style.width="54px",y.style.fontSize="15px";const w=document.createElement("div");w.textContent="RUN",w.style.color="#00f6ff",w.style.fontSize="12px",w.style.marginTop="1px",w.style.textShadow="0 0 4px #00f6ff88",w.style.letterSpacing="0.5px",g.appendChild(y),g.appendChild(w),o.appendChild(i),o.appendChild(g),e.appendChild(o);function _(S){const C=document.createElement("span");return C.textContent=S,C.style.display="inline-block",C.style.minWidth="22px",C.style.height="22px",C.style.lineHeight="22px",C.style.background="rgba(0,255,255,0.10)",C.style.color="#00f6ff",C.style.fontWeight="bold",C.style.fontSize="15px",C.style.textAlign="center",C.style.borderRadius="5px",C.style.margin="0 1px",C.style.border="1px solid #00f6ff33",C.style.boxShadow="0 0 4px #00f6ff22",C.style.textShadow="0 0 4px #00f6ff",C.style.userSelect="none",C}document.body.appendChild(e),setTimeout(()=>{e.style.opacity="1"},50),setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},1e3)},6e3)}async function initializeScene5(n,e){setCurrentScene("scene5");const t=getUserInfo();animationFrameId$5=null,animationFrameId$5&&(cancelAnimationFrame(animationFrameId$5),animationFrameId$5=null);let o,i,s;if(window._scene5Video=o,window._scene5VideoTexture=i,window._scene5Material=s,camera$5=new PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,2e3),renderer$7=n,renderer$7.shadowMap.enabled=!0,renderer$7.shadowMap.type=PCFSoftShadowMap,renderer$7.shadowMap.autoUpdate=!0,renderer$7.physicallyCorrectLights=!0,renderer$7.toneMapping=CineonToneMapping,renderer$7.toneMappingExposure=.4,renderer$7.outputColorSpace=SRGBColorSpace,renderer$7.domElement.parentElement||document.body.appendChild(renderer$7.domElement),console.log(renderer$7),await loadAllAsset(assetsEntry$4,camera$5,renderer$7),scene$6=new Scene,scene$6.add(camera$5),initializeAudioManager(camera$5,scene$6),s=new ShaderMaterial({uniforms:{videoTexture:{value:i},time:{value:0}},vertexShader:`
      varying vec2 vUv;
      void main() {
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
      }
    `,fragmentShader:`
      uniform sampler2D videoTexture;
      uniform float time;
      varying vec2 vUv;
      void main() {
        vec4 videoColor = texture2D(videoTexture, vUv);
        float intensity = (videoColor.r + videoColor.g + videoColor.b) / 3.0;
        vec3 enhancedColor = videoColor.rgb * 0.5;
        enhancedColor = clamp(enhancedColor, 0.0, 0.5);
        float alpha = smoothstep(0.15 - 0.05, 0.15 + 0.05, intensity);
        gl_FragColor = vec4(enhancedColor, alpha * videoColor.a);
      }
    `,transparent:!0,side:DoubleSide,blending:AdditiveBlending,depthWrite:!1}),allAssets$4.videotextures&&allAssets$4.videotextures.hudvideo2){o=document.createElement("video"),o.src=allAssets$4.videotextures.hudvideo2.path,o.loop=!0,o.muted=!1,o.playsInline=!0,o.crossOrigin="anonymous",o.autoplay=!1,o.preload="auto",o.style.display="none",document.body.appendChild(o),i=new VideoTexture(o),i.minFilter=LinearFilter,i.magFilter=LinearFilter,i.format=RGBAFormat,i.generateMipmaps=!1;const k=new PlaneGeometry(2,2);s=new ShaderMaterial({uniforms:{videoTexture:{value:i},time:{value:0}},vertexShader:`
        varying vec2 vUv;

        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:`
        uniform sampler2D videoTexture;
        uniform float time;
        varying vec2 vUv;
        void main() {
          vec4 videoColor = texture2D(videoTexture, vUv);
          float intensity = (videoColor.r + videoColor.g + videoColor.b) / 3.0;
          vec3 enhancedColor = videoColor.rgb * 0.5;
          enhancedColor = clamp(enhancedColor, 0.0, 0.5);
          float alpha = smoothstep(0.15 - 0.05, 0.15 + 0.05, intensity);
          gl_FragColor = vec4(enhancedColor, alpha * videoColor.a);
        }
      `,transparent:!0,side:DoubleSide,blending:AdditiveBlending,depthWrite:!1}),hudVideoPlane$1=new Mesh(k,s),hudVideoPlane$1.position.set(-30,1.5,-5.5),hudVideoPlane$1.rotation.set(0,0,0),hudVideoPlane$1.renderOrder=10,hudVideoPlane$1.visible=!1,scene$6.add(hudVideoPlane$1),window.hudVideoPlane=hudVideoPlane$1,window.hudVideoElement=o;const I=()=>{hudVideoPlane$1&&scene$6&&(scene$6.remove(hudVideoPlane$1),hudVideoPlane$1.geometry.dispose(),hudVideoPlane$1.material.map&&hudVideoPlane$1.material.map.dispose(),hudVideoPlane$1.material.dispose(),hudVideoPlane$1=null),o.parentNode&&o.parentNode.removeChild(o),window.hudVideoPlane=null,window.hudVideoElement=null,o.removeEventListener("ended",I)};o.addEventListener("ended",I)}loadingHiddenHandler$1=()=>{console.log("Loading screen hidden - Scene5 is ready!"),allAssets$4.audios.background&&(backgroundAudio$2=allAssets$4.audios.background,backgroundAudio$2.play())},window.addEventListener("loadingScreenHidden-scene5",loadingHiddenHandler$1);const r={height:100,radius:1200,enabled:!0};skybox$2=new GroundedSkybox(allAssets$4.hdris.sky,r.height,r.radius),skybox$2.position.y=0,scene$6.add(skybox$2),scene$6.environment=allAssets$4.hdris.sky,scene$6.environmentIntensity=.6,renderer$7.render(scene$6,camera$5),controls$6=new OrbitControls(camera$5,renderer$7.domElement),controls$6.dampingFactor=.25,controls$6.enableDamping=!0,controls$6.maxPolarAngle=Math.PI/2,controls$6.enablePan=!1,controls$6.screenSpacePanning=!1,controls$6.rotateSpeed=.5,controls$6.zoomSpeed=.5,window.addEventListener("keydown",handleKeyPress$4),sceneInitialization$5=initializePhysicsAndPlayer(allAssets$4.models.gltf.underground,{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}},[],scene$6,camera$5,controls$6),hidePlayerModel(),allAssets$4.models.gltf.underground;let a=new AmbientLight(16777215,.58);scene$6.add(a);const l=new Clock;window._scene5Clock=l,COMPONENT_KEYS.forEach((k,I)=>{const F=allAssets$4.models.gltf[k];if(F){const R={unoModel:[-32,1.1,6.8],nanoModel:[-33,1.2,6.8],ldrModel:[-34,1.2,6.8],irModel:[-34.7,1.2,6.8],buck:[-31.2,1.13,6.8],motordriverModel:[-31.2,1.13,5.9],buttonModel:[-32,1.13,5.9],buzzerModel:[-32.6,1.13,5.9],pcbModel:[-33.3,1.13,5.9],rgbModel:[-34,1.13,5.9],motorModel:[-34.7,1.13,5.9]}[k]||[-32+I*2,1.1,7];F.position.set(...R),F.scale.set(.004,.004,.004),F.rotation.set(0,0,0),scene$6.add(F),componentModels[k].model=F,componentModels[k].meshes=[],F.traverse(O=>{O.isMesh&&(k!=="nano"||!0)&&componentModels[k].meshes.push(O),O.isMesh&&O.material&&(Array.isArray(O.material)?O.material.forEach($=>{$.transparent=!0,$.depthWrite=!0,$.depthTest=!0,$.alphaToCoverage=!0,$.premultipliedAlpha=!0,$.side=DoubleSide}):(O.material.transparent=!0,O.material.depthWrite=!0,O.material.depthTest=!0,O.material.alphaToCoverage=!0,O.material.premultipliedAlpha=!0,O.material.side=DoubleSide)),O.isMesh&&(O.frustumCulled=!0)}),k==="nano"&&(console.log("[DEBUG] Nano model mesh names:"),F.traverse(O=>{O.isMesh&&console.log("  -",O.name)})),k==="buck"&&(console.log("[DEBUG] buck model mesh names and their parents:"),F.traverse(O=>{var $;O.isMesh&&console.log(`  - ${O.name} (parent: ${(($=O.parent)==null?void 0:$.name)||"Unnamed"})`)})),k==="motorModel"&&(console.log("[DEBUG] motor model mesh names and their parents:"),F.traverse(O=>{var $;O.isMesh&&console.log(`  - ${O.name} (parent: ${(($=O.parent)==null?void 0:$.name)||"Unnamed"})`)})),k==="ldrModel"&&(console.log("[DEBUG] ldr model mesh names:"),F.traverse(O=>{O.isMesh&&console.log("  -",O.name)})),createComponentOutline(k),componentModels[k].orbitControls=new OrbitControls(F,renderer$7.domElement),componentModels[k].orbitControls.enabled=!1,componentModels[k].orbitControls.enablePan=!1,componentModels[k].orbitControls.enableZoom=!1,componentModels[k].orbitControls.enableDamping=!0,componentModels[k].orbitControls.dampingFactor=.1,componentModels[k].orbitControls.rotateSpeed=.7}}),initializeElectro$1(scene$6,allAssets$4,sceneInitialization$5.playerFunction.player,camera$5,controls$6,renderer$7);let c=new __webpack_exports__default.Block({width:1.8,height:1.1,padding:.07,justifyContent:"start",alignItems:"center",fontFamily:"/fonts/msdf/Roboto-msdf.json",fontTexture:"/fonts/msdf/Roboto-msdf.png",backgroundOpacity:.85,backgroundColor:new Color(0),borderRadius:.12,borderWidth:.014,borderColor:new Color(0),borderOpacity:.7,flexDirection:"column",fontSize:.05});const d=new __webpack_exports__default.Block({width:1.5,height:.18,margin:.01,backgroundOpacity:.6,justifyContent:"center",alignItems:"center",flexDirection:"row"});d.add(new __webpack_exports__default.Text({content:"Component Introduction",fontSize:.11,fontColor:new Color(16777215),fontOpacity:1,fontWeight:"bold",textAlign:"center",letterSpacing:.01})),c.add(d),c.add(new __webpack_exports__default.Block({width:1.4,height:.04,backgroundOpacity:0}));const u=new __webpack_exports__default.Block({width:1.45,height:.6,backgroundOpacity:.95,backgroundColor:new Color(16777215),borderRadius:.07,padding:.05,justifyContent:"start",alignItems:"start",flexDirection:"column",margin:.01});u.add(new __webpack_exports__default.Text({content:`Step 1: Click the component you want to inspect
`,fontSize:.08,fontColor:new Color(2236962),fontWeight:"bold",fontOpacity:1,margin:.02,textAlign:"left"})),u.add(new __webpack_exports__default.Text({content:"Step 2: Click on the part you want details about",fontSize:.08,fontColor:new Color(2236962),fontWeight:"bold",fontOpacity:1,margin:.02,textAlign:"left"})),c.add(u),c.position.set(-33,1.9,7.5),c.rotation.set(0,Math.PI,0),c.visible=!0,c.userData.isComponentIntroPanel=!0,scene$6.add(c);let f=new __webpack_exports__default.Block({width:1.4,height:.35,padding:.07,justifyContent:"center",alignItems:"center",fontFamily:"/fonts/msdf/Roboto-msdf.json",fontTexture:"/fonts/msdf/Roboto-msdf.png",backgroundOpacity:0,flexDirection:"column",fontSize:.07});f.add(new __webpack_exports__default.Text({content:"Assemble parts of Byte",fontSize:.11,fontColor:new Color(16777215),fontOpacity:1,fontWeight:"bold",textAlign:"center",letterSpacing:.01})),f.position.set(-39,2.25,-6.21),f.rotation.set(0,0,0),f.visible=!0,scene$6.add(f),window._startBuildButtonCleanup&&window._startBuildButtonCleanup();const h={width:.9,height:.25,justifyContent:"center",offset:.05,margin:.02,borderRadius:.075},m={state:"hovered",attributes:{offset:.035,backgroundColor:new Color(15461337),backgroundOpacity:1,fontColor:new Color(0)}},p={state:"idle",attributes:{offset:.035,backgroundColor:new Color(16777215),backgroundOpacity:1,fontColor:new Color(0)}},v={state:"selected",attributes:{offset:.02,backgroundColor:new Color(16777215),fontColor:new Color(0)},onSet:async()=>{if(!window.isComponentIntroSequencePlaying){try{typeof cleanupScene5=="function"&&cleanupScene5()}catch{}transitionToScene6()}}};let g=new __webpack_exports__default.Block(h);g.add(new __webpack_exports__default.Text({content:"Start Build",fontSize:.12,backgroundOpacity:0,fontColor:new Color(0),fontWeight:"bold",fontFamily:"/fonts/msdf/Roboto-msdf.json",fontTexture:"/fonts/msdf/Roboto-msdf.png",textAlign:"center",letterSpacing:.01,fontOpacity:1})),g.setupState(v),g.setupState(m),g.setupState(p),g.setState("idle"),g.position.copy(f.position),g.position.y-=.28,g.position.z+=.012,g.rotation.copy(f.rotation),g.visible=!0,scene$6.add(g);let y=new __webpack_exports__default.Block({width:.8,height:.23,justifyContent:"center",alignItems:"center",backgroundColor:new Color(0),backgroundOpacity:.98,borderRadius:.035,borderWidth:0,borderOpacity:0,margin:.02});y.position.copy(f.position),y.position.y-=.28,y.position.z+=.005,y.rotation.copy(f.rotation),y.visible=!0,scene$6.add(y);function w(k){if(window.isComponentIntroSequencePlaying){g&&g.currentState!=="idle"&&g.setState("idle");return}if(!camera$5)return;const I=renderer$7.domElement.getBoundingClientRect(),F=new Vector2$1((k.clientX-I.left)/I.width*2-1,-((k.clientY-I.top)/I.height)*2+1),M=new Raycaster;M.setFromCamera(F,camera$5),M.intersectObject(g,!0).length>0?g.currentState!=="hovered"&&g.setState("hovered"):g.currentState==="hovered"&&g.setState("idle")}function _(k){if(!window.isComponentIntroSequencePlaying)if(g.currentState==="hovered")g.setState("selected");else{try{typeof cleanupScene5=="function"&&cleanupScene5()}catch{}transitionToScene6()}}function S(k){window.isComponentIntroSequencePlaying||g.currentState==="selected"&&g.setState("idle")}if(renderer$7.domElement.addEventListener("pointermove",w),renderer$7.domElement.addEventListener("pointerdown",_),renderer$7.domElement.addEventListener("pointerup",S),window._startBuildButtonCleanup=function(){renderer$7.domElement.removeEventListener("pointermove",w),renderer$7.domElement.removeEventListener("pointerdown",_),renderer$7.domElement.removeEventListener("pointerup",S),scene$6&&g&&scene$6.remove(g),scene$6&&y&&scene$6.remove(y),g=null,y=null},e){const k=[];COMPONENT_KEYS.forEach(I=>{const F=allAssets$4.models.gltf[I];F&&(F.userData={...F.userData,componentKey:I,onClick:()=>{if(console.log(`VR Controller clicked on ${I} model`),window.isComponentIntroSequencePlaying){console.log("Electro sequence is playing, ignoring VR click");return}handleComponentClick(I)}},k.push(F),F.traverse(M=>{M.isMesh&&(M.userData={...M.userData,componentKey:I,parentModel:F,onClick:()=>{if(console.log(`VR Controller clicked on ${I} mesh: ${M.name}`),window.isComponentIntroSequencePlaying){console.log("Electro sequence is playing, ignoring VR mesh click");return}focusedComponentKey===I?showMeshUIPanel(M):handleComponentClick(I)}},k.push(M))}))}),g&&(g.userData={...g.userData,isStartBuildButton:!0,onClick:()=>{if(console.log("VR Controller clicked on Start Build button"),window.isComponentIntroSequencePlaying){console.log("Electro sequence is playing, ignoring VR button click");return}g&&g.currentState==="hovered"&&g.setState("selected")}},k.push(g)),window.vrClickableObjects=k,initializeVR(renderer$7,scene$6,camera$5,sceneInitialization$5.playerFunction.player,sceneInitialization$5.playerFunction.actions,k,I=>{I&&I.userData&&I.userData.onClick&&I.userData.onClick()}),collisionMesh$4=allAssets$4.models.gltf.underground.collisionMesh,setCollisionMesh(collisionMesh$4),enablePlayerMovement(sceneInitialization$5.playerFunction.player),console.log("VR Controller raycasting setup completed for Scene5"),console.log("Clickable objects:",k.length),console.log("Component models added:",COMPONENT_KEYS),console.log("Start build button added:",!!g),window.debugVRClickableObjects=()=>{console.log("Current VR clickable objects:",window.vrClickableObjects),window.vrClickableObjects&&window.vrClickableObjects.forEach((I,F)=>{console.log(`Object ${F}:`,I.name,I.userData)})}}const C=E;E=function(){typeof C=="function"&&C()},hoverPointerMoveHandler=k=>{var $,T,D,P,L,B,b,z,N,G,K,ne,J,se;if(!camera$5||!camera$5.isPerspectiveCamera&&!camera$5.isOrthographicCamera||!focusedComponentKey)return;const I=componentModels[focusedComponentKey];if(!I.isNearCamera||!I.meshes.length)return;const F=renderer$7.domElement.getBoundingClientRect(),M=new Vector2$1((k.clientX-F.left)/F.width*2-1,-((k.clientY-F.top)/F.height)*2+1),R=new Raycaster;if(!camera$5||!camera$5.isPerspectiveCamera&&!camera$5.isOrthographicCamera)return;R.setFromCamera(M,camera$5);const O=R.intersectObjects(I.meshes,!0);if(focusedComponentKey==="nano"&&console.log("[DEBUG] pointermove nano intersects:",O.map(te=>te.object.name)),O.length>0){const te=O[0].object;if(focusedComponentKey==="nano"&&(!te.name||!nanoMeshInfo[te.name])||focusedComponentKey==="ir"&&(!te.name||!irMeshInfo[te.name])||focusedComponentKey==="unoModel"&&(!te.name||!unoMeshInfo[te.name])||focusedComponentKey==="ldrModel"&&(!te.name||!ldrMeshInfo[te.name])||focusedComponentKey==="buck"&&(!(($=te.parent)!=null&&$.name)||!buckMeshInfo[(T=te.parent)==null?void 0:T.name])||focusedComponentKey==="motordriverModel"&&(!((D=te.parent)!=null&&D.name)||!motordriverMeshInfo[(P=te.parent)==null?void 0:P.name])||focusedComponentKey==="buttonModel"&&(!((L=te.parent)!=null&&L.name)||!buttonMeshInfo[(B=te.parent)==null?void 0:B.name])||focusedComponentKey==="buzzerModel"&&(!((b=te.parent)!=null&&b.name)||!buzzerMeshInfo[(z=te.parent)==null?void 0:z.name])||focusedComponentKey==="pcbModel"&&(!((N=te.parent)!=null&&N.name)||!pcbMeshInfo[(G=te.parent)==null?void 0:G.name])||focusedComponentKey==="rgbModel"&&(!((K=te.parent)!=null&&K.name)||!rgbMeshInfo[(ne=te.parent)==null?void 0:ne.name])||focusedComponentKey==="motorModel"&&(!((J=te.parent)!=null&&J.name)||!motorMeshInfo[(se=te.parent)==null?void 0:se.name])){I.hoveredMesh&&I.hoveredOutlineMesh&&(I.hoveredMesh.remove(I.hoveredOutlineMesh),I.hoveredOutlineMesh.geometry.dispose(),I.hoveredOutlineMesh.material.dispose()),I.hoveredMesh=null,I.hoveredOutlineMesh=null;return}if(I.hoveredMesh!==te){I.hoveredMesh&&I.hoveredOutlineMesh&&(I.hoveredMesh.remove(I.hoveredOutlineMesh),I.hoveredOutlineMesh.geometry.dispose(),I.hoveredOutlineMesh.material.dispose());const Z=new MeshBasicMaterial({color:65527,side:BackSide,transparent:!0}),Q=new Mesh(te.geometry.clone(),Z);Q.position.copy(te.position),Q.rotation.copy(te.rotation),Q.scale.copy(te.scale).multiplyScalar(1.006),te.add(Q),I.hoveredMesh=te,I.hoveredOutlineMesh=Q}}else I.hoveredMesh&&I.hoveredOutlineMesh&&(I.hoveredMesh.remove(I.hoveredOutlineMesh),I.hoveredOutlineMesh.geometry.dispose(),I.hoveredOutlineMesh.material.dispose()),I.hoveredMesh=null,I.hoveredOutlineMesh=null},createCloseButton(),meshPointerDownHandler=k=>{var O,$,T,D,P,L,B,b,z,N,G,K,ne,J;if(!camera$5||!camera$5.isPerspectiveCamera&&!camera$5.isOrthographicCamera)return;const I=renderer$7.domElement.getBoundingClientRect(),F=new Vector2$1((k.clientX-I.left)/I.width*2-1,-((k.clientY-I.top)/I.height)*2+1),M=new Raycaster;if(!camera$5||!camera$5.isPerspectiveCamera&&!camera$5.isOrthographicCamera)return;if(M.setFromCamera(F,camera$5),focusedComponentKey){const se=componentModels[focusedComponentKey];if(se.isNearCamera&&se.meshes.length>0){const te=M.intersectObjects(se.meshes,!0);if(focusedComponentKey==="nano"&&console.log("[DEBUG] pointerdown nano intersects:",te.map(Z=>Z.object.name)),te.length>0){const Z=te[0].object;if(focusedComponentKey==="nanoModel"&&(!Z.name||!nanoMeshInfo[Z.name])||focusedComponentKey==="irModel"&&(!Z.name||!irMeshInfo[Z.name])||focusedComponentKey==="unoModel"&&(!Z.name||!unoMeshInfo[Z.name])||focusedComponentKey==="ldrModel"&&(!Z.name||!ldrMeshInfo[Z.name])||focusedComponentKey==="buck"&&(!((O=Z.parent)!=null&&O.name)||!buckMeshInfo[($=Z.parent)==null?void 0:$.name])||focusedComponentKey==="motordriverModel"&&(!((T=Z.parent)!=null&&T.name)||!motordriverMeshInfo[(D=Z.parent)==null?void 0:D.name])||focusedComponentKey==="buttonModel"&&(!((P=Z.parent)!=null&&P.name)||!buttonMeshInfo[(L=Z.parent)==null?void 0:L.name])||focusedComponentKey==="buzzerModel"&&(!((B=Z.parent)!=null&&B.name)||!buzzerMeshInfo[(b=Z.parent)==null?void 0:b.name])||focusedComponentKey==="pcbModel"&&(!((z=Z.parent)!=null&&z.name)||!pcbMeshInfo[(N=Z.parent)==null?void 0:N.name])||focusedComponentKey==="rgbModel"&&(!((G=Z.parent)!=null&&G.name)||!rgbMeshInfo[(K=Z.parent)==null?void 0:K.name])||focusedComponentKey==="motorModel"&&(!((ne=Z.parent)!=null&&ne.name)||!motorMeshInfo[(J=Z.parent)==null?void 0:J.name])){hideMeshUIPanel(),se.selectedMesh=null;return}showMeshUIPanel(Z),se.selectedMesh=Z;return}else{hideMeshUIPanel(),se.selectedMesh=null;return}}}let R=!1;COMPONENT_KEYS.forEach(se=>{const te=componentModels[se];te.model&&M.intersectObject(te.model,!0).length>0&&(handleComponentClick(se),R=!0)}),!R&&focusedComponentKey&&(animateComponentToOriginal(focusedComponentKey),hideMeshUIPanel())},renderer$7.domElement.addEventListener("pointerdown",meshPointerDownHandler);function A(){if(t.modeSelected==="vr")renderer$7.setAnimationLoop(E);else{let k=function(){if(!camera$5){cancelAnimationFrame(animationFrameId$5);return}animationFrameId$5=requestAnimationFrame(k),E()};k()}}function E(){var I;if(!camera$5)return;const k=l.getDelta();if(__webpack_exports__default.update(),t.modeSelected==="vr"?updateVR():controls$6&&controls$6.update(),(I=sceneInitialization$5==null?void 0:sceneInitialization$5.playerFunction)!=null&&I.player){const F=sceneInitialization$5.playerFunction.player;F.updateMatrixWorld(),window.isElectroSequencePlaying||(collisionMesh$4&&handleCollisions(F,collisionMesh$4,playerState.velocity,k),playerState.velocity.length()>0&&(F.position.x+=playerState.velocity.x*k,F.position.z+=playerState.velocity.z*k,playerState.onGround||(F.position.y+=playerState.velocity.y*k)))}if(updateElectro$1(k),COMPONENT_KEYS.forEach(F=>{const M=componentModels[F];if(M.isAnimating&&M.model){if(!M.originalPosition||!M.originalRotation||!M.originalScale||!M.targetPosition||!M.targetRotation)return;const R=(performance.now()-M.animationStartTime)/1e3,O=M.animationDuration||COMPONENT_ANIMATION_DURATION,$=Math.min(R/O,1),T=1-Math.pow(1-$,3);if(M.animationDirection==="toCamera"){if(M.model.position.lerpVectors(M.originalPosition,M.targetPosition,T),M.model.scale.lerpVectors(M.originalScale,new Vector3$1(.006,.006,.006),T),M.model.rotation.copy(M.originalRotation),M.model.updateMatrix(),M.model.updateMatrixWorld(),$>=1){if(M.model.position.copy(M.targetPosition),M.model.scale.set(.006,.006,.006),M.model.rotation.set(M.originalRotation.x,M.originalRotation.y-Math.PI,M.originalRotation.z),M.model.updateMatrix(),M.model.updateMatrixWorld(),M.isAnimating=!1,M.isNearCamera=!0,setSceneIsolation(F),M.orbitControls&&!window.isElectroSequencePlaying){M.orbitControls.enabled=!0;const P=new Box3().setFromObject(M.model).getCenter(new Vector3$1);M.orbitControls.target.copy(P),M.orbitControls.update()}addFocusLightForModel(F)}}else M.animationDirection==="toOriginal"&&(M.model.position.lerpVectors(M.targetPosition,M.originalPosition,T),M.model.scale.lerpVectors(new Vector3$1(.006,.006,.006),M.originalScale,T),M.model.updateMatrix(),M.model.updateMatrixWorld(),$>=1&&(M.model.position.copy(M.originalPosition),M.model.scale.copy(M.originalScale),M.model.rotation.copy(M.originalRotation),M.model.updateMatrix(),M.model.updateMatrixWorld(),M.isAnimating=!1,M.isNearCamera=!1,M.orbitControls&&(M.orbitControls.enabled=!1),restoreSceneVisibility(),removeFocusLight()))}M.isNearCamera&&M.orbitControls&&M.orbitControls.enabled&&M.orbitControls.update()}),__webpack_exports__default.update(),renderer$7.render(scene$6,camera$5),!glassPlane&&focusedComponentKey&&componentModels[focusedComponentKey].isNearCamera&&requestAnimationFrame(()=>addGlassPlaneBehindUno()),glassPlane&&!focusedComponentKey&&removeGlassPlane(),focusedComponentKey&&componentModels[focusedComponentKey].isNearCamera&&glassPlane&&componentModels[focusedComponentKey].targetPosition&&camera$5){const F=camera$5.getWorldDirection(new Vector3$1);glassPlane.position.copy(componentModels[focusedComponentKey].targetPosition.clone().sub(F.clone().multiplyScalar(1.2))),glassPlane.lookAt(camera$5.position)}}return A(),resizeHandler$5=()=>{const k=window.innerWidth/window.innerHeight;camera$5&&renderer$7&&(camera$5.aspect=k,camera$5.updateProjectionMatrix(),renderer$7.setSize(window.innerWidth,window.innerHeight))},window.addEventListener("resize",resizeHandler$5),setTimeout(()=>{},2e3),window.addEventListener("loadingScreenHidden-scene5",()=>{camera$5.position.set(-32,1,0),camera$5.lookAt(new Vector3$1(-32,1,-5)),hidePlayerModel(),showFPPOverlay(),setTimeout(()=>{typeof startElectroSequence$1=="function"?startElectroSequence$1():window.startElectroSequence&&window.startElectroSequence()},100)}),{scene:scene$6,camera:camera$5,renderer:renderer$7,controls:controls$6,sceneInitialization:sceneInitialization$5}}function cleanupScene5(){var i;console.log("Starting Scene5 comprehensive cleanup..."),isSceneTransitioning$5=!1;try{typeof gsapWithCSS<"u"&&(gsapWithCSS.globalTimeline&&typeof gsapWithCSS.globalTimeline.clear=="function"&&gsapWithCSS.globalTimeline.clear(),typeof gsapWithCSS.killTweensOf=="function"&&(camera$5&&gsapWithCSS.killTweensOf(camera$5),camera$5&&camera$5.position&&gsapWithCSS.killTweensOf(camera$5.position),camera$5&&camera$5.rotation&&gsapWithCSS.killTweensOf(camera$5.rotation)))}catch{}backgroundAudio$2&&(backgroundAudio$2.pause(),backgroundAudio$2.currentTime=0,backgroundAudio$2=null),cleanupAudioManager();const n=document.getElementById("fpp-overlay-container");n&&n.remove(),resizeHandler$5&&(window.removeEventListener("resize",resizeHandler$5),resizeHandler$5=null),window.removeEventListener("keydown",handleKeyPress$4),hoverPointerMoveHandler&&renderer$7&&renderer$7.domElement&&(renderer$7.domElement.removeEventListener("pointermove",hoverPointerMoveHandler),hoverPointerMoveHandler=null),meshPointerDownHandler&&renderer$7&&renderer$7.domElement&&(renderer$7.domElement.removeEventListener("pointerdown",meshPointerDownHandler),meshPointerDownHandler=null);try{window._scene5HandleSwitchClick&&renderer$7&&renderer$7.domElement&&(renderer$7.domElement.removeEventListener("click",window._scene5HandleSwitchClick),window._scene5HandleSwitchClick=null)}catch{}if(loadingHiddenHandler$1&&(window.removeEventListener("loadingScreenHidden-scene5",loadingHiddenHandler$1),loadingHiddenHandler$1=null),animationFrameId$5&&(cancelAnimationFrame(animationFrameId$5),animationFrameId$5=null),renderer$7&&renderer$7.setAnimationLoop(null),(i=sceneInitialization$5==null?void 0:sceneInitialization$5.playerFunction)!=null&&i.player&&disablePlayerMovement(sceneInitialization$5.playerFunction.player),cleanupVR(),window.vrClickableObjects&&(window.vrClickableObjects.length=0,delete window.vrClickableObjects),cleanupElectro$1(),hudVideoPlane$1&&(scene$6&&scene$6.remove(hudVideoPlane$1),hudVideoPlane$1.geometry&&hudVideoPlane$1.geometry.dispose(),hudVideoPlane$1.material&&(hudVideoPlane$1.material.map&&hudVideoPlane$1.material.map.dispose(),hudVideoPlane$1.material.dispose()),hudVideoPlane$1=null),window.hudVideoElement){try{window.hudVideoElement.pause()}catch{}window.hudVideoElement.parentNode&&window.hudVideoElement.parentNode.removeChild(window.hudVideoElement),window.hudVideoElement=null}COMPONENT_KEYS.forEach(s=>{const r=componentModels[s];r&&(r.orbitControls&&(r.orbitControls.dispose(),r.orbitControls=null),r.outline&&(r.outline.geometry&&r.outline.geometry.dispose(),r.outline.material&&r.outline.material.dispose(),r.outline=null),r.hoveredOutlineMesh&&(r.hoveredOutlineMesh.geometry&&r.hoveredOutlineMesh.geometry.dispose(),r.hoveredOutlineMesh.material&&r.hoveredOutlineMesh.material.dispose(),r.hoveredOutlineMesh=null),r.model&&scene$6&&(scene$6.remove(r.model),r.model.traverse(a=>{a.geometry&&a.geometry.dispose(),a.material&&(Array.isArray(a.material)?a.material.forEach(l=>l.dispose()):a.material.dispose())}),r.model=null),r.meshes=[],r.hoveredMesh=null,r.selectedMesh=null,r.originalPosition=null,r.originalRotation=null,r.originalScale=null,r.isNearCamera=!1,r.isAnimating=!1,r.animationDirection=null,r.animationStartTime=0,r.targetPosition=null,r.targetRotation=null)}),componentModels={},focusedComponentKey=null,meshUIPanel&&(scene$6&&scene$6.remove(meshUIPanel),meshUIPanel=null);const e=scene$6==null?void 0:scene$6.children.find(s=>{var r;return(r=s.userData)==null?void 0:r.isComponentIntroPanel});e&&scene$6.remove(e);const t=scene$6==null?void 0:scene$6.children.find(s=>{var r;return(r=s.userData)==null?void 0:r.isByteAssemblyPanel});if(t&&scene$6.remove(t),glassPlane&&(scene$6&&scene$6.remove(glassPlane),glassPlane.geometry&&glassPlane.geometry.dispose(),glassPlane.material&&glassPlane.material.dispose(),glassPlane=null),removeFocusLight(),sceneInitialization$5&&(sceneInitialization$5.cleanUpCollider(),sceneInitialization$5=null),skybox$2&&(scene$6&&scene$6.remove(skybox$2),skybox$2.material&&(skybox$2.material.map&&skybox$2.material.map.dispose(),skybox$2.material.dispose()),skybox$2.geometry&&skybox$2.geometry.dispose(),skybox$2=null),scene$6){for(;scene$6.children.length>0;){const s=scene$6.children[0];scene$6.remove(s)}scene$6.traverse(s=>{s.geometry&&s.geometry.dispose(),s.material&&(Array.isArray(s.material)?s.material.forEach(r=>{r.map&&r.map.dispose(),r.dispose()}):(s.material.map&&s.material.map.dispose(),s.material.dispose())),s.userData&&(s.userData={})})}controls$6&&controls$6.dispose();const o=document.getElementById("closeUnoButton");if(o&&o.remove(),window._startBuildButtonCleanup&&(window._startBuildButtonCleanup(),window._startBuildButtonCleanup=void 0),collisionMesh$4=null,scene$6=null,camera$5=null,controls$6=null,skybox$2=null,sceneInitialization$5=null,meshUIPanel=null,glassPlane=null,backgroundAudio$2=null,window.hudVideoPlane&&(window.hudVideoPlane=null),window.hudVideoElement&&(window.hudVideoElement=null),window.debugVRClickableObjects&&delete window.debugVRClickableObjects,window._scene5Video){try{window._scene5Video.pause()}catch{}window._scene5Video.parentNode&&window._scene5Video.parentNode.removeChild(window._scene5Video),window._scene5Video=null}window._scene5VideoTexture&&(window._scene5VideoTexture.dispose(),window._scene5VideoTexture=null),window._scene5Material&&(window._scene5Material.dispose(),window._scene5Material=null),window._scene5Clock&&(window._scene5Clock=null),window.isComponentIntroSequencePlaying=!1,window.isElectroSequencePlaying=!1,console.log("Scene5 cleanup completed successfully")}function setSceneIsolation(n){scene$6.traverse(e=>{e.type!=="Scene"&&(e.visible=!1)}),componentModels[n]&&componentModels[n].model&&(componentModels[n].model.visible=!0,componentModels[n].model.traverse(e=>{e.visible=!0})),meshUIPanel&&(meshUIPanel.visible=!0,meshUIPanel.traverse(e=>{e.visible=!0})),camera$5&&(camera$5.visible=!0),COMPONENT_KEYS.forEach(e=>{componentModels[e].orbitControls&&(componentModels[e].orbitControls.enabled=e===n)})}function restoreSceneVisibility(){meshUIPanel&&(scene$6.remove(meshUIPanel),meshUIPanel=null),scene$6.traverse(n=>{n.type!=="Scene"&&(n.visible=!0)}),COMPONENT_KEYS.forEach(n=>{componentModels[n].orbitControls&&(componentModels[n].orbitControls.enabled=!1)})}let focusLight=null;function addFocusLightForModel(n){removeFocusLight();const e=componentModels[n];if(!e||!e.model)return;const t=new Box3().setFromObject(e.model),o=t.getCenter(new Vector3$1),i=t.getSize(new Vector3$1),s=o.clone().add(new Vector3$1(0,i.y*1.2+.2,i.z*.7));focusLight=new PointLight(65527,2.2,4.5,2.2),focusLight.position.copy(s),focusLight.castShadow=!1,focusLight.name="focusLight",scene$6.add(focusLight),focusLight.rim=new PointLight(16777215,.7,6,2.2),focusLight.rim.position.copy(o.clone().add(new Vector3$1(0,i.y*.7,-i.z*1.2))),scene$6.add(focusLight.rim)}function removeFocusLight(){focusLight&&(scene$6.remove(focusLight),focusLight.rim&&scene$6.remove(focusLight.rim),focusLight=null)}async function markSceneCompleted$3(n){try{const e=auth.currentUser;if(!e)return;await updateDoc(doc(db,"users",e.uid),{[`scenesCompleted.${n}`]:!0})}catch(e){console.error("Failed to mark scene completed",e)}}var portalVshader_default=`varying vec2 vUv;\r
varying float vDistortion;

void main() {\r
    vUv = uv;\r
    float angle = atan(position.y, position.x);\r
    float radius = length(position.xy);\r
    float distortion = sin(angle * 8.0 + uv.y * 5.0 + uv.x * 10.0) * 0.05;\r
    vec3 displacedPosition = position + normal * distortion;\r
    vDistortion = distortion;\r
    gl_Position = projectionMatrix * modelViewMatrix * vec4(displacedPosition, 1.0);\r
}`,portalFShader_default=`uniform sampler2D uTexture;\r
uniform float uTime;\r
uniform float uOpacity;\r
varying vec2 vUv;\r
varying float vDistortion;

vec3 permute(vec3 x) {\r
    return mod(((x * 34.0) + 1.0) * x, 289.0);\r
}

float snoise(vec2 v) {\r
    const vec4 C = vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439);\r
    vec2 i = floor(v + dot(v, C.yy));\r
    vec2 x0 = v - i + dot(i, C.xx);\r
    vec2 i1;\r
    i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\r
    vec4 x12 = x0.xyxy + C.xxzz;\r
    x12.xy -= i1;\r
    i = mod(i, 289.0);\r
    vec3 p = permute(permute(i.y + vec3(0.0, i1.y, 1.0)) + i.x + vec3(0.0, i1.x, 1.0));\r
    vec3 m = max(0.5 - vec3(dot(x0, x0), dot(x12.xy, x12.xy), dot(x12.zw, x12.zw)), 0.0);\r
    m = m * m;\r
    m = m * m;\r
    vec3 x = 2.0 * fract(p * C.www) - 1.0;\r
    vec3 h = abs(x) - 0.5;\r
    vec3 ox = floor(x + 0.5);\r
    vec3 a0 = x - ox;\r
    m *= 1.79284291400159 - 0.85373472095314 * (a0 * a0 + h * h);\r
    vec3 g;\r
    g.x = a0.x * x0.x + h.x * x0.y;\r
    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\r
    return 130.0 * dot(m, g);\r
}

void main() {\r
    float noise = snoise(vUv * 6.0 + uTime * 0.4) * 0.2;\r
    vec2 distortedUV = vUv + vec2(noise * 0.2, noise * 0.15);

    vec4 texColor = texture2D(uTexture, distortedUV);

    vec3 energyColor = vec3(0.2 + 0.5 * sin(uTime), 0.8, 1.2);\r
    vec3 color = texColor.rgb * energyColor + vec3(noise * 0.3);

    float alpha = (texColor.r + texColor.g + texColor.b) / 3.0;\r
    alpha *= 1.2 + noise * 0.8;\r
    alpha = pow(alpha, 2.0);\r
    alpha = max(alpha, 0.35);

    gl_FragColor = vec4(color, alpha * uOpacity);\r
}`,videoAlphaVshader_default=`varying vec2 vUv;\r
void main() {\r
    vUv = uv;\r
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\r
}`,videoAlphaFshader_default=`uniform sampler2D videoTexture;\r
uniform float time;\r
varying vec2 vUv;\r
void main() {\r
    vec4 videoColor = texture2D(videoTexture, vUv);\r
    float intensity = (videoColor.r + videoColor.g + videoColor.b) / 3.0;\r
    vec3 enhancedColor = videoColor.rgb * 0.5;\r
    enhancedColor = clamp(enhancedColor, 0.0, 0.5);\r
    float alpha = smoothstep(0.15 - 0.05, 0.15 + 0.05, intensity);\r
    gl_FragColor = vec4(enhancedColor, alpha * videoColor.a);\r
}`;let particleMaterial;function WireConfig(n,e,t,o,i,s,r,a,l=.02){t=Math.min(t,1e5),console.log(`Using particleCount: ${t}`);let d=new Color(i).multiplyScalar(a),u=new BufferGeometry,f=new Float32Array(t*3).fill(9999);u.setAttribute("position",new BufferAttribute(f,3));{let C=new TextureLoader().load("/public/glowTexture.jpg");particleMaterial=new PointsMaterial({map:C,size:o*5,color:d,blending:AdditiveBlending,transparent:!0,depthWrite:!1})}let h=new Points(u,particleMaterial),m=new SphereGeometry(0,16,16),p=new MeshBasicMaterial({color:i,opacity:0,transparent:!0,visible:!0}),v=new Mesh(m,p),g=0,y=0,w=0,_=!0;function S(){if(_){if(y<e.length-1){let C=e[y],A=e[y+1],E=new Vector3$1().lerpVectors(C,A,w).add(new Vector3$1(0,0,0));g<t&&(u.attributes.position.setXYZ(g,E.x,E.y,E.z),g++,u.attributes.position.needsUpdate=!0),v.position.copy(E),w+=l,w>=1&&(w=0,y++)}else{s();return}requestAnimationFrame(S)}}return{particles:h,start:()=>{_=!0,n.add(h),n.add(v),S()},stop:()=>{_=!1},reset:()=>{g=0,y=0,w=0},dispose:()=>{n.remove(h),n.remove(v),u.dispose(),particleMaterial.dispose(),particleMaterial.map&&particleMaterial.map.dispose(),m.dispose(),p.dispose()}}}function applyDistanceFade(n,e,t,o){let s=1-(e.position.distanceTo(n.position)-t)/(o-t);n.material.opacity=MathUtils$1.clamp(s,0,1)}const objectives$1={1:{main:"Proceed to the introduction area",sub:"Follow the minimap and proceed to the introduction area."},2:{main:"Proceed to solve the circuit to open the gate",sub:"Proceed solve the circuit puzzle."},3:{main:"Proceed to the next area",sub:""},4:{main:"Relearn the basics in the introduction area",sub:"Proceed to the introduction area."}};function showSceneObjective(n){__vitePreload(async()=>{const{showObjective:e}=await Promise.resolve().then(()=>ObjectiveUI);return{showObjective:e}},void 0).then(({showObjective:e})=>{e(n,objectives$1)})}let filterObjects=[],draggingControl=null;function cleanupDragControls(){draggingControl&&(draggingControl.dispose(),draggingControl=null)}function objSnapping(n,e,t,o){let i=null,s=1/0;return e.forEach(r=>{const a=n.position.distanceTo(r);a<s&&a<t&&!o.has(r)&&(s=a,i=r)}),i}function updateFilterObjects({scene:n,circuitCam:e,renderer:t,finalPositions:o,snapThreshold:i,occupiedPositions:s,allObjectsPlaced:r,objectToPlaneMap:a}){if(filterObjects=["battery9v","led","capacitor","resistor100","dcMotor"].map(l=>n.getObjectByName(l)).filter(Boolean),filterObjects.length===0){console.warn("No valid objects found for DragControls.");return}draggingControl&&draggingControl.dispose(),draggingControl=new DragControls(filterObjects,e,t.domElement),draggingControl.transformGroup=!0,draggingControl.addEventListener("drag",l=>{const c=l.object;c.position.y=-.95,c.userData.initialRotation&&c.rotation.copy(c.userData.initialRotation)}),draggingControl.addEventListener("dragstart",l=>{const c=l.object;for(let[d,u]of s)if(u===c){s.delete(d);const f=a[c.name];f&&(f.plane.visible=!0,n.add(f.plane));break}}),draggingControl.addEventListener("dragend",l=>{const c=l.object,d=objSnapping(c,o,i,s);if(d){c.position.copy(d),s.set(d,c);const u=a[c.name];if(u){const{plane:f,correctPosition:h}=u;d.distanceTo(h)<.01&&(console.log(`${c.name} placed correctly.`),f.visible=!1)}}c.userData.initialRotation&&c.rotation.copy(c.userData.initialRotation),r()})}let activeGUIs=[];function cleanupGUIControls(){activeGUIs.forEach(n=>{n&&typeof n.destroy=="function"&&n.destroy()}),activeGUIs=[]}class FakeGlowMaterial extends ShaderMaterial{constructor(e={}){super(),this.vertexShader=`
      varying vec3 vPosition;
      varying vec3 vNormal;

      void main() {
        vec4 modelPosition = modelMatrix * vec4(position, 1.0);
        gl_Position = projectionMatrix * viewMatrix * modelPosition;
        vec4 modelNormal = modelMatrix * vec4(normal, 0.0);
        vPosition = modelPosition.xyz;
        vNormal = modelNormal.xyz;

      }
    `,this.fragmentShader=`
      uniform vec3 glowColor;
      uniform float falloff;
      uniform float glowSharpness;
      uniform float glowInternalRadius;
      uniform float opacity;

      varying vec3 vPosition;
      varying vec3 vNormal;

      void main()
      {
        // Normal
        vec3 normal = normalize(vNormal);
        if(!gl_FrontFacing)
            normal *= - 1.0;
        vec3 viewDirection = normalize(cameraPosition - vPosition);
        float fresnel = dot(viewDirection, normal);
        fresnel = pow(fresnel, glowInternalRadius + 0.1);
        float falloff = smoothstep(0., falloff, fresnel);
        float fakeGlow = fresnel;
        fakeGlow += fresnel * glowSharpness;
        fakeGlow *= falloff;
        gl_FragColor = vec4(clamp(glowColor * fresnel, 0., 1.0), clamp(fakeGlow, 0., opacity));

        #include <tonemapping_fragment>
        #include <colorspace_fragment>
      } 
      `,this.uniforms={opacity:new Uniform(e.opacity!==void 0?e.opacity:1),glowInternalRadius:new Uniform(e.glowInternalRadius!==void 0?e.glowInternalRadius:6),glowSharpness:new Uniform(e.glowSharpness!==void 0?e.glowSharpness:.5),falloff:new Uniform(e.falloff!==void 0?e.falloff:.1),glowColor:new Uniform(e.glowColor!==void 0?new Color(e.glowColor):new Color("#00d5ff"))},this.setValues(e),this.depthTest=e.depthTest!==void 0?e.depthTest:!1,this.blending=e.blendMode!==void 0?e.blendMode:AdditiveBlending,this.transparent=!0,this.side=e.side!==void 0?e.side:DoubleSide}}const COLORS={PANEL_BG:1120295,PANEL_BORDER:3621201,OPTION_BG:2042167,OPTION_HOVER:3621201,CORRECT:417606,INCORRECT:8330525};class QuestionnaireUI{constructor(e,t={x:0,y:0,z:0},o={x:0,y:0,z:0}){this.scene=e,this.questions=null,this.currentQuestionIndex=0,this.correctCount=0,this.incorrectCount=0,this.interactableBlocks=[],this.interactableBlocksSummary=[],this.raycaster=new Raycaster,this.summaryPanel=null,this.fontLoaded=!1,this.fontFamily=null,this.fontTexture=null,this.usedQuestionIds=[],this.incorrectComponents=[],this.loadFonts().then(()=>{var i;this.fontLoaded&&((i=this.fontFamily)!=null&&i.info)&&this.fontTexture?(console.log("Fonts validated, setting up panel"),this.setupPanel(t,o)):console.error("Font validation failed, skipping panel setup")})}async loadFonts(){try{const e="https://unpkg.com/three-mesh-ui/examples/assets/Roboto-msdf.json",t="https://unpkg.com/three-mesh-ui/examples/assets/Roboto-msdf.png",[o,i]=await Promise.all([fetch(e),fetch(t)]);if(!o.ok)throw new Error(`Failed to fetch font JSON: ${o.status}`);if(!i.ok)throw new Error(`Failed to fetch font texture: ${i.status}`);const s=await o.json();if(!(s!=null&&s.info))throw new Error("Invalid font JSON: missing info property");this.fontFamily=s,this.fontTexture=t,this.fontLoaded=!0,console.log("Fonts loaded successfully:",this.fontFamily.info,this.fontTexture)}catch(e){console.error("Error loading fonts:",e),this.fontLoaded=!1,this.fontFamily=null,this.fontTexture=null}}setupPanel(e,t){var o;if(!this.fontLoaded||!((o=this.fontFamily)!=null&&o.info)||!this.fontTexture){console.warn("Fonts not properly loaded, skipping panel setup");return}this.panel=new __webpack_exports__default.Block({width:2.4,height:1.6,padding:.08,borderRadius:.18,backgroundColor:new Color(COLORS.PANEL_BG),backgroundOpacity:.96,contentDirection:"column",justifyContent:"start",alignItems:"center",fontFamily:this.fontFamily,fontTexture:this.fontTexture}),this.panel.position.set(e.x,e.y,e.z),this.panel.rotation.set(t.x,t.y,t.z),this.panel.visible=!0,console.log("Panel setup:",{position:this.panel.position,rotation:this.panel.rotation,visible:this.panel.visible}),this.questionText=new __webpack_exports__default.Text({content:"Loading question...",fontSize:.11,lineHeight:1.2,margin:.05}),this.spacer=new __webpack_exports__default.Block({width:1.8,height:.3,alignItems:"center",backgroundOpacity:0}),this.optionsContainer=new __webpack_exports__default.Block({width:1.8,height:.95,padding:.02,contentDirection:"column",justifyContent:"start",alignItems:"center",backgroundOpacity:0}),this.panel.add(this.questionText,this.spacer,this.optionsContainer),this.scene.add(this.panel),__webpack_exports__default.update(),console.log("Panel added to scene, ThreeMeshUI updated")}async setupSummaryPanel(){var l,c;if((!this.fontLoaded||!((l=this.fontFamily)!=null&&l.info)||!this.fontTexture)&&(console.warn("Fonts invalid/missing, reloading before summary setup"),await this.loadFonts(),!this.fontLoaded||!((c=this.fontFamily)!=null&&c.info)||!this.fontTexture)){console.error("Font reload failed, skipping summary panel");return}this.summaryPanel&&(this.disposeBlock(this.summaryPanel),this.scene.remove(this.summaryPanel),this.summaryPanel=null,this.interactableBlocksSummary=[]),this.summaryPanel=new __webpack_exports__default.Block({width:2.4,height:1.4,padding:.08,borderRadius:.18,backgroundColor:new Color(COLORS.PANEL_BG),backgroundOpacity:.96,contentDirection:"column",justifyContent:"start",alignItems:"center",fontFamily:this.fontFamily,fontTexture:this.fontTexture}),this.summaryPanel.position.copy(this.panel.position),this.summaryPanel.rotation.copy(this.panel.rotation),this.summaryPanel.visible=!1;const e=new __webpack_exports__default.Block({width:1.8,height:.8,padding:.02,contentDirection:"column",justifyContent:"center",alignItems:"center",backgroundOpacity:0}),t=this.questions?this.questions.length:0,o=new __webpack_exports__default.Text({content:`Quiz Complete!
Total Questions: ${t}
Correct: ${this.correctCount}
Incorrect: ${this.incorrectCount}`,fontSize:.1,lineHeight:1.2,margin:.05});if(e.add(o),this.incorrectComponents.length>0){const d=new __webpack_exports__default.Text({content:`
Please relearn about: ${this.incorrectComponents.length>0?this.incorrectComponents.join(", "):"None"}`,fontSize:.08,lineHeight:1.2,margin:.05});e.add(d)}const i=new __webpack_exports__default.Block({width:1.8,height:.1,backgroundOpacity:0}),s=new __webpack_exports__default.Block({width:1.8,height:.6,padding:.02,contentDirection:"column",justifyContent:"center",alignItems:"center",backgroundOpacity:0}),r=new __webpack_exports__default.Block({width:.6,height:.18,margin:.05,padding:.02,borderRadius:.09,backgroundColor:new Color(COLORS.OPTION_BG),backgroundOpacity:.9,justifyContent:"center"});r.add(new __webpack_exports__default.Text({content:"Proceed",fontSize:.065})),r.userData={type:"submit"};const a=new __webpack_exports__default.Block({width:.6,height:.18,margin:.05,padding:.02,borderRadius:.09,backgroundColor:new Color(COLORS.OPTION_BG),backgroundOpacity:.9,justifyContent:"center"});a.add(new __webpack_exports__default.Text({content:"Rewatch",fontSize:.065})),a.userData={type:"rewatch"},this.incorrectCount===0?(s.add(r),this.interactableBlocksSummary.push(r)):(s.add(a),this.interactableBlocksSummary.push(a)),this.summaryPanel.add(e,i,s),this.scene.add(this.summaryPanel),__webpack_exports__default.update(),console.log("Summary panel setup, interactable blocks:",this.interactableBlocksSummary.length)}async loadQuestions(){var r;const e=new URL("/assets/Questions--h87q_jV.json",import.meta.url).href;let t=null,o="",i=null;try{console.log("Trying module-relative URL for questions:",e);const a=await fetch(e,{cache:"no-cache"});if(!a.ok)throw new Error(`HTTP ${a.status}`);const l=await a.text();if(l.trim().startsWith("<!DOCTYPE"))throw new Error("Received HTML instead of JSON at module-relative URL");const c=JSON.parse(l);if(!c||!c.lessons||!Array.isArray(c.lessons[0].questions))throw new Error("Invalid question JSON format at module-relative URL");i=c.lessons[0].questions,o=e}catch(a){console.warn("Module-relative URL load failed, trying path-based fallbacks:",a)}if(!i){console.log("Environment details:",{location:window.location.href,pathname:window.location.pathname,origin:window.location.origin,estimatedDir:window.location.pathname.replace(/\/[^\/]*$/,"")});const a=["./Questions.json","/Questions.json",`${window.location.origin}/Questions.json`,`${window.location.pathname.replace(/\/[^\/]*$/,"")}/Questions.json`];console.log("Will try these paths for questions:"),a.forEach((d,u)=>{console.log(`  ${u+1}. ${d}`)});for(const d of a)try{if(console.log("Trying path:",d),t=await fetch(d,{cache:"no-cache"}),console.log("Response status for",d,":",t.status,t.statusText),t.ok){o=d,console.log("Successfully found question file at:",d);break}else console.log("Path failed with status:",d,t.status,t.statusText)}catch(u){console.log("Path failed with error:",d,u)}if(!t||!t.ok)return console.error("Could not find question file. Tried paths:",a.join(", ")),this.showTestQuestion(),!1;const l=await t.text();if(console.log("Raw response from",o,":",l.substring(0,200)+"..."),l.trim().startsWith("<!DOCTYPE"))throw new Error(`Received HTML instead of JSON from ${o}. This usually means a 404 page.`);const c=JSON.parse(l);if(!c.lessons||!Array.isArray(c.lessons[0].questions))throw new Error(`Invalid question format in ${o}`);i=c.lessons[0].questions}const s={Battery:i.filter(a=>a.id==="q1"||a.id==="q2"||a.id==="q3"),LED:i.filter(a=>a.id==="q4"||a.id==="q5"||a.id==="q6"),Capacitor:i.filter(a=>a.id==="q7"||a.id==="q8"||a.id==="q9"),Motor:i.filter(a=>a.id==="q10"||a.id==="q11"||a.id==="q12"),Resistor:i.filter(a=>a.id==="q13"||a.id==="q14"||a.id==="q15")};return this.questions=[],Object.keys(s).forEach(a=>{const l=s[a].filter(c=>!this.usedQuestionIds.includes(c.id));if(l.length===0){this.usedQuestionIds=this.usedQuestionIds.filter(d=>!s[a].some(u=>u.id===d));const c=s[a][Math.floor(Math.random()*s[a].length)];this.questions.push(c),this.usedQuestionIds.push(c.id)}else{const c=l[Math.floor(Math.random()*l.length)];this.questions.push(c),this.usedQuestionIds.push(c.id)}}),console.log("Selected questions:",this.questions.map(a=>({id:a.id,question:a.question}))),console.log("Used question IDs:",this.usedQuestionIds),this.correctCount=0,this.incorrectCount=0,this.incorrectComponents=[],this.currentQuestionIndex=0,this.fontLoaded&&((r=this.fontFamily)!=null&&r.info)&&this.fontTexture?(console.log("Questions loaded, showing first question"),this.showQuestion(0)):console.warn("Fonts not loaded, skipping question display"),!0}showQuestion(e){var r;if(!this.questions||!this.fontLoaded||!((r=this.fontFamily)!=null&&r.info)||!this.fontTexture){console.warn("Cannot show question: fonts or questions not loaded");return}if(!this.questions[e]){console.error(`Invalid question index: ${e}, questions length: ${this.questions.length}`);return}this.currentQuestionIndex=e;const t=this.questions[e];console.log("Showing question:",{index:e,id:t.id,text:t.question,options:t.options}),this.optionsContainer.children=[],this.interactableBlocks=[],this.optionsContainer.set({height:.95,contentDirection:"column",justifyContent:"start",alignItems:"center",padding:.02}),this.questionText.set({content:`${e+1}) ${t.question}`}),this.clearOptions();const o=.18,i=.05;this.optionsContainer.set({height:t.options.length*(o+2*i),contentDirection:"column",justifyContent:"start",alignItems:"center",padding:.02});const s=["a","b","c","d"];t.options.forEach((a,l)=>{const c=this.createOptionBlock(`${s[l]}) ${a}`,l);c?(c.position.set(0,-l*(o+2*i),.01),this.optionsContainer.add(c),this.interactableBlocks.push(c),console.log(`Added option ${l} for question ${t.id}:`,{content:`${s[l]}) ${a}`,position:c.position})):console.warn(`Failed to create option block for option ${l}: ${a}`)}),console.log("Options container children:",this.optionsContainer.children.length,"Interactable blocks:",this.interactableBlocks.length),__webpack_exports__default.update(),setTimeout(()=>{__webpack_exports__default.update(),console.log("ThreeMeshUI updated for question",e)},50),setTimeout(()=>{__webpack_exports__default.update(),console.log("ThreeMeshUI second update for question",e)},100)}createOptionBlock(e,t){var s;if(!this.fontLoaded||!((s=this.fontFamily)!=null&&s.info)||!this.fontTexture)return console.warn("Fonts not loaded, cannot create option block"),null;const o=new __webpack_exports__default.Block({width:1.3,height:.18,margin:.05,padding:.02,borderRadius:.09,backgroundColor:new Color(COLORS.OPTION_BG),backgroundOpacity:.9,justifyContent:"center",alignItems:"center"}),i=new __webpack_exports__default.Text({content:e,fontSize:.065,lineHeight:1.2});return o.add(i),o.userData={index:t,locked:!1},o.traverse(r=>{r.userData={index:t,locked:!1,parentBlock:o}}),console.log("Created option block:",{label:e,index:t}),o}disposeBlock(e){e&&(e.traverse(t=>{t.material&&t.material.dispose(),t.geometry&&t.geometry.dispose(),t.children&&t.children.forEach(o=>this.disposeBlock(o))}),e.parent&&e.parent.remove(e))}clearOptions(){for(console.log("Clearing options, current children:",this.optionsContainer.children.length);this.optionsContainer.children.length>0;){const e=this.optionsContainer.children[0];this.disposeBlock(e),this.optionsContainer.remove(e)}this.interactableBlocks=[],this.optionsContainer.children=[],console.log("Options cleared, children after:",this.optionsContainer.children.length),__webpack_exports__default.update()}handleOptionSelect(e){const t=this.questions[this.currentQuestionIndex].answerIndex,o=this.interactableBlocks[e],i=this.questions[this.currentQuestionIndex].id;if(!o||o.userData.locked)return console.warn("Option select failed:",o?"Block is locked":"No block found",{optionIndex:e}),!1;this.interactableBlocks.forEach(r=>{r.userData.locked=!0});let s;return["q1","q2","q3"].includes(i)?s="Battery":["q4","q5","q6"].includes(i)?s="LED":["q7","q8","q9"].includes(i)?s="Capacitor":["q10","q11","q12"].includes(i)?s="Motor":["q13","q14","q15"].includes(i)&&(s="Resistor"),e===t?(o.set({backgroundColor:new Color(COLORS.CORRECT)}),this.correctCount++):(o.set({backgroundColor:new Color(COLORS.INCORRECT)}),this.incorrectCount++,this.interactableBlocks[t].set({backgroundColor:new Color(COLORS.CORRECT)}),s&&!this.incorrectComponents.includes(s)&&this.incorrectComponents.push(s)),console.log("Option selected:",{optionIndex:e,correctIndex:t,correctCount:this.correctCount,incorrectCount:this.incorrectCount,incorrectComponents:this.incorrectComponents}),__webpack_exports__default.update(),!0}updateHoverStates(e,t){var s,r;this.raycaster.setFromCamera(e,t);const o=(s=this.panel)!=null&&s.visible?this.interactableBlocks:(r=this.summaryPanel)!=null&&r.visible?this.interactableBlocksSummary:[],i=this.raycaster.intersectObjects(o,!0);if(o.forEach(a=>{a.userData.locked||a.set({backgroundColor:new Color(COLORS.OPTION_BG)})}),i.length>0){const a=this.findParentBlock(i[0].object);return a&&!a.userData.locked&&a.set({backgroundColor:new Color(COLORS.OPTION_HOVER)}),console.log("Hover state updated:",{hovered:(a==null?void 0:a.userData.index)??(a==null?void 0:a.userData.type)}),(a==null?void 0:a.userData.index)??(a==null?void 0:a.userData.type)}return-1}findParentBlock(e){let t=e;for(;t&&!this.interactableBlocks.includes(t)&&!this.interactableBlocksSummary.includes(t);)t=t.parent;return t}getNextQuestion(){return this.currentQuestionIndex<this.questions.length-1?(this.currentQuestionIndex+=1,console.log("Moving to next question, index:",this.currentQuestionIndex),this.showQuestion(this.currentQuestionIndex),!0):(console.log("No more questions, quiz completed"),!1)}async resetQuiz(){var e;this.fontLoaded&&((e=this.fontFamily)!=null&&e.info)&&this.fontTexture?(console.log("Resetting quiz, reloading questions"),this.loadQuestions()):console.warn("Fonts not loaded, cannot reset quiz"),this.correctCount=0,this.incorrectCount=0,this.currentQuestionIndex=0,this.incorrectComponents=[]}hide(){this.panel&&(this.panel.visible=!1,__webpack_exports__default.update())}show(){this.panel&&(this.panel.visible=!0,__webpack_exports__default.update())}hideSummary(){this.summaryPanel&&(this.summaryPanel.visible=!1,__webpack_exports__default.update())}showSummary(){this.summaryPanel&&(this.summaryPanel.visible=!0,__webpack_exports__default.update())}cleanup(){this.clearOptions(),this.panel&&(this.disposeBlock(this.panel),this.scene.remove(this.panel),this.panel=null,this.questionText=null,this.spacer=null,this.optionsContainer=null),this.summaryPanel&&(this.disposeBlock(this.summaryPanel),this.scene.remove(this.summaryPanel),this.summaryPanel=null,this.interactableBlocksSummary=[]),this.questions=null,this.currentQuestionIndex=0,this.correctCount=0,this.incorrectCount=0,this.interactableBlocks=[],this.usedQuestionIds=[],this.incorrectComponents=[],__webpack_exports__default.update(),console.log("QuestionnaireUI cleaned up, remaining objects:",this.scene.children.length)}}class MeshUIPanels{constructor(e,t,o,i,s){this.scene=e,this.panelData=t,this.circuitSolutionCallback=o,this.hideCircuitItemsCallback=i,this.showSceneObjectiveCallback=s,this.raycaster=new Raycaster,this.objsToTest=[],this.panelIndex=0,this.buttonHandled=!1,this.selectState=!1,this.clonedModels=[],this.currentModel=null,this.hoveredStateAttributes={state:"hovered",attributes:{backgroundColor:new Color(10066329),backgroundOpacity:1,fontColor:new Color(16777215)}},this.idleStateAttributes={state:"idle",attributes:{backgroundColor:new Color(6710886),backgroundOpacity:.3,fontColor:new Color(16777215)}},this.selectedAttributes={state:"selected",attributes:{backgroundColor:new Color(7829367),fontColor:new Color(2236962)}},this.initPanels(),this.updatePanel(this.panelIndex)}initPanels(){this.circuitPanel=new __webpack_exports__default.Block({width:1.2,height:1,justifyContent:"start",contentDirection:"column",borderRadius:.15,backgroundOpacity:0,fontFamily:FontJSON,fontTexture:FontImage,fontSize:.08});const e=new __webpack_exports__default.Block({width:.2,height:.4,backgroundOpacity:0});this.controlButtonContainer=new __webpack_exports__default.Block({height:.4,width:3.5,padding:.045,contentDirection:"row",justifyContent:"center",borderRadius:.05,backgroundOpacity:.8,fontFamily:FontJSON,fontTexture:FontImage,fontSize:.12}),this.circControlButtonContainer=new __webpack_exports__default.Block({height:.1,width:.25,contentDirection:"row",justifyContent:"center",borderRadius:.03,backgroundOpacity:.8,fontFamily:FontJSON,fontTexture:FontImage,fontSize:.12}),this.button=new __webpack_exports__default.Block({width:1,height:.25,padding:.045,borderRadius:.05,backgroundOpacity:.8,fontFamily:FontJSON,fontTexture:FontImage,fontSize:.12}).add(new __webpack_exports__default.Text({content:"Solve Circuit"})),this.circBackButton=new __webpack_exports__default.Block({height:.05,width:.2,margin:0,padding:.005,borderRadius:.015,backgroundOpacity:.8,fontFamily:FontJSON,fontTexture:FontImage,fontSize:.03}).add(new __webpack_exports__default.Text({content:"Return"})),this.prevButton=new __webpack_exports__default.Block({width:1,height:.25,margin:.05,padding:.045,borderRadius:.05,backgroundOpacity:.8,fontFamily:FontJSON,fontTexture:FontImage,fontSize:.12}).add(new __webpack_exports__default.Text({content:"Prev"})),this.nextButton=new __webpack_exports__default.Block({height:.25,width:1,margin:.05,padding:.045,borderRadius:.05,backgroundOpacity:.8,fontFamily:FontJSON,fontTexture:FontImage,fontSize:.12}).add(new __webpack_exports__default.Text({content:"Next"})),this.backButton=new __webpack_exports__default.Block({height:.25,width:1,margin:.05,padding:.045,borderRadius:.05,backgroundOpacity:.8,fontFamily:FontJSON,fontTexture:FontImage,fontSize:.12}).add(new __webpack_exports__default.Text({content:"Return"})),this.infoMainPanel=new __webpack_exports__default.Block({height:2.4,width:4.65,justifyContent:"center",borderRadius:.15,backgroundOpacity:0,fontFamily:FontJSON,fontTexture:FontImage,fontSize:.12}),this.contentBlock=new __webpack_exports__default.Block({height:2.4,width:4.5,borderRadius:.15,backgroundOpacity:0,contentDirection:"row",justifyContent:"space-between"}),this.leftSubBlock=new __webpack_exports__default.Block({height:2.2,width:1.3,margin:.025,backgroundOpacity:0,borderRadius:.15}),this.rightSubBlockText=new __webpack_exports__default.Text({content:""}),this.rightSubBlock=new __webpack_exports__default.Block({height:2.2,width:3,padding:.15,borderRadius:.15,margin:.025,fontSize:.11,backgroundOpacity:0,justifyContent:"center",textAlign:"justify-left"}).add(this.rightSubBlockText),[this.button,this.circBackButton,this.prevButton,this.nextButton,this.backButton].forEach(t=>{t.traverse(o=>{o.userData.clickable=!0,o.userData.parentButton=t}),t.userData.clickable=!0}),this.button.setupState(this.idleStateAttributes),this.button.setupState(this.hoveredStateAttributes),this.button.setupState({state:"selected",attributes:this.selectedAttributes.attributes,onSet:()=>{console.log("Solve Circuit button selected"),this.circuitSolutionCallback(),this.circControlButtonContainer.visible=!0}}),this.circBackButton.setupState(this.idleStateAttributes),this.circBackButton.setupState(this.hoveredStateAttributes),this.circBackButton.setupState({state:"selected",attributes:this.selectedAttributes.attributes,onSet:()=>{console.log("Back button selected"),this.hideCircuitItemsCallback()}}),this.prevButton.setupState(this.idleStateAttributes),this.prevButton.setupState(this.hoveredStateAttributes),this.prevButton.setupState({state:"selected",attributes:this.selectedAttributes.attributes,onSet:()=>{this.panelIndex>0?this.panelIndex-=1:this.panelIndex=this.panelData.length-1,this.updatePanel(this.panelIndex),console.log("Prev clicked  index:",this.panelIndex),this.prevButton.setState("idle")}}),this.nextButton.setupState(this.idleStateAttributes),this.nextButton.setupState(this.hoveredStateAttributes),this.nextButton.setupState({state:"selected",attributes:this.selectedAttributes.attributes,onSet:()=>{this.panelIndex<this.panelData.length-1?this.panelIndex+=1:this.panelIndex=0,this.updatePanel(this.panelIndex),console.log("Next clicked  index:",this.panelIndex),this.nextButton.setState("idle")}}),this.backButton.setupState(this.idleStateAttributes),this.backButton.setupState(this.hoveredStateAttributes),this.backButton.setupState({state:"selected",attributes:this.selectedAttributes.attributes,onSet:()=>{console.log("Back clicked  index:",this.panelIndex),this.backButton.setState("idle"),this.showSceneObjectiveCallback(2),this.infoMainPanel.visible=!1,this.controlButtonContainer.visible=!1,this.hideCircuitItemsCallback(),this.removeClonedModels()}}),[this.infoMainPanel,this.circuitPanel].forEach(t=>{t.traverse(o=>{o.isMesh&&(o.material.depthWrite=!1,o.material.transparent=!0)})}),this.circuitPanel.add(e,this.button),this.contentBlock.add(this.leftSubBlock,this.rightSubBlock),this.infoMainPanel.add(this.contentBlock),this.circControlButtonContainer.add(this.circBackButton),this.controlButtonContainer.add(this.prevButton,this.nextButton,this.backButton),this.infoMainPanel.position.set(-3.7,0,-8.2),this.circControlButtonContainer.position.set(-4.8,-.5,8),this.circControlButtonContainer.rotation.set(Math.PI/12,Math.PI,0),this.controlButtonContainer.position.set(-3.8,-1.5,-8.2),this.circuitPanel.position.set(-28,-.45,.3),this.circuitPanel.rotation.y=Math.PI/2,this.scene.add(this.circuitPanel,this.infoMainPanel,this.controlButtonContainer),this.infoMainPanel.visible=!1,this.controlButtonContainer.visible=!1,this.circControlButtonContainer.visible=!1,this.objsToTest=[this.circBackButton,this.prevButton,this.nextButton,this.backButton]}updatePanel(e){var c;const t=this.panelData[e];if(!t)return;let{text:o,model:i,shouldClone:s=!0,position:r=new Vector3$1(-5.25,-.45,-8),rotation:a=new Vector3$1(0,0,0),scale:l=new Vector3$1(1,1,1)}=t;Array.isArray(r)&&(r=new Vector3$1(...r)),Array.isArray(a)&&(a=new Vector3$1(...a)),Array.isArray(l)&&(l=new Vector3$1(...l)),this.currentModel&&(this.scene.remove(this.currentModel),(c=this.currentModel.userData)!=null&&c.isClone&&this.currentModel.traverse(d=>{d.isMesh&&(d.geometry.dispose(),d.material.map&&d.material.map.dispose(),d.material.dispose())}),this.currentModel=null),i&&(this.currentModel=s?i.clone():i,s&&(this.currentModel.userData.isClone=!0,this.clonedModels.push(this.currentModel)),this.currentModel.position.copy(r),this.currentModel.rotation.set(a.x,a.y,a.z),this.currentModel.scale.copy(l),this.currentModel.userData.baseY=this.currentModel.position.y,this.scene.add(this.currentModel)),this.rightSubBlockText.set({content:o}),this.rightSubBlockText.update(),this.rightSubBlock.update()}updateButtons(e,t,o){if(o.xr.isPresenting||!this.objsToTest.length||e.x===null||e.y===null)return;this.raycaster.setFromCamera(e,t);let i=null,s=1/0;this.objsToTest.forEach(r=>{if(!r||!r.parent||!r.visible)return;const a=this.raycaster.intersectObject(r,!0);a.length>0&&a[0].distance<s&&(i=r,s=a[0].distance)}),this.objsToTest.forEach(r=>{r&&r.isUI&&r.visible&&r.setState("idle")}),i&&i.isUI&&i.visible&&(this.selectState&&!this.buttonHandled?(i.setState("selected"),this.buttonHandled=!0):this.selectState||(i.setState("hovered"),this.buttonHandled=!1))}updateAnimation(e){if(this.currentModel){this.currentModel.renderOrder=2;let t=.05*Math.sin(e*2);this.currentModel.position.y=this.currentModel.userData.baseY+t,this.currentModel.rotation.y+=.01}[this.circuitPanel,this.infoMainPanel,this.contentBlock,this.leftSubBlock,this.rightSubBlock,this.button].forEach(t=>{t&&(t.renderOrder=0)})}setSelectState(e){this.selectState=e}removeClonedModels(){this.clonedModels.forEach(e=>{e&&(this.scene.remove(e),e.traverse(t=>{t.isMesh&&(t.geometry.dispose(),Array.isArray(t.material)?t.material.forEach(o=>o.dispose()):t.material.dispose())}))}),this.clonedModels.length=0}cleanup(){[this.circuitPanel,this.button,this.prevButton,this.nextButton,this.backButton,this.circBackButton,this.infoMainPanel,this.controlButtonContainer,this.circControlButtonContainer,this.contentBlock,this.leftSubBlock,this.rightSubBlock].forEach(e=>{e&&e.parent&&(e.parent.remove(e),__webpack_exports__default.update(),e=null)}),this.removeClonedModels(),this.objsToTest=[],this.currentModel=null,this.panelData=[]}getObjsToTest(){return this.objsToTest}}let skipButtonInitialized=!1,isSequenceSkipped=!1;async function markSceneCompleted$2(n){try{const e=auth.currentUser;if(!e)return;await updateDoc(doc(db,"users",e.uid),{[`scenesCompleted.${n}`]:!0})}catch(e){console.error("Failed to mark scene completed",e)}}let scene$5,renderer$6,controls$5,camera$4,circuitCam,gateViewCam,electroViewCam,electroExplaination,introRoomCam,circPanel,gateMesh,gatePlane,line,lockPlane,capacitorModel,batteryModel,introBatteryModel,introMotorModel,ledModel,mainModel,resistorModel,dcMotorModel,ubecModel,buttonModel,buzzerModel,motorDriverModel,powerDistributorModel,electro,dTwinPlane,keyPadPlane,zoePlane,ledGlowClone,panelData,questionnairePanel,electroMixer,wakeup,headUp,electroIdle,electroType,electroExplain,electroReach,circuitPanel,button,prevButton,nextButton,backButton,circBackButton,infoMainPanel,controlButtonContainer,circControlButtonContainer,contentBlock,leftSubBlock,rightSubBlock,currentCamera,viewCam,collisionMesh$3,clock$1,directionalLight1,snapThreshold=.11,fakeGlowMaterial,pointLight,meshUIPanels=null,electroShapekey=null,animationFrameId$4=null,sceneInitialization$4=null,resizeHandler$4=null,infoZoneTrigger,sceneSwitchTrigger,warningZoneTrigger1=null,currentModel=null,isSceneTransitioning$4=!1,isQuizSubmitted=!1,physicsSet=!1,introCompleted=!1,isMovingCameraBack=!1,isMovingCameraToTarget=!1,pointerDownHandler=null,pointerUpHandler=null,mouseMoveHandler=null,windowMouseDownHandler=null,windowResizeHandler=null,objectToPlaneMap={};const targetMap={battery9v:new Vector3$1(-3.29,-.99,7.4),dcMotor:new Vector3$1(-4.38,-.95,7.95),resistor100:new Vector3$1(-3.7,-.97,8.1),led:new Vector3$1(-4.12,-.97,8.1),capacitor:new Vector3$1(-3.5,-.97,7.5)};let activeWireGlows=[],circuitLines=[],objsToTest=[],connections=[],planeTextures=[],planeCloneTracker=[],planeMaterialTracker=[],planePositions=[new Vector3$1(-3.3,-.945,7.4),new Vector3$1(-3.5,-.945,7.5),new Vector3$1(-4.12,-.945,8.1),new Vector3$1(-4.38,-.92,7.9),new Vector3$1(-3.7,-.945,8.1)],planeRotations=[new Euler$1(Math.PI/2,0,Math.PI/2),new Euler$1(Math.PI/2,0,0),new Euler$1(Math.PI/2,0,0),new Euler$1(Math.PI/2,Math.PI,0),new Euler$1(Math.PI/2,0,0)],wireGlowPoints=[[new Vector3$1(-3.15,-.93,7.43),new Vector3$1(-3.3,-.93,7.43),new Vector3$1(-3.3,-.97,7.43),new Vector3$1(-3.3,-.97,8.1),new Vector3$1(-3.62,-.97,8.1),new Vector3$1(-3.62,-.93,8.1),new Vector3$1(-3.78,-.93,8.1),new Vector3$1(-3.78,-.97,8.1),new Vector3$1(-4.105,-.97,8.1),new Vector3$1(-4.105,-.8,8.1),new Vector3$1(-4.135,-.8,8.1),new Vector3$1(-4.135,-.97,8.1),new Vector3$1(-4.38,-.97,8.1),new Vector3$1(-4.38,-.97,7.96),new Vector3$1(-4.38,-.93,7.96),new Vector3$1(-4.4,-.93,7.96),new Vector3$1(-4.4,-.93,7.88),new Vector3$1(-4.38,-.93,7.88),new Vector3$1(-4.38,-.97,7.88),new Vector3$1(-4.38,-.97,7.25),new Vector3$1(-3.3,-.97,7.25),new Vector3$1(-3.3,-.97,7.37),new Vector3$1(-3.3,-.93,7.37),new Vector3$1(-3.15,-.93,7.37)],[new Vector3$1(-3.5,-.97,8.1),new Vector3$1(-3.5,-.97,7.501),new Vector3$1(-3.5,-.85,7.501),new Vector3$1(-3.5,-.85,7.48),new Vector3$1(-3.5,-.97,7.48),new Vector3$1(-3.5,-.97,7.25)]],finalPositions=Object.values(targetMap),mouse=new Vector2$1;new Raycaster;let occupiedPositions=new Map;new Vector2$1;let baseColorTex,portalTex,lockTex,alphaTex,batteryTex,capacitorTex,ledTex,motorTex,resistorTex,keyBoardTex,dTwinTex,zoeTex,zoeVideo,dTwinVideo;function handleKeyPress$3(n){if(n.key.toLowerCase()==="y"&&!isSceneTransitioning$4){isSceneTransitioning$4=!0;const e=renderer$6.xr.getSession(),t=o=>{markSceneCompleted$2("scene4"),window.removeEventListener("keydown",handleKeyPress$3),sceneInitialization$4&&sceneInitialization$4.cleanUpCollider(),cleanupScene4(),checkExistingAssets(assetsEntry$4),initializeScene5(renderer$6,o).finally(()=>{isSceneTransitioning$4=!1})};e?e.end().then(()=>{t(!0)}).catch(o=>{console.error("Error ending VR session:",o),isSceneTransitioning$4=!1}):t(!1)}}async function initializeScene4(n,e){let t=!1,o=!1,i=!1;setCurrentScene("scene4"),isSequenceSkipped=!1,skipButtonInitialized=!1;const s=getUserInfo();animationFrameId$4=null,animationFrameId$4&&(cancelAnimationFrame(animationFrameId$4),animationFrameId$4=null),camera$4=new PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),camera$4.position.set(0,0,1.6),viewCam=new PerspectiveCamera(32,window.innerWidth/window.innerHeight,.1,1e3),circuitCam=new PerspectiveCamera(32,window.innerWidth/window.innerHeight,.1,1e3),gateViewCam=new PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),electroViewCam=new PerspectiveCamera(32,window.innerWidth/window.innerHeight,.1,1e3),electroExplaination=new PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),introRoomCam=new PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),await loadAllAsset(assetsEntry$5,camera$4),console.log(allAssets$4),currentCamera=camera$4,scene$5=new Scene,initializeAudioManager(currentCamera,scene$5),renderer$6=n,renderer$6.setSize(window.innerWidth,window.innerHeight),renderer$6.shadowMap.enabled=!0,renderer$6.shadowMap.type=PCFSoftShadowMap,renderer$6.shadowMap.autoUpdate=!0,renderer$6.toneMapping=ACESFilmicToneMapping,renderer$6.toneMappingExposure=1,renderer$6.physicallyCorrectLights=!0,pointLight=new PointLight(16732241,0,5),pointLight.position.set(-4.12,-.76,8.1),renderer$6.domElement.parentElement||document.body.appendChild(renderer$6.domElement),console.log(renderer$6),clock$1=new Clock,baseColorTex=allAssets$4.textures.screen,alphaTex=allAssets$4.textures.Lock_Base_Alpha,portalTex=allAssets$4.textures.portal,lockTex=allAssets$4.textures.Lock_Base,batteryTex=allAssets$4.textures.batteryImg,capacitorTex=allAssets$4.textures.capacitorImg,ledTex=allAssets$4.textures.ledImg,motorTex=allAssets$4.textures.motorImg,resistorTex=allAssets$4.textures.resistorImg,keyBoardTex=allAssets$4.textures.keyboardImg,dTwinTex=allAssets$4.videotextures.DTwin,zoeTex=allAssets$4.videotextures.ZoeVid,allAssets$4.videotextures&&allAssets$4.videotextures.DTwin?(dTwinVideo=document.createElement("video"),dTwinVideo.src=allAssets$4.videotextures.DTwin.path,dTwinVideo.loop=!0,dTwinVideo.muted=!0,dTwinVideo.playsInline=!0,dTwinVideo.crossOrigin="anonymous",dTwinVideo.autoplay=!1,dTwinVideo.preload="auto",dTwinVideo.style.display="none",document.body.appendChild(dTwinVideo),dTwinTex=new VideoTexture(dTwinVideo),dTwinTex.minFilter=LinearFilter,dTwinTex.magFilter=LinearFilter,dTwinTex.format=RGBAFormat,dTwinTex.generateMipmaps=!1,window.dTwinVideoElement=dTwinVideo,window.dTwinVideoTexture=dTwinTex):console.error("dTwinTex not found in allAssets.videotextures"),allAssets$4.videotextures&&allAssets$4.videotextures.ZoeVid?(zoeVideo=document.createElement("video"),zoeVideo.src=allAssets$4.videotextures.ZoeVid.path,zoeVideo.loop=!0,zoeVideo.muted=!0,zoeVideo.playsInline=!0,zoeVideo.crossOrigin="anonymous",zoeVideo.autoplay=!1,zoeVideo.preload="auto",zoeVideo.style.display="none",document.body.appendChild(zoeVideo),zoeTex=new VideoTexture(zoeVideo),zoeTex.minFilter=LinearFilter,zoeTex.magFilter=LinearFilter,zoeTex.format=RGBAFormat,zoeTex.generateMipmaps=!1,window.zoeVideoElement=zoeVideo,window.zoeVideoTexture=zoeTex):console.error("zoeTex not found in allAssets.videotextures");const a=Object.entries({baseColorTex,portalTex,alphaTex,lockTex,batteryTex,capacitorTex,ledTex,motorTex,resistorTex,keyBoardTex}).filter(([B,b])=>!b).map(([B])=>B);if(a.length>0){console.error("Missing textures:",a.join(", "));return}baseColorTex.wrapS=baseColorTex.wrapT=portalTex.wrapS=portalTex.wrapT=alphaTex.wrapS=alphaTex.wrapT=lockTex.wrapS=lockTex.wrapT=batteryTex.wrapS=batteryTex.wrapT=capacitorTex.wrapS=capacitorTex.wrapT=ledTex.wrapS=ledTex.wrapT=motorTex.wrapS=motorTex.wrapT=resistorTex.wrapS=resistorTex.wrapT=keyBoardTex.wrapS=keyBoardTex.wrapT=RepeatWrapping,planeTextures=[batteryTex,capacitorTex,ledTex,motorTex,resistorTex,keyBoardTex],circPanel=new Mesh(new PlaneGeometry(1.5,2.7),new MeshStandardMaterial({map:baseColorTex,side:DoubleSide,depthWrite:!0})),gatePlane=new Mesh(new PlaneGeometry(10,5),new MeshStandardMaterial({side:DoubleSide})),lockPlane=new Mesh(new PlaneGeometry(.5,.5),new MeshBasicMaterial({map:lockTex,alphaMap:alphaTex,transparent:!0,depthWrite:!1,depthTest:!0})),keyPadPlane=new Mesh(new PlaneGeometry(1,.5),new MeshStandardMaterial({side:DoubleSide,map:keyBoardTex,transparent:!0})),zoePlane=new Mesh(new PlaneGeometry(1,1),dTwinTex?new ShaderMaterial({uniforms:{videoTexture:{value:dTwinTex},time:{value:0}},vertexShader:videoAlphaVshader_default,fragmentShader:videoAlphaFshader_default,transparent:!0,side:DoubleSide,blending:AdditiveBlending,depthWrite:!1}):new MeshStandardMaterial({side:DoubleSide,transparent:!0,opacity:0,color:65280})),dTwinPlane=new Mesh(new PlaneGeometry(1,1),new ShaderMaterial({uniforms:{videoTexture:{value:dTwinTex},time:{value:0}},vertexShader:videoAlphaVshader_default,fragmentShader:videoAlphaFshader_default,transparent:!0,side:DoubleSide,blending:AdditiveBlending,depthWrite:!1})),fakeGlowMaterial=new FakeGlowMaterial({glowColor:"#ff5051",falloff:.5,glowInternalRadius:1.5,glowSharpness:.2,opacity:0}),mainModel=allAssets$4.models.gltf.main,batteryModel=allAssets$4.models.gltf.battery9v,introBatteryModel=allAssets$4.models.gltf.introBattery9v,ledModel=allAssets$4.models.gltf.led,capacitorModel=allAssets$4.models.gltf.capacitor,resistorModel=allAssets$4.models.gltf.resistor100,dcMotorModel=allAssets$4.models.gltf.dcMotor,introMotorModel=allAssets$4.models.gltf.introMotor,ubecModel=allAssets$4.models.gltf.UBEC,powerDistributorModel=allAssets$4.models.gltf.powerDistributionModule,buzzerModel=allAssets$4.models.gltf.buzzer,buttonModel=allAssets$4.models.gltf.button,motorDriverModel=allAssets$4.models.gltf.motorDriver,electro=allAssets$4.characters.models.electro,console.log(electro),electroShapekey=setupShapeKeyAnimations(electro),electroMixer=allAssets$4.characters.animations.electro.mixer,wakeup=allAssets$4.characters.animations.electro.actions.IDEL,electroIdle=allAssets$4.characters.animations.electro.actions.BREATHING_IDLE,headUp=allAssets$4.characters.animations.electro.actions.HEAD_UP,electroType=allAssets$4.characters.animations.electro.actions.ENTERING_CODE,electroExplain=allAssets$4.characters.animations.electro.actions.TALKING_02,electroReach=allAssets$4.characters.animations.electro.actions.REACHING_OUT;let l=new ShaderMaterial({side:DoubleSide,transparent:!0,depthWrite:!1,blending:AdditiveBlending,uniforms:{uTime:{value:0},uTexture:{value:portalTex},uOpacity:{value:1}},vertexShader:portalVshader_default,fragmentShader:portalFShader_default});mainModel.traverse(B=>{B.isMesh&&B.name==="portal_physics"&&(gateMesh=B,gateMesh.material=l,console.log(B.position))}),camera$4.position.set(0,.5,-.2);let c=new Group;c.add(electroViewCam),c.position.set(0,.5,-.2),c.rotation.set(0,Math.PI,0),electro.traverse(B=>{B.isBone&&B.name==="mixamorigHead"&&B.add(c)}),gatePlane.position.set(-27.5,0,0),circPanel.position.set(-27.6,-.2,-7.1),lockPlane.position.set(-27.8,-.5,.3),keyPadPlane.position.set(-26,-1.4,-.1),zoePlane.position.set(-26.5,-.1,2.9),dTwinPlane.position.set(-27,-.1,-2.9),ledModel.position.set(-2.8,-.95,7.925),dcMotorModel.position.set(-2.7,-.95,8.15),capacitorModel.position.set(-2.8,-.95,7.475),resistorModel.position.set(-2.8,-.95,7.7),batteryModel.position.set(-2.8,-.99,7.25),electro.position.set(-15,-2,5),pointLight.position.set(-4.12,-.97,8.1),keyPadPlane.rotateY(-Math.PI/2),keyPadPlane.rotateX(-Math.PI/4),zoePlane.rotateY(13*Math.PI/18),dTwinPlane.rotateY(Math.PI/3),ledModel.rotateY(-Math.PI/2),dcMotorModel.rotation.set(Math.PI/2,Math.PI,0),batteryModel.rotation.set(Math.PI/2,Math.PI,0),resistorModel.rotateY(Math.PI),capacitorModel.rotation.set(0,Math.PI/2,Math.PI/2),electro.rotateY(-2*Math.PI/3),dcMotorModel.userData.initialRotation=dcMotorModel.rotation.clone(),capacitorModel.userData.initialRotation=capacitorModel.rotation.clone(),ledModel.userData.initialRotation=new Euler$1().copy(ledModel.rotation),ledModel.userData.initialQuaternion=new Quaternion$1().copy(ledModel.quaternion),resistorModel.userData.initialRotation=resistorModel.rotation.clone(),batteryModel.userData.initialRotation=batteryModel.rotation.clone(),gatePlane.rotateY(Math.PI/2),lockPlane.rotateY(Math.PI/2),circPanel.rotateY(Math.PI/2),circPanel.rotateZ(Math.PI/2),zoePlane.scale.set(2,2,2),dTwinPlane.scale.set(2,2,2),ledModel.scale.set(.14,.14,.14),dcMotorModel.scale.set(.3,.3,.3),capacitorModel.scale.set(.22,.22,.22),resistorModel.scale.set(.17,.17,.17),batteryModel.scale.set(.2,.2,.2),introBatteryModel.visible=!1,ledModel.visible=!1,capacitorModel.visible=!1,introMotorModel.visible=!1,resistorModel.visible=!1,ubecModel.visible=!1,powerDistributorModel.visible=!1,buzzerModel.visible=!1,buttonModel.visible=!1,motorDriverModel.visible=!1,batteryModel.visible=!1,dcMotorModel.visible=!1,circPanel.visible=!1,gatePlane.visible=!1,circPanel.visible=!1,gatePlane.visible=!1,scene$5.add(gatePlane,lockPlane),scene$5.add(pointLight),scene$5.add(electro),ledModel.traverse(B=>{if(B.isMesh&&B.name==="Cylinder_0"){let b=B.clone();b.material=fakeGlowMaterial,b.position.copy(B.position),b.quaternion.copy(B.quaternion),B.parent.add(b),ledGlowClone=b}});let d=addCollider("gatePlane",gatePlane);d.position.copy(gatePlane.position),d.rotation.copy(gatePlane.rotation),scene$5.add(d);let u=new PMREMGenerator(renderer$6);u.compileEquirectangularShader();let f=u.fromEquirectangular(allAssets$4.hdris.env).texture;scene$5.environment=f,scene$5.background=f,u.dispose();function h(){connections=[[-3.3,-.97,7.25,-3.3,-.97,7.37],[-3.3,-.97,7.43,-3.3,-.97,8.1],[-3.3,-.97,7.37,-3.3,-.95,7.37],[-3.3,-.97,7.43,-3.3,-.95,7.43],[-3.5,-.97,7.25,-3.5,-.97,7.48],[-3.5,-.97,7.501,-3.5,-.97,8.1],[-3.5,-.97,7.48,-3.5,-.96,7.48],[-3.5,-.97,7.501,-3.5,-.96,7.501],[-4.38,-.97,7.25,-4.38,-.97,7.88],[-4.38,-.97,7.96,-4.38,-.97,8.1],[-4.38,-.97,7.88,-4.38,-.93,7.88],[-4.38,-.97,7.96,-4.38,-.93,7.96],[-3.3,-.97,8.1,-3.62,-.97,8.1],[-3.78,-.97,8.1,-4.105,-.97,8.1],[-4.105,-.97,8.1,-4.105,-.95,8.1],[-4.135,-.97,8.1,-4.38,-.97,8.1],[-3.3,-.97,7.25,-4.38,-.97,7.25]];let B=new LineMaterial({color:16711680,linewidth:6,resolution:new Vector2$1(window.innerWidth,window.innerHeight)});connections.forEach(b=>{let z=new LineGeometry;z.setPositions(b),line=new Line2(z,B),line.computeLineDistances(),scene$5.add(line),circuitLines.push(line)})}function m(){console.log("circuit solution"),circPanel.visible=!0,h(),A(),scene$5.add(mainModel),batteryModel.visible=!0,ledModel.visible=!0,capacitorModel.visible=!0,resistorModel.visible=!0,dcMotorModel.visible=!0,console.log("Battery:",{visible:batteryModel.visible,position:batteryModel.position.toArray(),inScene:scene$5.children.includes(batteryModel)}),console.log("LED:",{visible:ledModel.visible,position:ledModel.position.toArray(),inScene:scene$5.children.includes(ledModel)}),console.log("Capacitor:",{visible:capacitorModel.visible,position:capacitorModel.position.toArray(),inScene:scene$5.children.includes(capacitorModel)}),console.log("Resistor:",{visible:resistorModel.visible,position:resistorModel.position.toArray(),inScene:scene$5.children.includes(resistorModel)}),console.log("DC Motor:",{visible:dcMotorModel.visible,position:dcMotorModel.position.toArray(),inScene:scene$5.children.includes(dcMotorModel)}),scene$5.children.includes(batteryModel)||scene$5.add(batteryModel),scene$5.children.includes(ledModel)||scene$5.add(ledModel),scene$5.children.includes(capacitorModel)||scene$5.add(capacitorModel),scene$5.children.includes(resistorModel)||scene$5.add(resistorModel),scene$5.children.includes(dcMotorModel)||scene$5.add(dcMotorModel),meshUIPanels.circuitPanel.visible=!1,planePositions.forEach((B,b)=>{let z=planeTextures[b],N=new MeshStandardMaterial({map:z,side:DoubleSide,opacity:.2,transparent:!0}),G=new Mesh(new PlaneGeometry(.15,.15),N);G.position.copy(B),planeRotations[b]?G.rotation.copy(planeRotations[b]):G.rotation.x=Math.PI/2,scene$5.add(G),planeCloneTracker.push(G),planeMaterialTracker.push(N);let ne=["battery9v","capacitor","led","dcMotor","resistor100"][b];objectToPlaneMap[ne]={plane:G,correctPosition:targetMap[ne]},gsapWithCSS.to(N,{opacity:.8,duration:.8,yoyo:!0,repeat:-1,ease:"sine.inOut"})}),updateFilterObjects({scene:scene$5,circuitCam,renderer:renderer$6,finalPositions,snapThreshold,occupiedPositions,allObjectsPlaced:g,objectToPlaneMap})}function p(B){let b=0;const z=wireGlowPoints.length;function N(){b++,b===z&&(typeof B=="function"&&B(),gsapWithCSS.to(pointLight,{intensity:5,duration:5,ease:"power2.out",onComplete:()=>{setTimeout(()=>{k(),E()},500)}}),ledGlowClone!=null&&ledGlowClone.material&&gsapWithCSS.to(ledGlowClone.material.uniforms.opacity,{value:1,duration:5,ease:"power2.out"}))}activeWireGlows=wireGlowPoints.map(G=>WireConfig(scene$5,G,5e3,.01,"#48cae4",N,!0,1,.02)),activeWireGlows.forEach(G=>G.start())}function v(){const B=Array.from(occupiedPositions.entries());return B.length!==Object.keys(targetMap).length?!1:!B.some(([z,N])=>{const G=targetMap[N.name];return G?z.distanceTo(G)>=.05:!0})}function g(){if(console.log("Checking circuit completion..."),occupiedPositions.size===0)return;v()?(console.log("All components placed correctly."),scene$5.remove(meshUIPanels.circControlButtonContainer),p(()=>{y(),playAudio("electroCorrectCircuit")}),physicsSet||(scene$5.remove(gatePlane),removeCollider("gatePlane"),physicsSet=!0)):occupiedPositions.size===Object.keys(targetMap).length&&(stopAudio("electroCorrectCircuit"),playAudio("electroWrongCircuit"),console.log("Circuit assembled incorrectly"))}function y(){activeWireGlows.forEach(B=>{B&&typeof B.dispose=="function"&&B.dispose()}),activeWireGlows.length=0}function w(){meshUIPanels.infoMainPanel.visible=!0,meshUIPanels.controlButtonContainer.visible=!0,meshUIPanels.panelIndex=0,meshUIPanels.updatePanel(meshUIPanels.panelIndex),introBatteryModel.visible=!0,ledModel.visible=!0,capacitorModel.visible=!0,introMotorModel.visible=!0,resistorModel.visible=!0,ubecModel.visible=!0,powerDistributorModel.visible=!0,buzzerModel.visible=!0,buttonModel.visible=!0,motorDriverModel.visible=!0}infoZoneTrigger=TriggerPoint(allAssets$4.vfxs.zone,{x:-3.75,y:-1.8,z:-3},scene$5,{x:.6,y:.6,z:.6},()=>{disablePlayerControls(),console.log("callback triggered"),S(),w()},!0),warningZoneTrigger1=TriggerPoint(allAssets$4.vfxs.circuitPuzzleZone,{x:-27,y:-2,z:.4},scene$5,{x:1.1,y:1.1,z:1.1},()=>{introCompleted||playAudio("electroCaution1")}),sceneSwitchTrigger=TriggerPoint(allAssets$4.vfxs.circuitPuzzleZone,{x:-29.2,y:-2,z:.5},scene$5,{x:1.2,y:1.2,z:1.2},()=>{console.log("triggered"),t=!0;const B=renderer$6.xr.getSession(),b=z=>{try{cleanupMinimap$3();const N=document.getElementById("minimap-container");N&&N.parentNode&&N.parentNode.removeChild(N);const G=document.getElementById("minimap-toggle");G&&G.parentNode&&G.parentNode.removeChild(G)}catch{}markSceneCompleted$2("scene4"),window.removeEventListener("keydown",handleKeyPress$3),sceneInitialization$4&&sceneInitialization$4.cleanUpCollider(),cleanupScene4(),checkExistingAssets(assetsEntry$4),initializeScene5(renderer$6,z).finally(()=>{t=!1})};B?B.end().then(()=>{b(!0)}).catch(z=>{console.error("Error ending VR session:",z),t=!1}):b(!1)});function _(){meshUIPanels.backButton.setState("idle"),currentCamera=camera$4,enablePlayerControls(),controls$5.enabled=!0,meshUIPanels.circuitPanel.visible=!0,meshUIPanels.circControlButtonContainer.visible=!1,introBatteryModel.visible=!1,ledModel.visible=!1,capacitorModel.visible=!1,introMotorModel.visible=!1,resistorModel.visible=!1,ubecModel.visible=!1,powerDistributorModel.visible=!1,buzzerModel.visible=!1,buttonModel.visible=!1,motorDriverModel.visible=!1,batteryModel.visible=!1,dcMotorModel.visible=!1,circPanel.visible=!1,circuitLines.forEach(B=>B.visible=!1),planeCloneTracker.forEach(B=>B.visible=!1)}warningZoneTrigger1.setVFXVisible(!1),sceneSwitchTrigger.setVFXVisible(!1),panelData=[{text:"A rechargeable Li-ion battery is designed to deliver reliable performance in a compact AA cell form factor(this one here is a 9V battery in PP3 form factor), making it suitable for various applications requiring efficient power storage and delivery.",model:introBatteryModel,shouldClone:!1,position:new Vector3$1(-5.25,-.1,-8),rotation:new Vector3$1(0,0,Math.PI/2),scale:new Vector3$1(.8,.8,.8)},{text:"The RGB Common Anode LED is a bright, efficient, and versatile lighting option for creative projects. Its low power use and compact size make it ideal for everything from simple indicators to colorful decorative setups. Easy to install and durable, it's a great choice for adding vibrant light to any design.",model:ledModel,shouldClone:!0,position:new Vector3$1(-5.25,-.5,-8),scale:new Vector3$1(.6,.6,.6)},{text:"The capacitor is a key passive component that stores and releases electrical energy. It charges and discharges quickly, making it useful for smoothing voltage, filtering signals, and timing tasks. Commonly found in power supplies, audio systems, and oscillators, it is essential in many electronic circuits.",model:capacitorModel,shouldClone:!0,rotation:new Vector3$1(0,0,Math.PI/2)},{text:"The DC motor converts electrical energy into mechanical motion using electromagnetic force. With parts like a rotor and stator, it spins when current flows through its windings. Compact and reliable, it is widely used in robotics, fans, and other systems needing controlled motion.",model:introMotorModel,shouldClone:!1,position:new Vector3$1(-4.95,-.15,-7),rotation:new Vector3$1(0,Math.PI/2,0),scale:new Vector3$1(.7,.7,.7)},{text:"Fixed-value resistors are essential components that limit current and drop voltage in a circuit. They help protect components, set operating points, and shape signals. Found in nearly all electronics, they are key in power control, LED circuits, filters, and logic systems.",model:resistorModel,shouldClone:!0,position:new Vector3$1(-4.96,-.17,-7)},{text:"The UBEC (Universal Battery Elimination Circuit) is a compact voltage regulator that supplies stable, lower voltage from higher-voltage batteries. It is commonly used in RC models and robotics to safely power controllers, sensors, and receivers. With high efficiency and built-in protection, a UBEC ensures your devices get consistent power without overloading.",model:ubecModel,shouldClone:!1,position:new Vector3$1(-4.96,-.14,-7),scale:new Vector3$1(.008,.008,.008)},{text:"The Power Distributor splits power from a single source to multiple components. It ensures stable voltage delivery across circuits and prevents overloads.",model:powerDistributorModel,shouldClone:!1,position:new Vector3$1(-4.96,-.14,-7),scale:new Vector3$1(.005,.005,.005)},{text:"The Motor Driver is an electronic component that controls the speed and direction of a DC motor. It receives signals from a microcontroller and adjusts the power supplied to the motor, allowing for precise control in robotics and automation.",model:motorDriverModel,shouldClone:!1,position:new Vector3$1(-4.96,-.14,-7),scale:new Vector3$1(.005,.005,.005)},{text:"A buzzer is an electronic device that produces sound when an electric current passes through it. It is commonly used in alarms, timers, and notification systems to alert users with audible signals.",model:buzzerModel,shouldClone:!1,position:new Vector3$1(-4.96,-.1,-7),scale:new Vector3$1(.008,.008,.008)},{text:"A button is a simple mechanical or electronic switch that allows users to control devices by pressing it. It can be used to start, stop, or change the state of an electronic circuit, making it a fundamental component in user interfaces.",model:buttonModel,shouldClone:!1,position:new Vector3$1(-4.96,-.14,-7),scale:new Vector3$1(.005,.005,.005)}],meshUIPanels=new MeshUIPanels(scene$5,panelData,m,_,showSceneObjective),objsToTest=meshUIPanels.getObjsToTest(),questionnairePanel=new QuestionnaireUI(scene$5,{x:-3.75,y:.5,z:8.8},{x:0,y:Math.PI,z:0}),questionnairePanel.hide();function S(){var B,b;if(console.log("Switching to Electro Focus"),viewCam.position.set(-3.75,0,-2),viewCam.lookAt(-3.75,0,-15),disablePlayerControls(),currentCamera=viewCam,controls$5.enabled=!1,introCompleted=!0,hideObjective(),(B=allAssets$4.audios)!=null&&B.walk){let z=allAssets$4.audios.walk;z.isPlaying&&z.stop()}if((b=allAssets$4.audios)!=null&&b.run){let z=allAssets$4.audios.run;z.isPlaying&&z.stop()}}function C(){disablePlayerControls(),currentCamera=electroExplaination,electroExplaination.position.set(-24,-.5,0),electroExplaination.lookAt(electro.position),electroExplaination.rotation.set(0,Math.PI/2,0)}function A(){console.log("Switching to Circuit Cam"),circuitCam.position.set(-3.75,.5,5.7),isQuizSubmitted?(circuitCam.lookAt(-3.76,-1,7.675),questionnairePanel.hide()):(circuitCam.rotation.set(0,Math.PI,0),i=!0,questionnairePanel.loadQuestions(),setTimeout(()=>{i=!1,console.log("Panel loading complete, clicks enabled")},500)),currentCamera=circuitCam,controls$5.enabled=!1,disablePlayerControls(),hideObjective()}function E(){console.log("Switching to Gate View Cam"),gateViewCam.position.set(-20,2,0),gateViewCam.lookAt(-50,0,0),currentCamera=gateViewCam,controls$5.enabled=!1,disablePlayerControls(),[meshUIPanels.button,meshUIPanels.circBackButton].forEach(B=>{B&&(B.traverse(b=>{b.userData&&(b.userData.clickable=!1,b.userData.parentButton=null)}),B.parent&&B.parent.remove(B),B.setState("idle"))}),[meshUIPanels.circControlButtonContainer,meshUIPanels.circuitPanel].forEach(B=>{B&&B.parent&&B.parent.remove(B)}),scene$5.remove(circPanel),scene$5.remove(batteryModel),scene$5.remove(ledModel),scene$5.remove(capacitorModel),scene$5.remove(resistorModel),scene$5.remove(dcMotorModel),scene$5.remove(ubecModel),scene$5.remove(powerDistributorModel),scene$5.remove(buzzerModel),scene$5.remove(buttonModel),scene$5.remove(motorDriverModel),scene$5.remove(lockPlane),scene$5.remove(pointLight),circuitLines.forEach(B=>{scene$5.remove(B),B.geometry&&B.geometry.dispose(),B.material&&B.material.dispose()}),circuitLines.length=0,showSceneObjective(3)}controls$5=new OrbitControls(camera$4,renderer$6.domElement),controls$5.minDistance=1,controls$5.dampingFactor=.05,controls$5.maxPolarAngle=Math.PI/2,sceneInitialization$4=initializePhysicsAndPlayer(mainModel,{position:{x:0,y:-2,z:0},rotation:{x:0,y:0,z:0}},["portal_physics","circPanel","batteryModel","ledModel","capacitorModel","resistorModel","dcMotorModel","Cube005","table","lockPlane"],scene$5,camera$4,controls$5);function k(){gateMesh&&(Array.isArray(gateMesh.material)?gateMesh.material.forEach(B=>{B.transparent=!0}):gateMesh.material.transparent=!0,gsapWithCSS.to(l.uniforms.uOpacity,{value:0,duration:2,ease:"power2.out",onComplete:()=>{gateMesh.geometry.dispose(),gateMesh.material.dispose(),gateMesh.parent.remove(gateMesh),console.log("Gate removed from scene."),currentCamera=camera$4,controls$5.enabled=!0,enablePlayerControls()}}))}pointerDownHandler=()=>{meshUIPanels.setSelectState(!0)},pointerUpHandler=()=>{meshUIPanels.setSelectState(!1)},mouseMoveHandler=B=>{const b=renderer$6.domElement.getBoundingClientRect();mouse.x=(B.clientX-b.left)/b.width*2-1,mouse.y=-((B.clientY-b.top)/b.height)*2+1,currentCamera==circuitCam&&questionnairePanel&&questionnairePanel.updateHoverStates(mouse,currentCamera)};const I=()=>{var K,ne;if(currentCamera!==circuitCam||!questionnairePanel||i)return;questionnairePanel.raycaster.setFromCamera(mouse,currentCamera);const B=(K=questionnairePanel.panel)==null?void 0:K.visible,b=(ne=questionnairePanel.summaryPanel)==null?void 0:ne.visible;if(!B&&!b)return;const z=B?questionnairePanel.interactableBlocks:questionnairePanel.interactableBlocksSummary,N=questionnairePanel.raycaster.intersectObjects(z,!0);if(N.length===0)return;const G=questionnairePanel.findParentBlock(N[0].object);if(G){if(B&&!G.userData.locked){const J=G.userData.index;questionnairePanel.handleOptionSelect(J),setTimeout(()=>{questionnairePanel.getNextQuestion()||(console.log("Quiz completed!"),questionnairePanel.hide(),questionnairePanel.setupSummaryPanel(),questionnairePanel.showSummary())},1e3)}else if(b){const J=G.userData.type;J==="submit"?(circuitCam.lookAt(-3.76,-1,7.675),isQuizSubmitted=!0,questionnairePanel.hideSummary(),window.dispatchEvent(new CustomEvent("quizSubmitted")),console.log("Quiz submitted!")):J==="rewatch"&&(currentCamera=camera$4,_(),showSceneObjective(4),questionnairePanel.hideSummary())}}};windowResizeHandler=resizeHandler$4,window.addEventListener("loadingScreenHidden-scene4",()=>{console.log("Loading screen hidden - Scene4 is ready!"),skipButtonInitialized||(createSkipButton(T),skipButtonInitialized=!0),showSkipButton(),isSequenceSkipped=!1,disablePlayerControls(),currentCamera=electroViewCam,wakeup.play(),playAudio("electroFirstAudio")}),window.addEventListener("audioComplete-electroFirstAudio",()=>{isSequenceSkipped||(stopAudio("electroFirstAudio"),setTimeout(()=>{if(isSequenceSkipped)return;const B=allAssets$4.audios.eIntroFinal,b=B.context.currentTime;playAudio("eIntroFinal");const z=setInterval(()=>{if(isSequenceSkipped){clearInterval(z),pauseAudio("eIntroFinal");return}B.context.currentTime-b>=7&&(pauseAudio("eIntroFinal"),clearInterval(z),electroReach.setLoop(LoopOnce),electroReach.clampWhenFinished=!0,electroReach.reset(),electroReach.timeScale=1,electroReach.getMixer().addEventListener("finished",F),electroReach.play())},100)},2e3),electro.position.set(-26.5,-2,0),wakeup.stop(),electroShapekey==null||electroShapekey.startAnimation(),electroIdle.play(),C())}),window.addEventListener("audioComplete-eIntroFinal",()=>{if(isSequenceSkipped)return;stopAudio("eIntroFinal"),electroExplain.stop(),keyPadPlane?(keyPadPlane.material.opacity=1,keyPadPlane.material.needsUpdate=!0,scene$5.add(keyPadPlane)):console.warn("keyPadPlane not initialized"),zoePlane&&zoeTex&&zoeVideo?(zoePlane.material.uniforms.videoTexture.value=zoeTex,zoePlane.material.opacity=1,zoePlane.material.needsUpdate=!0,scene$5.add(zoePlane),zoeVideo.play().catch(z=>console.error("Failed to play zoe video:",z))):console.warn("zoePlane, zoeTex, or zoeVideo not initialized"),electroType.setLoop(LoopOnce),electroType.clampWhenFinished=!0,electroType.reset().play();const B=electroExplaination.position.clone();isMovingCameraToTarget=!0,gsapWithCSS.to(electroExplaination.position,{x:B.x-2,z:B.z-2,duration:.8,ease:"power2.inOut",onComplete:()=>{isMovingCameraToTarget=!1,electroExplaination.position.set(B.x-2,B.y,B.z-2)}}),electroMixer.addEventListener("finished",b);function b(z){isSequenceSkipped||z.action===electroType&&(electroMixer.removeEventListener("finished",b),electroIdle.reset().play(),isMovingCameraBack=!0,gsapWithCSS.timeline().to(electroExplaination.position,{x:-24,y:-.5,z:0,duration:.8,ease:"power2.inOut",onComplete:()=>{gsapWithCSS.to(electroExplaination.rotation,{y:13*Math.PI/18,duration:2,ease:"power2.inOut"})}}).to(electro.rotation,{y:7*Math.PI/6,duration:2,ease:"power2.inOut"},.2).call(()=>{isMovingCameraBack=!1,C(),keyPadPlane&&scene$5.remove(keyPadPlane)}))}setTimeout(()=>{playAudio("electroCall")},5e3)}),window.addEventListener("audioComplete-electroCall",()=>{isSequenceSkipped||(stopAudio("electroCall"),setTimeout(()=>{zoePlane&&(zoePlane.material.opacity=0,scene$5.remove(zoePlane),zoeVideo&&zoeVideo.pause()),dTwinPlane&&dTwinTex&&dTwinVideo?(dTwinPlane.material.uniforms.videoTexture.value=dTwinTex,dTwinPlane.material.opacity=1,dTwinPlane.material.needsUpdate=!0,scene$5.add(dTwinPlane),dTwinVideo.play().catch(b=>console.error("Failed to play dTwin video:",b))):console.warn("dTwinPlane, dTwinTex, or dTwinVideo not initialized"),gsapWithCSS.timeline().to(electroExplaination.rotation,{y:5*Math.PI/12,duration:2,ease:"power2.inOut"},.5).to(electro.rotation,{y:23*Math.PI/12,duration:2,ease:"power2.inOut"},.7),playAudio("digiTwinConvo")},2e3))}),window.addEventListener("audioComplete-digiTwinConvo",()=>{isSequenceSkipped||(stopAudio("digiTwinConvo"),playAudio("digiTwinEnd"))}),window.addEventListener("audioComplete-digiTwinEnd",()=>{isSequenceSkipped||(stopAudio("digiTwinEnd"),D())}),window.addEventListener("audioComplete-electroCorrectCircuit",()=>{stopAudio("electroCorrectCircuit"),playAudio("electroGateOpen")}),window.addEventListener("keydown",handleKeyPress$3),window.addEventListener("mousedown",windowMouseDownHandler,!1),window.addEventListener("pointerdown",pointerDownHandler),window.addEventListener("pointerup",pointerUpHandler),window.addEventListener("mousemove",mouseMoveHandler),window.addEventListener("click",I),window.addEventListener("resize",windowResizeHandler);function F(B){if(!isSequenceSkipped&&B.action===electroReach){electroReach.getMixer().removeEventListener("finished",F),console.log("electroReach forward finished, time:",electroReach.time);const b=electroReach.getClip().duration;electroReach.time=b,electroReach.timeScale=-1,electroReach.setLoop(LoopOnce),electroReach.clampWhenFinished=!0,electroReach.paused=!1,console.log("Playing electroReach reverse, time:",electroReach.time),electroReach.getMixer().addEventListener("finished",M),electroReach.play()}}function M(B){isSequenceSkipped||B.action===electroReach&&(electroReach.getMixer().removeEventListener("finished",M),gsapWithCSS.to(electro.rotation,{y:Math.PI/2,duration:2,ease:"power2.inOut",onComplete:()=>{playAudio("eIntroFinal"),electroIdle.stop(),electroExplain.play()}}),electroIdle.reset().play())}let R=new AmbientLight(16777215,.5);scene$5.add(R),console.log(scene$5);let O=new DirectionalLight(16777215,2);directionalLight1=new DirectionalLight(16777215,1),O.castShadow=!0,O.position.set(60,55,0),O.shadow.bias=-.001,O.shadow.normalBias=.1,O.shadow.radius=4,directionalLight1.shadow.bias=-.001,directionalLight1.shadow.normalBias=.1,directionalLight1.shadow.radius=4;let $=O.shadow.camera;if($.near=20,$.far=300,$.left=-100,$.right=100,$.top=100,$.bottom=-100,O.shadow.mapSize.width=4096,O.shadow.mapSize.height=4096,e){const B=[];initializeVR(renderer$6,scene$5,camera$4,sceneInitialization$4.playerFunction.player,sceneInitialization$4.playerFunction.actions,B,()=>{console.log("VR button clicked")}),collisionMesh$3=allAssets$4.models.gltf.main,setCollisionMesh(collisionMesh$3),enablePlayerMovement(sceneInitialization$4.playerFunction.player)}function T(){t||isSequenceSkipped||(console.log("Intro sequence skipped by user."),isSequenceSkipped=!0,gsapWithCSS.killTweensOf(electro.rotation),gsapWithCSS.killTweensOf(electroExplaination.position),gsapWithCSS.killTweensOf(electroExplaination.rotation),electroReach&&gsapWithCSS.killTweensOf(electroReach),stopAudio("electroFirstAudio"),stopAudio("eIntroFinal"),stopAudio("electroCall"),stopAudio("digiTwinConvo"),stopAudio("digiTwinEnd"),electroMixer&&electroMixer.stopAllAction(),[wakeup,headUp,electroIdle,electroType,electroExplain,electroReach].forEach(B=>{B&&B.isRunning()&&B.stop()}),electroShapekey&&electroShapekey.stopAnimation(),hideSkipButton(),D())}function D(){var B,b,z,N;dTwinPlane&&scene$5&&(scene$5.remove(dTwinPlane),dTwinPlane.geometry&&dTwinPlane.geometry.dispose(),(b=(B=dTwinPlane.material.uniforms)==null?void 0:B.videoTexture)!=null&&b.value&&dTwinPlane.material.uniforms.videoTexture.value.dispose(),dTwinPlane.material.dispose(),dTwinPlane=null),dTwinVideo&&dTwinVideo.parentNode&&(dTwinVideo.pause(),dTwinVideo.src="",dTwinVideo.parentNode.removeChild(dTwinVideo),dTwinVideo=null),window.dTwinVideoElement=null,window.dTwinVideoTexture=null,zoePlane&&scene$5&&(scene$5.remove(zoePlane),zoePlane.geometry&&zoePlane.geometry.dispose(),(N=(z=zoePlane.material.uniforms)==null?void 0:z.videoTexture)!=null&&N.value&&zoePlane.material.uniforms.videoTexture.value.dispose(),zoePlane.material.dispose(),zoePlane=null),zoeVideo&&zoeVideo.parentNode&&(zoeVideo.pause(),zoeVideo.src="",zoeVideo.parentNode.removeChild(zoeVideo),zoeVideo=null),window.zoeVideoElement=null,window.zoeVideoTexture=null,scene$5.remove(keyPadPlane,electroExplaination,electroViewCam,introRoomCam),electro.position.set(-26.5,-2,-2),electro.rotation.set(0,Math.PI/2,0),electroShapekey&&electroShapekey.stopAnimation(),electroMixer&&electroMixer.stopAllAction(),electroIdle&&electroIdle.reset().play(),currentCamera=camera$4,enablePlayerControls(),createMinimap$3(scene$5,sceneInitialization$4),showSceneObjective(1),hideSkipButton(),isSequenceSkipped=!0}function P(){if(s.modeSelected==="vr")renderer$6.setAnimationLoop(L);else{let B=function(){if(!camera$4){cancelAnimationFrame(animationFrameId$4);return}animationFrameId$4=requestAnimationFrame(B),L()};B()}}function L(){var N,G,K;if(!camera$4||!currentCamera)return;(isMovingCameraToTarget||isMovingCameraBack)&&electroExplaination.lookAt(-26.5,-2,0),currentCamera!==circuitCam||isQuizSubmitted||(N=questionnairePanel.summaryPanel)!=null&&N.visible?questionnairePanel.hide():questionnairePanel.show(),updateMinimap$3(),meshUIPanels.updateButtons(mouse,currentCamera,renderer$6),meshUIPanels.updateButtons(mouse,currentCamera,renderer$6),__webpack_exports__default.update();let B=clock$1.getDelta();const b=clock$1.getElapsedTime();l.uniforms.uTime.value=b,electroMixer.update(B),meshUIPanels.updateAnimation(b);const z=(G=sceneInitialization$4==null?void 0:sceneInitialization$4.playerFunction)==null?void 0:G.player;if(currentModel){currentModel.renderOrder=2;let ne=.05*Math.sin(b*2);currentModel.position.y=currentModel.userData.baseY+ne,currentModel.rotation.y+=.01}if(lockPlane.renderOrder=1,currentCamera==circuitCam||currentCamera==viewCam?z.visible=!1:z.visible=!0,applyDistanceFade(lockPlane,z,2.5,3.5),introCompleted&&(scene$5.remove(lockPlane),!objsToTest.includes(meshUIPanels.button)&&!o&&(objsToTest.push(meshUIPanels.button),o=!0)),infoZoneTrigger&&z&&infoZoneTrigger.updateQuarksScene(B,z),warningZoneTrigger1&&z&&warningZoneTrigger1.updateQuarksScene(B,z),sceneSwitchTrigger&&z&&sceneSwitchTrigger.updateQuarksScene(B,z),s.modeSelected==="vr"?updateVR():controls$5&&controls$5.update(),(K=sceneInitialization$4==null?void 0:sceneInitialization$4.playerFunction)!=null&&K.player){const ne=sceneInitialization$4.playerFunction.player;ne.updateMatrixWorld(),collisionMesh$3&&handleCollisions(ne,collisionMesh$3,playerState.velocity,B),playerState.velocity.length()>0&&(ne.position.x+=playerState.velocity.x*B,ne.position.z+=playerState.velocity.z*B,playerState.onGround||(ne.position.y+=playerState.velocity.y*B))}renderer$6.render(scene$5,currentCamera)}return P(),resizeHandler$4=()=>{const B=window.innerWidth/window.innerHeight;camera$4&&renderer$6&&(camera$4.aspect=B,camera$4.updateProjectionMatrix(),renderer$6.setSize(window.innerWidth,window.innerHeight))},window.addEventListener("resize",resizeHandler$4),{scene:scene$5,camera:camera$4,renderer:renderer$6,controls:controls$5}}function cleanupScene4(){if(isSequenceSkipped=!0,hideSkipButton(),stopAudio("electroFirstAudio"),stopAudio("eIntroFinal"),stopAudio("electroCall"),stopAudio("digiTwinConvo"),stopAudio("digiTwinEnd"),isSceneTransitioning$4=!1,isSceneTransitioning$4=!1,cleanupAudioManager(),cleanupObjectives(),cleanupMinimap$3(),cleanupGUIControls(),window.removeEventListener("resize",windowResizeHandler),window.removeEventListener("keydown",handleKeyPress$3),window.removeEventListener("mousedown",windowMouseDownHandler),window.removeEventListener("pointerdown",pointerDownHandler),window.removeEventListener("pointerup",pointerUpHandler),window.removeEventListener("mousemove",mouseMoveHandler),window.removeEventListener("loadingScreenHidden-scene4",null),window.removeEventListener("audioComplete-electroFirstAudio",null),window.removeEventListener("audioComplete-eIntroFinal",null),window.removeEventListener("audioComplete-electroCall",null),window.removeEventListener("audioComplete-digiTwinConvo",null),window.removeEventListener("audioComplete-digiTwinEnd",null),windowResizeHandler=null,windowMouseDownHandler=null,pointerDownHandler=null,pointerUpHandler=null,mouseMoveHandler=null,cleanupDragControls(),animationFrameId$4&&(cancelAnimationFrame(animationFrameId$4),animationFrameId$4=null),renderer$6&&renderer$6.setAnimationLoop(null),cleanupVR(),sceneInitialization$4&&(sceneInitialization$4.cleanUpCollider(),sceneInitialization$4=null),[infoZoneTrigger,warningZoneTrigger1,sceneSwitchTrigger].forEach(n=>{n&&(n.removeParticleEffects(),n=null)}),dTwinVideo&&dTwinVideo.parentNode&&(dTwinVideo.pause(),dTwinVideo.src="",dTwinVideo.parentNode.removeChild(dTwinVideo),dTwinVideo=null,console.log("dTwinVideo removed from DOM")),dTwinTex&&(dTwinTex.dispose(),dTwinTex=null,console.log("dTwinTex disposed")),window.dTwinVideoElement=null,window.dTwinVideoTexture=null,[zoePlane,dTwinPlane].forEach(n=>{var e,t;n&&scene$5&&(scene$5.remove(n),n.geometry&&n.geometry.dispose(),n.material&&((t=(e=n.material.uniforms)==null?void 0:e.videoTexture)!=null&&t.value&&n.material.uniforms.videoTexture.value.dispose(),n.material.dispose()),n=null,console.log("Plane removed and disposed"))}),[baseColorTex,portalTex,alphaTex,lockTex,batteryTex,capacitorTex,ledTex,motorTex,resistorTex,keyBoardTex].forEach(n=>{n&&(n.dispose(),n=null)}),planeTextures.length=0,circuitLines.forEach(n=>{n&&(scene$5.remove(n),n.geometry&&n.geometry.dispose(),n.material&&n.material.dispose())}),circuitLines.length=0,planeCloneTracker.forEach(n=>{n&&(scene$5.remove(n),n.geometry&&n.geometry.dispose(),n.material&&n.material.dispose())}),planeCloneTracker.length=0,planeMaterialTracker.forEach(n=>{n&&n.dispose()}),planeMaterialTracker.length=0,fakeGlowMaterial&&(fakeGlowMaterial.dispose(),fakeGlowMaterial=null),gateMesh&&(gateMesh.material&&(Array.isArray(gateMesh.material)?gateMesh.material.forEach(n=>n.dispose()):gateMesh.material.dispose()),gateMesh.geometry&&gateMesh.geometry.dispose(),gateMesh=null),[circuitPanel,button,prevButton,nextButton,backButton,circBackButton,infoMainPanel,controlButtonContainer,circControlButtonContainer,contentBlock,leftSubBlock,rightSubBlock,keyPadPlane,circPanel,gatePlane,lockPlane].forEach(n=>{n&&(n.parent&&n.parent.remove(n),n.geometry&&n.geometry.dispose(),n.material&&(Array.isArray(n.material)?n.material.forEach(e=>{e.map&&e.map.dispose(),e.dispose()}):(n.material.map&&n.material.map.dispose(),n.material.dispose())),n=null)}),[mainModel,batteryModel,introBatteryModel,ledModel,capacitorModel,resistorModel,dcMotorModel,introMotorModel,ubecModel,powerDistributorModel,buzzerModel,buttonModel,motorDriverModel,electro,ledGlowClone].forEach(n=>{n&&(scene$5.remove(n),n.traverse(e=>{e.isMesh&&(e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(t=>{t.map&&t.map.dispose(),t.dispose()}):(e.material.map&&e.material.map.dispose(),e.material.dispose())))}),n=null)}),questionnairePanel&&(questionnairePanel.cleanup(),questionnairePanel=null),meshUIPanels&&(meshUIPanels.cleanup(),meshUIPanels=null),electroShapekey&&(electroShapekey.stopAnimation(),electroShapekey=null),electroMixer&&(electroMixer.stopAllAction(),electroMixer=null),[wakeup,headUp,electroIdle,electroType,electroExplain,electroReach].forEach(n=>{n&&(n.stop(),n=null)}),[pointLight,directionalLight1].forEach(n=>{n&&(scene$5.remove(n),n.dispose(),n=null)}),scene$5){for(scene$5.environment=null,scene$5.background=null;scene$5.children.length>0;)scene$5.remove(scene$5.children[0]);scene$5.traverse(n=>{n.geometry&&n.geometry.dispose(),n.material&&(Array.isArray(n.material)?n.material.forEach(e=>{e.map&&e.map.dispose(),e.dispose()}):(n.material.map&&n.material.map.dispose(),n.material.dispose()))}),scene$5=null}[camera$4,circuitCam,gateViewCam,electroViewCam,electroExplaination,introRoomCam,viewCam].forEach(n=>{n&&(n.clear(),n=null)}),currentCamera=null,controls$5&&(controls$5.dispose(),controls$5=null),activeWireGlows=[],circuitLines=[],objsToTest=[],connections=[],wireGlowPoints=[],planeTextures=[],planeCloneTracker=[],planeMaterialTracker=[],objectToPlaneMap={},occupiedPositions.clear(),clock$1=null,mouse.set(0,0),currentModel=null,introCompleted=!1,physicsSet=!1,isQuizSubmitted=!1,isMovingCameraBack=!1,isMovingCameraToTarget=!1,console.log("Scene 4 cleanup completed")}let container$2,canvas$2,ctx$2,toggleBtn$2,visible$2=!1,physicsController$2,backgroundPattern$2=null;const markers$2=[{type:"friend",color:"#ffffff",size:8,position:{x:75,y:-5.5,z:-60}},{type:"hoverboard",color:"#00ff00",size:8,position:{x:-15,y:1.9,z:-142}}],playerMarker$2={color:"#00f6ff",size:6};function drawMarkerSymbol$2(n,e){switch(n.save(),n.strokeStyle=e.color,n.fillStyle=e.color,n.lineWidth=2,n.shadowColor=e.color,n.shadowBlur=10,e.type){case"friend":n.beginPath(),n.arc(0,0,e.size*.7,0,Math.PI*2),n.stroke(),n.beginPath(),n.arc(-e.size*.8,-e.size*.8,2,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(e.size*.8,-e.size*.8,2,0,Math.PI*2),n.fill();break;case"hoverboard":n.fillRect(-e.size*.5,-e.size*.2,e.size,e.size*.4),n.beginPath(),n.arc(-e.size*.3,e.size*.2,1.5,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(e.size*.3,e.size*.2,1.5,0,Math.PI*2),n.fill();break;case"portal":n.setLineDash([4,4]),n.strokeStyle="#fff";for(const t of[e.size*.6,e.size])n.beginPath(),n.arc(0,0,t,Math.PI*.2,Math.PI*1.8),n.stroke();break}n.restore()}function drawSciFiMarker$2(n,e,t,o){n.save(),n.translate(e,t);const i=(Math.sin(performance.now()*.004)+1)/2;n.fillStyle=o.color+"33",n.beginPath(),n.arc(0,0,o.size+2+i*2,0,Math.PI*2),n.fill(),drawMarkerSymbol$2(n,o),n.restore()}function drawPlayerChevron$2(n){n.save(),n.fillStyle=playerMarker$2.color,n.strokeStyle="#ffffff",n.lineWidth=1.5,n.shadowColor=playerMarker$2.color,n.shadowBlur=18,n.beginPath(),n.moveTo(0,-15),n.lineTo(9,9),n.lineTo(0,4),n.lineTo(-9,9),n.closePath(),n.fill(),n.stroke(),n.restore()}function createBackgroundGrid$2(){const n=document.createElement("canvas"),e=n.getContext("2d"),t=40;return n.width=t,n.height=t,e.strokeStyle="rgba(0, 179, 215, 0.58)",e.lineWidth=.5,e.beginPath(),e.moveTo(0,t),e.lineTo(t,0),e.moveTo(0,0),e.lineTo(t,t),e.stroke(),n}function createMinimap$2(n,e,t,o){physicsController$2=e,container$2=document.createElement("div"),container$2.id="minimap-container",document.body.appendChild(container$2),canvas$2=document.createElement("canvas"),canvas$2.id="minimap-canvas",canvas$2.width=210,canvas$2.height=210,container$2.appendChild(canvas$2),ctx$2=canvas$2.getContext("2d"),toggleBtn$2=document.createElement("button"),toggleBtn$2.id="minimap-toggle",toggleBtn$2.textContent="Hide Map",document.body.appendChild(toggleBtn$2),toggleBtn$2.addEventListener("click",()=>{visible$2=!visible$2,container$2.classList.toggle("visible"),toggleBtn$2.textContent=visible$2?"Hide Map":""});const i=createBackgroundGrid$2();backgroundPattern$2=ctx$2.createPattern(i,"repeat"),setTimeout(()=>{visible$2=!0,container$2.classList.add("visible")},1200)}function updateMinimap$2(){var u;if(!visible$2||!ctx$2||!((u=physicsController$2==null?void 0:physicsController$2.playerFunction)!=null&&u.player))return;const n=physicsController$2.playerFunction.player,e=canvas$2.width/2,t=canvas$2.height/2,o=e-2,i=2.5;ctx$2.clearRect(0,0,canvas$2.width,canvas$2.height),ctx$2.save(),ctx$2.beginPath(),ctx$2.arc(e,t,o,0,Math.PI*2),ctx$2.clip(),ctx$2.translate(e,t),ctx$2.rotate(n.rotation.y);const s=-(n.position.x*i),r=-(n.position.z*i);ctx$2.translate(s,r),ctx$2.fillStyle=backgroundPattern$2,ctx$2.fillRect(-e-s,-t-r,canvas$2.width,canvas$2.height),ctx$2.restore();const a=performance.now(),l=a*.002%(Math.PI*2),c=ctx$2.createRadialGradient(e,t,0,e,t,o);c.addColorStop(0,"rgba(0, 255, 255, 0.25)"),c.addColorStop(1,"rgba(0, 255, 255, 0)"),ctx$2.fillStyle=c,ctx$2.beginPath(),ctx$2.moveTo(e,t),ctx$2.arc(e,t,o,l-.3,l+.3),ctx$2.closePath(),ctx$2.fill();const d=(Math.sin(a*.002)+1)/2;ctx$2.strokeStyle=`rgba(0, 255, 255, ${.3-d*.3})`,ctx$2.lineWidth=2,ctx$2.beginPath(),ctx$2.arc(e,t,o*d,0,Math.PI*2),ctx$2.stroke(),ctx$2.save(),ctx$2.translate(e,t),ctx$2.rotate(n.rotation.y);for(const f of markers$2){const h=f.position.x-n.position.x,m=f.position.z-n.position.z,p=h*i,v=m*i;Math.hypot(p,v)<o&&drawSciFiMarker$2(ctx$2,p,v,f)}ctx$2.restore(),ctx$2.save(),ctx$2.translate(e,t),drawPlayerChevron$2(ctx$2),ctx$2.restore()}function cleanupMinimap$2(){toggleBtn$2&&(toggleBtn$2.removeEventListener("click",toggleBtn$2.onclick||toggleBtn$2._listener),toggleBtn$2.innerHTML=""),container$2&&(container$2.innerHTML="",container$2.remove()),toggleBtn$2&&toggleBtn$2.parentNode&&toggleBtn$2.parentNode.removeChild(toggleBtn$2),backgroundPattern$2&&backgroundPattern$2.image&&(backgroundPattern$2.image=null),container$2=null,canvas$2=null,ctx$2=null,toggleBtn$2=null,visible$2=!1,backgroundPattern$2=null}function applyNPCConfigurations(n,e,t=[]){if(!e||!n||!t||t.length===0)return;const o=n.models.gltf,i=n.models.animations,s=n.jsonFiles;for(let r=0;r<t.length;r++){const{npcIndex:a,pathName:l,modelName:c,modelAction:d,speed:u}=t[r];if(typeof u=="number"){const m=e.getNPC&&e.getNPC(a);m&&(m.speed=u)}const f=typeof l=="string"?{pathName:l,offsetX:0,offsetY:0,offsetZ:0}:l||{},h=f.pathName?s[f.pathName]:null;if(h&&h.points){const m=f.offsetX||0,p=f.offsetY||0,v=f.offsetZ||0;if(m||p||v){const g=new Array(h.points.length);for(let y=0;y<h.points.length;y++){const w=h.points[y];g[y]={x:w.x+m,y:w.y+p,z:w.z+v}}e.setPath(a,g)}else e.setPath(a,h.points)}if(c&&o[c]){const p=o[c].clone(!0);p.position.set(0,0,0),p.scale.set(1,1,1),e.attachModel(a,p);const v=i[c];if(v&&v.actions){const g=v.actions[d]||Object.values(v.actions)[0],y=g&&(g._clip||g.getClip&&g.getClip());if(y){const w=new AnimationMixer(p);e.setAnimation(a,w,w.clipAction(y))}}}}}function setupNPCsForScene3(n,e){if(!e||!n)return;applyNPCConfigurations(n,e,[{npcIndex:0,pathName:"path1",modelName:"flyingBot",modelAction:"Scene",speed:.6},{npcIndex:1,pathName:"path2",modelName:"flyingBot",modelAction:"Scene",speed:.6},{npcIndex:2,pathName:"path3",modelName:"flyingBot",modelAction:"Scene",speed:.6},{npcIndex:3,pathName:"path4",modelName:"flyingBot",modelAction:"Scene",speed:.6},{npcIndex:4,pathName:"path5",modelName:"flyingBot",modelAction:"Scene",speed:.6},{npcIndex:5,pathName:{pathName:"path1",offsetX:-3,offsetY:0,offsetZ:-3},modelName:"flyingBot",modelAction:"Scene"},{npcIndex:6,pathName:{pathName:"path2",offsetX:-3,offsetY:0,offsetZ:-3},modelName:"flyingBot",modelAction:"Scene"},{npcIndex:7,pathName:{pathName:"path3",offsetX:-3,offsetY:0,offsetZ:-3},modelName:"flyingBot",modelAction:"Scene"},{npcIndex:8,pathName:{pathName:"path4",offsetX:-3,offsetY:0,offsetZ:-3},modelName:"flyingBot",modelAction:"Scene"},{npcIndex:9,pathName:{pathName:"path5",offsetX:-3,offsetY:0,offsetZ:-3},modelName:"flyingBot",modelAction:"Scene"}])}let scene$4,camera$3,renderer$5,controls$4,light,ambLight,batchSystemRef,interiorModel,animationFrameId$3=null,collisionMesh$2,sceneInitialization$3,clock,userInfo,isSceneTransitioning$3=!1,backgroundAudio$1,hudVideoPlane=null,npcSystem,resizeHandler$3=null;function handleKeyPress$2(n){if(n.key.toLowerCase()==="y"&&!isSceneTransitioning$3){isSceneTransitioning$3=!0;const e=renderer$5.xr.getSession(),t=o=>{markSceneCompleted$5("scene3"),cleanupMainFallingSequence(),window.removeEventListener("keydown",handleKeyPress$2),sceneInitialization$3&&sceneInitialization$3.cleanUpCollider(),cleanupScene3(),checkExistingAssets(assetsEntry$5),initializeScene4(renderer$5,o).finally(()=>{isSceneTransitioning$3=!1})};e?e.end().then(()=>{t(!0)}).catch(o=>{console.error("Error ending VR session:",o),isSceneTransitioning$3=!1}):t(!1)}}async function initializeScene3(n,e){var i;if(setCurrentScene("scene3"),userInfo=getUserInfo(),animationFrameId$3&&(cancelAnimationFrame(animationFrameId$3),animationFrameId$3=null),camera$3=new PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),camera$3.position.set(0,0,-3),renderer$5=n||initializeRenderer(),renderer$5.toneMapping=CineonToneMapping,renderer$5.toneMappingExposure=.5,renderer$5.setPixelRatio(Math.min(window.devicePixelRatio,2)),renderer$5.domElement.parentElement||document.body.appendChild(renderer$5.domElement),await loadAllAsset(assetsEntry$6,camera$3,renderer$5),scene$4=new Scene,scene$4.frustumCulled=!0,scene$4.background=allAssets$4.cubeMaps.scene2Cubemap,scene$4.environment=allAssets$4.cubeMaps.scene2Cubemap,console.log("Available models in assets:",Object.keys(allAssets$4.models)),console.log("GLTF models:",Object.keys(allAssets$4.models.gltf)),allAssets$4.models.gltf.underground){console.log("Found underground model in assets");const s=allAssets$4.models.gltf.underground;console.log("Underground model properties:",{position:s.position,scale:s.scale,visible:s.visible,children:((i=s.children)==null?void 0:i.length)||0}),s.position.set(-25,-135,-130),s.scale.set(250,250,250),s.visible=!0,scene$4.add(s);const r=scene$4.children.find(a=>a===s);console.log("Model added to scene:",!!r),console.log("Final underground model state:",{position:s.position,scale:s.scale,visible:s.visible,inScene:!!r})}else console.warn("Underground path model not found in assets. Available GLTF models:",Object.keys(allAssets$4.models.gltf));if(ambLight=new AmbientLight("white",.6),scene$4.add(ambLight),controls$4=new OrbitControls(camera$3,renderer$5.domElement),controls$4.enabled=!0,controls$4.dampingFactor=.05,controls$4.enableDamping=!0,sceneInitialization$3=initializePhysicsAndPlayer(allAssets$4.models.gltf.interior,{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}},["Plane007"],scene$4,camera$3,controls$4),interiorModel=allAssets$4.models.gltf.interior,interiorModel&&interiorModel.traverse(s=>{s.isMesh&&s.name==="stair_slide001"&&(s.visible=!1,console.log("Hid 'stair_slide' mesh"))}),batchSystemRef=new BatchedRenderer,scene$4.add(batchSystemRef),clock=new Clock,initializeAudioManager(camera$3,scene$4),window.addEventListener("keydown",handleKeyPress$2),window.addEventListener("loadingScreenHidden-scene3",()=>{console.log("Loading screen hidden - Scene3 is ready!"),allAssets$4.audios.background&&(backgroundAudio$1=allAssets$4.audios.background,backgroundAudio$1.play()),playAudio("scene3Intro")}),e){const s=[];initializeVR(renderer$5,scene$4,camera$3,sceneInitialization$3.playerFunction.player,sceneInitialization$3.playerFunction.actions,s,()=>{}),collisionMesh$2=allAssets$4.models.gltf.interior.collisionMesh,setCollisionMesh(collisionMesh$2),enablePlayerMovement(sceneInitialization$3.playerFunction.player)}const t=initializeZoe(scene$4,allAssets$4,camera$3,batchSystemRef,controls$4);t&&t.zoeCharacter?console.log("Zoe character initialized successfully:",{visible:t.zoeCharacter.visible,position:t.zoeCharacter.position,scale:t.zoeCharacter.scale,hasMixer:!!t.zoeMixer,hasActions:!!t.zoeActions}):console.warn("Zoe initialization failed or returned null");const o=initializeElectro$2(scene$4,allAssets$4,camera$3,controls$4);if(initializeEmergency(scene$4,allAssets$4,camera$3,interiorModel,sceneInitialization$3.playerFunction.player),initializeFadeOut(scene$4,camera$3),createMinimap$2(scene$4,sceneInitialization$3,o.electroCharacter,t.zoeCharacter),npcSystem=initializeNPCs(scene$4,10),setupNPCsForScene3(allAssets$4,npcSystem),t&&t.zoeCharacter){const s=scene$4.children.includes(t.zoeCharacter);console.log("Zoe scene verification:",{inScene:s,visible:t.zoeCharacter.visible,sceneChildrenCount:scene$4.children.length}),s||console.error("Zoe character not found in scene children!")}if(interiorModel){const s={GLASS001:"hud1",polySurface2319002:"hud1",GLASS002:"hud2",pCube294006:"hud2",pCube294002:"hud2",GLASS003:"hud2",GLASS004:"hud1",GLASS005:"hud1",GLASS006:"hud2",GLASS007:"hud2"},r={textures:{},videos:{},activeMeshes:new Map,distanceThreshold:30,maxActiveVideos:2,currentActiveVideos:0};[...new Set(Object.values(s))].forEach(f=>{const h=document.createElement("video");h.src=allAssets$4.videotextures[f].path,h.loop=!0,h.muted=!0,h.playsInline=!0,h.setAttribute("playsinline",""),h.setAttribute("webkit-playsinline",""),h.setAttribute("muted",""),h.crossOrigin="anonymous",h.preload="auto",h.autoplay=!0,h.width=256,h.height=144,h.style.transform="translateZ(0)",h.style.webkitTransform="translateZ(0)",h.play().catch(p=>console.log("Initial play prevented:",p)),r.videos[f]=h;const m=new VideoTexture(h);m.minFilter=NearestFilter,m.magFilter=LinearFilter,m.format=RGBFormat,m.generateMipmaps=!1,m.encoding=void 0,r.textures[f]=m});let l=0;const c=(f,h)=>{if(l++,l%2!==0)return;const m=f.position;h.forEach(p=>{const v=m.distanceTo(p.position),g=s[p.name],y=r.videos[g];if(v<r.distanceThreshold){if(!r.activeMeshes.has(p.name)&&r.currentActiveVideos<r.maxActiveVideos&&y.paused){const w=y.play();w!==void 0&&w.then(()=>{r.currentActiveVideos++,r.activeMeshes.set(p.name,!0),y.playbackRate=1}).catch(_=>{console.log("Play prevented:",_)})}}else r.activeMeshes.has(p.name)&&(Array.from(r.activeMeshes.keys()).filter(_=>_!==p.name&&s[_]===g&&f.position.distanceTo(scene$4.getObjectByName(_).position)<r.distanceThreshold).length===0&&!y.paused&&(y.pause(),r.currentActiveVideos--),r.activeMeshes.delete(p.name));y.paused||(r.textures[g].needsUpdate=!0)})},d=Object.keys(s),u=[];Promise.all(Object.values(r.videos).map(f=>new Promise(h=>{let m=!1;const p=()=>{m||(m=!0,h())};f.addEventListener("canplay",p,{once:!0}),f.addEventListener("loadedmetadata",()=>{f.play().finally(p)},{once:!0}),setTimeout(p,1500)}))).then(()=>{interiorModel.traverse(h=>{if(h.isMesh&&d.includes(h.name)){const m=h.geometry.clone(),p=s[h.name],v=new MeshBasicMaterial({map:r.textures[p],transparent:!0,opacity:.85,side:FrontSide,depthWrite:!1,depthTest:!0,blending:AdditiveBlending});h.geometry=m,h.material=v,h.renderOrder=1,h.frustumCulled=!0,u.push(h)}});const f=render;render=function(){c(camera$3,u),f()},Object.values(r.videos).forEach(h=>{h.paused&&h.play().catch(m=>console.log("Play attempt failed:",m))})})}if(allAssets$4.videotextures&&allAssets$4.videotextures.hudvideo1){const s=document.createElement("video");s.src=allAssets$4.videotextures.hudvideo1.path,s.loop=!0,s.muted=!0,s.playsInline=!0,s.crossOrigin="anonymous",s.autoplay=!0,s.preload="auto",s.style.display="none",document.body.appendChild(s);const r=new VideoTexture(s);r.minFilter=LinearFilter,r.magFilter=LinearFilter,r.format=RGBAFormat,r.generateMipmaps=!1;const a=new PlaneGeometry(16,9),l=new ShaderMaterial({uniforms:{videoTexture:{value:r},time:{value:0}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:`
        uniform sampler2D videoTexture;
        uniform float time;
        varying vec2 vUv;
        void main() {
          vec4 videoColor = texture2D(videoTexture, vUv);
          float intensity = (videoColor.r + videoColor.g + videoColor.b) / 3.0;
          vec3 enhancedColor = videoColor.rgb * 0.5;
          enhancedColor = clamp(enhancedColor, 0.0, 0.5);
          float alpha = smoothstep(0.15 - 0.05, 0.15 + 0.05, intensity);
          gl_FragColor = vec4(enhancedColor, alpha * videoColor.a);
        }
      `,transparent:!0,side:DoubleSide,blending:AdditiveBlending,depthWrite:!1});hudVideoPlane=new Mesh(a,l),hudVideoPlane.position.set(-45,3.5,-145),hudVideoPlane.rotation.set(0,Math.PI/2,0),hudVideoPlane.renderOrder=10,scene$4.add(hudVideoPlane),s.addEventListener("canplay",()=>{s.play()}),setTimeout(()=>{s.play().catch(()=>{})},1e3)}if(interiorModel){interiorModel.traverse(a=>{a.isMesh&&a.name==="polySurface5714001"&&(console.log("Found plane029 mesh:",a),gsapWithCSS.to(a.rotation,{y:Math.PI*2,duration:10,repeat:-1,ease:"none",onUpdate:()=>{a.rotation.z=a.rotation.z%(Math.PI*2)}}))});let s,r;interiorModel.traverse(a=>{a.isMesh&&(a.name==="Plane049"&&(s=a,s.userData.initialZ=a.position.z,console.log("Found Plane047 at initial Z:",a.position.z)),a.name==="Plane050"&&(r=a,r.userData.initialZ=a.position.z,console.log("Found Plane050 at initial Z:",a.position.z)))}),s&&gsapWithCSS.to(s.position,{z:s.userData.initialZ+2,duration:2,repeat:-1,yoyo:!0,ease:"sine.inOut"}),r&&gsapWithCSS.to(r.position,{z:r.userData.initialZ+2,duration:2,repeat:-1,yoyo:!0,ease:"sine.inOut"})}if(interiorModel){console.log("Starting to traverse interior model...");const s=["polySurface3931001","MR_V01010","UP_body002","Object"],r=[];interiorModel.traverse(l=>{l.isMesh&&s.includes(l.name)&&r.push(l)}),console.log("Total target meshes found:",r.length);const a=new ShaderMaterial({...holographicGlobeShader$1,transparent:!0,side:BackSide,blending:AdditiveBlending,depthWrite:!1});r.forEach(l=>{const c=l.clone();c.material=a,c.scale.multiplyScalar(1.05),l.parent.add(c);const d=()=>{c&&(a.uniforms.time.value=performance.now()*.001,a.uniforms.glowIntensity.value=1+Math.sin(performance.now()*.001)*.5),requestAnimationFrame(d)};d()})}else console.log("interiorModel is not available");return interiorModel&&interiorModel.traverse(s=>{s.isMesh&&(s.name==="Cylinder017"||s.name==="Cylinder021")&&(console.log("Found cylinder:",s.name),console.log("Added flowing line effect to:",s.name))}),animate(),resizeHandler$3=()=>{const s=window.innerWidth/window.innerHeight;camera$3&&renderer$5&&(camera$3.aspect=s,camera$3.updateProjectionMatrix(),renderer$5.setSize(window.innerWidth,window.innerHeight))},window.addEventListener("resize",resizeHandler$3),{scene:scene$4,camera:camera$3,renderer:renderer$5,controls:controls$4,sceneInitialization:sceneInitialization$3}}function animate(){if(userInfo.modeSelected==="vr")renderer$5.setAnimationLoop(render);else{let n=function(){if(!camera$3){cancelAnimationFrame(animationFrameId$3);return}animationFrameId$3=requestAnimationFrame(n),render()};n()}}function render(){var t;if(!camera$3)return;const n=Math.min(clock.getDelta(),.05);hudVideoPlane&&camera$3&&hudVideoPlane.lookAt(camera$3.position),userInfo.modeSelected==="vr"?updateVR():controls$4&&controls$4.update(),batchSystemRef&&batchSystemRef.update();const e=(t=sceneInitialization$3==null?void 0:sceneInitialization$3.playerFunction)==null?void 0:t.player;e&&(e.updateMatrixWorld(),collisionMesh$2&&handleCollisions(e,collisionMesh$2,playerState.velocity,n),playerState.velocity.length()>0&&(e.position.x+=playerState.velocity.x*n,e.position.z+=playerState.velocity.z*n,playerState.onGround||(e.position.y+=playerState.velocity.y*n)),updateZoe(n,e),updateElectro$2(n,e),Math.random()<.1&&checkEmergencyTrigger(e,camera$3,interiorModel,scene$4),updateEmergency(n,e,camera$3),updateFadeOut(),updateMinimap$2(),npcSystem&&npcSystem.update(n)),renderer$5.render(scene$4,camera$3)}function cleanupScene3(){var n;if(cleanupAudioManager(),isSceneTransitioning$3=!1,backgroundAudio$1&&(backgroundAudio$1.pause(),backgroundAudio$1.currentTime=0,backgroundAudio$1=null),npcSystem&&(npcSystem.cleanup(),npcSystem=null),resizeHandler$3&&(window.removeEventListener("resize",resizeHandler$3),resizeHandler$3=null),window.removeEventListener("keydown",handleKeyPress$2),animationFrameId$3&&(cancelAnimationFrame(animationFrameId$3),animationFrameId$3=null),(n=sceneInitialization$3==null?void 0:sceneInitialization$3.playerFunction)!=null&&n.player&&disablePlayerMovement(sceneInitialization$3.playerFunction.player),cleanupVR(),sceneInitialization$3&&(sceneInitialization$3.cleanUpCollider(),sceneInitialization$3=null),cleanupZoe(),cleanupElectro$2(),cleanupEmergency(scene$4),cleanupFadeOut(),cleanupMainFallingSequence(),batchSystemRef&&(scene$4&&scene$4.remove(batchSystemRef),batchSystemRef.particleSystems&&(batchSystemRef.particleSystems.forEach(e=>{e.dispose&&e.dispose()}),batchSystemRef.particleSystems=[]),batchSystemRef.emitters&&(batchSystemRef.emitters.forEach(e=>{e.dispose&&e.dispose()}),batchSystemRef.emitters=[]),batchSystemRef=null),scene$4)for(scene$4.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(t=>{t.dispose(),t.map=null,t.lightMap=null,t.bumpMap=null,t.normalMap=null,t.specularMap=null,t.envMap=null}):(e.material.dispose(),e.material.map=null,e.material.lightMap=null,e.material.bumpMap=null,e.material.normalMap=null,e.material.specularMap=null,e.material.envMap=null)),e.userData={}});scene$4.children.length>0;)scene$4.remove(scene$4.children[0]);controls$4&&controls$4.dispose(),light&&(light.dispose(),light=null),ambLight&&(ambLight.dispose(),ambLight=null),scene$4=null,camera$3=null,controls$4=null,sceneInitialization$3=null,interiorModel=null,batchSystemRef=null,light=null,ambLight=null,collisionMesh$2=null,clock=null,cleanupMinimap$2()}function switchToScene4AfterDelay(n=1e4){isSceneTransitioning$3||(isSceneTransitioning$3=!0,setTimeout(()=>{const e=renderer$5.xr.getSession(),t=o=>{markSceneCompleted$5("scene3"),cleanupMainFallingSequence(),window.removeEventListener("keydown",handleKeyPress$2),sceneInitialization$3&&sceneInitialization$3.cleanUpCollider(),cleanupScene3(),checkExistingAssets(assetsEntry$5),initializeScene4(renderer$5,o).finally(()=>{isSceneTransitioning$3=!1})};e?e.end().then(()=>{t(!0)}).catch(o=>{console.error("Error ending VR session:",o),isSceneTransitioning$3=!1}):t(!1)},n))}function createHologram$1(n,e,t){function o(k,I){return new ShaderMaterial({uniforms:{glowColor:{value:new Color(k)},ringRadius:{value:I},ringThickness:{value:.05},glowStrength:{value:.3},intensity:{value:2},time:{value:0}},vertexShader:`
                uniform float time;
                varying vec2 vUv;

                void main() {
                    vUv = uv;
                    float angle = time * 1.0;
                    mat2 rotationMatrix = mat2(
                        cos(angle), -sin(angle),
                        sin(angle), cos(angle)
                    );
                    vUv = rotationMatrix * (vUv - 0.5) + 0.5;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,fragmentShader:`
                uniform vec3 glowColor;
                uniform float ringRadius;
                uniform float ringThickness;
                uniform float glowStrength;
                uniform float intensity;
                varying vec2 vUv;

                void main() {
                    vec2 p = vUv * 2.0 - 1.0;
                    float dist = length(p);
                    float ring = smoothstep(ringRadius - ringThickness, ringRadius, dist) - 
                                 smoothstep(ringRadius, ringRadius + ringThickness, dist);
                    float glow = smoothstep(ringRadius, ringRadius + glowStrength, dist);
                    glow = 1.0 - glow;
                    glow = pow(glow, intensity);
                    vec3 color = glowColor * glow + glowColor * ring;
                    float alpha = (dist < (ringRadius - ringThickness)) ? 0.0 : max(ring, glow * 0.5);
                    gl_FragColor = vec4(color, alpha);
                }
            `,transparent:!0})}const i=new PlaneGeometry(4,4),s=new ShaderMaterial({uniforms:{glowColor:{value:new Color(43775)},coreRadius:{value:.3},glowRadius:{value:.6},intensity:{value:2.5},time:{value:0}},vertexShader:`
            uniform float time;
            varying vec2 vUv;

            void main() {
                vUv = uv;
                float angle = time * 1.0;
                mat2 rotationMatrix = mat2(
                    cos(angle), -sin(angle),
                    sin(angle), cos(angle)
                );
                vUv = rotationMatrix * (vUv - 0.5) + 0.5;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,fragmentShader:`
            uniform vec3 glowColor;
            uniform float coreRadius;
            uniform float glowRadius;
            uniform float intensity;
            varying vec2 vUv;

            void main() {
                vec2 p = vUv * 2.0 - 1.0;
                float dist = length(p);
                float core = 1.0 - smoothstep(coreRadius - 0.01, coreRadius, dist);
                float glow = smoothstep(coreRadius, glowRadius, dist);
                glow = 1.0 - glow; 
                glow = pow(glow, intensity);
                vec3 color = glowColor * glow + glowColor * core;
                float alpha = max(core, glow * 0.6);
                gl_FragColor = vec4(color, alpha);
            }
        `,transparent:!0}),r=new Mesh(i,s);r.rotation.x=Math.PI/2,r.position.y=-1;const a=o(43775,.4),l=new Mesh(i,a);l.rotation.x=Math.PI/2,l.position.y=-1;const c=o(43775,.54),d=new Mesh(i,c);d.rotation.x=Math.PI/2,d.position.y=-1;const u=new ShaderMaterial({uniforms:{glowColor:{value:new Color(43775)},rectSize:{value:new Vector2$1(.02,.01)},numRects:{value:72},radius:{value:.5},time:{value:.001}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,fragmentShader:`
            uniform vec3 glowColor;
            uniform vec2 rectSize;
            uniform int numRects;
            uniform float radius;
            uniform float time;
            varying vec2 vUv;

            void main() {
                vec2 uv = vUv * 2.0 - 1.0;
                float angleStep = 6.28318 / float(numRects);
                float ring = 0.0;

                for (int i = 0; i < 72; i++) {
                    if (i >= numRects) break;
                    float angle = float(i) * angleStep + time;
                    vec2 rectCenter = vec2(cos(angle), sin(angle)) * radius;
                    mat2 rotationMatrix = mat2(
                        cos(angle), -sin(angle),
                        sin(angle), cos(angle)
                    );
                    vec2 rotatedUV = rotationMatrix * (uv - rectCenter);
                    rotatedUV = abs(rotatedUV);
                    float box = step(rotatedUV.x, rectSize.x) * step(rotatedUV.y, rectSize.y);
                    float softBox = smoothstep(0.02, 0.03, box);
                    ring += softBox;
                }

                vec3 color = glowColor * ring;
                gl_FragColor = vec4(color, ring);
            }
        `,transparent:!0}),f=new Mesh(i,u);f.rotation.x=Math.PI/2,f.position.y=-1;let h={u_time:{value:0}},m=new ShaderMaterial({uniforms:h,transparent:!0,blending:AdditiveBlending,side:DoubleSide,depthWrite:!1,vertexShader:`
            varying vec2 vUv;
            varying vec3 vPosition;
            void main() {
                vUv = uv;
                vPosition = position;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,fragmentShader:`
            precision mediump float;
            uniform float u_time;
            varying vec2 vUv;
            varying vec3 vPosition;

            void main() {
                if (vUv.y < 0.5) discard;
                vec3 neonBlue = vec3(0.0, 0.6, 1.2);  
                float glow = sin(u_time * 3.0) * 0.2 + 0.8;
                float edgeFade = smoothstep(1.0, 0.5, abs(vUv.y - 0.5) * 2.0);
                vec3 color = neonBlue * glow * edgeFade;
                gl_FragColor = vec4(color, 1.0);
            }
        `}),p=new CylinderGeometry(1,1,16,32,1,!0),v=new Mesh(p,m);v.position.y=-1,v.rotation.x=Math.PI;const g=200;function y(k,I){let F=Math.random()*Math.PI*2,M=Math.sqrt(Math.random())*k,R=Math.cos(F)*M,O=Math.sin(F)*M,$=(Math.random()-.5)*I;return new Vector3$1(R,$,O)}const w=new Float32Array(g*3);for(let k=0;k<g;k++){let I=y(1,6);w[k*3]=I.x,w[k*3+1]=I.y,w[k*3+2]=I.z}const _=new BufferGeometry;_.setAttribute("position",new BufferAttribute(w,3));const S=new ShaderMaterial({uniforms:{u_time:{value:0}},vertexShader:`
            uniform float u_time;
            varying vec3 vColor;
            void main() {
                vec3 newPosition = position;
                float speed = 0.3;
                float height = 6.0;
                newPosition.y = mod(position.y - u_time * speed, height) - height * 0.5;
                vColor = vec3(0.0, 0.6, 1.2);
                
                // Calculate perspective scaling for consistent size
                vec4 mvPosition = modelViewMatrix * vec4(newPosition, 1.0);
                gl_PointSize = 2.0 * (300.0 / -mvPosition.z);
                
                gl_Position = projectionMatrix * mvPosition;
            }
        `,fragmentShader:`
            precision mediump float;
            varying vec3 vColor;
            void main() {
                float dist = length(gl_PointCoord - vec2(0.5));
                float alpha = smoothstep(0.5, 0.2, dist);
                gl_FragColor = vec4(vColor, alpha);
            }
        `,transparent:!0,depthWrite:!1,blending:AdditiveBlending}),C=new Points(_,S);C.position.set(0,-10,0);const A=new Group;return A.add(r,l,d,f,v,C),[[0,0,0],[0,-.76,0]].forEach((k,I)=>{const F=new PlaneGeometry(8,8),M={time:{value:0},resolution:{value:new Vector2$1(window.innerWidth,window.innerHeight)},zoom:{value:1}},R=new ShaderMaterial({vertexShader:`
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,fragmentShader:`
                #ifdef GL_ES
                precision highp float;
                #endif

                uniform float time;
                uniform vec2 resolution;
                uniform float zoom;
                varying vec2 vUv;

                #define PI 3.1415926535

                mat2 rotate3d(float angle) {
                    return mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
                }

                void main() {
                    vec2 p = (vUv * 2.0 - 1.0) * zoom;
                    p = rotate3d(time * 2.0 * PI) * p;
                    
                    float t = 0.075 / abs(0.4 - length(p));
                    
                    // vec3 color = 1.0 - exp(-vec3(t) * vec3(0.13 * (sin(time) + 12.0), abs(p.y) * 0.7, 3.0));
                    vec3 color = 1.0 - exp(-vec3(t) * vec3(0.01, 0.02, 0.8 * (sin(time) + 2.0)));
                    float alpha = smoothstep(0.0, 1.0, length(color) * 0.5);
                    
                    gl_FragColor = vec4(color, alpha);
                }
            `,uniforms:M,side:DoubleSide,transparent:!0,blending:CustomBlending,blendEquation:AddEquation,blendSrc:SrcAlphaFactor,blendDst:OneFactor,depthWrite:!1,depthTest:!0}),O=new Mesh(F,R);O.position.set(...k),O.rotation.x=Math.PI/2,I===0&&O.scale.set(3,3,3),A.add(O)}),A.scale.set(13,20,13),{update:k=>{const I=performance.now()*1e-4;a.uniforms.time.value=I,u.uniforms.time.value=I,h.u_time.value+=k,S.uniforms.u_time.value+=k,A.children.forEach(F=>{F.material&&F.material.uniforms&&F.material.uniforms.time&&(F.material.uniforms.time.value+=k)})},meshes:[A]}}let container$1,canvas$1,ctx$1,toggleBtn$1,visible$1=!1,physicsController$1,backgroundPattern$1=null;const markers$1=[{type:"friend",color:"#ffffff",size:8,position:{x:-.16,y:1.9,z:-254}},{type:"hoverboard",color:"#00ff00",size:8,position:{x:-2.2,y:1.9,z:-231}},{type:"portal",color:"#ff00ff",size:10,position:{x:-31,y:4,z:608}}],playerMarker$1={color:"#00f6ff",size:6};function drawMarkerSymbol$1(n,e){switch(n.save(),n.strokeStyle=e.color,n.fillStyle=e.color,n.lineWidth=2,n.shadowColor=e.color,n.shadowBlur=10,e.type){case"friend":n.beginPath(),n.arc(0,0,e.size*.7,0,Math.PI*2),n.stroke(),n.beginPath(),n.arc(-e.size*.8,-e.size*.8,2,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(e.size*.8,-e.size*.8,2,0,Math.PI*2),n.fill();break;case"hoverboard":n.fillRect(-e.size*.5,-e.size*.2,e.size,e.size*.4),n.beginPath(),n.arc(-e.size*.3,e.size*.2,1.5,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(e.size*.3,e.size*.2,1.5,0,Math.PI*2),n.fill();break;case"portal":n.setLineDash([4,4]),n.strokeStyle="#fff";for(const t of[e.size*.6,e.size])n.beginPath(),n.arc(0,0,t,Math.PI*.2,Math.PI*1.8),n.stroke();break}n.restore()}function drawSciFiMarker$1(n,e,t,o){n.save(),n.translate(e,t);const i=(Math.sin(performance.now()*.004)+1)/2;n.fillStyle=o.color+"33",n.beginPath(),n.arc(0,0,o.size+2+i*2,0,Math.PI*2),n.fill(),drawMarkerSymbol$1(n,o),n.restore()}function drawPlayerChevron$1(n){n.save(),n.fillStyle=playerMarker$1.color,n.strokeStyle="#ffffff",n.lineWidth=1.5,n.shadowColor=playerMarker$1.color,n.shadowBlur=18,n.beginPath(),n.moveTo(0,-15),n.lineTo(9,9),n.lineTo(0,4),n.lineTo(-9,9),n.closePath(),n.fill(),n.stroke(),n.restore()}function createBackgroundGrid$1(){const n=document.createElement("canvas"),e=n.getContext("2d"),t=40;return n.width=t,n.height=t,e.strokeStyle="rgba(0, 179, 215, 0.58)",e.lineWidth=.5,e.beginPath(),e.moveTo(0,t),e.lineTo(t,0),e.moveTo(0,0),e.lineTo(t,t),e.stroke(),n}function createMinimap$1(n,e,t,o){physicsController$1=e,container$1=document.createElement("div"),container$1.id="minimap-container",document.body.appendChild(container$1),canvas$1=document.createElement("canvas"),canvas$1.id="minimap-canvas",canvas$1.width=210,canvas$1.height=210,container$1.appendChild(canvas$1),ctx$1=canvas$1.getContext("2d"),toggleBtn$1=document.createElement("button"),toggleBtn$1.id="minimap-toggle",toggleBtn$1.textContent="Hide Map",document.body.appendChild(toggleBtn$1),toggleBtn$1.addEventListener("click",()=>{visible$1=!visible$1,container$1.classList.toggle("visible"),toggleBtn$1.textContent=visible$1?"Hide Map":"Show Map"});const i=createBackgroundGrid$1();backgroundPattern$1=ctx$1.createPattern(i,"repeat"),setTimeout(()=>{visible$1=!0,container$1.classList.add("visible")},1200)}function updateMinimap$1(){var u;if(!visible$1||!ctx$1||!((u=physicsController$1==null?void 0:physicsController$1.playerFunction)!=null&&u.player))return;const n=physicsController$1.playerFunction.player,e=canvas$1.width/2,t=canvas$1.height/2,o=e-2,i=2.5;ctx$1.clearRect(0,0,canvas$1.width,canvas$1.height),ctx$1.save(),ctx$1.beginPath(),ctx$1.arc(e,t,o,0,Math.PI*2),ctx$1.clip(),ctx$1.translate(e,t),ctx$1.rotate(n.rotation.y);const s=-(n.position.x*i),r=-(n.position.z*i);ctx$1.translate(s,r),ctx$1.fillStyle=backgroundPattern$1,ctx$1.fillRect(-e-s,-t-r,canvas$1.width,canvas$1.height),ctx$1.restore();const a=performance.now(),l=a*.002%(Math.PI*2),c=ctx$1.createRadialGradient(e,t,0,e,t,o);c.addColorStop(0,"rgba(0, 255, 255, 0.25)"),c.addColorStop(1,"rgba(0, 255, 255, 0)"),ctx$1.fillStyle=c,ctx$1.beginPath(),ctx$1.moveTo(e,t),ctx$1.arc(e,t,o,l-.3,l+.3),ctx$1.closePath(),ctx$1.fill();const d=(Math.sin(a*.002)+1)/2;ctx$1.strokeStyle=`rgba(0, 255, 255, ${.3-d*.3})`,ctx$1.lineWidth=2,ctx$1.beginPath(),ctx$1.arc(e,t,o*d,0,Math.PI*2),ctx$1.stroke(),ctx$1.save(),ctx$1.translate(e,t),ctx$1.rotate(n.rotation.y);for(const f of markers$1){const h=f.position.x-n.position.x,m=f.position.z-n.position.z,p=h*i,v=m*i;Math.hypot(p,v)<o&&drawSciFiMarker$1(ctx$1,p,v,f)}ctx$1.restore(),ctx$1.save(),ctx$1.translate(e,t),drawPlayerChevron$1(ctx$1),ctx$1.restore()}function cleanupMinimap$1(){toggleBtn$1&&(toggleBtn$1.removeEventListener("click",toggleBtn$1.onclick||toggleBtn$1._listener),toggleBtn$1.innerHTML=""),container$1&&(container$1.innerHTML="",container$1.remove()),toggleBtn$1&&toggleBtn$1.parentNode&&toggleBtn$1.parentNode.removeChild(toggleBtn$1),backgroundPattern$1&&backgroundPattern$1.image&&(backgroundPattern$1.image=null),container$1=null,canvas$1=null,ctx$1=null,toggleBtn$1=null,visible$1=!1,backgroundPattern$1=null}let hoverRings=[],ringGeometry=null,gameActive=!1,ringsPassed=0,totalRings=10,gameStartTime=null,gameEndTime=null,sceneRef=null,playerRef=null,showCollisionDebug=!1,collisionCircles=[],hoverHUDContainer=null,hoverHUDLabel=null,hoverHUDCounter=null,hoverHUDBar=null,hoverHUDBarFill=null,hoverHUDGlow=null,hoverHUDInitialized=!1,hoverHUDVisible=!1,listenersAttached=!1;const _tmpQuat=new Quaternion$1,RING_CONFIG={radius:4,thickness:.4,segments:64,glowIntensity:2.8,pulseSpeed:2,colors:{unpassed:new Color(65535),passed:new Color(65280),current:new Color(16755200)}},RING_POSITIONS=[new Vector3$1(0,8,-200),new Vector3$1(-15,12,-180),new Vector3$1(20,10,-160),new Vector3$1(-5,15,-140),new Vector3$1(25,8,-120),new Vector3$1(-20,14,-100),new Vector3$1(10,11,-80),new Vector3$1(-10,9,-60),new Vector3$1(30,13,-40),new Vector3$1(0,16,-20)],ringVertexShader=`
  varying vec2 vUv;
  varying vec3 vPosition;
  varying vec3 vNormal;
  
  void main() {
    vUv = uv;
    vPosition = position;
    vNormal = normalize(normalMatrix * normal);
    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }
`,ringFragmentShader=`
  uniform float time;
  uniform vec3 color;
  uniform float glowIntensity;
  uniform float pulseSpeed;
  uniform float rimExponent;
  uniform float rimBoost;
  uniform int ringState; // 0: unpassed, 1: current, 2: passed
  
  varying vec2 vUv;
  varying vec3 vPosition;
  varying vec3 vNormal;
  
  void main() {
    // Pulsing effect
    float pulse = sin(time * pulseSpeed) * 0.3 + 0.7;
    
    // State-based effects
    float stateMultiplier = 1.0;
    if (ringState == 1) { // Current ring
      stateMultiplier = 1.9 + sin(time * pulseSpeed * 2.2) * 0.6;
    } else if (ringState == 2) { // Passed ring
      stateMultiplier = 0.6;
    }
    
    // Fresnel effect for glow
    float fresnel = 1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0)));
    fresnel = pow(max(fresnel, 0.0), rimExponent);
    
    // Combine effects
    float alpha = min(1.0, pulse * stateMultiplier + fresnel * rimBoost * stateMultiplier);
    vec3 finalColor = color * glowIntensity * stateMultiplier * (1.0 + fresnel * 0.8);
    
    gl_FragColor = vec4(finalColor, alpha);
  }
`;function createRingShaderMaterial(){return new ShaderMaterial({uniforms:{time:{value:0},color:{value:RING_CONFIG.colors.unpassed},glowIntensity:{value:RING_CONFIG.glowIntensity},pulseSpeed:{value:RING_CONFIG.pulseSpeed},rimExponent:{value:3},rimBoost:{value:1.2},ringState:{value:0}},vertexShader:ringVertexShader,fragmentShader:ringFragmentShader,transparent:!0,side:DoubleSide,blending:AdditiveBlending,depthWrite:!1})}function createRing(n,e){const t=new Mesh(ringGeometry,createRingShaderMaterial());return t.position.copy(n),t.rotation.x=0,t.rotation.y=0,t.rotation.z=Math.PI/2,t.userData={index:e,passed:!1,isCurrent:e===0,originalPosition:n.clone()},updateRingState(t,e===0?1:0),t}function createCollisionDebugCircle(n,e){const t=new CircleGeometry(1,32),o=new MeshBasicMaterial({color:16711680,transparent:!0,opacity:1,side:DoubleSide,wireframe:!1}),i=new Mesh(t,o);return i.position.copy(n),i.rotation.x=0,i.rotation.y=0,i.rotation.z=Math.PI/2,i.visible=showCollisionDebug,i}function updateRingState(n,e){if(n.material.uniforms)switch(n.material.uniforms.ringState.value=e,e){case 0:n.material.uniforms.color.value.copy(RING_CONFIG.colors.unpassed),n.material.uniforms.glowIntensity.value=2.2,n.material.uniforms.rimExponent.value=3.2,n.material.uniforms.rimBoost.value=1.2;break;case 1:n.material.uniforms.color.value.copy(RING_CONFIG.colors.current),n.material.uniforms.glowIntensity.value=3.4,n.material.uniforms.rimExponent.value=3.8,n.material.uniforms.rimBoost.value=1.5;break;case 2:n.material.uniforms.color.value.copy(RING_CONFIG.colors.passed),n.material.uniforms.glowIntensity.value=1.6,n.material.uniforms.rimExponent.value=2.6,n.material.uniforms.rimBoost.value=.9;break}}function initializeHoverGame(n,e){sceneRef=n,playerRef=e,ringGeometry=new TorusGeometry(RING_CONFIG.radius,RING_CONFIG.thickness,RING_CONFIG.segments,32),hoverRings=[],collisionCircles=[],RING_POSITIONS.forEach((t,o)=>{const i=createRing(t,o);n.add(i),hoverRings.push(i);const s=createCollisionDebugCircle(t);n.add(s),collisionCircles.push(s)}),console.log(`Hover Game initialized with ${hoverRings.length} rings`),startHoverGame(),attachHoverboardEventListeners()}function attachHoverboardEventListeners(){if(listenersAttached)return;const n=()=>{hoverHUDInitialized||createHoverHUD(),updateHoverHUD(ringsPassed,totalRings,!1),showHoverHUD()},e=()=>{hideHoverHUD()};window.addEventListener("hoverboard:mounted",n),window.addEventListener("hoverboard:dismounted",e),attachHoverboardEventListeners._mounted=n,attachHoverboardEventListeners._dismounted=e,listenersAttached=!0}function startHoverGame(){gameActive=!0,gameStartTime=performance.now(),ringsPassed=0,hoverRings.forEach(n=>updateRingState(n,0)),hoverRings.length>0&&updateRingState(hoverRings[0],1),console.log("Hover Game started! Fly through the rings in any order!")}function updateHoverGame(n){if(!gameActive||!hoverRings.length)return;const e=performance.now()*.001;window.isPlayerOnHoverboard&&!hoverHUDInitialized&&(createHoverHUD(),updateHoverHUD(ringsPassed,totalRings,!1),showHoverHUD()),hoverRings.forEach(t=>{t.material.uniforms&&(t.material.uniforms.time.value=e)}),playerRef&&window.isPlayerOnHoverboard&&checkRingCollisions()}function checkRingCollisions(){if(!playerRef||!gameActive)return;const n=new Vector3$1;playerRef.getWorldPosition(n);const e=RING_CONFIG.radius-RING_CONFIG.thickness*.6;hoverRings.forEach((t,o)=>{if(t.userData.passed)return;const i=new Vector3$1;t.getWorldPosition(i);const s=new Vector3$1(0,0,1);t.getWorldQuaternion(_tmpQuat),s.applyQuaternion(_tmpQuat);const r=n.clone().sub(i),a=Math.abs(r.dot(s)),d=n.clone().sub(s.clone().multiplyScalar(a)).distanceTo(i)<=e,u=a<=2.5,f=d&&u;if(collisionCircles[o]&&(collisionCircles[o].scale.setScalar(e),collisionCircles[o].position.copy(i),collisionCircles[o].quaternion.copy(_tmpQuat),showCollisionDebug&&collisionCircles[o].material.color.setHex(f?65280:16711680)),f){t.userData.passed=!0,ringsPassed++,updateRingState(t,2);const h=hoverRings.find(m=>!m.userData.passed);h&&updateRingState(h,1),playRingPassSound(),console.log(`Ring ${o+1} passed! (${ringsPassed}/${totalRings})`),updateHoverHUD(ringsPassed,totalRings,!0),ringsPassed>=totalRings&&completeHoverGame()}})}function playRingPassSound(){console.log("Ring pass sound effect")}function completeHoverGame(){gameActive=!1,gameEndTime=performance.now();const n=(gameEndTime-gameStartTime)/1e3;console.log(`Hover Game completed in ${n.toFixed(2)} seconds!`),updateHoverHUD(totalRings,totalRings,!0,!0),transformHUDToCompletionAndRemove(),showGameCompletionEffect(n)}function showGameCompletionEffect(n){console.log(`Congratulations! You completed the hover game in ${n.toFixed(2)} seconds!`)}function resetHoverGame(){gameActive=!1,ringsPassed=0,gameStartTime=null,gameEndTime=null,hoverRings.forEach((n,e)=>{n.userData.passed=!1,n.userData.isCurrent=e===0,updateRingState(n,e===0?1:0)}),hoverHUDInitialized&&(resetHoverHUDLayout(),updateHoverHUD(0,totalRings,!1),window.isPlayerOnHoverboard||hideHoverHUD()),console.log("Hover Game reset")}function cleanupHoverGame(){gameActive=!1,hoverRings.forEach(n=>{sceneRef&&sceneRef.remove(n),n.material&&n.material.dispose()}),collisionCircles.forEach(n=>{sceneRef&&sceneRef.remove(n),n.material&&n.material.dispose(),n.geometry&&n.geometry.dispose()}),ringGeometry&&ringGeometry.dispose(),hoverRings=[],collisionCircles=[],ringGeometry=null,sceneRef=null,playerRef=null,console.log("Hover Game cleaned up"),destroyHoverHUD(),listenersAttached&&(attachHoverboardEventListeners._mounted&&window.removeEventListener("hoverboard:mounted",attachHoverboardEventListeners._mounted),attachHoverboardEventListeners._dismounted&&window.removeEventListener("hoverboard:dismounted",attachHoverboardEventListeners._dismounted),listenersAttached=!1)}function toggleCollisionDebug(){return showCollisionDebug=!showCollisionDebug,collisionCircles.forEach(n=>{n.visible=showCollisionDebug}),console.log(`Collision debug visualization: ${showCollisionDebug?"ON":"OFF"}`),showCollisionDebug}function createHoverHUD(){if(hoverHUDInitialized)return;hoverHUDInitialized=!0,hoverHUDContainer=document.createElement("div"),hoverHUDContainer.id="hover-hud",hoverHUDContainer.style.position="fixed",hoverHUDContainer.style.top="16px",hoverHUDContainer.style.left="50%",hoverHUDContainer.style.transform="translateX(-50%)",hoverHUDContainer.style.zIndex="9999",hoverHUDContainer.style.display="flex",hoverHUDContainer.style.flexDirection="column",hoverHUDContainer.style.alignItems="center",hoverHUDContainer.style.pointerEvents="none",hoverHUDContainer.style.opacity="0",hoverHUDContainer.style.transition="opacity 300ms ease";const n=document.createElement("div");n.style.display="flex",n.style.alignItems="baseline",n.style.gap="10px",hoverHUDLabel=document.createElement("div"),hoverHUDLabel.textContent="Rings",hoverHUDLabel.style.fontFamily='system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji", "Segoe UI Emoji"',hoverHUDLabel.style.fontWeight="700",hoverHUDLabel.style.letterSpacing="0.08em",hoverHUDLabel.style.fontSize="14px",hoverHUDLabel.style.textTransform="uppercase",hoverHUDLabel.style.color="#7efcff",hoverHUDLabel.style.textShadow="0 0 8px rgba(126,252,255,0.7)",hoverHUDCounter=document.createElement("div"),hoverHUDCounter.textContent="0/10",hoverHUDCounter.style.fontFamily=hoverHUDLabel.style.fontFamily,hoverHUDCounter.style.fontWeight="800",hoverHUDCounter.style.fontSize="22px",hoverHUDCounter.style.color="#ffffff",hoverHUDCounter.style.textShadow="0 0 12px rgba(255,255,255,0.65), 0 0 24px rgba(0,255,170,0.45)",hoverHUDCounter.style.filter="drop-shadow(0 0 6px rgba(0,255,170,0.5))",hoverHUDCounter.style.transition="transform 180ms ease, filter 220ms ease",n.appendChild(hoverHUDLabel),n.appendChild(hoverHUDCounter),hoverHUDBar=document.createElement("div"),hoverHUDBar.style.position="relative",hoverHUDBar.style.width="420px",hoverHUDBar.style.maxWidth="60vw",hoverHUDBar.style.height="12px",hoverHUDBar.style.marginTop="10px",hoverHUDBar.style.borderRadius="999px",hoverHUDBar.style.background="linear-gradient(180deg, rgba(20,30,40,0.75), rgba(15,20,30,0.75))",hoverHUDBar.style.boxShadow="inset 0 0 0 1px rgba(126,252,255,0.25), 0 0 16px rgba(0,255,170,0.20)",hoverHUDBar.style.overflow="hidden",hoverHUDBarFill=document.createElement("div"),hoverHUDBarFill.style.position="absolute",hoverHUDBarFill.style.left="0",hoverHUDBarFill.style.top="0",hoverHUDBarFill.style.bottom="0",hoverHUDBarFill.style.width="0%",hoverHUDBarFill.style.borderRadius="999px",hoverHUDBarFill.style.background="linear-gradient(90deg, #00ffff 0%, #00ff88 50%, #00ff44 100%)",hoverHUDBarFill.style.boxShadow="0 0 18px rgba(0,255,170,0.55), 0 0 36px rgba(0,255,255,0.35)",hoverHUDBarFill.style.transition="width 400ms cubic-bezier(0.2, 0.8, 0.2, 1)";const e=document.createElement("div");e.style.position="absolute",e.style.left="0",e.style.right="0",e.style.top="0",e.style.height="50%",e.style.background="linear-gradient(180deg, rgba(255,255,255,0.25), rgba(255,255,255,0))",e.style.pointerEvents="none",hoverHUDGlow=document.createElement("div"),hoverHUDGlow.style.position="absolute",hoverHUDGlow.style.left="50%",hoverHUDGlow.style.top="50%",hoverHUDGlow.style.width="520px",hoverHUDGlow.style.height="40px",hoverHUDGlow.style.transform="translate(-50%, -50%)",hoverHUDGlow.style.borderRadius="999px",hoverHUDGlow.style.background="radial-gradient(ellipse at center, rgba(0,255,170,0.25), rgba(0,0,0,0))",hoverHUDGlow.style.filter="blur(10px)",hoverHUDGlow.style.zIndex="-1",hoverHUDGlow.style.opacity="0.6",hoverHUDGlow.style.transition="opacity 250ms ease",hoverHUDBar.appendChild(hoverHUDBarFill),hoverHUDBar.appendChild(e),hoverHUDContainer.appendChild(n),hoverHUDContainer.appendChild(hoverHUDBar),hoverHUDContainer.appendChild(hoverHUDGlow),document.body.appendChild(hoverHUDContainer)}function showHoverHUD(){!hoverHUDInitialized||hoverHUDVisible||(hoverHUDVisible=!0,hoverHUDContainer.style.opacity="1")}function hideHoverHUD(){!hoverHUDInitialized||!hoverHUDVisible||(hoverHUDVisible=!1,hoverHUDContainer.style.opacity="0")}function destroyHoverHUD(){hoverHUDInitialized=!1,hoverHUDVisible=!1,hoverHUDContainer&&hoverHUDContainer.parentElement&&hoverHUDContainer.parentElement.removeChild(hoverHUDContainer),hoverHUDContainer=null,hoverHUDLabel=null,hoverHUDCounter=null,hoverHUDBar=null,hoverHUDBarFill=null,hoverHUDGlow=null}function updateHoverHUD(n,e,t,o=!1){if(!hoverHUDInitialized)return;const i=Math.max(0,Math.min(n,e)),s=i/e*100;if(hoverHUDCounter&&(hoverHUDCounter.textContent=`${i}/${e}`),hoverHUDBarFill&&(hoverHUDBarFill.style.width=`${s}%`),t&&(hoverHUDCounter&&(hoverHUDCounter.style.transform="scale(1.12)",hoverHUDCounter.style.filter="drop-shadow(0 0 10px rgba(0,255,170,0.85))",setTimeout(()=>{hoverHUDCounter&&(hoverHUDCounter.style.transform="scale(1)",hoverHUDCounter.style.filter="drop-shadow(0 0 6px rgba(0,255,170,0.5))")},180)),hoverHUDGlow&&(hoverHUDGlow.style.opacity="0.95",setTimeout(()=>{hoverHUDGlow&&(hoverHUDGlow.style.opacity="0.6")},220))),o){const r=document.createElement("div");r.style.position="absolute",r.style.left="0",r.style.top="0",r.style.bottom="0",r.style.width="100%",r.style.background="linear-gradient(90deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.55) 50%, rgba(255,255,255,0) 100%)",r.style.pointerEvents="none",r.style.transform="translateX(-100%)",r.style.filter="blur(2px)",r.style.mixBlendMode="screen",r.style.transition="transform 600ms cubic-bezier(0.2, 0.8, 0.2, 1)",hoverHUDBar.appendChild(r),requestAnimationFrame(()=>{r.style.transform="translateX(100%)",setTimeout(()=>{r&&r.parentElement&&r.parentElement.removeChild(r)},650)})}}function transformHUDToCompletionAndRemove(){!hoverHUDInitialized||!hoverHUDContainer||(hoverHUDBar&&(hoverHUDBar.style.display="none"),hoverHUDCounter&&(hoverHUDCounter.style.display="none"),hoverHUDLabel&&(hoverHUDLabel.textContent="Hurray! Completed",hoverHUDLabel.style.fontSize="24px",hoverHUDLabel.style.letterSpacing="0.1em",hoverHUDLabel.style.color="#7efcff",hoverHUDLabel.style.textShadow="0 0 14px rgba(126,252,255,0.9), 0 0 30px rgba(0,255,170,0.55)"),hoverHUDGlow&&(hoverHUDGlow.style.opacity="1",setTimeout(()=>{hoverHUDGlow&&(hoverHUDGlow.style.opacity="0.6")},250)),setTimeout(()=>{hoverHUDContainer&&(hoverHUDContainer.style.opacity="0",setTimeout(()=>{destroyHoverHUD()},280))},1600))}function resetHoverHUDLayout(){hoverHUDInitialized&&(hoverHUDLabel&&(hoverHUDLabel.textContent="Rings",hoverHUDLabel.style.fontSize="14px",hoverHUDLabel.style.letterSpacing="0.08em",hoverHUDLabel.style.textShadow="0 0 8px rgba(126,252,255,0.7)"),hoverHUDCounter&&(hoverHUDCounter.style.display=""),hoverHUDBar&&(hoverHUDBar.style.display=""),hoverHUDContainer&&(hoverHUDContainer.style.opacity="1"))}async function markSceneCompleted$1(n){try{const e=auth.currentUser;if(!e)return;await updateDoc(doc(db,"users",e.uid),{[`scenesCompleted.${n}`]:!0})}catch(e){console.error("Failed to mark scene completed",e)}}let ufos=[],waterfallMeshes=[],gateGroup,scene$3,renderer$4,controls$3,glassMaterial,chromeMaterial,sphere001Mesh,plane020Mesh,portal$1,leftGate,rightGate,resizeHandler$2=null,electroFocusCamera$1,isElectroFocusActive$1=!1,sceneInitialization$2,collisionMesh$1,loadingHiddenHandler=null,isCameraTransitioning$1=!1,transitionStartTime$1=0;const transitionDuration$1=1.5;let transitionStartPosition$1=new Vector3$1,transitionStartRotation=new Quaternion$1,transitionTargetPosition$1=new Vector3$1,transitionTargetRotation=new Quaternion$1,transitionCamera=new PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,2e3),glassSettings={metalness:1,roughness:0,transmission:0,thickness:1.13,envMapIntensity:5,clearcoat:1,clearcoatRoughness:.1,opacity:.8,color:"#93b7d2"},chromeSettings={metalness:1,roughness:.1,clearcoat:1,clearcoatRoughness:.1,reflectivity:1,envMapIntensity:1,ior:3,specularIntensity:1,color:"#f3ddfb"},glassGradientSettings={colorTop:"#050c66",colorBottom:"#090a11",mix:.5},isGateOpening=!1;new Vector3$1;new Vector3$1(5,2,0);new Vector3$1(0,1,0);let hoverboardVisible=!1,hoverboardMesh=null,hoverboardKeyListenerActive=!1,hoverboardKeyListener=null,hoverboardShaderEffect=null,hoverboardShaderMaterial=null,camera$2=null,hologramEffect$2,hologramEffects,textureAnimationSpeed=45e-5,isSceneTransitioning$2=!1,currentObjectiveNumber=1,directionArrow,animationFrameId$2=null;const removeHoverboardShaderEffect=()=>{hoverboardShaderEffect&&(scene$3&&scene$3.remove(hoverboardShaderEffect),hoverboardShaderEffect.geometry&&hoverboardShaderEffect.geometry.dispose(),hoverboardShaderEffect.material&&hoverboardShaderEffect.material.dispose(),hoverboardShaderEffect=null),hoverboardShaderMaterial&&(hoverboardShaderMaterial.dispose(),hoverboardShaderMaterial=null)};function handleKeyPress$1(n){if(n.key.toLowerCase()==="y"&&!isSceneTransitioning$2){isSceneTransitioning$2=!0;const e=renderer$4.xr.getSession(),t=o=>{markSceneCompleted$1("scene2"),window.removeEventListener("keydown",handleKeyPress$1),sceneInitialization$2&&sceneInitialization$2.cleanUpCollider(),cleanupScene2(),checkExistingAssets(assetsEntry$6),initializeScene3(renderer$4,o).finally(()=>{isSceneTransitioning$2=!1})};e?e.end().then(()=>{t(!0)}).catch(o=>{console.error("Error ending VR session:",o),isSceneTransitioning$2=!1}):t(!1)}}async function initializeScene2(n,e){setCurrentScene("scene2");const t=getUserInfo(),o=createGUI();o.close(),animationFrameId$2=null,animationFrameId$2&&(cancelAnimationFrame(animationFrameId$2),animationFrameId$2=null),camera$2=new PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,2e3),camera$2.position.set(0,0,1.6),scene$3=new Scene;let i=!0;document.addEventListener("keydown",T=>{if(T.key.toLowerCase()==="u")if(i=!i,i)showObjective(currentObjectiveNumber||1,objectives$3);else{const D=document.getElementById("objective-container");D&&(D.style.opacity="0")}}),electroFocusCamera$1=new PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,2e3),electroFocusCamera$1.position.set(-1.3,.8,-253.2),electroFocusCamera$1.lookAt(0,0,-242),renderer$4=n,renderer$4.shadowMap.enabled=!0,renderer$4.shadowMap.type=PCFSoftShadowMap,renderer$4.shadowMap.autoUpdate=!0,renderer$4.physicallyCorrectLights=!0,renderer$4.toneMapping=ACESFilmicToneMapping,renderer$4.toneMappingExposure=.8,renderer$4.outputEncoding=void 0,renderer$4.domElement.parentElement||document.body.appendChild(renderer$4.domElement),console.log(renderer$4.antialias),await loadAllAsset(assetsEntry$7,camera$2,renderer$4,scene$3),console.log(allAssets$4),initializeAudioManager(camera$2,scene$3),togglePlayerControls(!1),togglePlayerPhysics(!1),loadingHiddenHandler=()=>{console.log("Loading screen hidden - Scene2 is ready!"),showObjective(1,objectives$3),createMinimap$1(scene$3,sceneInitialization$2),togglePlayerPhysics(!0),togglePlayerControls(!0),allAssets$4.audios.background&&playAudio("background"),window.removeEventListener("loadingScreenHidden-scene2",loadingHiddenHandler),loadingHiddenHandler=null},window.addEventListener("loadingScreenHidden-scene2",loadingHiddenHandler),allAssets$4.hdris.evening&&(scene$3.environment=allAssets$4.hdris.evening,scene$3.background=allAssets$4.hdris.evening),scene$3.environmentIntensity=.5,renderer$4.render(scene$3,camera$2),controls$3=new OrbitControls(camera$2,renderer$4.domElement),controls$3.dampingFactor=.25,controls$3.enableDamping=!0,controls$3.maxPolarAngle=Math.PI/2,controls$3.enablePan=!1,controls$3.screenSpacePanning=!1,controls$3.rotateSpeed=.5,controls$3.zoomSpeed=.5,window.addEventListener("keydown",handleKeyPress$1),sceneInitialization$2=initializePhysicsAndPlayer(allAssets$4.models.gltf.university,{position:{x:0,y:0,z:0},rotation:{x:0,y:Math.PI/2,z:0}},[],scene$3,camera$2,controls$3);const s=()=>{hoverboardVisible||hoverboard&&(hoverboardMesh=hoverboard,hoverboardMesh.position.set(0,1.2,-227),hoverboardMesh.rotation.set(0,Math.PI/2,0),hoverboardMesh.visible=!0,hoverboardCollisionMesh&&(hoverboardCollisionMesh.position.copy(hoverboardMesh.position),hoverboardCollisionMesh.rotation.copy(hoverboardMesh.rotation)),hoverboardVisible=!0,r(),hoverboardKeyListenerActive=!0,$(),enableHoverboardEKey(),console.log("Hoverboard appeared! Press E to interact."))},r=()=>{if(!hoverboardMesh)return;const T=new SphereGeometry(1,32,32);hoverboardShaderMaterial=new ShaderMaterial({uniforms:{time:{value:0},color:{value:new Color(65535)},intensity:{value:1}},vertexShader:`
        varying vec3 vNormal;
        varying vec3 vPosition;
        
        void main() {
          vNormal = normalize(normalMatrix * normal);
          vPosition = position;
          gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
        }
      `,fragmentShader:`
        uniform float time;
        uniform vec3 color;
        uniform float intensity;
        varying vec3 vNormal;
        varying vec3 vPosition;
        
        void main() {
          float pulse = sin(time * 2.0) * 0.5 + 0.5;
          float fresnel = pow(1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0))), 2.0);
          float alpha = fresnel * pulse * intensity;
          
          gl_FragColor = vec4(color, alpha * 0.6);
        }
      `,transparent:!0,side:DoubleSide,blending:AdditiveBlending,depthWrite:!1}),hoverboardShaderEffect=new Mesh(T,hoverboardShaderMaterial),hoverboardShaderEffect.position.copy(hoverboardMesh.position),scene$3.add(hoverboardShaderEffect)},{electro:a,electroTrigger:l,secondElectroTrigger:c,thirdElectroTrigger:d,electroMixer:u,electroActions:f}=initializeElectro$3(scene$3,allAssets$4,sceneInitialization$2.playerFunction.player),h=()=>{if(isSceneTransitioning$2)return;isSceneTransitioning$2=!0;const T=renderer$4.xr.getSession(),D=P=>{markSceneCompleted$1("scene2"),window.removeEventListener("keydown",handleKeyPress$1),sceneInitialization$2&&sceneInitialization$2.cleanUpCollider(),cleanupScene2(),checkExistingAssets(assetsEntry$6),initializeScene3(renderer$4,P).finally(()=>{isSceneTransitioning$2=!1})};T?T.end().then(()=>{D(!0)}).catch(P=>{console.error("Error ending VR session:",P),isSceneTransitioning$2=!1}):D(!1)};let m=new AmbientLight(16777215,.5);scene$3.add(m);const p=new DirectionalLight(16777215,1);p.position.set(-500,200,100),p.target.position.set(0,2,600);const v=new Clock;if(allAssets$4.models.gltf.university){allAssets$4.models.gltf.university.traverse(z=>{if(z.isMesh&&z.name==="wall"&&(z.visible=!1),z.isMesh&&z.material&&z.material.emissiveMap){const N=z.material,G=N.emissive,K=new MeshStandardMaterial({...N,emissive:G,emissiveIntensity:2.5,toneMapped:!1});z.material=K,z.material.needsUpdate=!0}if(z.isMesh&&z.name==="Plane020"){plane020Mesh=z;const N=z.geometry.attributes.uv.array.slice();z.userData.originalUVs=N,z.userData.uvOffset=0}if(z.isMesh&&z.name==="glass"){const N=document.createElement("canvas");N.width=256,N.height=256;const G=N.getContext("2d"),K=G.createLinearGradient(0,0,0,256);K.addColorStop(0,glassGradientSettings.colorTop),K.addColorStop(1,glassGradientSettings.colorBottom),G.fillStyle=K,G.fillRect(0,0,256,256);const ne=new CanvasTexture(N);ne.needsUpdate=!0,glassMaterial=new MeshPhysicalMaterial({metalness:glassSettings.metalness,roughness:glassSettings.roughness,transmission:glassSettings.transmission,thickness:glassSettings.thickness,envMapIntensity:glassSettings.envMapIntensity,clearcoat:glassSettings.clearcoat,clearcoatRoughness:glassSettings.clearcoatRoughness,map:ne,side:DoubleSide,fog:!0}),z.material=glassMaterial,z.material.envMap=scene$3.environment||allAssets$4.hdris.night4,z.material.needsUpdate=!0}if(z.name==="Sphere001"){sphere001Mesh=z;const N=new MeshPhysicalMaterial({color:"#93b7d2",metalness:1,roughness:0,transmission:1,thickness:1.13,envMapIntensity:1.13,transparent:!0,opacity:.6,clearcoat:1,clearcoatRoughness:.1,depthWrite:!1});z.material=N,z.material.envMap=scene$3.environment||allAssets$4.hdris.night4,z.material.needsUpdate=!0}z.isMesh&&(z.name==="chrome002"||z.name==="Sphere")&&(chromeMaterial=new MeshPhysicalMaterial({color:chromeSettings.color,metalness:chromeSettings.metalness,roughness:chromeSettings.roughness,clearcoat:chromeSettings.clearcoat,clearcoatRoughness:chromeSettings.clearcoatRoughness,reflectivity:chromeSettings.reflectivity,envMapIntensity:chromeSettings.envMapIntensity,ior:chromeSettings.ior,specularIntensity:chromeSettings.specularIntensity,side:DoubleSide,fog:!0}),z.material=chromeMaterial,z.material.envMap=scene$3.environment||allAssets$4.hdris.night4,z.material.needsUpdate=!0)});const T=o.addFolder("Glass Material");T.add(glassSettings,"metalness",0,1).onChange(z=>{glassMaterial.metalness=z}),T.add(glassSettings,"roughness",0,1).onChange(z=>{glassMaterial.roughness=z}),T.add(glassSettings,"transmission",0,1).onChange(z=>{glassMaterial.transmission=z}),T.add(glassSettings,"thickness",0,5).onChange(z=>{glassMaterial.thickness=z}),T.add(glassSettings,"envMapIntensity",0,15).onChange(z=>{glassMaterial.envMapIntensity=z}),T.addColor(glassSettings,"color").onChange(z=>{glassMaterial.color.set(z)});const D=T.addFolder("Gradient Colors");D.addColor(glassGradientSettings,"colorTop").onChange(z=>{const N=glassMaterial.map.image.getContext("2d"),G=N.createLinearGradient(0,0,0,256);G.addColorStop(0,z),G.addColorStop(1,glassGradientSettings.colorBottom),N.fillStyle=G,N.fillRect(0,0,256,256),glassMaterial.map.needsUpdate=!0}),D.addColor(glassGradientSettings,"colorBottom").onChange(z=>{const N=glassMaterial.map.image.getContext("2d"),G=N.createLinearGradient(0,0,0,256);G.addColorStop(0,glassGradientSettings.colorTop),G.addColorStop(1,z),N.fillStyle=G,N.fillRect(0,0,256,256),glassMaterial.map.needsUpdate=!0}),D.add(glassGradientSettings,"mix",0,1).onChange(z=>{const N=glassMaterial.map.image.getContext("2d"),G=N.createLinearGradient(0,0,0,256);G.addColorStop(0,glassGradientSettings.colorTop),G.addColorStop(z,glassGradientSettings.colorTop),G.addColorStop(1,glassGradientSettings.colorBottom),N.fillStyle=G,N.fillRect(0,0,256,256),glassMaterial.map.needsUpdate=!0});const P=o.addFolder("Chrome Material");P.add(chromeSettings,"metalness",0,1).onChange(z=>{chromeMaterial.metalness=z}),P.add(chromeSettings,"roughness",0,1).onChange(z=>{chromeMaterial.roughness=z}),P.add(chromeSettings,"clearcoat",0,1).onChange(z=>{chromeMaterial.clearcoat=z}),P.add(chromeSettings,"reflectivity",0,1).onChange(z=>{chromeMaterial.reflectivity=z}),P.add(chromeSettings,"envMapIntensity",0,5).onChange(z=>{chromeMaterial.envMapIntensity=z}),P.add(chromeSettings,"ior",1,5).onChange(z=>{chromeMaterial.ior=z}),P.addColor(chromeSettings,"color").onChange(z=>{chromeMaterial.color.set(z)});const L=o.addFolder("Sphere001 Glass Material"),B={color:"#93b7d2",metalness:1,roughness:0,transmission:0,thickness:1.13,envMapIntensity:1.13,opacity:.8,clearcoat:1,clearcoatRoughness:.1};L.addColor(B,"color").onChange(z=>{sphere001Mesh&&(sphere001Mesh.material.color.set(z),sphere001Mesh.material.needsUpdate=!0)}),L.add(B,"metalness",0,1).onChange(z=>{sphere001Mesh&&(sphere001Mesh.material.metalness=z,sphere001Mesh.material.needsUpdate=!0)}),L.add(B,"roughness",0,1).onChange(z=>{sphere001Mesh&&(sphere001Mesh.material.roughness=z,sphere001Mesh.material.needsUpdate=!0)}),L.add(B,"transmission",0,1).onChange(z=>{sphere001Mesh&&(sphere001Mesh.material.transmission=z,sphere001Mesh.material.needsUpdate=!0)}),L.add(B,"thickness",0,5).onChange(z=>{sphere001Mesh&&(sphere001Mesh.material.thickness=z,sphere001Mesh.material.needsUpdate=!0)}),L.add(B,"envMapIntensity",0,5).onChange(z=>{sphere001Mesh&&(sphere001Mesh.material.envMapIntensity=z,sphere001Mesh.material.needsUpdate=!0)}),L.add(B,"opacity",0,1).onChange(z=>{sphere001Mesh&&(sphere001Mesh.material.opacity=z,sphere001Mesh.material.needsUpdate=!0)}),L.add(B,"clearcoat",0,1).onChange(z=>{sphere001Mesh&&(sphere001Mesh.material.clearcoat=z,sphere001Mesh.material.needsUpdate=!0)}),L.add(B,"clearcoatRoughness",0,1).onChange(z=>{sphere001Mesh&&(sphere001Mesh.material.clearcoatRoughness=z,sphere001Mesh.material.needsUpdate=!0)}),o.addFolder("Texture Animation").add({speed:textureAnimationSpeed},"speed",0,.01).onChange(z=>{textureAnimationSpeed=z}),scene$3.traverse(z=>{if(z.isMesh&&z.geometry){const N=z.geometry.clone();if(["video"].includes(z.name)){const K=new MeshPhysicalMaterial({transparent:!0,side:DoubleSide,opacity:1,metalness:.8,roughness:.05,transmission:1,clearcoat:1,clearcoatRoughness:.03,envMapIntensity:1,reflectivity:.9,ior:1.5,thickness:.02,attenuationDistance:1,attenuationColor:new Color(16777215),depthWrite:!1,blending:AdditiveBlending});z.geometry=N,z.material=K,z.userData.originalGeometry=z.geometry}}})}else console.log("university model not found in allAssets");const g=[{position:new Vector3$1(500,250,350),scale:1.5},{position:new Vector3$1(-500,250,350),scale:1.3},{position:new Vector3$1(475,250,800),scale:.9},{position:new Vector3$1(-450,250,800),scale:1},{position:new Vector3$1(300,350,575),scale:.8},{position:new Vector3$1(-300,350,575),scale:.8},{position:new Vector3$1(300,250,-100),scale:.8},{position:new Vector3$1(-300,250,-100),scale:.8},{position:new Vector3$1(400,250,500),scale:.6,isRandom:!0,spiralParams:{radius:300,speed:.2,verticalSpeed:.08}},{position:new Vector3$1(-400,250,0),scale:.6,isRandom:!0,spiralParams:{radius:250,speed:.15,verticalSpeed:.06}},{position:new Vector3$1(300,250,400),scale:.6,isRandom:!0,spiralParams:{radius:300,speed:.2,verticalSpeed:.08}}];hologramEffects=[];const y=[];if(g.forEach(T=>{var P,L,B;const D=allAssets$4.models.gltf.ufo.clone();scene$3.add(D),D.scale.set(T.scale,T.scale,T.scale),D.position.copy(T.position),D.userData={initialPosition:T.position.clone(),bobOffset:Math.random()*Math.PI*2,rotationOffset:Math.random()*Math.PI*2,isRandom:T.isRandom||!1,spiralAngle:Math.random()*Math.PI*2,spiralRadius:((P=T.spiralParams)==null?void 0:P.radius)||200+Math.random()*100,spiralHeight:T.position.y,spiralSpeed:((L=T.spiralParams)==null?void 0:L.speed)||.1,verticalSpeed:((B=T.spiralParams)==null?void 0:B.verticalSpeed)||.05,verticalDirection:Math.random()>.5?1:-1,centerOffset:T.isRandom?new Vector3$1(T.position.x,0,T.position.z):new Vector3$1(0,0,0),bounds:{minX:-1e3,maxX:1e3,minY:150,maxY:400,minZ:-1e3,maxZ:1e3}},T.isRandom||(hologramEffect$2=createHologram$1(),D.add(hologramEffect$2.meshes[0]),hologramEffects.push(hologramEffect$2)),y.push(D)}),allAssets$4.videotextures.waterfall){const{video:T,videoTexture:D}=w("/scene22/waterfall3.mp4");D.colorSpace=SRGBColorSpace,T.addEventListener("loadedmetadata",()=>{const P=T.videoWidth/T.videoHeight,L=115,B=L/P*2,b=new PlaneGeometry(L,B),z=new MeshBasicMaterial({map:D,alphaMap:D,side:DoubleSide,transparent:!0,depthWrite:!1}),N=new Mesh(b,z);scene$3.add(N),N.position.set(375,15,-140),N.rotation.x=-Math.PI/5;const G=413,K=G/P,ne=new PlaneGeometry(G,K),J=new Mesh(ne,z);scene$3.add(J),J.position.set(-868.3,55,325),J.rotation.y=Math.PI/2.14})}else console.warn("Waterfall video texture not loaded");function w(T){const D=document.createElement("video");Object.assign(D,{src:T,muted:!0,playsInline:!0,autoplay:!0}),D.loop=!0,D.playbackRate=.9;const L=new VideoTexture(D);return L.encoding=void 0,D.addEventListener("loadeddata",()=>{D.playbackRate=.9,D.play().catch(B=>console.log("Video play failed:",B))}),{video:D,videoTexture:L}}if(setVRMode(e),e){allAssets$4.characters.animations[t.selectedCharacter];const T=[];l&&T.push(l.mesh),plane&&T.push(plane),initializeVR(renderer$4,scene$3,camera$2,sceneInitialization$2.playerFunction.player,sceneInitialization$2.playerFunction.actions,T,()=>{l&&l.isPlayerNear()&&l.onTrigger()}),collisionMesh$1=allAssets$4.models.gltf.university.collisionMesh,setCollisionMesh(collisionMesh$1),enablePlayerMovement(sceneInitialization$2.playerFunction.player)}gateGroup=new Group,gateGroup.position.set(0,3.6,-245.7),scene$3.add(gateGroup);const _=new PlaneGeometry(8,6),S=new MeshStandardMaterial({side:DoubleSide,map:allAssets$4.textures.baseColor,normalMap:allAssets$4.textures.normalMap,roughness:.2,metalness:.8});leftGate=new Mesh(_,S),leftGate.position.set(-4,0,0),leftGate.rotation.y=Math.PI,gateGroup.add(leftGate);const C=new PlaneGeometry(8,6),A=new MeshStandardMaterial({side:DoubleSide,map:allAssets$4.textures.baseColor,normalMap:allAssets$4.textures.normalMap,roughness:.2,metalness:.8});rightGate=new Mesh(C,A),rightGate.position.set(4,0,0),rightGate.rotation.y=0,gateGroup.add(rightGate);const E=addCollider("leftGate",leftGate);E.position.copy(leftGate.position),E.rotation.copy(leftGate.rotation),gateGroup.add(E);const k=addCollider("rightGate",rightGate);k.position.copy(rightGate.position),k.rotation.copy(rightGate.rotation),gateGroup.add(k),leftGate.userData.collider=E,rightGate.userData.collider=k,window.addEventListener("keydown",T=>{T.key.toLowerCase()==="v"?openGate():T.key.toLowerCase()==="x"?(scene$3.remove(gateGroup),removeCollider("leftGate"),removeCollider("rightGate")):T.key.toLowerCase()==="d"?debugColliderPositions():T.key.toLowerCase()==="c"?toggleColliderDebugVisibility(!0):T.key.toLowerCase()==="h"?toggleColliderDebugVisibility(!1):T.key.toLowerCase()==="r"?(resetHoverGame(),console.log("Hover game reset!")):T.key.toLowerCase()==="g"||T.key.toLowerCase()==="b"&&toggleCollisionDebug()});const I=[new Vector3$1(0,.6,-252),new Vector3$1(-2.2,.6,-230),new Vector3$1(-31,3,610)];directionArrow=initializeDirectionArrow(scene$3,I);const F=new Vector3$1(-30.4,5.3,619),M=new Euler$1(0,0,0);portal$1=new Portal(scene$3,F,M,1.5);function R(){if(t.modeSelected==="vr")renderer$4.setAnimationLoop(O);else{let T=function(){if(!camera$2){cancelAnimationFrame(animationFrameId$2);return}animationFrameId$2=requestAnimationFrame(T),O()};T()}}function O(){var L,B,b,z,N,G,K,ne;if(!camera$2||!renderer$4||!scene$3)return;const T=v.getDelta();if(directionArrow&&((L=sceneInitialization$2==null?void 0:sceneInitialization$2.playerFunction)!=null&&L.player)){const J=new Vector3$1;sceneInitialization$2.playerFunction.player.getWorldPosition(J),updateDirectionArrow(T,J,camera$2)}updateMinimap$1();const D=performance.now()*.001;if(y.forEach(J=>{const Q=J.userData.initialPosition.y+Math.sin(D*.5+J.userData.bobOffset)*2;if(J.position.y=Q,J.rotation.y=Math.sin(D*.6+J.userData.rotationOffset)*.1,J.userData.isRandom){J.userData.spiralAngle+=J.userData.spiralSpeed*T;const le=J.userData.centerOffset.x+Math.cos(J.userData.spiralAngle)*J.userData.spiralRadius,ae=J.userData.centerOffset.z+Math.sin(J.userData.spiralAngle)*J.userData.spiralRadius;J.userData.spiralHeight+=J.userData.verticalSpeed*J.userData.verticalDirection,J.userData.spiralHeight>J.userData.bounds.maxY-50?J.userData.verticalDirection=-1:J.userData.spiralHeight<J.userData.bounds.minY+50&&(J.userData.verticalDirection=1);const oe=Math.sqrt(Math.pow(le-J.userData.centerOffset.x,2)+Math.pow(ae-J.userData.centerOffset.z,2));oe>J.userData.bounds.maxX-100?J.userData.spiralRadius*=.95:oe<100&&(J.userData.spiralRadius*=1.05),J.position.set(le,J.userData.spiralHeight,ae);const pe=Math.atan2(ae-J.userData.centerOffset.z,le-J.userData.centerOffset.x)+Math.PI/2;J.rotation.y=pe}}),portal$1&&portal$1.update(D),t.modeSelected==="vr"?updateVR():controls$3&&controls$3.update(),!window.isPlayerOnHoverboard&&((B=sceneInitialization$2==null?void 0:sceneInitialization$2.playerFunction)!=null&&B.player)){const J=sceneInitialization$2.playerFunction.player;J.updateMatrixWorld(),collisionMesh$1&&handleCollisions(J,collisionMesh$1,playerState.velocity,T),playerState.velocity.length()>0&&(J.position.x+=playerState.velocity.x*T,J.position.z+=playerState.velocity.z*T,playerState.onGround||(J.position.y+=playerState.velocity.y*T))}if(u&&f&&l&&c&&d&&updateElectro$3(T,u,f,l,c,d,(b=sceneInitialization$2==null?void 0:sceneInitialization$2.playerFunction)==null?void 0:b.player,(N=(z=sceneInitialization$2==null?void 0:sceneInitialization$2.playerFunction)==null?void 0:z.player)==null?void 0:N.position,a,h,(G=sceneInitialization$2==null?void 0:sceneInitialization$2.playerFunction)==null?void 0:G.actions,s),isGateOpening&&gateGroup){const te=2*T;leftGate.position.x>leftGate.userData.initialX-8&&(leftGate.position.x-=te,updateColliderPosition("leftGate",leftGate.position,leftGate.rotation)),rightGate.position.x<rightGate.userData.initialX+8&&(rightGate.position.x+=te,updateColliderPosition("rightGate",rightGate.position,rightGate.rotation)),leftGate.position.x<=leftGate.userData.initialX-8&&rightGate.position.x>=rightGate.userData.initialX+8&&(scene$3.remove(gateGroup),removeCollider("leftGate"),removeCollider("rightGate"),isGateOpening=!1)}updateHoverboardMovement(T,allAssets$4),updateHoverboardCamera(camera$2,controls$3,T),updateHoverGame(),isCameraTransitioning$1&&updateCameraTransition();const P=isCameraTransitioning$1?transitionCamera:isElectroFocusActive$1?electroFocusCamera$1:camera$2;if(hologramEffects&&hologramEffects.forEach(J=>{J.update(.016)}),hoverboardShaderEffect&&hoverboardShaderMaterial&&(hoverboardShaderMaterial.uniforms.time.value=D),plane020Mesh&&plane020Mesh.userData.originalUVs){const J=plane020Mesh.geometry.attributes.uv.array,se=plane020Mesh.userData.originalUVs;plane020Mesh.userData.uvOffset+=textureAnimationSpeed,plane020Mesh.userData.uvOffset>1&&(plane020Mesh.userData.uvOffset-=1);for(let te=0;te<J.length;te+=2)J[te]=se[te]+plane020Mesh.userData.uvOffset;plane020Mesh.geometry.attributes.uv.needsUpdate=!0}window.isPlayerOnHoverboard&&((K=sceneInitialization$2==null?void 0:sceneInitialization$2.playerFunction)!=null&&K.selectedPlayerMixer)&&(sceneInitialization$2.playerFunction.selectedPlayerMixer.update(v.getDelta()),currentObjectiveNumber===3&&(showObjective(4,objectives$3),currentObjectiveNumber=4)),(ne=sceneInitialization$2==null?void 0:sceneInitialization$2.playerFunction)!=null&&ne.player&&portal$1&&portal$1.mesh&&sceneInitialization$2.playerFunction.player.position.distanceTo(portal$1.mesh.position)<=2&&!isSceneTransitioning$2&&handlePortalSceneSwitch({renderer:renderer$4,nextEntry:assetsEntry$6,initializeNextScene:initializeScene3,cleanupCurrentScene:cleanupScene2,sceneInitialization:sceneInitialization$2,isSceneTransitioningRef:{value:isSceneTransitioning$2},handleKeyPress:handleKeyPress$1}),P&&renderer$4.render(scene$3,P)}R(),resizeHandler$2=()=>{const T=window.innerWidth/window.innerHeight;camera$2&&(camera$2.aspect=T,camera$2.updateProjectionMatrix()),electroFocusCamera$1&&(electroFocusCamera$1.aspect=T,electroFocusCamera$1.updateProjectionMatrix()),transitionCamera&&(transitionCamera.aspect=T,transitionCamera.updateProjectionMatrix()),renderer$4&&renderer$4.setSize(window.innerWidth,window.innerHeight)},window.addEventListener("resize",resizeHandler$2),initializeHoverboard(scene$3,allAssets$4,sceneInitialization$2.playerFunction.player,!1),initializeHoverGame(scene$3,sceneInitialization$2.playerFunction.player);const $=()=>{hoverboardKeyListener||(hoverboardKeyListener=T=>{var D;T.key.toLowerCase()==="e"&&hoverboardKeyListenerActive&&hoverboardVisible&&hoverboardMesh&&!window.isPlayerOnHoverboard&&(removeHoverboardShaderEffect(),(D=sceneInitialization$2==null?void 0:sceneInitialization$2.playerFunction)!=null&&D.player&&(sceneInitialization$2.playerFunction.player.position.set(-1.02,2,-227),playerState.velocity.set(0,0,0)),hoverboardKeyListenerActive=!1,hoverboardKeyListener&&(document.removeEventListener("keydown",hoverboardKeyListener),hoverboardKeyListener=null),disableHoverboardEKey(),attachPlayerToHoverboard())},document.addEventListener("keydown",hoverboardKeyListener),console.log("Hoverboard E key listener activated!"))};return window.setCurrentObjectiveNumber=T=>{currentObjectiveNumber=T},{scene:scene$3,camera:camera$2,renderer:renderer$4,controls:controls$3,sceneInitialization:sceneInitialization$2,electro:a,electroTrigger:l,secondElectroTrigger:c,thirdElectroTrigger:d,electroMixer:u,electroActions:f,hologramEffects,onThirdElectroSequenceComplete:h}}const openGate=()=>{isGateOpening||(isGateOpening=!0,leftGate.userData.initialX=leftGate.position.x,rightGate.userData.initialX=rightGate.position.x)};function cleanupScene2(){var n;if(isSceneTransitioning$2=!1,cleanupObjectives(),cleanupAudioManager(),resizeHandler$2&&(window.removeEventListener("resize",resizeHandler$2),resizeHandler$2=null),loadingHiddenHandler&&(window.removeEventListener("loadingScreenHidden-scene2",loadingHiddenHandler),loadingHiddenHandler=null),window.removeEventListener("keydown",handleKeyPress$1),hoverboardKeyListener&&(document.removeEventListener("keydown",hoverboardKeyListener),hoverboardKeyListener=null),animationFrameId$2&&(cancelAnimationFrame(animationFrameId$2),animationFrameId$2=null),(n=sceneInitialization$2==null?void 0:sceneInitialization$2.playerFunction)!=null&&n.player&&disablePlayerMovement(sceneInitialization$2.playerFunction.player),togglePlayerPhysics(!0),togglePlayerControls(!0),cleanupVR(),destroyGUI(),glassMaterial&&(glassMaterial.map&&glassMaterial.map.dispose(),glassMaterial.dispose(),glassMaterial=null),chromeMaterial&&(chromeMaterial.map&&chromeMaterial.map.dispose(),chromeMaterial.dispose(),chromeMaterial=null),hoverboardShaderMaterial&&(hoverboardShaderMaterial.dispose(),hoverboardShaderMaterial=null),sceneInitialization$2&&(sceneInitialization$2.cleanUpCollider(),sceneInitialization$2=null),portal$1&&(portal$1.dispose(),portal$1=null),hologramEffects&&(hologramEffects.forEach(e=>{e.meshes&&e.meshes.forEach(t=>{t.material&&(Array.isArray(t.material)?t.material.forEach(o=>{o.map&&o.map.dispose(),o.dispose()}):(t.material.map&&t.material.map.dispose(),t.material.dispose())),t.geometry&&t.geometry.dispose(),scene$3==null||scene$3.remove(t)})}),hologramEffects=null),ufos.forEach(e=>{scene$3==null||scene$3.remove(e),e.traverse(t=>{t.isMesh&&(t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach(o=>{o.map&&o.map.dispose(),o.dispose()}):(t.material.map&&t.material.map.dispose(),t.material.dispose())))})}),ufos.length=0,waterfallMeshes.forEach(e=>{scene$3==null||scene$3.remove(e),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(t=>{t.map&&t.map.dispose(),t.dispose()}):(e.material.map&&e.material.map.dispose(),e.material.dispose()))}),waterfallMeshes.length=0,gateGroup&&scene$3&&(scene$3.remove(gateGroup),[leftGate,rightGate].forEach(e=>{e&&(removeCollider(e.name.toLowerCase()),e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(t=>{t.map&&t.map.dispose(),t.dispose()}):(e.material.map&&e.material.map.dispose(),e.material.dispose())))}),leftGate=null,rightGate=null,gateGroup=null),removeHoverboardShaderEffect(),scene$3){for(directionArrow&&scene$3.remove(directionArrow),hoverboardShaderEffect&&scene$3.remove(hoverboardShaderEffect),scene$3.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&e.material!==null&&e.material!==void 0&&(Array.isArray(e.material)?e.material.forEach(t=>{t&&(t.map&&t.map.dispose(),t.lightMap&&t.lightMap.dispose(),t.bumpMap&&t.bumpMap.dispose(),t.normalMap&&t.normalMap.dispose(),t.specularMap&&t.specularMap.dispose(),t.envMap&&t.envMap.dispose(),t.emissiveMap&&t.emissiveMap.dispose(),t.dispose())}):(e.material.map&&e.material.map.dispose(),e.material.lightMap&&e.material.lightMap.dispose(),e.material.bumpMap&&e.material.bumpMap.dispose(),e.material.normalMap&&e.material.normalMap.dispose(),e.material.specularMap&&e.material.specularMap.dispose(),e.material.envMap&&e.material.envMap.dispose(),e.material.emissiveMap&&e.material.emissiveMap.dispose(),e.material.dispose())),e.userData={},e.children=[]});scene$3.children.length>0;)scene$3.remove(scene$3.children[0]);scene$3=null}controls$3&&(controls$3.dispose(),controls$3=null),camera$2=null,electroFocusCamera$1=null,transitionCamera=null,isCameraTransitioning$1=!1,isElectroFocusActive$1=!1,isGateOpening=!1,new Vector3$1,hoverboardVisible=!1,hoverboardMesh=null,hoverboardKeyListenerActive=!1,hoverboardKeyListener=null,currentObjectiveNumber=1,cleanupDirectionArrow(),cleanupMinimap$1(),cleanupHoverGame(),window.setCurrentObjectiveNumber&&delete window.setCurrentObjectiveNumber,ufos=[],waterfallMeshes=[],hologramEffects=[],console.log("Scene2 cleanup completed.")}function switchToElectroFocus(n){if(console.log("switchToElectroFocus called with:",{electro:n,electroPosition:n==null?void 0:n.position,isCameraTransitioning:isCameraTransitioning$1,camera:!!camera$2,electroFocusCamera:!!electroFocusCamera$1,controls:!!controls$3}),!isCameraTransitioning$1){if(!n||!n.position){console.error("Invalid electro parameter passed to switchToElectroFocus:",n);return}if(!scene$3||!scene$3.children.includes(n)){console.error("Electro object is not in the scene:",{electro:n,scene:!!scene$3});return}if(!camera$2||!electroFocusCamera$1){console.error("Camera or electroFocusCamera not initialized:",{camera:camera$2,electroFocusCamera:electroFocusCamera$1});return}isCameraTransitioning$1=!0,transitionStartTime$1=performance.now(),transitionStartPosition$1.copy(camera$2.position),transitionStartRotation.copy(camera$2.quaternion),n.position.z===616?(electroFocusCamera$1.position.set(-32,3.9,609),electroFocusCamera$1.lookAt(-31,3,616)):n.position.z===-225?(electroFocusCamera$1.position.set(1,2,-228),electroFocusCamera$1.lookAt(0,2,-228)):(electroFocusCamera$1.position.set(-1,1.3,-249.3),electroFocusCamera$1.lookAt(-1,1.3,-242)),transitionTargetPosition$1.copy(electroFocusCamera$1.position),transitionTargetRotation.copy(electroFocusCamera$1.quaternion),transitionCamera.position.copy(transitionStartPosition$1),transitionCamera.quaternion.copy(transitionStartRotation),transitionCamera.fov=camera$2.fov,transitionCamera.updateProjectionMatrix(),isElectroFocusActive$1=!0,controls$3&&(controls$3.enabled=!1),console.log("switchToElectroFocus completed successfully")}}function switchToPlayerCamera(){isElectroFocusActive$1=!1,controls$3&&(controls$3.enabled=!0)}function updateCameraTransition(n){if(!isCameraTransitioning$1)return;const e=(performance.now()-transitionStartTime$1)/1e3,t=Math.min(e/transitionDuration$1,1),o=t*t*(3-2*t);transitionCamera.position.lerpVectors(transitionStartPosition$1,transitionTargetPosition$1,o),transitionCamera.quaternion.slerpQuaternions(transitionStartRotation,transitionTargetRotation,o);const i=isElectroFocusActive$1?electroFocusCamera$1.fov:camera$2.fov;transitionCamera.fov=MathUtils$1.lerp(transitionCamera.fov,i,o),transitionCamera.updateProjectionMatrix(),t>=1&&(isCameraTransitioning$1=!1,isElectroFocusActive$1?(camera$2.position.copy(electroFocusCamera$1.position),camera$2.quaternion.copy(electroFocusCamera$1.quaternion)):(camera$2.position.copy(transitionTargetPosition$1),camera$2.quaternion.copy(transitionTargetRotation)))}const CDN_BASE=(()=>{if(typeof window<"u"){if(window.ASSETS_CDN_BASE)return window.ASSETS_CDN_BASE;if(window.ASSETS_R2_ACCOUNT_ID)return`https://${window.ASSETS_R2_ACCOUNT_ID}.r2.dev`}return"https://pub-4dc5824a7d6645b29006348054fb1f3f.r2.dev"})(),isDevHost=()=>{if(typeof window>"u")return!1;const n=window.location.hostname;return n==="localhost"||n==="127.0.0.1"||n==="::1"||/^10\./.test(n)||/^192\.168\./.test(n)||/^172\.(1[6-9]|2[0-9]|3[0-1])\./.test(n)},toCDN=n=>{if(n.startsWith("/r2/")){if(isDevHost())return n;const e=n.replace(/^\/r2\//,"/");return CDN_BASE?`${CDN_BASE}${e}`:e}return n},assetsEntry$2={characters:[{name:"electro",path:"/characters/electro_facialv7.glb"}],models:[{name:"garden",path:toCDN("/r2/island.glb"),shadow:!1},{name:"grass",path:"/scene11/grass_emision.glb",shadow:!1},{name:"wheat",path:"/scene11/wheat-opt.glb",shadow:!1},{name:"cactus",path:"/scene11/carnivorous2.glb",shadow:!1},{name:"carnivorus",path:"/scene11/carnivorous2.glb",shadow:!1},{name:"glowing_mushroom",path:"/scene11/glowing_mush_v2.glb",shadow:!1},{name:"pearl_mushroom",path:"/scene11/pearl_mushroom.glb",shadow:!1},{name:"ufo",path:"/scene11/ufo2.glb",shadow:!1}],textures:[{name:"portal",path:"/scene11/portal.png"},{name:"groundBlue",path:"/scene11/groundBlue.png"}],videoTextures:[],audios:[{name:"background",path:"/scene11/background.mp3",volume:.2,loop:!0},{name:"electrosound",path:"/scene11/electro2.wav"},{name:"ufosound",path:"/scene11/ufo3.mp3",volume:1},{name:"attacksound",path:"/scene11/beast-plant.mp3",volume:1}],hdris:[],cubeMaps:[],vfxs:[{name:"entryvfx",path:"/vfxFiles/entryvfx.json"}],pathFiles:[],jsonFiles:[],fonts:[],svgs:[]};let container,canvas,ctx,toggleBtn,visible=!1,physicsController,backgroundPattern=null;const markers=[{type:"portal",color:"#ff00ff",size:10,position:{x:2,y:4,z:-60}},{type:"friend",color:"#ffffff",size:8,position:{x:-14,y:8,z:-12}},{type:"hostile",color:"#f05454",size:9,position:{x:-5,y:2.25,z:-37.5}},{type:"hostile",color:"#f05454",size:9,position:{x:-4,y:6,z:0}}],playerMarker={color:"#00f6ff",size:6};function drawMarkerSymbol(n,e){switch(n.save(),n.strokeStyle=e.color,n.fillStyle=e.color,n.lineWidth=2,n.shadowColor=e.color,n.shadowBlur=10,e.type){case"portal":n.setLineDash([4,4]),n.strokeStyle="#fff";for(const r of[e.size*.6,e.size])n.beginPath(),n.arc(0,0,r,Math.PI*.2,Math.PI*1.8),n.stroke();break;case"friend":n.beginPath(),n.arc(0,0,e.size*.7,0,Math.PI*2),n.stroke(),n.beginPath(),n.arc(-e.size*.8,-e.size*.8,2,0,Math.PI*2),n.fill(),n.beginPath(),n.arc(e.size*.8,-e.size*.8,2,0,Math.PI*2),n.fill();break;case"hostile":const t=e.size,o=(Math.sin(performance.now()*.005)+1)/2,i=t*(.9+o*.2),s=Math.floor(70+o*60).toString(16);n.save(),n.fillStyle=e.color+s,n.shadowBlur=0;for(let r=0;r<3;r++){const a=r/3*Math.PI*2;n.beginPath(),n.moveTo(Math.cos(a)*(i*.2),Math.sin(a)*(i*.2)),n.arc(Math.cos(a)*(i*.5),Math.sin(a)*(i*.5),i*.5,a+Math.PI*.3,a+Math.PI*.7),n.closePath(),n.fill(),n.stroke()}n.beginPath(),n.arc(0,0,i*.2,0,Math.PI*2),n.fillStyle=e.color,n.shadowColor=e.color,n.shadowBlur=10,n.fill(),n.restore();break}n.restore()}function drawSciFiMarker(n,e,t,o){n.save(),n.translate(e,t);const i=(Math.sin(performance.now()*.004)+1)/2;n.fillStyle=o.color+"33",n.beginPath(),n.arc(0,0,o.size+2+i*2,0,Math.PI*2),n.fill(),drawMarkerSymbol(n,o),n.restore()}function drawPlayerChevron(n){n.save(),n.fillStyle=playerMarker.color,n.strokeStyle="#ffffff",n.lineWidth=1.5,n.shadowColor=playerMarker.color,n.shadowBlur=18,n.beginPath(),n.moveTo(0,-15),n.lineTo(9,9),n.lineTo(0,4),n.lineTo(-9,9),n.closePath(),n.fill(),n.stroke(),n.restore()}function createBackgroundGrid(){const n=document.createElement("canvas"),e=n.getContext("2d"),t=40;return n.width=t,n.height=t,e.strokeStyle="rgba(0, 179, 215, 0.58)",e.lineWidth=.5,e.beginPath(),e.moveTo(0,t),e.lineTo(t,0),e.moveTo(0,0),e.lineTo(t,t),e.stroke(),n}function createMinimap(n,e,t){physicsController=e,container=document.createElement("div"),container.id="minimap-container",document.body.appendChild(container),canvas=document.createElement("canvas"),canvas.id="minimap-canvas",canvas.width=210,canvas.height=210,container.appendChild(canvas),ctx=canvas.getContext("2d"),toggleBtn=document.createElement("button"),toggleBtn.id="minimap-toggle",toggleBtn.textContent="Hide Map",document.body.appendChild(toggleBtn),toggleBtn.addEventListener("click",()=>{visible=!visible,container.classList.toggle("visible"),toggleBtn.textContent=visible?"Hide Map":"Show Map"});const o=createBackgroundGrid();backgroundPattern=ctx.createPattern(o,"repeat"),setTimeout(()=>{visible=!0,container.classList.add("visible")},1200)}function drawCurvedPath(n,e,t,o,i,s,r=[]){const a=o-e,l=i-t,c=Math.hypot(a,l);let d=e+a/2,u=t+l/2;if(c>10){const h=-l/c*25,m=a/c*25,p=1;d+=h*p,u+=m*p}n.save(),n.strokeStyle=s,n.lineWidth=4,n.lineCap="round",n.shadowColor=s.replace("0.8","0.5").replace("0.6","0.4").replace("0.7","0.4").replace("0.9","0.5"),n.shadowBlur=6,n.setLineDash(r),n.beginPath(),n.moveTo(e,t),n.quadraticCurveTo(d,u,o,i),n.stroke(),n.restore()}function updateMinimap(){var g;if(!visible||!ctx||!((g=physicsController==null?void 0:physicsController.playerFunction)!=null&&g.player))return;const n=physicsController.playerFunction.player,e=canvas.width/2,t=canvas.height/2,o=e-2,i=2.5;ctx.clearRect(0,0,canvas.width,canvas.height),ctx.save(),ctx.beginPath(),ctx.arc(e,t,o,0,Math.PI*2),ctx.clip(),ctx.translate(e,t),ctx.rotate(n.rotation.y);const s=-(n.position.x*i),r=-(n.position.z*i);ctx.translate(s,r),ctx.fillStyle=backgroundPattern,ctx.fillRect(-e-s,-t-r,canvas.width,canvas.height),ctx.restore();const a=performance.now(),l=a*.002%(Math.PI*2),c=ctx.createRadialGradient(e,t,0,e,t,o);c.addColorStop(0,"rgba(0, 255, 255, 0.25)"),c.addColorStop(1,"rgba(0, 255, 255, 0)"),ctx.fillStyle=c,ctx.beginPath(),ctx.moveTo(e,t),ctx.arc(e,t,o,l-.3,l+.3),ctx.closePath(),ctx.fill();const d=(Math.sin(a*.002)+1)/2;ctx.strokeStyle=`rgba(0, 255, 255, ${.3-d*.3})`,ctx.lineWidth=2,ctx.beginPath(),ctx.arc(e,t,o*d,0,Math.PI*2),ctx.stroke();let u=0,f=0,h=0,m=0;const p=markers.find(y=>y.type==="friend"),v=markers.find(y=>y.type==="portal");if(p){const y=p.position.x-n.position.x,w=p.position.z-n.position.z;u=y*i,f=w*i}if(v){const y=v.position.x-n.position.x,w=v.position.z-n.position.z;h=y*i,m=w*i}ctx.save(),ctx.translate(e,t),ctx.rotate(n.rotation.y);for(const y of markers){const w=y.position.x-n.position.x,_=y.position.z-n.position.z,S=w*i,C=_*i;Math.hypot(S,C)<o&&drawSciFiMarker(ctx,S,C,y)}p&&drawCurvedPath(ctx,0,0,u,f,"rgba(0, 255, 128, 0.9)",[]),v&&drawCurvedPath(ctx,0,0,h,m,"rgba(0, 128, 255, 0.9)",[]),ctx.restore(),ctx.save(),ctx.translate(e,t),drawPlayerChevron(ctx),ctx.restore()}function cleanupMinimap(){toggleBtn&&(toggleBtn.removeEventListener("click",toggleBtn.onclick||toggleBtn._listener),toggleBtn.innerHTML=""),container&&(container.innerHTML="",container.remove()),toggleBtn&&toggleBtn.parentNode&&toggleBtn.parentNode.removeChild(toggleBtn),backgroundPattern&&backgroundPattern.image&&(backgroundPattern.image=null),container=null,canvas=null,ctx=null,toggleBtn=null,visible=!1,backgroundPattern=null}const objectives={1:{main:"Reach near the UFO",sub:"Get into the trigger zone to see the electro."},2:{main:"Find the portal",sub:"Hint: use the minimap."}};function createWindMaterial(n,e={}){const{amplitude:t=.12,frequency:o=.6,speed:i=1.2,windDirection:s=new Vector2$1(1,0)}=e,r=n.clone();return r.onBeforeCompile=a=>{a.uniforms.uTime={value:0},a.uniforms.uWindAmplitude={value:t},a.uniforms.uWindFrequency={value:o},a.uniforms.uWindSpeed={value:i},a.uniforms.uWindDirection={value:s},a.vertexShader=a.vertexShader.replace("#include <common>",`#include <common>
uniform float uTime;
uniform float uWindAmplitude;
uniform float uWindFrequency;
uniform float uWindSpeed;
uniform vec2 uWindDirection;
`),a.vertexShader=a.vertexShader.replace("#include <begin_vertex>",`#include <begin_vertex>
// Wind sway displacement (object space before instancing transform)
vec2 windDir = normalize(uWindDirection);
float localHeight = clamp(position.y, 0.0, 1.0);
float phase = dot(position.xz, windDir) * uWindFrequency + uTime * uWindSpeed;
#ifdef USE_INSTANCING
phase += float(gl_InstanceID) * 0.37;
#endif
float sway = sin(phase) * uWindAmplitude * localHeight;
transformed.xz += windDir * sway;
`),r.userData.shader=a},r.needsUpdate=!0,r}function attachWindUpdater(n){const e=performance.now();n.onBeforeRender=function(t,o,i,s,r){const a=r&&r.userData?r.userData.shader:null;a&&a.uniforms&&a.uniforms.uTime&&(a.uniforms.uTime.value=(performance.now()-e)/1e3)}}function hexToRgb(n){n=n.replace(/^#/,""),n.length===3&&(n=n.split("").map(t=>t+t).join(""));const e=parseInt(n,16);return{r:e>>16&255,g:e>>8&255,b:e&255}}function makeColorTest(n,e=10){const{r:t,g:o,b:i}=hexToRgb(n);return(s,r,a,l)=>Math.abs(s-t)<=e&&Math.abs(r-o)<=e&&Math.abs(a-i)<=e}function spreadInstancedRandomOnUVArea(n,e,t,o,i,s,r,a,l,c){let d=i;d=makeColorTest(i);let u=null;if(e.traverse(h=>{h.isMesh&&h.name===t&&(u=h)}),!u)return;new TextureLoader().load(o,function(h){const m=h.image,p=document.createElement("canvas");p.width=m.width,p.height=m.height;const v=p.getContext("2d");v.drawImage(m,0,0);const g=v.getImageData(0,0,m.width,m.height).data,y=[];for(let F=0;F<m.height;F++)for(let M=0;M<m.width;M++){const R=(F*m.width+M)*4,O=g[R],$=g[R+1],T=g[R+2],D=g[R+3];d(O,$,T,D)&&y.push({u:M/(m.width-1),v:1-F/(m.height-1)})}if(y.length===0)return;const w=u.geometry,_=w.attributes.position,S=w.attributes.uv,C=w.index,A=[];for(let F=0;F<C.count;F+=3){const M=C.getX(F),R=C.getX(F+1),O=C.getX(F+2),$=new Vector2$1(S.getX(M),S.getY(M)),T=new Vector2$1(S.getX(R),S.getY(R)),D=new Vector2$1(S.getX(O),S.getY(O)),P=new Vector3$1(_.getX(M),_.getY(M),_.getZ(M)),L=new Vector3$1(_.getX(R),_.getY(R),_.getZ(R)),B=new Vector3$1(_.getX(O),_.getY(O),_.getZ(O));A.push({uvA:$,uvB:T,uvC:D,posA:P,posB:L,posC:B})}function E(F,M,R,O,$,T){return new Vector3$1().addScaledVector(F,O).addScaledVector(M,$).addScaledVector(R,T)}function k(F,M,R,O){const $=R.clone().sub(M),T=O.clone().sub(M),D=F.clone().sub(M),P=$.dot($),L=$.dot(T),B=T.dot(T),b=D.dot($),z=D.dot(T),N=P*B-L*L;if(N===0)return null;const G=(B*b-L*z)/N,K=(P*z-L*b)/N,ne=1-G-K;return ne>=-1e-4&&G>=-1e-4&&K>=-1e-4?{u:ne,v:G,w:K}:null}const I=[];for(let F=0;F<r;F++){const M=Math.floor(Math.random()*y.length),R=new Vector2$1(y[M].u,y[M].v);for(let O=0;O<A.length;O++){const $=A[O],T=k(R,$.uvA,$.uvB,$.uvC);if(T){const D=E($.posA,$.posB,$.posC,T.u,T.v,T.w);u.localToWorld(D),I.push(D);break}}}if(s&&I.length>0){n.userData||(n.userData={}),n.userData.grassGroup||(n.userData.grassGroup=new Group,n.add(n.userData.grassGroup));const F=!c||c.wind!==!1,M=c.windOptions?c.windOptions:{amplitude:.12,frequency:.6,speed:1.1},R=F?createWindMaterial(s.material,M):s.material,O=new InstancedMesh(s.geometry,R,I.length),$=new Object3D;for(let T=0;T<I.length;T++){$.position.copy(I[T]);let D=.8+Math.random()*.8;$.scale.set(D,D,D),$.updateMatrix(),O.setMatrixAt(T,$.matrix)}F&&attachWindUpdater(O),n.userData.grassGroup.add(O)}if(a&&I.length>0){n.userData||(n.userData={}),n.userData.grassGroup||(n.userData.grassGroup=new Group,n.add(n.userData.grassGroup));const F=!c||c.wind!==!1,M=c.windOptions?c.windOptions:{amplitude:.07,frequency:.7,speed:1},R=F?createWindMaterial(a.material,M):a.material,O=new InstancedMesh(a.geometry,R,I.length),$=new Object3D;for(let T=0;T<I.length;T++){$.position.copy(I[T]);let D=.8+Math.random()*.8;$.scale.set(D,D,D),$.updateMatrix(),O.setMatrixAt(T,$.matrix)}F&&attachWindUpdater(O),n.userData.grassGroup.add(O)}})}function createHologram(n,e,t){function o(M,R){return new ShaderMaterial({uniforms:{glowColor:{value:new Color(M)},ringRadius:{value:R},ringThickness:{value:.05},glowStrength:{value:.3},intensity:{value:2},time:{value:0}},vertexShader:`
                uniform float time;
                varying vec2 vUv;

                void main() {
                    vUv = uv;
                    float angle = time * 1.0;
                    mat2 rotationMatrix = mat2(
                        cos(angle), -sin(angle),
                        sin(angle), cos(angle)
                    );
                    vUv = rotationMatrix * (vUv - 0.5) + 0.5;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,fragmentShader:`
                uniform vec3 glowColor;
                uniform float ringRadius;
                uniform float ringThickness;
                uniform float glowStrength;
                uniform float intensity;
                varying vec2 vUv;

                void main() {
                    vec2 p = vUv * 2.0 - 1.0;
                    float dist = length(p);
                    float ring = smoothstep(ringRadius - ringThickness, ringRadius, dist) -
                                 smoothstep(ringRadius, ringRadius + ringThickness, dist);
                    float glow = smoothstep(ringRadius, ringRadius + glowStrength, dist);
                    glow = 1.0 - glow;
                    glow = pow(glow, intensity);
                    vec3 color = glowColor * glow + glowColor * ring;
                    float alpha = (dist < (ringRadius - ringThickness)) ? 0.0 : max(ring, glow * 0.5);
                    gl_FragColor = vec4(color, alpha);
                }
            `,transparent:!0})}const i=new PlaneGeometry(4,4),s=new ShaderMaterial({uniforms:{glowColor:{value:new Color(43775)},coreRadius:{value:.3},glowRadius:{value:.6},intensity:{value:2.5},time:{value:0}},vertexShader:`
            uniform float time;
            varying vec2 vUv;

            void main() {
                vUv = uv;
                float angle = time * 1.0;
                mat2 rotationMatrix = mat2(
                    cos(angle), -sin(angle),
                    sin(angle), cos(angle)
                );
                vUv = rotationMatrix * (vUv - 0.5) + 0.5;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,fragmentShader:`
            uniform vec3 glowColor;
            uniform float coreRadius;
            uniform float glowRadius;
            uniform float intensity;
            varying vec2 vUv;

            void main() {
                vec2 p = vUv * 2.0 - 1.0;
                float dist = length(p);
                float core = 1.0 - smoothstep(coreRadius - 0.01, coreRadius, dist);
                float glow = smoothstep(coreRadius, glowRadius, dist);
                glow = 1.0 - glow;
                glow = pow(glow, intensity);
                vec3 color = glowColor * glow + glowColor * core;
                float alpha = max(core, glow * 0.6);
                gl_FragColor = vec4(color, alpha);
            }
        `,transparent:!0}),r=new Mesh(i,s);r.rotation.x=Math.PI/2,r.position.y=-1;const a=o(43775,.07),l=new Mesh(i,a);l.rotation.x=Math.PI/2,l.position.y=-.18;const c=o(43775,.11),d=new Mesh(i,c);d.rotation.x=Math.PI/2,d.position.y=-.18;const u=new ShaderMaterial({uniforms:{glowColor:{value:new Color(43775)},rectSize:{value:new Vector2$1(.02,.01)},numRects:{value:72},radius:{value:.5},time:{value:.001}},vertexShader:`
            varying vec2 vUv;
            void main() {
                vUv = uv;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,fragmentShader:`
            uniform vec3 glowColor;
            uniform vec2 rectSize;
            uniform int numRects;
            uniform float radius;
            uniform float time;
            varying vec2 vUv;

            void main() {
                vec2 uv = vUv * 2.0 - 1.0;
                float angleStep = 6.28318 / float(numRects);
                float ring = 0.0;

                for (int i = 0; i < 72; i++) {
                    if (i >= numRects) break;
                    float angle = float(i) * angleStep + time;
                    vec2 rectCenter = vec2(cos(angle), sin(angle)) * radius;
                    mat2 rotationMatrix = mat2(
                        cos(angle), -sin(angle),
                        sin(angle), cos(angle)
                    );
                    vec2 rotatedUV = rotationMatrix * (uv - rectCenter);
                    rotatedUV = abs(rotatedUV);
                    float box = step(rotatedUV.x, rectSize.x) * step(rotatedUV.y, rectSize.y);
                    float softBox = smoothstep(0.02, 0.03, box);
                    ring += softBox;
                }

                vec3 color = glowColor * ring;
                gl_FragColor = vec4(color, ring);
            }
        `,transparent:!0}),f=new Mesh(i,u);f.rotation.x=Math.PI/2,f.position.y=-1;let h={u_time:{value:0}},m=new ShaderMaterial({uniforms:h,transparent:!0,blending:AdditiveBlending,side:DoubleSide,depthWrite:!1,vertexShader:`
            varying vec2 vUv;
            varying vec3 vPosition;
            void main() {
                vUv = uv;
                vPosition = position;
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
        `,fragmentShader:`
            precision mediump float;
            uniform float u_time;
            varying vec2 vUv;
            varying vec3 vPosition;

            void main() {
                if (vUv.y < 0.5) discard;
                vec3 neonBlue = vec3(0.0, 0.6, 1.2);  
                float glow = sin(u_time * 3.0) * 0.2 + 0.8;
                float edgeFade = smoothstep(1.0, 0.5, abs(vUv.y - 0.5) * 2.0);
                vec3 color = neonBlue * glow * edgeFade;
                gl_FragColor = vec4(color, 1.0);
            }
        `}),p=new CylinderGeometry(2,2,16,32,1,!0),v=new Mesh(p,m);v.position.y=-1,v.rotation.x=Math.PI;const g=200;function y(M,R){let O=Math.random()*Math.PI*2,$=Math.sqrt(Math.random())*M,T=Math.cos(O)*$,D=Math.sin(O)*$,P=(Math.random()-.5)*R;return new Vector3$1(T,P,D)}const w=new Float32Array(g*3);for(let M=0;M<g;M++){let R=y(1.7,6);w[M*3]=R.x,w[M*3+1]=R.y,w[M*3+2]=R.z}const _=new BufferGeometry;_.setAttribute("position",new BufferAttribute(w,3));const S=new ShaderMaterial({uniforms:{u_time:{value:0}},vertexShader:`
            uniform float u_time;
            varying vec3 vColor;
            void main() {
                vec3 newPosition = position;
                float speed = 0.7; // faster movement
                float height = 6.0;
                // Animate particles moving upward, wrapping around
                newPosition.y = mod(position.y + u_time * speed + height * 0.5, height) - height * 0.5;
                vColor = vec3(0.0, 0.6, 1.2);
               
                // Calculate perspective scaling for consistent size
                vec4 mvPosition = modelViewMatrix * vec4(newPosition, 1.0);
                gl_PointSize = 0.15 * (300.0 / -mvPosition.z); // even smaller particles
               
                gl_Position = projectionMatrix * mvPosition;
            }
        `,fragmentShader:`
            precision mediump float;
            varying vec3 vColor;
            void main() {
                float dist = length(gl_PointCoord - vec2(0.5));
                float alpha = smoothstep(0.5, 0.2, dist);
                gl_FragColor = vec4(vColor, alpha);
            }
        `,transparent:!0,depthWrite:!1,blending:AdditiveBlending}),C=new Points(_,S);C.position.set(0,-10,0);const A=new Group;A.add(r,l,d,f,v,C),[[0,0,0],[0,-.76,0]].forEach((M,R)=>{const O=new PlaneGeometry(8,8),$={time:{value:0},resolution:{value:new Vector2$1(window.innerWidth,window.innerHeight)},zoom:{value:1}},T=new ShaderMaterial({vertexShader:`
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,fragmentShader:`
                #ifdef GL_ES
                precision highp float;
                #endif

                uniform float time;
                uniform vec2 resolution;
                uniform float zoom;
                varying vec2 vUv;

                #define PI 3.1415926535

                mat2 rotate3d(float angle) {
                    return mat2(cos(angle), -sin(angle), sin(angle), cos(angle));
                }

                void main() {
                    vec2 p = (vUv * 2.0 - 1.0) * zoom;
                    p = rotate3d(time * 2.0 * PI) * p;
                   
                    float t = 0.075 / abs(0.4 - length(p));
                   
                    // vec3 color = 1.0 - exp(-vec3(t) * vec3(0.13 * (sin(time) + 12.0), abs(p.y) * 0.7, 3.0));
                    vec3 color = 1.0 - exp(-vec3(t) * vec3(0.01, 0.02, 0.8 * (sin(time) + 2.0)));
                    float alpha = smoothstep(0.0, 1.0, length(color) * 0.5);
                   
                    gl_FragColor = vec4(color, alpha);
                }
            `,uniforms:$,side:DoubleSide,transparent:!0,blending:CustomBlending,blendEquation:AddEquation,blendSrc:SrcAlphaFactor,blendDst:OneFactor,depthWrite:!1,depthTest:!0}),D=new Mesh(O,T);D.position.set(...M),D.rotation.x=Math.PI/2,R===0&&D.scale.set(3,3,3),A.add(D)}),A.scale.set(1,1,1),A.position.set(0,-.3,0);const k=[];let I=null,F=[];return A.traverse(M=>{var R,O,$;M.isMesh&&M.material&&((R=M.material.uniforms)!=null&&R.time)&&k.push(M),((O=M.geometry)==null?void 0:O.type)==="CylinderGeometry"&&(I=M),(($=M.geometry)==null?void 0:$.type)==="RingGeometry"&&F.push(M)}),{update:M=>{const R=performance.now()*1e-4;a.uniforms.time.value=R,u.uniforms.time.value=R,h.u_time.value+=M,S.uniforms.u_time.value+=M,A.children.forEach(O=>{O.material&&O.material.uniforms&&O.material.uniforms.time&&(O.material.uniforms.time.value+=M)})},meshes:[A],timeUniformMeshes:k,cylinderMesh:I,ringMeshes:F}}const AUTO_MOVE_CONFIG={maxDistance:1,speed:1,sequenceDuration:18e3,ufoSequenceDuration:5,ufoVolumeRange:{min:.15,max:.5}},ELECTRO_POSITION={initial:{x:22,y:50,z:78},final:{x:-14,y:9.8,z:-12},rotation:{x:0,y:-Math.PI/2,z:0}},UFO_PATH={start:{x:10,y:40,z:78},end:{x:-14,y:24,z:-12},arcAmount:8,scale:.1};class ElectroState{constructor(){this.isAutoMoving=!1,this.autoMoveDistance=0,this.isElectroSequenceActive=!1,this.isUFOSequenceActive=!1,this.isElectroSoundPlaying=!1,this.ufoStartTime=0,this.sceneStartTime=0,this.electroSoundStartTime=0,this.electroSoundDuration=0,this.autoMoveCallback=null,this.electroTimeoutIds=[],this.isCleanupInProgress=!1,this.onSequenceCompleteCallback=null,this.triggerPointReference=null}reset(){this.isAutoMoving=!1,this.autoMoveDistance=0,this.isElectroSequenceActive=!1,this.isUFOSequenceActive=!1,this.isElectroSoundPlaying=!1,this.autoMoveCallback=null,this.electroTimeoutIds=[],this.isCleanupInProgress=!1,this.onSequenceCompleteCallback=null,this.triggerPointReference=null}clearTimeouts(){this.electroTimeoutIds.forEach(e=>clearTimeout(e)),this.electroTimeoutIds=[]}cancelAnimationFrame(){}}let state=new ElectroState;function getElectroState(){return state}let shapeKeyControls=null,allAssets$1=null,electroComponents$1=null,scene$2=null,player=null,controls$2=null,renderer$3=null,ufo$1=null,hologramEffect$1=null,ufoPath=null,electroActions=null,ufoSound=null,spotlight=null;function resetPlayerState(){playerState.velocity.set(0,0,0),playerState.fwdPressed=!1,playerState.bkdPressed=!1,playerState.lftPressed=!1,playerState.rgtPressed=!1,playerState.shiftPressed=!1,updatePlayerAnimation(!1,!1)}function setupElectroActions(n){const e={arm_gesture:"ARM_GESTURE",breathing_idle:"BREATHING_IDLE",entering_code:"ENTERING_CODE",head_nod_yes:"HEAD_NOD_YES",jumping:"JUMPING",landing:"LANDING",looking_behind:"LOOKING_BEHIND",opening_on:"OPENING_ON ",reaching_out:"REACHING_OUT",running:"RUNNING",standing_blocking_idle:"STANDING_BLOCKING_IDLE",talking:"TALKING",talking_02:"TALKING_02",thoughtful_head_shake:"THOUGHTFUL_ HEAD_ SHAKE",walking:"WALKING",waving:"WAVING"},t={};return Object.entries(e).forEach(([o,i])=>{t[o]=n.characters.animations.electro.actions[i]}),Object.values(t).forEach(o=>{o&&(o.setLoop(LoopOnce),o.clampWhenFinished=!0)}),t.talking_02&&(t.talking_02.timeScale=.5),t}function createSpotlight(){return spotlight||(spotlight=new SpotLight(16777215,2,40,Math.PI/6,.3,1),spotlight.position.set(-14,15,-12),spotlight.target.position.set(-14,0,-12),scene$2.add(spotlight),scene$2.add(spotlight.target),spotlight.castShadow=!0,spotlight.shadow.mapSize.width=1024,spotlight.shadow.mapSize.height=1024,spotlight.shadow.bias=-.002,spotlight.shadow.normalBias=.02,spotlight)}function initializeUFO(){if(!scene$2||!allAssets$1){console.error("Scene or assets not initialized when trying to create UFO");return}const n=allAssets$1.models.gltf.ufo;if(!n){console.error("UFO model not found in assets");return}ufo$1=n.clone(),ufo$1.visible=!1,ufo$1.scale.set(UFO_PATH.scale,UFO_PATH.scale,UFO_PATH.scale),scene$2.add(ufo$1),ufoPath={getPoint:e=>{const t=Math.sin(Math.PI*e)*UFO_PATH.arcAmount;return new Vector3$1(UFO_PATH.start.x+(UFO_PATH.end.x-UFO_PATH.start.x)*e,UFO_PATH.start.y+(UFO_PATH.end.y-UFO_PATH.start.y)*e+t*(1-e),UFO_PATH.start.z+(UFO_PATH.end.z-UFO_PATH.start.z)*e)}}}function updateUFO(){var i;if(!state.isUFOSequenceActive||!ufoPath||!ufo$1)return;const n=performance.now(),e=Math.min((n-state.ufoStartTime)/(AUTO_MOVE_CONFIG.ufoSequenceDuration*2e3),1),t=e<.5?Math.pow(e,2)*2:1-Math.pow(1-e,2)*2,o=ufoPath.getPoint(t);if(ufo$1.position.copy(o),ufoSound&&ufoSound.isPlaying){const s=AUTO_MOVE_CONFIG.ufoVolumeRange.min+(AUTO_MOVE_CONFIG.ufoVolumeRange.max-AUTO_MOVE_CONFIG.ufoVolumeRange.min)*t;ufoSound.setVolume(s)}if(e<1){const s=ufoPath.getPoint(Math.min(t+.01,1)),r=new Vector3$1().subVectors(s,o).normalize(),a=Math.atan2(r.x,r.z);ufo$1.rotation.y=a+2.6*(1-t)}else state.isUFOSequenceActive=!1,(i=hologramEffect$1==null?void 0:hologramEffect$1.meshes)!=null&&i[0]&&(hologramEffect$1.meshes[0].visible=!0)}function animateHologram(n){if(!hologramEffect$1)return;const e=performance.now()*.001;if(hologramEffect$1.timeUniformMeshes)for(const t of hologramEffect$1.timeUniformMeshes)t.material.uniforms.time.value=e;if(hologramEffect$1.cylinderMesh){const t=1+Math.sin(e*2)*.1;hologramEffect$1.cylinderMesh.scale.set(t,1,t),hologramEffect$1.cylinderMesh.position.y=-2+Math.sin(e*1.5)*.2}if(hologramEffect$1.ringMeshes)for(const t of hologramEffect$1.ringMeshes)t.rotation.z+=n*.5}function triggerAutoMoveAndDisableControls(n,e){state.isAutoMoving=!0,state.autoMoveDistance=0,state.autoMoveCallback=e,togglePlayerControls(!1),controls$2&&(controls$2.enabled=!1),resetPlayerState()}function autoPlayerMovement(n){if(!state.isAutoMoving||!player)return;const e=new Vector3$1(0,0,-1).applyQuaternion(player.quaternion),t=AUTO_MOVE_CONFIG.speed*n;player.position.addScaledVector(e,t),state.autoMoveDistance+=t,state.autoMoveDistance>=AUTO_MOVE_CONFIG.maxDistance?(state.isAutoMoving=!1,state.autoMoveDistance=0,resetPlayerState(),typeof state.autoMoveCallback=="function"&&(state.autoMoveCallback(),state.autoMoveCallback=null)):updatePlayerAnimation(!0,!1)}function setDependencies(n,e,t,o,i){player=e,scene$2=t,controls$2=o,renderer$3=i}function initializeElectro(n,e,t,o,i,s){setDependencies(o,t,n,i,s),allAssets$1=e,initializeUFO(),createSkipButton(skipElectroSequence);const r=allAssets$1.characters.models.electro;return r?(scene$2.add(r),r.position.set(ELECTRO_POSITION.initial.x,ELECTRO_POSITION.initial.y,ELECTRO_POSITION.initial.z),r.rotation.set(0,Math.PI,0),r.visible=!0,shapeKeyControls=setupShapeKeyAnimations(r),electroActions=setupElectroActions(e),allAssets$1.characters.animations.electro.mixer&&(allAssets$1.characters.animations.electro.mixer.timeScale=1),electroComponents$1={electro:r,electroActions,electroMixer:allAssets$1.characters.animations.electro.mixer},createSpotlight(),electroComponents$1):(console.error("Electro model not found in assets"),null)}function startElectroSequence(){if(state.isElectroSequenceActive){console.log("Electro sequence already active, ignoring trigger");return}console.log("Starting electro sequence"),state.isElectroSequenceActive=!0,state.sceneStartTime=performance.now(),startUFOSequence()}function startUFOSequence(){if(state.isUFOSequenceActive=!0,state.ufoStartTime=performance.now(),ufo$1.visible=!0,allAssets$1.audios.ufosound&&(ufoSound=allAssets$1.audios.ufosound,ufoSound.setVolume(AUTO_MOVE_CONFIG.ufoVolumeRange.min),ufoSound.play()),renderer$3){hologramEffect$1=createHologram(),setHologramEffect(hologramEffect$1);const n=hologramEffect$1.meshes[0];n.position.set(-14,23.5,-12),n.visible=!1,scene$2.add(n)}updateUFO()}function startElectroAppearanceSequence(n,e=null){var o;if(!(electroComponents$1!=null&&electroComponents$1.electro))return;state.onSequenceCompleteCallback=n,state.triggerPointReference=e;const t=electroComponents$1.electro;if(t.position.set(ELECTRO_POSITION.final.x,ELECTRO_POSITION.final.y,ELECTRO_POSITION.final.z),t.rotation.set(ELECTRO_POSITION.rotation.x,ELECTRO_POSITION.rotation.y,ELECTRO_POSITION.rotation.z),t.visible=!1,electroActions.landing){electroActions.landing.reset(),electroActions.landing.setLoop(LoopOnce),electroActions.landing.clampWhenFinished=!0,electroActions.landing.play(),electroComponents$1.electroMixer&&electroComponents$1.electroMixer.update(.01),t.visible=!0;const i=electroActions.landing.getClip().duration*1e3;state.electroTimeoutIds.push(setTimeout(()=>{electroActions.talking_02&&(electroActions.talking_02.reset(),electroActions.talking_02.setLoop(LoopRepeat),electroActions.talking_02.clampWhenFinished=!1,electroActions.talking_02.fadeIn(.5).play())},i))}if(allAssets$1.audios.electrosound){const i=allAssets$1.audios.electrosound;i.play(),state.isElectroSoundPlaying=!0,state.electroSoundStartTime=performance.now(),state.electroSoundDuration=((o=i.buffer)==null?void 0:o.duration)||0}shapeKeyControls&&shapeKeyControls.startAnimation(),showSkipButton(),state.electroTimeoutIds.push(setTimeout(completeElectroSequence,AUTO_MOVE_CONFIG.sequenceDuration))}function completeElectroSequence(){var t;if(!state.isElectroSequenceActive)return;hideSkipButton(),(t=allAssets$1.audios.electrosound)!=null&&t.isPlaying&&allAssets$1.audios.electrosound.stop(),ufoSound!=null&&ufoSound.isPlaying&&ufoSound.stop(),electroComponents$1!=null&&electroComponents$1.electroMixer&&electroComponents$1.electroMixer.stopAllAction(),shapeKeyControls&&typeof shapeKeyControls.stopAnimation=="function"&&shapeKeyControls.stopAnimation(),togglePlayerControls(!0),controls$2&&(controls$2.enabled=!0),typeof showObjective=="function"&&showObjective(2,objectives);const n=state.triggerPointReference;n&&typeof n.setVFXVisible=="function"&&n.setVFXVisible(!1);const e=state.onSequenceCompleteCallback;typeof e=="function"&&e(),electroComponents$1!=null&&electroComponents$1.electro&&electroComponents$1.electro.position.set(22,0,78),state.isElectroSequenceActive=!1,state.isUFOSequenceActive=!1,state.isElectroSoundPlaying=!1,state.clearTimeouts(),state.onSequenceCompleteCallback=null,state.triggerPointReference=null}function skipElectroSequence(){state.isElectroSequenceActive&&(console.log("Electro sequence skipped by user."),state.clearTimeouts(),completeElectroSequence())}function hideElectroObjects(){var n;electroComponents$1!=null&&electroComponents$1.electro&&(electroComponents$1.electro.visible=!1),ufo$1&&(ufo$1.visible=!1),(n=hologramEffect$1==null?void 0:hologramEffect$1.meshes)!=null&&n[0]&&(hologramEffect$1.meshes[0].visible=!1),spotlight&&(spotlight.visible=!1,spotlight.target&&(spotlight.target.visible=!1))}function phasedCleanupAllObjects(n,e){const t=[];t.push(()=>{ufoSound!=null&&ufoSound.isPlaying&&(ufoSound.stop(),ufoSound=null)}),t.push(()=>{var i;if((i=hologramEffect$1==null?void 0:hologramEffect$1.meshes)!=null&&i[0]){const s=hologramEffect$1.meshes[0];s.traverse(r=>{r.isMesh&&(r.geometry&&r.geometry.dispose(),r.material&&(Array.isArray(r.material)?r.material.forEach(a=>a.dispose()):r.material.dispose()))}),scene$2.remove(s),hologramEffect$1=null}}),t.push(()=>{ufo$1&&(ufo$1.traverse(i=>{i.isMesh&&(i.geometry&&i.geometry.dispose(),i.material&&(Array.isArray(i.material)?i.material.forEach(s=>s.dispose()):i.material.dispose()))}),scene$2.remove(ufo$1),ufo$1=null)}),t.push(()=>{spotlight&&(scene$2.remove(spotlight),scene$2.remove(spotlight.target),spotlight=null)}),t.push(()=>{if(electroComponents$1!=null&&electroComponents$1.electro){const i=electroComponents$1.electro;electroComponents$1.electroMixer&&electroComponents$1.electroMixer.stopAllAction(),i.traverse(s=>{s.isMesh&&(s.geometry&&s.geometry.dispose(),s.material&&(Array.isArray(s.material)?s.material.forEach(r=>r.dispose()):s.material.dispose()))}),scene$2.remove(i),electroComponents$1.electro=null}}),t.push(()=>{togglePlayerControls(!0),controls$2&&(controls$2.enabled=!0),showObjective(2,objectives)});function o(i){i<t.length?(t[i](),requestAnimationFrame(()=>o(i+1))):(state.isElectroSequenceActive=!1,state.isElectroSoundPlaying=!1,state.isCleanupInProgress=!1)}o(0)}function startOptimizedCleanup(n,e){state.isCleanupInProgress||(state.isCleanupInProgress=!0,hideElectroObjects(),togglePlayerControls(!0),controls$2&&(controls$2.enabled=!0),hideSkipButton(),requestAnimationFrame(()=>{phasedCleanupAllObjects()}))}function cleanupElectroSequence(n=!1){n&&showObjective(2,objectives),hideSkipButton()}function updateElectro(n){!state.isElectroSequenceActive&&!state.isAutoMoving||(electroComponents$1!=null&&electroComponents$1.electroMixer&&electroComponents$1.electroMixer.update(n),state.isUFOSequenceActive&&updateUFO(),hologramEffect$1&&animateHologram(n),state.isAutoMoving&&player&&autoPlayerMovement(n))}function cleanupElectro(){state.cancelAnimationFrame(),state.clearTimeouts(),state.reset(),hideSkipButton(),state.isElectroSequenceActive?startOptimizedCleanup():cleanupElectroSequence(!1)}let inventoryContainer=null,inventoryButton=null,currentSelectedSlot=null,inventoryData={capacity:{current:51,max:250},items:[{id:1,name:"Resistor",icon:"resistor.png",count:1,category:"weapon",description:"Used to control or limit the flow of electrical current in a circuit",stats:"70/140 BR"},{id:2,name:"Battery",icon:"battery.png",count:44,category:"ammo",description:"Stores chemical energy and converts it into electrical energy to power electronic devices. ",stats:"44/100"},{id:3,name:"Led",icon:"led.png",count:1,category:"consumable",description:"semiconductor that emits light when an electric current passes through it",stats:"HP +50"},{id:4,name:"Jumper wire",icon:"jumper_wire.png",count:3,category:"weapon",description:"used to connect components on a breadboard or within a circuit for prototyping or testing without soldering",stats:"Damage: 50"},{id:5,name:"Capacitor",icon:"capacitor.png",count:4,category:"consumable",description:" used to store electrical energy in an electric field and then release it back into the circuit",stats:"HP +30"},{id:6,name:"Diode",icon:"diode.png",count:1,category:"weapon",description:"It acts as a one-way switch, allowing current to flow in one direction but blocking it in the reverse direction",stats:"Damage: 20"},{id:7,name:"Transistor",icon:"transistor.png",count:1,category:"key",description:"A transistor is a semiconductor device that can function as an electronic switch or an amplifier for electrical signals",stats:"Access Level 1"}],health:3};function createCircuitSlot(n,e){const t=document.createElement("div");t.className="inventory-slot",t.dataset.index=e,t.addEventListener("click",s=>selectSlot(s,t));const o=document.createElement("div");o.innerHTML=`
  <svg width="100%" height="100%" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">
    <defs>
      <linearGradient id="slotGrad" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" stop-color="#00fff6" stop-opacity="0.2"/>
        <stop offset="100%" stop-color="#00ff9d" stop-opacity="0.1"/>
      </linearGradient>
      <filter id="slotGlow">
        <feDropShadow dx="0" dy="0" stdDeviation="2" flood-color="#00fff6" flood-opacity="0.5"/>
      </filter>
    </defs>
    <rect x="1.5" y="1.5" width="57" height="57" rx="10" ry="10"
      fill="url(#slotGrad)" stroke="rgba(0,255,255,0.25)" stroke-width="1.2" filter="url(#slotGlow)" />
    <rect x="5" y="5" width="50" height="50" rx="8" ry="8" fill="rgba(0,0,0,0.25)" />
    <foreignObject x="8" y="8" width="44" height="44">
      <div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;">
        <img src="./assets/${n.icon}" style="width:80%;height:80%;object-fit:contain;filter:drop-shadow(0 0 4px rgba(0,255,255,0.5));" alt="" />
      </div>
    </foreignObject>
    <path d="M5 30 L55 30" stroke="rgba(0,255,255,0.1)" stroke-width="0.6"/>
    <circle cx="10" cy="10" r="1.8" fill="rgba(0,255,255,0.4)"/>
    <circle cx="50" cy="50" r="1.8" fill="rgba(0,255,128,0.4)"/>
  </svg>
`,t.appendChild(o.firstElementChild);const i=document.createElement("div");return i.className="item-count",i.textContent=`x${n.count}`,t.appendChild(i),t}function createInventoryButton(){inventoryButton||(inventoryButton=document.createElement("div"),inventoryButton.innerHTML="",inventoryButton.style.position="fixed",inventoryButton.style.top="20px",inventoryButton.style.right="20px",inventoryButton.style.width="60px",inventoryButton.style.height="60px",inventoryButton.style.background="rgba(0, 255, 65, 0.06)",inventoryButton.style.backdropFilter="blur(30px)",inventoryButton.style.border="1px solid rgba(0, 255, 65, 0.2)",inventoryButton.style.borderRadius="50%",inventoryButton.style.display="flex",inventoryButton.style.alignItems="center",inventoryButton.style.justifyContent="center",inventoryButton.style.fontSize="24px",inventoryButton.style.cursor="pointer",inventoryButton.style.zIndex="1000",inventoryButton.style.boxShadow="0 0 30px rgba(0, 255, 65, 0.1)",inventoryButton.title="Inventory",inventoryButton.addEventListener("click",()=>{showInventory()}),document.body.appendChild(inventoryButton))}function createInventoryUI(){if(inventoryContainer)return;const n=document.createElement("style");n.textContent=`
  @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&display=swap');
  #inventory-container {
    font-family: 'Orbitron', sans-serif;
  }

.inventory-main {
  /* Keep your existing layout properties */
  position: relative;
  display: grid;
  grid-template-columns: 140px 1fr 320px;
  grid-template-rows: 60px auto 50px;
  gap: 12px;
  padding: 20px 25px;
  box-sizing: border-box;
  width: 1000px;
  height: 650px;
  margin: 0 auto;

 
  background: url("data:image/svg+xml,%3Csvg width='1000' height='650' viewBox='0 0 1000 650' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3CradialGradient id='paint0_radial_3159_6' cx='0' cy='0' r='1' gradientUnits='userSpaceOnUse' gradientTransform='translate(300 30) scale(800 520)'%3E%3Cstop stop-color='%2300FFFF' stop-opacity='0.1'/%3E%3Cstop offset='1' stop-color='%23000A14' stop-opacity='0.95'/%3E%3C/radialGradient%3E%3C/defs%3E%3Cpath d='M20 0.5H980C990.77 0.5 999.5 9.23045 999.5 20V223.146C999.5 229.747 996.161 235.899 990.627 239.496L968.828 253.666C963.01 257.448 959.5 263.915 959.5 270.854V329.567C959.5 335.094 961.731 340.387 965.688 344.245L993.613 371.471C997.377 375.141 999.5 380.175 999.5 385.433V552C999.5 562.77 990.77 571.5 980 571.5H806.371C802.123 571.5 797.979 572.82 794.514 575.277L694.908 645.907C691.612 648.245 687.67 649.5 683.629 649.5H20C9.23045 649.5 0.5 640.77 0.5 630V399.52L0.507812 398.97C0.667371 393.302 3.28823 387.972 7.70312 384.385L32.9268 363.891C37.7178 359.998 40.5 354.154 40.5 347.98V281.433C40.4999 275.906 38.2686 270.613 34.3115 266.755L6.38672 239.529C2.62259 235.859 0.500091 230.825 0.5 225.567V20C0.5 9.23045 9.23045 0.5 20 0.5Z' fill='url(%23paint0_radial_3159_6)' stroke='%234ECDC4' stroke-width='1.5'/%3E%3C/svg%3E");
  background-size: 100% 100%;
}

  .inventory-main.show {
    transform: scale(1) rotate(0);
    opacity: 1;
  }

  .inventory-main.hide {
    transform: scale(0.95) rotate(-2deg);
    opacity: 0;
  }

  .close-btn {
    position: absolute;
    top: 12px;
    right: 14px;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 1px solid rgba(255,0,80,0.25);
    background: radial-gradient(circle, rgba(255,0,80,0.1), rgba(0,0,0,0.5));
    color: #ff3366;
    font-size: 22px;
    font-weight: bold;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: 0 0 15px rgba(255,0,80,0.2);
  }

  .close-btn:hover {
    background: rgba(255,0,80,0.2);
    box-shadow: 0 0 30px rgba(255,0,80,0.3);
    transform: scale(1.1) rotate(90deg);
  }

  .grid-container {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 14px;
    padding: 26px;
  }

  .inventory-slot {
    position: relative;
    aspect-ratio: 0.75;
    border-radius: 8px 8px 4px 4px;
    border: 1px solid rgba(0,255,255,0.1);
    background: linear-gradient(135deg, rgba(0,255,255,0.04), rgba(0,255,128,0.02));
    box-shadow: inset 0 0 15px rgba(0,255,255,0.05);
    overflow: hidden;
   
    transition: all 0.25s ease;
  }

  .inventory-slot:hover {
    border-color: rgba(0,255,255,0.4);
    box-shadow: 0 0 18px rgba(0,255,255,0.25);
    transform: translateY(-3px);
  }

  .inventory-slot.selected {
    border-color: rgba(0,255,180,0.7);
    box-shadow: 0 0 25px rgba(0,255,180,0.4);
    background: linear-gradient(135deg, rgba(0,255,180,0.08), rgba(0,255,255,0.05));
  }

  .item-count {
    position: absolute;
    bottom: 6px;
    right: 6px;
    font-size: 12px;
    color: #00ffff;
    background: rgba(0, 10, 10, 0.7);
    border: 1px solid rgba(0,255,255,0.3);
    border-radius: 4px;
    padding: 2px 5px;
  }

  .item-large {
    border-radius: 12px;
    border: 1px solid rgba(0,255,255,0.15);
    background: radial-gradient(circle at 30% 30%, rgba(0,255,255,0.1), rgba(0,0,0,0.3));
    box-shadow: inset 0 0 25px rgba(0,255,255,0.08);
  }

  .neon-sign {
    font-size: 18px;
    font-weight: 800;
    color: #ff00cc;
    text-align: center;
    letter-spacing: 2px;
    text-shadow:
      0 0 10px rgba(255,0,200,0.7),
      0 0 30px rgba(255,0,200,0.4);
    padding: 10px;
  }
    .item-title {
  font-size: 20px;
  color: #00ffff;
  text-align: center;
  margin-top: 15px;
  font-weight: 700;
  text-shadow: 0 0 10px rgba(0,255,255,0.6);
}

.item-desc {
  font-size: 14px;
  color: rgba(200,255,255,0.9);
  padding: 10px;
  text-align: center;
  line-height: 1.4;
}

.stats-bar {
  position: relative;
  width: 90%;
  height: 10px;
  margin: 12px auto;
  background: rgba(0,255,255,0.1);
  border: 1px solid rgba(0,255,255,0.2);
  border-radius: 5px;
  overflow: hidden;
}
.stats-fill {
  height: 100%;
  width: 50%;
  background: linear-gradient(90deg, #00ffff, #00ff9d);
  box-shadow: 0 0 10px #00ffff;
  transition: width 0.3s ease;
}
.stats-text {
  text-align: center;
  font-size: 13px;
  color: #00ffff;
  margin-top: 4px;
}

.bottom-buttons {
  display: flex;
  justify-content: space-around;
  align-items: center;
  margin-top: 25px;
}

.cyber-btn {
  padding: 5px 10px;
  border: 1px solid rgba(0,255,255,0.4);
  color: #00ffff;
  background: rgba(0,255,255,0.08);
  border-radius: 6px;
  cursor: pointer;
  font-family: 'Orbitron', sans-serif;
  text-transform: uppercase;
  transition: all 0.25s ease;
  box-shadow: 0 0 15px rgba(0,255,255,0.2);
}
.cyber-btn:hover {
  background: rgba(0,255,255,0.2);
  box-shadow: 0 0 25px rgba(0,255,255,0.4);
}

.cancel-btn {
  border-color: rgba(255,0,80,0.5);
  color: #ff3366;
}
.cancel-btn:hover {
  background: rgba(255,0,80,0.15);
  box-shadow: 0 0 25px rgba(255,0,80,0.5);
}
  .sidebar {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  padding-top: 10px;
}

.category-btn {
  width: 60px;
  height: 60px;
  border: 1px solid rgba(0,255,255,0.25);
  border-radius: 10px;
  background: rgba(0,255,255,0.05);
  color: #00ffff;
  font-size: 24px;
  cursor: pointer;
  transition: all 0.3s ease;
}
.category-btn:hover {
  background: rgba(0,255,255,0.2);
  box-shadow: 0 0 15px rgba(0,255,255,0.3);
}

.grid-container {
  display: grid;
  grid-template-columns: repeat(4, minmax(0, 1fr));
  gap: 14px;
  align-content: start;
  overflow-y: auto;
  padding: 10px;
  height: 100%;
  box-sizing: border-box;
}
.right-panel {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  padding: 10px;
  box-sizing: border-box;
  overflow: hidden;
}

.item-large {
  width: 200px;
  height: 200px;
  margin: 10px auto;
  border-radius: 12px;
  border: 1px solid rgba(0,255,255,0.25);
  background: radial-gradient(circle at 50% 50%, rgba(0,255,255,0.08), rgba(0,0,0,0.3));
  display: flex;
  align-items: center;
  justify-content: center;
}

.item-large img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  filter: drop-shadow(0 0 15px rgba(0,255,255,0.5));
}
@media (max-width: 1200px) {
  .inventory-main {
    transform: scale(0.85);
    transform-origin: center;
  }
}

@media (max-width: 900px) {
  .inventory-main {
    transform: scale(0.75);
  }
}
.top-bar {
  grid-column: 1 / -1;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 20px;
  background: rgba(0,255,255,0.05);
  border-bottom: 1px solid rgba(0,255,255,0.15);
  color: #00ffff;
  font-size: 14px;
}

.bottom-bar {
  grid-column: 1 / -1;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 24px;
  background: rgba(0,20,10,0.15);
  border-top: 1px solid rgba(0,255,65,0.1);
  color: #00ff9d;
  font-weight: 600;
  font-size: 16px;
}
.tabs {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 14px;
}

.tab-btn {
  padding: 8px 18px;
  border: 1px solid rgba(0, 255, 255, 0.25);
  background: rgba(0, 255, 255, 0.05);
  color: #00ffff;
  font-size: 14px;
  font-family: 'Orbitron', sans-serif;
  text-transform: uppercase;
  letter-spacing: 1px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.25s ease;
  box-shadow: 0 0 10px rgba(0, 255, 255, 0.1);
}

.tab-btn:hover {
  background: rgba(0, 255, 255, 0.15);
  border-color: rgba(0, 255, 255, 0.4);
  box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
}

.tab-btn.active {
  background: linear-gradient(135deg, rgba(0,255,180,0.25), rgba(0,255,255,0.15));
  border-color: rgba(0,255,180,0.6);
  color: #00ffcc;
  box-shadow: 0 0 25px rgba(0,255,180,0.4);
}


`,document.head.appendChild(n),inventoryContainer=document.createElement("div"),inventoryContainer.id="inventory-container",inventoryContainer.style.position="fixed",inventoryContainer.style.top="0",inventoryContainer.style.left="0",inventoryContainer.style.width="100%",inventoryContainer.style.height="100%",inventoryContainer.style.backgroundColor="rgba(0, 0, 0, 0.1)",inventoryContainer.style.display="none",inventoryContainer.style.zIndex="1500",inventoryContainer.style.backdropFilter="blur(6px)";const e=document.createElement("div");e.className="inventory-main",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.width="1000px",e.style.height="650px",e.style.display="grid",e.style.gridTemplateColumns="120px 1fr 280px",e.style.gridTemplateRows="50px auto 30px 50px",e.style.gap="0";const t=document.createElement("button");t.className="close-btn",t.textContent="",t.addEventListener("click",hideInventory),e.appendChild(t);const o=document.createElement("div");o.className="top-bar",o.style.gridColumn="1 / -1",o.innerHTML="<span>L1</span>";const i=document.createElement("div");i.className="tabs";const s=document.createElement("button");s.className="tab-btn",s.textContent="Map";const r=document.createElement("button");r.className="tab-btn active",r.textContent="Inventory";const a=document.createElement("button");a.className="tab-btn",a.textContent="Database",i.appendChild(s),i.appendChild(r),i.appendChild(a),o.appendChild(i);const l=document.createElement("span");l.textContent=`Capacity ${inventoryData.capacity.current}/${inventoryData.capacity.max}`,o.appendChild(l),o.innerHTML+="<span>R1</span>",e.appendChild(o);const c=document.createElement("div");c.className="sidebar",c.style.gridRow="2",c.style.gridColumn="1",[{icon:""},{icon:""},{icon:""},{icon:""},{icon:""},{icon:""}].forEach(M=>{const R=document.createElement("button");R.className="category-btn",R.innerHTML=M.icon,R.addEventListener("click",()=>{}),c.appendChild(R)}),e.appendChild(c);const u=document.createElement("div");u.className="grid-container",u.style.gridRow="2",u.style.gridColumn="2",inventoryData.items.slice(0,12).forEach((M,R)=>{const O=createCircuitSlot(M,R);u.appendChild(O)}),e.appendChild(u);const f=document.createElement("div");f.className="neon-sign",f.style.gridColumn="1 / -1",f.style.gridRow="3",f.textContent="Legendium",e.appendChild(f);const h=document.createElement("div");h.className="right-panel",h.style.gridRow="2 / 4",h.style.gridColumn="3";const m=document.createElement("div");m.className="item-large";const p=document.createElement("img");p.src="./assets/resistor1.png",p.alt="",m.appendChild(p),h.appendChild(m);const v=document.createElement("div");v.className="item-title",h.appendChild(v);const g=document.createElement("div");g.className="item-desc",h.appendChild(g);const y=document.createElement("div");y.className="stats-bar";const w=document.createElement("div");w.className="stats-fill";const _=document.createElement("div");_.className="stats-text",_.textContent="70/140 BR",y.appendChild(w),y.appendChild(_),h.appendChild(y);const S=document.createElement("div");S.className="bottom-buttons";const C=document.createElement("button");C.className="cyber-btn",C.textContent="Select",C.addEventListener("click",()=>useItem(currentSelectedSlot));const A=document.createElement("button");A.className="cyber-btn cancel-btn",A.textContent="Cancel",A.addEventListener("click",()=>dropItem(currentSelectedSlot));const E=document.createElement("button");E.className="cyber-btn cancel-btn",E.textContent="Close",E.addEventListener("click",hideInventory),S.appendChild(C),S.appendChild(A),S.appendChild(E),h.appendChild(S),e.appendChild(h);const k=document.createElement("div");k.style.gridColumn="1 / -1",k.style.gridRow="4",k.style.display="flex",k.style.alignItems="center",k.style.padding="12px 24px",k.style.background="rgba(0, 20, 10, 0.15)",k.style.borderTop="1px solid rgba(0, 255, 65, 0.1)";const I=document.createElement("div");I.className="health-bar";const F=document.createElement("div");F.className="health-fill",I.appendChild(F),k.appendChild(I),inventoryContainer.appendChild(e),document.body.appendChild(inventoryContainer),setTimeout(()=>{const M=document.querySelector('.inventory-slot[data-index="0"]');M&&selectSlot({},M)},50)}function selectSlot(n,e){document.querySelectorAll(".inventory-slot").forEach(i=>i.classList.remove("selected")),e.classList.add("selected"),currentSelectedSlot=e;const t=parseInt(e.dataset.index),o=inventoryData.items[t];if(o){document.querySelector(".item-large img").src=`./assets/${o.icon}`,document.querySelector(".item-title").textContent=o.name,document.querySelector(".item-desc").textContent=o.description,document.querySelector(".stats-text").textContent=o.stats;const i=document.querySelector(".stats-fill");i.style.width="50%"}}function useItem(n){if(!n)return;const e=parseInt(n.dataset.index),t=inventoryData.items[e];t&&console.log("Use item:",t.name),hideInventory()}function dropItem(n){if(!n)return;const e=parseInt(n.dataset.index),t=inventoryData.items[e];t&&console.log("Drop item:",t.name),hideInventory()}function showInventory(){inventoryContainer||createInventoryUI(),inventoryContainer.style.display="block",disablePlayerControls();const n=document.querySelector(".inventory-main");n&&(n.classList.remove("hide"),n.classList.add("show"));const e=document.querySelector("canvas");e&&(e.style.pointerEvents="none")}function hideInventory(){const n=document.querySelector(".inventory-main");n&&(n.classList.remove("show"),n.classList.add("hide")),enablePlayerControls(),setTimeout(()=>{inventoryContainer&&(inventoryContainer.style.display="none");const e=document.querySelector("canvas");e&&(e.style.pointerEvents="auto")},300)}function cleanupInventory(){inventoryButton&&inventoryButton.parentNode&&inventoryButton.parentNode.removeChild(inventoryButton),inventoryContainer&&inventoryContainer.parentNode&&inventoryContainer.parentNode.removeChild(inventoryContainer),currentSelectedSlot=null;const n=document.querySelector("style");n&&n.textContent.includes("#inventory-container")&&n.parentNode.removeChild(n)}let scene$1,camera$1,renderer$2,controls$1,resizeHandler$1=null,animationFrameId$1=null,sceneInitialization$1=null,isSceneTransitioning$1=!1,portal=null,triggerPoint=null,electroComponents=null,hologramEffect=null,electroFocusCamera,isElectroFocusActive=!1,isCameraTransitioning=!1,ufo=null,transitionStartTime=0;const transitionDuration=1.5;let transitionStartPosition=new Vector3$1,transitionStartQuaternion=new Quaternion$1,transitionTargetPosition=new Vector3$1,transitionTargetQuaternion=new Quaternion$1,cactus=null,carnivorous=null,isCactusAnimating=!1,isCarnivorousAnimating=!1,cactusMixer=null,carnivorousMixer=null,cactusAction=null,carnivorousAction=null,cactusAnimations={},carnivorousAnimations={},playerLife=100,vignetteOverlay=null,lifeBarContainer=null,deathScreenContainer=null,isPlayerDead=!1,ATTACK_DISTANCE=5;const USE_SHADER_SWAY_FOR_HANGING=!0;let avatarHangingMesh=null,avatarHangingMeshPivot=null,avatarHangingSwayUniforms=[],backgroundAudio,attackAudio=null,collisionMesh=null;function setHologramEffect(n){hologramEffect=n}function setupPlants(n,e){e.models.gltf.cactus?(cactus=e.models.gltf.cactus,cactus.position.set(-5,2.25,-37.5),cactus.rotation.y=-Math.PI/2,cactus.scale.set(3,3,3),cactus.traverse(t=>{t.isMesh&&t.material&&(Array.isArray(t.material)?t.material:[t.material]).forEach(i=>{i.transparent=!1,i.opacity=1,i.depthWrite=!0,i.depthTest=!0,i.alphaTest=i.alphaMap||i.map&&i.map.format===RGBAFormat?.5:0,i.side=FrontSide,i.alphaToCoverage=!1,i.premultipliedAlpha=!1,i.needsUpdate=!0})}),n.add(cactus),e.models.animations.cactus?(cactusMixer=e.models.animations.cactus.mixer,cactusAnimations=e.models.animations.cactus.actions,Object.values(cactusAnimations).forEach(t=>{t.setLoop(LoopOnce),t.clampWhenFinished=!0}),cactusAction=Object.values(cactusAnimations)[0]):console.log("WARNING: No cactus animations found in allAssets")):console.log("WARNING: Cactus model not found in assets"),e.models.gltf.carnivorus?(console.log("Found carnivorous model"),carnivorous=e.models.gltf.carnivorus,carnivorous.position.set(-4,6,0),carnivorous.scale.set(2.5,2.5,2.5),carnivorous.traverse(t=>{t.isMesh&&(t.material.transparent=!0,t.material.depthWrite=!0,t.material.depthTest=!0,t.material.alphaToCoverage=!0,t.material.premultipliedAlpha=!0,t.material.side=DoubleSide)}),n.add(carnivorous),console.log("Carnivorous position set to:",carnivorous.position),e.models.animations.carnivorus?(console.log("Found carnivorous animations in allAssets"),carnivorousMixer=e.models.animations.carnivorus.mixer,carnivorousAnimations=e.models.animations.carnivorus.actions,Object.values(carnivorousAnimations).forEach(t=>{t.setLoop(LoopOnce),t.clampWhenFinished=!0}),carnivorousAction=Object.values(carnivorousAnimations)[0],console.log("Carnivorous animations configured:",Object.keys(carnivorousAnimations))):console.log("WARNING: No carnivorous animations found in allAssets")):console.log("WARNING: Carnivorous model not found in assets")}function createVignetteEffect(){vignetteOverlay&&document.body.removeChild(vignetteOverlay),vignetteOverlay=document.createElement("div"),vignetteOverlay.style.position="fixed",vignetteOverlay.style.top="0",vignetteOverlay.style.left="0",vignetteOverlay.style.width="100%",vignetteOverlay.style.height="100%",vignetteOverlay.style.pointerEvents="none",vignetteOverlay.style.zIndex="1000",vignetteOverlay.style.background="radial-gradient(circle at center, transparent 0%, rgba(255, 0, 0, 0.4) 100%)",vignetteOverlay.style.transition="opacity 0.3s ease-in-out",vignetteOverlay.style.opacity="0",document.body.appendChild(vignetteOverlay)}function toggleVignette(n){vignetteOverlay&&(vignetteOverlay.style.opacity=n?"1":"0")}function createLifeBar(){lifeBarContainer&&document.body.removeChild(lifeBarContainer),lifeBarContainer=document.createElement("div"),lifeBarContainer.style.position="fixed",lifeBarContainer.style.bottom="40px",lifeBarContainer.style.left="50px",lifeBarContainer.style.display="flex",lifeBarContainer.style.alignItems="center",lifeBarContainer.style.gap="8px",lifeBarContainer.style.zIndex="1000";const n=document.createElement("div");n.innerHTML="",n.style.fontSize="18px",n.style.textShadow="0 0 6px rgba(255,0,0,0.9), 0 0 12px rgba(255,50,50,0.8)",lifeBarContainer.appendChild(n);const e=document.createElement("div");e.style.width="320px",e.style.height="22px",e.style.borderRadius="6px",e.style.padding="2px",e.style.background="linear-gradient(135deg, #cfcfcf, #777, #e5e5e5)",e.style.boxShadow="0 0 10px rgba(255,255,255,0.4), inset 0 0 8px rgba(0,0,0,0.6)",e.style.clipPath="polygon(3% 0%, 100% 0%, 97% 100%, 0% 100%)",e.style.overflow="hidden",e.style.position="relative";const t=document.createElement("div");t.style.width="100%",t.style.height="100%",t.style.background="rgba(0,0,0,0.7)",t.style.clipPath="inherit",t.style.overflow="hidden",t.style.position="relative";const o=document.createElement("div");o.id="life-bar-inner",o.style.width="100%",o.style.height="100%",o.style.transition="width 0.3s ease-out, background 0.3s ease-out",o.style.clipPath="inherit";const i=document.createElement("div");i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.width="100%",i.style.height="100%",i.style.background="linear-gradient(120deg, rgba(255,255,255,0.25) 0%, transparent 40%, transparent 60%, rgba(255,255,255,0.25) 100%)",i.style.animation="shine 3s infinite linear",i.style.pointerEvents="none";const s=document.createElement("div");s.id="life-text",s.style.position="absolute",s.style.width="100%",s.style.height="100%",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.color="#fff",s.style.fontFamily="'Orbitron', sans-serif",s.style.fontSize="11px",s.style.fontWeight="bold",s.style.textShadow="0 0 5px #000, 0 0 10px rgba(255,255,255,0.8)",s.style.zIndex="2",t.appendChild(o),t.appendChild(i),t.appendChild(s),e.appendChild(t),lifeBarContainer.appendChild(e),document.body.appendChild(lifeBarContainer);const r=document.createElement("style");r.innerHTML=`
    @keyframes shine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
  `,document.head.appendChild(r),updateLifeDisplay()}function updateLifeDisplay(){const n=document.getElementById("life-bar-inner"),e=document.getElementById("life-text");if(n&&e){const t=Math.max(0,Math.min(100,playerLife));let o;t>60?o="linear-gradient(90deg, #33ff66, #00cc33)":t>30?o="linear-gradient(90deg, #ffcc00, #ff9900)":o="linear-gradient(90deg, #ff3300, #cc0000)",n.style.width=`${t}%`,n.style.background=o,e.textContent=`${Math.round(t)}%`,t<=0&&!isPlayerDead&&(isPlayerDead=!0,createDeathScreen(),setTimeout(respawnPlayer,3e3))}}function createDeathScreen(){deathScreenContainer&&document.body.removeChild(deathScreenContainer),deathScreenContainer=document.createElement("div"),deathScreenContainer.style.position="fixed",deathScreenContainer.style.top="0",deathScreenContainer.style.left="0",deathScreenContainer.style.width="100%",deathScreenContainer.style.height="100%",deathScreenContainer.style.backgroundColor="rgba(0, 0, 0, 0.8)",deathScreenContainer.style.display="flex",deathScreenContainer.style.flexDirection="column",deathScreenContainer.style.justifyContent="center",deathScreenContainer.style.alignItems="center",deathScreenContainer.style.zIndex="2000",deathScreenContainer.style.fontFamily="'Orbitron', sans-serif",deathScreenContainer.style.color="#ff0000",deathScreenContainer.style.textShadow="0 0 20px rgba(255, 0, 0, 0.8)",deathScreenContainer.style.opacity="0",deathScreenContainer.style.transition="opacity 1s ease-in-out";const n=document.createElement("div");n.textContent="YOU DIED",n.style.fontSize="72px",n.style.fontWeight="bold",n.style.marginBottom="30px",n.style.animation="pulse 2s infinite";const e=document.createElement("div");e.textContent="Respawning...",e.style.fontSize="24px",e.style.opacity="0.8",deathScreenContainer.appendChild(n),deathScreenContainer.appendChild(e),document.body.appendChild(deathScreenContainer);const t=document.createElement("style");return t.textContent=`
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
  `,document.head.appendChild(t),setTimeout(()=>{deathScreenContainer.style.opacity="1"},100),deathScreenContainer}function respawnPlayer(){var e;if(!((e=sceneInitialization$1==null?void 0:sceneInitialization$1.playerFunction)!=null&&e.player))return;const n=sceneInitialization$1.playerFunction.player;n.position.set(-58,10,5),n.rotation.y=Math.PI/2,playerLife=100,updateLifeDisplay(),toggleVignette(!1),isCactusAnimating=!1,isCarnivorousAnimating=!1,deathScreenContainer&&(deathScreenContainer.style.opacity="0",setTimeout(()=>{deathScreenContainer&&deathScreenContainer.parentNode&&(deathScreenContainer.parentNode.removeChild(deathScreenContainer),deathScreenContainer=null)},1e3)),isPlayerDead=!1}async function initializeScene1(n,e){var w,_,S,C,A,E,k,I;setCurrentScene("scene1");const t=getUserInfo();animationFrameId$1&&(cancelAnimationFrame(animationFrameId$1),animationFrameId$1=null),camera$1=new PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1500),camera$1.position.set(0,0,0),electroFocusCamera=new PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1500),electroFocusCamera.position.set(-16,10.5,-12),electroFocusCamera.lookAt(new Vector3$1(-10,9.8,-12)),scene$1=new Scene,renderer$2=n,renderer$2.setSize(window.innerWidth,window.innerHeight),renderer$2.shadowMap.enabled=!0,renderer$2.shadowMap.type=PCFSoftShadowMap,renderer$2.shadowMap.autoUpdate=!0,switchToFirstPerson(camera$1,controls$1),renderer$2.domElement.parentElement||document.body.appendChild(renderer$2.domElement),await loadAllAsset(assetsEntry$2,camera$1,renderer$2,scene$1),console.log(allAssets$4),renderer$2.toneMapping=ACESFilmicToneMapping,renderer$2.toneMappingExposure=.4,renderer$2.render(scene$1,camera$1),controls$1=new OrbitControls(camera$1,renderer$2.domElement),controls$1.enabled=!1,sceneInitialization$1=initializePhysicsAndPlayer(allAssets$4.models.gltf.garden,{position:{x:0,y:0,z:0},rotation:{x:0,y:Math.PI/2,z:0}},[],scene$1,camera$1,controls$1);const o=F=>{if(F.key.toLowerCase()==="y"&&!isSceneTransitioning$1){isSceneTransitioning$1=!0;const M=renderer$2.xr.getSession(),R=O=>{window.removeEventListener("keydown",o),l("scene1"),sceneInitialization$1&&sceneInitialization$1.cleanUpCollider(),cleanupScene1(),checkExistingAssets(assetsEntry$7),initializeScene2(renderer$2,O).finally(()=>{isSceneTransitioning$1=!1})};M?M.end().then(()=>{R(!0)}).catch(O=>{console.error("Error ending VR session:",O),isSceneTransitioning$1=!1}):R(!1)}};window.addEventListener("keydown",o);const i=new AmbientLight(16777215,.8);scene$1.add(i);const s=new DirectionalLight(16777215,.8);s.position.set(50,50,50),s.castShadow=!0;const r=new Clock;function a(F,M){return Math.sqrt(Math.pow(F.x-M.x,2)+Math.pow(F.y-M.y,2)+Math.pow(F.z-M.z,2))}async function l(F){try{const M=auth.currentUser;if(!M){console.warn("No authenticated user; skipping scene completion update");return}const R=doc(db,"users",M.uid);await updateDoc(R,{[`scenesCompleted.${F}`]:!0})}catch(M){console.error("Failed to mark scene completed",M)}}function c(F,M,R){F&&(F.position.set(M.x,M.y,M.z),F.rotation.set(R.x,R.y,R.z),playerState.velocity.set(0,0,0))}function d(){isCameraTransitioning=!0,transitionStartTime=performance.now(),transitionStartPosition.copy(camera$1.position),transitionStartQuaternion.copy(camera$1.quaternion),transitionTargetPosition.copy(electroFocusCamera.position),transitionTargetQuaternion.copy(electroFocusCamera.quaternion),isElectroFocusActive=!0,controls$1&&(controls$1.enabled=!1)}function u(){const F=getElectroState();if(F!=null&&F.isCleanupInProgress){setTimeout(()=>u(),50);return}setTimeout(()=>{isCameraTransitioning=!0,transitionStartTime=performance.now(),transitionStartPosition.copy(electroFocusCamera.position),transitionStartQuaternion.copy(electroFocusCamera.quaternion),transitionTargetPosition.copy(camera$1.position),transitionTargetQuaternion.copy(camera$1.quaternion),isElectroFocusActive=!1,controls$1&&(controls$1.enabled=!0)},100)}function f(){if(!scene$1||!allAssets$4){console.error("Scene or assets not initialized when trying to create UFO");return}const F=allAssets$4.models.gltf.ufo;if(!F){console.error("UFO model not found in assets");return}ufo=F.clone(),ufo.visible=!1,ufo.scale.set(.1,.1,.1),scene$1.add(ufo),console.log("UFO added to scene")}const h=new Vector3$1(2,5.4,-61),m=new Euler$1(0,Math.PI/8,0);portal=new Portal(scene$1,h,m);function p(F,M,R){var O;!F||(O=F.userData)!=null&&O.__hasHangingSway||(F.onBeforeCompile=$=>{$.uniforms.uTime={value:0},$.uniforms.uMinY={value:M},$.uniforms.uMaxY={value:R},$.uniforms.uAmpX={value:.01},$.uniforms.uAmpZ={value:.3},$.uniforms.uFreqX={value:.18},$.uniforms.uFreqZ={value:.25},$.uniforms.uPhase={value:1.3},avatarHangingSwayUniforms.push($.uniforms),$.vertexShader=`uniform float uTime;
uniform float uMinY;
uniform float uMaxY;
uniform float uAmpX;
uniform float uAmpZ;
uniform float uFreqX;
uniform float uFreqZ;
uniform float uPhase;
`+$.vertexShader,$.vertexShader=$.vertexShader.replace("#include <begin_vertex>",`#include <begin_vertex>

  float normY = clamp((position.y - uMinY) / max(0.0001, (uMaxY - uMinY)), 0.0, 1.0);
  float heightWeight = 1.0 - normY;
  float swayX = uAmpX * sin(uTime * uFreqX + uPhase);
  float swayZ = uAmpZ * sin(uTime * uFreqZ);
  transformed.x += swayX * heightWeight;
  transformed.z += swayZ * heightWeight;
`)},F.userData=F.userData||{},F.userData.__hasHangingSway=!0,F.needsUpdate=!0)}function v(F){if(!F||!F.geometry)return;F.geometry.boundingBox||F.geometry.computeBoundingBox();const M=F.geometry.boundingBox;(Array.isArray(F.material)?F.material:[F.material]).forEach(O=>p(O,M.min.y,M.max.y))}if(createMinimap(scene$1,sceneInitialization$1),allAssets$4.models.gltf.garden){let F=null;if(allAssets$4.models.gltf.garden.traverse(M=>{if(M.isMesh&&M.name==="low002"&&(F=M,F.userData=F.userData||{}),M.isMesh&&M.name==="wall"&&(M.visible=!1),!avatarHangingMesh&&M.isMesh&&M.name==="NurbsPath003"){avatarHangingMesh=M;try{avatarHangingMesh.updateWorldMatrix(!0,!1);const R=new Box3().setFromObject(avatarHangingMesh),O=new Vector3$1((R.min.x+R.max.x)*.5,R.max.y,(R.min.z+R.max.z)*.5);USE_SHADER_SWAY_FOR_HANGING&&v(avatarHangingMesh)}catch(R){console.warn("Failed to set up swing for NurbsPath003:",R)}}}),F){let M=null,R=null;allAssets$4.models.gltf.grass&&allAssets$4.models.gltf.grass.traverse($=>{$.isMesh&&!M&&(M=$,M.material.transparent=!0,M.material.alphaTest=.1,M.material.depthWrite=!0,M.material.side=DoubleSide,M.material.emissive||(M.material.emissive=new Color(65280)),M.material.emissiveIntensity=.3,M.material.emissiveEnabled=!0,M.material.needsUpdate=!0)}),allAssets$4.models.gltf.wheat&&allAssets$4.models.gltf.wheat.traverse($=>{$.isMesh&&!R&&(R=$,$.material&&(Array.isArray($.material)?$.material:[$.material]).forEach(D=>{D.emissive||(D.emissive=new Color(16776960)),D.emissiveIntensity=1,D.emissiveEnabled=!0,D.needsUpdate=!0}))});const O=((_=(w=allAssets$4.textures.groundBlue)==null?void 0:w.image)==null?void 0:_.currentSrc)||((C=(S=allAssets$4.textures.groundBlue)==null?void 0:S.image)==null?void 0:C.src)||((A=allAssets$4.textures.groundBlue)==null?void 0:A.image)||((E=allAssets$4.textures.groundBlue)==null?void 0:E.src)||"/scene1/groundBlue.png";M&&R&&spreadInstancedRandomOnUVArea(scene$1,allAssets$4.models.gltf.garden,"low002",O,"#0000ff",M,2500,R,void 0,{wind:!0})}else console.error("Ground mesh 'low002' not found in garden model")}else console.log("garden model not found in allAssets");if(electroComponents=initializeElectro(scene$1,allAssets$4,sceneInitialization$1.playerFunction.player,camera$1,controls$1,renderer$2),setDependencies(camera$1,sceneInitialization$1.playerFunction.player,scene$1,controls$1,renderer$2),f(),setupPlants(scene$1,allAssets$4),createVignetteEffect(),createLifeBar(),createInventoryButton(),window.addEventListener("loadingScreenHidden-scene1",()=>{var F;if(isSceneTransitioning$1){console.log("Scene transition in progress - skipping electro sequence");return}if(!electroComponents){console.log("Electro sequence cancelled - components not initialized");return}console.log("Loading screen hidden - Scene1 is ready! Starting electro sequence."),backgroundAudio=allAssets$4.audios.background,backgroundAudio.play();try{attackAudio=allAssets$4.audios.attacksound||null,attackAudio&&(attackAudio.setLoop?attackAudio.setLoop(!1):attackAudio.loop=!1,attackAudio.setVolume?attackAudio.setVolume(1):attackAudio.volume=1,attackAudio.isPlaying&&((F=attackAudio.stop)==null||F.call(attackAudio)))}catch{}showObjective(1,objectives),startElectroSequence()}),triggerPoint=TriggerPoint(allAssets$4.vfxs.entryvfx,{x:-20,y:9,z:-11},scene$1,null,()=>{hideObjective(),c(sceneInitialization$1.playerFunction.player,{x:-21,y:10.3,z:-11},{x:0,y:-Math.PI/2,z:0}),d(),triggerAutoMoveAndDisableControls(sceneInitialization$1.playerFunction.player,()=>{startElectroAppearanceSequence(()=>{u()},triggerPoint),console.log("Player entered the trigger zone at (-20, 9.8, -11) and auto-move completed")})}),e){const F=[];portal&&portal.mesh&&(portal.mesh.userData={...portal.mesh.userData,isPortal:!0,onClick:()=>{if(console.log("VR Controller clicked on portal"),window.isElectroSequencePlaying){console.log("Electro sequence playing, ignoring VR portal click");return}handlePortalSceneSwitch({renderer:renderer$2,nextEntry:assetsEntry$7,initializeNextScene:initializeScene2,cleanupCurrentScene:cleanupScene1,sceneInitialization:sceneInitialization$1,isSceneTransitioningRef:{value:isSceneTransitioning$1},handleKeyPress:o})}},F.push(portal.mesh)),triggerPoint&&triggerPoint.mesh&&(triggerPoint.mesh.userData={...triggerPoint.mesh.userData,isTriggerPoint:!0,onClick:()=>{if(console.log("VR Controller clicked on trigger point"),window.isElectroSequencePlaying){console.log("Electro sequence playing, ignoring VR trigger click");return}hideObjective(),c(sceneInitialization$1.playerFunction.player,{x:-21,y:10.3,z:-11},{x:0,y:-Math.PI/2,z:0}),d(),triggerAutoMoveAndDisableControls(sceneInitialization$1.playerFunction.player,()=>{startElectroAppearanceSequence(()=>u(),triggerPoint)})}},F.push(triggerPoint.mesh)),electroComponents&&electroComponents.electro&&(electroComponents.electro.userData={...electroComponents.electro.userData,isElectro:!0,onClick:()=>{if(console.log("VR Controller clicked on Electro model"),window.isElectroSequencePlaying){console.log("Electro sequence playing, ignoring VR click");return}typeof startElectroSequence=="function"&&startElectroSequence()}},F.push(electroComponents.electro),electroComponents.electro.traverse(M=>{M.isMesh&&(M.userData={...M.userData,isElectroMesh:!0,parentModel:electroComponents.electro,onClick:()=>{console.log(`VR Controller clicked on Electro mesh: ${M.name}`),window.isElectroSequencePlaying}},F.push(M))})),cactus&&(cactus.userData={...cactus.userData,isCactus:!0,onClick:()=>{if(console.log("VR Controller clicked on cactus"),!window.isElectroSequencePlaying&&cactusAction&&!isCactusAnimating){isCactusAnimating=!0,cactusAction.reset().play();const M=cactusAction.getClip().duration*1e3;setTimeout(()=>{isCactusAnimating=!1},M)}}},F.push(cactus)),carnivorous&&(carnivorous.userData={...carnivorous.userData,isCarnivorous:!0,onClick:()=>{if(console.log("VR Controller clicked on carnivorous plant"),!window.isElectroSequencePlaying&&carnivorousAction&&!isCarnivorousAnimating){isCarnivorousAnimating=!0,carnivorousAction.reset().play();const M=carnivorousAction.getClip().duration*1e3;setTimeout(()=>{isCarnivorousAnimating=!1},M)}}},F.push(carnivorous)),ufo&&(ufo.userData={...ufo.userData,isUFO:!0,onClick:()=>{console.log("VR Controller clicked on UFO"),!window.isElectroSequencePlaying&&(ufo.visible=!ufo.visible)}},F.push(ufo)),window.vrClickableObjects=F,collisionMesh=((k=allAssets$4.models.gltf.garden)==null?void 0:k.collisionMesh)||null,collisionMesh&&setCollisionMesh(collisionMesh),(I=sceneInitialization$1==null?void 0:sceneInitialization$1.playerFunction)!=null&&I.player&&enablePlayerMovement(sceneInitialization$1.playerFunction.player),initializeVR(renderer$2,scene$1,camera$1,sceneInitialization$1.playerFunction.player,sceneInitialization$1.playerFunction.actions,F,M=>{var R;M&&((R=M.userData)!=null&&R.onClick)&&M.userData.onClick()}),console.log("VR Controller raycasting setup completed for Scene1"),console.log("Clickable objects:",F.length),console.log("Portal/Trigger/Electro/Plants/UFO added:",!!(portal!=null&&portal.mesh)||!!(triggerPoint!=null&&triggerPoint.mesh)||!!(electroComponents!=null&&electroComponents.electro)||!!cactus||!!ufo),window.debugVRClickableObjects=()=>{console.log("Current VR clickable objects:",window.vrClickableObjects),window.vrClickableObjects&&window.vrClickableObjects.forEach((M,R)=>{console.log(`Object ${R}:`,M.name||M.type,M.userData)})}}function g(){if(t.modeSelected==="vr")renderer$2.setAnimationLoop(y);else{let F=function(){if(!camera$1){cancelAnimationFrame(animationFrameId$1);return}animationFrameId$1=requestAnimationFrame(F),y()};F()}}function y(){var O,$,T,D,P,L;if(!scene$1||!camera$1||!renderer$2||!camera$1.isCamera)return;const F=r.getDelta();if(t.modeSelected==="vr"?updateVR():controls$1&&controls$1.update(),portal&&portal.update(r.getElapsedTime()),avatarHangingSwayUniforms.length){const B=r.getElapsedTime();for(const b of avatarHangingSwayUniforms)b.uTime&&(b.uTime.value=B)}updateMinimap(),triggerPoint&&triggerPoint.updateQuarksScene&&((O=sceneInitialization$1==null?void 0:sceneInitialization$1.playerFunction)!=null&&O.player)&&triggerPoint.updateQuarksScene(F,sceneInitialization$1.playerFunction.player),electroComponents!=null&&electroComponents.electroMixer&&electroComponents.electroMixer.update(F),cactusMixer&&cactusMixer.update(F),carnivorousMixer&&carnivorousMixer.update(F),updateElectro(F);const M=getElectroState();hologramEffect&&typeof hologramEffect.update=="function"&&!(M!=null&&M.isCleanupInProgress)&&hologramEffect.update(F);let R=camera$1;if(isCameraTransitioning){const B=(performance.now()-transitionStartTime)/1e3,b=Math.min(B/transitionDuration,1),z=b*b*(3-2*b),N=new Vector3$1().lerpVectors(transitionStartPosition,transitionTargetPosition,z),G=new Quaternion$1().slerpQuaternions(transitionStartQuaternion,transitionTargetQuaternion,z);isElectroFocusActive?(electroFocusCamera.position.copy(N),electroFocusCamera.quaternion.copy(G),R=electroFocusCamera):(camera$1.position.copy(N),camera$1.quaternion.copy(G),R=camera$1),b>=1&&(isCameraTransitioning=!1)}else isElectroFocusActive?R=electroFocusCamera:R=camera$1;if(($=sceneInitialization$1==null?void 0:sceneInitialization$1.playerFunction)!=null&&$.player){const B=sceneInitialization$1.playerFunction.player.position;if(cactus&&cactusAction&&a(B,cactus.position)<=ATTACK_DISTANCE&&!isCactusAnimating){isCactusAnimating=!0,cactusAction.reset().play();try{attackAudio&&(attackAudio.setLoop?attackAudio.setLoop(!0):attackAudio.loop=!0,attackAudio.isPlaying||(T=attackAudio.play)==null||T.call(attackAudio))}catch{}toggleVignette(!0),playerLife=Math.max(0,playerLife-10),updateLifeDisplay();const z=cactusAction.getClip().duration*1e3;setTimeout(()=>{var N;isCactusAnimating=!1,toggleVignette(!1);try{!isCactusAnimating&&!isCarnivorousAnimating&&attackAudio&&(attackAudio.setLoop?attackAudio.setLoop(!1):attackAudio.loop=!1,attackAudio.stop?attackAudio.stop():(N=attackAudio.pause)==null||N.call(attackAudio))}catch{}},z)}if(carnivorous&&carnivorousAction&&a(B,carnivorous.position)<=ATTACK_DISTANCE&&!isCarnivorousAnimating){isCarnivorousAnimating=!0,carnivorousAction.reset().play();try{attackAudio&&(attackAudio.setLoop?attackAudio.setLoop(!0):attackAudio.loop=!0,attackAudio.isPlaying||(D=attackAudio.play)==null||D.call(attackAudio))}catch{}toggleVignette(!0),playerLife=Math.max(0,playerLife-15),updateLifeDisplay();const z=carnivorousAction.getClip().duration*1e3;setTimeout(()=>{var N;isCarnivorousAnimating=!1,toggleVignette(!1);try{!isCactusAnimating&&!isCarnivorousAnimating&&attackAudio&&(attackAudio.setLoop?attackAudio.setLoop(!1):attackAudio.loop=!1,attackAudio.stop?attackAudio.stop():(N=attackAudio.pause)==null||N.call(attackAudio))}catch{}},z)}}if((P=sceneInitialization$1==null?void 0:sceneInitialization$1.playerFunction)!=null&&P.player&&portal&&portal.mesh){const B=sceneInitialization$1.playerFunction.player.position;a(B,portal.mesh.position)<=2&&!isSceneTransitioning$1&&(l("scene1"),handlePortalSceneSwitch({renderer:renderer$2,nextEntry:assetsEntry$7,initializeNextScene:initializeScene2,cleanupCurrentScene:cleanupScene1,sceneInitialization:sceneInitialization$1,isSceneTransitioningRef:{value:isSceneTransitioning$1},handleKeyPress:o}))}if(t.modeSelected==="vr"&&((L=sceneInitialization$1==null?void 0:sceneInitialization$1.playerFunction)!=null&&L.player)&&!window.isElectroSequencePlaying){const B=sceneInitialization$1.playerFunction.player;collisionMesh&&handleCollisions(B,collisionMesh,playerState.velocity,F),playerState.velocity.length()>0&&(B.position.x+=playerState.velocity.x*F,B.position.z+=playerState.velocity.z*F,playerState.onGround||(B.position.y+=playerState.velocity.y*F))}renderer$2&&scene$1&&R&&R.isCamera&&renderer$2.render(scene$1,R)}return g(),resizeHandler$1=()=>{camera$1&&renderer$2&&(camera$1.aspect=window.innerWidth/window.innerHeight,camera$1.updateProjectionMatrix(),renderer$2.setSize(window.innerWidth,window.innerHeight))},window.addEventListener("resize",resizeHandler$1),{scene:scene$1,camera:camera$1,renderer:renderer$2,controls:controls$1,sceneInitialization:sceneInitialization$1,electroComponents}}function cleanupScene1(){var n,e,t,o;backgroundAudio&&(backgroundAudio.pause(),backgroundAudio.currentTime=0,backgroundAudio=null);try{attackAudio&&(attackAudio.setLoop?attackAudio.setLoop(!1):attackAudio.loop=!1,attackAudio.stop?attackAudio.stop():(n=attackAudio.pause)==null||n.call(attackAudio),attackAudio=null)}catch{}resizeHandler$1&&(window.removeEventListener("resize",resizeHandler$1),resizeHandler$1=null),animationFrameId$1&&(cancelAnimationFrame(animationFrameId$1),animationFrameId$1=null),portal&&(portal.dispose(),portal=null),cleanupMinimap(),cleanupObjectives(),triggerPoint&&typeof triggerPoint.removeParticleEffects=="function"&&(triggerPoint.removeParticleEffects(),triggerPoint=null),electroComponents&&(electroComponents.electroMixer&&electroComponents.electroMixer.stopAllAction(),electroComponents.electro&&(scene$1.remove(electroComponents.electro),electroComponents.electro.geometry&&electroComponents.electro.geometry.dispose(),electroComponents.electro.material&&(Array.isArray(electroComponents.electro.material)?electroComponents.electro.material.forEach(i=>i.dispose()):electroComponents.electro.material.dispose())),electroComponents=null),cleanupElectro(),cleanupVR(),(e=sceneInitialization$1==null?void 0:sceneInitialization$1.playerFunction)!=null&&e.player&&disablePlayerMovement(sceneInitialization$1.playerFunction.player),window.vrClickableObjects&&(window.vrClickableObjects.length=0,delete window.vrClickableObjects),(t=scene$1==null?void 0:scene$1.userData)!=null&&t.grassGroup&&(scene$1.userData.grassGroup.traverse(i=>{i.geometry&&i.geometry.dispose(),i.material&&(Array.isArray(i.material)?i.material.forEach(s=>s.dispose()):i.material.dispose())}),scene$1.remove(scene$1.userData.grassGroup),scene$1.userData.grassGroup=null),ufo&&(ufo.traverse(i=>{i.isMesh&&(i.geometry&&i.geometry.dispose(),i.material&&(Array.isArray(i.material)?i.material.forEach(s=>s.dispose()):i.material.dispose()))}),scene$1.remove(ufo),ufo=null),lifeBarContainer&&(document.body.removeChild(lifeBarContainer),lifeBarContainer=null),deathScreenContainer&&(document.body.removeChild(deathScreenContainer),deathScreenContainer=null),vignetteOverlay&&(document.body.removeChild(vignetteOverlay),vignetteOverlay=null),cleanupInventory(),cactus&&(cactus.traverse(i=>{i.isMesh&&(i.geometry&&i.geometry.dispose(),i.material&&(Array.isArray(i.material)?i.material.forEach(s=>s.dispose()):i.material.dispose()))}),scene$1.remove(cactus),cactus=null),carnivorous&&(carnivorous.traverse(i=>{i.isMesh&&(i.geometry&&i.geometry.dispose(),i.material&&(Array.isArray(i.material)?i.material.forEach(s=>s.dispose()):i.material.dispose()))}),scene$1.remove(carnivorous),carnivorous=null),avatarHangingMesh=null,avatarHangingSwayUniforms=[],(o=sceneInitialization$1==null?void 0:sceneInitialization$1.playerFunction)!=null&&o.player,scene$1&&scene$1.traverse(i=>{i.geometry&&i.geometry.dispose(),i.material&&(Array.isArray(i.material)?i.material.forEach(s=>s.dispose()):i.material.dispose())}),controls$1&&controls$1.dispose(),scene$1=null,camera$1=null,controls$1=null,sceneInitialization$1=null,isCactusAnimating=!1,isCarnivorousAnimating=!1,isPlayerDead=!1,playerLife=100,collisionMesh=null,window.debugVRClickableObjects&&delete window.debugVRClickableObjects}const assetsEntry={characters:[],models:[{name:"roboticsLab",path:"scene77/roboLab.glb"},{name:"pin4Female",path:"scene77/pin4Female.glb",scale:{x:6,y:6,z:6},shadow:!0},{name:"pin2Female",path:"scene77/pin2Female.glb",scale:{x:.6,y:.6,z:.6}},{name:"pin3Female",path:"scene77/pin3Female.glb",scale:{x:.09,y:.09,z:.09}},{name:"assembeldBot",path:"scene77/assembeldBot.glb",scale:{x:6,y:6,z:6}}],textures:[{name:"botMiddleClip",path:"/scene77/botBuildingTextures/BD_O5.png"},{name:"expansionBoard",path:"/scene77/botBuildingTextures/BOARD1.png"},{name:"buckConverter",path:"/scene77/botBuildingTextures/BUCK.png"},{name:"buzzerModule",path:"/scene77/botBuildingTextures/BUZZER.png"},{name:"chargingModule",path:"/scene77/botBuildingTextures/CG_MODULE.png"},{name:"ldrModule",path:"/scene77/botBuildingTextures/LIDAR.png"},{name:"motorDriver",path:"/scene77/botBuildingTextures/MOTOR DRIVER.png"},{name:"powerDistributionBoard",path:"/scene77/botBuildingTextures/PWR_DIS.png"},{name:"pushButton",path:"/scene77/botBuildingTextures/PWR_SWITCH.png"},{name:"rgbModule",path:"/scene77/botBuildingTextures/RGB.png"},{name:"toggleSwitch",path:"/scene77/botBuildingTextures/START.png"},{name:"arduinoBoard",path:"/scene77/botBuildingTextures/UNO.png"},{name:"batteryCase",path:"/scene77/botBuildingTextures/batteryCase.png"},{name:"botBase",path:"/scene77/botBuildingTextures/BASE.png"},{name:"botMiddleCase2",path:"/scene77/botBuildingTextures/BD_O1.png"},{name:"topCase",path:"/scene77/botBuildingTextures/BD_O2.png"},{name:"botMiddleCase",path:"/scene77/botBuildingTextures/BD_O4.png"}],videoTextures:[],audios:Array.from({length:59},(n,e)=>{const t=e+1;return{name:`step${t}`,path:`/scene77/botBuildingAudio/step${t}.wav`}}),hdris:[{name:"background",path:"/hdris/sky.hdr"}],cubeMaps:[],vfxs:[],pathFiles:[],jsonFiles:[],fonts:[{fontName:"robotoFont",data:{jsonDataPath:"/fonts/msdf/Roboto-msdf.json",textureDataPath:"/fonts/msdf/Roboto-msdf.png"}}],svgs:[]},assetsEntry$1=Object.freeze(Object.defineProperty({__proto__:null,assetsEntry},Symbol.toStringTag,{value:"Module"}));class Wire{constructor(e,t=null){this.wireConfig=e,this.scene=t,this.wire=null,this.curve=null,this.createGeometry()}createCurve(e,t){const o=new Vector3$1().addVectors(e,t).multiplyScalar(.5);o.y+=.1,this.curve=new CatmullRomCurve3([e,o,t])}createGeometry(){const{startPosition:e,endPosition:t,color:o}=this.wireConfig;this.createCurve(e,t);const i=new TubeGeometry(this.curve,20,.0015,8,!1),s=new MeshStandardMaterial({color:o});this.wire=new Mesh(i,s),this.scene&&this.scene.add(this.wire)}updateWire(e){this.wireConfig.endPosition.copy(e),this.createCurve(this.wireConfig.startPosition,this.wireConfig.endPosition);const t=new TubeGeometry(this.curve,20,.0015,8,!1);this.wire.geometry.dispose(),this.wire.geometry=t}dispose(){this.wire&&(this.scene&&this.scene.remove(this.wire),this.wire.geometry.dispose(),this.wire.material.dispose(),this.wire=null)}}const Te=class Te{static getAllModels(){return this.allModels}constructor(e){Te.count++,this.config={pinCount:e.pinCount||2,position:e.position||null,wireConfigs:e.wireConfigs||[],twoSide:e.twoSide||!1,jstPinConfig:e.jstPinConfig||[],colors:e.colors||[],draggablePins:e.draggablePins||["pinGLTF1","pinGLTF2"],draggable:e.draggable!==void 0?e.draggable:!0},this.config.draggable||(this.config.draggablePins=[]),this.pinGLTF1=null,this.pinGLTF2=null,this.wires=[],this.group=new Group,this.isDraggable=!0,this.pinPositions1=[],this.pinPositions2=[],this.wasAutoMoved=!1,this.originalPinPositions=new Map,this.id=Te.count,this.configurePinModel(),this.createWires(),this.groupInitialPosition=this.group.position.clone()}setDraggable(e,t=["pinGLTF1","pinGLTF2"]){this.config.draggable=e,e?this.config.draggablePins=t:this.config.draggablePins=[],this.updateModelDraggability(this.config.draggablePins)}configurePinModel(){let{pinCount:e,position:t,twoSide:o,jstPinConfig:i,draggablePins:s}=this.config,r=null;try{e===2?r=allAssets$4.models.gltf.pin2Female:e===3?r=allAssets$4.models.gltf.pin3Female:e===4&&(r=allAssets$4.models.gltf.pin4Female)}catch{console.warn(`Pin model for ${e} pins not found, creating fallback geometry`)}r||(r=this.createFallbackPinModel(e)),this.pinGLTF1=r.clone(),o?this.pinGLTF1.position.copy(i[0].startPosition):this.pinGLTF1.position.copy(t),this.group.add(this.pinGLTF1),o&&(this.pinGLTF2=r.clone(),this.pinGLTF2.rotation.z=Math.PI*3,this.pinGLTF2.position.copy(i[1].startPosition),this.group.add(this.pinGLTF2)),this.group.name=`jstPin${Te.count}`,this.updateModelDraggability(s)}createFallbackPinModel(e){const t=new Group,o=new BoxGeometry(.5,.2,.3),i=new MeshPhongMaterial({color:6710886}),s=new Mesh(o,i);t.add(s);const r=.2,a=-(e-1)*r/2;for(let l=0;l<e;l++){const c=new CylinderGeometry(.02,.02,.1,8),d=new MeshPhongMaterial({color:8947848}),u=new Mesh(c,d);u.position.x=a+l*r,u.position.y=.15,u.name=`pin${l+1}`,t.add(u)}return t}updateModelDraggability(e){let{twoSide:t}=this.config;this.pinPositions1=[],this.pinGLTF1.traverse(s=>{if(s.name.includes("pin")&&s.isMesh){const r=new Vector3$1;s.getWorldPosition(r),this.pinPositions1.push(r)}});const o=[{model:this.pinGLTF1,draggable:e.includes("pinGLTF1"),pinType:"pinGLTF1"}];t&&(this.pinPositions2=[],this.pinGLTF2.traverse(s=>{if(s.name.includes("pin")&&s.isMesh){const r=new Vector3$1;s.getWorldPosition(r),this.pinPositions2.push(r)}}),o.push({model:this.pinGLTF2,draggable:e.includes("pinGLTF2"),pinType:"pinGLTF2"}));const i=Te.allModels.findIndex(s=>s.id===this.id);i!==-1?Te.allModels[i].models=o:Te.allModels.push({instance:this,models:o,id:this.id}),console.log("Updated allModels:",Te.allModels)}createWires(){let{twoSide:e,wireConfigs:t,colors:o}=this.config,i=this.config.pinCount-1;for(let s=0;s<this.config.pinCount;s++){const r={startPosition:e?this.pinPositions2[i]:t[s].startPosition.clone(),endPosition:this.pinPositions1[s],color:e?o[s]:t[s].color},a=new Wire(r,null);this.wires.push(a),this.group.add(a.wire),i--}}updatePosition(e,t){this.group.position.copy(this.groupInitialPosition);const o=t===this.pinGLTF1,i=this.config.twoSide&&t===this.pinGLTF2;this.pinPositions1=[],this.pinGLTF1.traverse(r=>{if(r.name.includes("pin")&&r.isMesh){const a=new Vector3$1;r.getWorldPosition(a),this.pinPositions1.push(a)}}),this.config.twoSide&&(this.pinPositions2=[],this.pinGLTF2.traverse(r=>{if(r.name.includes("pin")&&r.isMesh){const a=new Vector3$1;r.getWorldPosition(a),this.pinPositions2.push(a)}}));let s=this.config.pinCount-1;this.wires.forEach((r,a)=>{this.config.twoSide?o?(r.updateWire(this.pinPositions1[a]),r.wireConfig.startPosition.copy(this.pinPositions2[s])):i&&(r.wireConfig.startPosition.copy(this.pinPositions2[s]),r.updateWire(this.pinPositions1[a])):(r.updateWire(this.pinPositions1[a]),r.wireConfig.startPosition.copy(this.config.wireConfigs[a].startPosition)),s--})}getGroup(){return this.group}dispose(){this.group&&this.group.parent&&this.group.parent.remove(this.group),this.wires.forEach(t=>{t&&t.dispose&&t.dispose()}),this.wires=[];const e=t=>{t&&t.traverse(o=>{o.isMesh&&(o.geometry&&o.geometry.dispose(),o.material&&(Array.isArray(o.material)?o.material.forEach(i=>i.dispose()):o.material.dispose()))})};e(this.pinGLTF1),this.pinGLTF1=null,this.config.twoSide&&this.pinGLTF2&&(e(this.pinGLTF2),this.pinGLTF2=null),Te.allModels=Te.allModels.filter(t=>t.id!==this.id),this.config=null,this.pinPositions1=[],this.pinPositions2=[],this.originalPinPositions.clear(),this.group=null,console.log(`JstXhFemalePin ${this.id} disposed`)}};Ie(Te,"count",0),Ie(Te,"allModels",[]);let JstXhFemalePin=Te;function AudioHandler(n){return new Promise((e,t)=>{n.stop(),n.offset=0,n.play();const o=()=>{n.source.removeEventListener("ended",o),e()};n.source.addEventListener("ended",o)})}function isAudioPlaying(n){return n?n.isPlaying===!0:!1}class RaycasterSetup2{constructor(e,t,o,i){return RaycasterSetup2.instance||(this.scene=e,this.camera=t,this.controls=o,this.stepCounterCallback=i,this.currentStep=i(),this.mouseCoord=new Vector2$1,this.raycaster=new Raycaster,this.raycaster.near=0,this.raycaster.far=1/0,this.draggedPinModel=null,this.lastPosition=null,this.pinModelsRef=JstXhFemalePin.getAllModels(),console.log("pinModelsRef initialized:",this.pinModelsRef),this.kpLessons=!0,this.interactiveObjects=[],this.sidePanelObjects=[],this.isDragging=!1,this.draggedComponent=null,this.originalPosition=null,this.draggedElement=null,this.referencePlaneGeometry=new PlaneGeometry(10,10,8,8),this.referencePlaneGeometry.rotateX(-Math.PI*.5),this.referencePlaneMaterial=new MeshBasicMaterial({color:"red",transparent:!0,side:DoubleSide,visible:!1,opacity:.5}),this.referencePlane=new Mesh(this.referencePlaneGeometry,this.referencePlaneMaterial),this.referencePlane.position.set(0,2,0),this.scene.add(this.referencePlane),window.addEventListener("mousedown",s=>this.onMouseDown(s)),window.addEventListener("mousemove",s=>this.onMouseMove(s)),window.addEventListener("mouseup",s=>this.onMouseUp(s)),RaycasterSetup2.instance=this),RaycasterSetup2.instance}updateStep(e){this.currentStep=e,console.log("RaycasterSetup2 updated to step:",this.currentStep)}refreshPinModelsRef(){this.pinModelsRef=JstXhFemalePin.getAllModels()}addSidePanelObjects(...e){this.sidePanelObjects.push(...e)}onMouseDown(e){if(this.mouseCoord.x=e.clientX/window.innerWidth*2-1,this.mouseCoord.y=-(e.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(this.mouseCoord,this.camera),this.refreshPinModelsRef(),isAudioPlaying(allAssets$4.audios[`step${this.currentStep}`]))return;const o={1:"botBody",2:"chargingModule",3:"motor1",4:"motor2",5:"battery",6:"motorCasing",7:"motorDriver",8:null,9:null,10:"bucConverter",11:"switch",12:"powerDistributionBoard",13:null,14:null,15:null,16:null,17:null,18:null,19:null,20:"botClosingCase",21:"botMiddleClip1",22:"botMiddleCase",23:"expansionBoard",24:null,25:null,26:"frontPannel",27:"rightEye",28:"leftEye",29:"rgbModuleRight",30:"rgbModuleLeft",31:"arduinoNano",32:null,33:null,34:null,35:null,36:"topCase",37:"tsopSensor",38:null,39:"pushButton",40:null,41:"buzzerSensor",42:null,43:"ldrSensor",44:null,45:null,46:null,47:null,48:null,49:"tyreCase1",50:"tyre1"}[this.currentStep];if(!o&&this.currentStep!==8){console.warn("No component defined for step:",this.currentStep);return}const i=this.raycaster.intersectObjects(this.sidePanelObjects,!0);if(i.length>0){let c=i[0].object;for(;c&&!this.sidePanelObjects.includes(c);)c=c.parent;if(c&&this.sidePanelObjects.includes(c)&&c.name===o){c.children[0]&&(c.children[0].visible=!0);const d=c.children[0].clone();if(d.traverse(u=>{u.isMesh&&u.material&&(u.material=u.material.clone())}),d){this.draggedElement=c;const u=this.scene.getObjectByName("table2");if(u){u.add(d);const f=this.raycaster.intersectObject(this.referencePlane);if(f.length>0){const h=f[0].point,m=u.worldToLocal(h.clone());d.position.copy(m)}this.isDragging=!0,this.draggedComponent=d,this.originalPosition=d.position.clone(),this.draggedPinModel=null,this.controls.enabled=!1,console.log("Started dragging side panel mesh:",d.name||"Unnamed")}else console.warn("Table not found for adding dragged mesh.")}}else console.log("Ignoring drag: Component",c==null?void 0:c.name,"does not match step",this.currentStep,"expected component",o);return}const s=this.pinModelsRef.flatMap(l=>l.models.filter(c=>c.draggable).map(c=>c.model)),r=this.raycaster.intersectObjects(s,!0);if(r.length>0){let c=r[0].object;for(;c.parent&&!s.includes(c);)c=c.parent;const d=this.pinModelsRef.find(u=>u.models.some(f=>f.model===c&&f.draggable));d?(this.isDragging=!0,this.draggedComponent=d.instance,this.draggedPinModel=c,this.originalPosition=c.position.clone(),this.lastPosition=c.position.clone(),this.controls.enabled=!1):console.warn("No component data found for intersected JST pin model:",c);return}const a=this.raycaster.intersectObjects(this.interactiveObjects,!0);if(a.length>0){let c=a[0].object;for(;c.parent&&!this.interactiveObjects.includes(c);)c=c.parent;this.interactiveObjects.includes(c)&&c.name===o?(this.isDragging=!0,this.draggedComponent=c,this.originalPosition=c.position.clone(),this.draggedPinModel=null,this.controls.enabled=!1,console.log("Dragging interactive object:",c.name||"Unnamed")):console.log("Ignoring drag: Interactive object",c.name,"does not match step",this.currentStep,"expected component",o)}}onMouseMove(e){if(!this.isDragging||!this.draggedComponent)return;this.mouseCoord.x=e.clientX/window.innerWidth*2-1,this.mouseCoord.y=-(e.clientY/window.innerHeight)*2+1,this.raycaster.setFromCamera(this.mouseCoord,this.camera);const t=this.raycaster.intersectObject(this.referencePlane);if(t.length>0){const o=t[0].point;if(this.draggedComponent instanceof JstXhFemalePin){if(!this.draggedPinModel){console.warn("onMouseMove: Dragging aborted - missing draggedPinModel for JST pin");return}const i=this.draggedPinModel.parent.parent;if(!i){console.error("draggedPinModel has no grandparent (table):",this.draggedPinModel),this.isDragging=!1;return}const s=i.worldToLocal(o.clone());this.draggedPinModel.position.copy(s),this.draggedComponent.updatePosition(s,this.draggedPinModel)}else if(this.draggedComponent.name==="ldrTestingCube"){this.referencePlane.rotation.x=Math.PI*.5,this.referencePlane.position.set(0,0,-3.3);const i=this.draggedComponent.parent;if(!i){console.error("draggedComponent has no parent:",this.draggedComponent),this.isDragging=!1;return}i.position;let s=Math.max(2,Math.min(2.4,t[0].point.y));this.draggedComponent.position.set(this.draggedComponent.position.x,s,-3.3)}else{const i=this.draggedComponent.parent;if(!i){console.error("draggedComponent has no parent:",this.draggedComponent),this.isDragging=!1;return}const s=i.worldToLocal(o.clone());this.draggedComponent.position.copy(s)}}}onMouseUp(e){if(this.isDragging&&this.draggedComponent&&(this.draggedComponent.visible=!1),this.isDragging=!1,this.draggedComponent=null,this.originalPosition=null,this.draggedPinModel=null,this.lastPosition=null,this.controls.enabled=!0,this.draggedElement){this.draggedElement.parent&&this.draggedElement.parent.remove(this.draggedElement);const t=this.sidePanelObjects.indexOf(this.draggedElement);t!==-1&&this.sidePanelObjects.splice(t,1),this.draggedElement=null}}snapObject(e,t,o,i,s){gsapWithCSS.to(e.position,{x:t.x,y:t.y-.01,z:t.z,duration:.5,ease:"power2.out",onUpdate:()=>{o instanceof JstXhFemalePin&&i&&o.updatePosition(e.position,i)},onComplete:()=>{if(o instanceof JstXhFemalePin&&i){o.updatePosition(t,i);const a=this.pinModelsRef.findIndex(l=>l.models.some(c=>c.model===i));if(a!==-1){const c=this.pinModelsRef[a].models.find(d=>d.model===i);c&&(c.draggable=!1,console.log(`Set ${c.pinType} draggability to false`)),console.log("Updated pinModelsRef:",this.pinModelsRef)}else console.warn("Pin model not found in pinModelsRef:",i)}const r=this.interactiveObjects.indexOf(e);r!==-1&&(this.interactiveObjects.splice(r,1),console.log("Removed object from interactiveObjects:",e)),s&&s()}})}addInteractiveObjects(...e){this.interactiveObjects.push(...e)}static getInstance(){return RaycasterSetup2.instance}}function BlinkMesh(n){if(!Array.isArray(n)||n.length===0){console.log("Blinking objects array is empty or invalid");return}const e=new Map;if(n.forEach(r=>{r&&r.traverse(a=>{a.isMesh&&a.material&&(e.set(a,a.material),a.material=a.material.clone(),a.material.transparent=!0,a.material.opacity=1)})}),e.size===0){console.log("No meshes with materials found in given objects");return}let t=0,o=!0,i;function s(){if(!o)return;t+=.02;const r=.2+.8*(.5+.5*Math.sin(t));n.forEach(a=>{a&&a.traverse(l=>{l.isMesh&&l.material&&(l.material.opacity=r)})}),i=requestAnimationFrame(s)}return s(),()=>{o=!1,cancelAnimationFrame(i),e.forEach((r,a)=>{a.material=r})}}function HideMesh(n,e=0){if(!Array.isArray(n)||n.length===0){console.log("Blinking objects array is empty or invalid");return}const t=new Map;if(n.forEach(i=>{i&&i.traverse(s=>{s.isMesh&&s.material&&(t.set(s,s.material),s.material=s.material.clone(),s.material.transparent=!0,s.material.opacity=1)})}),t.size===0){console.log("No meshes with materials found in given objects");return}function o(){n.forEach(i=>{i&&i.traverse(s=>{s.isMesh&&s.material&&(s.material.opacity=e)})})}return o(),()=>{t.forEach((i,s)=>{s.material=i})}}function getWorldPosititon(n){const e=new Vector3$1;return n.getWorldPosition(e),e}function setupForNextSetup(n,e,t,o,i,s,r){n.updateStep(e),t.updateElement(o.get(s).mesh,i,s,r),n.addSidePanelObjects(...t.elements)}function getDistance(n,e){const t=getWorldPosititon(n.draggedComponent),o=getWorldPosititon(e);return{distance:t.distanceTo(o),targetPos:o}}function snappingEffect(n,[e,t,o]){const i=n.position.clone();n.position.add(new Vector3$1(e,t,o)),gsapWithCSS.to(n.position,{x:i.x,y:i.y,z:i.z})}function getChildrenMesh(n,e){let t=null;return n.traverse(o=>{o.name===e&&(t=o)}),t}function Sidepanel(n,e,t){const o=getChildrenMesh(allAssets$4.models.gltf.roboticsLab,"screen"),i=[],s=.5;let r=null;console.log(allAssets$4);function a(f){r&&(o.remove(r),r=null),r=new __webpack_exports__default.Block({width:3,height:.4,justifyContent:"start",contentDirection:"column",backgroundOpacity:0,fontFamily:allAssets$4.fonts.robotoFont.json,fontTexture:allAssets$4.fonts.robotoFont.image,borderRadius:.1,fontSize:.1,padding:.05});const h=new __webpack_exports__default.Text({content:f||"",textAlign:"left",fontColor:new Color(16777215)});r.add(h),r.position.set(0,-.2,.01),r.visible=!0,o.add(r),__webpack_exports__default.update()}function l(f,h,m,p){const v=new PlaneGeometry(s,s,1,1),g=new MeshBasicMaterial({map:h,side:DoubleSide}),y=new Mesh(v,g);y.name=m,o.add(y);const w=f.clone();w.name==="buzzerSensor"?w.scale.set(.0025,.0025,.0025):w.scale.set(.05,.05,.05),w.traverse(_=>{_.isMesh&&_.material&&(_.material=_.material.clone(),_.material.transparent=!1,_.material.opacity=1)}),y.add(w),w.visible=!1,y.position.set(0,.4,.1),y.visible=!0,i.push(y),a(p)}function c(f,h,m,p){u(),l(f,h,m,p)}function d(f){u(),r?(r.children.forEach(h=>{h instanceof __webpack_exports__default.Text&&h.set({content:f||""})}),r.visible=!0,__webpack_exports__default.update()):a(f)}function u(){if(i.length>0){const f=i.pop();f.parent&&f.parent.remove(f)}}return n&&l(n,e,n.name,t),{elements:i,addElement:l,updateElement:c,updateTextOnly:d}}class SubtitleSystem{constructor(){this.subtitleContainer=null,this.backgroundElement=null,this.currentTimeout=null,this.isActive=!1,this.loadStyles()}loadStyles(){if(document.getElementById("subtitle-styles"))return;const e=document.createElement("link");e.id="subtitle-styles",e.rel="stylesheet",e.type="text/css",e.href="./scene7/styles/subtitleStyles.css",document.head.appendChild(e)}createSubtitleContainer(){this.subtitleContainer&&this.removeSubtitleContainer(),this.backgroundElement=document.createElement("div"),this.backgroundElement.className="subtitle-background",document.body.appendChild(this.backgroundElement),this.subtitleContainer=document.createElement("div"),this.subtitleContainer.id="subtitle-container",this.subtitleContainer.style.cssText=`
      position: fixed;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10000;
      text-align: center;
      pointer-events: none;
      font-family: 'Courier New', 'Monaco', monospace;
      max-width: 80%;
    `,document.body.appendChild(this.subtitleContainer)}async showSubtitle(e,t=3e3){return new Promise(o=>{this.subtitleContainer||this.createSubtitleContainer(),this.isActive=!0,this.backgroundElement&&this.backgroundElement.classList.add("active"),this.subtitleContainer.innerHTML="";const i=document.createElement("div");i.className="subtitle-text",this.subtitleContainer.appendChild(i),setTimeout(()=>{i.classList.add("show")},200),this.typeText(i,e,120).then(()=>{setTimeout(()=>{i.classList.remove("show"),i.classList.add("hide"),setTimeout(()=>{this.subtitleContainer&&this.subtitleContainer.contains(i)&&this.subtitleContainer.removeChild(i),this.isActive=!1,o()},800)},t)})})}async typeText(e,t,o=100){const i=t.split(" ");e.textContent="";for(let s=0;s<i.length;s++)await new Promise(r=>setTimeout(r,o)),e.textContent+=(s>0?" ":"")+i[s]}async showSequence(e,t=[]){for(let o=0;o<e.length;o++){const i=t[o]||3e3;await this.showSubtitle(e[o],i)}}removeSubtitleContainer(){this.backgroundElement&&(this.backgroundElement.classList.remove("active"),setTimeout(()=>{this.backgroundElement&&this.backgroundElement.parentElement&&document.body.removeChild(this.backgroundElement),this.backgroundElement=null},800)),this.subtitleContainer&&(document.body.removeChild(this.subtitleContainer),this.subtitleContainer=null),this.isActive=!1}cleanup(){this.currentTimeout&&clearTimeout(this.currentTimeout),this.removeSubtitleContainer();const e=document.getElementById("subtitle-styles");e&&document.head.removeChild(e)}}class VideoPlayer{constructor(){this.videoElement=null,this.isPlaying=!1}async playVideo(e,t=null){return new Promise(o=>{this.videoElement&&this.removeVideo(),this.videoElement=document.createElement("video"),this.videoElement.src=e,this.videoElement.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        object-fit: cover;
        z-index: 20000;
        background: black;
      `,this.videoElement.controls=!1,this.videoElement.autoplay=!0,this.videoElement.muted=!1,document.body.appendChild(this.videoElement),this.videoElement.onended=()=>{this.removeVideo(),this.cleanupAndRedirect(),t&&t(),o()},this.videoElement.onerror=i=>{console.error("Video playback error:",i),this.removeVideo(),this.cleanupAndRedirect(),o()},this.isPlaying=!0})}cleanupAndRedirect(){const e=document.getElementById("subtitle-container");e&&e.remove();const t=document.querySelector(".subtitle-background");t&&t.remove();const o=document.getElementById("subtitle-styles");o&&o.remove();const i=document.querySelector("canvas");i&&(i.style.display="none",i.style.visibility="hidden"),document.body.style.overflow="hidden",document.body.style.background="black",Array.from(document.body.children).forEach(r=>{r.tagName!=="VIDEO"&&r.remove()}),window.location.replace("./index.html")}removeVideo(){this.videoElement&&(document.body.removeChild(this.videoElement),this.videoElement=null),this.isPlaying=!1}cleanup(){this.removeVideo()}}function showIndication(n,e,t,o){const i=allAssets$4.fonts.robotoFont;function s(p){const v=new __webpack_exports__default.Block({width:.18,height:.06,padding:.005,margin:.002,backgroundOpacity:.85,backgroundColor:new Color(15771648),borderRadius:.01,alignItems:"center",justifyContent:"center",fontFamily:i.json,fontTexture:i.image}),g=new __webpack_exports__default.Text({content:p,fontSize:.018,color:new Color(16777215)});return v.add(g),v}const r=s("Drag"),a=s("Drop"),l=getWorldPosititon(t),c=getWorldPosititon(o);a.position.copy(l).add(new Vector3$1(0,.1,0)),r.position.copy(c).add(new Vector3$1(0,.1,0)),n.add(r,a),r.visible=!0,a.visible=!1;let d=null;function u(){if(!r.parent&&!a.parent)return;const p=e.position.clone();[r,a].forEach(v=>{if(!v.visible)return;const g=v.position.clone(),y=new Vector3$1().subVectors(p,g);y.y=0,y.normalize();const w=g.clone().add(y);v.lookAt(w)}),__webpack_exports__default.update(),d=requestAnimationFrame(u)}u();function f(){r.visible=!r.visible,a.visible=!a.visible}function h(){cancelAnimationFrame(d),n.remove(r,a),m(r),m(a),__webpack_exports__default.update()}function m(p){p.clear(),p.traverse(v=>{v.isMesh&&(v.geometry&&v.geometry.dispose(),v.material&&(Array.isArray(v.material)?v.material.forEach(g=>g.dispose()):v.material.dispose()))})}return{toggleVisibility:f,cleanup:h}}function BotBuilding(n,e,t,o,i){let s=1,r=null;const a=new SubtitleSystem,l=new VideoPlayer;let c=null,d=null,u=null,f=null,h=null,m=null,p=null,v=null,g=null,y=null,w=null,_=null,S=null,C=null;const A=["buzzerPinFemalePin","expansionBoardButtonFemalePin","expansionBoardBuzzerFemale","expansionBoardLdrFemalePin","expansionBoardMotorDriverFemalePin","expansionBoardRgb1FemalePin","expansionBoardRgb2FemalePin","expansionBoardTsopFemalePin","expansionBordPowerFemalePin","ldrFemalePin","motorDriverPowerFemalePin","powerDistributionBatteryFemalePin","powerDistributionChargingModuleFemalePin","powerDistributionMotorDriverFemalePin","powerDistributionSwitchFemalePin","powerDistributionUbecFemalePin","rightRgbFemalePin","tsopFemalePin","PushButtonFemalePin","rgbLeftFemalePin"],E=["buzzerSensorMalePin","expansionBoardButtonMalePin","expansionBoardBuzzerMalePin","expansionBoardLdrMalePin","expansionBoardMotorDriverMalePin","expansionBoardPowerMalePin","expansionBoardRgb1MalePin","expansionBoardRgb2MalePin","expansionBoardTsopMalePin","motorDriverPowerMalePin","ldrMalePin","leftRgbMalePin","powerDistributionBatteryMalePin","powerDistributionMotorDriverMalePin","powerDistributionSwitchMalePin","powerDistributionUbecMalePin","powerDistributionChargingModuleMalePin","pushButtonMalePin","rightRgbMalePin","tsopMalePin"],k=["batteryWire","buttonWire","buzzerWire","chargingModuleWire","leftLedWire","ldrWire","motorDriverPowerWire","motorInputWire","motorWire1","motorWire2","rightLedWire","powerWire","switchWire","tsopWire","ubecWire"],I=["motor1Terminal1","motor1Terminal2","motor2Terminal1","motor2Terminal2","motorDriverMotorsPin2","motorDriverMotorsPin1","motorDriverInputPin","switchTerminal1","switchTerminal2","switchTerminal3","bucConverterNegativeTerminal","bucConverterPositiveTerminal","batteryNegativeTerminal","batteryPositiveTerminal","bucConverterPowerPositiveTerminal","buckConverterPowerNegativeTerminal","chargingModuleNegativeTerminal","chargingModulePositiveTerminal"],F=["botBody","chargingModule","motor1","motor2","battery","motorCasing","motorDriver","bucConverter","powerDistributionBoard","arduinoNano","botClosingCase","botMiddleCase","botMiddleClip1","botMiddleClip2","botMiddleClip3","botMiddleClip4","buzzerSensor","expansionBoard","frontPannel","ldrSensor","leftEye","pushButton","rgbModuleLeft","rgbModuleRight","rightEye","switch","topCase","tsopSensor","tyre1","tyre2","tyre3","tyre4","tyreCase1","tyreCase2","tyreCase3","tyreCase4"],M=["Drag and drop the bot body to the blinking part position","Drag and drop the charging module to the blinking part position","Drag and drop the motor to the blinking part position","Drag and drop the motor to the blinking part position","Drag and drop the battery holder to the blinking part position","Drag and drop the motor casing to the blinking part position","Drag and drop the motor driver to the blinking part position","Connect the motor wire to the motor driver motor pin","Connect the motor wire to the motor driver motor pin","Drag and drop the buck converter to the blinking part position","Drag and drop the switch to the blinking part position","Drag and drop the power distribution board to the blinking part position","Connect the charging module wire to the power distribution board","Connect the battery wire to the power distribution board","Connect the switch wire to the power distribution board","Connect the buck converter wire to the power distribution board","Connect the wire to the motor driver power port","Connect the other end of the wire to the power distribution board","Connect the wire to the motor driver input pin","Drag and drop the bot closing case to the blinking part position","Drag and drop the supporting clip to the blinking part position","Drag and drop the supporting clip to the blinking part position","Drag and drop the supporting clip to the blinking part position","Drag and drop the supporting clip to the blinking part position","Drag and drop the bot middle case to the blinking part position","Drag and drop the expansion board to the blinking part position","Connect the buck converter output wire to the power pin of the expansion board","Connect the other end of the motor driver input pin to the motor driver port of the expansion board","Drag and drop the bot front panel to the blinking part position","Drag and drop the left eye to the blinking part position","Drag and drop the right eye to the blinking part position","Drag and drop the left RGB module to the blinking part position","Drag and drop the right RGB module to the blinking part position","Drag and drop the Arduino Nano to the blinking part position","Connect the wire to the left RGB module","Connect the other end of the wire to the expansion board RGB port","Connect the wire to the right RGB module","Connect the other end of the wire to the expansion board RGB port","Drag and drop the top case to the blinking part position","Drag and drop the TSOP sensor to the blinking part position","Connect the wire to the TSOP sensor","Drag and drop the push button to the blinking part position","Connect the wire to the push button","Drag and drop the buzzer sensor to the blinking part position","Connect the wire to the buzzer sensor","Drag and drop the LDR sensor to the blinking part position","Connect the wire to the LDR sensor","Connect the other end of the wire from the TSOP sensor to the TSOP port of the expansion board","Connect the other end of the wire from the push button to the button port of the expansion board","Connect the other end of the wire from the buzzer to the buzzer port of the expansion board","Connect the other end of the wire from the LDR to the LDR port of the expansion board","Drag and drop the tyre case to the blinking part position","Drag and drop the tyre case to the blinking part position","Drag and drop the tyre case to the blinking part position","Drag and drop the tyre case to the blinking part position","Drag and drop the tyre to the blinking part position","Drag and drop the tyre to the blinking part position","Drag and drop the tyre to the blinking part position","Drag and drop the tyre to the blinking part position"],R=allAssets$4.models.gltf.assembeldBot;R.position.set(-.2,.33,0);const O=new Map,$=new Map,T=new Map,D=new Map,P=new Map,L=new Map;F.forEach(te=>{R.traverse(Z=>{const Q={};Z.name===te&&(Q.mesh=Z.clone(),Q.worldPosition=getWorldPosititon(Q.mesh),O.set(Z.name,Q),Z.visible=!1,$.set(Z.name,Z))})}),k.forEach(te=>{R.traverse(Z=>{const Q={};Z.name===te&&(Q.mesh=Z,Q.worldPosition=getWorldPosititon(Q.mesh),T.set(Z.name,Q),Z.visible=!1)})}),A.forEach(te=>{R.traverse(Z=>{const Q={};Z.name===te&&(Q.mesh=Z,Q.worldPosition=getWorldPosititon(Q.mesh),D.set(Z.name,Q),Z.visible=!1)})}),E.forEach(te=>{R.traverse(Z=>{const Q={};Z.name===te&&(Q.mesh=Z,Q.worldPosition=getWorldPosititon(Q.mesh),P.set(Z.name,Q),Z.visible=!1)})}),I.forEach(te=>{R.traverse(Z=>{const Q={};Z.name===te&&(Q.mesh=Z,Q.mesh.visible=!1,Q.worldPosition=getWorldPosititon(Q.mesh),L.set(Z.name,Q),Z.visible=!1)})});const B=2,b=new RaycasterSetup2(n,e,t,()=>s),z=Sidepanel(O.get("botBody").mesh,allAssets$4.textures.botBase,M[0]);b.addSidePanelObjects(...z.elements);let N=getChildrenMesh(allAssets$4.models.gltf.roboticsLab,"table2");N.add(R);const G=[];async function K(){async function te(){const V=$.get("botBody");V.visible=!0;const j=BlinkMesh([V]);await AudioHandler(allAssets$4.audios[`step${s}`]);const U=b.onMouseUp;b.onMouseUp=q=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="botBody"&&s===1){const{distance:X,targetPos:W}=getDistance(b,V);if(X<B){j(),snappingEffect(V,[0,.04,0]);const H=N.worldToLocal(W.clone());b.snapObject(b.draggedComponent,H,null,null,()=>{s=2,setupForNextSetup(b,s,z,O,allAssets$4.textures.chargingModule,"chargingModule",M[s-1]),Z()})}else N.remove(b.draggedComponent),b.draggedElement=null}U.call(b,q)}}async function Z(){const V=L.get("chargingModuleNegativeTerminal").mesh,j=L.get("chargingModulePositiveTerminal").mesh,U=$.get("chargingModule");U.visible=!0,j.visible=!0,V.visible=!0;const q=BlinkMesh([U,V,j]),X=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=W=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="chargingModule"&&s===2){const{distance:H,targetPos:Y}=getDistance(b,U);if(H<B){q(),snappingEffect(U,[0,.04,0]);const ee=N.worldToLocal(Y.clone());b.snapObject(b.draggedComponent,ee,null,null,()=>{r=new JstXhFemalePin({pinCount:2,twoSide:!1,position:new Vector3$1(0,1.8,-3.5),wireConfigs:[{startPosition:getWorldPosititon(j),color:16711680},{startPosition:getWorldPosititon(V),color:65280}],draggable:!1}),r.pinGLTF1.rotation.y=Math.PI*.5,r.updatePosition(new Vector3$1,r.pinGLTF1),n.add(r.getGroup()),s=3,setupForNextSetup(b,s,z,O,null,"motor1",M[s-1]),Q()})}else N.remove(b.draggedComponent),b.draggedElement=null}X.call(b,W)}}async function Q(){const V=$.get("motor1");V.visible=!0;const j=L.get("motor1Terminal1"),U=L.get("motor1Terminal2"),q=BlinkMesh([V]);await AudioHandler(allAssets$4.audios[`step${s}`]);const X=b.onMouseUp;b.onMouseUp=W=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="motor1"&&s===3){const{distance:H,targetPos:Y}=getDistance(b,V);if(H<B){q(),snappingEffect(V,[0,.04,0]);const ee=N.worldToLocal(Y.clone());b.snapObject(b.draggedComponent,ee,null,null,()=>{j.mesh.visible=!0,U.mesh.visible=!0,d=new JstXhFemalePin({pinCount:2,twoSide:!1,position:new Vector3$1(0,1.8,-3.2),wireConfigs:[{startPosition:getWorldPosititon(j.mesh),color:16711680},{startPosition:getWorldPosititon(U.mesh),color:65280}],draggable:!1}),d.pinGLTF1.rotation.y=Math.PI*.5,d.updatePosition(new Vector3$1,d.pinGLTF1),n.add(d.getGroup()),s=4,setupForNextSetup(b,s,z,O,null,"motor2",M[s-1]),le()})}else N.remove(b.draggedComponent),b.draggedElement=null}X.call(b,W)}}async function le(){const V=$.get("motor2");V.visible=!0;const j=L.get("motor2Terminal1"),U=L.get("motor2Terminal2"),q=BlinkMesh([V]),X=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=W=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="motor2"&&s===4){const{distance:H,targetPos:Y}=getDistance(b,V);if(H<B){q(),snappingEffect(V,[0,.04,0]);const ee=N.worldToLocal(Y.clone());b.snapObject(b.draggedComponent,ee,null,null,()=>{j.mesh.visible=!0,U.mesh.visible=!0,u=new JstXhFemalePin({pinCount:2,twoSide:!1,position:new Vector3$1(0,1.8,-3),wireConfigs:[{startPosition:getWorldPosititon(j.mesh),color:16711680},{startPosition:getWorldPosititon(U.mesh),color:65280}],draggable:!1}),u.pinGLTF1.rotation.y=Math.PI*.5,u.updatePosition(new Vector3$1,u.pinGLTF1),n.add(u.getGroup()),s=5,setupForNextSetup(b,s,z,O,allAssets$4.textures.batteryCase,"battery",M[s-1]),ae()})}else N.remove(b.draggedComponent),b.draggedElement=null}X.call(b,W)}}async function ae(){const V=L.get("batteryNegativeTerminal").mesh,j=L.get("batteryPositiveTerminal").mesh,U=$.get("battery");U.visible=!0;const q=BlinkMesh([U]),X=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=W=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="battery"&&s===5){const{distance:H,targetPos:Y}=getDistance(b,U);if(H<B){q(),snappingEffect(U,[0,.04,0]);const ee=N.worldToLocal(Y.clone());b.snapObject(b.draggedComponent,ee,null,null,()=>{c=new JstXhFemalePin({pinCount:2,twoSide:!1,position:new Vector3$1(0,1.8,-2.8),wireConfigs:[{startPosition:getWorldPosititon(j),color:16711680},{startPosition:getWorldPosititon(V),color:65280}],draggable:!1}),c.pinGLTF1.rotation.y=Math.PI*.5,c.updatePosition(new Vector3$1,c.pinGLTF1),n.add(c.getGroup()),s=6,setupForNextSetup(b,s,z,O,null,"motorCasing",M[s-1]),oe()})}else N.remove(b.draggedComponent),b.draggedElement=null}X.call(b,W)}}async function oe(){const V=$.get("motorCasing");V.visible=!0;const j=BlinkMesh([V]),U=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=q=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="motorCasing"&&s===6){const{distance:X,targetPos:W}=getDistance(b,V);if(X<B){j(),snappingEffect(V,[0,.04,0]);const H=N.worldToLocal(W.clone());b.snapObject(b.draggedComponent,H,null,null,()=>{s=7,setupForNextSetup(b,s,z,O,allAssets$4.textures.motorDriver,"motorDriver",M[s-1]),pe()})}else N.remove(b.draggedComponent),b.draggedElement=null}U.call(b,q)}}async function pe(){const V=L.get("motorDriverMotorsPin2").mesh,j=L.get("motorDriverMotorsPin1").mesh,U=L.get("motorDriverInputPin").mesh,q=P.get("motorDriverPowerMalePin").mesh,X=$.get("motorDriver");X.visible=!0,V.visible=!0,j.visible=!0,U.visible=!0,q.visible=!0;const W=BlinkMesh([X,V,j,U,q]),H=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=Y=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="motorDriver"&&s===7){const{distance:ee,targetPos:ie}=getDistance(b,X);if(ee<B){W(),snappingEffect(X,[0,.04,0]);const re=N.worldToLocal(ie.clone());b.snapObject(b.draggedComponent,re,null,null,()=>{s=8,b.updateStep(s),z.updateTextOnly(M[s-1]),_e()})}else N.remove(b.draggedComponent),b.draggedElement=null}H.call(b,Y)}}async function _e(){const V=L.get("motorDriverMotorsPin1").mesh,j=BlinkMesh([d.getGroup(),V]);d.setDraggable(!0,["pinGLTF1"]),b.refreshPinModelsRef();const U=showIndication(n,e,V,d.pinGLTF1);await AudioHandler(allAssets$4.audios[`step${s}`]);const q=b.onMouseUp,X=b.onMouseDown;b.onMouseDown=W=>{X.call(b,W),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=W=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===d&&s===8){const H=b.draggedPinModel,Y=getWorldPosititon(H),ee=getWorldPosititon(V);Y.distanceTo(ee)<B&&(j(),b.snapObject(H,getWorldPosititon(V),d,H,()=>{U.cleanup();const re=T.get("motorWire1");re.mesh.visible=!0,d.dispose(),d=null,s=9,z.updateTextOnly(M[s-1]),we()}))}q.call(b,W)}}async function we(){const V=L.get("motorDriverMotorsPin2").mesh,j=BlinkMesh([u.getGroup(),V]);b.refreshPinModelsRef();const U=showIndication(n,e,V,u.pinGLTF1);await AudioHandler(allAssets$4.audios[`step${s}`]),u.setDraggable(!0,["pinGLTF1"]);const q=b.onMouseUp,X=b.onMouseDown;b.onMouseDown=W=>{X.call(b,W),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=W=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===u&&s===9){const H=b.draggedPinModel,Y=getWorldPosititon(H),ee=getWorldPosititon(V);Y.distanceTo(ee)<B&&(j(),b.snapObject(H,getWorldPosititon(V),u,H,()=>{U.cleanup();const re=T.get("motorWire2");re.mesh.visible=!0,u.dispose(),u=null,s=10,setupForNextSetup(b,s,z,O,allAssets$4.textures.buckConverter,"bucConverter",M[s-1]),me()}))}q.call(b,W)}}async function me(){const V=L.get("bucConverterPowerPositiveTerminal").mesh,j=L.get("buckConverterPowerNegativeTerminal").mesh,U=L.get("bucConverterNegativeTerminal").mesh,q=L.get("bucConverterPositiveTerminal").mesh,X=$.get("bucConverter");X.visible=!0;const W=BlinkMesh([X]);await AudioHandler(allAssets$4.audios[`step${s}`]);const H=b.onMouseUp;b.onMouseUp=Y=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="bucConverter"&&s===10){const{distance:ee,targetPos:ie}=getDistance(b,X);if(ee<B){W(),snappingEffect(X,[0,.04,0]);const re=N.worldToLocal(ie.clone());b.snapObject(b.draggedComponent,re,null,null,()=>{f=new JstXhFemalePin({pinCount:2,twoSide:!1,position:new Vector3$1(0,1.8,-3.2),wireConfigs:[{startPosition:getWorldPosititon(V),color:16711680},{startPosition:getWorldPosititon(j),color:65280}],draggable:!1}),n.add(f.getGroup()),h=new JstXhFemalePin({pinCount:2,twoSide:!1,position:new Vector3$1(0,1.8,-3.1),wireConfigs:[{startPosition:getWorldPosititon(U),color:16711680},{startPosition:getWorldPosititon(q),color:65280}],draggable:!1}),h.pinGLTF1.rotation.y=Math.PI*.5,h.updatePosition(new Vector3$1,h.pinGLTF1),n.add(h.getGroup()),s=11,setupForNextSetup(b,s,z,O,allAssets$4.textures.toggleSwitch,"switch",M[s-1]),ve()})}else N.remove(b.draggedComponent),b.draggedElement=null}H.call(b,Y)}}async function ve(){const V=$.get("switch"),j=L.get("switchTerminal1"),U=L.get("switchTerminal2"),q=L.get("switchTerminal3");V.visible=!0,j.mesh.visible=!0,U.mesh.visible=!0,q.mesh.visible=!0;const X=BlinkMesh([V]),W=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=H=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="switch"&&s===11){const{distance:Y,targetPos:ee}=getDistance(b,V);if(Y<B){X(),snappingEffect(V,[0,.04,0]);const ie=N.worldToLocal(ee.clone());b.snapObject(b.draggedComponent,ie,null,null,()=>{m=new JstXhFemalePin({pinCount:3,twoSide:!1,position:new Vector3$1(0,1.8,-3),wireConfigs:[{startPosition:getWorldPosititon(j.mesh),color:16711680},{startPosition:getWorldPosititon(U.mesh),color:65280},{startPosition:getWorldPosititon(q.mesh),color:255}],draggable:!1}),n.add(m.getGroup()),s=12,setupForNextSetup(b,s,z,O,allAssets$4.textures.powerDistributionBoard,"powerDistributionBoard",M[s-1]),be()})}else N.remove(b.draggedComponent),b.draggedElement=null}W.call(b,H)}}async function be(){const V=$.get("powerDistributionBoard"),j=P.get("powerDistributionBatteryMalePin"),U=P.get("powerDistributionMotorDriverMalePin"),q=P.get("powerDistributionSwitchMalePin"),X=P.get("powerDistributionUbecMalePin"),W=P.get("powerDistributionChargingModuleMalePin");V.visible=!0,j.mesh.visible=!0,U.mesh.visible=!0,q.mesh.visible=!0,X.mesh.visible=!0,W.mesh.visible=!0;const H=BlinkMesh([V,j.mesh,U.mesh,q.mesh,X.mesh,W.mesh]),Y=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=ee=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="powerDistributionBoard"&&s===12){const{distance:ie,targetPos:re}=getDistance(b,V);if(ie<B){H(),snappingEffect(j.mesh,[0,.04,0]),snappingEffect(U.mesh,[0,.04,0]),snappingEffect(q.mesh,[0,.04,0]),snappingEffect(X.mesh,[0,.04,0]),snappingEffect(W.mesh,[0,.04,0]),snappingEffect(V,[0,.04,0]);const fe=N.worldToLocal(re.clone());b.snapObject(b.draggedComponent,fe,null,null,()=>{s=13,z.updateTextOnly(M[s-1]),ue()})}else N.remove(b.draggedComponent),b.draggedElement=null}Y.call(b,ee)}}async function ue(){const V=P.get("powerDistributionChargingModuleMalePin").mesh,j=BlinkMesh([r.getGroup(),V]),U=showIndication(n,e,V,r.pinGLTF1),q=D.get("powerDistributionChargingModuleFemalePin").mesh,X=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),r.setDraggable(!0,["pinGLTF1"]),b.refreshPinModelsRef();const W=b.onMouseDown;b.onMouseDown=H=>{W.call(b,H),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=H=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===r&&s===13){const Y=b.draggedPinModel,ee=getWorldPosititon(Y),ie=getWorldPosititon(V);ee.distanceTo(ie)<B&&(j(),b.snapObject(Y,ie,r,Y,()=>{U.cleanup();const fe=T.get("chargingModuleWire");fe.mesh.visible=!0,q.visible=!0,r.dispose(),r=null,s=14,z.updateTextOnly(M[s-1]),de()}))}X.call(b,H)}}async function de(){const V=P.get("powerDistributionBatteryMalePin").mesh,j=BlinkMesh([c.getGroup(),V]),U=showIndication(n,e,V,c.pinGLTF1),q=D.get("powerDistributionBatteryFemalePin").mesh,X=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),c.setDraggable(!0,["pinGLTF1"]),b.refreshPinModelsRef();const W=b.onMouseDown;b.onMouseDown=H=>{W.call(b,H),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=H=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===c&&s===14){const Y=b.draggedPinModel,ee=getWorldPosititon(Y),ie=getWorldPosititon(V);ee.distanceTo(ie)<B&&(j(),b.snapObject(Y,ie,c,Y,()=>{U.cleanup();const fe=T.get("batteryWire");fe.mesh.visible=!0,q.visible=!0,c.dispose(),c=null,s=15,z.updateTextOnly(M[s-1]),Se()}))}X.call(b,H)}}async function Se(){const V=P.get("powerDistributionSwitchMalePin").mesh,j=D.get("powerDistributionSwitchFemalePin").mesh,U=BlinkMesh([m.getGroup(),V]),q=showIndication(n,e,V,m.pinGLTF1),X=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),m.setDraggable(!0,["pinGLTF1"]),b.refreshPinModelsRef();const W=b.onMouseDown;b.onMouseDown=H=>{W.call(b,H),b.draggedComponent instanceof JstXhFemalePin&&q.toggleVisibility()},b.onMouseUp=H=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===m&&s===15){const Y=b.draggedPinModel,ee=getWorldPosititon(Y),ie=getWorldPosititon(V);ee.distanceTo(ie)<B&&(U(),q.cleanup(),b.snapObject(Y,getWorldPosititon(V),m,Y,()=>{const fe=T.get("switchWire");fe.mesh.visible=!0,j.visible=!0,m.dispose(),m=null,s=16,z.updateTextOnly(M[s-1]),ge()}))}X.call(b,H)}}async function ge(){const V=P.get("powerDistributionUbecMalePin").mesh,j=D.get("powerDistributionUbecFemalePin").mesh,U=BlinkMesh([h.getGroup(),V]),q=showIndication(n,e,V,h.pinGLTF1),X=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),h.setDraggable(!0,["pinGLTF1"]),b.refreshPinModelsRef();const W=b.onMouseDown;b.onMouseDown=H=>{W.call(b,H),b.draggedComponent instanceof JstXhFemalePin&&q.toggleVisibility()},b.onMouseUp=H=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===h&&s===16){const Y=b.draggedPinModel,ee=getWorldPosititon(Y),ie=getWorldPosititon(V);ee.distanceTo(ie)<B&&(U(),b.snapObject(Y,getWorldPosititon(V),h,Y,()=>{q.cleanup();const fe=T.get("ubecWire");fe.mesh.visible=!0,j.visible=!0,h.dispose(),h=null,s=17,z.updateTextOnly(M[s-1]),Ce()}))}X.call(b,H)}}async function Ce(){p=new JstXhFemalePin({pinCount:2,twoSide:!0,jstPinConfig:[{startPosition:{x:.5,y:1.8,z:-3}},{startPosition:{x:.1,y:1.8,z:-3}}],colors:["red","green","blue"],draggable:!1}),p.pinGLTF2.rotation.x=Math.PI,p.pinGLTF2.rotation.y=Math.PI*.5,p.pinGLTF1.rotation.y=Math.PI*.5,p.updatePosition(new Vector3$1,p.pinGLTF2),p.updatePosition(new Vector3$1,p.pinGLTF1),n.add(p.getGroup());const V=P.get("motorDriverPowerMalePin").mesh,j=BlinkMesh([p.wires[0].wire,p.wires[1].wire,p.pinGLTF1,V]),U=showIndication(n,e,V,p.pinGLTF1),q=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),p.setDraggable(!0,["pinGLTF1"]),b.refreshPinModelsRef();const X=b.onMouseDown;b.onMouseDown=W=>{X.call(b,W),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=W=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===p&&s===17){const H=b.draggedPinModel,Y=getWorldPosititon(H),ee=getWorldPosititon(V);Y.distanceTo(ee)<B&&(j(),U.cleanup(),b.snapObject(H,getWorldPosititon(V),p,H,()=>{s=18,z.updateTextOnly(M[s-1]),ye()}))}q.call(b,W)}}async function ye(){const V=P.get("powerDistributionMotorDriverMalePin").mesh,j=BlinkMesh([p.wires[0].wire,p.wires[1].wire,p.pinGLTF2,V]),U=showIndication(n,e,V,p.pinGLTF2),q=D.get("motorDriverPowerFemalePin").mesh,X=D.get("powerDistributionMotorDriverFemalePin").mesh,W=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),p.setDraggable(!0,["pinGLTF2"]),b.refreshPinModelsRef();const H=b.onMouseDown;b.onMouseDown=Y=>{H.call(b,Y),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=Y=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===p&&s===18){const ee=b.draggedPinModel,ie=getWorldPosititon(ee),re=getWorldPosititon(V);ie.distanceTo(re)<B&&(j(),U.cleanup(),b.snapObject(ee,re,p,ee,()=>{const Fe=T.get("motorDriverPowerWire");Fe.mesh.visible=!0,q.visible=!0,X.visible=!0,p.dispose(),p=null,s=19,z.updateTextOnly(M[s-1]),Pe()}))}W.call(b,Y)}}async function Pe(){v=new JstXhFemalePin({pinCount:4,twoSide:!0,jstPinConfig:[{startPosition:{x:.5,y:1.8,z:-3}},{startPosition:{x:0,y:1.8,z:-3}}],colors:["red","green","blue","black"],draggable:!1}),v.pinGLTF1.rotation.y=Math.PI*.5,v.pinGLTF2.rotation.x=Math.PI,v.pinGLTF2.rotation.y=Math.PI*.5,v.updatePosition(new Vector3$1,v.pinGLTF1),v.updatePosition(new Vector3$1,v.pinGLTF2),n.add(v.getGroup());const V=L.get("motorDriverInputPin").mesh,j=BlinkMesh([v.wires[0].wire,v.wires[1].wire,v.wires[2].wire,v.wires[3].wire,v.pinGLTF1,V]),U=showIndication(n,e,V,v.pinGLTF1),q=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),v.setDraggable(!0,["pinGLTF1"]),b.refreshPinModelsRef();const X=b.onMouseDown;b.onMouseDown=W=>{X.call(b,W),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=W=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===v&&s===19){const H=b.draggedPinModel,Y=getWorldPosititon(H),ee=getWorldPosititon(V);Y.distanceTo(ee)<B&&(U.cleanup(),j(),b.snapObject(H,ee,v,H,()=>{s=20,setupForNextSetup(b,s,z,O,allAssets$4.textures.botMiddleCase,"botClosingCase",M[s-1]),ce()}))}q.call(b,W)}}let he=null,xe=null;async function ce(){he=$.get("botClosingCase"),xe=he.position.clone(),he.position.x=.1,he.visible=!0;const V=BlinkMesh([he]),j=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=U=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="botClosingCase"&&s===20){const{distance:q,targetPos:X}=getDistance(b,he);if(q<B){V(),snappingEffect(he,[0,.05,0]);const W=N.worldToLocal(X.clone());b.snapObject(b.draggedComponent,W,null,null,()=>{s=21,setupForNextSetup(b,s,z,O,allAssets$4.textures.botMiddleClip,"botMiddleClip1",M[s-1]),Xe()})}else N.remove(b.draggedComponent),b.draggedElement=null}j.call(b,U)}}let De=null,Ae=null,Be=null,Ee=null,Oe=null,ke=null,Re=null,$e=null;async function Xe(){Ae=$.get("botMiddleClip1"),Ee=$.get("botMiddleClip2"),ke=$.get("botMiddleClip3"),$e=$.get("botMiddleClip4"),De=Ae.position.clone(),Ae.position.x=.118,Be=Ee.position.clone(),Ee.position.set(.118,Ee.position.y,-.015),Oe=ke.position.clone(),ke.position.set(.073,ke.position.y,-.0186),Re=$e.position.clone(),$e.position.set(.073,$e.position.y,.027),Ae.visible=!0,Ee.visible=!0,ke.visible=!0,$e.visible=!0;const V=BlinkMesh([Ae,Ee,ke,$e]),j=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=U=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="botMiddleClip1"&&s===21){const{distance:q,targetPos:X}=getDistance(b,Ae);if(q<B){V(),snappingEffect(Ae,[0,-.08,0]),snappingEffect(Ee,[0,-.08,0]),snappingEffect(ke,[0,-.08,0]),snappingEffect($e,[0,-.08,0]);const W=N.worldToLocal(X.clone());b.snapObject(b.draggedComponent,W,null,null,()=>{gsapWithCSS.to(he.position,{y:xe.clone().y+.1,onComplete:()=>{gsapWithCSS.to(he.position,{x:xe.clone().x,onComplete:()=>{gsapWithCSS.to(he.position,{x:xe.x,y:xe.y,z:xe.z})}})}}),gsapWithCSS.to(Ae.position,{y:De.clone().y+.1,onComplete:()=>{gsapWithCSS.to(Ae.position,{x:De.clone().x,onComplete:()=>{gsapWithCSS.to(Ae.position,{x:De.x,y:De.y,z:De.z})}})}}),gsapWithCSS.to(Ee.position,{y:Be.clone().y+.1,onComplete:()=>{gsapWithCSS.to(Ee.position,{x:Be.clone().x,onComplete:()=>{gsapWithCSS.to(Ee.position,{x:Be.x,y:Be.y,z:Be.z})}})}}),gsapWithCSS.to(ke.position,{y:Oe.clone().y+.1,onComplete:()=>{gsapWithCSS.to(ke.position,{x:Oe.clone().x,onComplete:()=>{gsapWithCSS.to(ke.position,{x:Oe.x,y:Oe.y,z:Oe.z})}})}}),gsapWithCSS.to($e.position,{y:Re.clone().y+.1,onComplete:()=>{gsapWithCSS.to($e.position,{x:Re.clone().x,onComplete:()=>{gsapWithCSS.to($e.position,{x:Re.x,y:Re.y,z:Re.z,onComplete:()=>{s=22,setupForNextSetup(b,s,z,O,allAssets$4.textures.botMiddleCase2,"botMiddleCase",M[s-1]),Ye()}})}})}})})}else N.remove(b.draggedComponent),b.draggedElement=null}j.call(b,U)}}async function Ye(){const V=$.get("botMiddleCase");V.visible=!0;const j=BlinkMesh([V]),U=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=q=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="botMiddleCase"&&s===22){const{distance:X,targetPos:W}=getDistance(b,V);if(X<B){j(),snappingEffect(V,[0,.08,0]);const H=N.worldToLocal(W.clone());b.snapObject(b.draggedComponent,H,null,null,()=>{s=23,setupForNextSetup(b,s,z,O,allAssets$4.textures.expansionBoard,"expansionBoard",M[s-1]),Ke()})}else N.remove(b.draggedComponent),b.draggedElement=null}U.call(b,q)}}async function Ke(){const V=$.get("expansionBoard"),j=P.get("expansionBoardRgb2MalePin").mesh,U=P.get("expansionBoardRgb1MalePin").mesh,q=P.get("expansionBoardTsopMalePin").mesh,X=P.get("expansionBoardPowerMalePin").mesh,W=P.get("expansionBoardButtonMalePin").mesh,H=P.get("expansionBoardLdrMalePin").mesh,Y=P.get("expansionBoardBuzzerMalePin").mesh,ee=P.get("expansionBoardMotorDriverMalePin").mesh,ie=BlinkMesh([V,j,U,q,X,W,H,Y,ee]);V.visible=!0,j.visible=!0,U.visible=!0,q.visible=!0,X.visible=!0,W.visible=!0,H.visible=!0,Y.visible=!0,ee.visible=!0;const re=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=fe=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="expansionBoard"&&s===23){const{distance:Fe,targetPos:ze}=getDistance(b,V);if(Fe<B){ie(),snappingEffect(V,[0,0,.08]),snappingEffect(j,[0,0,.08]),snappingEffect(U,[0,0,.08]),snappingEffect(q,[0,0,.08]),snappingEffect(X,[0,0,.08]),snappingEffect(W,[0,0,.08]),snappingEffect(H,[0,0,.08]),snappingEffect(Y,[0,0,.08]),snappingEffect(ee,[0,0,.08]);const Pt=N.worldToLocal(ze.clone());b.snapObject(b.draggedComponent,Pt,null,null,()=>{s=24,z.updateTextOnly(M[s-1]),Ze()})}else N.remove(b.draggedComponent),b.draggedElement=null}re.call(b,fe)}}async function Ze(){const V=P.get("expansionBoardPowerMalePin").mesh,j=BlinkMesh([f.getGroup(),V]),U=showIndication(n,e,V,f.pinGLTF1),q=D.get("expansionBordPowerFemalePin").mesh,X=T.get("powerWire").mesh,W=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),f.setDraggable(!0,["pinGLTF1"]),b.refreshPinModelsRef();const H=b.onMouseDown;b.onMouseDown=Y=>{H.call(b,Y),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=Y=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===f&&s===24){const ee=b.draggedPinModel,ie=getWorldPosititon(ee),re=getWorldPosititon(V);ie.distanceTo(re)<B&&(j(),b.snapObject(ee,re,f,ee,()=>{U.cleanup(),X.visible=!0,q.visible=!0,f.dispose(),f=null,s=25,z.updateTextOnly(M[s-1]),Qe()}))}W.call(b,Y)}}async function Qe(){const V=P.get("expansionBoardMotorDriverMalePin").mesh,j=BlinkMesh([v.wires[0].wire,v.wires[1].wire,v.wires[2].wire,v.wires[3].wire,v.pinGLTF2,V]),U=showIndication(n,e,V,v.pinGLTF2),q=D.get("expansionBoardMotorDriverFemalePin").mesh,X=T.get("motorInputWire").mesh,W=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),v.setDraggable(!0,["pinGLTF2"]),b.refreshPinModelsRef();const H=b.onMouseDown;b.onMouseDown=Y=>{H.call(b,Y),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=Y=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===v&&s===25){const ee=b.draggedPinModel,ie=getWorldPosititon(ee),re=getWorldPosititon(V);ie.distanceTo(re)<B&&(U.cleanup(),j(),b.snapObject(ee,re,v,ee,()=>{U.cleanup(),X.visible=!0,q.visible=!0,v.dispose(),v=null,s=26,setupForNextSetup(b,s,z,O,null,"frontPannel",M[s-1]),et()}))}W.call(b,Y)}}async function et(){const V=$.get("frontPannel");V.visible=!0;const j=BlinkMesh([V]),U=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=q=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="frontPannel"&&s===26){const{distance:X,targetPos:W}=getDistance(b,V);if(X<B){j(),snappingEffect(V,[0,.08,0]);const H=N.worldToLocal(W.clone());b.snapObject(b.draggedComponent,H,null,null,()=>{s=27,setupForNextSetup(b,s,z,O,null,"rightEye",M[s-1]),tt()})}else N.remove(b.draggedComponent),b.draggedElement=null}U.call(b,q)}}async function tt(){const V=$.get("rightEye");V.visible=!0;const j=BlinkMesh([V]),U=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=q=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="rightEye"&&s===27){const{distance:X,targetPos:W}=getDistance(b,V);if(X<B){j(),snappingEffect(V,[0,0,.01]);const H=N.worldToLocal(W.clone());b.snapObject(b.draggedComponent,H,null,null,()=>{s=28,setupForNextSetup(b,s,z,O,null,"leftEye",M[s-1]),nt()})}else N.remove(b.draggedComponent),b.draggedElement=null}U.call(b,q)}}async function nt(){const V=$.get("leftEye");V.visible=!0;const j=BlinkMesh([V]),U=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=q=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="leftEye"&&s===28){const{distance:X,targetPos:W}=getDistance(b,V);if(X<B){j(),snappingEffect(V,[0,0,.01]);const H=N.worldToLocal(W.clone());b.snapObject(b.draggedComponent,H,null,null,()=>{s=29,setupForNextSetup(b,s,z,O,allAssets$4.textures.rgbModule,"rgbModuleRight",M[s-1]),ot()})}else N.remove(b.draggedComponent),b.draggedElement=null}U.call(b,q)}}let He=null;async function ot(){He=HideMesh([$.get("frontPannel"),$.get("rightEye"),$.get("leftEye")],.1);const V=$.get("rgbModuleRight"),j=P.get("rightRgbMalePin").mesh;V.visible=!0,j.visible=!0;const U=BlinkMesh([V,j]),q=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=X=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="rgbModuleRight"&&s===29){const{distance:W,targetPos:H}=getDistance(b,V);if(W<B){U(),snappingEffect(V,[0,.04,0]),snappingEffect(j,[0,.04,0]);const Y=N.worldToLocal(H.clone());b.snapObject(b.draggedComponent,Y,null,null,()=>{s=30,setupForNextSetup(b,s,z,O,allAssets$4.textures.rgbModule,"rgbModuleLeft",M[s-1]),it()})}else N.remove(b.draggedComponent),b.draggedElement=null}q.call(b,X)}}async function it(){const V=$.get("rgbModuleLeft"),j=P.get("leftRgbMalePin").mesh;j.visible=!0,V.visible=!0;const U=BlinkMesh([V,j]),q=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=X=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="rgbModuleLeft"&&s===30){const{distance:W,targetPos:H}=getDistance(b,V);if(W<B){U(),snappingEffect(V,[0,.04,0]),snappingEffect(j,[0,.04,0]);const Y=N.worldToLocal(H.clone());b.snapObject(b.draggedComponent,Y,null,null,()=>{s=31,setupForNextSetup(b,s,z,O,allAssets$4.textures.arduinoBoard,"arduinoNano",M[s-1]),st()})}else N.remove(b.draggedComponent),b.draggedElement=null}q.call(b,X)}}async function st(){const V=$.get("arduinoNano");V.visible=!0;const j=BlinkMesh([V]),U=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=q=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="arduinoNano"&&s===31){const{distance:X,targetPos:W}=getDistance(b,V);if(X<B){j(),snappingEffect(V,[0,.04,0]);const H=N.worldToLocal(W.clone());b.snapObject(b.draggedComponent,H,null,null,()=>{s=32,z.updateTextOnly(M[s-1]),rt()})}else N.remove(b.draggedComponent),b.draggedElement=null}U.call(b,q)}}let We=null,Ve=null,Ge=null;async function rt(){g=new JstXhFemalePin({pinCount:4,twoSide:!0,jstPinConfig:[{startPosition:{x:.5,y:1.8,z:-3}},{startPosition:{x:.1,y:1.8,z:-3}}],colors:["red","green","blue","yellow"],draggable:!1}),g.pinGLTF2.rotation.x=Math.PI,g.pinGLTF2.rotation.y=Math.PI*.5,g.pinGLTF1.rotation.x=Math.PI*.5,g.updatePosition(new Vector3$1,g.pinGLTF2),g.updatePosition(new Vector3$1,g.pinGLTF1),n.add(g.getGroup());const V=P.get("rightRgbMalePin").mesh,j=$.get("rgbModuleRight");Ge=j.rotation.clone(),We=V.position.clone(),Ve=V.rotation.clone(),j.visible=!0,V.visible=!0;const U=BlinkMesh([g.wires[0].wire,g.wires[1].wire,g.wires[2].wire,g.wires[3].wire,g.pinGLTF1,V]),q=showIndication(n,e,V,g.pinGLTF1);j.rotation.x=Math.PI*.5,j.rotation.y=-Math.PI*.5,V.rotation.x=Math.PI*.5,V.position.z=.036;const X=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),g.setDraggable(!0,["pinGLTF1"]),b.refreshPinModelsRef();const W=b.onMouseDown;b.onMouseDown=H=>{W.call(b,H),b.draggedComponent instanceof JstXhFemalePin&&q.toggleVisibility()},b.onMouseUp=H=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===g&&s===32){const Y=b.draggedPinModel,ee=getWorldPosititon(Y),ie=getWorldPosititon(V);ee.distanceTo(ie)<B&&(q.cleanup(),U(),b.snapObject(Y,getWorldPosititon(V),g,Y,()=>{s=33,z.updateTextOnly(M[s-1]),at()}))}X.call(b,H)}}async function at(){console.log("Connection rightRb gModule  wire");const V=P.get("rightRgbMalePin").mesh,j=$.get("rgbModuleRight"),U=P.get("expansionBoardRgb1MalePin").mesh,q=BlinkMesh([g.wires[0].wire,g.wires[1].wire,g.wires[2].wire,g.wires[3].wire,g.pinGLTF2,U]),X=showIndication(n,e,U,g.pinGLTF2),W=D.get("expansionBoardRgb2FemalePin").mesh,H=T.get("rightLedWire").mesh,Y=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),g.setDraggable(!0,["pinGLTF2"]),b.refreshPinModelsRef();const ee=b.onMouseDown;b.onMouseDown=ie=>{ee.call(b,ie),b.draggedComponent instanceof JstXhFemalePin&&X.toggleVisibility()},b.onMouseUp=ie=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===g&&s===33){const re=b.draggedPinModel,fe=getWorldPosititon(re),Fe=getWorldPosititon(U),ze=fe.distanceTo(Fe);console.log("Step 36 distance:",ze),ze<B?(X.cleanup(),q(),j.rotation.set(Ge.x,Ge.y,Ge.z),V.position.z=We.z,V.rotation.set(Ve.x,Ve.y,Ve.z),g.updatePosition(new Vector3$1,g.pinGLTF1),b.snapObject(re,Fe,g,re,()=>{H.visible=!0,W.visible=!0,g.dispose(),g=null,s=34,z.updateTextOnly(M[s-1]),lt()})):console.log("JST pin not snapped, distance too large:",ze)}else console.log("Drag ignored: draggedComponent:",b.draggedComponent,"stepCounter:",s);Y.call(b,ie)}}let qe=null,Ue=null,je=null;async function lt(){y=new JstXhFemalePin({pinCount:4,twoSide:!0,jstPinConfig:[{startPosition:{x:.5,y:1.8,z:-3}},{startPosition:{x:.1,y:1.8,z:-3}}],colors:["red","green","blue","yellow"],draggable:!1}),y.pinGLTF2.rotation.x=Math.PI,y.pinGLTF2.rotation.y=Math.PI*.5,y.pinGLTF1.rotation.x=Math.PI*.5,y.updatePosition(new Vector3$1,y.pinGLTF2),y.updatePosition(new Vector3$1,y.pinGLTF1),n.add(y.getGroup());const V=P.get("leftRgbMalePin").mesh,j=BlinkMesh([y.wires[0].wire,y.wires[1].wire,y.wires[2].wire,y.wires[3].wire,y.pinGLTF1,V]),U=showIndication(n,e,V,y.pinGLTF1),q=$.get("rgbModuleLeft");je=q.rotation.clone(),qe=V.position.clone(),Ue=V.rotation.clone(),q.visible=!0,V.visible=!0,q.rotation.x=Math.PI*.5,q.rotation.y=-Math.PI*.5,V.rotation.x=Math.PI*.5,V.position.z=.036;const X=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),y.setDraggable(!0,["pinGLTF1"]),b.refreshPinModelsRef();const W=b.onMouseDown;b.onMouseDown=H=>{W.call(b,H),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=H=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===y&&s===34){const Y=b.draggedPinModel,ee=getWorldPosititon(Y),ie=getWorldPosititon(V);ee.distanceTo(ie)<B&&(U.cleanup(),j(),b.snapObject(Y,getWorldPosititon(V),y,Y,()=>{s=35,z.updateTextOnly(M[s-1]),ct()}))}X.call(b,H)}}async function ct(){const V=P.get("leftRgbMalePin").mesh,j=$.get("rgbModuleLeft"),U=P.get("expansionBoardRgb2MalePin").mesh,q=BlinkMesh([y.wires[0].wire,y.wires[1].wire,y.wires[2].wire,y.wires[3].wire,y.pinGLTF2,U]),X=showIndication(n,e,U,y.pinGLTF2),W=D.get("expansionBoardRgb1FemalePin").mesh,H=T.get("leftLedWire").mesh,Y=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),y.setDraggable(!0,["pinGLTF2"]),b.refreshPinModelsRef();const ee=b.onMouseDown;b.onMouseDown=ie=>{ee.call(b,ie),b.draggedComponent instanceof JstXhFemalePin&&X.toggleVisibility()},b.onMouseUp=ie=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===y&&s===35){const re=b.draggedPinModel,fe=getWorldPosititon(re),Fe=getWorldPosititon(U);fe.distanceTo(Fe)<B&&(X.cleanup(),q(),j.rotation.set(je.x,je.y,je.z),V.position.z=qe.z,V.rotation.set(Ue.x,Ue.y,Ue.z),y.updatePosition(new Vector3$1,y.pinGLTF1),b.snapObject(re,Fe,y,re,()=>{H.visible=!0,W.visible=!0,y.dispose(),y=null,s=36,setupForNextSetup(b,s,z,O,allAssets$4.textures.topCase,"topCase",M[s-1]),dt()}))}Y.call(b,ie)}}async function dt(){const V=$.get("topCase");V.visible=!0;const j=BlinkMesh([V]),U=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=q=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="topCase"&&s===36){const{distance:X,targetPos:W}=getDistance(b,V);if(X<B){j(),snappingEffect(V,[0,.04,0]);const H=N.worldToLocal(W.clone());b.snapObject(b.draggedComponent,H,null,null,()=>{s=37,setupForNextSetup(b,s,z,O,null,"tsopSensor",M[s-1]),ut()})}else N.remove(b.draggedComponent),b.draggedElement=null}U.call(b,q)}}let Je=null;async function ut(){const V=$.get("topCase");Je=HideMesh([V],.2);const j=$.get("tsopSensor"),U=P.get("tsopMalePin").mesh;j.visible=!0,U.visible=!0;const q=BlinkMesh([j,U]),X=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=W=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="tsopSensor"&&s===37){const{distance:H,targetPos:Y}=getDistance(b,j);if(H<B){q(),snappingEffect(j,[0,-.04,0]),snappingEffect(U,[0,-.04,0]);const ee=N.worldToLocal(Y.clone());b.snapObject(b.draggedComponent,ee,null,null,()=>{s=38,z.updateTextOnly(M[s-1]),ft()})}else N.remove(b.draggedComponent),b.draggedElement=null}X.call(b,W)}}async function ft(){const V=P.get("tsopMalePin").mesh;w=new JstXhFemalePin({pinCount:3,twoSide:!0,jstPinConfig:[{startPosition:{x:.5,y:1.8,z:-3}},{startPosition:{x:.1,y:1.8,z:-3}}],colors:["red","green","blue"],draggable:!1}),w.pinGLTF1.rotation.x=Math.PI,w.updatePosition(new Vector3$1,w.pinGLTF1),w.pinGLTF2.rotation.x=-Math.PI,w.pinGLTF2.rotation.y=Math.PI*.5,w.updatePosition(new Vector3$1,w.pinGLTF2),n.add(w.getGroup());const j=BlinkMesh([w.wires[0].wire,w.wires[1].wire,w.wires[2].wire,w.pinGLTF1,V]),U=showIndication(n,e,V,w.pinGLTF1),q=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),w.setDraggable(!0,["pinGLTF1"]),b.refreshPinModelsRef();const X=b.onMouseDown;b.onMouseDown=W=>{X.call(b,W),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=W=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===w&&s===38){const H=b.draggedPinModel,Y=getWorldPosititon(H),ee=getWorldPosititon(V);Y.distanceTo(ee)<B&&(j(),U.cleanup(),b.snapObject(H,getWorldPosititon(V),w,H,()=>{s=39,setupForNextSetup(b,s,z,O,allAssets$4.textures.pushButton,"pushButton",M[s-1]),ht()}))}q.call(b,W)}}async function ht(){const V=$.get("pushButton"),j=P.get("pushButtonMalePin").mesh;V.visible=!0,j.visible=!0;const U=BlinkMesh([V,j]),q=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=X=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="pushButton"&&s===39){const{distance:W,targetPos:H}=getDistance(b,V);if(W<B){U(),snappingEffect(V,[0,-.04,0]),snappingEffect(j,[0,-.04,0]);const Y=N.worldToLocal(H.clone());b.snapObject(b.draggedComponent,Y,null,null,()=>{s=40,z.updateTextOnly(M[s-1]),pt()})}else N.remove(b.draggedComponent),b.draggedElement=null}q.call(b,X)}}async function pt(){const V=P.get("pushButtonMalePin").mesh;_=new JstXhFemalePin({pinCount:3,twoSide:!0,jstPinConfig:[{startPosition:{x:.5,y:1.8,z:-3}},{startPosition:{x:.2,y:1.8,z:-3}}],colors:["red","green","blue"],draggable:!1}),_.pinGLTF1.rotation.x=Math.PI,_.updatePosition(new Vector3$1,_.pinGLTF1),_.pinGLTF2.rotation.x=-Math.PI,_.updatePosition(new Vector3$1,_.pinGLTF2),n.add(_.getGroup());const j=BlinkMesh([_.wires[0].wire,_.wires[1].wire,_.wires[2].wire,_.pinGLTF1,V]),U=showIndication(n,e,V,_.pinGLTF1),q=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),_.setDraggable(!0,["pinGLTF1"]),b.refreshPinModelsRef();const X=b.onMouseDown;b.onMouseDown=W=>{X.call(b,W),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=W=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===_&&s===40){const H=b.draggedPinModel,Y=getWorldPosititon(H),ee=getWorldPosititon(V);Y.distanceTo(ee)<B&&(j(),b.snapObject(H,getWorldPosititon(V),_,H,()=>{U.cleanup(),s=41,setupForNextSetup(b,s,z,O,allAssets$4.textures.buzzerModule,"buzzerSensor",M[s-1]),mt()}))}q.call(b,W)}}async function mt(){const V=$.get("buzzerSensor"),j=P.get("buzzerSensorMalePin").mesh;V.visible=!0,j.visible=!0;const U=BlinkMesh([V,j]),q=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=X=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="buzzerSensor"&&s===41){const{distance:W,targetPos:H}=getDistance(b,V);if(W<B){U(),snappingEffect(V,[0,0,.04]),snappingEffect(j,[0,-.04,0]);const Y=N.worldToLocal(H.clone());b.snapObject(b.draggedComponent,Y,null,null,()=>{s=42,z.updateTextOnly(M[s-1]),gt()})}else N.remove(b.draggedComponent),b.draggedElement=null}q.call(b,X)}}async function gt(){const V=P.get("buzzerSensorMalePin").mesh;S=new JstXhFemalePin({pinCount:3,twoSide:!0,jstPinConfig:[{startPosition:{x:.5,y:1.8,z:-3}},{startPosition:{x:0,y:1.8,z:-3}}],colors:["red","green","blue"],draggable:!1}),S.pinGLTF1.rotation.x=Math.PI*.5,S.pinGLTF2.rotation.x=-Math.PI,S.pinGLTF2.rotation.y=Math.PI*.5,S.updatePosition(new Vector3$1,S.pinGLTF1),S.updatePosition(new Vector3$1,S.pinGLTF2),n.add(S.getGroup());const j=BlinkMesh([S.wires[0].wire,S.wires[1].wire,S.wires[2].wire,S.pinGLTF1,V]),U=showIndication(n,e,V,S.pinGLTF1),q=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),S.setDraggable(!0,["pinGLTF1"]),b.refreshPinModelsRef();const X=b.onMouseDown;b.onMouseDown=W=>{X.call(b,W),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=W=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===S&&s===42){const H=b.draggedPinModel,Y=getWorldPosititon(H),ee=getWorldPosititon(V);Y.distanceTo(ee)<B&&(j(),U.cleanup(),b.snapObject(H,getWorldPosititon(V),S,H,()=>{s=43,setupForNextSetup(b,s,z,O,allAssets$4.textures.ldrModule,"ldrSensor",M[s-1]),yt()}))}q.call(b,W)}}async function yt(){const V=$.get("ldrSensor"),j=P.get("ldrMalePin").mesh;V.visible=!0,j.visible=!0;const U=BlinkMesh([V,j]),q=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=X=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="ldrSensor"&&s===43){const{distance:W,targetPos:H}=getDistance(b,V);if(W<B){U(),snappingEffect(V,[0,0,.04]),snappingEffect(j,[0,0,.04]);const Y=N.worldToLocal(H.clone());b.snapObject(b.draggedComponent,Y,null,null,()=>{s=44,z.updateTextOnly(M[s-1]),wt()})}else N.remove(b.draggedComponent),b.draggedElement=null}q.call(b,X)}}async function wt(){const V=P.get("ldrMalePin").mesh;C=new JstXhFemalePin({pinCount:3,twoSide:!0,jstPinConfig:[{startPosition:{x:.5,y:1.8,z:-3}},{startPosition:{x:.6,y:1.8,z:-3}}],colors:["red","green","blue"],draggable:!1}),C.pinGLTF1.rotation.x=Math.PI*.5,C.pinGLTF2.rotation.x=-Math.PI,C.pinGLTF2.rotation.y=Math.PI*.5,C.updatePosition(new Vector3$1,C.pinGLTF1),C.updatePosition(new Vector3$1,C.pinGLTF2),n.add(C.getGroup());const j=BlinkMesh([C.wires[0].wire,C.wires[1].wire,C.wires[2].wire,C.pinGLTF1,V]),U=showIndication(n,e,V,C.pinGLTF1),q=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),C.setDraggable(!0,["pinGLTF1"]),b.refreshPinModelsRef();const X=b.onMouseDown;b.onMouseDown=W=>{X.call(b,W),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=W=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===C&&s===44){const H=b.draggedPinModel,Y=getWorldPosititon(H),ee=getWorldPosititon(V);Y.distanceTo(ee)<B&&(j(),U.cleanup(),b.snapObject(H,getWorldPosititon(V),C,H,()=>{s=45,z.updateTextOnly(M[s-1]),vt()}))}q.call(b,W)}}async function vt(){const V=P.get("expansionBoardTsopMalePin").mesh,j=BlinkMesh([w.wires[0].wire,w.wires[1].wire,w.wires[2].wire,w.pinGLTF2,V]),U=showIndication(n,e,V,w.pinGLTF2),q=D.get("expansionBoardTsopFemalePin").mesh,X=T.get("tsopWire").mesh,W=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),w.setDraggable(!0,["pinGLTF2"]),b.refreshPinModelsRef();const H=b.onMouseDown;b.onMouseDown=Y=>{H.call(b,Y),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=Y=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===w&&s===45){const ee=b.draggedPinModel,ie=getWorldPosititon(ee),re=getWorldPosititon(V);ie.distanceTo(re)<B&&(j(),U.cleanup(),b.snapObject(ee,re,w,ee,()=>{X.visible=!0,q.visible=!0,w.dispose(),w=null,s=46,z.updateTextOnly(M[s-1]),bt()}))}W.call(b,Y)}}async function bt(){const V=P.get("expansionBoardButtonMalePin").mesh,j=BlinkMesh([_.wires[0].wire,_.wires[1].wire,_.wires[2].wire,_.pinGLTF2,V]),U=showIndication(n,e,V,_.pinGLTF2),q=D.get("expansionBoardButtonFemalePin").mesh,X=T.get("buttonWire").mesh,W=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),_.setDraggable(!0,["pinGLTF2"]),b.refreshPinModelsRef();const H=b.onMouseDown;b.onMouseDown=Y=>{H.call(b,Y),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=Y=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===_&&s===46){const ee=b.draggedPinModel,ie=getWorldPosititon(ee),re=getWorldPosititon(V);ie.distanceTo(re)<B&&(j(),U.cleanup(),b.snapObject(ee,re,_,ee,()=>{X.visible=!0,q.visible=!0,_.dispose(),_=null,s=47,z.updateTextOnly(M[s-1]),xt()}))}W.call(b,Y)}}async function xt(){const V=P.get("expansionBoardBuzzerMalePin").mesh,j=BlinkMesh([S.wires[0].wire,S.wires[1].wire,S.wires[2].wire,S.pinGLTF2,V]),U=showIndication(n,e,V,S.pinGLTF2),q=D.get("expansionBoardBuzzerFemale").mesh,X=T.get("buzzerWire").mesh,W=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),S.setDraggable(!0,["pinGLTF2"]),b.refreshPinModelsRef();const H=b.onMouseDown;b.onMouseDown=Y=>{H.call(b,Y),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=Y=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===S&&s===47){const ee=b.draggedPinModel,ie=getWorldPosititon(ee),re=getWorldPosititon(V);ie.distanceTo(re)<B&&(U.cleanup(),j(),b.snapObject(ee,re,S,ee,()=>{X.visible=!0,q.visible=!0,S.dispose(),S=null,s=48,z.updateTextOnly(M[s-1]),_t()}))}W.call(b,Y)}}async function _t(){const V=P.get("expansionBoardLdrMalePin").mesh,j=BlinkMesh([C.wires[0].wire,C.wires[1].wire,C.wires[2].wire,C.pinGLTF2,V]),U=showIndication(n,e,V,C.pinGLTF2),q=D.get("expansionBoardLdrFemalePin").mesh,X=T.get("ldrWire").mesh,W=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),C.setDraggable(!0,["pinGLTF2"]),b.refreshPinModelsRef();const H=b.onMouseDown;b.onMouseDown=Y=>{H.call(b,Y),b.draggedComponent instanceof JstXhFemalePin&&U.toggleVisibility()},b.onMouseUp=Y=>{if(b.isDragging&&b.draggedComponent instanceof JstXhFemalePin&&b.draggedComponent===C&&s===48){const ee=b.draggedPinModel,ie=getWorldPosititon(ee),re=getWorldPosititon(V);ie.distanceTo(re)<B&&(j(),U.cleanup(),He(),Je(),b.snapObject(ee,re,C,ee,()=>{X.visible=!0,q.visible=!0,C.dispose(),C=null,s=49,setupForNextSetup(b,s,z,O,null,"tyreCase1",M[s-1]),St()}))}W.call(b,Y)}}async function St(){const V=$.get("tyreCase1"),j=$.get("tyreCase2"),U=$.get("tyreCase3"),q=$.get("tyreCase4");V.visible=!0,j.visible=!0,U.visible=!0,q.visible=!0;const X=BlinkMesh([V,j,U,q]),W=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=H=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="tyreCase1"&&s===49){const{distance:Y,targetPos:ee}=getDistance(b,V);if(Y<B){X(),snappingEffect(V,[-.04,0,0]),snappingEffect(j,[-.04,0,,0]),snappingEffect(U,[.04,0,0]),snappingEffect(q,[.04,0,0]);const ie=N.worldToLocal(ee.clone());b.snapObject(b.draggedComponent,ie,null,null,()=>{s=50,setupForNextSetup(b,s,z,O,null,"tyre1",M[s-1]),Ct()})}else N.remove(b.draggedComponent),b.draggedElement=null}W.call(b,H)}}async function Ct(){const V=$.get("tyre1"),j=$.get("tyre2"),U=$.get("tyre3"),q=$.get("tyre4");V.visible=!0,j.visible=!0,U.visible=!0,q.visible=!0;const X=BlinkMesh([V,j,U,q]),W=b.onMouseUp;await AudioHandler(allAssets$4.audios[`step${s}`]),b.onMouseUp=H=>{if(b.isDragging&&b.draggedComponent&&b.draggedComponent.name==="tyre1"&&s===50){const{distance:Y,targetPos:ee}=getDistance(b,V);if(Y<B){X(),snappingEffect(V,[-.04,0,0]),snappingEffect(j,[-.04,0,0]),snappingEffect(U,[.04,0,0]),snappingEffect(q,[.04,0,0]);const ie=N.worldToLocal(ee.clone());b.snapObject(b.draggedComponent,ie,null,null,()=>{s=51,ne()})}else N.remove(b.draggedComponent),b.draggedElement=null}W.call(b,H)}}te()}K();async function ne(){try{console.log("Starting completion sequence..."),o&&o.setAnimationLoop&&o.setAnimationLoop(null),i&&(cancelAnimationFrame(i),i=null);const te=document.querySelector("canvas");te&&(te.style.display="none"),await a.showSubtitle("You have successfully built the first version of Byte",5e3),await new Promise(Z=>setTimeout(Z,800)),await a.showSubtitle("Now it's time to enter to the next level",5e3),await new Promise(Z=>setTimeout(Z,1500)),await l.playVideo("./public/audios/endvideo.mp4")}catch(te){console.error("Error in completion sequence:",te),setTimeout(()=>{window.location.href="./index.html"},2e3)}}function J(){G.forEach(Q=>Q()),[r,c,d,u,f,h,m,p,v,g,y,w,_,S,C].forEach(Q=>{Q&&Q.dispose()});function Z(Q){Q&&(Q.traverse(le=>{le.isMesh&&(le.geometry&&le.geometry.dispose(),le.material&&(Array.isArray(le.material)?le.material.forEach(ae=>ae.dispose()):le.material.dispose()))}),Q.parent&&Q.parent.remove(Q))}O.forEach(Q=>Z(Q.mesh)),$.forEach(Q=>Z(Q)),T.forEach(Q=>Z(Q.mesh)),D.forEach(Q=>Z(Q.mesh)),P.forEach(Q=>Z(Q.mesh)),L.forEach(Q=>Z(Q.mesh)),O.clear(),$.clear(),T.clear(),D.clear(),P.clear(),L.clear(),R.parent&&R.parent.remove(R),gsapWithCSS.globalTimeline.clear(),N=null,console.log("cleaning done")}function se(){z.dispose(),b.dispose(),a.cleanup(),l.cleanup(),J()}return{clearEverything:se}}async function markSceneCompleted(n){try{const e=auth.currentUser;if(!e)return;await updateDoc(doc(db,"users",e.uid),{[`scenesCompleted.${n}`]:!0})}catch(e){console.error("Failed to mark scene completed",e)}}let skybox$1,scene,renderer$1,controls,resizeHandler=null,sceneInitialization,animationFrameId=null,camera=null,isSceneTransitioning=!1;function handleKeyPress(n){if(n.key.toLowerCase()==="y"&&!isSceneTransitioning){isSceneTransitioning=!0;const e=renderer$1.xr.getSession(),t=o=>{markSceneCompleted("scene7"),window.removeEventListener("keydown",handleKeyPress),sceneInitialization&&sceneInitialization.cleanUpCollider(),cleanupScene7()};e?e.end().then(()=>{t(),markSceneCompleted("scene7")}).catch(o=>{console.error("Error ending VR session:",o),isSceneTransitioning=!1}):t()}}let botBuilding=null;async function initializeScene7(n,e){setCurrentScene("scene7");const t=getUserInfo(),o=new Stats;o.showPanel(0),document.body.appendChild(o.dom),createGUI().close(),animationFrameId=null,animationFrameId&&(cancelAnimationFrame(animationFrameId),animationFrameId=null),camera=new PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,500),renderer$1=n,renderer$1.shadowMap.enabled=!0,renderer$1.shadowMap.type=PCFSoftShadowMap,renderer$1.shadowMap.autoUpdate=!0,renderer$1.physicallyCorrectLights=!0,renderer$1.toneMapping=ACESFilmicToneMapping,renderer$1.toneMappingExposure=.4,renderer$1.outputEncoding=void 0,renderer$1.domElement.parentElement||document.body.appendChild(renderer$1.domElement),console.log(renderer$1),await loadAllAsset(assetsEntry,camera,renderer$1),scene=new Scene,initializeAudioManager(camera,scene),controls=new OrbitControls(camera,renderer$1.domElement),controls.dampingFactor=.25,controls.enableDamping=!0,controls.maxPolarAngle=Math.PI/2,controls.rotateSpeed=.5,controls.zoomSpeed=.5,botBuilding=BotBuilding(scene,camera,controls,renderer$1,animationFrameId),camera.position.set(.4033093896899428,2.5973672052169077,-1.783624732924128);const s=botBuilding&&(botBuilding.lookAtPosition||botBuilding.position||botBuilding.group&&botBuilding.group.position)||new Vector3$1(.3733519425956795,2.0841573887741274,-2.8188746574795207);controls.target.copy(s),camera.lookAt(controls.target),controls.update(),renderer$1.render(scene,camera),window.dispatchEvent(new CustomEvent("cameraReady-scene7"));const r={height:100,radius:1200,enabled:!0};skybox$1=new GroundedSkybox(allAssets$4.hdris.background,r.height,r.radius),skybox$1.position.y=0,scene.add(skybox$1),scene.environment=allAssets$4.hdris.background,scene.environmentIntensity=.6,renderer$1.render(scene,camera),window.addEventListener("keydown",handleKeyPress);let a=new AmbientLight(16777215,1);scene.add(a);const l=allAssets$4.models.gltf.roboticsLab;l.position.y=1,scene.add(l);const c=new Clock;function d(){if(t.modeSelected==="vr")renderer$1.setAnimationLoop(u);else{let f=function(){if(!camera){cancelAnimationFrame(animationFrameId);return}animationFrameId=requestAnimationFrame(f),u()};f()}}function u(){camera&&(o.begin(),c.getDelta(),t.modeSelected==="vr"?updateVR():controls&&controls.update(),renderer$1.render(scene,camera),o.end())}return d(),resizeHandler=()=>{const f=window.innerWidth/window.innerHeight;camera&&renderer$1&&(camera.aspect=f,camera.updateProjectionMatrix(),renderer$1.setSize(window.innerWidth,window.innerHeight))},window.addEventListener("resize",resizeHandler),{scene,camera,renderer:renderer$1,controls,sceneInitialization}}function cleanupScene7(){var e;botBuilding.clearEverything(),isSceneTransitioning=!1,cleanupAudioManager();const n=document.querySelector(".stats");n&&n.remove(),resizeHandler&&(window.removeEventListener("resize",resizeHandler),resizeHandler=null),window.removeEventListener("keydown",handleKeyPress),animationFrameId&&(cancelAnimationFrame(animationFrameId),animationFrameId=null),renderer$1.setAnimationLoop(null),destroyGUI(),(e=sceneInitialization==null?void 0:sceneInitialization.playerFunction)!=null&&e.player&&disablePlayerMovement(sceneInitialization.playerFunction.player),cleanupVR(),sceneInitialization&&(sceneInitialization.cleanUpCollider(),sceneInitialization=null),skybox$1&&(skybox$1.material&&skybox$1.material.dispose(),skybox$1.geometry&&skybox$1.geometry.dispose(),skybox$1=null),scene&&scene.traverse(t=>{t.geometry&&t.geometry.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach(o=>o.dispose()):t.material.dispose())}),controls&&controls.dispose(),renderer$1.clear(),scene=null,camera=null,controls=null,skybox$1=null,sceneInitialization=null}const scene7=Object.freeze(Object.defineProperty({__proto__:null,cleanupScene7,initializeScene7},Symbol.toStringTag,{value:"Module"}));let renderer,isGameInitializing=!1;function updateCanvasSize(n){if(!n)return;const e=window.innerWidth,t=window.innerHeight;n.setSize(e,t,!1),n.setPixelRatio(Math.min(window.devicePixelRatio,2));const o=n.domElement;o.style.width="100%",o.style.height="100%",o.style.position="fixed",o.style.top="0",o.style.left="0",o.style.zIndex="0"}function initializeRenderer(){return renderer||(renderer=new WebGLRenderer({antialias:!0,powerPreference:"high-performance"}),updateCanvasSize(renderer),document.body.appendChild(renderer.domElement),window.addEventListener("resize",()=>{renderer&&renderer.setSize(window.innerWidth,window.innerHeight)}),renderer)}function startGame(){if(isGameInitializing)return;if(isGameInitializing=!0,!isUserInfoComplete()){console.warn("Cannot start game: User info not complete"),isGameInitializing=!1;return}const n=getStartScene(),e=initializeRenderer(),t=getUserInfo(),o=t.modeSelected==="vr";console.log("Starting game:",{startScene:n,isVRMode:o,userInfo:t});const i=document.getElementById("scene");i&&(i.style.display="block");const s=document.getElementById("mode-selection"),r=document.getElementById("character-selection");switch(s&&(s.style.display="none"),r&&(r.style.display="none"),n){case"scene1":console.log("Initializing scene1 with VR mode:",o),initializeScene1(e,o),window.currentScene="scene1";break;case"scene2":console.log("Initializing scene2 with VR mode:",o),initializeScene2(e,o),window.currentScene="scene2";break;case"scene3":console.log("Initializing scene3 with VR mode:",o),initializeScene3(e,o),window.currentScene="scene3";break;case"scene4":console.log("Initializing scene4 with VR mode:",o),initializeScene4(e,o),window.currentScene="scene4";break;case"scene5":console.log("Initializing scene5 with VR mode:",o),initializeScene5(e,o),window.currentScene="scene5";break;case"scene6":console.log("Initializing scene6 with VR mode:",o),initializeScene6(e,o),window.currentScene="scene6";break;case"scene7":console.log("Initializing scene7 with VR mode:",o),initializeScene7(e),window.currentScene="scene7";break;default:console.warn("Invalid scene specified:",n),console.log("Defaulting to scene1 with VR mode:",o),initializeScene1(e,o),window.currentScene="scene1"}isGameInitializing=!1}document.addEventListener("DOMContentLoaded",()=>{const n=document.getElementById("mode-selection");n&&(n.style.display="flex")});function showModeSelection(){const n={modeSelection:document.getElementById("mode-selection"),characterSelection:document.getElementById("character-selection"),vrModeButton:document.getElementById("vr-mode-button"),nonVRModeButton:document.getElementById("non-vr-mode-button")};n.modeSelection.style.display="flex",n.characterSelection.style.display="none";let e=null;const t=(o,i)=>{e&&e.classList.remove("selected"),o.classList.add("selected"),e=o,updateUserInfo(null,i?"vr":"non-vr"),setTimeout(()=>{showCharacterSelection()},300)};n.vrModeButton.addEventListener("click",()=>t(n.vrModeButton,!0)),n.nonVRModeButton.addEventListener("click",()=>t(n.nonVRModeButton,!1))}function showCharacterSelection(){const n={modeSelection:document.getElementById("mode-selection"),characterSelection:document.getElementById("character-selection"),cards:document.querySelectorAll(".character-card"),startButton:document.getElementById("start-experience-btn")};n.modeSelection.style.display="none",n.characterSelection.style.display="flex";const e=n.cards[0];e.classList.add("active");const t=e.getAttribute("data-character"),{modeSelected:o}=getUserInfo();updateUserInfo(t,o),n.startButton.classList.add("active"),n.cards.forEach(i=>{i.addEventListener("click",()=>{n.cards.forEach(a=>a.classList.remove("active")),i.classList.add("active");const s=i.getAttribute("data-character"),{modeSelected:r}=getUserInfo();updateUserInfo(s,r)})}),n.startButton.addEventListener("click",()=>{n.startButton.classList.contains("active")&&startExperience()}),document.addEventListener("keydown",i=>{i.key==="Enter"?startExperience():i.key==="Escape"&&showModeSelection()})}function startExperience(){const n=document.getElementById("character-selection"),e=document.getElementById("new-loading-screen");n.style.display="none",e.style.display="flex";const t=localStorage.getItem("loadScene");t&&(console.log(`Loading specific scene: ${t}`),setStartScene(t));const o=document.getElementById("new-loading-image");if(o&&t){const a=t.replace("scene","");o.src=`/loadingimages/scene${a}.png`}let i=0;const s=document.querySelector(".new-loading-progress"),r=setInterval(()=>{i+=Math.random()*15,i>=100&&(i=100,clearInterval(r),setTimeout(()=>{startGame()},500)),s&&(s.textContent=Math.floor(i)+"%")},200)}function startCharacterSelection(){showModeSelection()}document.addEventListener("DOMContentLoaded",()=>{startCharacterSelection();const n=new Audio("/sounds/mouse-hover.mp3"),e=new Audio("/sounds/mouse-click.mp3"),t=()=>{n.currentTime=0,n.play().catch(()=>{})},o=()=>{e.currentTime=0,e.play().catch(()=>{})};document.querySelectorAll(".scene-card").forEach(c=>{c.addEventListener("mouseenter",()=>{c.classList.contains("unlocked")&&t()}),c.addEventListener("click",()=>{c.classList.contains("unlocked")&&o()})}),document.querySelectorAll("button:not(#non-vr-mode-button)").forEach(c=>{c.addEventListener("mouseenter",t),c.addEventListener("click",o)});const i=document.querySelector("#non-vr-mode-button");let s=!1;i.addEventListener("mouseenter",t),i.addEventListener("click",()=>{if(!s){s=!0,i.disabled=!0,o();try{startCharacterSelection("non-vr")}catch(c){console.error("Error in Non VR mode:",c),s=!1,i.disabled=!1}}}),document.querySelectorAll(".character-card").forEach(c=>{c.addEventListener("mouseenter",t),c.addEventListener("click",o)});let r=!1;const a=()=>{const c=document.getElementById("scene-selection"),d=document.getElementById("mode-selection"),u=document.getElementById("character-selection"),f=document.getElementById("new-loading-screen"),h=document.getElementById("scene"),m=(!c||c.style.display==="none"||!c.style.display)&&(!d||d.style.display==="none"||!d.style.display)&&(!u||u.style.display==="none"||!u.style.display)&&(!f||f.style.display==="none"||!f.style.display),p=h&&h.style.display!=="none"&&h.style.display!=="";return m&&p?(r||(window.history.pushState({inScene:!0},"",window.location.href),r=!0,console.log("Scene protection state pushed automatically")),!0):!1},l=setInterval(()=>{a()&&clearInterval(l)},200);window.addEventListener("load",a),setTimeout(a,100),document.addEventListener("click",()=>{!r&&a()&&(window.history.pushState({inScene:!0},"",window.location.href),r=!0,console.log("Scene protection state pushed on click"))},{once:!0}),window.addEventListener("popstate",c=>{if(console.log("Popstate fired with state:",c.state),c.state&&c.state.inScene){const d=window.location.protocol+"//"+window.location.host+window.location.pathname+window.location.search+window.location.hash;window.history.pushState({inScene:!0},"",d),console.log("Back button intercepted and blocked")}}),window.addEventListener("beforeunload",c=>{r&&(c.preventDefault(),c.returnValue="All progress will be lost. Are you sure you want to exit from the game?")}),window.addEventListener("keydown",c=>{(c.key==="Escape"||c.key==="Esc")&&(document.fullscreenElement?console.log("solved"):(c.preventDefault(),c.stopPropagation()))},!0)});
